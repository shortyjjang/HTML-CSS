{"version":3,"sources":["webpack://fancy/webpack/runtime/load script","webpack://fancy/./_static/modules/ui/overlay-thing/Shared.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/action-constants.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/action-helpers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/action/actions.js","webpack://fancy/./_static/modules/ui/overlay-thing/appstate.ts","webpack://fancy/./_static/modules/ui/overlay-thing/cache.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/Perf.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/map.ts","webpack://fancy/./_static/modules/ui/overlay-thing/config.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/entry-events.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/history.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/routeutils.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/FancyContext.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AdminPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/SimpleSharePopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AddlistPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/ActionButtons.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/zoom.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItemForm.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Info.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Detail.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/ThingCard.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/MerchantInfo.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Recommendation.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Reviews.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/store/initial-store.ts","webpack://fancy/./_static/modules/ui/overlay-thing/ThingTypes.js","webpack://fancy/./_static/modules/ui/overlay-thing/reducers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/store/store.ts","webpack://fancy/webpack/bootstrap","webpack://fancy/webpack/runtime/compat get default export","webpack://fancy/webpack/runtime/create fake namespace object","webpack://fancy/webpack/runtime/define property getters","webpack://fancy/webpack/runtime/ensure chunk","webpack://fancy/webpack/runtime/get javascript chunk filename","webpack://fancy/webpack/runtime/global","webpack://fancy/webpack/runtime/harmony module decorator","webpack://fancy/webpack/runtime/hasOwnProperty shorthand","webpack://fancy/webpack/runtime/make namespace object","webpack://fancy/webpack/runtime/publicPath","webpack://fancy/webpack/runtime/jsonp chunk loading","webpack://fancy/webpack/startup"],"names":["inProgress","dataWebpackPrefix","getFancyDepsRoot","Shared","getStore","store","cache","pagingContext","transition","reloadCurrentThing","keys","slice","call","arguments","reduce","prev","next","constantGen","shouldOpenThing","state","appContext","visible","shouldFetchThing","thingID","thing","ID","isFetching","closeOverlay","dispatch","isStaticPage","closeModal","historyData","history","stripPathname","document","title","closeThing","$","off","window","trigger","onDataFetched","type","thingData","fromServer","sales_available","isEmpty","sales","show_anywhere_only","status","salesStatus","loadThing","onLoadThing","fetchedThingsIds","fetchThing","ThingCache","killCache","override","queryString","getState","openThing","shouldFetch","cac","isCrawled","thingPageData","options","requestThing","owner","external_apps","viewer","getLocationArgPairs","admin","successFn","need_more_fetch","image_resized_max","src","Image","image","failFn","failureXHR","requestThingFail","alertify","alert","requestPromise","then","__Config","design_v4","get","fail","console","warn","getCordialProperties","prop","id","productID","seller","username","url","name","emojified_name","category","cordial_category","instock","available","soldout","images","image_url","price","parseFloat","min_price","recommended","length","map","item","i","MPArgs","currentLocationArgPair","utm","MP","LogExposed","addLog","crdl","e","trackingItem","brand","brand_name","dataLayer","push","product_id","event","products","undefined","products_info","revenue","option_id","TrackingEvents","viewItem","ga","hitType","page","location","href","toggleFollow","seller_id","user_id","followType","data","followContext","loading","following","toggleFollowAction","ajax","dataType","done","xml","$status","find","text","completeFollow","cancelFollow","toggleFancy","fancyContext","fancyd","fancyd_count","toggleFancyAction","json","fc","completeFancy","cancelFancy","updateSaleContext","newContext","saleContext","slideContext","saleOptionID","isSalesOptionsAvailable","basis","_","option","calculatePrice","C","firstOptionImageIdx","getCurrentSaleOption","saleImages","getSaleImages","some","img","idx","thumbnailIndex","setThumbnailIndex","_convertCurrency","nextCode","nextPrice","force","currencyCode","currencyMoney","currencySymbol","callback","numberType","replace","isString","amount","currency_code","success","currency","code","formatPrice","symbol","requestCurrencyConversion","toFixed","convertCurrency","pendingID","updateAppContext","contextObject","context","loggedIn","updateState","k","v","ignoreCralwed","existence","THINGS","SALES","getCrawled","count","selector","value","t","index","__THING_CACHE","Keys","Sidebar","Wrap","Body","Title","Price","Form","Desc","Owner","gettext","mapStateToThingProps","getSales","getDescription","description","hotel_search","details","propertyDescription","getSaleItemId","is_admin_any","inactive_sales","getSeller","getDetailType","has_launch_app","getFirstSaleOption","ignoreEmptySaleOption","opts","filter","discount_percentage","quantity","retail_price","newPrice","regex","test","getDomesticDeliveryDate","date","expected_delivery_day_1","expected_delivery_day_2","getIntlDeliveryDate","expected_delivery_day_intl_1","expected_delivery_day_intl_2","currencyIsUSD","tid","optionId","hotelImages","salesImages","thingImages","saleOptionWaitingRegistry","setWaiting","chosenSaleOptionID","setResult","getWaiting","waiting","chosenSaleOption","fillArray","original","filler","ol","fl","sparseIdxs","j","thumbnailsLimit","thumbnail_src","thumbnailUrl","width","height","unshift","video","thumbType","thumbnail_url","position","isNumber","isVanityQueriable","props","suppress","AC","minPrice","maxPrice","keyword","trim","original_labels","isNaN","parseInt","labels","ok","getSafeNameProp","dangerouslySetInnerHTML","__html","children","isVideoUploadable","metadata","getThingName","salesAvailable","EXPIRED","REMOVED","PENDING","COMING_SOON","ACTIVE","SOLD_OUT","FancyStatus","Addition","Removal","AfterAddition","AfterRemoval","Idle","Selectors","HomepageWrapper","ThingViewConfig","boundarySize","zoomMargin","zoomBoxSize","zoomScale","StaticThingViewConfig","ThumbnailsLimit","Basic","More","handleOverlayThingKeyEvents","target","tagName","which","KEYS","conditionalTransition","aElement","attr","click","isStream","has","getAttribute","LinkTypes","oneshotEventAttached","attachEntryEvents","body","__INIT_THING_ANCHOR","on","isPlainLeftClick","this","getObjectTypeFromUrl","getPathname","preventDefault","$targ","didClickOn","eitherFancy","sharedState","draggingAdmin","OtContainer","isStaticCache","isStatic","is","getDynamic","getStatic","scrollToTop","parentElement","scrollTop","scrollEvent","handleScroll","attach","func","prepare","detach","_prepare","throttle","viewportHeight","documentElement","clientHeight","scrollHeight","el","addEventListener","passive","removeEventListener","initialThingPageID","extractMetaFromURL","pathname","initialPageIsThingPage","initialPath","preservedHref","initialTitle","locationIsThingPage","overlayIsOn","runOverlay","thingURLType","hasClass","requestIdleCallback","addClass","meta","historyHook","search","Dynamic","Static","Timeline","Internal","Number","redirect","removeClass","init","movePrev","moveNext","destination","FancyContext","React","useFancy","className","AdminPopup","show_on_homepage","date_published","exclude_from_popular","show_in_search","optionSaving","ownerSaving","mergeSaving","payload","thing_id","inputDate","Date","toISOString","split","setState","post","status_code","Object","assign","message","changeOwnerEl","new_owner","toLowerCase","thing_owner","confirm","new_owner_name","new_thing_id","ntid","old_user_id","xmlUtil","reload","always","that","dialog","popupName","$obj","prevProps","prevState","center","checked","onChange","placeholder","style","Display","classnames","onClick","handleSaveOptions","ref","handleChangeOwner","SimpleSharePopup","closePopup","log","shareUrl","copyToClipboard","urlCopied","setTimeout","connector","indexOf","handleCopyLink","encodeURIComponent","AddlistPopup","lists","listSearchQuery","listCreationQuery","listCreating","drawUserList","listSearchInput","focus","objectId","updateList","createList","updated","stopPropagation","targ","currentTarget","selectedListId","theList","list","prevAdded","added","eventName","update","handleDialogOpen","getListCheckbox","res","element","handleListSearch","term","key","data-listid","handleListItemToggle","quickCreateList","onKeyUp","handleListCreation","handleCreateListQueryChange","Component","resp","error","err","unchecked","join","Favorite","useDispatch","require_login","ActionButtons","msg","fancyd_person","cnt","fancyd_person_url","renderPopup","FancydByPopupV4","objectType","FancyUser","viewerId","getBoundarySize","$el","eq","DEBUG","getZoomBoxSize","bs","Math","min","getZoomMargin","zidCac","getZoomImageDimension","ret","getNextZoomImageStyle","pageX","pageY","$wrapper","boundaryWidth","boundaryHeight","marginHoriz","marginVert","$fig","getImageMeta","offset","left","top","topPosition","showZoomImage","zd","zoomImageContainerX","minmax","zoomImageContainerY","backgroundLeft","backgroundTop","bgPosX","bgPosY","transform","backgroundPosition","display","getZoomImageStyle","isZoomActive","currentZoomImageStyle","backgroundSize","isTouchDevice","navigator","maxTouchPoints","msMaxTouchPoints","SwiperAddons","Thumbs","Zoom","SwiperCore","ImageSlide","memo","setSlideLocked","isActive","useState","setZoomActive","zoomImageStyle","setZoomImageStyle","zoomImageCacheKey","setZoomImageCacheKey","zoomImageLoaded","setZoomImageLoaded","isVideo","h264_1000k_url","isMagnifyingGlassZoomable","useEffect","large_image_url","Promise","r","onload","onerror","zoom","startZoom","zoomShow","nextZoomImageStyle","onMouseMove","Video","object","playing","lastFullyRenderedObjectID","allow","fullScreen","data-src","alt","cursor","backgroundColor","backgroundImage","nextProps","displayName","fancyProps","swiperRef","useRef","swipeThumbsRef","thumbIndex","setThumbIndex","slideLocked","swiper","setSwiper","lastThumbIndex","activeIndex","slideTo","current","thumbSwiper","slides","classList","contains","onSlideChange","preloadImages","lazy","loadPrevNext","loadPrevNextAmount","maxRatio","allowSlidePrev","allowSlideNext","onZoomChange","scale","onSwiper","opacity","max","clickedIndex","direction","spaceBetween","slidesPerView","watchSlidesVisibility","selected","handlePurchase","saleOption","sale_id","selectedQuantity","personalization","Fancy","CartAPI","addItem","Cart","openPopup","SaleOptions","currentValue","expander","defaultValue","printer","disabled","onFocus","unselectedLabel","CartButton","label","SelectBox","labelValue","tabIndex","SizeGuide","s","MultiOptionState","option_meta","orderMap","forEach","m","targetIndex","values","filteredOptions","order","sel","uniq","o","getPossibleValuesForIndex","MultiOption","multiOptionState","sid","multiOptions","getMultiOptions","sizeGuidePos","indexTypeOf","additional","selectedArray","selectedValue","showSizeGuide","MultiSelectBox","swatch","MultiSwatch","thumbnail","MultiThumbnail","MultiButton","onMultiSelectBoxChange","MultiSelectBoxOption","data-value","data-index-typeof","onClickSwatch","MultiSwatchOption","data-label","onClickThumbnail","MultiThumbnailOption","onClickMutliButton","MultiButtonOption","optionValueFunction","opt","saleNamePrinter","SaleItemSidebarHead","CurrencyPopup","currentCurrency","renderCurrencyPopup","approxText","appState","params","sale_item_id","remove","FancyApplePay","os","total","displayItems","checkAvailability","testmode","applePayDisplay","applePayTest","getInitialMultiOptionState","updateSaleOptionIDFromMultiOptionState","presetOptionId","String","selectedOptionArray","selectedOption","every","extractSaleOptionIDFromMultiOptionState","amendedID","amendSaleOptionFromMultiOptionState","nextSelected","button","dropdown","indexOfType","extend","bind","onClickMultiOptionGen","initializeMultiOption","checkApplePay","nextSaleOptionID","_o","mos","$so","escapeSelector","paymentRequest","nonSoldout","selectedNonSoldoutOption","nextValue","nsc","priceChanges","currencyChanges","cartButtonStyle","discountPercentage","retailPrice","optionIsMulti","isOptionMulti","salesOptionsAvailable","discounting","currencyCodeStyle","quantitySelectRange","range","showSelectbox","applePayButton","ApplePayButton","sale","floatFormatMinusTwo","numberFormat","getApproxText","handleCurrencyPopup","SaleItemOptionsExpander","handleOptionChange","size_guide_id","SizeGuidePopup","personalizable","handlePersonalizationChange","handleQuantityChange","subscribed","handleNotifyLater","sio","clicked","country","requestPurchase","trace","WebkitAppearance","ApplePayButtonType","ApplePayButtonStyle","handleApplePayCheckout","reviews","summary","shop_url","total_ratings","total_reviews","headerSize","css","offsetTop","rating_avg","Overview","bv","brand_values","shippingInfo","shipping_info","origin","cost","Description","menu","setMenu","showMore","setShowMore","descEl","showFeatures","features","showSpecs","specifications","showReturns","return_exchange_policy_title","shipping_policy","cx","collapsed","show","data-featuretype","ThingCard","html_url","max_price","p","sale_items","tag","Likeable","slidesPerColumn","RecentlyViewed","things","setThings","response","recently","thumb_image_url_558","convertThingsV1","useDefaultReviews","per_page","q","sort","setLoading","skip","setReviews","param","useReviews","ReviewHead","attributes","a","rating","ReviewEntry","review","photoIndex","setPhotoIndex","mainSrc","nextSrc","prevSrc","onCloseRequest","onMovePrevRequest","onMoveNextRequest","ReviewList","reviewOption","setReviewOption","currentPage","debounceEventUntilTimeout","total_pages","pageNum","review_count","applying","AdminMessages","messages","BreadCrumb","breadcrumbs","AdminSidebar","AppV2","pt","ct","minimumOption","nonSoldoutOptions","getFancyContext","connect","ReduxComponentEnhancer","bugsnag","Bugsnag","apiKey","plugins","BugsnagPluginReact","user","__FancyUser","App","new","heart_icon","onLoad","require","overlayContainer","querySelector","selectOrCreate","Overlay","OverlayThing","thingRegex","articleRegex","initialHref","match","ErrorBoundary","createErrorBoundary","tree","Router","Switch","Route","path","Suspense","fallback","component","render","readyState","getInitialStoreState","contextName","userCountry","followStore","followUser","contexts","ThingTypeMeta","thingContext","PlainThingType","args","objectArgs","mergeObjectArgs","fancyd_friends","META","getThingType","SaleItemType","createEmptyObject","review_rating","size_chart_ids","GiftcardType","HotelType","hotel","VanityType","LaunchAppType","ThingTypes","AttachingType","ComparingType","loaded","lastFullyRenderedThingID","populateThingContext","URLMeta","combineReducers","action","updateShallow","cookie","current_country_code","Boolean","seller_follow","nextFancydState","saleOptionInclSales","nextContext","middlewares","thunk","configureStore","reducer","rootReducer","preloadedState","contextKey","middleware","getDefaultMiddleware","serializableCheck","prepend","__webpack_module_cache__","__webpack_require__","moduleId","exports","module","__webpack_modules__","n","getter","__esModule","d","mode","ns","create","def","definition","defineProperty","enumerable","f","chunkId","all","promises","u","g","globalThis","Function","hmd","set","Error","obj","prototype","hasOwnProperty","l","script","needAttach","scripts","getElementsByTagName","createElement","charset","timeout","nc","setAttribute","onScriptComplete","clearTimeout","doneFns","parentNode","removeChild","fn","head","appendChild","Symbol","toStringTag","installedChunks","765","deferredModules","installedChunkData","promise","resolve","reject","errorType","realSrc","request","checkDeferredModules","checkDeferredModulesImpl","result","deferredModule","fulfilled","depId","splice","x","chunkLoadingGlobal","webpackJsonpCallback","chunkIds","moreModules","runtime","executeModules","resolves","parentChunkLoadingFunction","shift","apply","self"],"mappings":"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","file":"OverlayThing.main.fc11e8a807084a196f25.js","sourcesContent":["var inProgress = {};\nvar dataWebpackPrefix = \"fancy:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => fn(event));\n\t\tif(prev) return prev(event);\n\t}\n\t;\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","import { getFancyDepsRoot } from 'fancyutils';\n\nimport store from './store/store';\nimport { cache } from './cache';\nimport { pagingContext, transition } from './container/routeutils';\nimport { reloadCurrentThing } from './container/history';\n\n\ngetFancyDepsRoot().Shared = {\n    getStore: () => store.getState(),\n    cache,\n    pagingContext,\n    transition,\n    reloadCurrentThing,\n};\n","// Generate `key: String(key)` structure by given string key arguments\nfunction constantGen() {\n    var keys = [].slice.call(arguments);\n    return keys.reduce((prev, next) => {\n        prev[next] = next;\n        return prev;\n    }, {});\n}\n\nvar C = constantGen(\n  'UPDATE_APP_CONTEXT',\n  // Loading\n  'REQUEST_THING',\n  'REQUEST_THING_FAILURE',\n  'LOAD_THING',\n\n  // UI Actions\n  'OPEN_THING',\n  'CLOSE_THING',\n\n  // Comment form suggestion\n  'SET_USERNAME_KEYWORD',\n  'LOAD_SUGGESTION',\n\n  // Thumbnail\n  'SET_THUMBNAIL_INDEX',\n\n  // Follow\n  'TOGGLE_FOLLOW',\n  'CANCEL_FOLLOW',\n  'COMPLETE_FOLLOW',\n\n  // Fancy\n  'TOGGLE_FANCY',\n  'CANCEL_FANCY',\n  'COMPLETE_FANCY',\n\n  // Saleitem\n  'UPDATE_SALE_CONTEXT'\n);\n\nexport default C;\n","import { MP, getLocationArgPairs, isEmpty, isStaticPage, stripPathname } from \"fancyutils\";\nimport { Dispatch, State } from \"redux\";\nimport { ThunkAction } from \"redux-thunk\";\n\nimport { history } from \"common-components\";\nimport { historyData } from \"../container/history\";\nimport store from \"../store/store\";\nimport { closeModal } from \"../container/routeutils\";\nimport {\n    closeThing,\n    openThing,\n    loadThing,\n    requestThing,\n    requestThingFail,\n    toggleFollow as toggleFollowAction,\n    cancelFollow,\n    completeFollow,\n    toggleFancy as toggleFancyAction,\n    cancelFancy,\n    completeFancy,\n    setThumbnailIndex,\n} from \"./actions\";\nimport C from \"./action-constants\";\nimport { formatPrice, isSalesOptionsAvailable, getCurrentSaleOption, getSaleImages } from \"../components/map\";\nimport { ThingCache, cache } from \"../cache\";\nimport { salesStatus } from \"../config\";\nimport { ThingObject, SaleContext } from \"ftypes\";\n\nfunction shouldOpenThing(state) {\n    return state.appContext.visible !== true;\n}\n\n// Blocks illegal requests\nfunction shouldFetchThing(state, thingID) {\n    if (state.thing.ID === thingID || state.thing.isFetching) {\n        return false;\n    } else {\n        return true;\n    }\n}\n\nexport function closeOverlay() {\n    return (dispatch: Dispatch) => {\n        if (isStaticPage()) {\n            return;\n        }\n        closeModal();\n        historyData.overlayIsOn = false;\n        history.push(stripPathname(historyData.preservedHref), null);\n        document.title = historyData.initialTitle;\n\n        dispatch(closeThing());\n        $(document).off(\"keydown.overlayThing\");\n        $(window).trigger(\"scroll\");\n    };\n}\n\nfunction onDataFetched(dispatch: Dispatch, thingID, thing, type) {\n    addAdditionalThingContext(thing);\n    cache.add(thingID, thing, type);\n    dispatch(loadThing(thingID, thing));\n    onLoadThing(thing);\n}\n\nconst fetchedThingsIds = {};\n\nexport function fetchThing(\n    thingID: string,\n    type = ThingCache.THINGS,\n    killCache = false,\n    override = false,\n    queryString = \"\"\n) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        if (thingID == null) {\n            console.warn(\"fetchThing(): thingID was null.\");\n            return;\n        }\n        var state = getState();\n        if (shouldOpenThing(state)) {\n            dispatch(openThing());\n        }\n        if (killCache) {\n            cache.remove(thingID, type);\n            delete state.thing;\n        }\n\n        const shouldFetch = override || shouldFetchThing(state, thingID);\n        if (killCache || shouldFetch) {\n            if (cache.exists(thingID, type)) {\n                const cac = cache.get(thingID, type);\n                dispatch(loadThing(thingID, cac));\n                onLoadThing(cac);\n                // if cache is crawled one, request should continue\n                if (!cac.isCrawled) {\n                    return;\n                }\n            }\n\n            // static ot page prefetch\n            if (window.thingPageData) {\n                const thingPageData = window.thingPageData;\n                onDataFetched(dispatch, thingID, thingPageData, type);\n                delete window.thingPageData;\n                return;\n            }\n\n            dispatch(requestThing(thingID));\n            let options;\n\n            options = { owner: true, external_apps: true, viewer: true };\n            if (getLocationArgPairs(\"admin\")) {\n                options.admin = true;\n            }\n            if (type === ThingCache.SALES) {\n                options.sales = true; // /sales/(+d) URL\n            }\n            const successFn = (thing) => {\n                if (thing.need_more_fetch) {\n                    // Load main image as fast as possible.\n                    if (thing.image_resized_max && thing.image_resized_max.src) {\n                        let img = new Image();\n                        img.src = thing.image.src;\n                    }\n                    fetchedThingsIds[thingID] = 1;\n                    dispatch(loadThing(thingID, thing));\n                    onLoadThing(thing);\n                } else {\n                    fetchedThingsIds[thingID] = 2;\n                    onDataFetched(dispatch, thingID, thing, type);\n                }\n            };\n            const failFn = (failureXHR) => {\n                // FIXME: This error handling only happens when there's server-side error -\n                //        can't handle client-side ones\n                dispatch(requestThingFail(/*thingID*/));\n                if (failureXHR && failureXHR.status === 404) {\n                    alertify.alert(\"This page is not available. Please try again later.\");\n                } else {\n                    alertify.alert(\n                        'There was an error while opening the page.<br> Please try again or contact <a mailto=\"cs@fancy.com\">cs@fancy.com</a>.'\n                    );\n                }\n            };\n            if (window.requestPromise) {\n                const requestPromise = window.requestPromise;\n                delete window.requestPromise;\n                requestPromise.then(successFn).catch(failFn);\n            } else {\n                if (__Config.design_v4) {\n                    $.get(`/rest-api/v1/things/${thingID}/details${queryString}`, options).then(successFn).fail(failFn);\n                } else {\n                    $.get(`/rest-api/v1/things/${thingID}${queryString}`, options).then(successFn).fail(failFn);\n                }\n            }\n        }\n    };\n}\n\nexport function getCordialProperties(thing) {\n    const prop = {\n        thingID: thing.id,\n        productID: thing.sales.id,\n        seller: thing.sales.seller.username,\n        url: \"https://fancy.com\" + thing.url,\n        name: thing.emojified_name,\n        category: thing.sales.cordial_category,\n        instock: thing.sales.available && !thing.sales.soldout,\n        image: thing.images[0].image_url,\n        price: parseFloat(thing.sales.min_price),\n    };\n    if (thing.recommended && thing.recommended.length) {\n        prop[\"recommended\"] = thing.recommended.map((item, i) => item.id);\n    }\n    return prop;\n}\n\nfunction onLoadThing(thing) {\n    const MPArgs = { \"thing id\": thing.id };\n    const currentLocationArgPair = getLocationArgPairs(\"utm\");\n    if (currentLocationArgPair) {\n        MPArgs.utm = currentLocationArgPair[1];\n    }\n    MP(\"View Thing Detail\", MPArgs);\n    if (typeof LogExposed != \"undefined\") window.LogExposed.addLog(thing.id + \"\", \"thing\");\n    try {\n        window.crdl(\"event\", \"browse\", getCordialProperties(thing));\n    } catch (e) {}\n    try {\n        let trackingItem;\n        if (thing.sales) {\n            trackingItem = {\n                id: thing.sales.id,\n                brand: thing.sales.seller.brand_name,\n                name: thing.sales.emojified_name || thing.emojified_name,\n                price: thing.sales.price,\n            };\n            window.dataLayer.push({\n                product_id: thing.sales.id,\n                event: \"ProductPage\",\n                products: undefined,\n                products_info: undefined,\n                revenue: undefined,\n                option_id: thing.sales.options && thing.sales.options.length ? thing.sales.options[0].id : undefined,\n            });\n        } else {\n            trackingItem = {\n                id: thing.id,\n                name: thing.emojified_name,\n            };\n        }\n        window.TrackingEvents.viewItem(trackingItem);\n        ga(\"send\", { hitType: \"pageview\", page: location.href, title: document.title });\n    } catch (e) {}\n}\n\nfunction addAdditionalThingContext(thingData: ThingObject) {\n    thingData.fromServer = true;\n    thingData.sales_available =\n        !isEmpty(thingData.sales) &&\n        !thingData.sales.show_anywhere_only &&\n        thingData.sales.status !== salesStatus.EXPIRED; // TODO: need to check exact condition.\n}\n\nexport function toggleFollow({ seller_id, user_id }) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var state = getState();\n        var followType;\n        var data;\n        if (seller_id) {\n            followType = \"followStore\";\n            data = { seller_id };\n        } else if (user_id) {\n            followType = \"followUser\";\n            data = { user_id };\n        } else {\n            return;\n        }\n\n        if (state.followContext[followType].loading === false) {\n            var url = state.followContext[followType].following === true ? \"/delete_follow.xml\" : \"/add_follow.xml\";\n            dispatch(toggleFollowAction(followType));\n            $.ajax({\n                url,\n                data,\n                type: \"post\",\n                dataType: \"xml\",\n            })\n                .done(function (xml) {\n                    var $status = $(xml).find(\"status_code\");\n                    if ($status.length && $status.text() !== 0) {\n                        dispatch(completeFollow(followType));\n                    } else {\n                        dispatch(cancelFollow(followType));\n                    }\n                })\n                .fail(function () {\n                    dispatch(cancelFollow(followType));\n                });\n        }\n    };\n}\n\nexport function toggleFancy(thingID: string) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var state = getState();\n        var { fancyd, fancyd_count, loading } = state.fancyContext;\n        if (!loading) {\n            dispatch(toggleFancyAction(thingID));\n            $.ajax({\n                type: \"PUT\",\n                url: `/rest-api/v1/things/${thingID}`,\n                data: {\n                    fancyd: !fancyd,\n                },\n            })\n                .done(function (json) {\n                    var fc = 0;\n                    if (json.id && json.fancyd === !fancyd) {\n                        if (json.fancyd === true) {\n                            fc = fancyd_count + 1;\n                        } else if (json.fancyd === false) {\n                            fc = fancyd_count - 1;\n                        }\n                        // cache.update(thingID, undefined, \"fancyd\", json.fancyd);\n                        // cache.update(thingID, undefined, \"fancyd_count\", fc);\n\n                        dispatch(completeFancy(thingID, fc));\n                    } else {\n                        dispatch(cancelFancy(thingID));\n                    }\n                })\n                .fail(function () {\n                    dispatch(cancelFancy(thingID));\n                });\n        }\n    };\n}\n\nfunction calculatePrice(thing: ThingObject, saleContext: SaleContext, newContext: SaleContext) {\n    const saleOptionID = newContext.saleOptionID || saleContext.saleOptionID;\n    const sales = thing && thing.sales;\n    // Get object basis for retrieving price.\n    if (isSalesOptionsAvailable(sales)) {\n        const basis = _.find(sales.options, (option) => option.id === saleOptionID);\n        if (basis != null) {\n            return basis.price;\n        } else {\n            console.warn(\n                \"calculatePrice():\",\n                \"Wrong saleOptionID supplied, please investigate. saleOptionID: \",\n                saleOptionID\n            );\n            return 0;\n        }\n    } else if (sales != null) {\n        return sales.price;\n    } else {\n        return 0;\n    }\n}\n\nexport function updateSaleContext(newContext: SaleContext) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var { thing, saleContext, slideContext } = getState();\n        newContext.price = calculatePrice(thing.data, saleContext, newContext);\n        dispatch({ ...newContext, type: C.UPDATE_SALE_CONTEXT });\n        if (saleContext.saleOptionID !== newContext.saleOptionID) {\n            const option = getCurrentSaleOption(thing.data.sales, newContext, true);\n            const saleImages = getSaleImages(thing.data, option);\n            let firstOptionImageIdx;\n            if (\n                option &&\n                saleImages.some((img, idx) => {\n                    if (img.option_id === option.id) {\n                        firstOptionImageIdx = idx;\n                        return true;\n                    }\n                })\n            ) {\n                // blank\n            } else {\n                if (slideContext.thumbnailIndex > saleImages.length - 1) {\n                    firstOptionImageIdx = 0;\n                }\n            }\n            if (firstOptionImageIdx) {\n                dispatch(setThumbnailIndex(firstOptionImageIdx));\n            }\n        }\n    };\n}\n\nfunction requestCurrencyConversion(nextCode: string, nextPrice: string, callback) {\n    const shouldConvert = !(nextCode == null || callback == null);\n    if (shouldConvert) {\n        if (window.numberType === 2) {\n            nextPrice = nextPrice.replace(/,/g, \".\").replace(/ /g, \"\");\n        }\n        if (_.isString(nextPrice)) {\n            nextPrice = nextPrice.replace(/,/g, \"\");\n        }\n        $.ajax({\n            url: \"/convert_currency.json\",\n            type: \"GET\",\n            dataType: \"json\",\n            data: {\n                amount: nextPrice,\n                currency_code: nextCode,\n            },\n        }).success(({ amount, currency } = {}) => {\n            if (amount == null) {\n                return;\n            }\n            callback(currency.code, formatPrice(amount, currency.code), currency.symbol);\n        });\n    }\n}\n\nfunction _convertCurrency(nextCode: string, nextPrice: string, force: boolean) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        const { saleContext } = getState();\n        if (nextCode !== \"USD\") {\n            if (\n                force || // FIXME: unable to comparison since price update comes first (SaleitemSidebarHead.componentWillReceiveProps())\n                saleContext.price !== nextPrice || // currency price changed\n                saleContext.currencyCode !== nextCode || // currency code changed\n                saleContext.currencyMoney == null || // currency symbol/money is not set (changed from usd)\n                saleContext.currencySymbol == null\n            ) {\n                nextPrice = nextPrice || saleContext.price || \"0.00\";\n                requestCurrencyConversion(nextCode, nextPrice, (currencyCode, currencyMoney, currencySymbol) => {\n                    if (typeof currencyMoney === \"number\") {\n                        currencyMoney = currencyMoney.toFixed(2);\n                    }\n                    currencyMoney = currencyMoney.replace(/[ \\.]00$/, \"\");\n                    dispatch(\n                        updateSaleContext({\n                            currencyCode,\n                            currencyMoney,\n                            currencySymbol,\n                        })\n                    );\n                });\n            } else {\n                // NOOP\n            }\n        } else {\n            dispatch(\n                updateSaleContext({\n                    currencyCode: \"USD\",\n                    currencyMoney: null,\n                    currencySymbol: null,\n                })\n            );\n        }\n    };\n}\n\nexport function convertCurrency(nextCode, nextPrice, force = false) {\n    store.dispatch(_convertCurrency(nextCode, nextPrice, force));\n}\n","import C from './action-constants';\n\n\n// Action on requesting thing starts\nexport function requestThing(pendingID) {\n    return {\n        type: C.REQUEST_THING,\n        status: 'request',\n        pendingID\n    };\n}\n\n// Action on requesting thing fails\nexport function requestThingFail() {\n    return {\n        type: C.REQUEST_THING_FAILURE,\n        status: 'failed'\n    };\n}\n\n// action on loading request result\nexport function loadThing(ID, data) {\n    return {\n        type: C.LOAD_THING,\n        status: 'idle',\n        ID,\n        data\n    };\n}\n\n// Action on close overlay\nexport function openThing() {\n    return {\n        type: C.OPEN_THING\n    };\n}\n\n// Action on close overlay\nexport function closeThing() {\n    return {\n        type: C.CLOSE_THING,\n        ID: null,\n        pendingID: null,\n        thing: null\n    };\n}\n\n\nexport function setThumbnailIndex(thumbnailIndex) {\n    return {\n        type: C.SET_THUMBNAIL_INDEX,\n        thumbnailIndex,\n    };\n}\n\nexport function toggleFollow(followType) {\n    return {\n        type: C.TOGGLE_FOLLOW,\n        followType\n    };\n}\n\nexport function cancelFollow(followType) {\n    return {\n        type: C.CANCEL_FOLLOW,\n        followType\n    };\n}\n\nexport function completeFollow(followType) {\n    return {\n        type: C.COMPLETE_FOLLOW,\n        followType\n    };\n}\n\nexport function toggleFancy(thingID) {\n    return {\n        type: C.TOGGLE_FANCY,\n        thingID,\n    };\n}\n\nexport function cancelFancy(thingID) {\n    return {\n        type: C.CANCEL_FANCY,\n        thingID,\n    };\n}\n\nexport function completeFancy(thingID, fancyd_count) {\n    return {\n        type: C.COMPLETE_FANCY,\n        thingID,\n        fancyd_count\n    };\n}\n\nexport function updateAppContext(contextObject) {\n    return {\n        type: C.UPDATE_APP_CONTEXT,\n        context: contextObject\n    };\n}\n","// App state that does not usually change during app lifecycle. (i.e. Login state)\n\n// module-level login state object and setter\nconst state : { viewer: {}; loggedIn: Boolean; } = { viewer: {}, loggedIn: false };\nexport default state;\n\nexport function updateState(k, v) {\n    state[k] = v;\n}\n","import { index } from 'fancyutils';\n\n// Cache bucket\nexport class ThingCache {\n    things = {};\n    sales = {};\n    count = 0;\n    static SALES = 'sales';\n    static THINGS = 'things';\n\n    exists = (id, type, ignoreCralwed) => {\n        const cac = this.get(id, type);\n        var existence = cac != null && typeof cac === 'object';\n        if (ignoreCralwed) {\n            existence = existence && cac.isCrawled !== true;\n        }\n        return existence;\n    }\n\n    // resolver function\n    _get = (id) => {\n        return this[ThingCache.THINGS][id] || this[ThingCache.SALES][id] || null;\n    }\n\n    get = (id, type = ThingCache.THINGS) => {\n        const cac = this[type][id] || this.getCrawled(id, type);\n        return cac;\n    }\n\n    getCrawled = (id, type) => {\n        const cac = this[type][id];\n        if (cac && cac.isCrawled) {\n            return cac;\n        } else {\n            return null;\n        }\n    }\n\n    add = (id, data, type) => {\n        // to add, cache should not be exist or crawled one\n        const cac = this[type][id];\n        if (\n            cac == null || \n            cac.isCrawled === true\n        ) {\n            this[type][id] = data;\n            // Store thing information as well\n            if (type === ThingCache.SALES && data.id) {\n                this[ThingCache.THINGS][data.id] = data;\n            }\n            this.count += 1;\n        } else {\n            console.warn('cache.add(): Cache overwrite');\n        }\n    }\n\n    remove = (id, type) => {\n        if (this[type][id]) {\n            delete this[type][id];\n            this.count -= 1;\n        } else {\n            console.warn('cache.remove(): Non-existing cache removal');\n        }\n    }\n\n    // selector = 'a.b.c'\n    update = (id, type = ThingCache.THINGS, selector, value) => {\n        if (selector == null) {\n            console.warn('ThingCache#update(): selector is empty');\n            return;\n        }\n        const t = this.get(id, type);\n        if (t) {\n            index(t, selector, value);\n        }\n    }\n\n    // sweep() {\n    //     // TODO: should sweep cache if too many cache added by looking `cache.count`\n    // }\n}\n\nexport const cache = new ThingCache();\nwindow.__THING_CACHE = cache;\n","export const Keys = {\n    Sidebar: {\n        Wrap: 'SIDEBAR_WRAP',\n        Body: 'SIDEBAR_BODY',\n        Title: 'SIDEBAR_TITLE',\n        Price: 'SIDEBAR_PRICE',\n        Form: 'SIDEBAR_FORM',\n        Desc: 'SIDEBAR_DESCRIPTION',\n        Owner: 'SIDEBAR_OWNER',\n    },\n};\n","import { alertify, isEmpty } from \"fancyutils\";\nimport {\n    SaleObject,\n    SaleContext,\n    ThingObject,\n    FancyReduxState,\n    User,\n    ThingImage,\n    OverlayPropsV1,\n} from \"ftypes\";\nimport { SaleItem } from \"_static/modules/ThingDetail\";\n\nconst { gettext, _ } = window;\n\nexport function mapStateToThingProps(state: FancyReduxState): OverlayPropsV1 {\n    const {\n        appContext,\n        thing: { data, isFetching, status },\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    } = state;\n\n    return {\n        appContext,\n        status,\n        thing: data,\n        isFetching,\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    };\n}\n\nexport function getSales(type: string, thing: ThingObject) {\n    return thing.sales;\n}\n\nexport function getDescription(type: string, thing: ThingObject) {\n    if (type === \"sales\") {\n        return thing.sales.description;\n    } else if (type === \"hotel\") {\n        return thing.hotel_search.details.propertyDescription;\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSaleItemId(thing: ThingObject, viewer: User) {\n    if (viewer && viewer.is_admin_any) {\n        if (thing.sales) {\n            return thing.sales.id;\n        } else if (thing.inactive_sales) {\n            return thing.inactive_sales.id;\n        }\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSeller(thing: ThingObject) {\n    if (thing.sales) {\n        return thing.sales.seller;\n    } else if (thing.inactive_sales) {\n        return thing.inactive_sales.seller;\n    }\n}\n\nexport function getDetailType(thing: ThingObject) {\n    if (thing.hotel_search) {\n        return \"hotel\";\n    } else if (thing.sales_available && thing.type !== \"vanity_number\") {\n        return \"sales\";\n    } else if (!thing.sales_available && !thing.has_launch_app && thing.type !== \"giftcard\") {\n        return \"urlOnly\";\n    }\n}\n\nexport function isSalesOptionsAvailable<T extends SaleItem>(sales: T | null) {\n    return sales != null && !isEmpty(sales.options);\n}\n\nexport function getFirstSaleOption(sales: SaleItem, ignoreEmptySaleOption = false) {\n    if (isSalesOptionsAvailable(sales)) {\n        return sales.options[0];\n    } else if (ignoreEmptySaleOption === false) {\n        return sales || null;\n    }\n}\n\nexport function getCurrentSaleOption<T extends SaleItem>(sales: T, saleContext: SaleContext = {}, ignoreEmptySaleOption = false) {\n    const { saleOptionID } = saleContext;\n\n    if (isSalesOptionsAvailable<T>(sales)) {\n        if (saleOptionID) {\n            const opts = _(sales.options).filter((prop) => prop.id === saleOptionID);\n            if (opts[0] == null) {\n                console.warn(\"saleOption should not be null!\");\n            }\n\n            return opts[0] == null\n                ? {\n                      id: 0,\n                      discount_percentage: \"0.0\",\n                      quantity: 0,\n                      soldout: true,\n                      retail_price: 0,\n                      name: '',\n                  }\n                : opts[0];\n        } else {\n            return sales.options[0];\n        }\n    } else if (ignoreEmptySaleOption === false) {\n        return sales;\n    }\n}\n\nexport function formatPrice(amount: number, currency: string) {\n    if (currency == \"BTC\") return amount + \"\";\n    var newPrice = amount.toFixed(2) + \"\";\n    var regex = /(\\d)(\\d{3})([,\\.]|$)/;\n    while (regex.test(newPrice)) {\n        newPrice = newPrice.replace(regex, \"$1,$2$3\");\n    }\n    if (window.numberType === 2) {\n        newPrice = newPrice.replace(/,/g, \" \").replace(/\\./g, \",\");\n    }\n    return newPrice;\n}\n\n// sales: thing.sales\nexport function getDomesticDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    if (sales.expected_delivery_day_1) {\n        date += sales.expected_delivery_day_1;\n    }\n    if (sales.expected_delivery_day_2) {\n        date += \" - \" + sales.expected_delivery_day_2;\n    }\n    return date;\n}\n\n// sales: thing.sales\nexport function getIntlDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    // TODO: use moment for locale string\n    if (sales.expected_delivery_day_intl_1) {\n        date += sales.expected_delivery_day_intl_1;\n    }\n    if (sales.expected_delivery_day_intl_2) {\n        date += \" - \" + sales.expected_delivery_day_intl_2;\n    }\n    return date;\n}\n\nexport function currencyIsUSD({ saleContext }: { saleContext: SaleContext }) {\n    return saleContext.currencyCode === \"USD\";\n}\n\n// [sale option id]: { true | false }\nconst saleOptionWaitingRegistry = {};\nwindow.saleOptionWaitingRegistry = saleOptionWaitingRegistry;\nexport function setWaiting(chosenSaleOptionID, setResult) {\n    saleOptionWaitingRegistry[chosenSaleOptionID] = setResult;\n}\nexport function getWaiting<T extends SaleItem>(sales: T, saleContext) {\n    if (sales == null) {\n        return null;\n    }\n    if (saleContext.waiting != null) {\n        return saleContext.waiting;\n    }\n\n    // https://app.asana.com/0/86925821949642/160205241997173\n    // It could be a bit weird for future, but design-side decision\n    if (sales.waiting) {\n        return sales.waiting;\n    }\n\n    const chosenSaleOption = getCurrentSaleOption(sales, saleContext);\n    // options is SaleItem\n    if (sales.id === chosenSaleOption.id) {\n        return sales.waiting;\n        // option is SaleOption\n    } else {\n        if (saleOptionWaitingRegistry[chosenSaleOption.id] != null) {\n            return saleOptionWaitingRegistry[chosenSaleOption.id];\n        } else if (chosenSaleOption.waiting != null) {\n            return chosenSaleOption.waiting;\n        }\n    }\n}\n\nfunction fillArray(original: Array<unknown> /*sparse?ArrayToFill*/, filler: Array<unknown>) {\n    const ol = original.length;\n    const fl = filler.length;\n    const sparseIdxs = [];\n    // Find sparse indexes first.\n    for (let j = 0; j < ol; j++) {\n        if (!(j in original)) {\n            sparseIdxs.push(j);\n        }\n    }\n    for (let i = 0; i < fl; i++) {\n        // if sparse indexes are all in (or nonexist), push leftovers to tail\n        if (i > sparseIdxs.length - 1) {\n            original.push(filler[i]);\n        } else {\n            original[sparseIdxs[i]] = filler[i];\n        }\n    }\n    return original;\n}\n\nlet tid;\nlet optionId: undefined;\nlet hotelImages: ThingImage[] | undefined | [];\nlet salesImages;\nlet thingImages;\nexport function getSaleImages(thing: ThingObject, option, thumbnailsLimit?: number) {\n    if (thing.hotel_search != null) {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n\n            hotelImages = <ThingImage[]>thing.hotel_search.images.map((img) => ({\n                src: img.url,\n                thumbnail_src: img.thumbnailUrl,\n                width: img.width,\n                height: img.height,\n            }));\n            hotelImages.unshift(thing.image_resized_max);\n        }\n        return hotelImages;\n    } else if (thing.sales != null) {\n        if (__Config.design_v4) {\n            const images = [];\n            fillArray(images, thing.images);\n            if (option && option.images && option.images.length > 0) {\n                fillArray(images, option.images);\n            }\n            salesImages = images;\n            if (option) {\n                optionId = option.id;\n            }\n            if (thing && thing.sales && thing.sales.video) {\n                images.unshift(thing.sales.video);\n            }\n            return salesImages;\n        }\n\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            // optionId = option ? option.id : null;\n            // FIXME: do this somewhere else\n            if (thing.image_resized_max == null) {\n                if (thing.image.src) {\n                    thing.image_resized_max = {\n                        src: thing.image.src,\n                        width: thing.image.width,\n                        height: thing.image.height,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                } else {\n                    thing.image_resized_max = {\n                        src: \"/_ui/images/common/blank.gif\",\n                        width: 1,\n                        height: 1,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                }\n            }\n\n            let images = [];\n\n            if (thing.image_resized_max) {\n                images.push(thing.image_resized_max);\n            }\n\n            if (thing.images && thing.images[0]) {\n                images.push(thing.images[0]);\n            }\n\n            // set sale images\n            if (thing && thing.sales && thing.sales.video) {\n                let video = { src: thing.sales.video.thumbnail_url, thumbType: \"video\" };\n                if (thing.sales.video.position > 0) {\n                    images[thing.sales.video.position] = video;\n                } else {\n                    // set video to first unless the position is set\n                    images.unshift(video);\n                }\n            }\n            if (thing.sales.images) {\n                fillArray(images, thing.sales.images);\n            }\n            salesImages = images;\n        }\n        if (option && optionId !== option.id) {\n            optionId = option.id;\n            if (salesImages == null) {\n                salesImages = [];\n            }\n            if (option.images && option.images.length > 0) {\n                const images = salesImages.filter((img) => img.option_id == null);\n                fillArray(images, option.images);\n                salesImages = images;\n            }\n        }\n\n        return _.isNumber(thumbnailsLimit) && thumbnailsLimit > 0\n            ? salesImages.filter((image, idx) => idx < thumbnailsLimit && image.src)\n            : salesImages;\n    } else {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            if (thing.image_resized_max) {\n                thingImages = [thing.image_resized_max];\n            } else if (thing.image) {\n                thingImages = [thing.image];\n            } else {\n                thingImages = [];\n                // || (option && optionId !== option.id)\n            }\n        }\n        return thingImages;\n    }\n}\n\nexport function isVanityQueriable(props: any, suppress: boolean) {\n    var { AC, minPrice, maxPrice, keyword } = props;\n\n    keyword = $.trim(keyword);\n    AC = $.trim(AC);\n    minPrice = minPrice != null ? minPrice : \"0\";\n    minPrice = $.trim(minPrice).replace(\",\", \"\").replace(\"$\", \"\");\n    maxPrice = $.trim(maxPrice).replace(\",\", \"\").replace(\"$\", \"\");\n\n    const original_labels = alertify.labels;\n    if (AC !== \"\") {\n        if (_.isNaN(parseInt(AC, 10)) || AC.length !== 3) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Invalid area code. Area code should be 3 digits.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (minPrice !== \"\") {\n        if (_.isNaN(parseInt(minPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check min price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n\n        if (parseInt(minPrice, 10) >= parseInt(maxPrice, 10)) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"The max price number should be bigger than min price number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (maxPrice !== \"\") {\n        if (_.isNaN(parseInt(maxPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check max price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (keyword !== \"\") {\n        if (keyword.length < 4) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please enter 4 or more characters.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    return true;\n}\n\nexport function getSafeNameProp({ emojified_name, name }: ThingObject) {\n    if (emojified_name) {\n        return { dangerouslySetInnerHTML: { __html: emojified_name } };\n    } else {\n        return { children: name };\n    }\n}\n\nexport function isVideoUploadable(thing: ThingObject): boolean {\n    if ((thing && thing.hotel_search) || thing.metadata) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction salesAvailable(thing: ThingObject): boolean {\n    if (!isEmpty(thing.sales)) {\n        return thing.sales_available;\n    }\n    return false;\n}\n\nexport function getThingName(thing: ThingObject) {\n    if (thing.type === \"giftcard\") {\n        return gettext(\"Fancy Gift Card\");\n    } else if (salesAvailable(thing)) {\n        return thing.sales.name;\n    } else {\n        return thing.name;\n    }\n}\n","// SaleItem#get_status\nexport const salesStatus = {\n    EXPIRED: 'Expired',\n    REMOVED: 'Deleted',\n    PENDING: 'Pending',\n    COMING_SOON: 'Coming soon',\n    ACTIVE: 'Active',\n    SOLD_OUT: 'Sold out'\n};\n\nexport const FancyStatus = {\n    Addition: 'Addition',\n    Removal: 'Removal',\n    AfterAddition: 'AfterAddition',\n    AfterRemoval: 'AfterRemoval',\n    Idle: 'Idle',\n};\n\nexport const textareaHeight = {\n    collapsed: 20,\n    expanded: 40\n};\n\nconst commonWrapperSelector = '#container-wrapper .wrapper-content #content';\nexport const Selectors = {\n    HomepageWrapper: commonWrapperSelector,\n};\n\nconst zoomMargin = 125;\nexport const ThingViewConfig = {\n    boundarySize: 640,\n    zoomMargin,                  // zoom box size 250 (246 + 2 + 2) / 2\n    zoomBoxSize: zoomMargin * 2, // zoom box size 250 (246 + 2 + 2) / 2\n    zoomScale: 1.5,\n};\n\nexport const StaticThingViewConfig = {\n    ThumbnailsLimit: {\n        Basic: 18,\n        More: 200,\n    },\n}\n","import { KEYS, didClickOn, eitherFancy, getObjectTypeFromUrl, getPathname, isPlainLeftClick, isStream } from 'fancyutils';\n\nimport store from '../store/store';\nimport { Selectors } from '../config';\nimport { LinkTypes, transition, pagingContext } from './routeutils';\nimport { closeOverlay } from '../action/action-helpers';\n\n\nfunction handleOverlayThingKeyEvents(event) {\n    if (event.target.tagName === 'TEXTAREA' ||\n        event.target.tagName === 'INPUT') {\n        return;\n    }\n\n    switch (event.which) {\n    case KEYS.LEFT:\n        pagingContext.movePrev();\n        break;\n    case KEYS.RIGHT:\n        pagingContext.moveNext();\n        break;\n    case KEYS.ESC:\n        // If popup is not on\n        if ($('#popup_container:visible').length === 0) {\n            store.dispatch(closeOverlay());\n        }\n        break;\n    }\n}\n\nfunction conditionalTransition(aElement) {\n    // Turn off video\n    $('#container-wrapper .btn-pause').attr('scroll',true).click();\n    // Ensure anchor is static (sticked to homepage timeline) or not.\n    if (isStream() && $(Selectors.HomepageWrapper).has(aElement)) {\n        transition(aElement.getAttribute('href'), LinkTypes.Static);\n    } else {\n        transition(aElement.getAttribute('href'));\n    }\n}\n\nvar oneshotEventAttached = false;\nexport function attachEntryEvents() {\n    if (oneshotEventAttached) {\n        return;\n    }\n    oneshotEventAttached = true;\n    // Remove pre-existing url event and start transition first\n    $(document.body).off('click.overlayThingInit');\n    if (window.__INIT_THING_ANCHOR != null) {\n        conditionalTransition(window.__INIT_THING_ANCHOR);\n        delete window.__INIT_THING_ANCHOR;\n    }\n    // TODO: replace to class-based event binding\n    $(document.body)\n        .on('click', 'a', function(event) {\n            if (isPlainLeftClick(event) &&\n                this.getAttribute('data-prevent-overlay') == null &&\n                getObjectTypeFromUrl(getPathname(this)) === 'Thing'\n            ) {\n                event.preventDefault();\n                // note: key event will be detached inside `closeOverlay()` call\n                $(document).on('keydown.overlayThing', handleOverlayThingKeyEvents);\n                conditionalTransition(this);\n            }\n        });\n\n    $('#overlay-thing').on('click', '.popup.overlay-thing', function(event) {\n        const $targ = $(event.target);\n        // Center container\n        if (didClickOn($targ, '.sidebar') ||\n            didClickOn($targ, '.thing-detail-container .content') ||\n            didClickOn($targ, '.thing-detail-container .timeline') ||\n            eitherFancy('Admin', ({ sharedState }) => sharedState.draggingAdmin)) {\n            // pass\n        // prev button\n        } else if (didClickOn($targ, '.popup_prev')) {\n            pagingContext.movePrev();\n            return false;\n        // next button\n        } else if (didClickOn($targ, '.popup_next')) {\n            pagingContext.moveNext();\n            return false;\n        } else {\n            store.dispatch(closeOverlay());\n        }\n    });\n}\n\nexport const OtContainer = {\n    isStaticCache: undefined,\n    isStatic() {\n        if (this.isStaticCache === undefined) {\n            this.isStaticCache = $(document.body).is('.static-ot');\n        }\n        return this.isStaticCache;\n    },\n    getDynamic() {\n        return $('#overlay-thing .thing-detail');\n    },\n    getStatic() {\n        return $(document);\n    },\n    get() {\n        return this.isStatic() ? this.getStatic() : this.getDynamic();\n    },\n    scrollToTop() {\n        if (this.isStatic()) {\n            $(document.body.parentElement).scrollTop(0);\n        } else {\n            $('#overlay-thing').scrollTop(0);\n        }\n    },\n}\nwindow.OtContainer = OtContainer;\n\n// Only one event is allowed\nexport const scrollEvent = {\n    handleScroll: null,\n    attach(func, prepare) {\n        if (scrollEvent.handleScroll != null) {\n            scrollEvent.detach();\n        }\n        const _prepare = prepare != null ? prepare : 10;\n        \n        const handleScroll = _.throttle(function() {\n            if (OtContainer.isStatic()) {\n                const viewportHeight = document.documentElement.clientHeight;\n                if (scrollEvent.visible === true) {\n                    // console.debug('$(window).height() - $(window).scrollTop() - _prepare <= viewportHeight', $(window).height(), $(window).scrollTop(), _prepare, viewportHeight, $(window).height() - $(window).scrollTop() - _prepare <= viewportHeight)\n                    if (document.documentElement.scrollHeight - $(window).scrollTop() - _prepare <= viewportHeight) {\n                        func(true);\n                    }\n                }\n            } else {\n                const el = this;\n                const viewportHeight = el.clientHeight;\n                if (scrollEvent.visible === true) {\n                    if (el.scrollHeight - el.scrollTop - _prepare <= viewportHeight) {\n                        func(true);\n                    }\n                }\n            }\n        }, 50);\n        this.handleScroll = handleScroll;\n\n        const containerEl = OtContainer.isStatic() ? OtContainer.get().get(0) : $('#overlay-thing').get(0);\n        containerEl.addEventListener('scroll', handleScroll, { passive: true });\n        handleScroll();\n    },\n\n    detach() {\n        const containerEl = OtContainer.get().get(0);\n        containerEl.removeEventListener('scroll', this.handleScroll);\n    },\n    visible: false // copied variable on `state.appContext.visible` change\n};\n","import { extractMetaFromURL } from 'fancyutils';\nimport { history } from 'common-components';\n\nimport store from '../store/store';\nimport { closeOverlay, fetchThing } from '../action/action-helpers';\n\n\nconst initialThingPageID = extractMetaFromURL(location.pathname).id;\nconst initialPageIsThingPage = initialThingPageID != null;\n\n// This stores initial static page history info that needs to be restored when modal get closed.\nexport const historyData = {\n    initialPath: location.pathname,\n    /* mut */preservedHref: location.href, // Preserved Href just before open, and to be returned when closed.\n    initialThingPageID,\n    initialPageIsThingPage,\n    initialTitle: document.title,\n    // This prop indicates current location is (static) thing page. Mutable.\n    locationIsThingPage: initialPageIsThingPage,\n    overlayIsOn: false,\n};\n\n/*\nfunction isInitialPath() {\n    return historyData.initialPath === location.pathname;\n}\n*/\nfunction runOverlay(thingID, thingURLType, killCache = false, queryString) {\n    // Context needs to be isolated from hook: https://github.com/rackt/redux-router/issues/157\n    if (!$(document.body).hasClass('error-page')) {\n        requestIdleCallback(() => {\n            $(document.body).addClass('thing-overlay-on');\n            store.dispatch(fetchThing(thingID, thingURLType, killCache, false, queryString));\n            historyData.overlayIsOn = true;\n            //EE.emit('overlay-on');\n        });\n    }\n}\n\nfunction stopOverlay() {\n    historyData.overlayIsOn = false;\n    store.dispatch(closeOverlay());\n}\n\nexport function reloadCurrentThing() {\n    const meta = extractMetaFromURL(location.href);\n    const thingID = meta && meta.id;\n    if (thingID != null && historyData.overlayIsOn) {\n        runOverlay(thingID, meta.type, true);\n    }\n}\n\nexport function historyHook({ pathname, search /*, action*/ }) {\n    const meta = extractMetaFromURL(pathname);\n    const thingID = meta && meta.id;\n    // When initially (statically) renderred page is thing page\n    // Moving to new thing page\n    historyData.locationIsThingPage = thingID != null;\n    if (historyData.locationIsThingPage) {\n        runOverlay(thingID, meta.type, false, search);\n    } else if (historyData.overlayIsOn) {\n        stopOverlay();\n    }\n}\n\nhistory.listen(historyHook)\n","import { extractMetaFromURL, getObjectTypeFromUrl, isStaticPage, stripPathname } from \"fancyutils\";\n\nimport { historyData } from \"./history\";\nimport { history } from 'common-components';\nexport const LinkTypes = {\n    Dynamic: 0,\n    Static: 1,\n    Timeline: 2,\n    Internal: 3 // no update needed\n};\n\n// `staticLink`: transition from statically attached links\nexport function transition(href, linkType = LinkTypes.Dynamic) {\n    // ID-only\n    if (!_.isNaN(Number(href))) {\n        href = `/things/${href}`;\n    }\n\n    if (getObjectTypeFromUrl(href) === \"Thing\") {\n        const meta = extractMetaFromURL(href);\n        // Update URL to go back when overlay is closed\n        if (!historyData.overlayIsOn) {\n            historyData.preservedHref = location.href;\n        }\n        history.push(stripPathname(meta.href), null);\n    } else {\n        redirect(href);\n    }\n}\n\nexport function closeModal() {\n    if (isStaticPage()) {\n        return;\n    }\n    $(document.body).removeClass(\"thing-overlay-on\"); // FIXME: isolate modal logic\n}\n\n// NOOP\nexport const pagingContext = {\n    init() {},\n    movePrev() {},\n    moveNext() {}\n}\n\nexport function redirect(destination) {\n    if (destination == null) {\n        return false;\n    } else {\n        location.href = destination;\n        return true;\n    }\n}\n\nfunction getUtm() {\n    const $nav = $('.navigation')\n    if ($nav.length > 0) {\n        if ($nav.find('a.current[data-feed=\"featured\"]').length > 0) {\n            return \"timeline_featured\";\n        } else if ($nav.find('a.current[data-feed=\"recommended\"]').length > 0) {\n            return \"timeline_recommended\";\n        } else {\n            const $shopLink = $nav.find('.shop li a');\n            if ($shopLink.eq(0).is('.current')) {\n                return \"shop\";\n            } else if ($shopLink.eq(1).is('.current')) {\n                return \"\";\n            } else if ($shopLink.eq(2).is('.current')) {\n                return \"popular\";\n            } else if ($shopLink.eq(3).is('.current')) {\n                return \"newest\";\n            } else if ($shopLink.eq(4).is('.current')) {\n                return \"editors_picks\";\n            } else if ($shopLink.eq(5).is('.current')) {\n                return \"sales\";\n            }\n        }\n    } else {\n        if ($('.wrapper-content.profile-section').length > 0) {\n            return \"userprofile\";\n        } else if ($('.wrapper-content.merchant').length > 0) {\n            return \"seller_shop\";\n        }\n    }\n}\n\nexport function getUtmString() {\n    const utm = getUtm()\n    if (utm) {\n        return `?utm=${utm}`\n    } else {\n        return ''\n    }\n}\n","import { OverlayProps, ReduxProps } from 'ftypes';\nimport React from 'react';\n\nexport function getFancyContextDefaultValue() {\n  return {\n      appContext: {},\n      thing: {},\n      followContext: {},\n      fancyContext: {},\n      slideContext: {},\n      saleContext: {},\n      dispatch: () => {},\n  }\n}\n\n// @ts-ignore\nconst FancyContext = React.createContext<OverlayProps & ReduxProps>(getFancyContextDefaultValue());\n\nexport const useFancy = () : OverlayProps & ReduxProps => {\n  return React.useContext(FancyContext);\n}\n\nexport default FancyContext;\n","import React from 'react';\nimport { Display } from \"fancymixin\";\nimport classnames from 'classnames';\nimport { xmlUtil } from \"fancyutils\";\n\nexport default class AdminPopup extends React.Component {\n    static popupName = 'thing-admin';\n    state = {\n        show_on_homepage: null,\n        date_published: null, \n        exclude_from_popular: false,\n        show_in_search: true,\n        optionSaving: false,\n        ownerSaving: false,\n        mergeSaving: false,\n    };\n    \n    \n    componentDidMount() {\n        const that = this;\n        $.dialog(AdminPopup.popupName).$obj.on('open', () => {\n            const { thing: { show_on_homepage, date_published, exclude_from_popular, show_in_search }  } = that.props;\n            that.setState( { show_on_homepage, date_published, exclude_from_popular, show_in_search } );\n        });\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AdminPopup.popupName).center();\n    }\n    \n    handleSaveOptions = () => {\n        const { thing } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving } = this.state;\n        if (optionSaving) return false;\n        const payload = { thing_id: thing.id, show_on_homepage, exclude_from_popular, show_in_search }\n        if (show_on_homepage) {\n            let inputDate = new Date(date_published);\n            if (isNaN(inputDate)) {\n                alert(\"invalid date - must be in format of 2020-01-01 10:10:10\");\n                return false;\n            }            \n            payload['date_published'] = inputDate.toISOString().replace(/T/, \" \").split(\".\")[0];\n        }\n        this.setState({optionSaving:true});\n        $.post('/manage-newthing.json', payload).then((json) => {\n            if (json.status_code == 1) {\n                Object.assign(thing, payload);\n                alert(\"Updated!\");\n            } else {\n                alert(json.message || \"Failed to save the changes\");\n            }\n            this.setState({optionSaving:false})\n        }).fail(() => {\n            alert(\"Something went wrong!\");\n            this.setState({optionSaving:false})\n        });\n    }\n\n    handleChangeOwner = () => {\n        const { thing } = this.props;\n        if (this.state.ownerSaving) return false;\n        if (this.changeOwnerEl == null) return false;\n        const new_owner = this.changeOwnerEl.value.trim();\n        if (new_owner.length == 0) {\n            alert(\"Please enter a username.\");\n            return false;\n        }\n        if (new_owner.toLowerCase() == thing.thing_owner.username.toLowerCase()) {\n            alert(\"The thing is already owned by the user.\");\n            return false;\n        }\n\n        if (window.confirm(`Do you want to change the current thing's owner to ${new_owner}?`)) {\n            this.setState({ownerSaving: true})\n            $.ajax({\n                type: \"post\",\n                url: \"/change_new_thing_owner.xml\",\n                data: { new_owner_name: new_owner, thing_id: thing.id, new_thing_id: thing.ntid, old_user_id: thing.thing_owner.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    if (xmlUtil.isSuccess(xml)) {\n                        alert(\"Done!\");\n                        location.reload();                        \n                    } else if (xmlUtil.isFail(xml)) {\n                        alert(\n                            $(xml)\n                                .find(\"message\")\n                                .text()\n                        );\n                    }\n                })\n                .fail(() => {\n                    alert(\"There was an error.\");\n                })\n                .always(() => {\n                    this.setState({ownerSaving: false})\n                });\n        }\n        return false;\n    }\n\n    handleMergeThings = () => {\n\n    }\n\n    render() {\n        const { \n            thing, \n            thing: { sales },\n        } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving, ownerSaving, mergeSaving } = this.state;\n        return (\n          <>\n          \t<p className=\"ltit\">{thing.name}</p>\n            <div className=\"thing-admin-body\">\n                <ul className=\"thing-info\">\n                <li><em>Sale ID</em> {sales.id}</li>\n                    <li><em>Thing ID</em> {thing.id}</li>\n                    <li><em>Thing Owner</em> {thing.thing_owner.username}</li>\n                    <li className=\"buttons\">\n                        <a className=\"btns-blue-embo\" href={`/merchant/products/${sales.id}`} target=\"_blank\">Edit Sale</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-sale-orders-by-thing-id?thing_id=${thing.id}`} target=\"_blank\">View Orders</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-users-by-cart-item?sale_id=${sales.id}`} target=\"_blank\">View Carts</a>\n                    </li>\n                </ul>\n                <div className=\"thing-options\">\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-on-homepage\" checked={!!show_on_homepage}\n                        onChange={(event) => this.setState({ show_on_homepage: event.target.checked })}\n                        /> Show on Homepage</label>\n                        <input className=\"text\" type=\"text\" name=\"date-published\" placeholder=\"2020-01-02 10:20:30\"\n                            style={Display.NoneIf(!show_on_homepage)} value={date_published || ''}\n                            onChange={(event) => {this.setState({ date_published: event.target.value })}}\n                            />\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"exclude-from-popular\" checked={!!exclude_from_popular}\n                            onChange={(event) => this.setState({ exclude_from_popular: event.target.checked })}\n                        /> Exclude from Popular</label>\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-in-search\" checked={!!show_in_search}\n                            onChange={(event) => this.setState({ show_in_search: event.target.checked })}\n                        /> Show in Search</label>\n                    </p>\n                    <p>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": optionSaving })} onClick={this.handleSaveOptions}>Save Changes</button>\n                    </p>                    \n                </div>\n                <div className=\"thing-actions\">\n                    <p>\n                        <label>Change Owner</label>\n                        <input type=\"text\" name=\"change_owner\" placeholder=\"Enter new username\" ref={(el) => {this.changeOwnerEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": ownerSaving })} onClick={this.handleChangeOwner}>Change</button>\n                    </p>\n                    {/*\n                    <p>\n                        <label>Merge Things</label>\n                        <input type=\"text\" name=\"merge_thing_id\" placeholder=\"Enter Thing ID\" ref={(el) => {this.mergeThingEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": mergeSaving })} onClick={this.handleMergeThings}>Merge</button>\n                    </p>*/}\n                </div>\n\n            </div>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React from 'react';\nimport classnames from 'classnames';\nimport { closePopup, copyToClipboard } from 'fancyutils';\n\nexport default class SimpleSharePopup extends React.Component {\n    static popupName = 'minimum-share';\n\n    constructor(props) {\n        super(props);\n        const { thing, viewer } = props;\n        let url = `https://fancy.com${thing.url}`;\n        if (viewer && viewer.username) {\n            let connector = ~url.indexOf('?') ? '&' : '?';\n            url = `${url}${connector}ref=${viewer.username}`\n        }\n        console.log(url)\n        this.state = {\n            shareUrl: url,\n            urlCopied: false,\n        }\n    }\n\n    handleCancelClick = (event) => {\n        event.preventDefault();\n        closePopup(SimpleSharePopup.popupName);\n    }\n\n    componentDidUpdate(){\n        $.dialog(SimpleSharePopup.popupName).center();\n    }\n\n    handleCopyLink = (event) => {\n        console.log('handleCopyLink');\n        const { shareUrl } = this.state;\n        console.log('handleCopyLink ' + shareUrl );\n        copyToClipboard(shareUrl);\n        this.setState({ urlCopied: true });\n        setTimeout(() => {\n            this.setState({ urlCopied: false });\n        }, 2000);\n    }\n\n\n    render() {\n        const { thing, viewer } = this.props;\n        const { shareUrl, urlCopied } = this.state;\n\n        return (\n          <>\n          \t<p className=\"ltit\">Share</p>\n            <ul>\n                <li><a href=\"#\" className=\"btn-copy-link link\" onClick={this.handleCopyLink}>{urlCopied ? \"Copied to clipboard\" : \"Copy link\"}</a></li>\n                <li><a \n                    href={`http://pinterest.com/pin/create/link/?url=${encodeURIComponent(shareUrl)}&media=${thing.images ? encodeURIComponent(thing.images[0].image_url) : \"\"}&description=${encodeURIComponent(thing.name)}`}\n                    target=\"_blank\" className=\"pin\">Share to Pinterest</a></li>\n                <li><a \n                    href={`mailto:?body=Check%20out%20${encodeURIComponent(thing.name)}%20on%20Fancy!%0A%0A${encodeURIComponent(shareUrl)}&subject=${encodeURIComponent(thing.name)}%20on%20Fancy`}\n                    target=\"_blank\" className=\"email\">Share via email</a></li>\n            </ul>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { closePopup, KEYS, MP, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nexport default class AddlistPopup extends Component {\n    static popupName = 'add-list';\n    state = {\n        lists: [],\n        listSearchQuery: '',\n        listCreationQuery: '',\n        listCreating: false,\n    };\n\n    handleDialogOpen = () => {\n        this.setState({ lists: [], listSearchQuery: '', listCreationQuery: '' });\n        this.drawUserList()\n        setTimeout(() => {\n            this.listSearchInput.focus();\n        }, 0);\n\n    }\n    componentDidMount() {\n        $.dialog(AddlistPopup.popupName).$obj.on('open', this.handleDialogOpen);\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AddlistPopup.popupName).center();\n    }\n\n    drawUserList() {\n        const objectId = this.props.objectId;\n        getListCheckbox({\n            objectId,\n            callback: res => { this.setState(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setState({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (this.state.listCreating) return;\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        this.setState({ listCreating: true })\n        // save new list\n        updateList({\n            objectId,\n            createList: listCreationQuery,\n            callback: (success, updated) => {\n                if (success) {\n                    const { lists } = this.state;\n                    MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    this.setState( {\n                        listCreationQuery: '', listCreating: false,\n                        lists: [ ...updated, ...lists ],\n                    });\n                }\n            }\n        })\n    }\n\n    handleListItemToggle = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = Number(targ.getAttribute('data-listid'));\n        const theList = lists.filter(list => list.id === selectedListId)[0];\n        const prevAdded = theList.added;\n        theList.added = !theList.added;\n        const eventName = theList.added ? \"Add to List\" : \"Remove from List\";\n        this.setState({ lists })\n\n        const callback = (success, updated) => {\n            const { lists } = this.state;\n            if (success) {\n            } else {\n                const theList = lists.filter(list => list.id === selectedListId)[0];\n                theList.added = prevAdded;\n            }\n            this.setState({ lists })\n            MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n        };\n\n        const update = { objectId, callback };\n\n        if (theList.added) update['checked'] = [theList.id];\n        else update['unchecked'] = [theList.id];\n        updateList(update)\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setState({ listCreationQuery: event.target.value });\n    }\n\n    render() {\n        var { objectId } = this.props;\n        var {\n            lists,\n            listSearchQuery,\n            listCreationQuery,\n            listCreating,\n        } = this.state;\n\n        return (\n            <>\n                <p className=\"ltit\">Add to collections</p>\n                <fieldset className=\"search\">\n                    <input type=\"text\" placeholder=\"Search\" className=\"text\" \n                        value={listSearchQuery} ref={(element) => {this.listSearchInput = element;}}\n                        onChange={this.handleListSearch} />\n                </fieldset>\n                <div className=\"list\">\n                    <ul ref={(el) => {this.lists = el;}}>\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style} className={classnames({ \"added\": list.added })}>\n                                <label>{list.name}</label>\n                                <button\n                                    data-listid={list.id} \n                                    onClick={this.handleListItemToggle}\n                                    className=\"btns-blue-embo\">{list.added ? \"Remove\" : \"Add\"}</button>\n                            </li>\n                        )\n                    })}\n                    </ul>\n                </div>\n                <fieldset className=\"create\">\n                    <input \n                        type=\"text\" placeholder=\"Create new collection\" \n                        ref={(element) => {this.quickCreateList = element;}}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}/>\n                    <button className={classnames(\"btn-create\", { \"loading\": listCreating })} style={Display.NoneIf($.trim(listCreationQuery).length == 0)}\n                        onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </fieldset>\n                <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n            </>\n        );\n    }\n}\n\nfunction getListCheckbox({ objectId, callback }) {\n    $.get('/get_list_checkbox.json', { tid: objectId }).done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            closePopup(AddlistPopup.popupName);\n        }\n        callback && callback({ lists: resp.lists })\n    },)\n    .error(err => { \n        alertify.alert(\"Please try again later.\");\n        console.warn(err); \n        closePopup(AddlistPopup.popupName);\n    });\n}\n\nfunction updateList({ objectId, checked, unchecked, createList, callback }) {\n    const payload = { tid: objectId };\n    if (checked) payload['add_list_ids'] = checked.join(',');\n    if (unchecked) payload['remove_list_ids'] = unchecked.join(',');\n    if (createList) payload['new_list'] = createList;\n\n    $.post('/update_list_checkbox.json', payload)\n    .done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            callback(false, null);\n        } else {\n            callback(true, resp.lists);\n        }\n    })\n    .error(err => { \n        console.warn(err); \n        alertify.alert(\"Please try again later.\");\n        callback(false, []);\n    })\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { FancyUser, MP, renderPopup } from \"fancyutils\";\nimport { useDispatch } from 'react-redux'\nimport { FancydByPopupV4 } from 'common-components';\n\nimport { useFancy } from \"../FancyContext\";\nimport AdminPopup from \"../../popup/AdminPopup\"\nimport SimpleSharePopup from \"../../popup/SimpleSharePopup\"\nimport AddlistPopup from \"../../popup/AddlistPopup\"\nimport { toggleFancy, getCordialProperties } from \"../../../action/action-helpers\";\n\nfunction Favorite() {\n    const { appContext, thing, fancyContext } = useFancy();\n    const dispatch = useDispatch();\n\n    const handleClick = (event: React.MouseEvent) => {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log('favortie');\n        if (!appContext.loggedIn) {\n            window.require_login(null, \"fancy_thing\", thing.id);\n            return;\n        }\n\n        if (fancyContext.loading) {\n            return;\n        }\n\n        dispatch(toggleFancy(thing.id));\n\n        if (!fancyContext.fancyd) {\n            MP(\"Fancy\", { thing_id: thing.id });\n            try {\n                window.crdl('event', 'favorite_item', getCordialProperties(thing));\n            } catch (e) {\n            }\n        } else {\n            MP(\"Unfancy\", { thing_id: thing.id });\n        }\n    };\n\n    return (\n        <a className={classnames(\"button button-static fancy _count\", { fancyd: fancyContext.fancyd })} onClick={handleClick}>\n            Favorite\n        </a>\n    );\n}\n\nexport default function ActionButtons() {\n    const {\n        appContext: { viewer, loggedIn },\n        thing,\n        thing: { id: objectId },\n        fancyContext,\n    } = useFancy();\n\n    let msg;\n    if (thing.fancyd_person) {\n        const cnt = fancyContext.fancyd_count - 1;\n        if (cnt > 0) {\n            msg = <>\n                Favorited by <a href={thing.fancyd_person_url}>{thing.fancyd_person}</a> and <b>{cnt} other{(cnt > 1) ? `(s)` : ``}</b>\n            </>\n        } else {\n            msg = <>Favorited by <a href={thing.fancyd_person_url}>{thing.fancyd_person}</a></>\n        }\n    } else {\n        msg = <>{fancyContext.fancyd_count} people favorited</>\n    }\n\n    return (\n        <>\n            <span className=\"_fancyd fancyd_user\" onClick={(e : React.MouseEvent<HTMLSpanElement>) => {\n                if (e.target.tagName === 'A') {\n                    return;\n                }\n                renderPopup(FancydByPopupV4, { objectId, objectType: 'thing', loggedIn: FancyUser.loggedIn, viewerId: FancyUser.id });\n            }}>{msg}</span>\n            <a onClick={(event) => {\n                event.preventDefault();\n                if (!loggedIn) {\n                    window.require_login();\n                    return;\n                }\n                renderPopup(AddlistPopup, { objectId });\n            }} className=\"add-list\">Add to List</a>\n            <div className=\"figure-button action-button-v2\">\n                {viewer.is_admin_any && (\n                    <a className=\"edit\"\n                        onClick={(event) => {\n                            event.preventDefault();\n                            renderPopup(AdminPopup, { viewer, thing });\n                        }}>Edit</a>\n                )}\n                <Favorite />\n                <a\n                    className=\"btn-share\"\n                    onClick={(event) => {\n                        event.preventDefault();\n                        renderPopup(SimpleSharePopup, { viewer, thing });\n                    }}>\n                    Share\n                </a>\n            </div>\n        </>\n    );\n}\n","import { minmax } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\nimport { ThingImageOrVideo } from \"ftypes\";\n\n// TODO: cache per (thing id + image index)\nconst zoomBoxMaximumSize = 240;\nconst zoomScale = 1.5;\n\nconst getBoundarySize = () => {\n    const $el = $(\n        \".thing-detail-container .figure-section .swiper-container.gallery-top .active-slide\"\n    ).eq(0);\n\n    if ($el.length !== 1) {\n        window.DEBUG && console.warn('getBoundarySize(): warning: $el.length is ', $el.length);\n    }\n\n    return {\n        $el,\n        width: $el.width()!,\n        height: $el.height()!,\n    };\n};\ntype BS = ReturnType<typeof getBoundarySize>;\n\nconst getZoomBoxSize = (bs: BS) => Math.min(bs.width / 3, zoomBoxMaximumSize);\nconst getZoomMargin = (bs: BS) => (getZoomBoxSize(bs) - 4) / 2;\n\nconst zidCac: { [o: string]: any } = {};\nconst getZoomImageDimension = (img: ThingImageOrVideo, bs = getBoundarySize()) => {\n    if (zidCac[img.image_url]) {\n        return zidCac[img.image_url];\n    }\n    const zoomMargin = getZoomMargin(bs);\n    // const imageSize = calculateImageSize(img);\n\n    const ret = {\n        width: bs.width * zoomScale /* * (imageSize.larger === \"height\" ? imageSize.proportion : 1) */ + zoomMargin,\n        height: bs.height * zoomScale + zoomMargin,\n        /* ((b.height * imageSize.height) / imageSize.width) *\n                (imageSize.larger === \"width\" ? imageSize.proportion : 1) *\n                zoomScale +\n            zoomMargin ,*/\n    };\n    zidCac[img.image_url] = ret;\n    return ret;\n};\n\nconst getImageMeta = (bs: BS) => {\n    let width, height, marginHoriz, marginVert;\n\n    const $fig = $(\".thing-detail-container .figure-section .swiper-container.gallery-top img:eq(0)\");\n    width = $fig.width()!;\n    height = $fig.height()!;\n    marginHoriz = 0;\n    if (width > height) {\n        marginHoriz = 0;\n        marginVert = (bs.height - height) / 2;\n    } else {\n        marginHoriz = (bs.width - width) / 2;\n        marginVert = 0;\n    }\n    return { width, height, marginHoriz, marginVert };\n};\n\nexport const getNextZoomImageStyle = (img: ThingImageOrVideo, pageX: number, pageY: number) => {\n    const bs = getBoundarySize();\n    const $wrapper = bs.$el;\n\n    if (!$wrapper.length) {\n        return Display.None;\n    }\n\n    const boundaryWidth = bs.width;\n    const boundaryHeight = bs.height;\n    const meta = getImageMeta(bs);\n\n    const offset = $wrapper.offset()!;\n    const left = pageX - offset.left;\n    const top = pageY - offset.top;\n\n    const topPosition = top - (boundaryHeight - meta.height) / 2;\n\n    const showZoomImage = left > 0 && topPosition > 0 && topPosition < meta.height;\n\n    const zoomBoxSize = getZoomBoxSize(bs);\n    const zoomMargin = getZoomMargin(bs);\n\n    if (showZoomImage) {\n        const zd = getZoomImageDimension(img, bs);\n        const zoomImageContainerX = minmax(\n            left - zoomMargin,\n            meta.marginHoriz,\n            meta.marginHoriz + meta.width - zoomBoxSize\n        );\n        const zoomImageContainerY = minmax(\n            top - zoomMargin,\n            meta.marginVert,\n            meta.marginVert + meta.height - zoomBoxSize\n        );\n\n        const backgroundLeft = (zd.width * left) / boundaryWidth - zoomMargin;\n        const backgroundTop = (zd.height * top) / boundaryHeight - zoomMargin;\n\n        const bgPosX = -minmax(backgroundLeft, 0, zd.width - zoomBoxSize);\n        const bgPosY = -minmax(backgroundTop, 0, zd.height - zoomBoxSize);\n\n        return {\n            left: 0,\n            top: 0,\n            width: `${zoomBoxSize}px`,\n            height: `${zoomBoxSize}px`,\n            transform: `translate(${zoomImageContainerX}px, ${zoomImageContainerY}px)`,\n            backgroundPosition: `${bgPosX}px ${bgPosY}px`,\n            display: \"inline\",\n        };\n    } else {\n        return Display.None;\n    }\n};\n\nconst RESIZED_SIZE = 1280;\nconst calculateImageSize = (img: ThingImageOrVideo) => {\n    const size = Math.max(img.width, img.height);\n    if (size < RESIZED_SIZE) {\n        const smallerSize = Math.min(img.width, img.height);\n        return {\n            width: img.width,\n            height: img.height,\n            proportion: size / smallerSize,\n            larger: img.width > img.height ? \"width\" : \"height\",\n        };\n    } else {\n        if (img.width > img.height) {\n            const proportion = RESIZED_SIZE / img.width;\n            return {\n                width: RESIZED_SIZE,\n                height: img.height / proportion,\n                proportion,\n                larger: \"width\",\n            };\n        } else {\n            const proportion = RESIZED_SIZE / img.height;\n            return {\n                width: img.width / proportion,\n                height: RESIZED_SIZE,\n                proportion,\n                larger: \"height\",\n            };\n        }\n    }\n};\n\nexport const isZoomable = (img: ThingImageOrVideo) => {\n    const imageSize = calculateImageSize(img);\n    const boundarySize = getBoundarySize();\n\n    return imageSize.width > boundarySize.width * zoomScale || imageSize.height > boundarySize.height * zoomScale;\n};\n\nexport const getZoomImageStyle = (img: ThingImageOrVideo, isZoomActive: boolean, currentZoomImageStyle: any) => {\n    if (isZoomActive) {\n        const zd = getZoomImageDimension(img);\n        const ret = {\n            ...currentZoomImageStyle,\n            backgroundSize: `${zd.width}px ${zd.height}px`,\n        };\n        return ret;\n    } else {\n        return Display.None;\n    }\n};\n","import React, { memo, useEffect, useState, useRef } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\nimport SwiperCore, { Thumbs, Zoom } from \"swiper\";\nimport { Video } from \"common-components\";\nimport { Display } from \"fancymixin\";\n\nimport { useFancy } from \"../../FancyContext\";\nimport ActionButtons from \"../ActionButtons\";\nimport { getCurrentSaleOption, getSaleImages } from \"../../../map\";\nimport { setThumbnailIndex } from \"../../../../action/actions\";\nimport { getZoomImageStyle, getNextZoomImageStyle } from \"./zoom\";\n\nimport type { ThingImageOrVideo } from \"ftypes\";\nimport type { Swiper as SwiperClass } from \"swiper\";\n\nconst isTouchDevice = \"ontouchstart\" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;\nconst SwiperAddons = [Thumbs];\nif (isTouchDevice) {\n    SwiperAddons.push(Zoom);\n}\nSwiperCore.use(SwiperAddons);\n\nconst placeholderImage = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\nconst HEIGHT = 480;\nconst PER_PAGE = 5;\n\nconst preloadImage = (src: string) =>\n    new Promise((r) => {\n        const image = new window.Image();\n        image.onload = r;\n        image.onerror = r;\n        image.src = src;\n    });\n\ninterface ImageSlideProps {\n    image: ThingImageOrVideo;\n    i: number;\n    isActive: boolean;\n    setSlideLocked: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nconst ImageSlide = memo<ImageSlideProps>(\n    ({ image, i, setSlideLocked, isActive }) => {\n        const {\n            thing,\n            slideContext: { thumbnailIndex },\n        } = useFancy();\n        const [isZoomActive, setZoomActive] = useState(false);\n        const [zoomImageStyle, setZoomImageStyle] = useState(Display.None);\n        const [zoomImageCacheKey, setZoomImageCacheKey] = useState(\"\");\n        const [zoomImageLoaded, setZoomImageLoaded] = useState(false);\n\n        const isVideo = !!image.h264_1000k_url;\n        const isMagnifyingGlassZoomable = !isVideo && !isTouchDevice;\n\n        useEffect(() => {\n            if (!zoomImageCacheKey && isZoomActive) {\n                preloadImage(image.large_image_url).then(() => {\n                    setZoomImageCacheKey(image.large_image_url);\n                    setZoomImageLoaded(true);\n                });\n            }\n            if (zoomImageCacheKey !== \"\" && image.large_image_url !== zoomImageCacheKey) {\n                setZoomImageCacheKey(\"\");\n                setZoomImageLoaded(false);\n            }\n        }, [image.large_image_url, isZoomActive, zoomImageCacheKey]);\n\n        const handleMouseEvent = ({ pageX, pageY }) => {\n            if (!isMagnifyingGlassZoomable) {\n                return;\n            }\n            if (isZoomActive) {\n                const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                setZoomImageStyle(nextZoomImageStyle);\n            }\n        };\n\n        return (\n            <SwiperSlide\n                zoom={isMagnifyingGlassZoomable}\n                key={i}\n                className={classnames({\n                    \"video-slide\": isVideo,\n                    startZoom: isZoomActive,\n                    zoomShow: true,\n                    \"active-slide\": isActive,\n                    loading: thing.loading,\n                })}\n                onClick={({ pageX, pageY }) => {\n                    if (!isMagnifyingGlassZoomable) {\n                        return;\n                    }\n                    const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                    setZoomImageStyle(nextZoomImageStyle);\n\n                    setZoomActive(!isZoomActive);\n                    setSlideLocked(!isZoomActive);\n                }}\n                onMouseMove={handleMouseEvent}>\n                {isVideo ? (\n                    <Video\n                        object={image}\n                        display={true}\n                        playing={thumbnailIndex == i}\n                        lastFullyRenderedObjectID={thing.id}\n                        allow={{ fullScreen: true }}\n                    />\n                ) : (\n                    <>\n                        <img\n                            className=\"swiper-lazy\"\n                            src={image.image_url}\n                            data-src={image.image_url}\n                            title={!isTouchDevice ? \"Double click to zoom-in\" : undefined}\n                            alt={thing.name}\n                            style={{ cursor: \"zoom-in\" }}\n                        />\n                        <em\n                            className=\"zoomImage\"\n                            onClick={() => {\n                                setZoomActive(false);\n                                setSlideLocked(false);\n                            }}\n                            style={{\n                                ...getZoomImageStyle(image, isZoomActive, zoomImageStyle),\n                                backgroundColor: \"white\",\n                                backgroundImage: `url(${zoomImageLoaded ? image.large_image_url : image.image_url})`,\n                            }}\n                        />\n                        {isTouchDevice && <div className=\"swiper-lazy-preloader\" />}\n                    </>\n                )}\n            </SwiperSlide>\n        );\n    },\n    (prevProps: ImageSlideProps, nextProps: ImageSlideProps) => {\n        return prevProps.image.image_url === nextProps.image.image_url && prevProps.isActive === nextProps.isActive;\n    }\n);\nImageSlide.displayName = \"SwiperSlide\"; // This is important to make swiper to acknowledge it's actually slide, not some random components\n\nconst Image = () => {\n    const fancyProps = useFancy();\n    const {\n        thing,\n        saleContext,\n        slideContext: { thumbnailIndex },\n    } = fancyProps;\n    const swiperRef = useRef(null);\n    const swipeThumbsRef = useRef(null);\n    const [thumbIndex, setThumbIndex] = useState(0);\n    const [slideLocked, setSlideLocked] = useState(false);\n    const [swiper, setSwiper] = useState<null | SwiperClass>(null);\n    const option = getCurrentSaleOption(thing.sales, saleContext, true);\n    const images = getSaleImages(thing, option) as ThingImageOrVideo[];\n    const lastThumbIndex = images.length - PER_PAGE;\n\n    useEffect(() => {\n        if (!swiper) {\n            return;\n        }\n        if (thumbnailIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbnailIndex);\n        }\n        if (swipeThumbsRef.current) {\n            const thumbSwiper = swipeThumbsRef.current.swiper;\n            if (!thumbSwiper.slides[thumbnailIndex].classList.contains(\"swiper-slide-visible\"))\n                thumbSwiper.slideTo(Math.min(thumbnailIndex, lastThumbIndex));\n        }\n    }, [thumbnailIndex, swiper]);\n\n    useEffect(() => {\n        if (!swipeThumbsRef.current) {\n            return;\n        }\n        const swiper = swipeThumbsRef.current.swiper;\n        if (thumbIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbIndex);\n        }\n    }, [thumbIndex]);\n\n    return (\n        <div className=\"figure-section\">\n            <Swiper\n                ref={swiperRef}\n                onSlideChange={() => {\n                    if (swiper) {\n                        fancyProps.dispatch(setThumbnailIndex(swiper.activeIndex));\n                    }\n                }}\n                preloadImages={false}\n                lazy={{\n                    loadPrevNext: true,\n                    loadPrevNextAmount: 0,\n                }}\n                zoom={\n                    isTouchDevice\n                        ? {\n                              maxRatio: 2,\n                          }\n                        : undefined\n                }\n                allowSlidePrev={!slideLocked}\n                allowSlideNext={!slideLocked}\n                onZoomChange={(_, scale) => {\n                    if (scale > 1) {\n                        setSlideLocked(true);\n                    } else {\n                        setSlideLocked(false);\n                    }\n                }}\n                onSwiper={(swiper) => {\n                    setSwiper(swiper);\n                }}\n                className=\"gallery-top\">\n                {images.map((image, i) => {\n                    return (\n                        <ImageSlide\n                            key={i}\n                            image={image}\n                            i={i}\n                            setSlideLocked={setSlideLocked}\n                            isActive={swiper?.activeIndex === i}\n                        />\n                    );\n                })}\n                <ActionButtons />\n            </Swiper>\n            <div\n                className=\"prev\"\n                style={{ opacity: thumbIndex > 0 ? undefined : 0.3, display: lastThumbIndex <= 0 ? \"none\" : undefined }}\n                onClick={() => setThumbIndex(Math.max(0, thumbIndex - 5))}\n            />\n            <Swiper\n                className=\"gallery-thumbs\"\n                ref={swipeThumbsRef}\n                onSlideChange={() => {\n                    if (!swipeThumbsRef.current || slideLocked) {\n                        return;\n                    }\n                    setThumbIndex(swipeThumbsRef.current.swiper.activeIndex);\n                }}\n                onClick={() => {\n                    if (!swipeThumbsRef.current) {\n                        return;\n                    }\n                    fancyProps.dispatch(setThumbnailIndex(swipeThumbsRef.current.swiper.clickedIndex));\n                }}\n                direction=\"vertical\"\n                spaceBetween={16}\n                slidesPerView={PER_PAGE}\n                watchSlidesVisibility={true}\n                height={HEIGHT}>\n                {images.map((image, i) => {\n                    return (\n                        <SwiperSlide\n                            key={i}\n                            className={classnames({\n                                \"video-thumbnail\": image.h264_1000k_url,\n                                selected: i == thumbnailIndex,\n                            })}>\n                            <img\n                                height=\"80\"\n                                src={placeholderImage}\n                                style={{ backgroundImage: `url(${image.thumbnail_url})` }}\n                            />\n                        </SwiperSlide>\n                    );\n                })}\n            </Swiper>\n            <div\n                className=\"next\"\n                style={{\n                    opacity: thumbIndex < lastThumbIndex ? undefined : 0.3,\n                    display: lastThumbIndex <= 0 ? \"none\" : undefined,\n                }}\n                onClick={() => {\n                    setThumbIndex(Math.min(thumbIndex + 5, lastThumbIndex));\n                }}\n            />\n        </div>\n    );\n};\n\nexport default Image;\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { getCurrentSaleOption, getThingName } from \"../../map\";\nimport { addItemToCart, logAddCartMixpanel } from \"../../map.cart\";\n\n// Generic purchase handler, needs to be bound to insatnce on initialization.\n/*\n    data-sii={sales.id}\n    data-sisi={sales.seller_id}\n    data-tid={thing.id}\n*/\nexport function handlePurchase(event) {\n    event.preventDefault();\n    const {\n        thing,\n        thing: { sales },\n        saleContext,\n    } = this.props;\n    const saleOption = getCurrentSaleOption(sales, saleContext, true);\n    const soldout = saleOption == null ? sales.soldout : saleOption.soldout;\n    if (soldout || this.state.loading) {\n        return;\n    }\n    const saleOptionID = saleOption != null ? saleOption.id : null;\n\n    this.setState({ loading: true }, () => {\n        const payload = { \n            sale_id: sales.id,\n            quantity: saleContext.selectedQuantity,\n            personalization: saleContext.personalization,\n        }\n        if (saleOptionID != null) {\n            payload.option_id = saleOptionID;\n        }\n        Fancy.CartAPI.addItem(payload, (success, json) => {\n            if (success) {\n                Fancy.Cart.openPopup();\n            } else {\n                alertify.alert((json && json.error) || \"Failed to add the item to cart. Please contact us at cs@fancy.com if the problem persists.\");\n            }\n            this.setState({ loading: false });\n        })\n    });\n}\n\nconst SaleOptions = ({\n    options = [\"1\"],\n    currentValue = \"1\",\n    id = \"\",\n    value = (v) => v,\n    expander,\n    defaultValue,\n    printer,\n    disabled,\n    onChange,\n    onClick,\n    onFocus,\n    unselectedLabel,\n}) => {\n    expander =\n        expander ||\n        ((option, idx) => (\n            <option key={`sale_options-${idx}`} value={value(option)}>\n                {printer(option)}\n            </option>\n        ));\n\n    return (\n        <select\n            id={id}\n            className={classnames(\"select-boxes2\", { \"one-option\": options.length <= 1 })}\n            value={value(currentValue) || defaultValue}\n            disabled={disabled}\n            onChange={onChange}\n            onClick={onClick}\n            onFocus={onFocus}>\n            {unselectedLabel && <option value=\"\">{unselectedLabel}</option>}\n            {options.map(expander)}\n        </select>\n    );\n};\n\nexport const CartButton = (props) => (\n    <button {...props} label={null}>\n        {props.label}\n    </button>\n);\n\nexport const SelectBox = (props) => {\n    let {\n        className,\n        disabled,\n        label,\n        currentValue,\n        defaultValue,\n        id,\n        printer,\n        tabIndex,\n        unselectedLabel,\n        options = [\"1\"],\n        SizeGuide,\n    } = props;\n\n    printer = printer != null ? printer : (s) => s;\n    defaultValue = defaultValue != null ? defaultValue : \"1\";\n    className = className != null ? className : null;\n\n    var labelValue;\n    if (unselectedLabel != null && currentValue === \"\") {\n        labelValue = unselectedLabel;\n    } else {\n        labelValue = printer(currentValue != null ? currentValue : defaultValue);\n    }\n\n    return (\n        <div className={className}>\n            <label>{label}</label>\n            <span className={`trick-select ${id}`}>\n                <a\n                    className={classnames(\"selectBox\", { disabled, \"one-option\": options.length <= 1 })}\n                    tabIndex={tabIndex || \"1\"}>\n                    <span className=\"selectBox-label\">{labelValue}</span>\n                    <span className=\"selectBox-arrow\" />\n                </a>\n                <SaleOptions {...props} printer={printer} defaultValue={defaultValue} />\n            </span>\n            { SizeGuide && <SizeGuide key=\"size-guide\" /> }\n        </div>\n    );\n};\n\nexport class MultiOptionState {\n    constructor(options, option_meta) {\n        this.options = options;\n        this.option_meta = option_meta;\n        const orderMap = {};\n        option_meta.forEach((m) => {\n            if (orderMap[m.type] == null) {\n                orderMap[m.type] = { length: 1 };\n                orderMap[m.type][m.name] = 0;\n            } else {\n                orderMap[m.type][m.name] = orderMap[m.type].length;\n                orderMap[m.type].length += 1;\n            }\n        });\n        this.orderMap = orderMap;\n    }\n    // i.e.) getPossibleValues(['a', '1', '가'], 1) => ['1', '3', '6']\n    // output: get possible options for 2nd option dependent on ('a' / 1st option)\n    getPossibleValuesForIndex(selected, targetIndex) {\n        const { options, option_meta, orderMap } = this;\n        if (targetIndex === 0) {\n            return option_meta[0].values;\n        }\n        let filteredOptions = options;\n        option_meta\n            .map((m) => {\n                const order = orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            })\n            .forEach((sel, idx) => {\n                if (idx < targetIndex) {\n                    filteredOptions = filteredOptions.filter((option) => option.values[idx] === sel);\n                }\n            });\n        return _.uniq(filteredOptions.map((o) => o.values[targetIndex])); // FIXME\n    }\n\n    getMultiOptions(selected) {\n        return this.option_meta.map((meta, idx) => {\n            return [meta, this.getPossibleValuesForIndex(selected, idx)];\n        });\n        /*\n        returns [\n            [type, ['a', 'b', 'c']],\n            [type, ['1', '2']],\n            [tyep, ['red', 'white', 'black']]\n        ]\n        */\n    }\n}\n\nexport const MultiOption = (props) => {\n    const { selected, multiOptionState, sid, SizeGuide } = props;\n    if (multiOptionState == null) {\n        return null;\n    }\n    const multiOptions = multiOptionState.getMultiOptions(selected);\n    var sizeGuidePos = -1;\n    if (SizeGuide) {\n        multiOptions.map(([meta, values], idx) => {\n            if (meta.name && meta.name.trim().toLowerCase() === \"size\") sizeGuidePos = idx;\n        });\n        if (sizeGuidePos < 0) sizeGuidePos = multiOptions.length - 1;\n    }\n    return multiOptions.map(([meta, values], idx) => {\n        const { type, name } = meta;\n\n        const indexTypeOf = multiOptionState.orderMap[type] && multiOptionState.orderMap[type][name];\n        const additional = {\n            name,\n            values,\n            indexTypeOf,\n            selectedArray: selected && selected[type],\n            selectedValue: selected && selected[type] && selected[type][indexTypeOf],\n            key: `${sid}-${idx}`,\n            showSizeGuide: idx == sizeGuidePos,\n        };\n        if (type === \"dropdown\") {\n            return <MultiSelectBox {...props} {...additional} />;\n        } else if (type === \"swatch\") {\n            additional.swatch = meta.swatch;\n            return <MultiSwatch {...props} {...additional} />;\n        } else if (type === \"thumbnail\") {\n            additional.thumbnail = meta.thumbnail;\n            return <MultiThumbnail {...props} {...additional} />;\n        } else if (type === \"button\") {\n            return <MultiButton {...props} {...additional} />;\n        }\n    });\n};\n\nexport const MultiSelectBox = (props) => {\n    const { values, name, onMultiSelectBoxChange, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option\">\n            <label>{name}</label>\n            <select\n                onChange={onMultiSelectBoxChange}\n                selected={selectedValue}\n                className={values.length <= 1 ? \"one-option\" : undefined}>\n                {values.map((value, i) => {\n                    return <MultiSelectBoxOption key={i} value={value} indexTypeOf={indexTypeOf} />;\n                })}\n            </select>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSelectBoxOption = (props) => {\n    const { value, indexTypeOf } = props;\n    return (\n        <option data-value={value} data-index-typeof={indexTypeOf} value={value}>\n            {value}\n        </option>\n    );\n};\n\nexport const MultiSwatch = (props) => {\n    const { name, values, swatch, indexTypeOf, selectedValue, onClickSwatch, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option swatch\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiSwatchOption\n                            key={i}\n                            value={value}\n                            swatch={swatch}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            onClick={onClickSwatch}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSwatchOption = (props) => {\n    const { value, swatch, indexTypeOf, selectedValue, onClick } = props;\n    return (\n        <a\n            href=\"#\"\n            style={{ backgroundColor: swatch[value] }}\n            onClick={onClick}\n            data-value={value}\n            data-label={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}\n        />\n    );\n};\n\nexport const MultiThumbnail = (props) => {\n    const { values, name, thumbnail, onClickThumbnail, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n\n    return (\n        <div className=\"multi-option thumbnail\">\n            <label>{name}</label>\n            <span className=\"value\">{selectedValue}</span>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiThumbnailOption\n                            key={i}\n                            onClick={onClickThumbnail}\n                            value={value}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            thumbnail={thumbnail}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiThumbnailOption = ({ onClick, value, indexTypeOf, selectedValue, thumbnail }) => {\n    return (\n        <a\n            href=\"#\"\n            onClick={onClick}\n            data-value={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}>\n            <img\n                src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage: `url(\"${thumbnail[value]}\")`, backgroundSize: \"cover\" }}\n                alt={value}\n            />\n        </a>\n    );\n};\n\nexport const MultiButton = (props) => {\n    const { values, name, onClickMutliButton, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option button\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiButtonOption key={i}\n                            onClick={onClickMutliButton}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            value={value}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiButtonOption = (props) => {\n    const { value, onClick, indexTypeOf, selectedValue } = props;\n    return (\n        <button\n            onClick={onClick}\n            className={selectedValue === value ? \"selected\" : \"\"}\n            data-value={value}\n            data-index-typeof={indexTypeOf}>\n            {value}\n        </button>\n    );\n};\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { floatFormatMinusTwo, numberFormat, renderPopup, escapeSelector, getLocationArgPairs } from \"fancyutils\";\n\nimport appState from \"../../../appstate\";\nimport { convertCurrency, updateSaleContext } from \"../../../action/action-helpers\";\nimport { updateAppContext } from \"../../../action/actions\";\nimport { currencyIsUSD, getCurrentSaleOption, getSafeNameProp, getWaiting, isSalesOptionsAvailable } from \"../../map\";\nimport { Keys } from \"../../Perf\";\nimport { CartButton, SelectBox, handlePurchase, MultiOption, MultiOptionState } from \"./SaleItemForm\";\nimport { OverlayProps, ReduxProps, SaleOption, SelectedMetaOption, SaleOptionMeta } from \"ftypes\";\n\nfunction optionValueFunction(opt) {\n    return opt.id;\n}\nconst saleNamePrinter = (opt) => `${opt.name} - $${opt.price}`;\n\nexport default class SaleItemSidebarHead extends Component<\n    OverlayProps & ReduxProps,\n    {\n        loading: boolean;\n        selected: null | {} | SelectedMetaOption;\n        disabled: Array<any>;\n        multiOptionState: null | MultiOptionState;\n    }\n> {\n    state = {\n        loading: false,\n        selected: {},\n        disabled: [],\n        multiOptionState: null,\n    };\n\n    handlePurchase = null;\n\n    constructor(props: OverlayProps & ReduxProps) {\n        super(props);\n        this.handlePurchase = handlePurchase.bind(this);\n        // for multi options\n        this.onClickThumbnail = this.onClickMultiOptionGen(\"thumbnail\");\n        this.onClickSwatch = this.onClickMultiOptionGen(\"swatch\");\n        this.onMultiSelectBoxChange = this.onClickMultiOptionGen(\"dropdown\");\n        this.onClickMutliButton = this.onClickMultiOptionGen(\"button\");\n    }\n\n    renderCurrencyPopup = () => {\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\").then(({ CurrencyPopup }) => {\n            renderPopup(CurrencyPopup, { currentCurrency: this.props.saleContext.currencyCode });\n        });\n    };\n\n    handleCurrencyPopup = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        this.renderCurrencyPopup();\n    };\n\n    handleCurrencyPopupUSD = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        if (!currencyIsUSD(this.props)) {\n            return false;\n        }\n        this.renderCurrencyPopup();\n    };\n\n    getApproxText = () => {\n        var { currencySymbol, currencyMoney } = this.props.saleContext;\n        var approxText = gettext(\"Approximately\");\n        return `${approxText} ${currencySymbol}${currencyMoney} `;\n    };\n\n    handleOptionChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const saleOptionID = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    handleQuantityChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const selectedQuantity = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ selectedQuantity }));\n    };\n\n    handlePersonalizationChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const personalization = event.currentTarget.value;\n        dispatch(updateSaleContext({ personalization }));\n    };\n\n    handleNotifyLater = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!appState.loggedIn) {\n            return window.require_login();\n        }\n        const {\n            thing: { sales },\n            saleContext,\n        } = this.props;\n        const opt = getCurrentSaleOption(sales, saleContext, true);\n        const params = { sale_item_id: sales.id };\n\n        if (opt != null) {\n            params.option_id = opt.id;\n        }\n\n        const waiting = getWaiting(sales, saleContext);\n        if (waiting) {\n            params.remove = 1;\n        }\n\n        $.ajax({\n            type: \"post\",\n            url: \"/wait_for_product.json\",\n            data: params,\n            dataType: \"json\",\n        }).done((json) => {\n            if (!json || json.status_code == null) {\n                return;\n            }\n            if (json.status_code == 0 && json.message) {\n                alertify.alert(json.message);\n                return;\n            }\n            const waiting = params.remove ? false : true;\n            this.props.dispatch(updateSaleContext({ waiting }));\n        });\n    };\n\n    checkApplePay = () => {\n        if (window.FancyApplePay) {\n            const { dispatch, thing, thing: { sales } } = this.props;\n            const os = sales.options.filter((o) => !o.soldout);\n            const data = {\n                total: { label: thing.name, amount: (sales.price * 100) | 0 },\n            };\n\n            if (os.length > 0) {\n                data.displayItems = os.map((o) => ({\n                    label: o.name,\n                    amount: (Number(o.price) * 100) | 0,\n                }));\n            }\n\n            window.FancyApplePay.checkAvailability((available, testmode) => {\n                if (available) {\n                    dispatch(\n                        updateAppContext({\n                            applePayDisplay: true,\n                            applePayTest: testmode,\n                        })\n                    );\n                }\n            }, data);\n        }\n    };\n\n    componentDidMount() {\n        if (!currencyIsUSD(this.props)) {\n            const { saleContext } = this.props;\n            convertCurrency(saleContext.currencyCode, saleContext.price);\n        }\n        this.initializeMultiOption();\n        this.checkApplePay();\n    }\n\n    componentDidUpdate(prevProps: OverlayProps) {\n        if (prevProps.thing.id !== this.props.thing.id) {\n            this.initializeMultiOption();\n            this.checkApplePay();\n            return;\n        }\n\n        const {\n            saleContext,\n            thing: { sales },\n        } = prevProps;\n\n        const nsc = this.props.saleContext;\n        const nextSaleOptionID = nsc.saleOptionID;\n        if (saleContext.saleOptionID !== nextSaleOptionID) {\n            const o = _.find(sales.options, (_o) => _o.id === nextSaleOptionID);\n            // option sync\n            if (o) {\n                const mos = $(\".sale-item-input .multi-option\");\n                o.values.forEach((v, i) => {\n                    const $so = mos\n                        .eq(i)\n                        .find(`[data-value=\"${escapeSelector(v)}\"]:not(.selected)`)\n                        .eq(0);\n                    if ($so.length) {\n                        if ($so.is(\"option\")) \n                            $so.prop(\"selected\", true);\n                        else\n                            $so.get(0).click();\n                    }\n                });\n                if (window.FancyApplePay && window.FancyApplePay.paymentRequest) {\n                    window.FancyApplePay.paymentRequest.update({\n                        total: {\n                            label: o.name,\n                            amount: (Number(o.price) * 100) | 0,\n                        },\n                    });\n                }\n            }\n        }\n    }\n\n    initializeMultiOption = () => {\n        const {\n            thing: {\n                sales: { options, option_meta },\n            },\n            saleContext,\n            dispatch,\n        } = this.props;\n\n        this.setState(this.getInitialMultiOptionState(options, option_meta), () => {\n            // don't block selecting cheapest item\n            if (!(options && options.length > 1)) {\n                this.updateSaleOptionIDFromMultiOptionState();\n            }\n            // ?option={number} support\n            const presetOptionId = getLocationArgPairs(\"option\");\n            if (presetOptionId && presetOptionId[1] && String(saleContext.saleOptionID) !== presetOptionId[1]) {\n                dispatch(updateSaleContext({ saleOptionID: parseInt(presetOptionId[1], 10) }));\n            }\n        });\n    };\n\n    getInitialMultiOptionState(options: SaleOption[], option_meta: SaleOptionMeta[]) {\n        const selected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        if (option_meta.length > 0) {\n            const nonSoldout = options.filter((o) => o.quantity !== 0);\n            if (nonSoldout.length !== 0) {\n                const selectedNonSoldoutOption = nonSoldout[0]; // temporary - FIXME\n                option_meta.forEach(function (opt, i) {\n                    const { type } = opt;\n                    const nextValue = selectedNonSoldoutOption.values[i];\n                    selected[type].push(nextValue);\n                });\n            } else {\n                // set first available multi option\n                option_meta.forEach(function (opt) {\n                    const { type } = opt;\n                    const nextValue = opt.values[0];\n                    selected[type].push(nextValue);\n                });\n            }\n        }\n        const multiOptionState = new MultiOptionState(options, option_meta);\n        return { selected, multiOptionState };\n    }\n\n    extractSaleOptionIDFromMultiOptionState = (selected?: SelectedMetaOption) => {\n        const {\n            thing: { sales },\n        } = this.props;\n        if (selected == null) {\n            selected = this.state.selected;\n        }\n        const { multiOptionState } = this.state;\n\n        const selectedOptionArray = multiOptionState.option_meta\n            .map((m) => {\n                const order = multiOptionState.orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            });\n        const selectedOption = _.find(sales.options, (opt) => selectedOptionArray.every((e, i) => e === opt.values[i]));\n        if (selectedOption) {\n            return selectedOption.id;\n        } else {\n            window.DEBUG &&\n                console.warn(\"no option found for \", selectedOptionArray, \"meta:\", sales.options, this.state.selected);\n        }\n    };\n\n    updateSaleOptionIDFromMultiOptionState = () => {\n        const { dispatch } = this.props;\n        let saleOptionID = this.extractSaleOptionIDFromMultiOptionState();\n        if (saleOptionID === undefined) {\n            const amendedID = this.amendSaleOptionFromMultiOptionState();\n            if (amendedID) {\n                saleOptionID = amendedID;\n            } else {\n                window.DEBUG && console.warn(\"Couldn't recover option\");\n            }\n        }\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    amendSaleOptionFromMultiOptionState = () => {\n        const { selected, multiOptionState } = this.state;\n        const nextSelected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        multiOptionState.option_meta.forEach(({ type, name }, index) => {\n            const order = multiOptionState.orderMap[type][name];\n            const selectedValue = selected[type][order];\n            if (index === 0) {\n                nextSelected[type][order] = selectedValue;\n                return;\n            }\n            const values = multiOptionState.getPossibleValuesForIndex(selected, index);\n            let value;\n            if (values.some((v) => v === selectedValue)) {\n                value = selectedValue;\n            } else {\n                value = values[0];\n            }\n            selected[type][order] = value; // even though it will be flushed out, it will affect next options so fix it as well\n            nextSelected[type][order] = value;\n        });\n        this.setState({ selected: nextSelected });\n        return this.extractSaleOptionIDFromMultiOptionState(nextSelected);\n    };\n\n    onClickMultiOptionGen = (type) => {\n        return (e) => {\n            const el = e.currentTarget;\n            let value;\n            let indexOfType;\n            if (el.tagName === \"SELECT\") {\n                value = el.value;\n                indexOfType = Number($(el).find(\":selected\").attr(\"data-index-typeof\"));\n            } else {\n                value = $(el).attr(\"data-value\");\n                indexOfType = Number($(el).attr(\"data-index-typeof\"));\n            }\n            if (e.currentTarget.className === \"disabled\") {\n                return;\n            }\n\n            this.state.selected[type][indexOfType] = value;\n            // forceful trigger even though no differences in value.\n            this.setState({ selected: _.extend({}, this.state.selected) }, this.updateSaleOptionIDFromMultiOptionState);\n        };\n    };\n\n    UNSAFE_componentWillReceiveProps(nextProps) {\n        const { saleContext } = this.props;\n        const nsc = nextProps.saleContext;\n        const priceChanges = saleContext.price !== nsc.price;\n        const currencyChanges = saleContext.currencyCode !== nsc.currencyCode;\n        if (priceChanges || currencyChanges) {\n            if (!currencyIsUSD(nextProps)) {\n                const { saleContext } = nextProps;\n                convertCurrency(saleContext.currencyCode, saleContext.price, true); // FIXME: unable to comparison since price update comes first (SaleItemSidebarHead.componentWillReceiveProps())\n            }\n        }\n    }\n\n    isOptionMulti(): boolean {\n        const {\n            thing: { sales },\n        } = this.props;\n        // sales.\n        if (sales.option_meta.length > 1) {\n            return true;\n        } else if (sales.option_meta.length === 1) {\n            return sales.option_meta[0].type !== \"dropdown\";\n        } else {\n            return false;\n        }\n    }\n\n    render() {\n        const {\n            thing,\n            thing: { sales },\n            appContext: { applePayDisplay },\n            saleContext,\n            saleContext: { currencyCode, currencySymbol, currencyMoney, selectedQuantity, price },\n        } = this.props;\n\n        var opt = getCurrentSaleOption(sales, saleContext) as SaleOption;\n        var discountPercentage = parseFloat(opt.discount_percentage); // TODO: use decimal?\n        var retailPrice = opt.retail_price;\n        const { soldout, quantity } = opt;\n        const { option_meta, available } = sales;\n        const optionIsMulti = this.isOptionMulti();\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n        const discounting = discountPercentage > 0;\n        const converted = currencySymbol != null && currencyMoney != null;\n        const currencyCodeStyle = { display: converted && !currencyIsUSD(this.props) ? \"block\" : \"none\" };\n        const quantitySelectRange = soldout\n            ? [\"1\"]\n            : _.range(1, Math.min(10, (quantity || 0) + 1));\n        const showSelectbox = sales.options.length !== 0;\n\n        var cartButtonStyle;\n        if (!soldout) {\n            cartButtonStyle = { display: \"none\" };\n        }\n        const waiting = getWaiting(sales, saleContext);\n\n        var applePayButton;\n        if (applePayDisplay && !soldout) {\n            applePayButton = <ApplePayButton {...this.props} />;\n        }\n\n        return (\n            <>\n                <h1 key={Keys.Sidebar.Title} className=\"title\" {...getSafeNameProp(thing)} />\n                <div className=\"price\" key={Keys.Sidebar.Price}>\n                    <big className={classnames({ sale: discounting })}>\n                        ${floatFormatMinusTwo(price)}\n                        {/* <small className=\"usd\">\n                            <a\n                                className={classnames(\"code\", { \"currently-usd\": currencyIsUSD(this.props) })}\n                                onClick={this.handleCurrencyPopupUSD}>\n                                USD\n                            </a>\n                        </small> */}\n                    </big>\n                    {discounting && (\n                        <span className=\"sales\">\n                            <em>${floatFormatMinusTwo(retailPrice)}</em> (Save {numberFormat(discountPercentage, 0)}\n                            %)\n                        </span>\n                    )}\n                    <span className=\"currency_price\" style={currencyCodeStyle}>\n                        {this.getApproxText()}\n                        <a className=\"code\" onClick={this.handleCurrencyPopup}>\n                            {currencyCode}\n                        </a>\n                    </span>\n                </div>\n                <div className=\"frm\" key={Keys.Sidebar.Form}>\n                    <fieldset className=\"sale-item-input\">\n                        {showSelectbox && !optionIsMulti && (\n                            <SelectBox\n                                className=\"multi-option\"\n                                id=\"option\"\n                                label={gettext(\"Option\")}\n                                currentValue={opt}\n                                value={optionValueFunction}\n                                printer={saleNamePrinter}\n                                options={sales.options}\n                                expander={SaleItemOptionsExpander}\n                                disabled={!salesOptionsAvailable}\n                                onChange={this.handleOptionChange}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                            />\n                        )}\n                        {optionIsMulti && (\n                            <MultiOption\n                                sid={sales.id}\n                                onClickThumbnail={this.onClickThumbnail}\n                                onClickSwatch={this.onClickSwatch}\n                                onMultiSelectBoxChange={this.onMultiSelectBoxChange}\n                                onClickMutliButton={this.onClickMutliButton}\n                                selected={this.state.selected}\n                                disabled={this.state.disabled}\n                                soldout={!!soldout}\n                                option_meta={option_meta}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                                multiOptionState={this.state.multiOptionState}\n                            />\n                        )}\n                        {sales.personalizable && (\n                            <div className=\"personalization\">\n                                <label>This item can be personalized:</label>\n                                <input\n                                    type=\"text\"\n                                    className=\"text\"\n                                    name=\"personalization\"\n                                    placeholder=\"Personalization details\"\n                                    onChange={this.handlePersonalizationChange}\n                                />\n                            </div>\n                        )}\n                        {\n                            <SelectBox\n                                id=\"quantity\"\n                                className=\"multi-option\"\n                                label={gettext(\"Quantity\")}\n                                defaultValue=\"1\"\n                                currentValue={selectedQuantity}\n                                options={quantitySelectRange}\n                                disabled={!!soldout}\n                                onChange={this.handleQuantityChange}\n                            />\n                        }\n                        {applePayButton}\n                        {available ? (\n                            <>\n                                <CartButton\n                                    onClick={this.handlePurchase}\n                                    className={classnames(\"add_to_cart btn-cart\", {\n                                        \"btn-create\": soldout,\n                                        \"btns-blue-embo\": !soldout,\n                                    })}\n                                    disabled={!!soldout}\n                                    label={soldout ? gettext(\"Sold out\") : gettext(\"Add to cart\")}\n                                />\n                                <CartButton\n                                    className={classnames(\"btn-create notify-available\", { subscribed: waiting })}\n                                    label={waiting ? gettext(\"Subscribed\") : gettext(\"Notify me when available\")}\n                                    style={cartButtonStyle}\n                                    onClick={this.handleNotifyLater}\n                                />\n                            </>\n                        ) : (\n                            <CartButton\n                                className={classnames(\"btn-create not-available\")}\n                                label={gettext(\"Not Available\")}\n                                disabled={true}\n                            />\n                        )}\n                    </fieldset>\n                </div>\n            </>\n        );\n    }\n}\n\nfunction SaleItemOptionsExpander(sio, idx) {\n    return (\n        <option value={sio.id} key={`sale_options-${idx}`}>\n            {sio.soldout === true || !(sio.quantity > 0) ? `${sio.name} - ${gettext(\"Sold out\")}` : sio.name}\n        </option>\n    );\n}\n\nclass ApplePayButton extends Component<OverlayProps> {\n    handleApplePayCheckout = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (window.FancyApplePay.clicked) {\n            return;\n        }\n        window.FancyApplePay.clicked = true;\n        const {\n            appContext: { /*applePayDisplay, */ applePayTest },\n        } = this.props;\n        const {\n            thing,\n            thing: { sales },\n            saleContext: { saleOptionID, selectedQuantity, price },\n        } = this.props;\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n\n        var title = thing.name;\n        var country = sales.seller.country;\n        var sale_item_id = sales.id;\n        var seller_id = sales.seller.id;\n        var quantity = selectedQuantity;\n\n        var option_id = null;\n        var option = null;\n        if (salesOptionsAvailable) {\n            option_id = parseInt(saleOptionID, 10) || null; // ? should be same value with option except get casted\n            option = saleOptionID;\n        }\n\n        try {\n            window.FancyApplePay.requestPurchase(\"Dynamic\", {\n                sale_item_id,\n                seller_id,\n                option_id,\n                quantity,\n                price,\n                title,\n                option,\n                country,\n                testmode: applePayTest,\n            });\n        } catch (err) {\n            window.DEBUG && console.trace(err);\n            alert(err);\n            window.FancyApplePay.clicked = false;\n        }\n    };\n\n    render() {\n        return (\n            <div\n                className=\"applePayButton\"\n                style={{\n                    WebkitAppearance: \"-apple-pay-button\",\n                    ApplePayButtonType: \"plain\",\n                    ApplePayButtonStyle: \"black\",\n                }}\n                onClick={this.handleApplePayCheckout}></div>\n        );\n    }\n}\n","import React from \"react\";\nimport SaleItem from \"./SaleItem\";\n\nimport { useFancy } from \"../FancyContext\";\n\nconst Info = () => {\n    const fancyProps = useFancy();\n    const { thing: { reviews, sales }, fancyContext } = fancyProps;\n    const r = reviews.summary;\n\n    return (\n        <div className=\"figure-info\">\n            <div className=\"vendor\"><a href={sales.seller.shop_url}>{sales.seller.brand_name}</a></div>\n            {r.total_ratings > 0 && (\n                <div className=\"review-points\">\n                    <span style={{ cursor: r.total_reviews > 0 ? \"pointer\" : undefined }} onClick={() => {\n                        if (r.total_reviews > 0) {\n                            const $el = $(\".review-section\");\n                            const headerSize = parseInt($(\".container\").css(\"padding-top\")) || 0;\n                            if ($el.length) {\n                                $(window).scrollTop($el[0].offsetTop - headerSize);\n                            }\n                        }\n                    }}>\n                        {r.rating_avg} <small className=\"count\">({r.total_ratings} rating{r.total_ratings != 1 ? 's' : ''})</small>{\" \"}\n                    </span>\n                </div>\n            )}\n            <SaleItem {...fancyProps} />\n        </div>\n    );\n};\n\nexport default Info;\n","import React, { useEffect, useState, useRef } from \"react\";\nimport cx from \"classnames\";\n\nimport { useFancy } from \"../FancyContext\";\n\nconst Overview = () => {\n    const { thing } = useFancy();\n    const sales = thing.sales;\n    const bv = sales.seller.brand_values;\n    const shippingInfo: { [k: string]: any } = sales.shipping_info || {};\n\n    return (\n        <div className=\"overview\">\n            <dl className=\"shipping optional\">\n                <dt>Shipping Information</dt>\n                <dd>\n                    <ul>\n                        <li className=\"from\">\n                            <span>{shippingInfo.origin}</span>\n                        </li>\n                        {shippingInfo.cost && (\n                            <li className=\"cost\">\n                                <span>{shippingInfo.cost}</span>\n                            </li>\n                        )}\n                        {shippingInfo.window && (\n                            <li className=\"days\">\n                                <span>{shippingInfo.window}</span>\n                            </li>\n                        )}\n                    </ul>\n                </dd>\n            </dl>\n            {bv.length > 0 ? (\n                <dl className=\"brand-value optional\">\n                    <dt>Buy with Confidence</dt>\n                    <dd>\n                        {bv.slice(0,3).map(([className, text]) => (\n                            <span key={className} className={`badge ${className}`}>{text}</span>\n                        ))}\n                    </dd>\n                </dl>\n            ) : null}\n        </div>\n    );\n};\n\nconst Description = () => {\n    const [menu, setMenu] = useState<\"features\" | \"specification\" | \"returns\">(\"features\");\n    const [showMore, setShowMore] = useState(false);\n    const descEl = useRef<HTMLDivElement>(null);\n    const props = useFancy();\n    const { thing, thing: { sales } } = props;\n    const showFeatures = !!(sales.features && sales.features.trim());\n    const showSpecs = !!(sales.specifications && sales.specifications.trim());\n    const showReturns =\n        !!(sales.return_exchange_policy_title && sales.return_exchange_policy_title.trim()) ||\n        !!(sales.shipping_policy && sales.shipping_policy.trim());\n    \n    useEffect(() => {\n        if (showFeatures) {\n            setMenu('features');\n        } else if (showSpecs) {\n            setMenu('specification');\n        } else if (showReturns) {\n            setMenu('returns');\n        }\n        setShowMore(descEl.current ? descEl.current.clientHeight <= 76 : false);\n    }, [thing.id]);\n\n    return (\n        <div className=\"detail\">\n            <dl className={cx(\"description optional\")}>\n                <dt>Description</dt>                \n                <dd className={cx({ collapsed: !showMore })}>\n                    <div dangerouslySetInnerHTML={{ __html: sales.description }} ref={descEl}/>\n                </dd> \n                <a className=\"more\" onClick={() => setShowMore(true)} style={{display: showMore ? 'none' : undefined }}>Read more</a>\n            </dl>\n            <div className=\"features-menu\">\n                {showFeatures && (\n                    <a\n                        className={cx({ current: menu === \"features\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"features\");\n                        }}>\n                        Features\n                    </a>\n                )}\n                {showSpecs && (\n                    <a\n                        className={cx({ current: menu === \"specification\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"specification\");\n                        }}>\n                        Specifications\n                    </a>\n                )}\n                {showReturns && (\n                    <a\n                        className={cx({ current: menu === \"returns\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"returns\");\n                        }}>\n                        Returns\n                    </a>\n                )}\n            </div>\n            {showFeatures && (\n                <dl className={cx(\"features optional\", { show: menu === \"features\" })} data-featuretype=\"features\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"features\");\n                            }}>\n                            Features\n                        </a>\n                    </dt>\n                    <dd dangerouslySetInnerHTML={{ __html: sales.features }} />\n                </dl>\n            )}\n            {showSpecs && (\n                <dl\n                    className={cx(\"features optional\", { show: menu === \"specification\" })}\n                    data-featuretype=\"specifications\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"specification\");\n                            }}>\n                            Specifications\n                        </a>\n                    </dt>\n                    <dt></dt>\n                    <dd dangerouslySetInnerHTML={{ __html: sales.specifications }} />\n                </dl>\n            )}\n            {showReturns && (\n                <dl className={cx(\"features optional\", { show: menu === \"returns\" })} data-featuretype=\"returns\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"returns\");\n                            }}>\n                            Returns\n                        </a>\n                    </dt>\n                    <dd><p>{sales.return_exchange_policy_title}</p><p>{sales.shipping_policy}</p></dd>\n                </dl>\n            )}\n        </div>\n    );\n};\n\nconst Detail = () => {\n    return (\n        <div className=\"figure-detail\">\n            <Overview />\n            <Description />\n        </div>\n    );\n};\n\nexport default Detail;\n","import React from \"react\";\n\nimport Image from \"./Image\";\nimport Info from \"./Info\";\nimport Detail from \"./Detail\";\n\nconst Thing = () => {\n    return (\n        <div className=\"wrapper-content\">\n            <Image />\n            <Info />\n            <Detail />\n        </div>\n    );\n};\n\nexport default Thing;\n","import React from \"react\";\nimport { numberFormat } from \"fancyutils\";\n\nexport interface ThingCardProps {\n    brand_name: string;\n    title: string;\n    html_url: string;\n    image_url: string;\n    max_price: number;\n    min_price: number;\n}\n\nexport default function ThingCard({ brand_name, title, html_url, image_url, max_price, min_price }: ThingCardProps) {\n    let p = <>${numberFormat(min_price, 0)}</>;\n    if (max_price !== min_price) {\n        p = (\n            <>\n                <em className=\"from\">from </em> ${numberFormat(min_price, 0)}\n            </>\n        );\n    }\n\n    return (\n        <div className=\"figure-item new\">\n            <figure>\n                <a href={html_url}>\n                    <span className=\"figure\" style={{ backgroundImage: `url(${image_url})` }}>\n                        <img\n                            src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n                            style={{ backgroundImage: `url(${image_url})` }}\n                        />\n                    </span>\n                </a>\n            </figure>\n            <figcaption>\n                <a href={html_url}>\n                    <span className=\"category\">{brand_name}</span>\n                    <b className=\"title\">{title}</b>\n                    <span className=\"price\">{p}</span>\n                </a>\n            </figcaption>\n        </div>\n    );\n}\n","import React, { useState, useRef, useEffect } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\n\nimport ThingCard from \"./ThingCard\";\nimport { useFancy } from \"./FancyContext\";\n\nconst MerchantInfo = () => {\n    const {\n        thing,\n        thing: {\n            sales: { seller },\n        },\n    } = useFancy();\n    const [showMore, setShowMore] = useState(false);\n    const descEl = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        setShowMore(descEl.current ? descEl.current.clientHeight <= 80 : false);\n    }, [thing.id]);\n\n    return (\n        <div className=\"merchant-info\">\n            <h2 className=\"stit\">More about {seller.brand_name}</h2>\n            <div className={classnames(\"description\", { collapsed: !showMore })}>\n                <div dangerouslySetInnerHTML={{ __html: seller.description }} ref={descEl} />\n            </div>\n            <a className=\"more\" style={{ display: showMore ? \"none\" : undefined }} onClick={() => setShowMore(true)}>\n                Read more\n            </a>\n            <a className=\"btns-blue-embo\" href={seller.shop_url}>\n                Explore more\n            </a>\n            <Swiper className=\"swiper-no-swiping\">\n                {seller.sale_items.map((item, i) => {\n                    return (\n                        <SwiperSlide key={i} tag=\"li\">\n                            <ThingCard {...item} brand_name={seller.brand_name} />\n                        </SwiperSlide>\n                    );\n                })}\n            </Swiper>\n        </div>\n    );\n};\n\nexport default MerchantInfo;\n","import React, { useEffect, useState } from \"react\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\n\nimport ThingCard, { ThingCardProps } from \"./ThingCard\";\nimport { useFancy } from \"./FancyContext\";\n\nconst Recommendation = () => {\n    return (\n        <>\n            <Likeable />\n            <RecentlyViewed />\n        </>\n    );\n};\n\nconst convertThingsV1 = (things: {\n    url: string;\n    thumb_image_url_558: string;\n    sales: {\n        max_price: number;\n        min_price: number;\n        seller: {\n            brand_name: string;\n        };\n        title: string;\n    }[];\n    name: string;\n}[]) => {\n    return things.map(({ url: html_url, thumb_image_url_558: image_url, sales, name }) => {\n        return {\n            html_url,\n            image_url,\n            max_price: sales ? sales[0].max_price : 0,\n            min_price: sales ? sales[0].min_price : 0,\n            brand_name: sales ? sales[0].seller.brand_name : '',\n            title: sales ? sales[0].title : name,\n        };\n    });\n};\n\nconst Likeable = () => {\n    const { thing: { recommended } } = useFancy();\n\n    return (recommended?.length > 0) ? (\n        <>\n            <div className=\"recommend similar\">\n                <h2 className=\"stit\">You May Also Like</h2>\n                {/*<div className=\"control\">\n                    <div\n                        onClick={() => {\n                            setOffset(Math.max(5, offset - 5));\n                        }}>\n                        {\"<\"}\n                    </div>\n                    <div\n                        onClick={() => {\n                            setOffset(Math.min(offset + 5, ((things.length / 5) | 0) * 5));\n                        }}>\n                        {\">\"}\n                    </div>\n                </div>*/}\n            </div>\n            <Swiper className=\"recommend similar swiper-no-swiping\" slidesPerColumn={5}>\n                {recommended?.map((thing, i) => {\n                              return (\n                                  <SwiperSlide key={i}>\n                                      <ThingCard {...thing} />\n                                  </SwiperSlide>\n                              );\n                          })}\n            </Swiper>\n        </>\n    ) : null;\n};\n\nconst RecentlyViewed = () => {\n    const { thing } = useFancy();\n    const [things, setThings] = useState<ThingCardProps[] | null>(null);\n    // const [offset, setOffset] = useState(4);\n    const offset = 4;\n\n    useEffect(() => {\n        $.ajax({\n            type: \"get\",\n            url: `/recently_viewed_things_json?include_sale_item_option=True&rapi_compl=True&count=4&thing_id=${thing.id}`,\n        }).then((response) => {\n            const recently = convertThingsV1(response);\n            setThings(recently);\n        });\n    }, []);\n\n    return (\n        <>\n            <div className=\"recommend recently\">\n                <h2 className=\"stit\">Recently Viewed</h2>\n                {/*<div className=\"control\" style=\"display:none;\">\n                    <div\n                        onClick={() => {\n                            setOffset(Math.max(4, offset - 4));\n                        }}>\n                        {\"<\"}\n                    </div>\n                    <div\n                        onClick={() => {\n                            setOffset(Math.min(offset + 4, ((things.length / 4) | 0) * 4));\n                        }}>\n                        {\">\"}\n                    </div>\n                </div>*/}\n            </div>\n            <Swiper className=\"recommend recently swiper-no-swiping\" slidesPerColumn={4}>\n                {things\n                    ? things\n                          .filter((_, i) => {\n                              if (offset > 4) {\n                                  return i >= offset - 4 && i < offset;\n                              }\n                              return i < offset;\n                          })\n                          .map((thing, i) => {\n                              return (\n                                  <SwiperSlide key={i}>\n                                      <ThingCard {...thing} />\n                                  </SwiperSlide>\n                              );\n                          })\n                    : null}\n            </Swiper>\n        </>\n    );\n};\n\nexport default Recommendation;\n","import cx from \"classnames\";\nimport React, { Dispatch, SetStateAction, useEffect, useState } from \"react\";\nimport SwiperCore, { Thumbs } from \"swiper\";\nimport Lightbox from \"react-image-lightbox\";\nimport { debounceEventUntilTimeout } from \"fancyutils\";\n\nimport { useFancy } from \"./FancyContext\";\nimport type { ReviewEntry as ReviewEntryType, Reviews as ReviewsType } from \"ftypes\";\n\nSwiperCore.use([Thumbs]);\n\ninterface ReviewParams {\n    page?: number;\n    per_page?: number;\n    q?: string;\n    sort?: \"newest\" | \"rating_desc\" | \"rating_asc\";\n    setLoading?: Dispatch<SetStateAction<boolean>>;\n}\n\nfunction useDefaultReviews({ page, per_page, q, sort, setLoading }: ReviewParams) {\n    const { thing } = useFancy();\n    const {\n        sales: { id: sid },\n    } = thing;\n\n    const skip = !sort && !per_page && (!page || page === 1) && !q;\n    const reviews = useReviews({ skip, sid, page, per_page, q, sort, setLoading });\n    if (skip) {\n        return thing.reviews;\n    } else {\n        return reviews;\n    }\n}\n\nfunction useReviews({\n    skip = false,\n    sid,\n    page,\n    per_page,\n    q,\n    sort,\n    setLoading,\n}: ReviewParams & { skip: boolean; sid: number }) {\n    const [reviews, setReviews] = useState(null);\n    const param = $.extend({}, { q, page, per_page, sort });\n\n    useEffect(() => {\n        if (skip) {\n            return;\n        }\n        setLoading?.(true);\n        $.get(`/rest-api/v2/reviews/saleitem/${sid}`, param)\n            .then((res) => {\n                setReviews(res);\n            })\n            .always(() => {\n                setLoading?.(false);\n            });\n    }, [skip, sid, q, page, per_page, sort]);\n\n    return reviews;\n}\n\nconst Reviews = () => {\n    const [loading, setLoading] = useState(false);\n    const [reviewOption, setReviewOption] = useState({\n        page: undefined,\n        per_page: undefined,\n        q: undefined,\n        sort: undefined,\n    });\n\n    const reviews = useDefaultReviews({ ...reviewOption, setLoading });\n\n    if (reviewOption.q === undefined && (!reviews || reviews.review_count === 0)) {\n        return null;\n    }\n\n    return (\n        <div className={cx(\"review-points review-section\", { loading })}>\n            <ReviewHead reviews={reviews} />\n            <ReviewList\n                reviews={reviews}\n                reviewOption={reviewOption}\n                setReviewOption={(applying) => {\n                    setReviewOption({ ...reviewOption, ...applying });\n                }}\n            />\n        </div>\n    );\n};\n\nconst ReviewHead = ({ reviews } : { reviews: ReviewsType }) => {\n    return (\n        <>\n            <h3 className=\"stit\">\n                {reviews.summary.rating_avg}{\" \"}\n                <small className=\"count\">\n                    ({reviews.summary.total_ratings} rating{reviews.summary.total_ratings != 1 ? \"s\" : \"\"})\n                </small>\n            </h3>\n            <ul className=\"optional\">\n                {reviews.summary.attributes.map((a, i) => {\n                    return (\n                        <li key={i}>\n                            <label>{a.label}</label>\n                            <span className=\"review-range\">\n                                <i className=\"review-range-value\" style={{ width: `${Number(a.rating) * 20}%` }}></i>\n                            </span>\n                            <b>{a.rating}</b>\n                        </li>\n                    );\n                })}\n            </ul>\n            {/* <div className=\"btn-area\">\n                <button className=\"btns-blue-embo btn-review\">Write a Review</button>\n            </div> */}\n        </>\n    );\n};\n\nconst ReviewEntry = ({ review } : { review: ReviewEntryType }) => {\n    const [photoIndex, setPhotoIndex] = useState<number | null>(null);\n\n    return (\n        <li>\n            <small className=\"date\">{review.date}</small>\n            <span className={\"review-range \" + \"point\" + (review.rating | 0)}>\n                <span className=\"bg\"></span>\n                <i className=\"review-range-value\">\n                    <span></span>\n                </i>\n            </span>\n            <span className=\"username\">{review.name}</span>{\" \"}\n            <span className=\"verified\">\n                <em>Verified User</em>\n            </span>\n            <b className=\"title\">{review.title}</b>\n            <span className=\"description\">{review.review}</span>\n            <div>\n                {review.images.map((image, i) => {\n                    return (\n                        <div className=\"photo\" key={i}>\n                            <img\n                                onClick={() => {\n                                    setPhotoIndex(i);\n                                }}\n                                alt=\"review image\"\n                                src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n                                style={{\n                                    backgroundImage: `url('${image.thumbnail_url}')`,\n                                }}\n                            />\n                        </div>\n                    );\n                })}\n                {photoIndex !== null && (\n                    <Lightbox\n                        mainSrc={review.images[photoIndex].image_url}\n                        nextSrc={review.images[(photoIndex + 1) % review.images.length].image_url}\n                        prevSrc={\n                            review.images[(photoIndex + review.images.length - 1) % review.images.length].image_url\n                        }\n                        onCloseRequest={() => setPhotoIndex(null)}\n                        onMovePrevRequest={() =>\n                            setPhotoIndex((photoIndex + review.images.length - 1) % review.images.length)\n                        }\n                        onMoveNextRequest={() => setPhotoIndex((photoIndex + 1) % review.images.length)}\n                    />\n                )}\n            </div>\n        </li>\n    );\n};\n\nconst ReviewList = ({ reviews, reviewOption, setReviewOption } : { reviews: ReviewsType }) => {\n    const currentPage = reviewOption.page || 1;\n    return (\n        <>\n            <fieldset className=\"search\">\n                <label>Filter reviews</label>\n                <input\n                    type=\"text\"\n                    placeholder=\"Search topics and reviews\"\n                    className=\"text\"\n                    onChange={debounceEventUntilTimeout((e) => {\n                        setReviewOption({ q: e.target.value });\n                    }, 500)}\n                />\n                <span className=\"sort\">\n                    <label>Sort By:</label>\n                    <select\n                        onChange={({ target }) => {\n                            setReviewOption({ sort: target.value });\n                        }}>\n                        <option value=\"newest\">Most Recent</option>\n                        <option value=\"rating_desc\">Highest Rated</option>\n                        <option value=\"rating_asc\">Lowest Rated</option>\n                    </select>\n                </span>\n            </fieldset>\n            <ul className=\"review-list\">\n                {reviews.reviews.length > 0 ? (\n                    reviews.reviews.map((review, i) => <ReviewEntry key={i} review={review} />)\n                ) : (\n                    <li className=\"no-review\">There is no review matching your request. Please try another option.</li>\n                )}\n            </ul>\n            <div className=\"review-pagination\">\n                {currentPage > 1 && (\n                    <>\n                        <a href=\"#\" className=\"more\">\n                            See more reviews\n                        </a>\n                        <a\n                            className=\"prev\"\n                            onClick={() => {\n                                setReviewOption({ page: Math.max(1, currentPage - 1) });\n                            }}>\n                            Prev\n                        </a>\n                    </>\n                )}\n                {currentPage < reviews.total_pages && (\n                    <a\n                        className=\"next\"\n                        onClick={() => {\n                            setReviewOption({ page: Math.min(currentPage + 1, reviews.total_pages) });\n                        }}>\n                        Next\n                    </a>\n                )}\n                {_.range(1, reviews.total_pages + 1).map((pageNum, i) => (\n                    <a\n                        key={i}\n                        onClick={() => {\n                            setReviewOption({ page: pageNum });\n                        }}\n                        className={currentPage === pageNum ? \"current\" : undefined}>\n                        {pageNum}\n                    </a>\n                ))}\n            </div>\n        </>\n    );\n};\n\nexport default Reviews;\n","import React, { Component, Suspense } from \"react\";\nimport { connect } from \"react-redux\";\nimport { isStaticPage } from \"fancyutils\";\n\nimport Thing from \"./Thing\";\nimport MerchantInfo from \"./MerchantInfo\";\nimport Recommendation from \"./Recommendation\";\nimport Reviews from \"./Reviews\";\n\nimport { historyData } from \"../../container/history\";\nimport { updateSaleContext } from \"../../action/action-helpers\";\nimport store from \"../../store/store\";\nimport FancyContext, { getFancyContextDefaultValue, useFancy } from \"./FancyContext\";\n\nimport { OverlayPropsV1 } from \"ftypes\";\nimport { mapStateToThingProps } from \"../map\";\n\nfunction AdminMessages() {\n    const {\n        thing,\n    } = useFancy();\n\n    if (!thing.messages) {\n        return null;\n    }\n\n    return (\n        <div className=\"warning\">\n            <span>This item is not visible to customers because:</span>\n            <ul>\n                {thing.messages.map((m, i) => (\n                    <li key={i}>{m}</li>\n                ))}\n            </ul>\n        </div>\n    );\n}\n\nfunction BreadCrumb() {\n    const { thing } = useFancy();\n\n    return (\n        <div className=\"breadcrumb\">\n            {thing.breadcrumbs.map(({ label, href }, i) => (\n                <React.Fragment key={i}>\n                    <a href={href}>{label}</a>{\" \"}\n                    {i !== thing.breadcrumbs.length - 1 ? (\n                        <>\n                            <span className=\"arrow\">&gt;</span>{\" \"}\n                        </>\n                    ) : null}\n                </React.Fragment>\n            ))}\n        </div>\n    );\n}\n\nfunction AdminSidebar(props: OverlayPropsV1) {\n    const {\n        appContext: { viewer },\n        thing,\n    } = props;\n\n    let admin = null;\n\n    let AdminComponent = null;\n    //if (viewer.is_admin_any) {\n    //    AdminComponent = lazy(() => import(/* webpackChunkName: \"OverlayThing.admin\" */ \"../Admin\"));\n    //}\n\n    if (AdminComponent) {\n        admin = (\n            <Suspense fallback={<div />}>\n                <AdminComponent {...props} fallback={<div />} />\n            </Suspense>\n        );\n    }\n\n    return admin;\n}\n\nclass AppV2 extends Component<OverlayPropsV1> {\n    componentDidUpdate(prevProps: OverlayPropsV1) {\n        const pt = prevProps.thing;\n        const ct = this.props.thing;\n\n        if (ct != null) {\n            if (!pt || pt.id !== ct.id) {\n                if (isStaticPage()) {\n                    $(window).scrollTop(0);\n                } else {\n                    $(\"#overlay-thing > .popup\").attr(\"tabindex\", -1).focus();\n                }\n\n                if (ct.sales && ct.sales.options && ct.sales.options.length > 1) {\n                    const nonSoldoutOptions = ct.sales.options.filter((o) => !o.soldout);\n                    let minimumOption;\n                    if (nonSoldoutOptions.length > 0) {\n                        minimumOption = _.min(nonSoldoutOptions, (o) => Number(o.price));\n                    } else {\n                        minimumOption = _.min(ct.sales.options, (o) => Number(o.price));\n                    }\n                    if (ct.sales.options[0].id !== minimumOption.id) {\n                        store.dispatch(updateSaleContext({ saleOptionID: minimumOption.id }));\n                    }\n                }\n            }\n        }\n    }\n\n    getFancyContext() {\n        return this.props.thing ? this.props : getFancyContextDefaultValue();\n    }\n\n    render() {\n        const { thing } = this.props;\n\n        if (historyData.locationIsThingPage && thing != null) {\n            return (\n                <FancyContext.Provider value={this.getFancyContext()}>\n                    <AdminMessages />\n                    <BreadCrumb />\n                    <Thing />\n                    <Reviews />\n                    <MerchantInfo />\n                    <Recommendation />\n                    <AdminSidebar {...this.props} />\n                </FancyContext.Provider>\n            );\n        } else {\n            return <div />;\n        }\n    }\n}\n\nconst ReduxComponentEnhancer = connect<OverlayPropsV1>(mapStateToThingProps);\nconst Overlay = ReduxComponentEnhancer(AppV2);\n\nexport default Overlay;\n","// This is entrypoint, which `React.render` takes place after DOM is ready.\nimport React, { Suspense, lazy } from \"react\";\nimport classnames from \"classnames\";\nimport { Route, Router, Switch } from \"react-router-dom\";\nimport { render } from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport Bugsnag from \"@bugsnag/js\";\nimport BugsnagPluginReact from \"@bugsnag/plugin-react\";\n\nimport { selectOrCreate } from \"fancyutils\";\nimport { history } from \"common-components\";\n\nimport OverlayThing from \"./components/v2\"\n\nif (__Config.bugsnag) {\n    Bugsnag.start({\n        apiKey: \"a54d48e98cb0410b7bdf0e60a905b00e\",\n        plugins: [new BugsnagPluginReact()],\n        user: {\n            id: window.__FancyUser?.id || null\n        },\n    });\n}\n\nimport { attachEntryEvents } from \"./container/entry-events\";\nimport { pagingContext } from \"./container/routeutils\";\nimport store from \"./store/store\";\nimport { historyHook } from \"./container/history\";\nimport { closeOverlay } from \"./action/action-helpers\";\n\nconst App: React.FC = ({ children }) => {\n    if (__Config.design_v4) {\n        return <>{children}</>;\n    }\n\n    return (\n        <div className={classnames(\"popup overlay-thing thing-detail\", { new: !!window.__Config.heart_icon })}>\n            {children}\n            <a\n                className=\"ly-close\"\n                onClick={(event) => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    store.dispatch(closeOverlay());\n                }}>\n                Close\n            </a>\n        </div>\n    );\n};\n\nconst onLoad = () => {\n    require(\"./Shared\");\n\n    const overlayContainer = __Config.design_v4\n        ? document.querySelector(\"#container-wrapper .container\")\n        : selectOrCreate(\"#overlay-thing\");\n\n    const Overlay = __Config.design_v4\n        ? OverlayThing\n        : lazy(() => import(\"./components/Overlay\"));\n\n    const thingRegex = /\\/(sales|things)\\/(\\d+)/;\n    const articleRegex = /\\/articles\\/(.+)/;\n    const initialHref = location.href;\n\n    $(window).on(\"popstate.overlay\", function(event) {\n        if (\n            location.href !== initialHref &&\n            !(location.pathname.match(thingRegex) || location.pathname.match(articleRegex))\n        ) {\n            event.preventDefault();\n            location.reload();\n        }\n    });\n\n    const ErrorBoundary = __Config.bugsnag ? Bugsnag.getPlugin(\"react\")!.createErrorBoundary(React) : React.Fragment;\n\n    const tree = (\n        <ErrorBoundary>\n            <Provider store={store}>\n                <Router history={history}>\n                    <App>\n                        <Switch>\n                            <Route path=\"/things/*\">\n                                <Suspense fallback={<div />}>\n                                    <Overlay />\n                                </Suspense>\n                            </Route>\n                            <Route path=\"/sales/*\">\n                                <Suspense fallback={<div />}>\n                                    <Overlay />\n                                </Suspense>\n                            </Route>\n                            <Route path=\"*\" component={() => null} />\n                        </Switch>\n                    </App>\n                </Router>\n            </Provider>\n        </ErrorBoundary>\n    );\n    render(tree, overlayContainer, () => {\n        history.listen(historyHook);\n        historyHook({ pathname: location.pathname, search: location.search }); // should init once\n        attachEntryEvents();\n        pagingContext.init();\n    });\n};\n\nif (document.readyState !== \"loading\") {\n    onLoad();\n} else {\n    document.addEventListener(\"DOMContentLoaded\", onLoad);\n}\n","// Warning: objects has to be flat in each context\nexport function getInitialStoreState(contextName: 'appContext' | 'thing' | 'followContext' | 'fancyContext' | 'saleContext' | 'slideContext') {\n    switch(contextName) {\n    case 'appContext':\n        return {\n            visible: false,\n            viewer: {},\n            loggedIn: null,\n            userCountry: 'US',\n            applePayDisplay: false,\n            applePayTest: false,\n        };\n    case 'thing':\n        return {\n            data: null,\n            ID: null,\n            pendingID: null,\n            isFetching: null,\n            status: 'idle' // { idle | request | failed }\n        };\n    case 'followContext':\n        return {\n            id: null,\n            followStore: {\n                following: undefined,\n                loading: false,\n            },\n            followUser: {\n                following: undefined,\n                loading: false,\n            },\n        };\n    case 'fancyContext':\n        return {\n            id: null,\n            fancyd_count: 0,\n            fancyd: false,\n            loading: false,\n            status: 'Idle', // { Idle | Addition | Removal | After- } - Fancy'd status for animation control \n        };\n    case 'saleContext':\n        return {\n            selectedQuantity: 1,\n            saleOptionID: null, // `thing.id`? | `sio.id`?\n            currencyCode: null, // props.thing.currency_code\n            currencyMoney: null, //\n            currencySymbol: null, //\n            price: null, // (props.thing.sales_available && props.thing.sales.price) || null,\n            personalization: null,\n        };\n    case 'slideContext':\n        return {\n            id: null,\n            thumbnailIndex: 0,\n        };\n    default:\n        console.warn('`getInitialStoreState()`: Unknown context name ', contextName);\n    }\n};\n\nvar contexts = [\n    'slideContext',\n    'saleContext',\n    'fancyContext',\n    'followContext',\n    'thing',\n    'appContext'\n];\n\nexport function getAllInitialStoreState() {\n    return contexts.reduce((state, contextKey) => {\n        state[contextKey] = getInitialStoreState(contextKey);\n        return state;\n    } , {});\n}\n","// -- Members --\n// className: string\n// - class name that used from sidebar head 'wrapper figure-info {className}'.\n// type: string\n// - meta string that indicates type name\nimport { mergeObjectArgs } from 'fancyutils';\n\nexport class ThingTypeMeta {\n    static isSale = false;\n    static type = 'ThingTypeMeta';\n\n    getName(thingContext) {\n        return thingContext.name;\n    }\n}\n\nexport class PlainThingType extends ThingTypeMeta {\n    static className = '';\n    static type = 'PlainThing';\n    static createEmptyObject(...args) {\n        const objectArgs = mergeObjectArgs(args);\n        const thing = $.extend(true, {\n            id: '1',\n            url: '/',\n            isCrawled: false,\n            owner: {},\n            image: { src: '', width: 1, height: 1 },\n            user: {},\n            type: 'thing',\n            fancyd_friends: [],\n        }, objectArgs);\n        thing.META = getThingType(thing);\n        return thing;\n    }\n}\n\nexport class SaleItemType extends ThingTypeMeta {\n    static className = '';\n    static type = 'SaleItem';\n    static getName(thingContext) {\n        return thingContext.sales.name;\n    }\n    static createEmptyObject(objectArgs) {\n        return PlainThingType.createEmptyObject({\n            sales_available: true,\n            sales: {\n                id: '1',\n                review_rating: 1,\n                review_count: 1,\n                size_chart_ids: ['1'],\n                images: [{ src: '', width: 1, height: 1 }],\n                seller: { id: '1' }\n            },\n            type: 'sales'\n        }, objectArgs);\n    }\n}\n\nexport class GiftcardType extends SaleItemType {\n    static className = 'giftcard';\n    static type = 'Giftcard';\n\n    static getName() {\n        return window.gettext(\"Fancy Gift Card\");\n    }\n}\n\nexport class HotelType extends SaleItemType {\n    static className = 'hotel';\n    static type = 'Hotel';\n\n    static getName(thingContext) {\n        return thingContext.hotel_search.hotel.name;\n    }\n}\n\nexport class VanityType extends SaleItemType {\n    static className = 'vanity';\n    static type = 'Vanity';\n}\n\nexport class LaunchAppType extends ThingTypeMeta {\n    static className = '';\n    static type = 'LaunchApp';\n}\n\n// Retrieve meta by looking up thing object.\nexport function getThingType(thingContext) {\n    var ThingType;\n    if (thingContext.hotel_search) {\n        ThingType = HotelType;\n    } else if (thingContext.has_launch_app && thingContext.metadata) {\n        ThingType = LaunchAppType;\n    } else if (thingContext.type === 'giftcard') {\n        ThingType = GiftcardType;\n    } else if (thingContext.sales_available) {\n        if (thingContext.type === 'vanity_number') {\n            ThingType = VanityType;\n        } else {\n            ThingType = SaleItemType;\n        }\n    } else {\n        ThingType = PlainThingType;\n    }\n    return ThingType;\n}\n\nconst ThingTypes = [PlainThingType, SaleItemType, GiftcardType, HotelType, VanityType, LaunchAppType];\n\n// TODO: immutable\nThingTypes.forEach(AttachingType => {\n    ThingTypes.forEach(ComparingType => { \n        AttachingType[ComparingType.type] = AttachingType === ComparingType;\n    });\n});\n","import { combineReducers } from \"@reduxjs/toolkit\";\nimport { extractMetaFromURL, /*getConciseNumberString,*/ update, updateShallow } from \"fancyutils\";\n\nimport C from \"./action/action-constants\";\nimport { getInitialStoreState } from \"./store/initial-store\";\nimport { getFirstSaleOption, setWaiting } from \"./components/map\";\nimport { updateState } from \"./appstate\";\nimport { scrollEvent } from \"./container/entry-events\";\nimport { getThingType } from \"./ThingTypes\";\nimport { cache } from \"./cache\";\n\nvar loaded = false;\nvar lastFullyRenderedThingID = 0;\nfunction appContext(state = getInitialStoreState(\"appContext\"), action) {\n    switch (action.type) {\n        case C.OPEN_THING:\n            scrollEvent.visible = true;\n            return updateShallow(state, {\n                visible: true,\n            });\n        case C.CLOSE_THING:\n            scrollEvent.visible = false;\n            lastFullyRenderedThingID = 0;\n            loaded = false;\n            return updateShallow(state, {\n                visible: false,\n                lastFullyRenderedThingID,\n            });\n        case C.UPDATE_APP_CONTEXT:\n            return updateShallow(state, action.context);\n        case C.LOAD_THING: {\n            // Due to multi-stage rendering (cache -> from-server-data -> ...)\n            // it is unable to check state change correctly just by comparing ID;\n            // Therefore, we set internal state per every update cycle and check\n            // if state is fully updated.\n\n            // FIXME: when cached response exist, it marks as rendered before\n            if (loaded === true && lastFullyRenderedThingID !== action.data.id && action.data.fromServer) {\n                lastFullyRenderedThingID = action.data.id;\n            }\n\n            const loggedIn = window.__FancyUser.loggedIn;\n            const viewer = action.data.viewer || {};\n            const userCountry =\n                $.cookie.get(\"shipping_country_code\") || action.data.current_country_code || state.userCountry;\n\n            updateState(\"loggedIn\", loggedIn);\n            updateState(\"viewer\", viewer);\n            loaded = true;\n\n            return update(state, { lastFullyRenderedThingID, loggedIn, viewer, userCountry });\n        }\n        default:\n            return state;\n    }\n}\n\nfunction populateThingContext(thingData) {\n    thingData.loading = thingData.fromServer !== true;\n    thingData.META = getThingType(thingData);\n    thingData.URLMeta = extractMetaFromURL(location.href); // FIXME: provide current pathname\n    thingData.owner = thingData.user;\n}\n\n// Thing context\nfunction thing(state = getInitialStoreState(\"thing\"), action) {\n    switch (action.type) {\n        case C.LOAD_THING:\n            populateThingContext(action.data);\n            return updateShallow(state, {\n                data: action.data,\n                status: action.status,\n                ID: action.ID,\n                pendingID: null,\n                isFetching: false,\n            });\n        case C.REQUEST_THING:\n            return update(state, {\n                pendingID: action.pendingID,\n                status: action.status,\n                isFetching: true,\n            });\n        case C.REQUEST_THING_FAILURE:\n            return update(state, {\n                status: action.status,\n                isFetching: false,\n            });\n\n        // Reset state\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"thing\"));\n        default:\n            return state;\n    }\n}\n\n// Follow contexts\nfunction followContext(state = getInitialStoreState(\"followContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"), {\n                id: action.data.id,\n                followStore: {\n                    following: action.data.sales\n                        ? Boolean(action.data.sales.seller && action.data.sales.seller.seller_follow)\n                        : false,\n                    loading: false,\n                },\n                followUser: {\n                    following: action.data ? Boolean(action.data.following) : false,\n                    loading: false,\n                },\n            });\n\n        // Sidebar\n        // Follow seller/user\n        case C.TOGGLE_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: true,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.CANCEL_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.COMPLETE_FOLLOW:\n            if (action.followType === \"followStore\") {\n                cache.update(state.id, undefined, \"sales.seller.seller_follow\", state[action.followType].following);\n            }\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: state[action.followType].following,\n                },\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"));\n        default:\n            return state;\n    }\n}\n\n/*\nfunction getFancyStatus(nextFancydState) {\n    return nextFancydState ? FancyStatus.Addition : FancyStatus.Removal;\n}\nfunction getCompletionIdleStatus(currentFancyState) {\n    const prevFancyState = !currentFancyState;\n    return prevFancyState ? FancyStatus.AfterRemoval : FancyStatus.AfterAddition;\n}*/\n\nfunction fancyContext(state = getInitialStoreState(\"fancyContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            // Extract thing data for initial thing context data reset.\n            // onFancyButtonUpdate(action.data.id, action.data.fancyd, getConciseNumberString(action.data.fancyd_count));\n            return updateShallow(getInitialStoreState(\"fancyContext\"), {\n                id: action.data.id,\n                fancyd: action.data.fancyd,\n                fancyd_count: action.data.fancyd_count,\n                loading: false,\n                //status: FancyStatus.Idle,\n            });\n        case C.TOGGLE_FANCY:\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: true,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: true,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        case C.CANCEL_FANCY: {\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: false,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: false,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        }\n        // Update data\n        case C.COMPLETE_FANCY:\n            // cache.update(state.id, undefined, \"fancyd\", state.fancyd);\n            // cache.update(state.id, undefined, \"fancyd_count\", action.fancyd_count);\n            // onFancyButtonUpdate(state.id, state.fancyd, getConciseNumberString(action.fancyd_count));\n            // return update(state, {\n            //     loading: false,\n            //     fancyd_count: action.fancyd_count,\n            //     //status: getCompletionIdleStatus(state.fancyd)\n            // });\n            return {\n                ...state,\n                ...{\n                    loading: false,\n                    fancyd_count: action.fancyd_count,\n                    //status: getCompletionIdleStatus(state.fancyd)\n                },\n            };\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"fancyContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction slideContext(state = getInitialStoreState(\"slideContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"), {\n                id: action.data.id,\n            });\n        case C.SET_THUMBNAIL_INDEX:\n            return update(state, {\n                thumbnailIndex: action.thumbnailIndex,\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction saleContext(state = getInitialStoreState(\"saleContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING: {\n            // Extract thing data for initial thing context data reset.\n            const thing = action.data;\n            const sales = thing && thing.sales;\n            const saleOptionInclSales = getFirstSaleOption(sales);\n            const nextContext = {\n                selectedQuantity: 1,\n                saleOptionID: (saleOptionInclSales && saleOptionInclSales.id) || null,\n                currencyCode: action.data.currency_code,\n                price: (saleOptionInclSales && saleOptionInclSales.price) || null,\n                waiting: null,\n            };\n            return updateShallow(getInitialStoreState(\"saleContext\"), nextContext);\n        }\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"saleContext\"));\n        case C.UPDATE_SALE_CONTEXT: {\n            // Setting waiting\n            if (action.waiting != null) {\n                setWaiting(state.saleOptionID, action.waiting);\n            }\n\n            let waiting = action.waiting;\n            // Reset quantity / Change waiting if option is changed.\n            if (action.saleOptionID != null && action.saleOptionID !== state.saleOptionID) {\n                action.selectedQuantity = 1;\n                waiting = null;\n            }\n\n            const nextContext = {\n                selectedQuantity: action.selectedQuantity,\n                saleOptionID: action.saleOptionID, // `thing.id`? | `sio.id`?\n                price: action.price, // (props.thing.sales_available && props.thing.sales.price) || null,\n                // UI\n                currencyCode: action.currencyCode, // props.thing.currency_code\n                currencyMoney: action.currencyMoney, //\n                currencySymbol: action.currencySymbol, //\n                personalization: action.personalization,\n                waiting,\n            };\n            return update(state, nextContext);\n        }\n        default:\n            return state;\n    }\n}\n\n/*\nfunction checkNotImplementedWithURLExceptionRule(META) {\n    if (['Fancybox', 'Hermes'].some(type => META[type])) {\n        window.location.reload()\n    }\n}*/\n\nconst rootReducer = combineReducers({\n    appContext,\n    // Thing contexts\n    followContext,\n    fancyContext,\n    slideContext,\n    saleContext,\n    // etc.\n    thing,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import { configureStore } from \"@reduxjs/toolkit\";\nimport thunk from \"redux-thunk\";\nimport logger from 'redux-logger'\n\nimport { getAllInitialStoreState } from \"./initial-store\";\nimport rootReducer from \"../reducers\";\n// import type { RootState } from '../reducers';\n\nconst middlewares = [thunk];\nif (process.env.NODE_ENV !== 'production') {\n    middlewares.push(logger);\n}\n\nconst store = configureStore({\n    reducer: rootReducer,\n    preloadedState: getAllInitialStoreState(),\n    middleware: (getDefaultMiddleware) =>\n        getDefaultMiddleware({\n            serializableCheck: false,\n        }).prepend(middlewares),\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport default store;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tif(mode & 2 && typeof value == 'object' && value) {\n\t\tfor(const key in value) def[key] = () => value[key];\n\t}\n\tdef['default'] = () => value;\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + ({\"114\":\"OverlayThing.popup\",\"555\":\"OverlayThing.admin\",\"843\":\"OverlayThing.extras\"}[chunkId] || chunkId) + \".\" + {\"114\":\"76c7cd74fca742c5d360\",\"293\":\"88e44f45436421f225a9\",\"555\":\"86204024f7b1e5edae9e\",\"843\":\"18d2f3218e065c2de157\"}[chunkId] + \".js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.hmd = (module) => {\n\tmodule = Object.create(module);\n\tif (!module.children) module.children = [];\n\tObject.defineProperty(module, 'exports', {\n\t\tenumerable: true,\n\t\tset: () => {\n\t\t\tthrow new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\n\t\t}\n\t});\n\treturn module;\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"https://static-ec1.thefancy.com/_static_gen/_ui/js/bundle/\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// Promise = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t765: 0\n};\n\nvar deferredModules = [\n\t[3604,216,130]\n];\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => {\n\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n\t\t\t\t\t});\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId);\n\t\t\t\t} else installedChunks[chunkId] = 0;\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\nvar checkDeferredModules = () => {\n\n};\nfunction checkDeferredModulesImpl() {\n\tvar result;\n\tfor(var i = 0; i < deferredModules.length; i++) {\n\t\tvar deferredModule = deferredModules[i];\n\t\tvar fulfilled = true;\n\t\tfor(var j = 1; j < deferredModule.length; j++) {\n\t\t\tvar depId = deferredModule[j];\n\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferredModules.splice(i--, 1);\n\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n\t\t}\n\t}\n\tif(deferredModules.length === 0) {\n\t\t__webpack_require__.x();\n\t\t__webpack_require__.x = () => {\n\n\t\t}\n\t}\n\treturn result;\n}\n__webpack_require__.x = () => {\n\t// reset startup function so it can be called again when more startup code is added\n\t__webpack_require__.x = () => {\n\n\t}\n\tchunkLoadingGlobal = chunkLoadingGlobal.slice();\n\tfor(var i = 0; i < chunkLoadingGlobal.length; i++) webpackJsonpCallback(chunkLoadingGlobal[i]);\n\treturn (checkDeferredModules = checkDeferredModulesImpl)();\n};\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (data) => {\n\tvar [chunkIds, moreModules, runtime, executeModules] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0, resolves = [];\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tresolves.push(installedChunks[chunkId][0]);\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tparentChunkLoadingFunction(data);\n\twhile(resolves.length) {\n\t\tresolves.shift()();\n\t}\n\n\t// add entry modules from loaded chunk to deferred list\n\tif(executeModules) deferredModules.push.apply(deferredModules, executeModules);\n\n\t// run deferred modules when all chunks ready\n\treturn checkDeferredModules();\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkfancy\"] = self[\"webpackChunkfancy\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = webpackJsonpCallback;","// run startup\nreturn __webpack_require__.x();\n"],"sourceRoot":""}
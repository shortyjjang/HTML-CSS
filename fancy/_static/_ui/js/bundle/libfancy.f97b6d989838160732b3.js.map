{"version":3,"sources":["webpack://fancy/./_static/modules/libf/FancyMixin.js","webpack://fancy/./_static/modules/libf/PopupHelper.js","webpack://fancy/./_static/modules/libf/CDNUtils.js","webpack://fancy/./_static/modules/libf/CopyToClipboard.js","webpack://fancy/./_static/modules/libf/FancyUtils.ts","webpack://fancy/./_static/modules/libf/common-components/Video.js","webpack://fancy/./_static/modules/libf/common-components/MoreShareUtils.js","webpack://fancy/./_static/modules/libf/common-components/SharePopover.js","webpack://fancy/./_static/modules/libf/common-components/AddlistPopover.js","webpack://fancy/./_static/modules/libf/common-components/Popup.js","webpack://fancy/./_static/modules/libf/common-components/MoreShare.js","webpack://fancy/./_static/modules/libf/common-components/MoreShareFacade.js","webpack://fancy/./_static/modules/libf/common-components/History.ts","webpack://fancy/./_static/modules/libf/common-components/ProductSlide.js"],"names":["Display","None","display","Block","Inline","InlineBlock","NoneIf","cond","undefined","BlockIf","InlineIf","InlineBlockIf","getElementGapFromHeader","measurePointElement","$headerFeatured","$","destHeight","height","attr","document","body","scrollTop","offset","top","selectPopup","popupName","length","dialog","closePopup","popup","$obj","data","close","popupContainer","getElementById","renderPopup","PopupComponent","attrs","callback","openOnMount","bindOverlayData","one","this","open","openPopup","console","warn","name","ReactDOM","selectOrCreate","schemeless","url","match","makeServer","type","template","HOSTS","push","size","method","isSchemeless","cdn","resizeUrl","parts","window","parseURL","fixedName","test","pathname","path","getCDNURL","protocol","hostname","candidates","replace","THEFANCY_MEDIA","THINGD_MEDIA","FANCY_WEB","RESIZE_IMAGE","STATICFILES","str","i","c","sum","charCodeAt","sumChars","getResizeURL","copyToClipboard","text","options","cb","reselectPrevious","range","selection","mark","Function","prototype","deselectCurrent","createRange","getSelection","createElement","textContent","style","whiteSpace","appendChild","selectNode","addRange","execCommand","clipboardData","setData","err","removeRange","removeAllRanges","removeChild","_","selector","attrValue","container","element","classNames","split","filter","e","join","substr","Error","target","find","get","appendTo","requestIdleCallback","args","setTimeout","Number","isNaN","value","isInteger","isFinite","Math","floor","thingRegex","extractMetaFromURL","stripDomain","ret","href","stripURL","id","articleRegex","extractMetaFromArticleURL","parser","a","setAttribute","createElementParser","result","search","hash","indexOf","getObjectTypeFromUrl","getPathname","aElement","location","stripped","floatFormatMinusTwo","number","num","numberFormat","splitted","isEmpty","obj","Array","Object","getOwnPropertyNames","_isHomepage","_isStream","KEYS","TAB","ENTER","SPACE","ESC","UP","DOWN","LEFT","RIGHT","SEMICOLON","COMMA","triggerEvent","DOMRef","eventName","event","CustomEvent","Event","dispatchEvent","update","state","next","extend","apply","updateShallow","getDisplay","isPlainLeftClick","button","altKey","metaKey","ctrlKey","shiftKey","isHomepage","isStream","testLegacyContextLocation","debounceUntilTimeout","fun","delay","timer","context","clearTimeout","unshift","bind","debounceEventUntilTimeout","eventHandler","persist","numberUnitPostfixes","getConciseNumberString","_num","isNumber","pos","toFixed","String","decimals","decPoint","thousandsSep","abs","sign","intPartNum","parseInt","intPart","j","slice","isStaticPage","className","isStaticArticlePage","index","is","dedupeArray","vals","sort","reduce","b","getFancyDepsRoot","eitherFancy","namespace","doWith","Deps","didClickOn","$targ","parents","xmlUtil","isSuccess","xml","sc","isFail","MP","track_event","getLocationArgPairs","key","originalArgStr","argStr","map","some","argPair","minmax","lb","ub","max","min","mergeObjectArgs","p","n","ClickOutside","component","popupElementRefKey","closePopupFunction","attached","eventKey","handleDetach","on","isTrigger","contains","startingElement","targetElement","start","documentElement","parentElement","closestUntil","off","random","toString","convertThingsV1ToRest","things","thing","converted","assign","sales_available","id_str","fancyd","thumb_image_url_310","thumb_image_url_558","fancyd_count","fancys","image","src","image_url","width","image_url_width","image_url_height","owner","user","html_url","fancyd_users","sales","isSaleResponse","sale_id","quantity","remaining_quantity","price","fancy_price","available_for_sale","isCrawled","isElementOutsideViewport","excludingElement","elementRect","getBoundingClientRect","upperBound","leftBound","exclusionRect","bottom","right","html","lowerBound","innerHeight","clientHeight","rightBound","innerWidth","clientWidth","left","_FancyUser","loggedIn","merchant","__FancyUser","FancyUser","locationHostname","stripPathname","sp","alertify","alert","prompt","message","fn","placeholder","cssClass","msg","confirm","set","labels","ok","cancel","escapeSelector","sel","ch","asCodePoint","getVideo","object","h264_1000k_url","saleVideo","video","thingOrArticleVideo","video_cover","cover_video","outputs","h264_1000k","metadata","video_url","thumbnail_url","original_url","Video","props","Date","original","loop","nextProps","lastFullyRenderedObjectID","playing","domCls","$el","getSrc","getLoop","currentTime","getThumbnail","videoEl","el","empty","append","prevProps","np","pause","play","prepare","ref","thingHasVideo","article","status","React","ShareObjectTypes","getShareURL","loading","referrerURL","originalUrl","viewerUsername","objectId","objectType","objectMeta","slug","connector","createReferredUrl","post","done","res","setState","short_url","fail","SNSDict","followingUsers","followingUsersRequested","ViewClasses","SharePopover","friendSearchQuery","searchedFriends","selectedUserID","sentUser","sendNote","sendSuccess","searching","isContact","profile_image_url","fullname","username","preventDefault","clearFriendList","handleHide","prevQuery","searchFriends","title","sending","mailUser","handleSendMail","params","user_id","trim","json","status_code","sentUserID","xhr","always","object_type","email_address","object_id","object_meta","responseObject","JSON","parse","responseText","statusText","additionals","excludes","nextState","forEach","excludeKey","nextID","currentTarget","getSearchedFriends","loadingDisplayUsers","users","forceUpdate","isInputEmail","getSharedMailUser","isEmailOnlyMode","term","filter_messages_permission","showShare","getDisplayUsers","headerGap","emptyClassName","searchedFriendsDisplay","selectedUser","getSelectedUser","getSentUser","emptyDisplay","inputIsEmail","emailOnlyMode","noteSendable","isSNS","sentMessage","gettext","classnames","bot","getShareMessage","onClick","autoComplete","onChange","handleFriendSearch","idx","imgClass","toLowerCase","prefix","getPrefix","handleUserSelect","data-userid","alt","handleClickContactImport","handleContinue","handleSendNoteInput","disabled","handleSend","SNSShareBox","showShareBox","handleClickBackFromContact","defaultMessage","shareMessage","copied","textboxDisplay","updateEmbedOption","$ep","removeClass","prop","val","detail","faintClick","snsShareWindow","getAttribute","getRefURL","directClick","$li","$thumb","$options","types","each","checked","addClass","snippet","handleShare","encodeURI","handleEmbed","AddlistPopover","lists","wanted","listSearchQuery","listCreationQuery","createListFocused","setStateSafe","which","merchantId","createList","drawUserList","quickCreateList","focus","stopPropagation","targ","owned","dataLayer","ajax","error","isChecked","selectedListId","collectionAction","theList","list","updateList","unchecked","listId","mounted","selected_object_id","collections","selected","tid","$html","$items","remove","end","item","$item","getListCheckbox","listDrawn","pp","showList","listSearchInput","handleListSearch","htmlFor","isWishlistQuery","handleWishlistCheckboxChange","isString","ident","data-listid","handleListCheckboxChange","handleCreateListLabelClick","onBlur","handleCreateListBlur","onKeyUp","handleListCreation","handleCreateListQueryChange","Component","list_name","reaction","collectionId","add","action","checked_list_ids","unchecked_list_ids","FancydPerson","following","dataType","nextFollowing","$status","require_login","isAddedUser","viewerId","handleTransition","backgroundImage","user_square_image_small","full_name","handleFollow","FancydByPopup","getFollowList","_getInitialState","nextPage","ended","added_user","reset","immediateNextStateUpdate","thing_id","page","has_next","concat","max_page","current_page","saved_users","__last_tid","handleMore","FancydByPopupV4","scrollHeight","next_cursor","cursor","onScroll","handleScroll","keys","toggleShow","toggleKeys","MoreShare","showMenu","linkCopied","moreMenuButton","handleHook","showSellerList","removeViewportCheck","viewPortChecking","evtName","$root","MoreShareEl","headerEl","handleShareDisplay","onShowSomething","linkCopiedRemovalTimer","clickOutside","facadeShowShare","facadeShowList","handleMoreShareToggle","destroy","ps","ns","handleAttach","checkViewport","componentClass","btnClass","showShortcuts","fromThingSidebar","isThing","isArticle","showMerchantList","shouldShowMerchantCollection","newLayout","data-rendered","opened","handleFancydByDisplay","handleListDisplay","handleMerchantListDisplay","opacity","handleCopyLink","handleHideList","handleHideShare","MoreShareFacade","share","FakeMoreShare","onClickShare","handleClickShare","onClickAddlist","handleClickList","history","createHistory","applyProductSlide","initSlide","option","$slide","$list","itemWidth","$prev","$next","slideWidth","getPrevLeft","css","prepareCount","ceil","last","clone","insertBefore","first","preparePrev","getNextLeft","listWidth","spare","insertAfter","prepareNext","clearOld","prevCnt","itemPerSlide","center","scrollLeft","hide","$this","hasClass","animate","productSlide"],"mappings":"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","file":"libfancy.f97b6d989838160732b3.js","sourcesContent":["// built from 'webpack.FancyUtils.config.js'\n// loaded from 'FancyUtils.js' and exported as global module 'fancymixin'\nimport React from 'react';\nimport { schemeless as getSchemelessURL } from './FancyUtils';\n\n\nexport const initialDisplayNone = { display: 'none' }; // DEPRECATED\nexport const Display = {\n    None: { display: 'none' },\n    Block: { display: 'block' },\n    Inline: { display: 'inline' },\n    InlineBlock: { display: 'inline-block' },\n    NoneIf(cond) {\n        return cond ? Display.None : undefined;\n    },\n    BlockIf(cond) {\n        return cond ? Display.Block : undefined;\n    },\n    InlineIf(cond) {\n        return cond ? Display.Inline : undefined;\n    },\n    InlineBlockIf(cond) {\n        return cond ? Display.InlineBlock : undefined;\n    }\n};\n\n// Image using background-image\nexport const BGImage = ({ alt, className, schemeless, url }) => {\n    var backgroundImage = '';\n    if (url) {\n        backgroundImage = `url(${schemeless ? getSchemelessURL(url) : url})`;\n    }\n\n    return <img src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage }}\n                className={className}\n                alt={alt} />\n}\n\n// measurePointElement = .figure-item.btn-more\n// https://app.asana.com/0/260912680807/218844368911219\nexport function getElementGapFromHeader(measurePointElement/*:Element*/) /*:number*/{\n    const $headerFeatured = $('#header .header-featured');\n    const $header = $('#header')\n    let destHeight = $header.height()\n    if ($headerFeatured.attr('data-expanded') === 'true') {\n        destHeight += $headerFeatured.height()\n    }\n    return ~(document.body.scrollTop - $(measurePointElement).offset().top + destHeight) + 1 // convert - => + / + => -, integer\n}\n","import ReactDOM from 'react-dom';\nimport React from 'react';\nimport { selectOrCreate } from './FancyUtils';\n\n\nfunction selectPopup(popupName) {\n    if ($(`#popup_container .${popupName}`).length > 0) {\n        if (popupName) {\n            return $.dialog(popupName);\n        }\n    }\n    return null;\n}\n\nexport function openPopup(popupName, bindOverlayData = true) {\n    const popup = selectPopup(popupName);\n    if (popup) {\n        if (bindOverlayData) {\n            popup.$obj.data('via-overlay', true);\n            popup.$obj.one('close', function() {\n                $(this).data('via-overlay', false);\n            });\n        }\n        popup.open();\n    }\n}\n\nexport function closePopup(popupName) {\n    const popup = selectPopup(popupName);\n    if (popup) {\n        popup.$obj.data('via-overlay', false);\n        popup.close();\n    }\n}\n\nconst popupContainer = document.getElementById('popup_container');\nexport function renderPopup(PopupComponent, attrs, callback) {\n    // unless `attrs.openOnMount` is explicitly set as `false` and callback is set, it will open right after mount.\n    attrs = attrs || {};\n    if (attrs.openOnMount !== false && callback == null) {\n        callback = function () {\n            openPopup(PopupComponent.popupName);\n        };\n    }\n\n    if (!PopupComponent.popupName) {\n        console.warn(`renderPopup: Please set \\`popupName\\` property of ${PopupComponent.name}`);\n    }\n    return ReactDOM.render(\n        <PopupComponent {...attrs} />,\n        selectOrCreate(`.popup.${PopupComponent.popupName || ''}`, popupContainer),\n        callback\n    );\n}\n","class CDNUtils {\n    HOSTS = {};\n\n    constructor() {\n        // init hosts\n        this.makeServer('THINGD_MEDIA', 'thingd-media-ec.thefancy.com');\n        this.makeServer('THEFANCY_MEDIA', 'thefancy-media-ec.thefancy.com');\n        this.makeServer('RESIZE_IMAGE', 'resize-ec.thefancy.com');\n        this.makeServer('STATICFILES', 'static-ec.thefancy.com');\n        this.makeServer('FANCY_WEB', 'site-ec.thefancy.com');\n    }\n\n    makeServer(type, template) {\n        const { HOSTS } = this;\n        if (!HOSTS[type]) {\n            HOSTS[type] = [];\n        }\n        HOSTS[type].push(template);\n    }\n\n    getResizeURL(url, size, method, isSchemeless, cdn) {\n        var parts = window.parseURL(url);\n        var fixedName = (/test_default/.test(parts.pathname)) ? 'thingd' : 'thefancy';\n        var path = `/resize/${method ? method + '/' : ''}${size}/${fixedName}${parts.pathname}`;\n\n        var resizeUrl;\n        if (cdn) {\n            resizeUrl = this.getCDNURL(path);\n        } else {\n            resizeUrl = `${parts.protocol}//${parts.hostname}${path}`;\n        }\n\n        if (isSchemeless) {\n            resizeUrl = schemeless(resizeUrl);\n        }\n        return resizeUrl;\n    }\n\n    getCDNURL(url) {\n        const { HOSTS } = this;\n        let candidates;\n        const parts = window.parseURL ? window.parseURL(url) : {};\n        let path = parts.pathname;\n\n        if (parts.hostname == 's3.amazonaws.com') {\n            if (/\\/media\\.thefancy\\.com/.test(parts.pathname)) {\n                path = parts.pathname.replace(/^\\/media\\.thefancy\\.com/, '');\n                candidates = HOSTS.THEFANCY_MEDIA;\n            } else if (/\\/media\\.thingd\\.com/.test(parts.pathname)) {\n                path = parts.pathname.replace(/^\\/media\\.thingd\\.com/, '');\n                candidates = HOSTS.THINGD_MEDIA;\n            }\n        } else if (/^\\/(test_)?default/.test(path)) {\n            candidates = HOSTS.THINGD_MEDIA;\n        } else if (/^\\/_ui/.test(path)) {\n            candidates = HOSTS.FANCY_WEB;\n        } else if (/^\\/(resize|mark)/.test(path)) {\n            candidates = HOSTS.RESIZE_IMAGE;\n        } else if (/^\\/_static_gen/.test(path)) {\n            candidates = HOSTS.STATICFILES;\n        } else {\n            candidates = HOSTS.THEFANCY_MEDIA;\n        }\n\n        const hostname = candidates[sumChars(path.replace(/[^a-zA-Z0-9_]+/g,'')) % candidates.length];\n\n        return '//'+ hostname + path;\n    }\n\n    // Get REST URI for given resized_schemeless_image arguments\n    // See `fancy.templatetags.resized_images`\n    resizedSchemelessImage(url, size, method) {\n        // FIXME: some url (like cover image, user image, etc) gives weird url\n        //        and `window.parseURL()` attaches it to location.pathname.\n        //        This is temporary fix for it\n        if (url.match(/^(CoverImages\\/|UserImages\\/)/)) {\n            url = `/${url}`\n        }\n        return this.getResizeURL(url, size, method, true, true);\n    }\n}\n\nfunction sumChars(str) {\n    var sum = 0, i, c;\n    for (i=0,c=str.length; i < c; i++) {\n        sum += str.charCodeAt(i);\n    }\n    return sum;\n}\n\nexport function schemeless(url) {\n    var match = (typeof url === 'string') && url.match(/[http|https]\\:(\\/\\/.*)/);\n    return (match == null) ? url : match[1];\n}\n\nexport const cdnUtils = new CDNUtils();\n","// Removed prompt from 'copy-to-clipboard'\n// https://github.com/sudodoki/copy-to-clipboard/blob/04386fe925e10fec353e35e81684c5c96920102e/index.js\nimport deselectCurrent from 'toggle-selection';\n\n\nexport function copyToClipboard (text, options) {\n  var cb, reselectPrevious, range, selection, mark;\n  if (!options) { options = {}; }\n  cb = options.cb || Function.prototype;\n  try {\n    reselectPrevious = deselectCurrent();\n\n    range = document.createRange();\n    selection = document.getSelection();\n\n    mark = document.createElement('mark');\n    mark.textContent = text;\n    // used to conserve newline, etc\n    mark.style.whiteSpace = 'pre';\n    document.body.appendChild(mark);\n\n    range.selectNode(mark);\n    selection.addRange(range);\n\n    var successful = document.execCommand('copy');\n    if (!successful) {\n      console.warn('unable to copy via execCommand')\n      window.clipboardData.setData('text', text)\n    }\n  } catch (err) {\n    console.warn(err)\n  } finally {\n    cb(null);\n    if (selection) {\n      if (typeof selection.removeRange == 'function') {\n        selection.removeRange(range);\n      } else {\n        selection.removeAllRanges();\n      }\n    }\n    if (mark) {\n      document.body.removeChild(mark);\n    }\n    reselectPrevious();\n  }\n}\n","import {\n    ThingV1Response,\n    ThingObject,\n    FancyUserConfig,\n    SalesResponse,\n} from \"ftypes\";\nimport { BaseSyntheticEvent } from \"react\";\n\nconst __KEY__ = '__F';\n\nconst { _ } = window;\n\nwindow.requestIdleCallback = window.requestIdleCallback || function(cb: Function, ...args: any[]) {\n    window.setTimeout(cb, 0, ...args);\n};\n\n// Polyfills\nNumber.isNaN = Number.isNaN || function isNaN(value) {\n    return value !== value;\n};\n\nNumber.isInteger = Number.isInteger || function(value) {\n    return typeof value === \"number\" &&\n           isFinite(value) &&\n           Math.floor(value) === value;\n};\n\n// https://ponyfoo.com/articles/ecmascript-string-padding\nexport function padStart(text: string, max: number, mask: string) {\n  const cur = text.length;\n  if (max <= cur) {\n    return text;\n  }\n  const masked = max - cur;\n  let filler = String(mask) || ' ';\n  while (filler.length < masked) {\n    filler += filler;\n  }\n  const fillerSlice = filler.slice(0, masked);\n  return fillerSlice + text;\n}\n\nexport function zfill(text: string, max: number) {\n    return padStart(text, max, '0');\n}\n\n// Select element or create element via selector\nexport function selectOrCreate(selector:string, container: Element = document.body, element: string = 'div'): Element {\n    var attr;\n    var attrValue;\n    if (selector[0] === '.') {\n        attr = 'class';\n        var classNames = selector.split('.').filter(e=>e);\n        if (classNames.length > 1) { // .abc.def\n            attrValue = classNames.join(' ');\n        } else { // .abc\n            attrValue = selector.substr(1);\n        }\n    } else if (selector[0] === '#') {\n        attr = 'id';\n        attrValue = selector.substr(1);\n    } else {\n        // TODO: error handling - redirect to the page\n        throw new Error('non-recognized selector:' + selector);\n    }\n\n    var target = $(container).find(selector).get(0);\n    if (target == null) {\n        target = $(`<${element} ${attr}=\"${attrValue}\" />`).appendTo(container).get(0);\n    }\n    return target;\n}\n\ninterface URLMeta {\n    href?: string | null;\n    type?: string;\n    id?: string;\n}\nconst thingRegex = /^\\/(sales|things)\\/(\\d+)/;\nexport function extractMetaFromURL(url: string) {\n    url = stripDomain(url);\n    const match = url.match(thingRegex); // [\"/(sales|things)/1234\", \"sales\", \"1234\"] | null\n    const ret: URLMeta = {};\n    if (match != null) {\n        ret.href = stripURL(url); // Stripped relative URL\n        ret.type = match[1];      // either { 'sales' | 'things' }\n        ret.id = match[2];        // Integer\n    }\n    return ret;\n}\n\nconst articleRegex = /^\\/(articles)\\/([^\\?]+)/;\nexport function extractMetaFromArticleURL(url: string) {\n    url = stripDomain(url);\n    const match = url.match(articleRegex); // [\"/articles/test\", \"articles\", \"test\"] | null\n    const ret: URLMeta = {};\n    if (match != null) {\n        ret.href = stripURL(url); // Stripped relative URL\n        ret.type = match[1];      // always { 'article' }\n        ret.id = match[2];        // String\n    }\n    return ret;\n}\n\nfunction createElementParser(url: string) {\n    const a = document.createElement('a');\n    a.setAttribute('href', url);\n    return a;\n}\n\nfunction stripDomain(url: string) {\n    if (url) {\n        const parser = createElementParser(url);\n        let result = parser.pathname + parser.search + parser.hash;\n        // IE FIX\n        if (result.indexOf('/') !== 0) {\n            result = '/' + result\n        }\n        return result\n    } else {\n        return '/';\n    }\n}\n\nexport function getObjectTypeFromUrl(url: string) {\n    const path = stripDomain(url);\n    if (thingRegex.test(path)) {\n        return 'Thing';\n    } else if (articleRegex.test(path)) {\n        return 'Article';\n    } else {\n        return null;\n    }\n}\n\n// Due to <a href=# /> -> a.pathname = location.pathname, we need cleaner\nexport function getPathname(aElement: HTMLAnchorElement) {\n    if (aElement.pathname === location.pathname) {\n        return '';\n    } else {\n        return aElement.pathname;\n    }\n}\n\n// http://domain/things/1234 => /things/1234\n// deprecated, use stripDomain()\nfunction stripURL(url: string) {\n    const stripped = stripDomain(url);\n    if (stripped) {\n        return stripped;\n    } else {\n        return null;\n    }\n}\n\nexport function floatFormatMinusTwo(number: number) {\n    // simulates effect of floatformat:-2|intcomma\n    var num = numberFormat(number, 2);\n    var splitted = numberFormat(number, 2).split('.');\n    if (splitted[1] === '00') {\n        return splitted[0];\n    } else return num;\n}\n\n// Either empty or null/undefined; Python-side falsy values like {}, []\nexport function isEmpty(obj: any) : boolean {\n    return obj == null ||\n           obj === ''  ||\n           (obj instanceof Array && obj.length === 0) ||\n           (typeof obj === 'object' && Object.getOwnPropertyNames(obj).length === 0);\n}\n\nexport function setCaretPos(element: HTMLInputElement, position: number) {\n    element.focus();\n    if (element.setSelectionRange){\n        element.setSelectionRange(position, position);\n    } else if (element.createTextRange) {\n        var range = element.createTextRange();\n        range.moveEnd('character', position);\n        range.collapse(false);\n        range.select();\n    }\n};\n\nexport function getCaretPos(element: HTMLInputElement) {\n    if (element.selectionStart) {\n        return element.selectionStart;\n    } else if (document.selection) {\n        var range = document.selection.createRange();\n        range.moveStart('character', -element.value.length);\n        return range.text.length;\n    } else {\n        return -1;\n    }\n}\n\nexport var KEYS = {\n    TAB: 9,\n    ENTER: 13,\n    SPACE: 32,\n    ESC: 27,\n    UP: 38,\n    DOWN: 40,\n    LEFT: 37,\n    RIGHT: 39,\n    SEMICOLON: 186,\n    COMMA: 188 // ,\n};\n\n// Using DOM high-level event triggering system for React to recognize event\nexport function triggerEvent(DOMRef: Element, eventName: string, data: Object) {\n    var event;\n    if (data) {\n        event = new CustomEvent(eventName, {\n            'bubbles'    : true, // Whether the event will bubble up through the DOM or not\n            'cancelable' : true, // Whether the event may be canceled or not\n            'detail': data\n        });\n    } else {\n        event = new Event(eventName, {\n            'bubbles'    : true, // Whether the event will bubble up through the DOM or not\n            'cancelable' : true  // Whether the event may be canceled or not\n        });\n    }\n    return DOMRef.dispatchEvent(event);\n}\n\n// Deep merge for reducers\nexport function update(state: unknown, next: unknown) {\n    var args = [true, {}, state];\n    if (next) {\n        args.push(next)\n    }\n    return $.extend.apply(null, args);\n}\n\n// 'Shallow merge'\nexport function updateShallow(state: unknown, next: unknown) {\n    var args = [{}, state];\n    if (next) {\n        args.push(next)\n    }\n    return _.extend.apply(null, args);\n}\n\nexport function getDisplay(display: unknown) {\n    return {\n        display: display ? 'block' : 'none'\n    };\n}\n\n// '<a>b</a>' => 'b'\nexport function stripTags(html: string) {\n    var div = document.createElement(\"div\");\n    div.innerHTML = html;\n    return div.textContent || div.innerText || null;\n}\n\nexport function isPlainLeftClick(event: JQueryEventObject) : boolean {\n    return !(event.button !== 0 || event.altKey || event.metaKey || event.ctrlKey || event.shiftKey);\n}\n\nfunction testLegacyContextLocation() {\n    try {\n        // Root - /\n        if (location.pathname === '/' && $('#container-wrapper .timeline').length > 0) {\n            return true;\n        // Search page - /search?q=foo\n        } else if (/\\/search\\?q\\=/.test(location.href)) {\n            return true;\n        // User page - /foo\n        } else if (\n            $('#container-wrapper .wrapper-content.profile-section').length > 0 &&\n            /^\\/((?!\\/).)*$/.test(location.pathname)\n        ) {\n            return true;\n        } else if ('/shop' === location.pathname || /^\\/shop\\/.*/.test(location.pathname)) {\n            return true;\n        // <username | shopname>/lists/<id>\n        // <shopname>/collection/<id>\n        } else if (\n            /.*\\/list\\/\\d+/.test(location.pathname) ||\n            /.*\\/collection\\/\\d+/.test(location.pathname)\n        ) {\n            return true;\n        }\n    } catch(e) {}\n\n    return false;\n}\n\nlet _isHomepage: boolean;\nexport function isHomepage() {\n    if (_isHomepage == null) {\n        _isHomepage = location.pathname === '/'\n    }\n    return _isHomepage;\n}\n\nlet _isStream: boolean;\nexport function isStream() {\n    if (_isStream == null) {\n        return _isStream = testLegacyContextLocation();\n    } else {\n        return _isStream;\n    }\n}\n\nexport function promisifiedFetchImage(src: string, resolveCallback: any, timeout: number) {\n    const deferred = $.Deferred();\n    deferred.then(resolveCallback);\n\n    if (timeout) {\n        setTimeout(function () { deferred.resolve() }, timeout);\n    }\n\n    const img = new Image();\n    img.onload = () => { deferred.resolve(); };\n    img.onerror = () => { deferred.resolve(); };\n    img.src = src;\n}\n\nexport function debounceUntilTimeout(fun: Function, delay: number, context = null) {\n    let timer: any;\n    return function delayedFunctionWrapper(...args: unknown[]) {\n        clearTimeout(timer);\n        args.unshift(context);\n        timer = setTimeout(fun.bind.apply(fun, args), delay);\n    };\n}\n\nexport function debounceEventUntilTimeout(eventHandler: Function, delay: number) {\n    let timer: any;\n    return (e: BaseSyntheticEvent) => {\n        e.persist();\n        clearTimeout(timer);\n        timer = setTimeout(() => eventHandler(e), delay);\n    }\n}\n\nconst numberUnitPostfixes = ['', 'K', 'M', 'B', 'T'];\nexport function getConciseNumberString(_num: string | number) {\n    let num = Number(_num);\n    if (_.isNaN(num) || !_.isNumber(num)) {\n        return ''\n    }\n    let pos = 0\n    while (num > 1000) {\n        num = num / 1000\n        pos += 1\n    }\n    if (num % 1 !== 0) { // has some number after decimal point, i.e.) 10.5\n        return num.toFixed(1) + numberUnitPostfixes[pos]\n    } else { // integer i.e.) 10\n        return String(num) + numberUnitPostfixes[pos]\n    }\n}\n\n// humanize.js\nexport function numberFormat(number: number, decimals: number, decPoint?: string, thousandsSep?: string) : string {\n    decimals = isNaN(decimals) ? 2 : Math.abs(decimals);\n    decPoint = (decPoint === undefined) ? '.' : decPoint;\n    thousandsSep = (thousandsSep === undefined) ? ',' : thousandsSep;\n\n    var sign = number < 0 ? '-' : '';\n    number = Math.abs(+number || 0);\n\n    var intPartNum = parseInt(number.toFixed(decimals), 10);\n    var intPart = intPartNum + '';\n    var j = intPart.length > 3 ? intPart.length % 3 : 0;\n\n    return sign + (j ? intPart.substr(0, j) + thousandsSep : '') + intPart.substr(j).replace(/(\\d{3})(?=\\d)/g, '$1' + thousandsSep) + (decimals ? decPoint + Math.abs(number - intPartNum).toFixed(decimals).slice(2) : '');\n}\n\n// Number formatting utility i.e) 0.1 => 10%\nexport function proportionFormat(number: string | number, isFixed: boolean) : string {\n    const num = Number(number);\n    if (_.isNumber(num) && !_.isNaN(num)) {\n        if (isFixed) {\n            return (num * 100).toFixed(0) + '%';\n        } else {\n            return (num * 100) + '%';\n        }\n    } else {\n        return '';\n    }\n}\n\nexport function isStaticPage() : boolean {\n    return document.body.className.indexOf('static-ot') !== -1;\n}\n\nexport function isStaticArticlePage() : boolean {\n    return document.body.className.indexOf('static-article') !== -1;\n}\n\n// http://stackoverflow.com/questions/6393943/convert-javascript-string-in-dot-notation-into-an-object-reference\nexport function index(obj: Object, is: string, value : any): any {\n    if (typeof is == 'string') {\n        return index(obj, is.split('.'), value);\n    } else if (is.length === 1 && value !== undefined) {\n        obj[is[0]] = value;\n        return value;\n    } else if (is.length === 0) {\n        return obj;\n    } else if (obj[is[0]] !== undefined) {\n        return index(obj[is[0]], is.slice(1), value);\n    } else {\n        // was unable to reach via selector\n    }\n}\n\n// export function dateFormat(format, datetime) {\n//     return $.datepicker ? $.datepicker.formatDate(format, datetime) : datetime;\n// }\n\nexport function log(...args: unknown[]) {\n    if (process.env.NODE_ENV !== 'production') {\n        console.debug.apply(console, args);\n    }\n}\n\nexport function isVisible(elm: Element) {\n    const vpH = $(window).height(); // Viewport Height\n    const st = $(window).scrollTop(); // Scroll Top\n    const $elm = $(elm);\n    const offset= $elm.offset();\n    const elementHeight = $elm.height();\n\n    if (offset !== undefined && vpH !== undefined && st !== undefined && elementHeight !== undefined) {\n        const y = offset.top;\n        return ((y < (vpH + st)) && (y > (st - elementHeight)));\n    }\n}\n\n// http://stackoverflow.com/a/32533637/1189421\n// Object deduping / boxed value is not supported.\nexport function dedupeArray(vals: any[]): unknown[] | null {\n    if (vals) {\n        return vals.sort().reduce((a, b) => {\n            if (b !== a[0]) {\n                a.unshift(b);\n            }\n            return a;\n        }, []);\n    } else {\n        return null;\n    }\n}\n\n// Access global state\nexport function getFancyDepsRoot() {\n    window[__KEY__] = window[__KEY__] || {};\n    return window[__KEY__];\n}\n\n// eitherFancy('jQuery', $ => $(...)); -> $(...)\nexport function eitherFancy(namespace: string, doWith = (Deps: any) => Deps) /*:object? */{\n    if (window[__KEY__]) {\n        if (window[__KEY__][namespace]) {\n            return doWith(window[__KEY__][namespace]);\n        }\n    } else {\n        getFancyDepsRoot();\n    }\n    return null;\n}\n\nexport function didClickOn($targ: JQuery, selector: string) {\n    return $targ.parents(selector).length > 0 ||\n           $targ.is(selector);\n}\n\nexport const xmlUtil = {\n    isSuccess(xml: string) {\n        const sc = $(xml).find(\"status_code\");\n        return sc.length > 0 && sc.text() === '1';\n    },\n    isFail(xml: string) {\n        const sc = $(xml).find(\"status_code\");\n        return sc.length > 0 && sc.text() === '0';\n    }\n};\n\nexport function MP(...args: unknown[]) {\n    if (process.env.NODE_ENV === 'production') {\n        window.track_event && window.track_event(...args)\n    }\n}\n\n// ?a=1 -> ['a', '1']\nexport function getLocationArgPairs(key: string, originalArgStr:string=location.search) {\n    const argStr = originalArgStr.substr(1, originalArgStr.length);\n    if (argStr) {\n        const args = argStr.split('&').map(e => e.split('='));\n        if (key) {\n            let ret;\n            args.some(argPair => {\n                if (argPair[0] === key) {\n                    ret = argPair;\n                }\n            });\n            if (ret) {\n                return ret;\n            }\n        } else {\n            return args;\n        }\n    }\n}\n\nexport function formatDuration(value: string | number) {\n    if (value == null) {\n        // console.warn('formatDuration: undefined value', value)\n        return '00:00';\n    }\n    const val = Number(value);\n    if (_.isNaN(val)) {\n        // console.warn('formatDuration: value causing NaN', value)\n        return '00:00';\n    }\n    const remainder = (val % 3600) | 0;\n    const minutes = (remainder / 60) | 0;\n    const seconds = (remainder % 60) | 0;\n    return `${zfill(String(minutes), 2)}:${zfill(String(seconds), 2)}`;\n}\n\nexport function minmax(value: number, lb: number, ub: number) {\n    return Math.max(Math.min(value, ub), lb);\n}\n\nexport { openPopup, closePopup, renderPopup } from './PopupHelper';\nexport { cdnUtils, schemeless } from './CDNUtils';\n\nexport function mergeObjectArgs(args: unknown[]) {\n    return args.reduce((p, n)=> $.extend(true, p, n), null);\n}\n\n\nfunction closestUntil(startingElement: Element | null, targetElement : Element | null): Element | null {\n    let start = startingElement;\n    while (start != null) {\n        if (start === targetElement) return targetElement;\n        if (start === document.body || start === document.documentElement) {\n            return null;\n        }\n        start = start.parentElement;\n    }\n    return null;\n}\n\nexport class ClickOutside {\n    eventKey: string = '';\n    component?: import('react').Component = undefined;\n    popupElementRefKey: string = '';\n\n    constructor({ component, popupElementRefKey = 'popupElement' } : { component: import('react').Component, popupElementRefKey: string }) {\n        const key = Math.random().toString().substr(2, 8);\n        this.eventKey = \"click.attachClickOutside\" + key;\n        this.component = component;\n        this.popupElementRefKey = popupElementRefKey;\n    }\n\n    attached = false;\n    handleAttach = (closePopupFunction: Function) => {\n        if (this.attached || closePopupFunction == null) {\n            return;\n        }\n        const { component, eventKey, handleDetach, popupElementRefKey } = this;\n        $(document.body).on(eventKey, function(event: JQueryOldTriggeredEvent) {\n            if (!event.isTrigger &&\n                $.contains(document.body, event.target) && // check if element exists on DOM\n                closestUntil(event.target, component[popupElementRefKey]) === null // is target element exist below popup element?\n            ) {\n                closePopupFunction(component);\n                handleDetach();\n            }\n        });\n        this.attached = true;\n    }\n\n    handleDetach = () => {\n        $(document.body).off(this.eventKey);\n        this.attached = false;\n    }\n\n    destroy() {\n        delete this.component;\n        this.handleDetach();\n    }\n}\n\nexport { copyToClipboard } from './CopyToClipboard'\n\nexport function isClipboardSupported() : boolean {\n    return document.queryCommandSupported != null && document.queryCommandSupported('copy');\n}\n\nfunction isSaleResponse(sales: SalesResponse[]) : sales is SalesResponse[] {\n    return sales != null && sales[0] != null;\n}\n\n// Adapt server response (thing.to_v1 -> rest API)\nexport function convertThingsV1ToRest(things: ThingV1Response[]): ThingObject[] {\n    return things.map((thing: ThingV1Response) => {\n        const converted: ThingObject = Object.assign({\n            sales_available: false,\n            id: thing.id_str,\n            name: thing.name,\n            fancyd: thing[\"fancy'd\"],\n            thumb_image_url_310: thing.thumb_image_url_310,\n            thumb_image_url_558: thing.thumb_image_url_558,\n            fancyd_count: thing.fancys,\n            image: {\n                src: thing.image_url,\n                width: thing.image_url_width,\n                height: thing.image_url_height\n            },\n            owner: thing.user,\n            html_url: window.parseURL(thing.url).pathname,\n            fancyd_users: thing.fancyd_users,\n            sales: thing.sales,\n        }, thing);\n\n        const { sales } = thing;\n        if (isSaleResponse(sales)) {\n            const sales: SalesResponse = thing.sales[0];\n            if (sales.id == null && sales.sale_id != null) {\n                sales.id = sales.sale_id\n            }\n            // converted.sales.waiting = sales.waiting;\n            converted.sales = sales;\n            converted.sales.quantity = sales.remaining_quantity;\n            converted.sales.price = sales.fancy_price;\n            converted.sales_available = sales.available_for_sale;\n        } else {\n            converted.sales = null;\n        }\n\n        // Flag for cache\n        converted.isCrawled = true;\n        return converted;\n    });\n}\nexport function isElementOutsideViewport(element: Element, excludingElement: { element: Element, type: string }) {\n    let elementRect = element.getBoundingClientRect();\n    let upperBound = 0;\n    let leftBound = 0;\n    if (excludingElement) {\n        const { element, type } = excludingElement;\n        if(element){\n            const exclusionRect = element.getBoundingClientRect();\n            if (type === 'top') {\n                upperBound = exclusionRect.bottom; // exclusion on top of el (header, etc)\n            } else if (type === 'left') {\n                leftBound = exclusionRect.right; // exclusion on left of el (sidebar, etc)\n            } // right, bottom is TODO\n        }\n    }\n    const html = document.documentElement\n    const lowerBound = window.innerHeight || html.clientHeight\n    const rightBound = window.innerWidth || html.clientWidth\n    const { bottom, top, left, right } = elementRect\n\n    return (\n        (top <= upperBound && bottom <= upperBound) ||\n        (top >= lowerBound && bottom >= upperBound) ||\n        (left <= leftBound && right <= leftBound) ||\n        (left >= rightBound && right >= rightBound)\n    );\n}\n\nlet _FancyUser : FancyUserConfig = {\n    loggedIn: false,\n    merchant: false,\n    id: null,\n};\n\nif (window.__FancyUser) {\n    Object.assign(_FancyUser, window.__FancyUser);\n}\nexport const FancyUser = _FancyUser;\n\nconst locationHostname = `${location.protocol}//${location.hostname}`\nexport function stripPathname(href: string) {\n    const sp = href.split(locationHostname)\n    return sp.length > 1 ? sp[1] : sp[0]\n}\n\n// https://gist.github.com/ijy/6094414\nexport function cartesianProductOf(...args) {\n    return _.reduce(args, (a, b) => {\n        return _.flatten(_.map(a, (x) => {\n            return _.map(b, (y) => {\n                return x.concat([y]);\n            });\n        }), true);\n    }, [ [] ]);\n}\n\nexport function jQueryPromiseAll(arrayOfPromises: Array<Promise<unknown>>) {\n    return jQuery.when.apply(jQuery, arrayOfPromises).then(function() {\n        return Array.prototype.slice.call(arguments, 0);\n    });\n}\n\nconst _loaded = {};\nexport function loadCss(AppName: string) {\n    const B = window.Bundle;\n    if (_loaded[AppName]) {\n        return;\n    }\n    if (B && B.cssToLoad && B.cssToLoad[AppName] && B.cssToLoad[AppName].length > 0) {\n        while (B.cssToLoad[AppName].length > 0) {\n            const nextUrl = B.cssToLoad[AppName].pop();\n            $(document.head).append(`<link href=\"${nextUrl}\" rel=\"stylesheet\">`);\n            _loaded[AppName] = true;\n        }\n    }\n}\n\nconst _alertify = window.alertify || {\n    alert(...args: unknown[]) { window.alert(...args); },\n    prompt(message: string, fn?: Function | undefined, placeholder?: string | undefined, cssClass?: string | undefined) {\n        if (fn) {\n            let msg : string | undefined | null;\n            if (placeholder) {\n                msg = window.prompt(message, placeholder)\n            } else {\n                msg = window.prompt(message)\n            }\n            if (msg === null) {\n                fn(false);\n            } else {\n                fn(true, msg);\n            }\n        } \n    },\n    confirm(message: string, fn?: Function | undefined, cssClass?: string | undefined) {\n        if (fn) {\n            fn(window.confirm(message));\n        }\n    },\n    set: function() {},\n    labels: { ok: 'OK', cancel: 'Cancel' },\n};\nexport const alertify = _alertify;\n\n// https://code.jquery.com/jquery-3.3.1.js\nexport function escapeSelector(sel: string) { // $.escapeSelector()\n    var rcssescape = /([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\0-\\x1f\\x7f-\\uFFFF\\w-]/g;\n    var fcssescape = function(ch: string, asCodePoint: boolean) {\n        if (asCodePoint) {\n            // U+0000 NULL becomes U+FFFD REPLACEMENT CHARACTER\n            if (ch === \"\\0\") {\n                return \"\\uFFFD\";\n            }\n            // Control characters and (dependent upon position) numbers get escaped as code points\n            return ch.slice(0, -1) + \"\\\\\" + ch.charCodeAt(ch.length - 1).toString(16) + \" \";\n        }\n        // Other potentially-special ASCII characters get backslash-escaped\n        return \"\\\\\" + ch;\n    };\n\n    return (sel + '').replace(rcssescape, fcssescape);\n};\n\nlet isSafari_cac : undefined | boolean;\nexport const isSafari = () => {\n    if (isSafari_cac === undefined) {\n        isSafari_cac = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n    }\n    return isSafari_cac;\n};\n","import React from \"react\";\n// import classnames from \"classnames\";\n// import { proportionFormat, isSafari as isSafariUtil } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\n\nexport function getVideo(object) {\n    if (object.h264_1000k_url) return object;\n    const saleVideo = object && object.sales && object.sales.video;\n    const thingOrArticleVideo = (object && object.video_cover) || (object && object.cover_video);\n    if (saleVideo) {\n        return saleVideo;\n    } else if (thingOrArticleVideo) {\n        try {\n            if (!thingOrArticleVideo.h264_1000k_url && object.cover_video.outputs.h264_1000k) {\n                thingOrArticleVideo.h264_1000k_url = object.cover_video.outputs.h264_1000k.url;\n            }\n        } catch (e) {}\n        return thingOrArticleVideo;\n    } else if (object.metadata && object.metadata.video_url) {\n        return {\n            thumbnail_url: object.image.src,\n            original_url: object.metadata.video_url\n        };\n    } else {\n        console.warn(\"<Video /> component is mounted but with unknown type\");\n        return {};\n    }\n}\n\nexport class Video extends React.Component {\n    constructor(props) {\n        super(props);\n        this.id = +new Date();\n    }\n    el = null;\n    videoEl = null;\n    static isVideoAvailableForThing(thing) {\n        let thingHasVideo = false;\n        if (thing) {\n            if (thing.video_cover) {\n                thingHasVideo = true;\n            } else if (thing.metadata) {\n                if (thing.metadata.video_url) {\n                    thingHasVideo = true;\n                }\n            } else if (thing.sales) {\n                if (thing.sales.video) {\n                    thingHasVideo = true;\n                }\n            }\n        }\n        return thingHasVideo;\n    }\n    static isVideoAvailableForArticle(article) {\n        if (article && article.cover_video && article.cover_video.status == \"ready\") {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    getSrc() {\n        const { object } = this.props;\n        const video = getVideo(object);\n        return video.h264_1000k_url || video.original_url || video.original;\n    }\n\n    getThumbnail() {\n        const { object } = this.props;\n        const video = getVideo(object);\n        return video.thumbnail_url;\n    }\n\n    getLoop() {\n        const { object } = this.props;\n        return getVideo(object).loop;\n    }\n\n    shouldComponentUpdate(nextProps) {\n        return (\n            nextProps.lastFullyRenderedObjectID !== this.props.lastFullyRenderedObjectID ||\n            nextProps.display !== this.props.display ||\n            nextProps.playing !== this.props.playing ||\n            nextProps.object !== this.props.object);\n    }\n\n    prepare() {\n        const domCls = `video-${this.id}`;\n        let $el = $(`.${domCls}`);\n        if ($el.length) {\n            if ($el[0].src !== this.getSrc()) {\n                $el[0].src = this.getSrc();\n                $el[0].loop = !!this.getLoop();\n                $el[0].currentTime = 0;\n            }\n        } else {\n            $el = $(\n                `<video id=\"myVideo\" class=\"${domCls}\" preload=\"auto\" playsInline disablePictureInPicture autoplay muted controls controlslist=\"nodownload nofullscreen noremoteplayback\" src=\"${this.getSrc()}\" loop=\"${!!this.getLoop()}\" poster=\"${this.getThumbnail()}\"/>`\n            )\n                .on(\"ended\", function() {\n                    this.currentTime = 0;\n                })\n            this.videoEl = $el.get(0);\n            $(this.el).empty().append(this.videoEl);\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n        const np = this.props;\n        if (np.display !== prevProps.display) {\n            if (np.display === false) {\n                this.videoEl && this.videoEl.pause();\n            } else {\n                this.videoEl && this.videoEl.play();\n            }\n        }\n        if (np.display && np.playing != prevProps.playing) {\n            if (np.playing === false) {\n                this.videoEl && this.videoEl.pause();\n            } else {\n                this.videoEl && this.videoEl.play();\n            }\n        }\n        this.prepare();\n    }\n\n    render() {\n        const { display, style = {}, playing } = this.props;\n        \n        return (\n            <div\n                style={_.extend(style, Display.NoneIf(!display))}\n                className=\"video_player nozoom\"\n                ref={el => {\n                    this.el = el;\n                    if (!this.videoEl) {\n                        this.prepare();\n                    }\n                }}\n            />\n        );\n    }\n}\n","export const ShareObjectTypes = {\n    thing: 'thing',\n    list: 'list',\n    store: 'store',\n    user: 'user',\n    article: 'article',\n}\n\nfunction createReferredUrl(viewerUsername, objectId, objectType, objectMeta) {\n    let url;\n    if (objectType === ShareObjectTypes.thing) {\n        url = `https://${location.hostname}/things/${objectId}`;\n    } else if (objectType === ShareObjectTypes.article && objectMeta) {\n        url = `https://${location.hostname}/articles/${objectMeta.slug}`;\n    } else {\n        url = location.href.replace(/(#.*)/, ''); // Remove hash\n    }\n\n    if (viewerUsername) {\n        let connector = ~url.indexOf('?') ? '&' : '?';\n        url = `${url}${connector}ref=${viewerUsername}`\n    }\n\n    return url;\n}\n\nexport function getShareURL(component, callback) {\n    if (component.loading || component.state.referrerURL || component.props.referrerURL) {\n        callback && callback(true);\n        return;\n    }\n    component.loading = true;\n\n    // If async loading is needed, assign setState callback.\n    let cb = null;\n    if (callback) {\n        cb = () => {\n            callback(false);\n            component.loading = false;\n        };\n    }\n    const { viewerUsername, objectId, objectType, objectMeta } = component.props;\n    const originalUrl = createReferredUrl(viewerUsername, objectId, objectType, objectMeta);\n    $.post('/get_short_url.json', { url: originalUrl })\n        .done(res => {\n            component.setState({ referrerURL: res.short_url }, cb);\n        })\n        .fail(() => {\n            component.setState({ referrerURL: originalUrl }, cb);\n            console.warn('/get_short_url failed');\n        });\n}\n","import React from 'react';\nimport classnames from 'classnames';\nimport { FancyUser, debounceUntilTimeout, MP, getDisplay, triggerEvent, alertify } from 'fancyutils';\nimport { ShareObjectTypes, getShareURL } from './MoreShareUtils';\n\nimport { Display } from 'fancymixin';\n\n\nconst SNSDict = { \"fb\": \"Facebook\", \"tw\": \"Twitter\", \"tb\": \"Tumblr\" };\n\nconst followingUsers = [];\nlet followingUsersRequested = false;\n\nconst ViewClasses = {\n    Success: 'empty success',\n    Default: 'empty default',\n    Searching: 'empty searching',\n    NoResult: 'empty no-result',\n};\n\n\nexport class SharePopover extends React.Component {\n    state = {\n        friendSearchQuery: '',\n        searchedFriends: [],\n        selectedUserID: null,\n        sentUser: null,\n        sendNote: '',\n        sendSuccess: false,\n        searching: false,\n        isContact: false,\n    };\n\n    mailUser = {\n        id: 'EMAIL',\n        type: 'email',\n        profile_image_url: '/_ui/images/common/blank.gif',\n        fullname: 'Email',\n        /* mut */ username: null,\n    };\n\n    constructor(props) {\n        super(props);\n        this.searchFriends = debounceUntilTimeout(function searchFriends(prevQuery, friendSearchQuery) {\n            if (this.isEmailOnlyMode()) {\n                this.setState({ searching: false });\n                return;\n            }\n\n            const term = $.trim(friendSearchQuery);\n            if ($.trim(prevQuery) === term) {\n                return;\n            }\n            if (term === '') {\n                this.setState({\n                    searchedFriends: [],\n                    selectedUserID: null,\n                });\n                return;\n            }\n            this.setState({ searching: true }, () => {\n                $.get('/search-users.json', {\n                    term, \n                    filter_messages_permission: true\n                })\n                .done(searchedFriends => {\n                    const nextState = { searching: false };\n                    if (this.state.friendSearchQuery === friendSearchQuery) {\n                        nextState.searchedFriends = searchedFriends;\n                        nextState.selectedUserID = null;\n                    }\n                    this.setState(nextState);\n                });\n            })\n        }, 200, this);\n    }\n\n    handleContinue = (event) => {\n        event.preventDefault();\n        this.clearFriendList();\n        if (this.props.handleHide) {\n            this.props.handleHide()\n        }\n    }\n\n    handleFriendSearch = (event) => {\n        const friendSearchQuery = event.target.value;\n        const prevQuery = this.state.friendSearchQuery;\n        this.setState({ friendSearchQuery, sendSuccess: false, searching: true }, () => {\n            this.searchFriends(prevQuery, friendSearchQuery);\n        });\n    }\n\n    handleSend = () => {\n        const { sendNote, selectedUserID, searchedFriends } = this.state;\n        const { title, referrerURL } = this.props;\n        if (this.sending) {\n            return;\n        }\n\n        const isMailuser = selectedUserID === this.mailUser.id;\n        if (isMailuser) {\n            this.handleSendMail();\n            return;\n        } else if (searchedFriends.length === 0 || selectedUserID == null) {\n            return;\n        }\n\n\n        const { objectType } = this.props;\n        let params;\n        if (objectType === ShareObjectTypes.thing) {\n            params = {\n                things: this.props.objectId,\n                user_id: selectedUserID\n            };\n        } else {\n            params = {\n                user_id: selectedUserID,\n                message: `${title} ${referrerURL}`,\n            };\n        }\n        \n        this.sending = true;\n        if ($.trim(sendNote)) {\n            params.message += (' ' + $.trim(sendNote));\n        }\n\n        $.post('/messages/send-message.json', params)\n            .done(json => {\n                if (json.status_code !== 1) {\n                    if (json.message) {\n                        alertify.alert(json.message);\n                    } else {\n                        alertify.alert(\"There was an error while sending message. Please try again.\");\n                    }\n                    return;\n                }\n                this.clearFriendList({\n                    sendSuccess: true,\n                    sentUserID: selectedUserID,\n                    selectedUserID: null,\n                }, ['searchedFriends']);\n                MP('Complete Share', { \"thing id\": params.things, \"type\": \"FancyMessage\" });\n            })\n            .fail(xhr => {\n                console.warn(xhr);\n            })\n            .always(() => {\n                this.sending = false;\n            });\n    }\n\n    handleSendMail = () => {\n        if (this.sending) {\n            return;\n        }\n        if (this.props.objectType == null) {\n            console.warn('objectType should be provided.');\n        }\n        const object_type = this.props.objectType || 'thing';\n        const email_address = this.mailUser.username.trim();\n\n        const object_id = this.props.objectId;\n        this.sending = true;\n        const params = { email_address, object_type, object_id };\n        const message = $.trim(this.state.sendNote);\n        if (message) {\n            params.message = message;\n        }\n        if (this.props.objectMeta && this.props.objectMeta.type === 'shoplist') {\n            params.object_meta = this.props.objectMeta.type;\n        }\n\n        $.post('/messages/send-email.json', params)\n            .done(json => {\n                if (json.status_code !== 1) {\n                    if (json.message) {\n                        alertify.alert(json.message);\n                    } else {\n                        alertify.alert(\"There was an error while sending message. Please try again.\");\n                    }\n                    return;\n                }\n                this.clearFriendList({\n                    sendSuccess: true,\n                    sentUserID: params.email_address,\n                    selectedUserID: null,\n                });\n                MP('Complete Share', { \"object id\": params.object_id, \"object type\": params.object_type, \"type\": \"Email\" });\n            })\n            .fail(xhr => {\n                var responseObject = null\n                try { responseObject = JSON.parse(xhr.responseText) } catch(e) { }\n                if(responseObject && responseObject.message) {\n                    alertify.alert(responseObject.message)\n                } else {\n                    alertify.alert(\"Error occured. please try again.\\n\"+xhr.status + ' ' + xhr.statusText);\n                }\n                console.warn(xhr);\n            })\n            .always(() => {\n                this.sending = false;\n            });\n    }\n\n    clearFriendList = (additionals, excludes) => {\n        // remove search history for users\n        const nextState = _.extend({\n            friendSearchQuery: '',\n            searchedFriends: [],\n            sendNote: '',\n            sendSuccess: false,\n            sentUserID: null,\n        }, additionals);\n        if (excludes) {\n            excludes.forEach(excludeKey => {\n                delete nextState[excludeKey];\n                nextState[excludeKey] = this.state[excludeKey];\n            });\n        }\n        this.setState(nextState);\n    }\n\n    handleSendNoteInput = (event) => {\n        const sendNote = event.target.value;\n        this.setState({ sendNote });\n    }\n\n    handleUserSelect = (event) => {\n        event.preventDefault();\n        const { selectedUserID } = this.state;\n        const nextID = $(event.currentTarget).attr('data-userid');\n        // Canceling\n        if (String(selectedUserID) === $(event.currentTarget).attr('data-userid')) {\n            this.setState({ selectedUserID: null });\n        // Selecting\n        } else {\n            this.setState({ selectedUserID: nextID });\n        }\n    }\n\n    getSelectedUser = () => {\n        const { selectedUserID } = this.state;\n        return _.find(this.getSearchedFriends(), e => String(e.id) === selectedUserID);\n    }\n\n    getSentUser = () => {\n        const { sentUserID } = this.state;\n        return _.find(this.getSearchedFriends(), e => String(e.id) === sentUserID);\n    }\n\n    getDisplayUsers = () => {\n        if (followingUsersRequested) {\n            return;\n        }\n        this.loadingDisplayUsers = true;\n        followingUsersRequested = true;\n        $.get('/get-share-display-users.json').done(res => {\n            if (res.status_code === 1 && res.users.length > 0) {\n                followingUsers.push.apply(followingUsers, res.users);\n            }\n        }).fail(() => {\n            console.warn('failed to fetch display users')\n        })\n        .always(() => {\n            this.loadingDisplayUsers = false;\n            this.forceUpdate();\n        });\n    }\n\n    handleClickBackFromContact = () => {\n        this.setState({ isContact: false });\n    }\n\n    handleClickContactImport = (event) => {\n        event.preventDefault();\n        this.setState({ isContact: true });\n    }\n\n    getSharedMailUser = () => {\n        const {\n            friendSearchQuery,\n        } = this.state;\n        this.mailUser.username = friendSearchQuery;\n        return [this.mailUser];\n    }\n\n    getSearchedFriends = () => {\n        if (\n            this.state.friendSearchQuery.length !== 0 || \n            this.state.sendSuccess\n        ) {\n            if (this.isInputEmail()) {\n                return this.getSharedMailUser();\n            } else {\n                return this.state.searchedFriends;\n            }\n        } else {\n            return followingUsers;\n        }\n    }\n\n    isInputEmail = () => {\n        const { friendSearchQuery } = this.state;\n        return friendSearchQuery.length > 1 && \n               friendSearchQuery.indexOf('@') > 0;\n    }\n\n    getPrefix(user) {\n        return user.type === 'email' ? '' : '@';\n    }\n\n    static getShareMessage(objectType, defaultMessage = '') {\n        let shareMessage = defaultMessage;\n        if (objectType === ShareObjectTypes.list) {\n            shareMessage = 'Share collection';\n        } else if (objectType === ShareObjectTypes.store) {\n            shareMessage = 'Share store';\n        } else if (objectType === ShareObjectTypes.user) {\n            shareMessage = 'Share profile';\n        } else if (objectType === ShareObjectTypes.article) {\n            shareMessage = 'Share article';\n        }\n        return shareMessage;\n    }\n\n    isEmailOnlyMode = () => {\n        return !(this.props.objectType === ShareObjectTypes.thing || this.props.objectType === ShareObjectTypes.article) || !FancyUser.loggedIn;\n    }\n\n    componentDidUpdate(prevProps) {\n        const { showShare } = this.props;\n        const { isContact } = this.state;\n        // share is closed, if contact mode close it.\n        if (isContact && !showShare && prevProps.showShare !== showShare) {\n            this.setState({ isContact: false });\n        }\n    }\n\n    componentDidMount() {\n        // Do loading friends stuff.\n        if (!this.isEmailOnlyMode()) {\n            this.getDisplayUsers();\n        }\n    }\n\n    render() {\n        const {\n            showShare,\n            title,\n            headerGap,\n            objectType,\n            objectId,\n            objectMeta,\n            viewerUsername,\n            referrerURL,\n        } = this.props;\n\n        if (process.env.NODE_ENV !== 'production') {\n            viewerUsername == null &&\n            console.warn('SharePopover: viewerUsername missing');\n        }\n\n        const {\n            friendSearchQuery,\n            sendNote,\n            sendSuccess,\n            sentUserID,\n            searching,\n            isContact\n        } = this.state;\n        const searchedFriends = this.getSearchedFriends();\n\n        const selectedUser = this.getSelectedUser();\n        const sentUser = this.getSentUser();\n\n        var emptyDisplay = Display.Block;\n        var emptyClassName;\n        var searchedFriendsDisplay;\n        const inputIsEmail = this.isInputEmail();\n        const emailOnlyMode = this.isEmailOnlyMode(); \n        // Search returns nothing\n        \n        if (sendSuccess) {\n            emptyClassName = ViewClasses.Success;\n        } else {\n            if (emailOnlyMode && !inputIsEmail) {\n                emptyClassName = ViewClasses.Default;\n            } else if (searchedFriends.length > 0) {\n                if (!inputIsEmail && searching) {\n                    emptyClassName = ViewClasses.Searching;\n                }\n            } else if (searchedFriends.length === 0) {\n                if (friendSearchQuery.length === 0) {\n                    if (this.loadingDisplayUsers) {\n                        emptyClassName = ViewClasses.Searching;\n                    } else {\n                        emptyClassName = ViewClasses.Default;\n                    }\n                } else {\n                    if (searching) {\n                        emptyClassName = ViewClasses.Searching;\n                    } else {\n                        emptyClassName = ViewClasses.NoResult;\n                    }\n                }\n            }\n        }\n\n        if (emptyClassName) {\n            searchedFriendsDisplay = Display.None;\n        } else {\n            emptyDisplay = Display.None;\n        }\n\n        if (selectedUser) {\n            searchedFriendsDisplay = Display.None;\n        }\n\n        const noteSendable = (\n            !this.sending &&\n            searchedFriends.length > 0 &&\n            !!selectedUser\n        );\n\n        // Sliding indicator style\n        const isSNS = !(selectedUser || sendSuccess);\n\n        let sentMessage = '';\n        if (sendSuccess) {\n            sentMessage += gettext(\"Sent to \");\n            sentMessage += sentUser ? (sentUser.fullname || sentUser.username) : sentUserID\n        }\n\n        let bottom = false;\n        if (headerGap < 290) {\n            bottom = true;\n        }\n\n        return (\n            <div id=\"show-share\" className={classnames(\"more-share-popup more-share-popup-2 has-arrow\", { bot: bottom })} style={getDisplay(showShare)}>\n                <h3 className=\"tit\" style={Display.NoneIf(isContact || selectedUser)}>{SharePopover.getShareMessage(objectType, 'Share')}</h3>\n                <a className=\"btn-back\" style={Display.NoneIf(!selectedUser || sentUser)}\n                   onClick={() => {this.setState({ selectedUserID: null });return false;}}>Back</a>\n                <div className=\"frm\" style={Display.NoneIf(isContact)}>\n                    {FancyUser.loggedIn &&\n                    <div id=\"more-share-send\">\n                        <span className=\"textbox before-bg-share2\" style={Display.NoneIf(selectedUser || sendSuccess)}>\n                            <input id=\"more-share-email\"\n                                   className=\"text\" type=\"text\"\n                                   placeholder={emailOnlyMode ? gettext(\"Enter email address\") : gettext(\"Username or email address\")}\n                                   autoComplete=\"off\"\n                                   onChange={this.handleFriendSearch}\n                                   value={friendSearchQuery} />\n                        </span>\n                        <ul className=\"lists\" style={searchedFriendsDisplay}>\n                            {searchedFriends\n                                .map((user, idx) => {\n                                    const term = $.trim(friendSearchQuery).toLowerCase();\n                                    const prefix = this.getPrefix(user);\n                                    let style;\n                                    if (term) {\n                                        if (\n                                            `${user.fullname} ${prefix}${user.username}`.toLowerCase().indexOf(term) === -1\n                                        ) {\n                                            style = Display.None;\n                                        }\n                                    }\n                                    let username;\n                                    let imgClass;\n                                    if (user.type === 'email') {\n                                        username = user.username;\n                                        imgClass = 'email';\n                                    } else {\n                                        username = `${prefix}${user.username}`;\n                                    }\n\n                                    return (\n                                        <li key={idx} style={style}>\n                                            <a className=\"before-bg-share2\"\n                                                onClick={this.handleUserSelect}\n                                                data-userid={user.id}>\n                                                <img alt=\"\" className={imgClass} src={user.profile_image_url} />\n                                                <b>{user.fullname}</b>\n                                                <small>{username}</small>\n                                            </a>\n                                        </li>\n                                    )\n                            })}\n                        </ul>\n                        <div className={emptyClassName} style={emptyDisplay}>\n                            <i className=\"circle bg-share2\" />\n                            {emailOnlyMode ?\n                                <span className=\"default\">\n                                    {gettext(\"Share this via Email\")}\n                                </span>\n                                :\n                                <span className=\"default\">\n                                    <b>{gettext(\"Find people to share with\")}</b>\n                                    <a onClick={this.handleClickContactImport}>{gettext(\"Import from contacts\")}</a>\n                                </span>\n                            }\n                            <span className=\"searching\">\n                                {gettext(\"Searching...\")}\n                            </span>\n                            <span className=\"no-result\">\n                                {gettext(\"No users found\")}\n                            </span>\n                            <span className=\"success\">\n                                <b>{gettext(\"Success!\")}</b>\n                                {sentMessage}\n                                <a className=\"close\" onClick={this.handleContinue}>{gettext(\"Continue\")}</a>\n                            </span>\n                        </div>\n                        <div className=\"send\" style={Display.NoneIf(selectedUser == null)}>\n                            {selectedUser && \n                                <span className=\"recipient\">\n                                    <img alt=\"user image\" className={selectedUser.type === 'email' && 'email'} src={selectedUser.profile_image_url} />\n                                    <b>{selectedUser.fullname}</b>\n                                    <small>{this.getPrefix(selectedUser)}{selectedUser.username}</small>\n                                </span>\n                            }\n                            <fieldset>\n                                <textarea placeholder=\"Add a message\" value={sendNote} onChange={this.handleSendNoteInput} />\n                                <button className=\"btn-send\" disabled={!noteSendable} onClick={this.handleSend}>Send</button>\n                            </fieldset>\n                        </div>\n                    </div>\n                    }\n                    <SNSShareBox showShareBox={isSNS} title={title} referrerURL={referrerURL}\n                                 objectId={objectId} objectType={objectType} objectMeta={objectMeta}\n                                 viewerUsername={viewerUsername} />\n                </div>\n                <div className=\"contact-sns\" style={Display.NoneIf(!isContact)}>\n                    <a onClick={this.handleClickBackFromContact} className=\"back\">Back</a>\n                    <a href=\"/find-friends\" className=\"fb\" target=\"_blank\"><em> Facebook</em></a>\n                    <a href=\"/find-friends?type=twitter\" className=\"tw\" target=\"_blank\"><em> Twitter</em></a>\n                    <a href=\"/find-friends?type=gmail\" className=\"gm\" target=\"_blank\"><em> Gmail</em></a>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport class SNSShareBox extends React.Component {\n    state = {\n        copied: false,\n        referrerURL: '',\n        textboxDisplay: false\n    };\n    loading = false;\n    snsShareWindow = null;\n\n    getRefURL() {\n        return this.state.referrerURL || this.props.referrerURL\n    }\n\n    updateEmbedOption($li, viewerUsername) {\n        const $thumb = $li.find('.embed-thum');\n        const $options = $li.find('input[name=\"embed-info\"]');\n        const types = [];\n\n        $options.each(function() {\n            const { value, checked } = this;\n            if (checked) {\n                $thumb.addClass(value);\n                types.push(value);\n            } else {\n                $thumb.removeClass(value);\n            }\n        });\n        const width = parseInt($li.find('input[name=\"embed-width\"]').val(), 10) || undefined;\n\n        const snippet = $('<script />', {\n            'src': `//${location.hostname}/embed.js?v=150608`,\n            'async': true,\n            'class': 'fancy-embed',\n            'data-id': $li.attr('tid') || $li.attr('objectId') || '',\n            'data-ref': viewerUsername,\n            'data-type': types.length > 0 ? types.join(',') : '',\n            'data-width': width\n        }).prop('outerHTML');\n        $li.find('textarea[name=\"embed-code\"]').val(snippet);\n    }\n\n    handleEmbed = () => {\n        const { updateEmbedOption, props: { objectType, objectId, viewerUsername } } = this;\n\n        if (objectType === ShareObjectTypes.thing) {\n            const $ep = $(\"#embed_popup\");\n            $ep\n                .off('click.fancyembed')\n                .off('keyup.fancyembed')\n                .on('click.fancyembed', 'input[name=\"embed-info\"]', function() {\n                    updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n                })\n                .on('keyup.fancyembed', 'input[name=\"embed-width\"]', function() {\n                    updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n                });\n\n            $ep.find('.customize').removeClass('opened');\n            $ep.find('input[name=\"embed-info\"]').prop('checked', true);\n            $ep.find('input[name=\"embed-width\"]').val(450);\n            $ep.attr('tid', objectId);\n            updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n\n            $.dialog(\"embed_item\").open(true);\n        }\n\n        return false;\n    }\n\n    handleShare = (event) => {\n        const { props: { objectId, objectType } } = this;\n        const element = event.currentTarget;\n\n        // redirect to acquired URL using blank window, which does not blocked by blocker usually.\n        // Low possiblity, but if assign fails with DOMException, silently pass so\n        // user can retry without confusion.\n        if (event.detail && event.detail.faintClick) {\n            try {\n                this.snsShareWindow.location.assign(element.getAttribute('href'));\n            } catch (e) {}\n            // Remove disposable window \n            this.snsShareWindow = null;\n            return;\n        } else {\n            if (!this.getRefURL()) {\n                this.snsShareWindow = window.open('about:blank', '_fancy_sns_share');\n            }\n            event.preventDefault();\n        }\n\n        getShareURL(this, (directClick) => {\n            if (directClick) {\n                window.open(element.getAttribute('href'), '_fancy_sns_share');\n            } else {\n                triggerEvent(element, 'click', { faintClick: true });\n            }\n        });\n\n        if (objectType === ShareObjectTypes.thing) {\n            const type = SNSDict[element.className];\n            MP('Complete Share', { \"thing id\": objectId, type });\n        }\n    }\n\n    render() {\n        const { title, showShareBox, objectType } = this.props;\n        const { textboxDisplay } = this.state;\n        const referrerURL = this.getRefURL()\n\n        return (\n            <div id=\"more-share-sns\" className=\"more-share-sns\" style={showShareBox ? Display.Block : Display.None}>\n                <span className=\"via after\" style={Display.NoneIf(textboxDisplay)}>\n                    <a href={`https://www.facebook.com/sharer.php?u=${referrerURL}`}\n                        onClick={this.handleShare} className=\"fb\" target=\"_blank\">\n                        <span className=\"ic-fb\" /> <em>{gettext(\"Share with Facebook\")}</em>\n                    </a>\n                    <a href={`https://twitter.com/share?text=${encodeURI(title)}&url=${referrerURL}&via=fancy`}\n                        onClick={this.handleShare} className=\"tw\" target=\"_blank\">\n                        <span className=\"ic-tw\" /> <em>{gettext(\"Share with Twitter\")}</em>\n                    </a>\n                    <a href={`https://www.tumblr.com/share/link?url=${referrerURL}&name=${encodeURI(title)}&description=${encodeURI(title)}`}\n                        onClick={this.handleShare} className=\"tb\" target=\"_blank\">\n                        <span className=\"ic-tb\" /> <em>{gettext(\"Share with Tumblr\")}</em>\n                    </a>\n                    {objectType === ShareObjectTypes.thing &&\n                        <a onClick={this.handleEmbed} className=\"embed\">\n                            <span className=\"ic-em\" /> <em>{gettext(\"Embed this item\")}</em>\n                        </a>\n                    }\n                </span>\n            </div>\n        );\n    }\n}\n","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { KEYS, MP, getDisplay, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\n\nexport class AddlistPopover extends Component {\n    state = {\n        lists: [],\n        wanted: false,\n        listSearchQuery: '',\n        listCreationQuery: '',\n        createListFocused: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    drawUserList(objectId) {\n        objectId = objectId || this.props.objectId;\n        getListCheckbox({\n            merchantId: this.props.merchantId,\n            objectId,\n            callback: res => { this.setStateSafe(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setStateSafe({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId, objectType, merchantId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        // save new list\n        createList({\n            merchantId,\n            listCreationQuery,\n            callback: () => {\n                this.setStateSafe({ listCreationQuery: '' }, () => {\n                    this.drawUserList(objectId);\n                    this.quickCreateList.focus();\n                    if (objectType === 'thing') {\n                        MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    }\n                })\n            }\n        })\n    }\n\n    handleWishlistCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectType, objectId, handleHide } = this.props;\n        const name = 'wanted';\n        const params = { owned: false, wanted: targ.checked };\n        const eventName = targ.checked ? \"Add to List\" : \"Remove from List\";\n\n        if (objectType === 'thing') {\n            if (params.wanted && window.dataLayer) {\n                window.dataLayer.push({'event': 'Add_to_Wishlist_Check', 'product_id': undefined, 'products_info': undefined, 'products': undefined, 'revenue': undefined, 'option_id': undefined });\n            }\n\n            $.ajax(`/rest-api/v1/things/${objectId}`, { type:'PUT', data: params })\n                .done(() => {\n                    this.drawUserList(objectId);\n                    this.setStateSafe({ wanted: params.wanted });\n                    if (params.wanted) {\n                        handleHide && handleHide();\n                    }\n                })\n                .error(err => { console.warn(err); });\n\n            MP(eventName, { 'thing id': objectId, 'list name': name, 'list id': -1, 'via': 'thing detail' });\n        } else {\n            console.warn('Add to list does not work with non-thing type')\n            return;\n        }\n    }\n\n    handleListCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const isChecked = targ.checked;\n        const { objectId, objectType, handleHide, merchantId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = targ.getAttribute('data-listid')\n        const collectionAction = [Number(selectedListId), targ.checked]\n\n        if (objectType === 'thing') {\n            const eventName = isChecked ? \"Add to List\" : \"Remove from List\";\n            const theList = lists.filter(list => list.id === selectedListId)[0];\n            const callback = () => {\n                this.drawUserList(objectId);\n                if (isChecked) {\n                    handleHide && handleHide();\n                }\n                MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n            };\n\n            if (merchantId) {\n                updateList({ merchantId, objectId, collectionAction, callback })\n            } else {\n                const checked = [];\n                const unchecked = [];\n                $(this.lists).find('input[type=\"checkbox\"]:not(.tag)').each(function() {\n                    const listId = this.getAttribute('data-listid');\n                    if (this.checked) {\n                        checked.push(listId);\n                    } else {\n                        unchecked.push(listId)\n                    }\n                });\n                updateList({ checked, unchecked, objectId, callback })\n            }\n\n        } else {\n            console.warn('Add to list does not work with non-thing type')\n            return;\n        }\n    }\n\n    isWishlistQuery(listSearchQuery) {\n        return 'wishlist'.indexOf($.trim(listSearchQuery).toLowerCase()) !== -1\n    }\n\n    handleCreateListLabelClick = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setStateSafe({ createListFocused: true }, () => {\n            this.quickCreateList.focus();\n        });\n    }\n\n    handleCreateListBlur = () => {\n        this.setStateSafe({ createListFocused: false });\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setStateSafe({ listCreationQuery: event.target.value });\n    }\n\n    componentDidMount() {\n        this.mounted = true;\n        this.listDrawn = false;\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n    }\n\n    componentDidUpdate(pp) {\n        if (\n            (pp.showList !== this.props.showList || this.listDrawn === false) &&\n            this.props.showList === true\n        ) {\n            if (this.listDrawn === false) {\n                this.listDrawn = true\n            }\n            this.drawUserList(this.props.objectId);\n            setTimeout(() => {\n                this.listSearchInput.focus();\n            }, 0);\n        }\n    }\n\n    render() {\n        var { objectId, showList, headerGap, merchantId } = this.props;\n        var {\n            lists,\n            wanted,\n            listSearchQuery,\n            listCreationQuery,\n            createListFocused\n        } = this.state;\n\n        return (\n            <div id=\"show-addlist\" className={classnames(\"has-arrow more-share-popup\", { bot: headerGap && (headerGap < 16 + 269) /*= tip + bubble*/ })}\n                 style={getDisplay(showList)}>\n                <span className=\"tit\">{merchantId ? gettext(\"Add to Collection\") : gettext(\"Add to List\")}</span>\n                <span className=\"search before-bg-share2\">\n                    <input ref={(element) => {this.listSearchInput = element;}}\n                            type=\"text\"\n                            className=\"text\"\n                            placeholder={merchantId ? gettext('Search your collections') : gettext('Search your lists')}\n                            value={listSearchQuery}\n                            onChange={this.handleListSearch} />\n                </span>\n                <ul className=\"lists\" ref={(element) => {this.lists = element;}}>\n                    {!merchantId && <li>\n                        <label htmlFor={`wanted-${objectId}`}>\n                            <input type=\"checkbox\" name=\"wanted\"\n                                   checked={wanted}\n                                   id={`wanted-${objectId}`}\n                                   className={`tag ${wanted ? 'checked' : ''}`}\n                                   style={{ display: this.isWishlistQuery(listSearchQuery) ? null : 'none' }}\n                                   onChange={this.handleWishlistCheckboxChange} /> {gettext('Wish List')}</label>\n                    </li>}\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const className = list.selected ? \"selected\" : null;\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style}>\n                                <label htmlFor={ident}>\n                                    <input className={className}\n                                           type=\"checkbox\" name={ident} id={ident}\n                                           checked={list.selected}\n                                           data-listid={list.id}\n                                           onChange={this.handleListCheckboxChange} /> {list.name}</label>\n                            </li>\n                        )\n                    })}\n                </ul>\n                <div className=\"new-list\">\n                    <label htmlFor=\"quick-create-list\"\n                            style={{ display: createListFocused ? 'none' : 'block' }}\n                            onClick={this.handleCreateListLabelClick}>\n                        <i className=\"icon\" />{merchantId ? gettext('Create New Collection') : gettext(\"Create New List\")}</label>\n                    <input type=\"text\"\n                            id=\"quick-create-list\"\n                            ref={(element) => {this.quickCreateList = element;}}\n                            onBlur={this.handleCreateListBlur}\n                            onKeyUp={this.handleListCreation}\n                            onChange={this.handleCreateListQueryChange}\n                            value={listCreationQuery}\n                            placeholder={merchantId ? gettext('Create New Collection') : gettext(\"Create New List\")} />\n                    <button className=\"btn-create\"\n                            onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </div>\n            </div>\n        );\n    }\n}\n\nfunction getListCheckbox({ merchantId, objectId, callback }) {\n    if (merchantId) {\n        $.get(`/rest-api/v1/seller/${merchantId}/collections`, { selected_object_id: objectId }).done(({ collections } = {}) => {\n            let lists;\n            if (collections.length > 0) {\n                lists = collections.sort((a, b) => {\n                    var aText = $.trim(a).toLowerCase();\n                    var bText = $.trim(b).toLowerCase();\n                    return aText < bText ? -1 : 1;\n                }).map(({ id, name, selected }) => {\n                    return {\n                        id,\n                        name,\n                        selected\n                    };\n                })\n            } else {\n                lists = [];\n            }\n            callback && callback({ lists, wanted: null });\n        })\n        .error(err => { console.warn(err); });\n    } else {\n        $.get('/_get_list_checkbox.html', { tid: objectId }).done(html => {\n            const $html = $(html);\n            const $items = $html.filter('li').find('img').remove().end();\n            var lists;\n            if ($items.length > 0) {\n                lists = $items.sort((a, b) => {\n                    var aText = $.trim($(a).text()).toLowerCase();\n                    var bText = $.trim($(b).text()).toLowerCase();\n                    return aText < bText ? -1 : 1;\n                }).map((_, item) => {\n                    var $item = $(item);\n                    return {\n                        id: $item.find('label').attr('for'),\n                        name: $.trim($item.find('label').text()),\n                        selected: $item.find('input').prop('checked'),\n                    };\n                }).get();\n            } else {\n                lists = [];\n            }\n            const wanted = $html.filter('input[name=\"wanted\"]').val() === 'true';\n            callback && callback({ lists, wanted });\n        })\n        .error(err => { console.warn(err); });\n    }\n}\n\n\nfunction createList({ merchantId, listCreationQuery, callback }) {\n    if (merchantId) {\n        $.post(`/rest-api/v1/seller/${merchantId}/collections`, { list_name: listCreationQuery })\n            .done(res => {\n                // if ($(res).find(\"created\").text() == 'False') {\n                // if (false){\n                //     alertify.alert(`List Title Not Available`, `There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                // } else {\n                    callback && callback();\n                // }\n            })\n            .error(err => { console.warn(err); });\n    } else {\n        $.post('/create_list.xml', { list_name: listCreationQuery, reaction: 0 })\n            .done(res => {\n                if ($(res).find(\"created\").text() == 'False') {\n                    alertify.alert(`<b>List Title Not Available</b><br><br>There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                } else {\n                    callback && callback();\n                }\n            })\n            .error(err => { console.warn(err); });\n    }\n}\n\nfunction updateList({ merchantId, collectionAction, objectId, checked, unchecked, callback }) {\n    if (merchantId) {\n        const [collectionId, add] = collectionAction\n        $.ajax({\n            url: `/rest-api/v1/seller/${merchantId}/collections/${collectionId}`,\n            type: 'POST',\n            data: {\n                object_id: objectId,\n                action: add ? 'add': 'remove',\n            },\n        })\n        .done(callback)\n        .error(err => { console.warn(err); })\n    } else {\n        $.post('/save_list_items', {\n            tid: objectId,\n            checked_list_ids: checked.join(','),\n            unchecked_list_ids: unchecked.join(',')\n        })\n        .done(callback)\n        .error(err => { console.warn(err); })\n    }\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\n\nimport { isPlainLeftClick } from \"fancyutils\";\nimport { ShareObjectTypes } from './MoreShareUtils';\n\n\nexport class FancydPerson extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            loading: false,\n            following: false\n        };\n    }\n\n    componentDidMount() {\n        const following = this.props.following || this.props.user.following;\n        if (following) {\n            this.setState({ following });\n        }\n    }\n\n    handleFollow = event => {\n        event.preventDefault();\n        event.stopPropagation();\n\n        const { user } = this.props;\n        const { following, loading } = this.state;\n\n        if (this.props.loggedIn !== true) {\n            window.require_login();\n            return;\n        }\n\n        if (loading) {\n            return;\n        }\n\n        const url = following ? \"/delete_follow.xml\" : \"/add_follow.xml\";\n\n        this.setState({ loading: true }, () => {\n            $.ajax({\n                type: \"post\",\n                url,\n                data: { user_id: user.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    const nextFollowing = !following;\n                    const $status = $(xml).find(\"status_code\");\n                    if ($status.length && $status.text() !== 0) {\n                        this.setState({ following: nextFollowing });\n                    }\n                })\n                .always(() => {\n                    this.setState({ loading: false });\n                });\n        });\n    };\n\n    handleTransition = event => {\n        if (isPlainLeftClick(event)) {\n            const href = event.currentTarget.getAttribute(\"href\");\n            if (href) {\n                location.href = href;\n            }\n        }\n    };\n\n    render() {\n        const { user, isAddedUser, viewerId } = this.props;\n        const { following } = this.state;\n\n        return (\n            <li>\n                <a href={`/${user.username}`} className=\"username\" onClick={this.handleTransition}>\n                    <img\n                        src=\"/_ui/images/common/blank.gif\"\n                        style={{ backgroundImage: `url(${user.image_url || user.user_square_image_small})` }}\n                    />\n                    {isAddedUser ? \"Added by \" : \"\"}\n                    <b>{user.fullname || user.full_name}</b>\n                    {isAddedUser ? \"\" : `@${user.username}`}\n                </a>\n                {viewerId !== user.id && (\n                    <button\n                        className={classnames(\"btns-gray-embo\", following ? \"following\" : \"follow\")}\n                        onClick={this.handleFollow}\n                    />\n                )}\n            </li>\n        );\n    }\n}\n\nexport class FancydByPopup extends React.Component {\n    static popupName = \"fancyd_list\";\n\n    constructor(props) {\n        super(props);\n        this.state = this._getInitialState();\n    }\n\n    _getInitialState() {\n        return {\n            loading: false,\n            nextPage: 1,\n            ended: null,\n            added_user: null,\n            users: [],\n            owner: null\n        };\n    }\n\n    getFollowList(nextProps, reset) {\n        const { objectId, objectType } = nextProps || this.props;\n        const { nextPage } = this.state;\n\n        var immediateNextStateUpdate;\n        if (reset) {\n            immediateNextStateUpdate = this._getInitialState();\n            immediateNextStateUpdate.loading = true;\n        } else {\n            immediateNextStateUpdate = { loading: true };\n        }\n\n        if (reset || (this.state.loading !== true && this.state.ended !== true)) {\n            this.setState(immediateNextStateUpdate, () => {\n                if (objectType === ShareObjectTypes.thing) {\n                    $.get(\"/thing_follower_list.json\", { thing_id: objectId, page: nextPage }, ({ has_next, users, owner }) => {\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                } else if (objectType === ShareObjectTypes.article) {\n                    $.get(`/rest-api/v1/articles/${objectId}/saved_users`, { page: nextPage }, ({ max_page, current_page, saved_users }) => {\n                        const users = saved_users;\n                        const has_next = max_page > current_page;\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner: null };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                }\n                \n            });\n        }\n    }\n\n    componentDidMount() {\n        this.getFollowList();\n        this.__last_tid = this.props.objectId;\n    }\n\n    componentDidUpdate(nextProps) {\n        if (this.__last_tid !== nextProps.objectId) {\n            this.__last_tid = nextProps.objectId;\n            this.getFollowList(nextProps, true);\n        }\n    }\n\n    handleMore = event => {\n        event.preventDefault();\n        this.getFollowList();\n    };\n\n    render() {\n        const { ended, users, owner } = this.state;\n        const { loggedIn, viewerId } = this.props;\n        return (\n            <div>\n                {/* TODO: via-overlay is needed to distinguish jQuery-attached Events and React Events -\n                    need to deliver better alternative \n                    rel task: https://app.asana.com/0/86925821949642/152825012917493 */}\n                <p className=\"ltit\">{gettext(\"Fancy'd by\")}</p>\n                <ul>\n                    {owner ? (\n                        <FancydPerson user={owner} isAddedUser={true} viewerId={viewerId} loggedIn={loggedIn} />\n                    ) : null}\n                    {users.map((user, idx) => (\n                        <FancydPerson key={`FancydBy-${idx}`} user={user} viewerId={viewerId} loggedIn={loggedIn} />\n                    ))}\n                    {ended === false && (\n                        <li className=\"more\">\n                            <a onClick={this.handleMore}>{gettext(\"View More\")}</a>\n                        </li>\n                    )}\n                </ul>\n                <button className=\"ly-close\" title=\"Close\">\n                    <i className=\"ic-del-black\" />\n                </button>\n            </div>\n        );\n    }\n}\n\nexport class FancydByPopupV4 extends React.Component {\n    static popupName = \"fancyd_list\";\n\n    constructor(props) {\n        super(props);\n        this.state = this._getInitialState();\n    }\n\n    _getInitialState() {\n        return {\n            loading: false,\n            nextPage: 1,\n            next_cursor: null,\n            ended: null,\n            added_user: null,\n            users: [],\n            owner: null\n        };\n    }\n\n    getFollowList(nextProps, reset) {\n        const { objectId, objectType, next_cursor } = nextProps || this.props;\n        const { nextPage } = this.state;\n\n        var immediateNextStateUpdate;\n        if (reset) {\n            immediateNextStateUpdate = this._getInitialState();\n            immediateNextStateUpdate.loading = true;\n        } else {\n            immediateNextStateUpdate = { loading: true };\n        }\n\n        if (reset || (this.state.loading !== true && this.state.ended !== true)) {\n            this.setState(immediateNextStateUpdate, () => {\n                if (objectType === ShareObjectTypes.thing) {\n                    const args = {};\n                    if (!!next_cursor) {\n                        args.cursor = next_cursor;\n                    }\n\n                    $.get(`/rest-api/v1/things/${objectId}/fancyd-users`, args, ({ next_cursor, fancyd_users }) => {\n                        const nextState = { loading: false, users: this.state.users.concat(fancyd_users), owner: null };\n                        if (!!next_cursor) {\n                            nextState.next_cursor = next_cursor;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                } else if (objectType === ShareObjectTypes.article) {\n                    $.get(`/rest-api/v1/articles/${objectId}/saved_users`, { page: nextPage }, ({ max_page, current_page, saved_users }) => {\n                        const users = saved_users;\n                        const has_next = max_page > current_page;\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner: null };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                }\n                \n            });\n        }\n    }\n\n    componentDidMount() {\n        this.getFollowList();\n        this.__last_tid = this.props.objectId;\n    }\n\n    componentDidUpdate(nextProps) {\n        if (this.__last_tid !== nextProps.objectId) {\n            this.__last_tid = nextProps.objectId;\n            this.getFollowList(nextProps, true);\n        }\n    }\n\n    handleMore = event => {\n        event.preventDefault();\n        this.getFollowList();\n    };\n\n    handleScroll = (e) => {\n        const el = e.target;\n        if (this.state.ended) {\n            return;\n        }\n\n        if ((el.scrollHeight - 50) <= (el.clientHeight + el.scrollTop)) {\n            this.getFollowList();\n        }\n    }\n\n    render() {\n        const { users, owner } = this.state;\n        const { loggedIn, loading, viewerId } = this.props;\n        return (\n            <div>\n                {/* TODO: via-overlay is needed to distinguish jQuery-attached Events and React Events -\n                    need to deliver better alternative \n                    rel task: https://app.asana.com/0/86925821949642/152825012917493 */}\n                <p className=\"ltit\">{gettext(\"Liked by\")}</p>\n                <ul onScroll={this.handleScroll}>\n                    {owner ? (\n                        <FancydPerson user={owner} isAddedUser={true} viewerId={viewerId} loggedIn={loggedIn} />\n                    ) : null}\n                    {users.map((user, idx) => (\n                        <FancydPerson key={`FancydBy-${idx}`} user={user} viewerId={viewerId} loggedIn={loggedIn} />\n                    ))}\n                    {loading && (\n                        <div id=\"infscr-loading\">\n                            <img alt=\"Loading...\" src=\"/_ui/images/common/loading.gif\" />\n                        <div />\n                    </div>\n                    )}\n                </ul>\n                <button className=\"ly-close\" title=\"Close\">\n                    <i className=\"ic-del-black\" />\n                </button>\n            </div>\n        );\n    }\n}\n\n// const onLoad = () => { \n//     $(document.body).on(\"click\", \".buttons .fancyd_user\", function() {\n//         if ($(this).closest('#overlay-thing').length > 0) {\n//             return true;\n//         }\n//         const $container = $(this).closest(\".buttons\");\n//         const objectId = $container.find(\".fancy, .fancyd\").attr(\"tid\");\n//         const objectType = 'thing';\n//         if (objectId) {\n//             renderPopup(FancydByPopup, { objectId, objectType, loggedIn: FancyUser.loggedIn, viewerId: FancyUser.id });\n//             return false;\n//         }\n//     });\n// }\n\n// if (document.readyState !== 'loading') {\n//     onLoad()\n// } else {\n//     document.addEventListener(\"DOMContentLoaded\", onLoad)\n// }\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { renderPopup, copyToClipboard, isElementOutsideViewport, MP, ClickOutside, FancyUser } from \"fancyutils\";\nimport { getElementGapFromHeader } from \"fancymixin\";\n\nimport { SharePopover } from \"./SharePopover\";\nimport { AddlistPopover } from \"./AddlistPopover\";\nimport { ShareObjectTypes, getShareURL } from \"./MoreShareUtils\";\nimport { FancydByPopup } from \"./Popup\";\n\n// returns dictionary with only one value true and else is false\nfunction makeToggle(keys) {\n    const obj = {};\n    return function toggle(...toggleKeys) {\n        keys.forEach(key => {\n            obj[key] = false;\n        });\n        if (toggleKeys) {\n            toggleKeys.forEach(key => {\n                obj[key] = true;\n            });\n        }\n        return obj;\n    };\n}\nconst toggleShow = makeToggle([\"showShare\", \"showList\", \"showSellerList\", \"showMenu\"]);\n\n\n\nexport class MoreShare extends Component {\n    state = {\n        showShare: false,\n        showList: false,\n        showMenu: false,\n        headerGap: null,\n\n        referrerURL: null,\n        linkCopied: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    componentDidMount() {\n        this.mounted = true;\n        this.clickOutside = new ClickOutside({ component: this, popupElementRefKey: \"MoreShareEl\" });\n        \n        if (this.props.facadeShowShare) {\n            this.handleShareDisplay();\n        }\n        if (this.props.facadeShowList) {\n            this.handleMoreShareToggle();\n        }\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n        this.clickOutside.destroy();\n    }\n\n    componentDidUpdate(pp, ps) {\n        const ns = this.state;\n        const { showList, showShare, showMenu } = ns;\n        if (showList || showShare || showMenu) {\n            this.clickOutside.handleAttach(this.closePopup);\n            this.checkViewport();\n\n            if (showShare || showMenu) {\n                getShareURL(this);\n            }\n        }\n\n        if (ns.showMenu !== ps.showMenu && ns.showMenu === false) {\n            this.setState({ linkCopied: false });\n            clearTimeout(this.linkCopiedRemovalTimer);\n            this.linkCopiedRemovalTimer = null;\n        }\n    }\n\n    handleShareDisplay = () => {\n        this.setStateSafe(\n            {\n                showShare: !this.state.showShare,\n                showList: false,\n                showMenu: false,\n                headerGap: getElementGapFromHeader(this.moreMenuButton)\n            },\n            this.handleHook\n        );\n        if (this.props.objectType === ShareObjectTypes.thing) {\n            MP(\"Share\", { \"thing id\": this.props.objectId });\n        }\n    };\n\n    handleListDisplay = () => {\n        if (!FancyUser.loggedIn) {\n            this.closePopup();\n            window.require_login();\n            return;\n        }\n        const showList = !this.state.showList;\n        this.setStateSafe(toggleShow(showList ? \"showList\" : null), this.handleHook);\n    };\n\n    handleMerchantListDisplay = () => {\n        if (!FancyUser.loggedIn) {\n            this.closePopup();\n            window.require_login();\n            return;\n        }\n        const showSellerList = !this.state.showSellerList;\n        this.setStateSafe(toggleShow(showSellerList ? \"showSellerList\" : null), this.handleHook);\n    };\n\n    closePopup = () => {\n        this.removeViewportCheck();\n        this.setStateSafe(toggleShow(), this.handleHook);\n    };\n\n    viewPortChecking = false;\n    evtName = \"scrollstop.MoreShare\";\n    checkViewport = () => {\n        if (this.viewPortChecking) {\n            return;\n        }\n        this.viewPortChecking = true;\n        $(window).on(this.evtName, () => {\n            const $root = $(this.MoreShareEl);\n            const headerEl = $(\"#header .header-featured\").get(0);\n\n            const { showMenu, showShare, showList, showSellerList } = this.state;\n            let sel;\n            if (showMenu) {\n                sel = \"#more-menu\";\n            } else if (showShare) {\n                sel = \"#show-share\";\n            } else if (showList || showSellerList) {\n                sel = \"#show-addlist\";\n            }\n            const el = $root.find(sel).get(0);\n            if (el) {\n                const outsideViewport = isElementOutsideViewport(el, { element: headerEl, type: \"top\" });\n\n                if (outsideViewport) {\n                    this.closePopup();\n                }\n            }\n        });\n    };\n\n    removeViewportCheck = () => {\n        this.viewPortChecking = false;\n        $(window).off(this.evtName);\n    };\n\n    handleMoreShareToggle = () => {\n        const { objectType } = this.props;\n        const { showMenu, showShare, showList, showSellerList } = this.state;\n        // thing types will show menu\n        if (objectType === ShareObjectTypes.thing || objectType === ShareObjectTypes.article) {\n            if (showMenu || showShare || showList || showSellerList) {\n                this.closePopup();\n            } else {\n                this.setStateSafe(\n                    {\n                        showMenu: true,\n                        headerGap: getElementGapFromHeader(this.moreMenuButton)\n                    },\n                    this.handleHook\n                );\n            }\n            // non-thing types will show share popover directly, because add-to-list is not available\n        } else {\n            this.handleShareDisplay();\n        }\n        return false;\n    };\n\n    handleHook = () => {\n        if (this.props.onShowSomething) {\n            const { showList, showShare, showMenu, showSellerList } = this.state;\n            this.props.onShowSomething(showList || showShare || showMenu || showSellerList, this);\n        }\n    };\n\n    handleHideList = () => {\n        this.setStateSafe({ showList: false });\n    };\n\n    handleHideShare = () => {\n        this.setStateSafe({ showShare: false });\n    };\n\n    linkCopiedRemovalTimer = null;\n    handleCopyLink = () => {\n        if (this.linkCopiedRemovalTimer != null) {\n            return;\n        }\n        copyToClipboard(this.state.referrerURL, {\n            cb: () => {\n                this.setState({ linkCopied: true });\n                this.linkCopiedRemovalTimer = setTimeout(() => {\n                    this.setState({ linkCopied: false });\n                }, 5000);\n            }\n        });\n    };\n\n    handleFancydByDisplay = () => {\n        event.preventDefault();\n        event.stopPropagation();\n        const { viewerUsername, objectId, objectType } = this.props;\n\n        renderPopup(FancydByPopup, { objectId, objectType, loggedIn: FancyUser.loggedIn, viewerId: viewerUsername });\n    };\n\n    shouldShowMerchantCollection() {\n        return FancyUser.merchant && FancyUser.active_merchant;\n    }\n\n    render() {\n        const {\n            title,\n            viewerUsername,\n            componentClass = \"menu-container\",\n            btnClass = \"btn-more\",\n            objectType,\n            objectMeta,\n            objectId,\n            showShortcuts = true,\n            fromThingSidebar = false\n        } = this.props;\n\n        if (objectType == null) {\n            console.warn(\"objectType is not defined\");\n        }\n\n        const {\n            showShare,\n            showList,\n            showMenu,\n            headerGap,\n            referrerURL,\n            linkCopied,\n            showSellerList\n        } = this.state;\n        const isThing = objectType === ShareObjectTypes.thing;\n        const isArticle = objectType === ShareObjectTypes.article;\n\n        let showMerchantList = this.shouldShowMerchantCollection();\n        let merchantId = showMerchantList && showSellerList ? FancyUser.id : null;\n        const newLayout = fromThingSidebar;\n\n        return (\n            <em\n                className={classnames(componentClass, \"on-home ignore-ext\", {\n                    open: showShare || showList || showMenu\n                })}\n                ref={el => {\n                    this.MoreShareEl = el;\n                }}\n                data-rendered=\"true\">\n                {newLayout && <button className=\"btn-share\" onClick={this.handleShareDisplay} />}\n                <small\n                    className={btnClass}\n                    onClick={this.handleMoreShareToggle}\n                    ref={element => {\n                        this.moreMenuButton = element;\n                    }}>\n                    {<em>{SharePopover.getShareMessage(objectType, \"Share & Lists\")}</em>}\n                </small>\n                {(isThing || isArticle) && (\n                    <small\n                        id=\"more-menu\"\n                        className={classnames(\"has-arrow menu-content react new\", {\n                            opened: showMenu,\n                            bot: headerGap && headerGap < 16 + 109 /*= tip + bubble*/\n                        })}>\n                        {!newLayout && (\n                            <button className=\"share before-bg-share2\" onClick={this.handleShareDisplay}>\n                                <b>{gettext(\"Share item\")}</b>\n                                <small>{gettext(\"Share this with friends\")}</small>\n                            </button>\n                        )}\n                        {newLayout && (\n                            <button className=\"fancyd-by before-bg-share2\" onClick={this.handleFancydByDisplay}>\n                                <b>{gettext(\"Fancy'd By\")}</b>\n                                <small>{gettext(\"People who fancy'd this\")}</small>\n                            </button>\n                        )}\n                        {isThing && (\n                            <button className=\"add-list before-bg-share2\" onClick={this.handleListDisplay}>\n                                <b>{gettext(\"Lists\")}</b>\n                                <small>{gettext(\"Add this to your saved lists\")}</small>\n                            </button>\n                        )}\n                        {showMerchantList && (\n                            <button className=\"add-list before-bg-share2\" onClick={this.handleMerchantListDisplay}>\n                                <b>{gettext(\"Add to Collection\")}</b>\n                                <small>{gettext(\"Save this to your collections\")}</small>\n                            </button>\n                        )}\n                        {showShortcuts && (\n                            <span>\n                                <button\n                                    style={referrerURL ? null : { opacity: 0.7 }}\n                                    className={classnames(\"copy-link\")}\n                                    onClick={this.handleCopyLink}>\n                                    <b>{linkCopied ? \"Copied to clipboard\" : \"Item link\"}</b>\n                                    <small>Copy link to clipboard</small>\n                                </button>\n                            </span>\n                        )}\n                    </small>\n                )}\n                {isThing && (\n                    <AddlistPopover\n                        key={`${objectId}-${merchantId}` || `${objectId}-addlist`}\n                        objectType={objectType}\n                        objectId={objectId}\n                        showList={showList || showSellerList}\n                        merchantId={merchantId}\n                        viewerUsername={viewerUsername}\n                        handleHide={this.handleHideList}\n                        headerGap={headerGap}\n                    />\n                )}\n                <SharePopover\n                    objectType={objectType}\n                    objectId={objectId}\n                    objectMeta={objectMeta}\n                    showShare={showShare}\n                    title={title}\n                    referrerURL={this.state.referrerURL}\n                    viewerUsername={viewerUsername}\n                    headerGap={headerGap}\n                    handleHide={this.handleHideShare}\n                />\n            </em>\n        );\n    }\n}\n","import React, { Component } from \"react\";\nimport { MoreShare } from \"common-components\";\n\n\nexport class MoreShareFacade extends Component {\n    state = {\n        share: false,\n        list: false\n    };\n\n    handleClickShare = () => {\n        this.setState({ share: true });\n    };\n\n    handleClickList = () => {\n        this.setState({ list: true });\n    };\n\n    render() {\n        const { share, list } = this.state;\n        return (\n            <React.Fragment>\n                {!(share || list) && (\n                    <FakeMoreShare onClickShare={this.handleClickShare} onClickAddlist={this.handleClickList} />\n                )}\n                {(share || list) && <MoreShare {...this.props} facadeShowShare={share} facadeShowList={list} />}\n            </React.Fragment>\n        );\n    }\n}\n\nclass FakeMoreShare extends Component {\n    render() {\n        return (\n            <em className=\"menu-container on-home ignore-ext\" data-rendered=\"true\">\n                <button className=\"btn-share\" onClick={this.props.onClickShare}></button>\n                <small className=\"btn-more\" onClick={this.props.onClickAddlist}>\n                    <em>Share &amp; Lists</em>\n                </small>\n            </em>\n        );\n    }\n}","import createHistory from \"history/createBrowserHistory\";\n\nexport const history = createHistory()\n","// fork of recommend-slide (accacb79d2af557369e02132ef5f486d226aa5d3)\nexport default function applyProductSlide() {\n    $(function() {\n        var mWidth = 920;\n\n        function initSlide($el, option) {\n            var $slide;\n            if ($el.is('.itemSlide, .slideshow')) {\n                $slide = $el;\n            } else {\n                $slide = $el.find(\".itemSlide, .slideshow\");\n            }\n            $slide.data('slideInit', true);\n            var $list = $el.find(\"ul\"),\n                $li = $list.find(\"li\"),\n                itemWidth = $li.width() + 20,\n                $prev = $el.find(\"a.prev\"),\n                $next = $el.find(\"a.next\");\n            var slideWidth = null;\n\n            if (option.itemPerSlide) slideWidth = itemWidth * option.itemPerSlide;\n\n            function resetRecommend() {\n                if (!$slide || !$li) {\n                    $el.css(\"visibility\", \"visible\");\n                    return;\n                }\n\n                if (slideWidth && slideWidth > itemWidth * $li.length) {\n                    $el.css(\"visibility\", \"visible\");\n                    return;\n                }\n\n                if ($(window).width() < mWidth) {\n                    if (option.center) {\n                        $slide.find(\".itemList\").scrollLeft(($li.length * 147 - $(window).width() + 20) / 2);\n                    }\n                    $prev.removeClass(\"disabled\");\n                    $next.removeClass(\"disabled\");\n                } else {\n                    if ($slide.width() > itemWidth * $li.length) {\n                        $prev.addClass(\"disabled\");\n                        $next.addClass(\"disabled\");\n                        if (option.center) {\n                            $slide.find(\".itemList\").css(\"left\", \"0px\");\n                        }\n                    } else {\n                        if (option.center) {\n                            $slide\n                                .find(\".itemList\")\n                                .css(\"left\", -parseInt(($li.length * 285 - $(window).width() + 20) / 2) + \"px\");\n                        }\n                        $prev.removeClass(\"disabled\");\n                        $next.removeClass(\"disabled\");\n                    }\n                }\n                $el.css(\"visibility\", \"visible\");\n            }\n\n            function getPrevLeft($el) {\n                preparePrev();\n                var left = Math.abs(parseInt($list.css(\"left\"))),\n                    nextLeft,\n                    width = $slide.width();\n                if (slideWidth) width = slideWidth;\n                nextLeft = left - width;\n                return nextLeft;\n            }\n\n            function getNextLeft($el) {\n                prepareNext();\n                var left = Math.abs(parseInt($list.css(\"left\"))),\n                    nextLeft,\n                    width = $slide.width();\n                if (slideWidth) width = slideWidth;\n                nextLeft = left + width;\n                return nextLeft;\n            }\n\n            function preparePrev() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    width = $slide.width(),\n                    itemWidth = $li.width() + 20;\n                if (slideWidth) width = slideWidth;\n\n                if (left < width) {\n                    var prepareCount = Math.ceil(Math.abs(width - left) / itemWidth);\n                    for (var i = 0; i < prepareCount; i++) {\n                        var $el = $list.find(\"li:not([_prev])\").last();\n                        $el.clone().insertBefore($list.find(\"li\").first());\n                        $el.attr(\"_prev\", true);\n                    }\n                    $list.css(\"left\", 0 - left - prepareCount * itemWidth + \"px\");\n                }\n            }\n\n            function prepareNext() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    width = $slide.width(),\n                    listWidth = $li.length * ($li.width() + 20),\n                    itemWidth = $li.width() + 20,\n                    spare = listWidth - (left + width);\n                if (slideWidth) width = slideWidth;\n                if (spare - width < width) {\n                    var prepareCount = Math.ceil(Math.abs(width - (listWidth - (left + width))) / itemWidth);\n                    for (var i = 0; i < prepareCount; i++) {\n                        var $el = $list.find(\"li:not([_next])\").first();\n                        $el.clone().insertAfter($list.find(\"li\").last());\n                        $el.attr(\"_next\", true);\n                    }\n                }\n            }\n\n            function clearOld() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    itemWidth = $li.width() + 20,\n                    $prev = $list.find(\"li[_next]:not(:in-viewport)\"),\n                    prevCnt = $prev.length;\n                $list.find(\"li[_prev]:not(:in-viewport)\").remove();\n                $prev.remove();\n                $list.css(\"left\", 0 - left + prevCnt * itemWidth + \"px\");\n            }\n\n            resetRecommend();\n\n            if (slideWidth && slideWidth > itemWidth * $li.length) {\n                $prev.hide();\n                $next.hide();\n            }\n\n            $el.on(\"click\", \"a.prev\", function(e) {\n                e.preventDefault();\n                var $this = $(this);\n                if ($this.hasClass(\"_disabled\")) return;\n                var left = getPrevLeft($el);\n                $this.addClass(\"_disabled\");\n                $list.animate({ left: 0 - left + \"px\" }, 300, \"easeInOutExpo\", function() {\n                    clearOld();\n                    $this.removeClass(\"_disabled\");\n                });\n            }).on(\"click\", \"a.next\", function(e) {\n                e.preventDefault();\n                var $this = $(this);\n                if ($this.hasClass(\"_disabled\")) return;\n                var left = getNextLeft($el);\n                $this.addClass(\"_disabled\");\n                $list.animate({ left: 0 - left + \"px\" }, 300, \"easeInOutExpo\", function() {\n                    clearOld();\n                    $this.removeClass(\"_disabled\");\n                });\n            });\n        }\n\n        $.fn.productSlide = function(option) {\n            var option = option || { center: true };\n            var self = this;\n            var $slides = this.each(function() {\n                var $el = $(this);\n                initSlide($el, option);\n            });\n\n            return $slides;\n        };\n    });\n}\n"],"sourceRoot":""}
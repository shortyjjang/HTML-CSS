{"version":3,"file":"_static_modules_ui_more-share_Action_tsx.b7609022c1ae729ec377.js","sources":["webpack://fancy/./_static/modules/ui/more-share/Action.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AddlistPopup.js"],"sourcesContent":["import { copyToClipboard, renderPopup } from \"fancyutils\";\nimport AddlistPopup from \"../overlay-thing/components/popup/AddlistPopup\";\n\nvar getUrl = function getUrl(thingUrl, viewerUsername) {\n  var url = \"https://fancy.com\".concat(thingUrl);\n\n  if (viewerUsername) {\n    var connector = ~url.indexOf(\"?\") ? \"&\" : \"?\";\n    url = \"\".concat(url).concat(connector, \"ref=\").concat(viewerUsername);\n  }\n\n  return url;\n};\n\nvar copyAction = function copyAction(thingUrl, viewerUsername, $messageEl) {\n  copyToClipboard(getUrl(thingUrl, viewerUsername));\n  $messageEl.text(\"Link copied!\");\n  setTimeout(function () {\n    $messageEl.text(\"Copy link\");\n  }, 2000);\n};\n\nexport function setup() {\n  $(function () {\n    // click outside to close\n    $(document).on(\"click\", \".figure-item .menu-container .btn-more\", function () {\n      var $el = $(this);\n      var $container = $el.closest(\".menu-container\");\n\n      if ($container.hasClass(\"show-list\")) {\n        $container.removeClass(\"show-list\");\n      } else if ($container.hasClass(\"show-share\")) {\n        $container.removeClass(\"show-share\");\n      } else if ($container.hasClass(\"opened\")) {\n        $container.removeClass(\"opened\").closest(\"li\").removeClass(\"active\");\n        $(document.body).removeClass(\"show-more-share\");\n      } else {\n        $container.addClass(\"opened\").closest(\"li\").addClass(\"active\");\n        $(document.body).addClass(\"show-more-share\");\n      }\n\n      if (!$el.data(\"clickoutside\")) {\n        var ts = Math.random();\n        var evt = \"click.action-clickoutside-\".concat(ts);\n        $el.data(\"clickoutside\", evt);\n        $(document).on(evt, function (e2) {\n          if ($(e2.target).is($el) || $(e2.target).closest($container).length) {\n            return true;\n          }\n\n          e2.preventDefault();\n          e2.stopPropagation();\n          $el.closest(\".menu-container.opened\").removeClass(\"opened\").closest(\"li\").removeClass(\"active\");\n          $(document.body).removeClass(\"show-more-share\"); // close addlist popover\n\n          $el.closest(\".menu-container\").removeClass(\"show-list\");\n          $(document).off(evt);\n          $el.data(\"clickoutside\", null);\n        });\n      }\n    }).on(\"click\", \".figure-item .menu-container .add-list\", function () {\n      if (!window.__FancyUser.loggedIn) {\n        window.require_login();\n        return false;\n      }\n\n      var $this = $(this);\n      var objectId = $this.closest(\"li\").attr(\"tid\");\n      renderPopup(AddlistPopup, {\n        objectId: objectId\n      });\n      return false;\n    }).on(\"click\", \".figure-item .menu-container .copy-link\", function () {\n      var $el = $(this);\n      var url = $el.closest(\".figure-item\").data(\"url\");\n      copyAction(url, window.__FancyUser.viewerUsername, $el);\n      return false;\n    }).on(\"click\", \".figure-item .menu-container .share\", function () {\n      $(this).closest(\".menu-container\").addClass(\"show-share\");\n      return false;\n    }).on(\"click\", \".figure-item .menu-container .ly-close\", function () {\n      $(this).closest(\".menu-container\").removeClass(\"opened\");\n      return false;\n    });\n  });\n} // $(function () {\n//     $(\".figure-item #show-share .close, .figure-item #show-addlist .close\").click(function (e) {\n//         e.preventDefault();\n//         $(this).closest(\".menu-container\").removeClass(\"show-share\").removeClass(\"show-list\");\n//         return false;\n//     });\n// });","import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport React, { Component } from 'react';\nimport classnames from 'classnames';\nimport { closePopup, KEYS, MP, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nvar AddlistPopup = /*#__PURE__*/function (_Component) {\n  _inherits(AddlistPopup, _Component);\n\n  function AddlistPopup() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, AddlistPopup);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(AddlistPopup)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      lists: [],\n      listSearchQuery: '',\n      listCreationQuery: '',\n      listCreating: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDialogOpen\", function () {\n      _this.setState({\n        lists: [],\n        listSearchQuery: '',\n        listCreationQuery: ''\n      });\n\n      _this.drawUserList();\n\n      setTimeout(function () {\n        _this.listSearchInput.focus();\n      }, 0);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleListSearch\", function (event) {\n      var listSearchQuery = event.target.value;\n\n      _this.setState({\n        listSearchQuery: listSearchQuery\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleListCreation\", function (event) {\n      event.preventDefault();\n      if (_this.state.listCreating) return;\n\n      if (event.type === 'keyup' && event.which !== KEYS.ENTER) {\n        return;\n      }\n\n      var listCreationQuery = $.trim(_this.state.listCreationQuery);\n      var objectId = _this.props.objectId;\n\n      if (isEmpty(listCreationQuery)) {\n        return;\n      }\n\n      _this.setState({\n        listCreating: true\n      }); // save new list\n\n\n      updateList({\n        objectId: objectId,\n        createList: listCreationQuery,\n        callback: function callback(success, updated) {\n          if (success) {\n            var lists = _this.state.lists;\n            MP('Create New List', {\n              'thing id': objectId,\n              'list name': listCreationQuery,\n              'via': 'thing detail'\n            });\n\n            _this.setState({\n              listCreationQuery: '',\n              listCreating: false,\n              lists: [].concat(_toConsumableArray(updated), _toConsumableArray(lists))\n            });\n          }\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleListItemToggle\", function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n      var targ = event.currentTarget;\n      var objectId = _this.props.objectId;\n      var lists = _this.state.lists;\n      var selectedListId = Number(targ.getAttribute('data-listid'));\n      var theList = lists.filter(function (list) {\n        return list.id === selectedListId;\n      })[0];\n      var prevAdded = theList.added;\n      theList.added = !theList.added;\n      var eventName = theList.added ? \"Add to List\" : \"Remove from List\";\n\n      _this.setState({\n        lists: lists\n      });\n\n      var callback = function callback(success, updated) {\n        var lists = _this.state.lists;\n\n        if (success) {} else {\n          var _theList = lists.filter(function (list) {\n            return list.id === selectedListId;\n          })[0];\n          _theList.added = prevAdded;\n        }\n\n        _this.setState({\n          lists: lists\n        });\n\n        MP(eventName, {\n          'thing id': objectId,\n          'list name': theList.name,\n          'list id': theList.id,\n          'via': 'thing detail'\n        });\n      };\n\n      var update = {\n        objectId: objectId,\n        callback: callback\n      };\n      if (theList.added) update['checked'] = [theList.id];else update['unchecked'] = [theList.id];\n      updateList(update);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCreateListQueryChange\", function (event) {\n      _this.setState({\n        listCreationQuery: event.target.value\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(AddlistPopup, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      $.dialog(AddlistPopup.popupName).$obj.on('open', this.handleDialogOpen);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      $.dialog(AddlistPopup.popupName).center();\n    }\n  }, {\n    key: \"drawUserList\",\n    value: function drawUserList() {\n      var _this2 = this;\n\n      var objectId = this.props.objectId;\n      getListCheckbox({\n        objectId: objectId,\n        callback: function callback(res) {\n          _this2.setState(res);\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var objectId = this.props.objectId;\n      var _this$state = this.state,\n          lists = _this$state.lists,\n          listSearchQuery = _this$state.listSearchQuery,\n          listCreationQuery = _this$state.listCreationQuery,\n          listCreating = _this$state.listCreating;\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"p\", {\n        className: \"ltit\"\n      }, \"Add to lists\"), /*#__PURE__*/React.createElement(\"fieldset\", {\n        className: \"search\"\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        placeholder: \"Search\",\n        className: \"text\",\n        value: listSearchQuery,\n        ref: function ref(element) {\n          _this3.listSearchInput = element;\n        },\n        onChange: this.handleListSearch\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"list\"\n      }, /*#__PURE__*/React.createElement(\"ul\", {\n        ref: function ref(el) {\n          _this3.lists = el;\n        }\n      }, lists && lists.map(function (list, idx) {\n        var term = $.trim(listSearchQuery).toLowerCase();\n        var style;\n\n        if (_.isString(term) && term.length > 0) {\n          style = Display.NoneIf(list.name.toLowerCase().indexOf(term.toLowerCase()) === -1);\n        }\n\n        var ident = \"\".concat(objectId, \"-\").concat(list.id);\n        return /*#__PURE__*/React.createElement(\"li\", {\n          key: idx,\n          style: style,\n          className: classnames({\n            \"added\": list.added\n          })\n        }, /*#__PURE__*/React.createElement(\"label\", null, list.name), /*#__PURE__*/React.createElement(\"button\", {\n          \"data-listid\": list.id,\n          onClick: _this3.handleListItemToggle,\n          className: \"btns-blue-embo\"\n        }, list.added ? \"Remove\" : \"Add\"));\n      }))), /*#__PURE__*/React.createElement(\"fieldset\", {\n        className: \"create\"\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"text\",\n        placeholder: \"Create new list\",\n        ref: function ref(element) {\n          _this3.quickCreateList = element;\n        },\n        onKeyUp: this.handleListCreation,\n        onChange: this.handleCreateListQueryChange,\n        value: listCreationQuery\n      }), /*#__PURE__*/React.createElement(\"button\", {\n        className: classnames(\"btn-create\", {\n          \"loading\": listCreating\n        }),\n        style: Display.NoneIf($.trim(listCreationQuery).length == 0),\n        onClick: this.handleListCreation\n      }, gettext(\"Create\"))), /*#__PURE__*/React.createElement(\"button\", {\n        className: \"ly-close\",\n        title: \"Close\"\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"ic-del-black\"\n      })));\n    }\n  }]);\n\n  return AddlistPopup;\n}(Component);\n\n_defineProperty(AddlistPopup, \"popupName\", 'add-list');\n\nexport { AddlistPopup as default };\n\nfunction getListCheckbox(_ref) {\n  var objectId = _ref.objectId,\n      callback = _ref.callback;\n  $.get('/get_list_checkbox.json', {\n    tid: objectId\n  }).done(function (resp) {\n    if (resp.status_code == 0) {\n      alertify.alert(resp.message || \"Please try again later.\");\n      closePopup(AddlistPopup.popupName);\n    }\n\n    callback && callback({\n      lists: resp.lists\n    });\n  }).error(function (err) {\n    alertify.alert(\"Please try again later.\");\n    console.warn(err);\n    closePopup(AddlistPopup.popupName);\n  });\n}\n\nfunction updateList(_ref2) {\n  var objectId = _ref2.objectId,\n      checked = _ref2.checked,\n      unchecked = _ref2.unchecked,\n      createList = _ref2.createList,\n      callback = _ref2.callback;\n  var payload = {\n    tid: objectId\n  };\n  if (checked) payload['add_list_ids'] = checked.join(',');\n  if (unchecked) payload['remove_list_ids'] = unchecked.join(',');\n  if (createList) payload['new_list'] = createList;\n  $.post('/update_list_checkbox.json', payload).done(function (resp) {\n    if (resp.status_code == 0) {\n      alertify.alert(resp.message || \"Please try again later.\");\n      callback(false, null);\n    } else {\n      callback(true, resp.lists);\n    }\n  }).error(function (err) {\n    console.warn(err);\n    alertify.alert(\"Please try again later.\");\n    callback(false, []);\n  });\n}"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;;A","sourceRoot":""}
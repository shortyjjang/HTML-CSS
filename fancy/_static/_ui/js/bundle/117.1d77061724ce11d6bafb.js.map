{"version":3,"sources":["webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AddlistPopup.js","webpack://fancy/./_static/modules/ui/more-share/Action.tsx"],"names":["className","title","AddlistPopup","lists","listSearchQuery","listCreationQuery","listCreating","setState","drawUserList","setTimeout","listSearchInput","focus","event","target","value","preventDefault","state","type","which","KEYS","$","trim","objectId","props","isEmpty","updateList","createList","callback","success","updated","MP","stopPropagation","targ","currentTarget","selectedListId","Number","getAttribute","theList","filter","list","id","prevAdded","added","eventName","update","name","dialog","popupName","$obj","on","this","handleDialogOpen","prevProps","prevState","center","getListCheckbox","res","placeholder","ref","element","onChange","handleListSearch","el","map","idx","style","term","toLowerCase","_","isString","length","Display","indexOf","key","classnames","data-listid","onClick","handleListItemToggle","quickCreateList","onKeyUp","handleListCreation","handleCreateListQueryChange","gettext","Component","get","tid","done","resp","status_code","alertify","message","closePopup","error","err","console","warn","checked","unchecked","payload","join","post","setup","document","$el","$container","closest","hasClass","removeClass","body","addClass","data","ts","Math","random","evt","e2","is","off","window","__FancyUser","loggedIn","require_login","attr","renderPopup","thingUrl","viewerUsername","$messageEl","url","copyToClipboard","connector","getUrl","text"],"mappings":"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","file":"117.1d77061724ce11d6bafb.js","sourcesContent":["import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { closePopup, KEYS, MP, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nexport default class AddlistPopup extends Component {\n    static popupName = 'add-list';\n    state = {\n        lists: [],\n        listSearchQuery: '',\n        listCreationQuery: '',\n        listCreating: false,\n    };\n\n    handleDialogOpen = () => {\n        this.setState({ lists: [], listSearchQuery: '', listCreationQuery: '' });\n        this.drawUserList()\n        setTimeout(() => {\n            this.listSearchInput.focus();\n        }, 0);\n\n    }\n    componentDidMount() {\n        $.dialog(AddlistPopup.popupName).$obj.on('open', this.handleDialogOpen);\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AddlistPopup.popupName).center();\n    }\n\n    drawUserList() {\n        const objectId = this.props.objectId;\n        getListCheckbox({\n            objectId,\n            callback: res => { this.setState(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setState({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (this.state.listCreating) return;\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        this.setState({ listCreating: true })\n        // save new list\n        updateList({\n            objectId,\n            createList: listCreationQuery,\n            callback: (success, updated) => {\n                if (success) {\n                    const { lists } = this.state;\n                    MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    this.setState( {\n                        listCreationQuery: '', listCreating: false,\n                        lists: [ ...updated, ...lists ],\n                    });\n                }\n            }\n        })\n    }\n\n    handleListItemToggle = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = Number(targ.getAttribute('data-listid'));\n        const theList = lists.filter(list => list.id === selectedListId)[0];\n        const prevAdded = theList.added;\n        theList.added = !theList.added;\n        const eventName = theList.added ? \"Add to List\" : \"Remove from List\";\n        this.setState({ lists })\n\n        const callback = (success, updated) => {\n            const { lists } = this.state;\n            if (success) {\n            } else {\n                const theList = lists.filter(list => list.id === selectedListId)[0];\n                theList.added = prevAdded;\n            }\n            this.setState({ lists })\n            MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n        };\n\n        const update = { objectId, callback };\n\n        if (theList.added) update['checked'] = [theList.id];\n        else update['unchecked'] = [theList.id];\n        updateList(update)\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setState({ listCreationQuery: event.target.value });\n    }\n\n    render() {\n        var { objectId } = this.props;\n        var {\n            lists,\n            listSearchQuery,\n            listCreationQuery,\n            listCreating,\n        } = this.state;\n\n        return (\n            <>\n                <p className=\"ltit\">Add to lists</p>\n                <fieldset className=\"search\">\n                    <input type=\"text\" placeholder=\"Search\" className=\"text\" \n                        value={listSearchQuery} ref={(element) => {this.listSearchInput = element;}}\n                        onChange={this.handleListSearch} />\n                </fieldset>\n                <div className=\"list\">\n                    <ul ref={(el) => {this.lists = el;}}>\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style} className={classnames({ \"added\": list.added })}>\n                                <label>{list.name}</label>\n                                <button\n                                    data-listid={list.id} \n                                    onClick={this.handleListItemToggle}\n                                    className=\"btns-blue-embo\">{list.added ? \"Remove\" : \"Add\"}</button>\n                            </li>\n                        )\n                    })}\n                    </ul>\n                </div>\n                <fieldset className=\"create\">\n                    <input \n                        type=\"text\" placeholder=\"Create new list\" \n                        ref={(element) => {this.quickCreateList = element;}}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}/>\n                    <button className={classnames(\"btn-create\", { \"loading\": listCreating })} style={Display.NoneIf($.trim(listCreationQuery).length == 0)}\n                        onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </fieldset>\n                <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n            </>\n        );\n    }\n}\n\nfunction getListCheckbox({ objectId, callback }) {\n    $.get('/get_list_checkbox.json', { tid: objectId }).done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            closePopup(AddlistPopup.popupName);\n        }\n        callback && callback({ lists: resp.lists })\n    },)\n    .error(err => { \n        alertify.alert(\"Please try again later.\");\n        console.warn(err); \n        closePopup(AddlistPopup.popupName);\n    });\n}\n\nfunction updateList({ objectId, checked, unchecked, createList, callback }) {\n    const payload = { tid: objectId };\n    if (checked) payload['add_list_ids'] = checked.join(',');\n    if (unchecked) payload['remove_list_ids'] = unchecked.join(',');\n    if (createList) payload['new_list'] = createList;\n\n    $.post('/update_list_checkbox.json', payload)\n    .done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            callback(false, null);\n        } else {\n            callback(true, resp.lists);\n        }\n    })\n    .error(err => { \n        console.warn(err); \n        alertify.alert(\"Please try again later.\");\n        callback(false, []);\n    })\n}\n","import { copyToClipboard, renderPopup } from \"fancyutils\";\n\nimport AddlistPopup from \"../overlay-thing/components/popup/AddlistPopup\";\n\nconst getUrl = (thingUrl: string, viewerUsername: string) => {\n    let url = `https://fancy.com${thingUrl}`;\n    if (viewerUsername) {\n        const connector = ~url.indexOf(\"?\") ? \"&\" : \"?\";\n        url = `${url}${connector}ref=${viewerUsername}`;\n    }\n    return url;\n};\n\nconst copyAction = (thingUrl: string, viewerUsername: string, $messageEl: JQuery<HTMLElement>) => {\n    copyToClipboard(getUrl(thingUrl, viewerUsername));\n    $messageEl.text(\"Link copied!\");\n    setTimeout(() => {\n        $messageEl.text(\"Copy link\");\n    }, 2000);\n};\n\nexport function setup() {\n    $(() => {\n        // click outside to close\n        $(document)\n            .on(\"click\", \".figure-item .menu-container .btn-more\", function () {\n                const $el = $(this);\n\n                const $container = $el.closest(\".menu-container\");\n                if ($container.hasClass(\"show-list\")) {\n                    $container.removeClass(\"show-list\");\n                } else if ($container.hasClass(\"show-share\")) {\n                    $container.removeClass(\"show-share\");\n                } else if ($container.hasClass(\"opened\")) {\n                    $container.removeClass(\"opened\").closest(\"li\").removeClass(\"active\");\n                    $(document.body).removeClass(\"show-more-share\");\n                } else {\n                    $container.addClass(\"opened\").closest(\"li\").addClass(\"active\");\n                    $(document.body).addClass(\"show-more-share\");\n                }\n                if (!$el.data(\"clickoutside\")) {\n                    const ts = Math.random();\n                    const evt = `click.action-clickoutside-${ts}`;\n                    $el.data(\"clickoutside\", evt);\n                    $(document).on(evt, function (e2) {\n                        if ($(e2.target).is($el) || $(e2.target).closest($container).length) {\n                            return true;\n                        }\n                        e2.preventDefault();\n                        e2.stopPropagation();\n                        $el.closest(\".menu-container.opened\").removeClass(\"opened\").closest(\"li\").removeClass(\"active\");\n                        $(document.body).removeClass(\"show-more-share\");\n                        // close addlist popover\n                        $el.closest(\".menu-container\").removeClass(\"show-list\");\n                        $(document).off(evt);\n                        $el.data(\"clickoutside\", null);\n                    });\n                }\n            })\n            .on(\"click\", \".figure-item .menu-container .add-list\", function () {\n                if (!window.__FancyUser.loggedIn) {\n                    window.require_login();\n                    return false;\n                }\n                const $this = $(this);\n                const objectId = $this.closest(\"li\").attr(\"tid\")!;\n                renderPopup(AddlistPopup, { objectId });\n                return false;\n            })\n            .on(\"click\", \".figure-item .menu-container .copy-link\", function () {\n                const $el = $(this);\n                const url = $el.closest(\".figure-item\").data(\"url\");\n                copyAction(url, window.__FancyUser.viewerUsername, $el);\n                return false;\n            })\n            .on(\"click\", \".figure-item .menu-container .share\", function () {\n                $(this).closest(\".menu-container\").addClass(\"show-share\");\n                return false;\n            })\n            .on(\"click\", \".figure-item .menu-container .ly-close\", function () {\n                $(this).closest(\".menu-container\").removeClass(\"opened\");\n                return false;\n            });\n    });\n}\n\n// $(function () {\n//     $(\".figure-item #show-share .close, .figure-item #show-addlist .close\").click(function (e) {\n//         e.preventDefault();\n//         $(this).closest(\".menu-container\").removeClass(\"show-share\").removeClass(\"show-list\");\n//         return false;\n//     });\n// });\n"],"sourceRoot":""}
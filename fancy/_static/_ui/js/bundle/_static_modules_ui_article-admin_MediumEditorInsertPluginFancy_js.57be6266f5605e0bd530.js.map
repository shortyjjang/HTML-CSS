{"version":3,"sources":["webpack://fancy/./_static/modules/ui/article-admin/MediumEditorInsertPluginFancy.js"],"names":["define","factory","boundFactory","bind","window","Handlebars","require","MediumEditor","jQuery","$","template","container","depth0","helpers","partials","data","helper","escapeExpression","placeholder","helperMissing","call","nullContext","stack1","each","styles","program","noop","label","alias1","alias2","alias3","key","actions","html","alias4","img","caption","progress","document","undefined","pluginName","defaults","editor","enabled","addons","images","embeds","ucfirst","str","charAt","toUpperCase","slice","parseVideo","url","match","RegExp","$3","indexOf","type","id","$6","Core","el","options","$el","templates","MediumInsert","Templates","extend","_defaults","_name","_serialize","serialize","_destroy","destroy","_setup","setup","_hideInsertButtons","hideButtons","editorSerialize","editorDestroy","editorSetup","getExtensionByName","updatePlaceholder","editorUpdatePlaceholder","getAdjacentCursor","$place","$container","isFirstChild","is","cursor","recoveryMode","before","closest","restoreCursor","recoveryObject","elToReplace","prepend","insertAfter","console","warn","prototype","init","addClass","Object","keys","length","disable","initAddons","clean","events","isWhitelabelV2","productCardTemplate","_","trim","productSlideshowTemplate","$insertProductDialog","dialog","$obj","selectedTemplate","find","searchedTemplate","$searched","$selected","Sortable","create","get","handle","ThingCache","searchCache","ref","selectedItemIds","on","debounce","e","val","target","value","hide","dfd","Deferred","resolve","REST_API_ENDPOINT","keyword","then","things","empty","products","show","forEach","thing","selected","sid","append","cached","fail","xhr","status","alertify","alert","trigger","ids","map","i","Number","attr","toArray","items","tpl","clone","updatingRoot","replaceWith","close","$dupe","push","cnt","text","sidToDelete","remove","filter","setSaved","$root","_selectedItemIds","jQueryPromiseAll","arrayOfPromises","when","apply","Array","arguments","promise","ctx","image","sales","src","brand_name","seller","title","price","thumbnail","args","end","setTimeout","t","positionButtons","showButtons","activeInsertAdded","resetOptionV2","hideOptionPopupV2","that","adjustCaretBeforeInsertWidget","root","migrateExistingContent","next","moveCaret","after","checkSelectionActive","$anchorNode","getSelection","anchorNode","insertYoutubeOnEvent","input","vid","$videoElement","EditorControl","refresh","preventDefault","proxy","isVisible","toggleAddons","mediumEditor","getEditor","tb","isDisplayed","hideToolbar","GalleryControl","uploadImages","nextImages","renderTo","control","instance","addImages","prompt","focus","which","open","click","isSlide","hasClass","isList","$that","sort","a","b","one","$this","$slide","off","productSlide","itemPerSlide","center","$wrapper","$li","removingId","selectElement","showAndUpdateToolbar","body","$data","removeClass","elements","enable","dontShow","contents","children","not","nodeName","toLowerCase","showPlaceholder","base","hidePlaceholder","triggerInput","deselect","removeAllRanges","disableSelection","addon","addonName","$buttons","$lastEl","$text","wrap","parent","addButtons","prev","getButtons","templateName","buttons","prop","css","toggleButtons","selection","range","$current","$p","activeAddon","rangeCount","getRangeAt","commonAncestorContainer","removeAttr","$lastCaption","elementsContainer","elementsContainerAbsolute","getComputedStyle","getPropertyValue","position","left","top","height","parseInt","scrollTop","$tools","toggle","hideAddons","addonAction","$a","currentTarget","action","meta","sel","textEl","createRange","childNodes","createTextNode","appendChild","setStart","collapse","addRange","addCaption","$caption","$newCaption","removeCaptions","$ignore","$captions","removeCaptionPlaceholder","$cl","insertBefore","fn","textareaId","siblings","oembedProxy","captions","captionPlaceholder","storeMeta","wide","right","clicked","$event","Event","parseOnPaste","Embeds","core","_serializePreEmbeds","$embeds","backwardsCompatibility","add","togglePlaceholder","fixRightClickOnPlaceholder","processLink","stopPropagation","oembed","parseUrl","processPasted","pastedUrl","linkRegEx","originalEvent","clipboardData","getData","test","pasted","support","cors","ajax","crossDomain","cache","dataType","success","JSON","stringify","error","jqXHR","textStatus","errorThrown","responseJSON","parse","responseText","log","message","join","replace","embed","$div","nodeType","textContent","FB","XFBML","convertBadEmbed","content","$empty","$content","emptyTemplate","selectEmbed","$embed","addToolbar","unselectEmbed","removeEmbed","active","$toolbar","$toolbar2","toolbarContainer","first","repositionToolbars","fadeIn","autoRepositionToolbars","elementsContainerBoundary","getBoundingClientRect","containerWidth","width","offset","toolbarAction","$button","$ul","$lis","className","added","removed","toolbar2Action","callback","ImageModes","Full","Normal","Quoted","Grid","ImageModesEditClasses","ImageModesClasses","quotedPlaceHolderMsg","Util","deleteMethod","deleteScript","preview","autoGrid","fileUploadOptions","acceptFileTypes","fileDeleteOptions","grid","sorting","sortable","group","containerSelector","itemSelector","nested","vertical","afterMove","messages","acceptFileTypesError","maxFileSizeError","Images","$currentImage","FileReader","_serializePreImages","getImageMode","$image","$images","changeMode","$fig","prevMode","nextMode","tempCaptionCallback","tempCaption","quote","$img","ReactMediumEditor__changeMode","handleModeChange","event","$target","getAttribute","setAttribute","epochId","String","Date","popup","$grid","image_url","serialziedImages","organizeImageService","organizedImages","original","$cap","$file","done","XMLHttpRequest","upload","progressall","fileupload","uploadAdd","uploadErrors","file","files","maxFileSize","reader","name","size","uploadFailed","autoUpload","process","onload","result","readAsDataURL","submit","uploadProgressall","$progressbar","loaded","total","uploadProgress","context","uploadDone","uiid","showImage","additionals","__SECRET__","domImage","isGrid","getDOMImage","uploadCompleted","blankUrl","load","expanded","appendTo","style","Image","selectImage","blur","$gridEach","unselectImage","removeImage","$selectedImage","$parent","current","caretPosition","$sibling","selectedHtml","getCaretOffsets","getSelectionHtml","deleteFile","$tpl","util"],"mappings":"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","file":"_static_modules_ui_article-admin_MediumEditorInsertPluginFancy_js.57be6266f5605e0bd530.js","sourcesContent":["/*! \n * medium-editor-insert-plugin v2.4.0 - jQuery insert plugin for MediumEditor\n *\n * http://linkesch.com/medium-editor-insert-plugin\n * \n * Copyright (c) 2014 Pavel Linkesch (http://linkesch.com)\n * Released under the MIT license\n */\n\nvar define = false;\n(function (factory) {\n    var boundFactory = factory.bind(window);  // Due to strict mode, manually bind `thisContext` to window.\n    // if (typeof define === 'function' && define.amd) {\n    //     define(['jquery', 'handlebars/runtime', 'medium-editor', 'blueimp-file-upload', 'jquery-sortable'], boundFactory);\n    // } else if (typeof module === 'object' && module.exports) {\n        // module.exports = function (jQuery) {\n            // if (typeof window === 'undefined') {\n            //     throw new Error(\"medium-editor-insert-plugin runs only in a browser.\")\n            // }\n            window.Handlebars = require('handlebars/runtime');\n            window.MediumEditor = require('medium-editor');\n            require('jquery-sortable');\n            require('blueimp-file-upload');\n\n            boundFactory(jQuery, Handlebars, MediumEditor);\n            // return jQuery;\n        // };\n    // } else {\n    //     boundFactory(jQuery, Handlebars, MediumEditor);\n    // }\n}(function ($, Handlebars, MediumEditor) {\n\nthis[\"MediumInsert\"] = this[\"MediumInsert\"] || {};\nthis[\"MediumInsert\"][\"Templates\"] = this[\"MediumInsert\"][\"Templates\"] || {};\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/core-buttons-gear.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"add_option medium-insert-buttons whitelabel-gear\\\" contenteditable=\\\"false\\\">\\n  <small class=\\\"add_option_tools\\\" style=\\\"display: none;\\\">\\n    <span class=\\\"insert-option\\\" style=\\\"display: block;\\\">\\n      <label class=\\\"label\\\">INSERT</label>\\n      <a class=\\\"insert-action-text\\\">\\n        <i></i> Text</a>\\n      <a class=\\\"insert-action-media\\\">\\n        <i></i> Media</a>\\n      <a class=\\\"insert-action-product\\\">\\n        <i></i> Products</a>\\n    </span>\\n    <span class=\\\"insert-text\\\" style=\\\"display: none;\\\">\\n      <a href=\\\"#\\\" class=\\\"label\\\">TEXT</a>\\n      <a class=\\\"insert-action-text-body\\\">\\n        <i></i> Body</a>\\n      <a class=\\\"insert-action-text-quote\\\">\\n        <i></i> Quote</a>\\n    </span>\\n    <span class=\\\"insert-media\\\" style=\\\"display: none;\\\">\\n      <a href=\\\"#\\\" class=\\\"label\\\">MEDIA</a>\\n      <a class=\\\"insert-action-image\\\">\\n        <i></i> Images</a>\\n      <a class=\\\"insert-action-youtube\\\">\\n        <i></i> Youtube</a>\\n    </span>\\n    <span class=\\\"insert-image\\\" style=\\\"display: none;\\\">\\n      <a href=\\\"#\\\" class=\\\"label\\\">IMAGE</a>\\n      <a class=\\\"insert-action-image-single medium-insert-action\\\" data-addon=\\\"images\\\" data-action=\\\"add\\\" data-image-insert-type=\\\"single\\\">\\n        <i></i> Single</a>\\n      <a class=\\\"insert-action-image-slideshow gallery-insert-action\\\">\\n        <i></i> Slideshow</a>\\n      <a class=\\\"insert-action-image-grid medium-insert-action\\\" data-addon=\\\"images\\\" data-action=\\\"add\\\" data-meta='{ \\\"type\\\": \\\"grid\\\" }'>\\n        <i></i> Grid</a>\\n    </span>\\n    <span class=\\\"insert-product\\\" style=\\\"display: none;\\\">\\n      <a href=\\\"#\\\" class=\\\"label\\\">PRODUCT</a>\\n      <a class=\\\"insert-action-product-card\\\">\\n        <i></i> Cards</a>\\n      <a class=\\\"insert-action-product-slideshow\\\">\\n        <i></i> Slideshow</a>\\n    </span>\\n    <span class=\\\"insert-youtube\\\" style=\\\"display: none;\\\">\\n      <a href=\\\"#\\\" class=\\\"label\\\">YOUTUBE</a>\\n      <input class=\\\"extempt-dis-select\\\" type=\\\"text\\\" placeholder=\\\"Paste video link\\\">\\n      <button class=\\\"btns-green-embo\\\">Insert</button>\\n    </span>\\n    <span class=\\\"editable_tools\\\" style=\\\"display:none;\\\">\\n      <label class=\\\"label\\\">IMAGE STYLE</label>\\n      <a class=\\\"edit_full\\\">\\n        <i></i>\\n      </a>\\n      <a class=\\\"edit_normal\\\">\\n        <i></i>\\n      </a>\\n      <a class=\\\"edit_with_quote\\\">\\n        <i></i>\\n      </a>\\n    </span>\\n  </small>\\n  <button class=\\\"medium-insert-buttons-show show_option\\\" type=\\\"button\\\"></button>\\n</div>\\n\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/core-buttons.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"add_option medium-insert-buttons\\\" contenteditable=\\\"false\\\" style=\\\"display: none\\\">\\n    <small class=\\\"add_option_tools\\\" style=\\\"display: none;\\\">\\n        <div class=\\\"trick\\\"></div>\\n        <a class=\\\"medium-insert-action\\\" data-addon=\\\"images\\\" data-action=\\\"add\\\">Insert Image</a>\\n        <a class=\\\"video-insert-action\\\">Insert Video</a>\\n        <a class=\\\"gallery-insert-action\\\">Insert Gallery</a>\\n    </small>\\n    <button class=\\\"medium-insert-buttons-show show_option\\\" type=\\\"button\\\"></button>\\n</div>\\n\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/core-caption.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var helper;\n\n  return \"<figcaption contenteditable=\\\"true\\\" class=\\\"medium-insert-caption-placeholder\\\" data-placeholder=\\\"\"\n    + container.escapeExpression(((helper = (helper = helpers.placeholder || (depth0 != null ? depth0.placeholder : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === \"function\" ? helper.call(depth0 != null ? depth0 : (container.nullContext || {}),{\"name\":\"placeholder\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\"></figcaption>\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/core-empty-line.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<p><br></p>\\n\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/embeds-toolbar.hbs\"] = Handlebars.template({\"1\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"    <div class=\\\"medium-insert-embeds-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active\\\">\\n        <ul class=\\\"medium-editor-toolbar-actions clearfix\\\">\\n\"\n    + ((stack1 = helpers.each.call(depth0 != null ? depth0 : (container.nullContext || {}),(depth0 != null ? depth0.styles : depth0),{\"name\":\"each\",\"hash\":{},\"fn\":container.program(2, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"        </ul>\\n    </div>\\n\";\n},\"2\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return ((stack1 = helpers[\"if\"].call(depth0 != null ? depth0 : (container.nullContext || {}),(depth0 != null ? depth0.label : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":container.program(3, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\");\n},\"3\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\";\n\n  return \"                    <li>\\n                        <button class=\\\"medium-editor-action\\\" data-action=\\\"\"\n    + container.escapeExpression(((helper = (helper = helpers.key || (data && data.key)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"key\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\">\"\n    + ((stack1 = ((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"label\",\"hash\":{},\"data\":data}) : helper))) != null ? stack1 : \"\")\n    + \"</button>\\n                    </li>\\n\";\n},\"5\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"    <div class=\\\"medium-insert-embeds-toolbar2 medium-editor-toolbar medium-editor-toolbar-active\\\">\\n        <ul class=\\\"medium-editor-toolbar-actions clearfix\\\">\\n\"\n    + ((stack1 = helpers.each.call(depth0 != null ? depth0 : (container.nullContext || {}),(depth0 != null ? depth0.actions : depth0),{\"name\":\"each\",\"hash\":{},\"fn\":container.program(2, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"        </ul>\\n    </div>\\n\";\n},\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, alias1=depth0 != null ? depth0 : (container.nullContext || {});\n\n  return ((stack1 = helpers[\"if\"].call(alias1,(depth0 != null ? depth0.styles : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":container.program(1, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\\n\"\n    + ((stack1 = helpers[\"if\"].call(alias1,(depth0 != null ? depth0.actions : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":container.program(5, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\");\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/embeds-wrapper.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper;\n\n  return \"<div class=\\\"medium-insert-embeds\\\" contenteditable=\\\"false\\\">\\n\t<figure>\\n\t\t<div class=\\\"medium-insert-embed\\\">\\n\t\t\t\"\n    + ((stack1 = ((helper = (helper = helpers.html || (depth0 != null ? depth0.html : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === \"function\" ? helper.call(depth0 != null ? depth0 : (container.nullContext || {}),{\"name\":\"html\",\"hash\":{},\"data\":data}) : helper))) != null ? stack1 : \"\")\n    + \"\\n\t\t</div>\\n\t</figure>\\n\t<div class=\\\"medium-insert-embeds-overlay\\\"></div>\\n</div>\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/images-fileupload.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<input type=\\\"file\\\" multiple>\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/images-grid-each.hbs\"] = Handlebars.template({\"1\":function(container,depth0,helpers,partials,data) {\n    return \"        <div class=\\\"medium-insert-images-progress\\\"></div>\\n\";\n},\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\", alias4=container.escapeExpression;\n\n  return \"<div class=\\\"grid\\\" contenteditable=\\\"false\\\">\\n    <img src=\\\"/_ui/images/common/blank.gif\\\" data-src=\\\"\"\n    + alias4(((helper = (helper = helpers.img || (depth0 != null ? depth0.img : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"img\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" alt=\\\"\\\" class=\\\"\\\" style=\\\"background-image:url('\"\n    + alias4(((helper = (helper = helpers.img || (depth0 != null ? depth0.img : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"img\",\"hash\":{},\"data\":data}) : helper)))\n    + \"');\\\">\\n    <a href=\\\"#\\\" class=\\\"remove\\\">Remove</a>\\n    <a href=\\\"#\\\" class=\\\"btn-caption\\\">Add Caption</a>\\n    <figcaption contenteditable=\\\"true\\\" class=\\\"text-placeholder\\\" data-placeholder=\\\"Type an image caption\\\">\"\n    + alias4(((helper = (helper = helpers.caption || (depth0 != null ? depth0.caption : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"caption\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</figcaption>\\n\"\n    + ((stack1 = helpers[\"if\"].call(alias1,(depth0 != null ? depth0.progress : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":container.program(1, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"</div>\\n\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/images-grid-popup.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<small contenteditable=\\\"false\\\" class=\\\"add_option_tools _grid\\\" style=\\\"display:none;\\\">\\n    <a data-action=\\\"add\\\">Add images</a>\\n    <a data-action=\\\"organize\\\">Organize images</a>\\n    <a data-action=\\\"delete\\\">Delete Grid</a>\\n</small>\\n\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/images-image.hbs\"] = Handlebars.template({\"1\":function(container,depth0,helpers,partials,data) {\n    return \"        <div class=\\\"medium-insert-images-progress\\\"></div>\\n\";\n},\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {});\n\n  return \"<figure contenteditable=\\\"false\\\">\\n    <img src=\\\"\"\n    + container.escapeExpression(((helper = (helper = helpers.img || (depth0 != null ? depth0.img : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === \"function\" ? helper.call(alias1,{\"name\":\"img\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" alt=\\\"\\\" />\\n\"\n    + ((stack1 = helpers[\"if\"].call(alias1,(depth0 != null ? depth0.progress : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":container.program(1, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"</figure>\\n\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/images-progressbar.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<progress min=\\\"0\\\" max=\\\"100\\\" value=\\\"0\\\">0</progress>\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/images-toolbar-gear.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active\\\">\\n    <label class=\\\"label\\\">IMAGE STYLE</label>\\n    <div class=\\\"editable_tools\\\">\\n        <a class=\\\"edit_full\\\">Full</a>\\n        <a class=\\\"edit_normal\\\">Normal</a>\\n    </div>\\n</div>\\n\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/images-toolbar.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active\\\">\\n    <div class=\\\"editable_tools\\\">\\n        <a class=\\\"edit_full\\\">Full</a>\\n        <a class=\\\"edit_normal\\\">Normal</a>\\n        <a class=\\\"edit_with_quote\\\">With Quote</a>\\n    </div>\\n</div>\\n\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/product-card.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<ul class=\\\"itemList product\\\" contenteditable=\\\"false\\\">\\n  <% items.forEach(function(item, idx) { %>\\n  <li class=\\\"itemListElement\\\" data-id=\\\"<%= item.id %>\\\" data-idx=\\\"<%= idx %>\\\">\\n    <span class=\\\"figure <% if (item.image_fit_to_bounds) { %>fit<% } %>\\\">\\n      <img src=\\\"/_ui/images/common/blank.gif\\\" style=\\\"background-image:url(<%= item.image %>)\\\">\\n    </span>\\n    <span class=\\\"figcaption\\\">\\n      <span class=\\\"title\\\"><%= item.title %></span>\\n      <% if (item.retail_price != null) { %>\\n      <b class=\\\"price sales\\\">$<%= item.price %> <small class=\\\"before\\\">$<%= item.retail_price %></small></b>\\n      <% } else { %>\\n      <b class=\\\"price\\\">$<%= item.price %></b>\\n      <% } %>\\n    </span>\\n    <a class=\\\"remove\\\">Remove</a>\\n  </li>\\n  <% }); %>\\n  <small class=\\\"add_option_tools\\\" style=\\\"display:none;\\\">\\n    <a class=\\\"add-product\\\">Organize Products</a>\\n    <a class=\\\"delete-slideshow\\\">Delete Grid</a>\\n  </small>\\n</ul>\\n\";\n},\"useData\":true});\n\nthis[\"MediumInsert\"][\"Templates\"][\"src/js/templates/product-slideshow.hbs\"] = Handlebars.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"itemSlide product\\\" contenteditable=\\\"false\\\">\\n  <div class=\\\"itemSlideWrap\\\">\\n    <ul class=\\\"stream after\\\">\\n      <% items.forEach(function(item, idx) { %>\\n      <li class=\\\"itemSlideElement\\\" data-id=\\\"<%= item.id %>\\\" data-idx=\\\"<%= idx %>\\\">\\n        <div class=\\\"figure-item\\\">\\n          <figure <% if (item.image_fit_to_bounds) { %>class=\\\"fit\\\"<% } %>>\\n            <a href=\\\"<% if (item.html_url) { %><%= item.html_url %><% } else { %>/sales/<%= item.id %>?utm=article<% } %>?utm=article\\\"><span\\n                class=\\\"back\\\"></span><img class=\\\"figure\\\" src=\\\"/_ui/images/common/blank.gif\\\" style=\\\"background-image: url(<%= item.image %>);\\\"></a>\\n          </figure>\\n          <figcaption>\\n            <span class=\\\"show_cart\\\">\\n              <button class=\\\"btn-cart nopopup soldout\\\">\\n                <% if (item.retail_price != null) { %><b class=\\\"price sales\\\">$<%= item.price %> <small class=\\\"before\\\">$<%= item.retail_price %></small></b><% } else { %><b class=\\\"price\\\">$<%= item.price %></b><% } %>\\n              </button>\\n            </span>\\n            <a href=\\\"<%= item.html_url %>?utm=article\\\" class=\\\"title\\\"><%= item.title %></a>\\n          </figcaption>\\n          <a class=\\\"delete\\\"></a>\\n        </div>\\n      </li>\\n      <% }); %>\\n    </ul>\\n  </div>\\n  <a href=\\\"#\\\" class=\\\"prev\\\">Prev</a>\\n  <a href=\\\"#\\\" class=\\\"next\\\">Next</a>\\n  <small class=\\\"add_option_tools\\\" style=\\\"display:none;\\\">\\n    <a class=\\\"add-product\\\">Organize Products</a>\\n    <a class=\\\"delete-slideshow\\\">Delete Slideshow</a>\\n  </small>\\n</div>\\n\";\n},\"useData\":true});\n;(function ($, window, document, undefined) {\n\n    'use strict';\n\n    /** Default values */\n    var pluginName = 'mediumInsert',\n        defaults = {\n            editor: null,\n            enabled: true,\n            addons: {\n                images: true, // boolean or object containing configuration\n                embeds: true\n            }\n        };\n\n    /**\n     * Capitalize first character\n     *\n     * @param {string} str\n     * @return {string}\n     */\n\n    function ucfirst(str) {\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    }\n\n    // https://gist.github.com/yangshun/9892961#file-youtube-vimeo-url-parser-js-L24\n    function parseVideo (url) {\n        // - Supported YouTube URL formats:\n        //   - http://www.youtube.com/watch?v=My2FRPA3Gf8\n        //   - http://youtu.be/My2FRPA3Gf8\n        //   - https://youtube.googleapis.com/v/My2FRPA3Gf8\n        // - Supported Vimeo URL formats:\n        //   - http://vimeo.com/25451551\n        //   - http://player.vimeo.com/video/25451551\n        // - Also supports relative URLs:\n        //   - //player.vimeo.com/video/25451551\n\n        url.match(/(http:|https:|)\\/\\/(player.|www.)?(vimeo\\.com|youtu(be\\.com|\\.be|be\\.googleapis\\.com))\\/(video\\/|embed\\/|watch\\?v=|v\\/)?([A-Za-z0-9._%-]*)(\\&\\S+)?/);\n\n        if (RegExp.$3.indexOf('youtu') > -1) {\n            var type = 'youtube';\n        } else if (RegExp.$3.indexOf('vimeo') > -1) {\n            var type = 'vimeo';\n        }\n\n        return {\n            type: type,\n            id: RegExp.$6\n        };\n    }\n\n    /**\n     * Core plugin's object\n     *\n     * Sets options, variables and calls init() function\n     *\n     * @constructor\n     * @param {DOM} el - DOM element to init the plugin on\n     * @param {object} options - Options to override defaults\n     * @return {void}\n     */\n\n    function Core(el, options) {\n        var editor;\n\n        this.el = el;\n        this.$el = $(el);\n        this.templates = window.MediumInsert.Templates;\n\n        if (options) {\n            // Fix #142\n            // Avoid deep copying editor object, because since v2.3.0 it contains circular references which causes jQuery.extend to break\n            // Instead copy editor object to this.options manually\n            editor = options.editor;\n            options.editor = null;\n        }\n        this.options = $.extend(true, {}, defaults, options);\n        this.options.editor = editor;\n\n        this._defaults = defaults;\n        this._name = pluginName;\n\n        // Extend editor's functions\n        if (this.options && this.options.editor) {\n            if (this.options.editor._serialize === undefined) {\n                this.options.editor._serialize = this.options.editor.serialize;\n            }\n            if (this.options.editor._destroy === undefined) {\n                this.options.editor._destroy = this.options.editor.destroy;\n            }\n            if (this.options.editor._setup === undefined) {\n                this.options.editor._setup = this.options.editor.setup;\n            }\n            this.options.editor._hideInsertButtons = this.hideButtons;\n\n            this.options.editor.serialize = this.editorSerialize;\n            this.options.editor.destroy = this.editorDestroy;\n            this.options.editor.setup = this.editorSetup;\n\n            if (this.options.editor.getExtensionByName('placeholder') !== undefined) {\n                this.options.editor.getExtensionByName('placeholder').updatePlaceholder = this.editorUpdatePlaceholder;\n            }\n        }\n    }\n\n    /**\n     * Initialization\n     *\n     * @return {void}\n     */\n\n    function getAdjacentCursor($place) {\n        var $container = $('.description.more');\n        var isFirstChild = $place.is(':first-child');\n        var cursor;\n        if (isFirstChild) {\n            return { recoveryMode: 'insert-first' };\n        } else {\n            if ($place.is('.description.more > *')) {\n                cursor = $place.before();\n            } else {\n                cursor = $place.closest('.description.more > *').before();\n            }\n            return { recoveryMode: 'insert-next', cursor: cursor };\n        }\n    }\n\n    function restoreCursor(recoveryObject) {\n        var elToReplace = $('<p />')\n        if (recoveryObject.recoveryMode === 'insert-first') {\n            $('.description.more').prepend(elToReplace);\n        } else if (recoveryObject.recoveryMode === 'insert-next') {\n            elToReplace.insertAfter(recoveryObject.cursor);\n        } else {\n            console.warn(\"restoreCursor(): ?\")\n        }\n        return elToReplace;\n    }\n\n    Core.prototype.init = function () {\n        this.$el.addClass('medium-editor-insert-plugin');\n\n        if (typeof this.options.addons !== 'object' || Object.keys(this.options.addons).length === 0) {\n            this.disable();\n        }\n\n        this.initAddons();\n        this.clean();\n        this.events();\n\n        if (window.isWhitelabelV2) {\n            var productCardTemplate = _.template(this.templates['src/js/templates/product-card.hbs']().trim());\n            var productSlideshowTemplate = _.template(this.templates['src/js/templates/product-slideshow.hbs']().trim());\n            var $insertProductDialog = $.dialog('insert_product').$obj;\n            var selectedTemplate = _.template($insertProductDialog.find('#popup-tpl-selected').html())\n            var searchedTemplate = _.template($insertProductDialog.find('#popup-tpl-searched').html())\n            var $searched = $insertProductDialog.find('.suggest');\n            var $selected = $insertProductDialog.find('.featured');\n            Sortable.create($selected.find('ul').get(0), {\n                handle: '.btn-move',\n            });\n            \n            $insertProductDialog\n                .data('productCardTemplate', productCardTemplate)\n                .data('productSlideshowTemplate', productSlideshowTemplate);\n\n            var ThingCache = {};\n            window.ThingCache = ThingCache;\n            var searchCache = {};\n            var ref = { selectedItemIds: [] };\n\n            $insertProductDialog.find('input.text')\n                .on('keyup', _.debounce(function(e) {\n                    var val = e.target.value.trim();\n                    if (val === '') {\n                        $searched.hide();\n                        return;\n                    }\n                    var dfd;\n                    if (searchCache[val]) {\n                        dfd = $.Deferred();\n                        dfd.resolve(searchCache[val]);\n                    } else {\n                        dfd = $.get(window.REST_API_ENDPOINT, { keyword: val });\n                    }\n                    dfd.then(function(things) {\n                        if (!searchCache[val]) {\n                            searchCache[val] = things;\n                        }\n                        $searched.empty();\n                        if (things.products.length > 0) {\n                            $searched.show();\n                            things.products.forEach(function(thing) {\n                                var selected = _.find(ref.selectedItemIds, function(sid){ return thing.id === sid }) !== undefined;\n                                if (!selected) {\n                                    $searched.append($(searchedTemplate(thing)).data('thing', thing));\n                                    if (ThingCache[thing.id] == null) {\n                                        thing.cached = true;\n                                        ThingCache[thing.id] = thing;\n                                    }\n                                }\n                            });\n                        } else {\n                            $searched.hide();\n                        }\n                    })\n                    .fail(function(xhr) {\n                        if (xhr.status === 404) {\n                            alertify.alert('Product not found.');\n                        }\n                    })\n                }, 500))\n                .on('focus', function() {\n                    $(this).trigger('keyup');\n                });\n            $('.popup.insert_product .btn-save').on('click', function () {\n                var ids = $selected.find('li').map(function(i, e){ return Number($(e).attr('data-sid') || 0); }).toArray();\n                var items = ids.map(function(sid){ return ThingCache[sid]; });\n                // select template and feed context\n                var type = $insertProductDialog.data('type');\n                var tpl; \n                if (type === 'card') {\n                    tpl = productCardTemplate;\n                } else if (type === 'slideshow') {\n                    tpl = productSlideshowTemplate;\n                }\n                var $el = $(tpl({ items: items }));\n                $el.data('selectedItemIds', _.clone(ids));\n\n                var updatingRoot = $(this).data('updatingRoot');\n                // slideshow update mode\n                if (updatingRoot) {\n                    updatingRoot.replaceWith($el);\n                    $(this).data('updatingRoot', null);\n                } else {\n                    var $place = restoreCursor($insertProductDialog.data('cursor'));\n                    $place.replaceWith($el);\n                }\n\n                $.dialog('insert_product').close();\n            });\n\n            $searched.on('click', 'li', function(){\n                $searched.hide();\n                var thing = $(this).data('thing');\n                $selected.show();\n                // find dupe\n                var $dupe = $selected.find('ul li[data-sid=\"' + thing.id + '\"]')\n                if ($dupe.length > 0) {\n                    return;\n                }\n                ref.selectedItemIds.push(thing.id);\n                $selected.find('ul')\n                    .prepend(selectedTemplate(thing));\n                var cnt = ref.selectedItemIds.length;\n                $insertProductDialog.find('.btn-save')\n                    .attr('disabled', false)\n                    .text('Insert ' + cnt + (cnt === 1 ? ' Item' : ' Items'));\n            });\n\n            $selected.on('click', 'li .btn-del', function(){\n                var sidToDelete = Number($(this).closest('li').data('sid'));\n                $(this).closest('li').remove();\n                ref.selectedItemIds = ref.selectedItemIds.filter(function(sid) { return sid !== sidToDelete });\n                if (ref.selectedItemIds.length === 0) {\n                    $insertProductDialog.find('.btn-save').attr('disabled', true).text('Insert Items');\n                    $selected.hide();\n                }\n                var cnt = ref.selectedItemIds.length;\n                $insertProductDialog.find('.btn-save')\n                    .attr('disabled', false)\n                    .text('Insert ' + cnt + (cnt === 1 ? ' Item' : ' Items'));\n                return false;\n            });\n\n            $insertProductDialog.data('setSaved', function setSaved($root, _selectedItemIds) {\n                if (_selectedItemIds.length > 0) {\n                    // copy contents\n                    ref.selectedItemIds = _selectedItemIds;\n\n                    function jQueryPromiseAll(arrayOfPromises) {\n                        return jQuery.when.apply(jQuery, arrayOfPromises).then(function() {\n                            return Array.prototype.slice.call(arguments, 0);\n                        });\n                    }\n\n                    jQueryPromiseAll(_selectedItemIds.map(function(sid) {\n                        var promise = $.Deferred();\n                        if (ThingCache[sid]) {\n                            promise.resolve(ThingCache[sid]);\n                        } else {\n                            $.get('/rest-api/v1/things/' + sid + '?sales=true')\n                                .then(function(thing) {\n                                    var ctx;\n                                    try {\n                                        var image = (thing.sales.images[0] && thing.sales.images[0].src) || thing.image.src;\n                                        ctx = {\n                                            id: thing.sales.id,\n                                            brand_name: thing.sales.seller.brand_name,\n                                            title: thing.sales.title,\n                                            price: thing.sales.price,\n                                            thumbnail: image,\n                                            image: image,\n                                        }\n                                        ThingCache[thing.sales.id] = ctx;\n                                    } catch(e) {\n                                        ctx = {\n                                            id: '0',\n                                            brand_name: 'UNABLE_TO_LOAD',\n                                            title: 'UNABLE_TO_LOAD',\n                                            price: 0,\n                                            thumbnail: '/_ui/images/common/blank.gif',\n                                        };\n                                    }\n                                    promise.resolve(ctx);\n                                })\n                                .fail(function(xhr) {\n                                    console.warn('failed to load', sid, xhr);\n                                    promise.resolve({\n                                        id: '0',\n                                        brand_name: 'UNABLE_TO_LOAD',\n                                        title: 'UNABLE_TO_LOAD',\n                                        price: 0,\n                                        thumbnail: '/_ui/images/common/blank.gif',\n                                    });\n                                });\n                        }\n                        return promise\n                    })).then(function(args) {\n                        args.forEach(function(thing) {\n                            $selected.find('ul').append(selectedTemplate(thing));\n                        });\n                    })\n                    $selected.show();\n                    var cnt = _selectedItemIds.length;\n                    $insertProductDialog.find('.btn-save')\n                        .attr('disabled', false)    \n                        .text('Insert ' + cnt + (cnt === 1 ? ' Item' : ' Items'));\n                    $insertProductDialog.find('.btn-save').data('updatingRoot', $root);\n                }\n            })\n\n            // reset\n            $insertProductDialog.on('open', function() {\n                ref.selectedItemIds = [];\n                $insertProductDialog.find('input.text').val('');\n                $selected\n                    .find('ul').empty().end()\n                    .hide();\n                $searched.empty().hide();\n                $(this).find('.btn-save').attr('disabled', true).text('Insert Items');\n            });\n\n            // toggle button\n            setTimeout(function(t) {\n                t.clean();\n                t.positionButtons();\n                t.showButtons();\n                if (t.$el.find('.medium-insert-active').length === 0) {\n                    var activeInsertAdded = false;\n                    t.$el.find('> p').each(function(i, e) {\n                        if (activeInsertAdded) {\n                            return\n                        }\n                        if ($(e).text().trim() === '') {\n                            $(e).addClass('medium-insert-active')\n                            activeInsertAdded = true\n                        }\n                    });\n                }\n            }, 50, this);\n        } // if whitelabel v2 end\n    };\n\n    /**\n     * Event listeners\n     *\n     * @return {void}\n     */\n    Core.prototype.resetOptionV2 = function resetOptionV2() {\n        $('.add_option').hide();\n        $('.add_option_tools .insert-product, .add_option_tools .insert-text, .add_option_tools .insert-image, .add_option_tools .insert-media, .add_option_tools .insert-youtube').hide();\n        $('.add_option .insert-option').show();\n    }\n\n    Core.prototype.hideOptionPopupV2 = function hideOptionPopupV2() {\n        $('.medium-insert-buttons .add_option_tools').hide();\n        $('.medium-insert-buttons .add_option_tools .insert-product, .medium-insert-buttons .add_option_tools .insert-text, .medium-insert-buttons .add_option_tools .insert-image, .add_option_tools .insert-media, .add_option_tools .insert-youtube').hide();\n        $('.add_option .insert-option').show();\n    }\n\n    Core.prototype.events = function () {\n        var that = this;\n\n        function adjustCaretBeforeInsertWidget(root) {\n            var $place = root.$el.find('.medium-insert-active');\n            // From images.js \n            if ($place.is('p')) {\n                root.migrateExistingContent($place);\n                $place.replaceWith('<div class=\"medium-insert-active\">' + $place.html() + '</div>');\n                $place = root.$el.find('.medium-insert-active');\n                if ($place.next().is('p')) {\n                    root.moveCaret($place.next());\n                } else {\n                    $place.after('<p><br></p>'); // add empty paragraph so we can move the caret to the next line.\n                    root.moveCaret($place.next());\n                }\n            }\n            return $place;\n        }\n\n        function checkSelectionActive() {\n            if (that.$el.find('> .medium-insert-active').length === 0) {\n                var $anchorNode = $(document.getSelection().anchorNode)\n                if ($anchorNode.is('.description.more > *')) {\n                    $anchorNode.addClass('medium-insert-active');\n                }\n            }\n        }\n\n        function insertYoutubeOnEvent(that) {\n            var input = $('.insert-youtube input').val();\n            if (!input) {\n                return;\n            }\n            var vid = parseVideo(input.trim());\n            if (vid.type === 'youtube') { // youtube.com\n                var $place = that.$el.find('.medium-insert-active');\n                var $videoElement = $(`<p class=\"article-media media-youtube media-youtube-with-wrap\" data-service=\"youtube\" data-service-id=\"${vid.id}\" style=\"text-align: center;\"><span class=\"article-media-youtube-wrap\"><iframe src=\"https://www.youtube.com/embed/${vid.id}?\" width=\"100%\" height=\"100%\" frameborder=\"0\" allowfullscreen=\"allowfullscreen\"></iframe></span></p>`);\n                var $place = that.$el.find('.medium-insert-active');\n                if ($place.is('p')) {\n                    that.migrateExistingContent($place);\n                    $place.replaceWith('<div class=\"medium-insert-active\">' + $place.html() + '</div>');\n                    $place = that.$el.find('.medium-insert-active');\n                    if ($place.next().is('p')) {\n                        that.moveCaret($place.next());\n                    } else {\n                        $place.after('<p><br></p>'); // add empty paragraph so we can move the caret to the next line.\n                        that.moveCaret($place.next());\n                    }\n                    $place.replaceWith($videoElement);\n                    window.EditorControl.refresh();\n                }\n                return;\n            } else {\n                window.alert('Video service other than youtube is not supported.');\n                return;\n            }\n        }\n\n        this.$el\n            .on('dragover drop', function (e) {\n                e.preventDefault();\n            })\n            .on('keyup click focusout', $.proxy(this, 'toggleButtons'))\n            .on('selectstart mousedown', '.medium-insert, .medium-insert-buttons', $.proxy(this, 'disableSelection'))\n            .on('click', '> p', function() {\n                checkSelectionActive();\n            })\n            .on('click', '.medium-insert-buttons-show', function(e) {\n                var isVisible = $('.medium-insert-buttons .add_option_tools').is(':visible')\n                that.toggleAddons.call(that, e);\n                if (!isVisible) {\n                    setTimeout(function() {\n                        var mediumEditor = that.getEditor();\n                        var tb = mediumEditor.getExtensionByName('toolbar');\n                        if (tb && tb.isDisplayed()) {\n                            tb.hideToolbar();\n                        }\n                    }, 50)\n                }\n            })\n            .on('click', '.medium-insert-action', $.proxy(this, 'addonAction'))\n            .on('click', '.gallery-insert-action', (function(){ // #ARTICLE_MOD\n                checkSelectionActive();\n                var $place = adjustCaretBeforeInsertWidget(this);\n                if (!$place.get(0)) {\n                    return;\n                }\n                window.GalleryControl.uploadImages(function(nextImages) {\n                    if (nextImages === false) {\n                        alert('Failed to upload images, please try again'); return;\n                    } \n                    window.GalleryControl.renderTo($place, null, function(control) {\n                        control.instance.addImages(nextImages.filter(e => e));\n                        that.hideOptionPopupV2();\n                    });\n                });\n            }).bind(this))\n            .on('click', '.video-insert-action', (function(){ // #ARTICLE_MOD\n                var input = window.prompt('Please put youtube address');\n                if (input == null) {\n                    return;\n                }\n                var vid = parseVideo(input.trim());\n                if (vid.type === 'youtube') { // youtube.com\n                    var $videoElement = $(`<p class=\"article-media media-youtube\" data-service=\"youtube\" data-service-id=\"${vid.id}\" style=\"text-align: center;\"><iframe src=\"https://www.youtube.com/embed/${vid.id}?\" width=\"560\" height=\"315\" frameborder=\"0\" allowfullscreen=\"allowfullscreen\"></iframe></p>`);\n                    var $place = this.$el.find('.medium-insert-active');\n                    if ($place.is('p')) {\n                        this.migrateExistingContent($place);\n                        $place.replaceWith('<div class=\"medium-insert-active\">' + $place.html() + '</div>');\n                        $place = this.$el.find('.medium-insert-active');\n                        if ($place.next().is('p')) {\n                            this.moveCaret($place.next());\n                        } else {\n                            $place.after('<p><br></p>'); // add empty paragraph so we can move the caret to the next line.\n                            this.moveCaret($place.next());\n                        }\n                        $place.replaceWith($videoElement);\n                        window.EditorControl.refresh();\n                    }\n                    return;\n                } else {\n                    window.alert('Video service other than youtube is not supported.');\n                    return;\n                }\n            }).bind(this))\n            .on('click', '.medium-insert-buttons .trick', (function(e) { // #ARTICLE_MOD\n                if (!window.isWhitelabelV2) {\n                    this.$el.find('.add_option_tools').hide();\n                }\n            }).bind(this))\n            .on('paste', '.medium-insert-caption-placeholder', function (e) {\n                $.proxy(that, 'removeCaptionPlaceholder')($(e.target));\n            });\n        /*\n            Whitelabel V2 Stuff\n        */\n        if (isWhitelabelV2) {\n           this.$el\n           .on('click', '.insert-option .insert-action-text', function(){ // #ARTICLE_MOD\n                $('.add_option .insert-option').hide();\n                $('.add_option_tools .insert-text').show();\n                return false;\n            })\n            .on('click', '.insert-option .insert-action-media', function(){ // #ARTICLE_MOD\n                $('.add_option .insert-option').hide()\n                $('.add_option_tools .insert-media').show();\n                return false;\n            })\n            .on('click', '.insert-media .insert-action-image', function(){ // #ARTICLE_MOD\n                $('.add_option .insert-media').hide()\n                $('.add_option_tools .insert-image').show();\n                return false;\n            })\n            .on('click', '.insert-media .insert-action-youtube', function(){ // #ARTICLE_MOD\n                $('.add_option .insert-media').hide()\n                $('.add_option_tools .insert-youtube').show();\n                setTimeout(function() {\n                    $('.add_option_tools .insert-youtube input').focus();\n                }, 350)\n                return false;\n            })\n            .on('click', '.insert-youtube input', function() {\n                $(this).focus();\n                return true;\n            })\n            .on('focus', '.insert-youtube input', function() {\n                return true;\n            })\n            .on('mouseover', '.media-youtube', function(){\n                if ($(this).find('a.remove').length > 0) {\n                    $(this).find('a.remove').show();\n                } else {\n                    $(this).append('<a class=\"remove\" />');\n                }\n            })\n            .on('mouseout', '.media-youtube', function(){\n                if ($(this).find('a.remove').length > 0) {\n                    $(this).find('a.remove').hide();\n                }\n            })\n            .on('click', '.media-youtube .remove', function() {\n                $(this).closest('.media-youtube').remove();\n                return false;\n            })\n            .on('keydown', '.insert-youtube input', (function(e){ // #ARTICLE_MOD\n                if (e.which === 13) {\n                    insertYoutubeOnEvent(this);\n                    return false;\n                }\n                return true;\n            }).bind(this))\n            .on('click', '.insert-youtube button', (function(e){ // #ARTICLE_MOD\n                insertYoutubeOnEvent(this);\n                return true;\n            }).bind(this))\n            .on('click', '.insert-option .insert-action-product', function(){ // #ARTICLE_MOD\n                $('.add_option .insert-option').hide()\n                $('.add_option_tools .insert-product').show();\n                return false;\n            })\n            .on('click', '.insert-text .label', function(){ // #ARTICLE_MOD\n                $('.add_option_tools .insert-text').hide();\n                $('.add_option .insert-option').show();\n                return false;\n            })\n            .on('click', '.insert-media .label', function(){ // #ARTICLE_MOD\n                $('.add_option_tools .insert-media').hide();\n                $('.add_option .insert-option').show();\n                return false;\n            })\n            .on('click', '.insert-image .label', function(){ // #ARTICLE_MOD\n                $('.add_option_tools .insert-image').hide();\n                $('.add_option .insert-media').show();\n                return false;\n            })\n            .on('click', '.insert-youtube .label', function(){ // #ARTICLE_MOD\n                $('.add_option_tools .insert-youtube').hide();\n                $('.add_option .insert-media').show();\n                return false;\n            })\n            .on('click', '.insert-product .label', function(){ // #ARTICLE_MOD\n                $('.add_option_tools .insert-product').hide();\n                $('.add_option .insert-option').show();\n                return false;\n            })\n            // add text options\n            .on('click', '.insert-action-text-body', (function(){ // #ARTICLE_MOD\n                var $place = adjustCaretBeforeInsertWidget(this);\n                var $el = $('<p class=\"medium-insert-active\">Enter Body Text</p>')\n                $place.replaceWith($el);\n                this.moveCaret($el, $el.text().length);\n                that.hideOptionPopupV2();\n                return false;\n            }).bind(this))\n            .on('click', '.insert-action-text-quote', (function(){ // #ARTICLE_MOD\n                var $place = adjustCaretBeforeInsertWidget(this);\n                var $el = $('<blockquote class=\"medium-insert-active\"><span>Enter Quote Text</span></blockquote>')\n                $place.replaceWith($el);\n                this.moveCaret($el.find('span'), $el.find('span').text().length);\n                that.hideOptionPopupV2();\n                return false;\n            }).bind(this))\n            // add image options\n            .on('click', '.insert-action-image-single', function(){ // #ARTICLE_MOD\n                that.hideOptionPopupV2();\n                return false;\n            })\n            .on('click', '.insert-action-image-grid', function(){ // #ARTICLE_MOD\n                that.hideOptionPopupV2();\n                return false;\n            })\n            .on('click', '.insert-action-image-slideshow', function(){ // #ARTICLE_MOD\n                that.hideOptionPopupV2();\n                return false;\n            })\n            // add product card/slideshow\n            .on('click', '.insert-action-product-card', (function(){ // #ARTICLE_MOD\n                var $place = adjustCaretBeforeInsertWidget(this);\n                $.dialog('insert_product').$obj.data('cursor', getAdjacentCursor($place));\n                $.dialog('insert_product').$obj.data('type', 'card');\n                $.dialog('insert_product').open();\n                that.hideOptionPopupV2();\n                return false;\n            }).bind(this))\n            .on('click', '.insert-action-product-slideshow', (function(){ // #ARTICLE_MOD\n                var $place = adjustCaretBeforeInsertWidget(this);\n                $.dialog('insert_product').$obj.data('cursor', getAdjacentCursor($place));\n                $.dialog('insert_product').$obj.data('type', 'slideshow');\n                $.dialog('insert_product').open();\n                that.hideOptionPopupV2();\n                return false;\n            }).bind(this))\n            .on('mouseover', '.product, .medium-insert-images', function() {\n                $(this).find('.add_option_tools').show();\n            })\n            .on('mouseout', '.product, .medium-insert-images', function () {\n                $(this).find('.add_option_tools').hide();\n            })\n            .on('click', '.product .figure-item.add', function(){ // #ARTICLE_MOD\n                $(this).find('input').click();\n            })\n            .on('click', '.product .figure-item.add input, .product .add-product', function(){ // #ARTICLE_MOD\n                $.dialog('insert_product').open();\n                var isSlide = $(this).closest('.product').hasClass('itemSlide');\n                var isList = $(this).closest('.product').hasClass('itemList');\n                if (isSlide) {\n                    $.dialog('insert_product').$obj.data('type', 'slideshow')\n                } else if (isList) {\n                    $.dialog('insert_product').$obj.data('type', 'card')\n                }\n                // give time for reset\n                var $that = $(this);\n                setTimeout(function(){\n                    var selectedItemIds = $that.closest('.product').find('li').toArray()\n                    .sort(function(a, b) {\n                        return $(a).data('idx') - $(b).data('idx');\n                    }).map(function(e) {\n                        return $(e).data('id');\n                    });\n                    // rearrange the id that might shuffled by slide algo\n                    $that.closest('.product').data('selectedItemIds', selectedItemIds);\n                    $.dialog('insert_product').$obj.data('setSaved')($that.closest('.product'), selectedItemIds);\n                }, 50);\n                return false;\n            })\n            .one('click.initializeSlide', '.itemSlide .prev, .itemSlide .next', function(){\n                var $this = $(this);\n                var $slide = $this.closest('.product');\n                $slide.find('.itemSlide .prev, .itemSlide .next').off('click.initializeSlide');\n                $slide.productSlide({ itemPerSlide: 4, center: true })\n                setTimeout(function() {\n                    $this.click();\n                }, 500);\n                return false;\n            })\n            // .on('click', '.itemSlide .prev', function(){ // #ARTICLE_MOD\n            //     var $wrapper = $(this).closest('.product');\n            //     var len = $wrapper.find('li').length;\n            //     if (len <= 4) {\n            //         return false;\n            //     }\n            //     var si = $wrapper.data('slide-index');\n            //     if (si == null) {\n            //         si = 0;\n            //         $wrapper.data('slide-index', 0);\n            //     }\n            //     if (si === 0) {\n            //         return false;\n            //     }\n            //     $wrapper.find('.itemSlideWrap').css('transform', 'translateX(' + String((si - 1) * -95.5) + '%)');\n            //     $wrapper.data('slide-index', si - 1);\n            //     return false;\n            // })\n            // .on('click', '.itemSlide .next', function(){ // #ARTICLE_MOD\n            //     var $wrapper = $(this).closest('.product');\n            //     var len = $wrapper.find('li').length;\n            //     if (len <= 4) {\n            //         return false;\n            //     }\n            //     var si = $wrapper.data('slide-index');\n            //     if (si == null) {\n            //         si = 0;\n            //         $wrapper.data('slide-index', 0);\n            //     }\n            //     var max = Math.floor(len / 4);\n            //     if (si === max) {\n            //         return false;\n            //     }\n            //     $wrapper.find('.itemSlideWrap').css('transform', 'translateX(' + String((si + 1) * -95.5) + '%)');\n            //     $wrapper.data('slide-index', si + 1);\n            //     return false;\n            // })\n            // product card\n            .on('click', 'ul.itemList .itemListElement .remove', function(){\n                var $wrapper = $(this).closest('.product');\n                var selectedItemIds = $wrapper.data('selectedItemIds');\n                if (selectedItemIds == null) {\n                    selectedItemIds = $(this).closest('.product').find('li').map(function(i, e) {\n                        return $(e).data('id')\n                    }).toArray();\n                }\n                if (selectedItemIds.length <= 1) {\n                    $(this).closest('.itemList').remove();\n                    $wrapper.data('selectedItemIds', []);\n                } else {\n                    var $li = $(this).closest('.itemListElement');\n                    var removingId = $li.data('id');\n                    var next = selectedItemIds.filter(function(sid) { return sid !== removingId });\n                    $wrapper.data('selectedItemIds', next);\n                    $li.remove();\n                }\n            })\n            // product slideshow\n            .on('click', '.itemSlide li.itemSlideElement .delete', function(){\n                var $wrapper = $(this).closest('.product');\n                var selectedItemIds = $wrapper.data('selectedItemIds');\n                if (selectedItemIds == null) {\n                    selectedItemIds = $(this).closest('.product').find('li').map(function(i, e) {\n                        return $(e).data('id')\n                    }).toArray()\n                }\n                if (selectedItemIds.length <= 1) {\n                    $(this).closest('.itemSlide').remove();\n                } else {\n                    var $li = $(this).closest('.itemSlideElement');\n                    var removingId = $li.data('id');\n                    var next = selectedItemIds.filter(function(sid) { return sid !== removingId });\n                    $wrapper.data('selectedItemIds', next);\n                    $li.remove();\n                }\n            })\n            .on('click', '.itemList li.itemListElement .figure, .itemList li.itemListElement .figcaption', function(){\n                window.open('/sales/' + $(this).closest('.itemListElement').data('id'));\n            })\n            .on('click', '> p > a:not(.remove)', function(){\n                that.getEditor().selectElement(this);\n                that.getEditor().getExtensionByName('toolbar').showAndUpdateToolbar();\n                setTimeout(function() {\n                    $('.medium-editor-action-anchor2').click();\n                }, 50)\n            })\n            .on('click', '.product .delete-slideshow', function(){\n                $(this).closest('.product').remove();\n            });\n            $(document.body).on('click', function(e) {\n                if ($('.medium-insert-buttons .add_option_tools:visible').length !== 0 && \n                    $(e.target).closest('.add_option_tools, .show_option').length === 0) {\n                    that.hideOptionPopupV2();\n                }\n            })\n            /*\n            Whitelabel V2 Stuff END\n            */\n        } else {\n        }\n\n        $(window).on('resize', $.proxy(this, 'positionButtons', null));\n\n        // editor custom events\n        // var editor = this.getEditor();\n        // editor.subscribe('editableClick', function(a,b,c){\n        //     console.log('asdf')\n        // })\n    };\n\n    /**\n     * Return editor instance\n     *\n     * @return {object} MediumEditor\n     */\n\n    Core.prototype.getEditor = function () {\n        return this.options.editor;\n    };\n\n    /**\n     * Extend editor's serialize function\n     *\n     * @return {object} Serialized data\n     */\n\n    Core.prototype.editorSerialize = function () {\n        var data = this._serialize();\n\n        $.each(data, function (key) {\n            var $data = $('<div />').html(data[key].value);\n\n            $data.find('.medium-insert-buttons').remove();\n            $data.find('.medium-insert-active').removeClass('medium-insert-active');\n\n            // Restore original embed code from embed wrapper attribute value.\n            $data.find('[data-embed-code]').each(function () {\n                var $this = $(this),\n                    html = $('<div />').html($this.attr('data-embed-code')).text();\n                $this.html(html);\n            });\n\n            data[key].value = $data.html();\n        });\n\n        return data;\n    };\n\n    /**\n     * Extend editor's destroy function to deactivate this plugin too\n     *\n     * @return {void}\n     */\n\n    Core.prototype.editorDestroy = function () {\n        $.each(this.elements, function (key, el) {\n            if ($(el).data('plugin_' + pluginName) instanceof Core) {\n                $(el).data('plugin_' + pluginName).disable();\n            }\n        });\n\n        this._destroy();\n    };\n\n    /**\n     * Extend editor's setup function to activate this plugin too\n     *\n     * @return {void}\n     */\n\n    Core.prototype.editorSetup = function () {\n        this._setup();\n\n        $.each(this.elements, function (key, el) {\n            if ($(el).data('plugin_' + pluginName) instanceof Core) {\n                $(el).data('plugin_' + pluginName).enable();\n            }\n        });\n    };\n\n    /**\n     * Extend editor's placeholder.updatePlaceholder function to show placeholder dispite of the plugin buttons\n     *\n     * @return {void}\n     */\n\n    Core.prototype.editorUpdatePlaceholder = function (el, dontShow) {\n        var contents = $(el).children()\n            .not('.medium-insert-buttons, iframe').contents();\n\n        if (!dontShow && contents.length === 1 && contents[0].nodeName.toLowerCase() === 'br') {\n            this.showPlaceholder(el);\n            this.base._hideInsertButtons($(el));\n        } else {\n            this.hidePlaceholder(el);\n        }\n    };\n\n    /**\n     * Trigger editableInput on editor\n     *\n     * @return {void}\n     */\n\n    Core.prototype.triggerInput = function () {\n        if (this.getEditor()) {\n            this.getEditor().trigger('editableInput', null, this.el);\n        }\n    };\n\n    /**\n     * Deselects selected text\n     *\n     * @return {void}\n     */\n\n    Core.prototype.deselect = function () {\n        document.getSelection().removeAllRanges();\n    };\n\n    /**\n     * Disables the plugin\n     *\n     * @return {void}\n     */\n\n    Core.prototype.disable = function () {\n        this.options.enabled = false;\n\n        this.$el.find('.medium-insert-buttons').addClass('hide');\n    };\n\n    /**\n     * Enables the plugin\n     *\n     * @return {void}\n     */\n\n    Core.prototype.enable = function () {\n        this.options.enabled = true;\n\n        this.$el.find('.medium-insert-buttons').removeClass('hide');\n    };\n\n    /**\n     * Disables selectstart mousedown events on plugin elements except images\n     *\n     * @return {void}\n     */\n\n    Core.prototype.disableSelection = function (e) {\n        var $el = $(e.target);\n\n        if (($el.is('img') === false || $el.hasClass('medium-insert-buttons-show')) && !$el.hasClass('extempt-dis-select')) {\n            e.preventDefault();\n        }\n    };\n\n    /**\n     * Initialize addons\n     *\n     * @return {void}\n     */\n\n    Core.prototype.initAddons = function () {\n        var that = this;\n\n        if (!this.options.addons || this.options.addons.length === 0) {\n            return;\n        }\n\n        $.each(this.options.addons, function (addon, options) {\n            var addonName = pluginName + ucfirst(addon);\n\n            if (options === false) {\n                delete that.options.addons[addon];\n                return;\n            }\n\n            that.$el[addonName](options);\n            that.options.addons[addon] = that.$el.data('plugin_' + addonName).options;\n        });\n    };\n\n    /**\n     * Cleans a content of the editor\n     *\n     * @return {void}\n     */\n\n    Core.prototype.clean = function () {\n        var that = this,\n            $buttons, $lastEl, $text;\n\n        if (this.options.enabled === false) {\n            return;\n        }\n\n        if (this.$el.children().length === 0) {\n            this.$el.html(this.templates['src/js/templates/core-empty-line.hbs']().trim());\n        }\n\n        // Fix #29\n        // Wrap content text in <p></p> to avoid Firefox problems\n        $text = this.$el\n            .contents()\n            .filter(function () {\n                return (this.nodeName === '#text' && $.trim($(this).text()) !== '') || this.nodeName.toLowerCase() === 'br';\n            });\n\n        $text.each(function () {\n            $(this).wrap('<p />');\n\n            // Fix #145\n            // Move caret at the end of the element that's being wrapped\n            that.moveCaret($(this).parent(), $(this).text().length);\n        });\n\n        this.addButtons();\n\n        $buttons = this.$el.find('.medium-insert-buttons');\n        $lastEl = $buttons.prev();\n        if ($lastEl.attr('class') && $lastEl.attr('class').match(/medium\\-insert(?!\\-active)/)) {\n            $buttons.before(this.templates['src/js/templates/core-empty-line.hbs']().trim());\n        }\n    };\n\n    /**\n     * Returns HTML template of buttons\n     *\n     * @return {string} HTML template of buttons\n     */\n\n    Core.prototype.getButtons = function () {\n        if (this.options.enabled === false) {\n            return;\n        }\n        var templateName;\n        if (window.isWhitelabelV2) {\n            templateName = 'src/js/templates/core-buttons-gear.hbs'\n        } else {\n            templateName = 'src/js/templates/core-buttons.hbs'\n        }\n\n        return this.templates[templateName]({\n            addons: this.options.addons\n        }).trim();\n    };\n\n    /**\n     * Appends buttons at the end of the $el\n     *\n     * @return {void}\n     */\n\n    Core.prototype.addButtons = function () {\n        if (this.$el.find('.medium-insert-buttons').length === 0) {\n            var buttons = this.getButtons();\n            if (this.$el.find('.gallery-container').length > 0) {\n                buttons = $(buttons);\n                if (!window.isWhitelabelV2) {\n                    buttons.find('.gallery-insert-action').hide().end()\n                }\n                buttons = buttons.prop('outerHTML');\n            } else {\n                buttons = $(buttons).find('.gallery-insert-action').css('display', 'block').end().prop('outerHTML');\n            }\n            this.$el.append(buttons);\n        }\n    };\n\n    /**\n     * Move buttons to current active, empty paragraph and show them\n     *\n     * @return {void}\n     */\n\n    Core.prototype.toggleButtons = function (e) {\n        var $el = $(e.target),\n            selection = window.getSelection(),\n            that = this,\n            range, $current, $p, activeAddon;\n\n        if (this.options.enabled === false) {\n            return;\n        }\n\n        if (!selection || selection.rangeCount === 0) {\n            $current = $el;\n        } else {\n            range = selection.getRangeAt(0);\n            $current = $(range.commonAncestorContainer);\n        }\n\n        // When user clicks on  editor's placeholder in FF, $current el is editor itself, not the first paragraph as it should\n        if ($current.hasClass('medium-editor-insert-plugin')) {\n            $current = $current.find('p:first');\n        }\n\n        $p = $current.is('p') ? $current : $current.closest('p');\n\n        this.clean();\n\n        // console.log($el.hasClass('medium-editor-placeholder') === false)\n        // console.log($el.closest('.medium-insert-buttons').length === 0)\n        // console.log($current.closest('.medium-insert-buttons').length === 0)\n        \n        if (\n            $el.hasClass('medium-editor-placeholder') === false &&\n            $el.closest('.medium-insert-buttons').length === 0 && $current.closest('.medium-insert-buttons').length === 0) {\n\n            this.$el.find('.medium-insert-active').removeClass('medium-insert-active');\n\n            $.each(this.options.addons, function (addon) {\n                if ($el.closest('.medium-insert-' + addon).length) {\n                    $current = $el;\n                }\n\n                if ($current.closest('.medium-insert-' + addon).length) {\n                    $p = $current.closest('.medium-insert-' + addon);\n                    activeAddon = addon;\n                    return;\n                }\n            });\n\n            if ($p.length && ((/*$p.text().trim() === '' &&*/!activeAddon) || activeAddon === 'images')) {\n                $p.addClass('medium-insert-active');\n\n                if (activeAddon === 'images') {\n                    this.$el.find('.medium-insert-buttons').attr('data-active-addon', activeAddon);\n                } else {\n                    this.$el.find('.medium-insert-buttons').removeAttr('data-active-addon');\n                }\n\n                // If buttons are displayed on addon paragraph, wait 100ms for possible captions to display\n                setTimeout(function () {\n                    that.positionButtons(activeAddon);\n                    that.showButtons(activeAddon);\n                }, activeAddon ? 100 : 0);\n            } else {\n                this.hideButtons();\n            }\n        }\n    };\n\n    /**\n     * Show buttons\n     *\n     * @param {string} activeAddon - Name of active addon\n     * @returns {void}\n     */\n\n    Core.prototype.showButtons = function (activeAddon) {\n        var $buttons = this.$el.find('.medium-insert-buttons');\n\n        $buttons.show();\n        $buttons.find('li').show();\n\n        if (activeAddon) {\n            $buttons.find('li').hide();\n            $buttons.find('button[data-addon=\"' + activeAddon + '\"]').parent().show();\n        }\n    };\n\n    /**\n     * Hides buttons\n     *\n     * @param {jQuery} $el - Editor element\n     * @returns {void}\n     */\n\n    Core.prototype.hideButtons = function ($el) {\n        return; // #ARTICLE_MOD\n        $el = $el || this.$el;\n\n        $el.find('.medium-insert-buttons').hide();\n        $el.find('.medium-insert-buttons-addons').hide();\n        $el.find('.medium-insert-buttons-show').removeClass('medium-insert-buttons-rotate');\n    };\n\n    /**\n     * Position buttons\n     *\n     * @param {string} activeAddon - Name of active addon\n     * @return {void}\n     */\n\n    Core.prototype.positionButtons = function (activeAddon) {\n        var $buttons = this.$el.find('.medium-insert-buttons'),\n            $p = this.$el.find('.medium-insert-active'),\n            $lastCaption = $p.hasClass('medium-insert-images-grid') ? [] : $p.find('figure:last figcaption'),\n            elementsContainer = this.getEditor() ? this.getEditor().options.elementsContainer : $('body').get(0),\n            elementsContainerAbsolute = ['absolute', 'fixed'].indexOf(window.getComputedStyle(elementsContainer).getPropertyValue('position')) > -1,\n            position = { left: 75 }; // fixed 75px\n\n        if ($p.length) {\n            //position.left = $p.position().left;\n            position.top = $p.position().top;\n\n            if (activeAddon) {\n                //position.left += $p.width() - $buttons.find('.medium-insert-buttons-show').width() - 10;\n                position.top += $p.height() - 20 + ($lastCaption.length ? -$lastCaption.height() - parseInt($lastCaption.css('margin-top'), 10) : 10);\n            } else {\n                //position.left += -parseInt($buttons.find('.medium-insert-buttons-addons').css('left'), 10) - parseInt($buttons.find('.medium-insert-buttons-addons button:first').css('margin-left'), 10);\n                position.top += parseInt($p.css('margin-top'), 10);\n                position.top += parseInt($p.css('padding-top'), 10);\n            }\n\n            if (elementsContainerAbsolute) {\n                position.top += elementsContainer.scrollTop;\n            }\n\n            //if (this.$el.hasClass('medium-editor-placeholder') === false && position.left < 0) {\n            //    position.left = $p.position().left;\n            //}\n\n            $buttons.css(position);\n        }\n    };\n\n    /**\n     * Toggles addons buttons\n     *\n     * @return {void}\n     */\n\n    Core.prototype.toggleAddons = function () {\n        var $tools = this.$el.find('.add_option_tools');\n        $tools.toggle(); // #ARTICLE_MOD\n        var isVisible = $tools.is(':visible')\n        if (this.$el.find('.medium-insert-buttons').attr('data-active-addon') === 'images') {\n            this.$el.find('.medium-insert-buttons').find('button[data-addon=\"images\"]').click();\n            return;\n        }\n        //this.$el.find('.medium-insert-buttons-addons').fadeToggle(); // #ARTICLE_MOD\n        //this.$el.find('.medium-insert-buttons-show').toggleClass('medium-insert-buttons-rotate'); // #ARTICLE_MOD\n    };\n\n    /**\n     * Hide addons buttons\n     *\n     * @return {void}\n     */\n\n    Core.prototype.hideAddons = function () {\n        this.$el.find('.medium-insert-buttons-addons').hide();\n        this.$el.find('.medium-insert-buttons-show').removeClass('medium-insert-buttons-rotate');\n    };\n\n    /**\n     * Call addon's action\n     *\n     * @param {Event} e\n     * @return {void}\n     */\n\n    Core.prototype.addonAction = function (e) {\n        var $a = $(e.currentTarget),\n            addon = $a.data('addon'),\n            action = $a.data('action'),\n            meta = $a.data('meta');\n        this.$el.data('plugin_' + pluginName + ucfirst(addon))[action](meta);\n    };\n\n    /**\n     * Move caret at the beginning of the empty paragraph\n     *\n     * @param {jQuery} $el Element where to place the caret\n     * @param {integer} position Position where to move caret. Default: 0\n     *\n     * @return {void}\n     */\n\n    Core.prototype.moveCaret = function ($el, position) {\n        var range, sel, el, textEl;\n\n        position = position || 0;\n        range = document.createRange();\n        sel = window.getSelection();\n        el = $el.get(0);\n\n        if (!el.childNodes.length) {\n            textEl = document.createTextNode(' ');\n            el.appendChild(textEl);\n        }\n\n        range.setStart(el.childNodes[0], position);\n        range.collapse(true);\n        sel.removeAllRanges();\n        sel.addRange(range);\n    };\n\n    /**\n     * Add caption\n     *\n     * @param {jQuery Element} $el\n     * @param {string} placeholder\n     * @return {void}\n     */\n\n    Core.prototype.addCaption = function ($el, placeholder, text) {\n        var $caption = $el.find('figcaption');\n\n        if ($caption.length === 0) {\n            var $newCaption = $(this.templates['src/js/templates/core-caption.hbs']({\n                placeholder: placeholder\n            }));\n            if (text) {\n                $newCaption.removeAttr('data-placeholder');\n                $newCaption.attr('class', '');\n                $newCaption.text(text);\n            }\n            $el.append($newCaption);\n        }\n    };\n\n    /**\n     * Remove captions\n     *\n     * @param {jQuery Element} $ignore\n     * @return {void}\n     */\n\n    Core.prototype.removeCaptions = function ($ignore) {\n        var $captions = this.$el.find('figcaption');\n\n        if ($ignore) {\n            $captions = $captions.not($ignore);\n        }\n\n        $captions.each(function () {\n            if ($(this).hasClass('medium-insert-caption-placeholder') || $(this).text().trim() === '') {\n                $(this).remove();\n            }\n        });\n    };\n\n    /**\n     * Remove caption placeholder\n     *\n     * @param {jQuery Element} $el\n     * @return {void}\n     */\n\n    Core.prototype.removeCaptionPlaceholder = function ($el) {\n        var $caption = $el.is('figcaption') ? $el : $el.find('figcaption');\n\n        if ($caption.length) {\n            $caption\n                .removeClass('medium-insert-caption-placeholder')\n                .removeAttr('data-placeholder');\n        }\n    };\n\n    Core.prototype.migrateExistingContent = function migrateExistingContent($place) {\n        if ($place.text().length > 0) { // ARTICLE_MOD: move text before $place\n            var $cl = $place.clone();\n            $cl.insertBefore($place);\n            $cl.removeClass('medium-insert-active');\n            $place.html('');\n        }\n    };\n\n    /** Plugin initialization */\n\n    $.fn[pluginName] = function (options) {\n        return this.each(function () {\n            var that = this,\n                textareaId;\n\n            if ($(that).is('textarea')) {\n                textareaId = $(that).attr('medium-editor-textarea-id');\n                that = $(that).siblings('[medium-editor-textarea-id=\"' + textareaId + '\"]').get(0);\n            }\n\n            if (!$.data(that, 'plugin_' + pluginName)) {\n                // Plugin initialization\n                $.data(that, 'plugin_' + pluginName, new Core(that, options));\n                $.data(that, 'plugin_' + pluginName).init();\n            } else if (typeof options === 'string' && $.data(that, 'plugin_' + pluginName)[options]) {\n                // Method call\n                $.data(that, 'plugin_' + pluginName)[options]();\n            }\n        });\n    };\n\n})(jQuery, window, document);\n\n; (function ($, window, document, undefined) {\n\n    'use strict';\n\n    /** Default values */\n    var pluginName = 'mediumInsert',\n        addonName = 'Embeds', // first char is uppercase\n        defaults = {\n            label: '<span class=\"fa fa-youtube-play\"></span>',\n            placeholder: 'Paste a YouTube, Vimeo, Facebook, Twitter or Instagram link and press Enter',\n            oembedProxy: 'https://medium.iframe.ly/api/oembed?iframe=1',\n            captions: true,\n            captionPlaceholder: 'Type caption (optional)',\n            storeMeta: false,\n            styles: {\n                wide: {\n                    label: '<span class=\"fa fa-align-justify\"></span>'\n                    // added: function ($el) {},\n                    // removed: function ($el) {}\n                },\n                left: {\n                    label: '<span class=\"fa fa-align-left\"></span>'\n                    // added: function ($el) {},\n                    // removed: function ($el) {}\n                },\n                right: {\n                    label: '<span class=\"fa fa-align-right\"></span>'\n                    // added: function ($el) {},\n                    // removed: function ($el) {}\n                }\n            },\n            actions: {\n                remove: {\n                    label: '<span class=\"fa fa-times\"></span>',\n                    clicked: function () {\n                        var $event = $.Event('keydown');\n\n                        $event.which = 8;\n                        $(document).trigger($event);\n                    }\n                }\n            },\n            parseOnPaste: false\n        };\n\n    /**\n     * Embeds object\n     *\n     * Sets options, variables and calls init() function\n     *\n     * @constructor\n     * @param {DOM} el - DOM element to init the plugin on\n     * @param {object} options - Options to override defaults\n     * @return {void}\n     */\n\n    function Embeds(el, options) {\n        this.el = el;\n        this.$el = $(el);\n        this.templates = window.MediumInsert.Templates;\n        this.core = this.$el.data('plugin_' + pluginName);\n\n        this.options = $.extend(true, {}, defaults, options);\n\n        this._defaults = defaults;\n        this._name = pluginName;\n\n        // Extend editor's functions\n        if (this.core.getEditor()) {\n            this.core.getEditor()._serializePreEmbeds = this.core.getEditor().serialize;\n            this.core.getEditor().serialize = this.editorSerialize;\n        }\n\n        this.init();\n    }\n\n    /**\n     * Initialization\n     *\n     * @return {void}\n     */\n\n    Embeds.prototype.init = function () {\n        var $embeds = this.$el.find('.medium-insert-embeds');\n\n        $embeds.attr('contenteditable', false);\n        $embeds.each(function () {\n            if ($(this).find('.medium-insert-embeds-overlay').length === 0) {\n                $(this).append($('<div />').addClass('medium-insert-embeds-overlay'));\n            }\n        });\n\n        this.events();\n        this.backwardsCompatibility();\n    };\n\n    /**\n     * Event listeners\n     *\n     * @return {void}\n     */\n\n    Embeds.prototype.events = function () {\n        $(document)\n            .on('click', $.proxy(this, 'unselectEmbed'))\n            .on('keydown', $.proxy(this, 'removeEmbed'))\n            .on('click', '.medium-insert-embeds-toolbar .medium-editor-action', $.proxy(this, 'toolbarAction'))\n            .on('click', '.medium-insert-embeds-toolbar2 .medium-editor-action', $.proxy(this, 'toolbar2Action'));\n\n        this.$el\n            .on('keyup click paste', $.proxy(this, 'togglePlaceholder'))\n            .on('keydown', $.proxy(this, 'processLink'))\n            .on('click', '.medium-insert-embeds-overlay', $.proxy(this, 'selectEmbed'))\n            .on('contextmenu', '.medium-insert-embeds-placeholder', $.proxy(this, 'fixRightClickOnPlaceholder'));\n\n        if (this.options.parseOnPaste) {\n            this.$el\n                .on('paste', $.proxy(this, 'processPasted'));\n        }\n\n        $(window)\n            .on('resize', $.proxy(this, 'autoRepositionToolbars'));\n    };\n\n    /**\n     * Replace v0.* class names with new ones, wrap embedded content to new structure\n     *\n     * @return {void}\n     */\n\n    Embeds.prototype.backwardsCompatibility = function () {\n        var that = this;\n\n        this.$el.find('.mediumInsert-embeds')\n            .removeClass('mediumInsert-embeds')\n            .addClass('medium-insert-embeds');\n\n        this.$el.find('.medium-insert-embeds').each(function () {\n            if ($(this).find('.medium-insert-embed').length === 0) {\n                $(this).after(that.templates['src/js/templates/embeds-wrapper.hbs']({\n                    html: $(this).html()\n                }));\n                $(this).remove();\n            }\n        });\n    };\n\n    /**\n     * Extend editor's serialize function\n     *\n     * @return {object} Serialized data\n     */\n\n    Embeds.prototype.editorSerialize = function () {\n        var data = this._serializePreEmbeds();\n\n        $.each(data, function (key) {\n            var $data = $('<div />').html(data[key].value);\n\n            $data.find('.medium-insert-embeds').removeAttr('contenteditable');\n            $data.find('.medium-insert-embeds-overlay').remove();\n\n            data[key].value = $data.html();\n        });\n\n        return data;\n    };\n\n    /**\n     * Add embedded element\n     *\n     * @return {void}\n     */\n\n    Embeds.prototype.add = function () {\n        var $place = this.$el.find('.medium-insert-active');\n\n        // Fix #132\n        // Make sure that the content of the paragraph is empty and <br> is wrapped in <p></p> to avoid Firefox problems\n        $place.html(this.templates['src/js/templates/core-empty-line.hbs']().trim());\n\n        // Replace paragraph with div to prevent #124 issue with pasting in Chrome,\n        // because medium editor wraps inserted content into paragraph and paragraphs can't be nested\n        if ($place.is('p')) {\n            $place.replaceWith('<div class=\"medium-insert-active\">' + $place.html() + '</div>');\n            $place = this.$el.find('.medium-insert-active');\n            this.core.moveCaret($place);\n        }\n\n        $place.addClass('medium-insert-embeds medium-insert-embeds-input medium-insert-embeds-active');\n\n        this.togglePlaceholder({ target: $place.get(0) });\n\n        $place.click();\n        this.core.hideButtons();\n    };\n\n    /**\n     * Toggles placeholder\n     *\n     * @param {Event} e\n     * @return {void}\n     */\n\n    Embeds.prototype.togglePlaceholder = function (e) {\n        var $place = $(e.target),\n            selection = window.getSelection(),\n            range, $current, text;\n\n        if (!selection || selection.rangeCount === 0) {\n            return;\n        }\n\n        range = selection.getRangeAt(0);\n        $current = $(range.commonAncestorContainer);\n\n        if ($current.hasClass('medium-insert-embeds-active')) {\n            $place = $current;\n        } else if ($current.closest('.medium-insert-embeds-active').length) {\n            $place = $current.closest('.medium-insert-embeds-active');\n        }\n\n        if ($place.hasClass('medium-insert-embeds-active')) {\n\n            text = $place.text().trim();\n\n            if (text === '' && $place.hasClass('medium-insert-embeds-placeholder') === false) {\n                $place\n                    .addClass('medium-insert-embeds-placeholder')\n                    .attr('data-placeholder', this.options.placeholder);\n            } else if (text !== '' && $place.hasClass('medium-insert-embeds-placeholder')) {\n                $place\n                    .removeClass('medium-insert-embeds-placeholder')\n                    .removeAttr('data-placeholder');\n            }\n\n        } else {\n            this.$el.find('.medium-insert-embeds-active').remove();\n        }\n    };\n\n    /**\n     * Right click on placeholder in Chrome selects whole line. Fix this by placing caret at the end of line\n     *\n     * @param {Event} e\n     * @return {void}\n     */\n\n    Embeds.prototype.fixRightClickOnPlaceholder = function (e) {\n        this.core.moveCaret($(e.target));\n    };\n\n    /**\n     * Process link\n     *\n     * @param {Event} e\n     * @return {void}\n     */\n\n    Embeds.prototype.processLink = function (e) {\n        var $place = this.$el.find('.medium-insert-embeds-active'),\n            url;\n\n        if (!$place.length) {\n            return;\n        }\n\n        url = $place.text().trim();\n\n        // Return empty placeholder on backspace, delete or enter\n        if (url === '' && [8, 46, 13].indexOf(e.which) !== -1) {\n            $place.remove();\n            return;\n        }\n\n        if (e.which === 13) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            if (this.options.oembedProxy) {\n                this.oembed(url);\n            } else {\n                this.parseUrl(url);\n            }\n        }\n    };\n\n    /**\n     * Process Pasted\n     *\n     * @param {Event} e\n     * @return {void}\n     */\n\n    Embeds.prototype.processPasted = function (e) {\n        var pastedUrl, linkRegEx;\n        if ($(\".medium-insert-embeds-active\").length) {\n            return;\n        }\n\n        pastedUrl = e.originalEvent.clipboardData.getData('text');\n        linkRegEx = new RegExp('^(http(s?):)?\\/\\/','i');\n        if (linkRegEx.test(pastedUrl)) {\n            if (this.options.oembedProxy) {\n                this.oembed(pastedUrl, true);\n            } else {\n                this.parseUrl(pastedUrl, true);\n            }\n        }\n    };\n\n    /**\n     * Get HTML via oEmbed proxy\n     *\n     * @param {string} url\n     * @return {void}\n     */\n\n    Embeds.prototype.oembed = function (url, pasted) {\n        var that = this;\n\n        $.support.cors = true;\n\n        $.ajax({\n            crossDomain: true,\n            cache: false,\n            url: this.options.oembedProxy,\n            dataType: 'json',\n            data: {\n                url: url\n            },\n            success: function (data) {\n                var html = data && data.html;\n\n                if (that.options.storeMeta) {\n                    html += '<div class=\"medium-insert-embeds-meta\"><script type=\"text/json\">' + JSON.stringify(data) + '</script></div>';\n                }\n\n                if (data && !html && data.type === 'photo' && data.url) {\n                    html = '<img src=\"' + data.url + '\" alt=\"\">';\n                }\n\n                if (!html) {\n                    // Prevent render empty embed.\n                    $.proxy(that, 'convertBadEmbed', url)();\n                    return;\n                }\n\n                if (pasted) {\n                    $.proxy(that, 'embed', html, url)();\n                } else {\n                    $.proxy(that, 'embed', html)();\n                }\n            },\n            error: function (jqXHR, textStatus, errorThrown) {\n                var responseJSON = (function () {\n                    try {\n                        return JSON.parse(jqXHR.responseText);\n                    } catch (e) { }\n                })();\n\n                if (typeof window.console !== 'undefined') {\n                    window.console.log((responseJSON && responseJSON.error) || jqXHR.status || errorThrown.message);\n                } else {\n                    window.alert('Error requesting media from ' + that.options.oembedProxy + ' to insert: ' + errorThrown + ' (response status: ' + jqXHR.status + ')');\n                }\n\n                $.proxy(that, 'convertBadEmbed', url)();\n            }\n        });\n    };\n\n    /**\n     * Get HTML using regexp\n     *\n     * @param {string} url\n     * @param {bool} pasted\n     * @return {void}\n     */\n\n    Embeds.prototype.parseUrl = function (url, pasted) {\n        var html;\n\n        if (!(new RegExp(['youtube', 'youtu.be', 'vimeo', 'instagram', 'twitter', 'facebook'].join('|')).test(url))) {\n            $.proxy(this, 'convertBadEmbed', url)();\n            return false;\n        }\n\n        html = url.replace(/\\n?/g, '')\n            .replace(/^((http(s)?:\\/\\/)?(www\\.)?(youtube\\.com|youtu\\.be)\\/(watch\\?v=|v\\/)?)([a-zA-Z0-9\\-_]+)(.*)?$/, '<div class=\"video video-youtube\"><iframe width=\"420\" height=\"315\" src=\"//www.youtube.com/embed/$7\" frameborder=\"0\" allowfullscreen></iframe></div>')\n            .replace(/^https?:\\/\\/vimeo\\.com(\\/.+)?\\/([0-9]+)$/, '<div class=\"video video-vimeo\"><iframe src=\"//player.vimeo.com/video/$2\" width=\"500\" height=\"281\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>')\n            .replace(/^https:\\/\\/twitter\\.com\\/(\\w+)\\/status\\/(\\d+)\\/?$/, '<blockquote class=\"twitter-tweet\" align=\"center\" lang=\"en\"><a href=\"https://twitter.com/$1/statuses/$2\"></a></blockquote><script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>')\n            .replace(/^(https:\\/\\/www\\.facebook\\.com\\/(.*))$/, '<script src=\"//connect.facebook.net/en_US/sdk.js#xfbml=1&amp;version=v2.2\" async></script><div class=\"fb-post\" data-href=\"$1\"><div class=\"fb-xfbml-parse-ignore\"><a href=\"$1\">Loading Facebook post...</a></div></div>')\n            .replace(/^https?:\\/\\/instagram\\.com\\/p\\/(.+)\\/?$/, '<span class=\"instagram\"><iframe src=\"//instagram.com/p/$1/embed/\" width=\"612\" height=\"710\" frameborder=\"0\" scrolling=\"no\" allowtransparency=\"true\"></iframe></span>');\n\n        if (this.options.storeMeta) {\n            html += '<div class=\"medium-insert-embeds-meta\"><script type=\"text/json\">' + JSON.stringify({}) + '</script></div>';\n        }\n\n        if ((/<(\"[^\"]*\"|'[^']*'|[^'\">])*>/).test(html) === false) {\n            $.proxy(this, 'convertBadEmbed', url)();\n            return false;\n        }\n\n        if (pasted) {\n            this.embed(html, url);\n        } else {\n            this.embed(html);\n        }\n    };\n\n    /**\n     * Add html to page\n     *\n     * @param {string} html\n     * @param {string} pastedUrl\n     * @return {void}\n     */\n\n    Embeds.prototype.embed = function (html, pastedUrl) {\n        var $place = this.$el.find('.medium-insert-embeds-active'),\n            $div;\n\n        if (!html) {\n            alert('Incorrect URL format specified');\n            return false;\n        } else {\n            if (html.indexOf('</script>') > -1) {\n                // Store embed code with <script> tag inside wrapper attribute value.\n                // Make nice attribute value escaping using jQuery.\n                $div = $('<div>')\n                    .attr('data-embed-code', $('<div />').text(html).html())\n                    .html(html);\n                html = $('<div>').append($div).html();\n            }\n\n            if (pastedUrl) {\n                // Get the element with the pasted url\n                // place the embed template and remove the pasted text\n                $place = this.$el.find(\":not(iframe, script, style)\")\n                    .contents().filter(\n                        function () {\n                            return this.nodeType === 3 && this.textContent.indexOf(pastedUrl) > -1;\n                        }).parent();\n\n                $place.after(this.templates['src/js/templates/embeds-wrapper.hbs']({\n                    html: html\n                }));\n                $place.text($place.text().replace(pastedUrl, ''));\n            } else {\n                $place.after(this.templates['src/js/templates/embeds-wrapper.hbs']({\n                    html: html\n                }));\n                $place.remove();\n            }\n\n\n            this.core.triggerInput();\n\n            if (html.indexOf('facebook') !== -1) {\n                if (typeof (FB) !== 'undefined') {\n                    setTimeout(function () {\n                        FB.XFBML.parse();\n                    }, 2000);\n                }\n            }\n        }\n    };\n\n    /**\n     * Convert bad oEmbed content to an actual line.\n     * Instead of displaying the error message we convert the bad embed\n     *\n     * @param {string} content Bad content\n     *\n     * @return {void}\n     */\n    Embeds.prototype.convertBadEmbed = function (content) {\n        var $place, $empty, $content,\n            emptyTemplate = this.templates['src/js/templates/core-empty-line.hbs']().trim();\n\n        $place = this.$el.find('.medium-insert-embeds-active');\n\n        // convert embed node to an empty node and insert the bad embed inside\n        $content = $(emptyTemplate);\n        $place.before($content);\n        $place.remove();\n        $content.html(content);\n\n        // add an new empty node right after to simulate Enter press\n        $empty = $(emptyTemplate);\n        $content.after($empty);\n\n        this.core.triggerInput();\n\n        this.core.moveCaret($empty);\n    };\n\n    /**\n     * Select clicked embed\n     *\n     * @param {Event} e\n     * @returns {void}\n     */\n\n    Embeds.prototype.selectEmbed = function (e) {\n        var that = this,\n            $embed;\n        if (this.core.options.enabled) {\n            $embed = $(e.target).hasClass('medium-insert-embeds') ? $(e.target) : $(e.target).closest('.medium-insert-embeds');\n\n            $embed.addClass('medium-insert-embeds-selected');\n\n            setTimeout(function () {\n                that.addToolbar();\n\n                if (that.options.captions) {\n                    that.core.addCaption($embed.find('figure'), that.options.captionPlaceholder);\n                }\n            }, 50);\n        }\n    };\n\n    /**\n     * Unselect selected embed\n     *\n     * @param {Event} e\n     * @returns {void}\n     */\n\n    Embeds.prototype.unselectEmbed = function (e) {\n        var $el = $(e.target).hasClass('medium-insert-embeds') ? $(e.target) : $(e.target).closest('.medium-insert-embeds'),\n            $embed = this.$el.find('.medium-insert-embeds-selected');\n\n        if ($el.hasClass('medium-insert-embeds-selected')) {\n            $embed.not($el).removeClass('medium-insert-embeds-selected');\n            $('.medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2').remove();\n            this.core.removeCaptions($el.find('figcaption'));\n\n            if ($(e.target).is('.medium-insert-caption-placeholder') || $(e.target).is('figcaption')) {\n                $el.removeClass('medium-insert-embeds-selected');\n                this.core.removeCaptionPlaceholder($el.find('figure'));\n            }\n            return;\n        }\n\n        $embed.removeClass('medium-insert-embeds-selected');\n        $('.medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2').remove();\n\n        if ($(e.target).is('.medium-insert-caption-placeholder')) {\n            this.core.removeCaptionPlaceholder($el.find('figure'));\n        } else if ($(e.target).is('figcaption') === false) {\n            this.core.removeCaptions();\n        }\n    };\n\n    /**\n     * Remove embed\n     *\n     * @param {Event} e\n     * @returns {void}\n     */\n\n    Embeds.prototype.removeEmbed = function (e) {\n        var $embed, $empty;\n\n        if (e.which === 8 || e.which === 46) {\n            $embed = this.$el.find('.medium-insert-embeds-selected');\n\n            if ($embed.length) {\n                e.preventDefault();\n\n                $('.medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2').remove();\n\n                $empty = $(this.templates['src/js/templates/core-empty-line.hbs']().trim());\n                $embed.before($empty);\n                $embed.remove();\n\n                // Hide addons\n                this.core.hideAddons();\n\n                this.core.moveCaret($empty);\n                this.core.triggerInput();\n            }\n        }\n    };\n\n    /**\n     * Adds embed toolbar to editor\n     *\n     * @returns {void}\n     */\n\n    Embeds.prototype.addToolbar = function () {\n        var $embed = this.$el.find('.medium-insert-embeds-selected'),\n            active = false,\n            $toolbar, $toolbar2, mediumEditor, toolbarContainer;\n\n        if ($embed.length === 0) {\n            return;\n        }\n\n        mediumEditor = this.core.getEditor();\n        toolbarContainer = mediumEditor.options.elementsContainer || 'body';\n\n        $(toolbarContainer).append(this.templates['src/js/templates/embeds-toolbar.hbs']({\n            styles: this.options.styles,\n            actions: this.options.actions\n        }).trim());\n\n        $toolbar = $('.medium-insert-embeds-toolbar');\n        $toolbar2 = $('.medium-insert-embeds-toolbar2');\n\n        $toolbar.find('button').each(function () {\n            if ($embed.hasClass('medium-insert-embeds-' + $(this).data('action'))) {\n                $(this).addClass('medium-editor-button-active');\n                active = true;\n            }\n        });\n\n        if (active === false) {\n            $toolbar.find('button').first().addClass('medium-editor-button-active');\n        }\n\n        this.repositionToolbars();\n        $toolbar.fadeIn();\n        $toolbar2.fadeIn();\n    };\n\n    Embeds.prototype.autoRepositionToolbars = function () {\n        setTimeout(function () {\n            this.repositionToolbars();\n            this.repositionToolbars();\n        }.bind(this), 0);\n    };\n\n    Embeds.prototype.repositionToolbars = function () {\n        var $toolbar = $('.medium-insert-embeds-toolbar'),\n            $toolbar2 = $('.medium-insert-embeds-toolbar2'),\n            $embed = this.$el.find('.medium-insert-embeds-selected'),\n            elementsContainer = this.core.getEditor().options.elementsContainer,\n            elementsContainerAbsolute = ['absolute', 'fixed'].indexOf(window.getComputedStyle(elementsContainer).getPropertyValue('position')) > -1,\n            elementsContainerBoundary = elementsContainerAbsolute ? elementsContainer.getBoundingClientRect() : null,\n            containerWidth = $(window).width(),\n            position = {};\n\n        if ($toolbar2.length) {\n            position.top = $embed.offset().top + 2; // 2px - distance from a border\n            position.left = $embed.offset().left + $embed.width() - $toolbar2.width() - 4; // 4px - distance from a border\n\n            if (elementsContainerAbsolute) {\n                position.top += elementsContainer.scrollTop - elementsContainerBoundary.top;\n                position.left -= elementsContainerBoundary.left;\n                containerWidth = $(elementsContainer).width();\n            }\n\n            if (position.left + $toolbar2.width() > containerWidth) {\n                position.left = containerWidth - $toolbar2.width();\n            }\n\n            $toolbar2.css(position);\n        }\n\n        if ($toolbar.length) {\n            position.left = $embed.offset().left + $embed.width() / 2 - $toolbar.width() / 2;\n            position.top = $embed.offset().top - $toolbar.height() - 8 - 2 - 5; // 8px - hight of an arrow under toolbar, 2px - height of an embed outset, 5px - distance from an embed\n\n            if (elementsContainerAbsolute) {\n                position.top += elementsContainer.scrollTop - elementsContainerBoundary.top;\n                position.left -= elementsContainerBoundary.left;\n            }\n\n            if (position.top < 0) {\n                position.top = 0;\n            }\n\n            $toolbar.css(position);\n        }\n    };\n\n    /**\n     * Fires toolbar action\n     *\n     * @param {Event} e\n     * @returns {void}\n     */\n\n    Embeds.prototype.toolbarAction = function (e) {\n        var $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button'),\n            $li = $button.closest('li'),\n            $ul = $li.closest('ul'),\n            $lis = $ul.find('li'),\n            $embed = this.$el.find('.medium-insert-embeds-selected'),\n            that = this;\n\n        $button.addClass('medium-editor-button-active');\n        $li.siblings().find('.medium-editor-button-active').removeClass('medium-editor-button-active');\n\n        $lis.find('button').each(function () {\n            var className = 'medium-insert-embeds-' + $(this).data('action');\n\n            if ($(this).hasClass('medium-editor-button-active')) {\n                $embed.addClass(className);\n\n                if (that.options.styles[$(this).data('action')].added) {\n                    that.options.styles[$(this).data('action')].added($embed);\n                }\n            } else {\n                $embed.removeClass(className);\n\n                if (that.options.styles[$(this).data('action')].removed) {\n                    that.options.styles[$(this).data('action')].removed($embed);\n                }\n            }\n        });\n\n        this.core.triggerInput();\n    };\n\n    /**\n     * Fires toolbar2 action\n     *\n     * @param {Event} e\n     * @returns {void}\n     */\n\n    Embeds.prototype.toolbar2Action = function (e) {\n        var $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button'),\n            callback = this.options.actions[$button.data('action')].clicked;\n\n        if (callback) {\n            callback(this.$el.find('.medium-insert-embeds-selected'));\n        }\n\n        this.core.triggerInput();\n    };\n\n    /** Plugin initialization */\n\n    $.fn[pluginName + addonName] = function (options) {\n        return this.each(function () {\n            if (!$.data(this, 'plugin_' + pluginName + addonName)) {\n                $.data(this, 'plugin_' + pluginName + addonName, new Embeds(this, options));\n            }\n        });\n    };\n\n})(jQuery, window, document);\n\n/*global MediumEditor*/\n\n// #ARTICLE_MOD\nvar ImageModes = {\n    Full: 'Full',\n    Normal: 'Normal',\n    Quoted: 'Quoted',\n    Grid: 'Grid',\n};\nvar ImageModesEditClasses = {\n    Full: 'edit_full',\n    Normal: 'edit_normal',\n    Quoted: 'edit_with_quote'\n};\nvar ImageModesClasses = {\n    Full: 'mode-full',\n    Normal: 'mode-normal',\n    Quoted: 'mode-quoted',\n    Grid: 'mode-grid',\n};\nvar quotedPlaceHolderMsg = 'Start typing or paste article text...';\n\n\n; (function ($, window, document, Util, undefined) {\n\n    'use strict';\n\n    /** Default values */\n    var pluginName = 'mediumInsert',\n        addonName = 'Images', // first char is uppercase\n        defaults = {\n            label: '<span class=\"fa fa-camera\"></span>',\n            deleteMethod: 'POST',\n            deleteScript: 'delete.php',\n            preview: true,\n            captions: true,\n            captionPlaceholder: 'Type caption for image (optional)',\n            autoGrid: 3,\n            fileUploadOptions: { // See https://github.com/blueimp/jQuery-File-Upload/wiki/Options\n                url: null,\n                acceptFileTypes: /(\\.|\\/)(gif|jpe?g|png)$/i\n            },\n            fileDeleteOptions: {},\n            styles: {\n                wide: {\n                    label: '<span class=\"fa fa-align-justify\"></span>'\n                    // added: function ($el) {},\n                    // removed: function ($el) {}\n                },\n                left: {\n                    label: '<span class=\"fa fa-align-left\"></span>'\n                    // added: function ($el) {},\n                    // removed: function ($el) {}\n                },\n                right: {\n                    label: '<span class=\"fa fa-align-right\"></span>'\n                    // added: function ($el) {},\n                    // removed: function ($el) {}\n                },\n                grid: {\n                    label: '<span class=\"fa fa-th\"></span>'\n                    // added: function ($el) {},\n                    // removed: function ($el) {}\n                }\n            },\n            actions: {\n                remove: {\n                    label: '<span class=\"fa fa-times\"></span>',\n                    clicked: function () {\n                        var $event = $.Event('keydown');\n\n                        $event.which = 8;\n                        $(document).trigger($event);\n                    }\n                }\n            },\n            sorting: function () {\n                var that = this;\n\n                $('.medium-insert-images').sortable({\n                    group: 'medium-insert-images',\n                    containerSelector: '.medium-insert-images',\n                    itemSelector: 'figure',\n                    placeholder: '<figure class=\"placeholder\">',\n                    handle: 'img',\n                    nested: false,\n                    vertical: false,\n                    afterMove: function () {\n                        that.core.triggerInput();\n                    }\n                });\n            },\n            messages: {\n                acceptFileTypesError: 'This file is not in a supported format: ',\n                maxFileSizeError: 'This file is too big: '\n            }\n            // uploadError: function($el, data) {}\n            // uploadCompleted: function ($el, data) {}\n        };\n\n    /**\n     * Images object\n     *\n     * Sets options, variables and calls init() function\n     *\n     * @constructor\n     * @param {DOM} el - DOM element to init the plugin on\n     * @param {object} options - Options to override defaults\n     * @return {void}\n     */\n\n    function Images(el, options) {\n        this.el = el;\n        this.$el = $(el);\n\n        // this.mode = this.$el.attr('data-mode') || ImageModes.Normal; // #ARTICLE_MOD\n\n        this.$currentImage = null;\n        this.templates = window.MediumInsert.Templates;\n        this.core = this.$el.data('plugin_' + pluginName);\n\n        this.options = $.extend(true, {}, defaults, options);\n\n        this._defaults = defaults;\n        this._name = pluginName;\n        this.meta = null; // should be set as null after use\n\n        // Allow image preview only in browsers, that support's that\n        if (this.options.preview && !window.FileReader) {\n            this.options.preview = false;\n        }\n\n        // Extend editor's functions\n        if (this.core.getEditor()) {\n            this.core.getEditor()._serializePreImages = this.core.getEditor().serialize;\n            this.core.getEditor().serialize = this.editorSerialize;\n        }\n\n        this.init();\n    }\n\n    /**\n     * Initialization\n     *\n     * @return {void}\n     */\n\n    function getImageMode($image) {\n        return $image.closest('figure').attr('data-mode');\n    }\n\n    Images.prototype.init = function () {\n        var $images = this.$el.find('.medium-insert-images');\n\n        $images.find('figcaption').attr('contenteditable', true);\n        $images.find('figure').attr('contenteditable', false);\n\n        this.events();\n        this.backwardsCompatibility();\n        this.sorting();\n    };\n\n    function changeMode($fig, prevMode, nextMode, tempCaptionCallback) {\n        $fig.attr('class', '');\n        $fig.addClass(ImageModesClasses[nextMode]);\n        $fig.attr('data-mode', nextMode);\n        $fig.attr('contenteditable', 'false');\n        var $caption = $fig.find('figcaption');\n        var tempCaption = '';\n        if ($caption.text().trim() !== '') {\n            tempCaption = $caption.text();\n        } else if (prevMode === ImageModes.Quoted) {\n            var quote = $fig.find('.textarea').text().trim();\n            if (quote) {\n                tempCaption = quote;\n            }\n        }\n\n        //this.core.removeCaptions(); // DIDNT WORK\n        if (tempCaption === '') {\n            $fig.find('figcaption').remove();\n        }\n\n        // Process figure when quote mode is related\n        if (nextMode === ImageModes.Quoted) {\n            $fig.find('figcaption').remove();\n            $fig.find('img')\n                .wrap('<p />')\n                .wrap('<span class=\"image\" />');\n            $fig\n                .append('<p contenteditable=\"true\" class=\"textarea\" data-changed=\"false\">' + quotedPlaceHolderMsg + '</p>');\n            if (tempCaption) {\n                $fig.find('.textarea')\n                    .text(tempCaption)\n                    .attr('data-changed', 'true');\n            }\n        } else if (prevMode === ImageModes.Quoted) {\n            var $img = $fig.find('img');\n            $fig.html('');\n            $fig.append($img);\n            if (tempCaption) {\n                tempCaptionCallback && tempCaptionCallback(tempCaption);\n            }\n        }\n    }\n    window.ReactMediumEditor__changeMode = changeMode;\n\n    Images.prototype.handleModeChange = function (nextMode) {\n        var prevMode = getImageMode(this.$currentImage);\n        if (prevMode === nextMode) { // no change in mode\n            return;\n        }\n        var $fig = this.$currentImage.closest('figure');\n        changeMode($fig, prevMode, nextMode, (function(tempCaption) {\n            this.core.addCaption($fig, this.options.captionPlaceholder, tempCaption);\n        }).bind(this));\n    };\n\n    /**\n     * Event listeners\n     *\n     * @return {void}\n     */\n\n    Images.prototype.events = function () {\n        var that = this;\n        $(document)\n            .on('click', $.proxy(this, 'unselectImage'))\n            .on('keydown', $.proxy(this, 'removeImage'))\n            .on('click', '.medium-insert-images.medium-insert-active .remove', (function(event) {\n                event.preventDefault();\n                var $this = $(event.currentTarget);\n                var $fig = $this.closest('.medium-insert-images figure');\n                if ($fig.attr('data-mode') === ImageModes.Grid) {\n                    $this.closest('.grid').remove();\n                } else {\n                    $fig.remove();\n                }\n            }).bind(this))\n            // Toolbar buttons.\n            .on('click', '.medium-insert-images-toolbar .edit_full', (function(event) {\n                this.handleModeChange(ImageModes.Full);\n            }).bind(this))\n            .on('click', '.medium-insert-images-toolbar .edit_normal', (function(event) {\n                this.handleModeChange(ImageModes.Normal);\n            }).bind(this))\n            .on('click', '.medium-insert-images-toolbar .edit_with_quote', (function(event) {\n                this.handleModeChange(ImageModes.Quoted);\n            }).bind(this))\n            // For serialization\n            .on('change', '.medium-insert-images figure textarea', (function(event) {\n                var $target = $(event.target);\n                $target.text($target.val());\n            }).bind(this))\n\n            .on('focusin', '.medium-editor-insert-plugin .medium-insert-images', function(event){\n                var el = event.target;\n                if (event.target.className === 'textarea') {\n                    if (el.getAttribute('data-changed') === 'false') {\n                        el.textContent = '';\n                    }\n                    $('.description.more').attr('data-disable-toolbar', 'true');\n                }\n            })\n            .on('keydown', '.medium-editor-insert-plugin .medium-insert-images', function(event){\n                var el = event.target;\n                if (event.target.className === 'textarea') {\n                    if (el.getAttribute('data-changed') !== 'true') {\n                        el.setAttribute('data-changed', 'true');\n                    }\n                }\n            })\n            .on('focusout', '.medium-editor-insert-plugin .medium-insert-images', function(event){\n                var el = event.target;\n                if (el.className === 'textarea') {\n                    $('.description.more').attr('data-disable-toolbar', null);\n                    if (el.textContent.trim() === '') {\n                        el.textContent = quotedPlaceHolderMsg;\n                        el.setAttribute('data-changed', 'false');\n                    }\n                }\n            })\n            .on('load', '.popup.insert_caption .figure img', function() {\n                $.dialog('insert_caption').center();\n            })\n            .on('click', '.medium-insert-images .grid .btn-caption', function(e) {\n                var epochId = 'gridimage-' + String(+new Date);\n                var popup = $.dialog('insert_caption');\n                var $grid = $(this).closest('.grid');\n                $grid.attr('id', epochId);\n                var src = $grid.find('img').attr('data-src');\n                popup.$obj.find('.figure img').attr('src', src);\n                popup.$obj.data('workingImage', epochId);\n                var caption = $grid.find('figcaption').text();\n                popup.$obj.find('textarea').val(caption);\n                popup.$obj.data('original', caption);\n                if (caption) {\n                    popup.$obj.find('.btn-remove').show()\n                } else {\n                    popup.$obj.find('.btn-remove').hide()\n                }\n                popup.open();\n                return false;\n            })\n            .on('click', '.medium-insert-images .add_option_tools._grid a', function() {\n                var action = $(this).data('action');\n                var $wrapper = $(this).closest('.medium-insert-images');\n                if (action === 'add') {\n                    window.GalleryControl.uploadImages(function(nextImages) {\n                        if (nextImages === false) {\n                            alert('Failed to upload images, please try again'); return;\n                        }\n                        // TODO\n                        nextImages.forEach(function (img) {\n                            var $img = $(that.templates['src/js/templates/images-grid-each.hbs']({\n                                img: img.image_url,\n                                progress: false,\n                                caption: '',\n                            }));\n                            $wrapper.find('figure').append($img);\n                        });\n                    })\n                } else if (action === 'organize') {\n                    var serialziedImages = $wrapper.find('.grid')\n                        .map(function(i, e) {\n                            return { id: i, url: $(e).find('img').data('src'), caption: $(e).find('figcaption').text() }\n                        }).toArray();\n                    organizeImageService.open(serialziedImages, function(organizedImages) {\n                        $wrapper.find('div.grid').remove()\n                        organizedImages.forEach(function(img) {\n                            var $img = $(that.templates['src/js/templates/images-grid-each.hbs']({\n                                img: img.url,\n                                progress: false,\n                                caption: img.caption,\n                            }));\n                            $wrapper.find('figure').append($img);\n                        });\n                    });\n                } else if (action === 'delete') {\n                    $wrapper.remove();\n                }\n            })\n            .on('click', '.popup.insert_caption .btn-save', function() {\n                var popup = $.dialog('insert_caption');\n                var epochId = popup.$obj.data('workingImage');\n                var original = popup.$obj.data('original');\n                var next = popup.$obj.find('textarea').val();\n                var $wrapper = $('#' + epochId);\n                var $cap = $wrapper.find('figcaption');\n                if (next !== original) {\n                    if ($cap.length === 0) {\n                        $cap = $('<figcaption contenteditable=\"true\" class=\"text-placeholder\" data-placeholder=\"Type caption for image (optional)\" />');\n                        $wrapper.append($cap);\n                    }\n                    $cap.text(next);\n                }\n                if ($cap.text() !== '') {\n                    $wrapper.find('.btn-caption').text('Edit Caption');\n                } else {\n                    $wrapper.find('.btn-caption').text('Add Caption');\n                }\n                popup.close();\n                return false;\n            })\n            .on('click', '.popup.insert_caption .btn-remove', function() {\n                var popup = $.dialog('insert_caption');\n                var epochId = popup.$obj.data('workingImage');\n                var $wrapper = $('#' + epochId);\n                $wrapper.find('figcaption').text('')\n                $wrapper.find('.btn-caption').text('Add Caption');\n                popup.close();\n                return false;\n            });\n\n        this.$el\n            .on('click', '.medium-insert-images img', $.proxy(this, 'selectImage'));\n\n        $(window)\n            .on('resize', $.proxy(this, 'autoRepositionToolbars'));\n    };\n\n    /**\n     * Replace v0.* class names with new ones\n     *\n     * @return {void}\n     */\n\n    Images.prototype.backwardsCompatibility = function () {\n        this.$el.find('.mediumInsert')\n            .removeClass('mediumInsert')\n            .addClass('medium-insert-images');\n\n        this.$el.find('.medium-insert-images.small')\n            .removeClass('small')\n            .addClass('medium-insert-images-left');\n    };\n\n    /**\n     * Extend editor's serialize function\n     *\n     * @return {object} Serialized data\n     */\n\n    Images.prototype.editorSerialize = function () {\n        var data = this._serializePreImages();\n\n        $.each(data, function (key) {\n            var $data = $('<div />').html(data[key].value);\n\n            $data.find('.medium-insert-images').find('figcaption, figure').removeAttr('contenteditable');\n            $data.find('.medium-insert-images-progress').remove();\n\n            data[key].value = $data.html();\n        });\n\n        return data;\n    };\n\n    /**\n     * Add image\n     *\n     * @return {void}\n     */\n\n    Images.prototype.add = function (meta) {\n        var that = this,\n            $file = $(this.templates['src/js/templates/images-fileupload.hbs']()),\n            fileUploadOptions = {\n                dataType: 'json',\n                add: function (e, data) {\n                    $.proxy(that, 'uploadAdd', e, data)();\n                },\n                done: function (e, data) {\n                    $.proxy(that, 'uploadDone', e, data)();\n                }\n            };\n        if (meta) {\n            this.meta = meta;\n        }\n\n        // Only add progress callbacks for browsers that support XHR2,\n        // and test for XHR2 per:\n        // http://stackoverflow.com/questions/6767887/\n        // what-is-the-best-way-to-check-for-xhr2-file-upload-support\n        if (new XMLHttpRequest().upload) {\n            fileUploadOptions.progress = function (e, data) {\n                $.proxy(that, 'uploadProgress', e, data)();\n            };\n\n            fileUploadOptions.progressall = function (e, data) {\n                $.proxy(that, 'uploadProgressall', e, data)();\n            };\n        }\n\n        $file.fileupload($.extend(true, {}, this.options.fileUploadOptions, fileUploadOptions));\n\n        $file.click();\n    };\n\n    /**\n     * Callback invoked as soon as files are added to the fileupload widget - via file input selection, drag & drop or add API call.\n     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#add\n     *\n     * @param {Event} e\n     * @param {object} data\n     * @return {void}\n     */\n\n    Images.prototype.uploadAdd = function (e, data) {\n        var $place = this.$el.find('.medium-insert-active'),\n            that = this,\n            uploadErrors = [],\n            file = data.files[0],\n            acceptFileTypes = this.options.fileUploadOptions.acceptFileTypes,\n            maxFileSize = this.options.fileUploadOptions.maxFileSize,\n            reader;\n\n        if (acceptFileTypes && !acceptFileTypes.test(file.type)) {\n            uploadErrors.push(this.options.messages.acceptFileTypesError + file.name);\n        } else if (maxFileSize && file.size > maxFileSize) {\n            uploadErrors.push(this.options.messages.maxFileSizeError + file.name);\n        }\n        if (uploadErrors.length > 0) {\n            if (this.options.uploadFailed && typeof this.options.uploadFailed === \"function\") {\n                this.options.uploadFailed(uploadErrors, data);\n\n                return;\n            }\n\n            alert(uploadErrors.join(\"\\n\"));\n\n            return;\n        }\n\n        this.core.hideButtons();\n\n        // Replace paragraph with div, because figure elements can't be inside paragraph\n        if ($place.is('p')) {\n            this.core.migrateExistingContent($place);\n            $place.replaceWith('<div class=\"medium-insert-active\">' + $place.html() + '</div>');\n            $place = this.$el.find('.medium-insert-active');\n            if ($place.next().is('p')) {\n                this.core.moveCaret($place.next());\n            } else {\n                $place.after('<p><br></p>'); // add empty paragraph so we can move the caret to the next line.\n                this.core.moveCaret($place.next());\n            }\n        }\n\n        $place.addClass('medium-insert-images');\n\n        if (this.options.preview === false && $place.find('progress').length === 0 && (new XMLHttpRequest().upload)) {\n            $place.append(this.templates['src/js/templates/images-progressbar.hbs']());\n        }\n\n        if (data.autoUpload || (data.autoUpload !== false && $(e.target).fileupload('option', 'autoUpload'))) {\n            data.process().done(function () {\n                // If preview is set to true, let the showImage handle the upload start\n                if (that.options.preview) {\n                    reader = new FileReader();\n\n                    reader.onload = function (e) {\n                        $.proxy(that, 'showImage', e.target.result, data)();\n                    };\n\n                    reader.readAsDataURL(data.files[0]);\n                } else {\n                    data.submit();\n                }\n            });\n        }\n    };\n\n    /**\n     * Callback for global upload progress events\n     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#progressall\n     *\n     * @param {Event} e\n     * @param {object} data\n     * @return {void}\n     */\n\n    Images.prototype.uploadProgressall = function (e, data) {\n        var progress, $progressbar;\n\n        if (this.options.preview === false) {\n            progress = parseInt(data.loaded / data.total * 100, 10);\n            $progressbar = this.$el.find('.medium-insert-active').find('progress');\n\n            $progressbar\n                .attr('value', progress)\n                .text(progress);\n\n            if (progress === 100) {\n                $progressbar.remove();\n            }\n        }\n    };\n\n    /**\n     * Callback for upload progress events.\n     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#progress\n     *\n     * @param {Event} e\n     * @param {object} data\n     * @return {void}\n     */\n\n    Images.prototype.uploadProgress = function (e, data) {\n        var progress, $progressbar;\n\n        if (this.options.preview) {\n            progress = 100 - parseInt(data.loaded / data.total * 100, 10);\n            $progressbar = data.context.find('.medium-insert-images-progress');\n\n            $progressbar.css('width', progress + '%');\n\n            if (progress === 0) {\n                $progressbar.remove();\n            }\n        }\n    };\n\n    /**\n     * Callback for successful upload requests.\n     * https://github.com/blueimp/jQuery-File-Upload/wiki/Options#done\n     *\n     * @param {Event} e\n     * @param {object} data\n     * @return {void}\n     */\n\n    Images.prototype.uploadDone = function (e, data) {\n        $.proxy(this, 'showImage', data.result.image_url, data, { uiid: data.result.id })(); // #ARTICLE_MOD\n\n        this.core.clean();\n        this.sorting();\n    };\n\n    /**\n     * Add uploaded / preview image to DOM\n     *\n     * @param {string} img\n     * @returns {void}\n     */\n\n    Images.prototype.showImage = function (img, data, additionals) { // #ARTICLE_MOD\n        window.__SECRET__ = window.__SECRET__ || {}; // #ARTICLE_MOD\n        window.__SECRET__.data = data; // #ARTICLE_MOD // TODO: fix data sharing somehow\n        var $place = this.$el.find('.medium-insert-active'),\n            domImage,\n            that;\n\n        // Hide editor's placeholder\n        $place.click();\n\n        // If preview is allowed and preview image already exists,\n        // replace it with uploaded image\n        that = this;\n        var isGrid = (this.options.autoGrid && $place.find('figure').length >= this.options.autoGrid) || this.meta && this.meta.type === 'grid';\n\n        if (this.options.preview && data.context) {\n            domImage = this.getDOMImage();\n            $(domImage).one('load', (function () {\n                var attr;\n                if (isGrid) {\n                    attr = 'data-src'\n                } else {\n                    attr = 'src'\n                }\n                data.context.find('img').attr(attr, img);\n\n                if (this.options.uploadCompleted) {\n                    this.options.uploadCompleted(data.context, data);\n                }\n\n                that.core.triggerInput();\n            }).bind(this));\n            if (isGrid) {\n                domImage.src = window.blankUrl;\n                $(domImage).css('background-image', 'url(' + img + ')');\n                if (img.indexOf('data:') === -1) {\n                    $(domImage).attr('data-src', img);\n                }\n                $(domImage).load();\n            } else {\n                domImage.src = img;\n            }\n        } else {\n            var expanded;\n            if (isGrid) {\n                expanded = $(this.templates['src/js/templates/images-grid-each.hbs']({\n                    img: img,\n                    progress: this.options.preview,\n                    caption: '',\n                }));\n                if ($place.find('figure').length === 0) {\n                    $place.append('<figure />')\n                }\n                data.context = expanded.appendTo($place.find('figure'));\n                $place.find('figure').attr('data-mode', ImageModes.Grid);\n            } else {\n                expanded = $(this.templates['src/js/templates/images-image.hbs']({\n                    img: img,\n                    progress: this.options.preview\n                }));\n                data.context = expanded.appendTo($place);\n                data.context.attr('data-mode', ImageModes.Normal);\n            }\n\n            var $img = data.context.find('img');\n            if (additionals && additionals.uiid) {\n                $img.attr('data-uiid', additionals.uiid); // #ARTICLE_MOD - Add ui.id for future use\n            }\n\n            $place.find('br').remove();\n\n            if (isGrid) {\n                $.each(this.options.styles, function (style, options) {\n                    var className = 'medium-insert-images-' + style;\n\n                    $place.removeClass(className);\n\n                    if (options.removed) {\n                        options.removed($place);\n                    }\n                });\n\n                if (!window.isWhitelabelV2) {\n                    $place.addClass('medium-insert-images-grid');\n                }\n\n                if (this.options.styles.grid.added) {\n                    this.options.styles.grid.added($place);\n                }\n                if ($place.find('.add_option_tools').length === 0) {\n                    var popup = this.templates['src/js/templates/images-grid-popup.hbs'];\n                    $place.find('figure').prepend(popup);\n                }\n            }\n\n            if (this.options.preview) {\n                data.submit();\n            } else if (this.options.uploadCompleted) {\n                this.options.uploadCompleted(data.context, data);\n            }\n        }\n\n        this.core.triggerInput();\n\n        return data.context;\n    };\n\n    Images.prototype.getDOMImage = function () {\n        return new window.Image();\n    };\n\n    /**\n     * Select clicked image\n     *\n     * @param {Event} e\n     * @returns {void}\n     */\n\n    Images.prototype.selectImage = function (e) {\n        var that = this,\n            $image;\n        \n        if (this.core.options.enabled) {\n            $image = $(e.target);\n            var isGrid = $image.closest('.grid').length > 0;\n            this.$currentImage = $image;\n\n            // Hide keyboard on mobile devices\n            this.$el.blur();\n\n            $image.addClass('medium-insert-image-active');\n            $image.closest('.medium-insert-images').addClass('medium-insert-active');\n\n            if (!isGrid) {\n                $(`<a href=\"#\" class=\"remove\">Remove</a>`).insertAfter($image)\n            }   \n\n            setTimeout(function () {\n                if (isGrid) {\n                    if (that.options.captions) {\n                        var $gridEach = $image.closest('div.grid');\n                        // if ($gridEach.find('figcaption').length === 0) {\n                        //     $gridEach.append('<figcaption contenteditable=\"true\" class=\"medium-insert-caption-placeholder text-placeholder\" data-placeholder=\"Type caption for image (optional)\" />')\n                        // }\n                    }\n                } else {\n                    that.addToolbar();\n\n                    if (that.options.captions && getImageMode(that.$currentImage) !== ImageModes.Quoted) {\n                        that.core.addCaption($image.closest('figure'), that.options.captionPlaceholder);\n                    }\n                }\n            }, 50);\n        }\n    };\n\n    /**\n     * Unselect selected image\n     *\n     * @param {Event} e\n     * @returns {void}\n     */\n\n    Images.prototype.unselectImage = function (e) {\n        if (this.$currentImage == null) {\n            return;\n        }\n        var $el;\n        if (e) {\n            $el = $(e.target);\n        } else {\n            $el = this.$currentImage.parent();\n        }\n\n        var $image = this.$el.find('.medium-insert-image-active');\n\n        if ($el.is(this.$currentImage)) {\n            return;\n        }\n\n        if ($el.is('img') && $el.hasClass('medium-insert-image-active')) {\n            $image.not($el).removeClass('medium-insert-image-active');\n            $('.medium-insert-images-toolbar, .medium-insert-images-toolbar2').remove();\n            this.core.removeCaptions($el);\n            return;\n        }\n\n        $image.removeClass('medium-insert-image-active');\n        $image.parent().find('.remove').remove();\n        $('.medium-insert-images-toolbar, .medium-insert-images-toolbar2').remove();\n\n        if ($el.is('.medium-insert-caption-placeholder')) {\n            this.core.removeCaptionPlaceholder($image.closest('figure'));\n        } else if ($el.is('figcaption') === false) {\n            if (this.$el.closest('figure').find('figcaption').text().trim()) {\n                this.core.removeCaptions();\n            }\n        }\n        this.$currentImage = null;\n    };\n\n    /**\n     * Remove image\n     *\n     * @param {Event} e\n     * @returns {void}\n     */\n\n    Images.prototype.removeImage = function (e) {\n        var images = [],\n            $selectedImage = this.$el.find('.medium-insert-image-active'),\n            $parent, $empty, selection, range, current, caretPosition, $current, $sibling, selectedHtml, i;\n\n        if (e.which === 8 || e.which === 46) {\n            if ($selectedImage.length) {\n                images.push($selectedImage);\n            }\n\n            // Remove image even if it's not selected, but backspace/del is pressed in text\n            selection = window.getSelection();\n            if (selection && selection.rangeCount) {\n                range = selection.getRangeAt(0);\n                current = range.commonAncestorContainer;\n                $current = current.nodeName === '#text' ? $(current).parent() : $(current);\n                caretPosition = MediumEditor.selection.getCaretOffsets(current).left;\n\n                // Is backspace pressed and caret is at the beginning of a paragraph, get previous element\n                if (e.which === 8 && caretPosition === 0) {\n                    $sibling = $current.prev();\n                // Is del pressed and caret is at the end of a paragraph, get next element\n                } else if (e.which === 46 && caretPosition === $current.text().length) {\n                    $sibling = $current.next();\n                }\n\n                if ($sibling && $sibling.hasClass('medium-insert-images')) {\n                    images.push($sibling.find('img'));\n                }\n\n                // If text is selected, find images in the selection\n                selectedHtml = MediumEditor.selection.getSelectionHtml(document);\n                if (selectedHtml) {\n                    $('<div></div>').html(selectedHtml).find('.medium-insert-images img').each(function () {\n                        images.push($(this));\n                    });\n                }\n            }\n\n            if (images.length) {\n                for (i = 0; i < images.length; i++) {\n                    //this.deleteFile(images[i].attr('src')); // #ARTICLE_MOD\n\n                    $parent = images[i].closest('.medium-insert-images');\n                    images[i].closest('figure').remove();\n\n                    if ($parent.find('figure').length === 0) {\n                        $empty = $parent.next();\n                        if ($empty.is('p') === false || $empty.text() !== '') {\n                            $empty = $(this.templates['src/js/templates/core-empty-line.hbs']().trim());\n                            $parent.before($empty);\n                        }\n                        $parent.remove();\n                    }\n                }\n\n                // Hide addons\n                this.core.hideAddons();\n                if (!selectedHtml && $empty) {\n                    e.preventDefault();\n                    this.core.moveCaret($empty);\n                }\n\n                $('.medium-insert-images-toolbar, .medium-insert-images-toolbar2').remove();\n                this.core.triggerInput();\n            }\n        }\n    };\n\n    /**\n     * Makes ajax call to deleteScript\n     *\n     * @param {String} file File name\n     * @returns {void}\n     */\n\n    Images.prototype.deleteFile = function (file) {\n        if (this.options.deleteScript) {\n            $.ajax($.extend(true, {}, {\n                url: this.options.deleteScript,\n                type: this.options.deleteMethod || 'POST',\n                data: { file: file }\n            }, this.options.fileDeleteOptions));\n        }\n    };\n\n    /**\n     * Adds image toolbar to editor\n     *\n     * @returns {void}\n     */\n\n    Images.prototype.addToolbar = function () {\n        var $image = this.$el.find('.medium-insert-image-active'),\n            $p = $image.closest('.medium-insert-images'),\n            active = false,\n            mediumEditor = this.core.getEditor(),\n            toolbarContainer = mediumEditor.options.elementsContainer || 'body',\n            $toolbar,\n            $toolbar2;\n\n        var $fig = $image.closest('figure');\n\n        var templateName = window.isWhitelabelV2 ? 'src/js/templates/images-toolbar-gear.hbs' :  'src/js/templates/images-toolbar.hbs';\n        var $tpl = this.templates[templateName]({\n            styles: this.options.styles,\n            actions: this.options.actions,\n        }).trim();\n\n        $(toolbarContainer).append(\n            $($tpl)\n                .find('.' + ImageModesEditClasses[getImageMode($fig)]).addClass('selected')\n                .end()\n        );\n\n        $toolbar = $('.medium-insert-images-toolbar');\n        $toolbar2 = $('.medium-insert-images-toolbar2');\n\n        $toolbar.find('button').each(function () {\n            if ($p.hasClass('medium-insert-images-' + $(this).data('action'))) {\n                $(this).addClass('medium-editor-button-active');\n                active = true;\n            }\n        });\n\n        if (active === false) {\n            $toolbar.find('button').first().addClass('medium-editor-button-active');\n        }\n\n        this.repositionToolbars();\n        this.core.getEditor().getExtensionByName('toolbar').hideToolbar();\n\n        $toolbar.fadeIn();\n        $toolbar2.fadeIn();\n    };\n\n    Images.prototype.autoRepositionToolbars = function () {\n        setTimeout(function () {\n            this.repositionToolbars();\n        }.bind(this), 0);\n    };\n\n    Images.prototype.repositionToolbars = function () {\n        var $toolbar = $('.medium-insert-images-toolbar'),\n            $toolbar2 = $('.medium-insert-images-toolbar2'),\n            $image = this.$el.find('.medium-insert-image-active'),\n            elementsContainer = this.core.getEditor().options.elementsContainer,\n            elementsContainerAbsolute = ['absolute', 'fixed'].indexOf(window.getComputedStyle(elementsContainer).getPropertyValue('position')) > -1,\n            elementsContainerBoundary = elementsContainerAbsolute ? elementsContainer.getBoundingClientRect() : null,\n            containerWidth = $(window).width(),\n            position = {};\n\n        if ($toolbar2.length) {\n            position.top = $image.offset().top + 2;\n            position.left = $image.offset().left + $image.width() - $toolbar2.width() - 4; // 4px - distance from a border\n\n            if (elementsContainerAbsolute) {\n                position.top += elementsContainer.scrollTop - elementsContainerBoundary.top;\n                position.left -= elementsContainerBoundary.left;\n                containerWidth = $(elementsContainer).width();\n            }\n\n            if (position.left + $toolbar2.width() > containerWidth) {\n                position.left = containerWidth - $toolbar2.width();\n            }\n\n            $toolbar2.css(position);\n        }\n\n        if ($toolbar.length) {\n            if ($image.closest('.medium-insert-images-grid-active').length) {\n                $image = $image.closest('.medium-insert-images-grid-active');\n            }\n\n            position.top = $image.offset().top - $toolbar.height() - 8 - 2 - 5; // 8px - hight of an arrow under toolbar, 2px - height of an image outset, 5px - distance from an image\n            position.left = $image.offset().left + $image.width() / 2 - $toolbar.width() / 2;\n\n            if (elementsContainerAbsolute) {\n                position.top += elementsContainer.scrollTop - elementsContainerBoundary.top;\n                position.left -= elementsContainerBoundary.left;\n            }\n\n            if (position.top < 0) {\n                position.top = 0;\n            }\n\n            $toolbar.css(position);\n        }\n    };\n\n    /**\n     * Fires toolbar action\n     *\n     * @param {Event} e\n     * @returns {void}\n     */\n\n    Images.prototype.toolbarAction = function (e) {\n        var that = this,\n            $button, $li, $ul, $lis, $p;\n\n        if (this.$currentImage === null) {\n            return;\n        }\n\n        $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button');\n        $li = $button.closest('li');\n        $ul = $li.closest('ul');\n        $lis = $ul.find('li');\n        $p = this.$el.find('.medium-insert-active');\n\n        $button.addClass('medium-editor-button-active');\n        $li.siblings().find('.medium-editor-button-active').removeClass('medium-editor-button-active');\n\n        $lis.find('button').each(function () {\n            var className = 'medium-insert-images-' + $(this).data('action');\n\n            if ($(this).hasClass('medium-editor-button-active')) {\n                $p.addClass(className);\n\n                if (that.options.styles[$(this).data('action')].added) {\n                    that.options.styles[$(this).data('action')].added($p);\n                }\n            } else {\n                $p.removeClass(className);\n\n                if (that.options.styles[$(this).data('action')].removed) {\n                    that.options.styles[$(this).data('action')].removed($p);\n                }\n            }\n        });\n\n        this.core.hideButtons();\n\n        this.core.triggerInput();\n    };\n\n    /**\n     * Fires toolbar2 action\n     *\n     * @param {Event} e\n     * @returns {void}\n     */\n\n    Images.prototype.toolbar2Action = function (e) {\n        var $button, callback;\n\n        if (this.$currentImage === null) {\n            return;\n        }\n\n        $button = $(e.target).is('button') ? $(e.target) : $(e.target).closest('button');\n        callback = this.options.actions[$button.data('action')].clicked;\n\n        if (callback) {\n            callback(this.$el.find('.medium-insert-image-active'));\n        }\n\n        this.core.hideButtons();\n\n        this.core.triggerInput();\n    };\n\n    /**\n     * Initialize sorting\n     *\n     * @returns {void}\n     */\n\n    Images.prototype.sorting = function () {\n        $.proxy(this.options.sorting, this)();\n    };\n\n    /** Plugin initialization */\n\n    $.fn[pluginName + addonName] = function (options) {\n        return this.each(function () {\n            if (!$.data(this, 'plugin_' + pluginName + addonName)) {\n                $.data(this, 'plugin_' + pluginName + addonName, new Images(this, options));\n            }\n        });\n    };\n\n})(jQuery, window, document, MediumEditor.util);\n\n}));\n"],"sourceRoot":""}
{"version":3,"sources":["webpack://fancy/./_static/modules/ui/overlay-thing/Shared.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/action-constants.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/action-helpers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/action/actions.js","webpack://fancy/./_static/modules/ui/overlay-thing/appstate.ts","webpack://fancy/./_static/modules/ui/overlay-thing/cache.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/Perf.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/map.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/FancyContext.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AdminPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/SimpleSharePopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AddlistPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/ActionButtons.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/zoom.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItemForm.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Info.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Detail.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/ThingCard.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/MerchantInfo.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Recommendation.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Reviews.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/config.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/entry-events.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/history.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/routeutils.js","webpack://fancy/./_static/modules/ui/overlay-thing/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/store/initial-store.ts","webpack://fancy/./_static/modules/ui/overlay-thing/ThingTypes.js","webpack://fancy/./_static/modules/ui/overlay-thing/reducers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/store/store.ts"],"names":["getFancyDepsRoot","Shared","getStore","store","cache","pagingContext","transition","reloadCurrentThing","keys","slice","call","arguments","reduce","prev","next","constantGen","shouldOpenThing","state","appContext","visible","shouldFetchThing","thingID","thing","ID","isFetching","closeOverlay","dispatch","isStaticPage","closeModal","historyData","history","stripPathname","document","title","closeThing","$","off","window","trigger","onDataFetched","type","thingData","fromServer","sales_available","isEmpty","sales","show_anywhere_only","status","salesStatus","loadThing","onLoadThing","fetchedThingsIds","fetchThing","ThingCache","killCache","override","queryString","getState","openThing","shouldFetch","cac","isCrawled","thingPageData","options","requestThing","owner","external_apps","viewer","getLocationArgPairs","admin","successFn","need_more_fetch","image_resized_max","src","Image","image","failFn","failureXHR","requestThingFail","alertify","alert","requestPromise","then","__Config","design_v4","get","fail","console","warn","getCordialProperties","prop","id","productID","seller","username","url","name","emojified_name","category","cordial_category","instock","available","soldout","images","image_url","price","parseFloat","min_price","recommended","length","map","item","i","MPArgs","currentLocationArgPair","utm","MP","LogExposed","addLog","crdl","e","trackingItem","brand","brand_name","dataLayer","push","product_id","event","products","undefined","products_info","revenue","option_id","TrackingEvents","viewItem","ga","hitType","page","location","href","toggleFollow","seller_id","user_id","followType","data","followContext","loading","following","toggleFollowAction","ajax","dataType","done","xml","$status","find","text","completeFollow","cancelFollow","toggleFancy","fancyContext","fancyd","fancyd_count","toggleFancyAction","json","fc","completeFancy","cancelFancy","updateSaleContext","newContext","saleContext","slideContext","saleOptionID","isSalesOptionsAvailable","basis","_","option","calculatePrice","C","firstOptionImageIdx","getCurrentSaleOption","saleImages","getSaleImages","some","img","idx","thumbnailIndex","setThumbnailIndex","_convertCurrency","nextCode","nextPrice","force","currencyCode","currencyMoney","currencySymbol","callback","numberType","replace","isString","amount","currency_code","success","currency","code","formatPrice","symbol","requestCurrencyConversion","toFixed","convertCurrency","pendingID","updateAppContext","contextObject","context","loggedIn","updateState","k","v","ignoreCralwed","existence","THINGS","SALES","getCrawled","count","selector","value","t","index","__THING_CACHE","Keys","Sidebar","Wrap","Body","Title","Price","Form","Desc","Owner","gettext","mapStateToThingProps","getSales","getDescription","description","hotel_search","details","propertyDescription","getSaleItemId","is_admin_any","inactive_sales","getSeller","getDetailType","has_launch_app","getFirstSaleOption","ignoreEmptySaleOption","opts","filter","discount_percentage","quantity","retail_price","newPrice","regex","test","getDomesticDeliveryDate","date","expected_delivery_day_1","expected_delivery_day_2","getIntlDeliveryDate","expected_delivery_day_intl_1","expected_delivery_day_intl_2","currencyIsUSD","tid","optionId","hotelImages","salesImages","thingImages","saleOptionWaitingRegistry","setWaiting","chosenSaleOptionID","setResult","getWaiting","waiting","chosenSaleOption","fillArray","original","filler","ol","fl","sparseIdxs","j","thumbnailsLimit","thumbnail_src","thumbnailUrl","width","height","unshift","video","thumbType","thumbnail_url","position","isNumber","isVanityQueriable","props","suppress","AC","minPrice","maxPrice","keyword","trim","original_labels","isNaN","parseInt","labels","ok","getSafeNameProp","dangerouslySetInnerHTML","__html","children","isVideoUploadable","metadata","getThingName","salesAvailable","FancyContext","React","useFancy","className","AdminPopup","show_on_homepage","date_published","exclude_from_popular","show_in_search","optionSaving","ownerSaving","mergeSaving","payload","thing_id","inputDate","Date","toISOString","split","setState","post","status_code","Object","assign","message","changeOwnerEl","new_owner","toLowerCase","thing_owner","confirm","new_owner_name","new_thing_id","ntid","old_user_id","xmlUtil","reload","always","that","this","dialog","popupName","$obj","on","prevProps","prevState","center","target","checked","onChange","placeholder","style","Display","classnames","onClick","handleSaveOptions","ref","el","handleChangeOwner","SimpleSharePopup","preventDefault","closePopup","log","shareUrl","copyToClipboard","urlCopied","setTimeout","connector","indexOf","handleCopyLink","encodeURIComponent","AddlistPopup","lists","listSearchQuery","listCreationQuery","listCreating","drawUserList","listSearchInput","focus","which","KEYS","objectId","updateList","createList","updated","stopPropagation","targ","currentTarget","selectedListId","Number","getAttribute","theList","list","prevAdded","added","eventName","update","handleDialogOpen","getListCheckbox","res","element","handleListSearch","term","key","data-listid","handleListItemToggle","quickCreateList","onKeyUp","handleListCreation","handleCreateListQueryChange","Component","resp","error","err","unchecked","join","Favorite","useDispatch","require_login","ActionButtons","renderPopup","zoomScale","getBoundarySize","$el","eq","DEBUG","getZoomBoxSize","bs","Math","min","getZoomMargin","zidCac","getZoomImageDimension","zoomMargin","ret","getNextZoomImageStyle","pageX","pageY","$wrapper","boundaryWidth","boundaryHeight","meta","marginHoriz","marginVert","$fig","getImageMeta","offset","left","top","topPosition","showZoomImage","zoomBoxSize","zd","zoomImageContainerX","minmax","zoomImageContainerY","backgroundLeft","backgroundTop","bgPosX","bgPosY","transform","backgroundPosition","display","RESIZED_SIZE","isZoomable","imageSize","size","max","smallerSize","proportion","larger","calculateImageSize","boundarySize","getZoomImageStyle","isZoomActive","currentZoomImageStyle","backgroundSize","isTouchDevice","navigator","maxTouchPoints","msMaxTouchPoints","SwiperAddons","Thumbs","Zoom","SwiperCore","ImageSlide","memo","setSlideLocked","isActive","useState","setZoomActive","zoomImageStyle","setZoomImageStyle","zoomImageCacheKey","setZoomImageCacheKey","zoomImageLoaded","setZoomImageLoaded","isVideo","h264_1000k_url","isMagnifyingGlassZoomable","zoomable","setZoomable","useEffect","large_image_url","Promise","r","onload","onerror","zoom","startZoom","zoomShow","onMouseMove","newZoomable","nextZoomImageStyle","Video","object","playing","lastFullyRenderedObjectID","allow","fullScreen","data-src","onLoad","alt","cursor","backgroundImage","nextProps","displayName","fancyProps","swiperRef","useRef","swipeThumbsRef","thumbIndex","setThumbIndex","slideLocked","swiper","setSwiper","lastThumbIndex","activeIndex","slideTo","current","thumbSwiper","slides","classList","contains","onSlideChange","preloadImages","lazy","loadPrevNext","loadPrevNextAmount","maxRatio","allowSlidePrev","allowSlideNext","onZoomChange","scale","onSwiper","opacity","clickedIndex","direction","spaceBetween","slidesPerView","watchSlidesVisibility","selected","handlePurchase","saleOption","sale_id","selectedQuantity","personalization","Fancy","CartAPI","addItem","Cart","openPopup","SaleOptions","currentValue","expander","defaultValue","printer","disabled","onFocus","unselectedLabel","CartButton","label","SelectBox","labelValue","tabIndex","SizeGuide","s","MultiOptionState","option_meta","orderMap","forEach","m","targetIndex","values","filteredOptions","order","sel","uniq","o","getPossibleValuesForIndex","MultiOption","multiOptionState","sid","multiOptions","getMultiOptions","sizeGuidePos","indexTypeOf","additional","selectedArray","selectedValue","showSizeGuide","MultiSelectBox","swatch","MultiSwatch","thumbnail","MultiThumbnail","MultiButton","onMultiSelectBoxChange","MultiSelectBoxOption","data-value","data-index-typeof","onClickSwatch","MultiSwatchOption","backgroundColor","data-label","onClickThumbnail","MultiThumbnailOption","onClickMutliButton","MultiButtonOption","optionValueFunction","opt","saleNamePrinter","SaleItemSidebarHead","CurrencyPopup","currentCurrency","renderCurrencyPopup","approxText","appState","params","sale_item_id","remove","FancyApplePay","os","total","displayItems","checkAvailability","testmode","applePayDisplay","applePayTest","getInitialMultiOptionState","updateSaleOptionIDFromMultiOptionState","presetOptionId","String","selectedOptionArray","selectedOption","every","extractSaleOptionIDFromMultiOptionState","amendedID","amendSaleOptionFromMultiOptionState","nextSelected","button","dropdown","indexOfType","tagName","attr","extend","bind","onClickMultiOptionGen","initializeMultiOption","checkApplePay","nextSaleOptionID","_o","mos","$so","escapeSelector","is","click","paymentRequest","nonSoldout","selectedNonSoldoutOption","nextValue","nsc","priceChanges","currencyChanges","cartButtonStyle","discountPercentage","retailPrice","optionIsMulti","isOptionMulti","salesOptionsAvailable","discounting","currencyCodeStyle","quantitySelectRange","range","showSelectbox","applePayButton","ApplePayButton","sale","floatFormatMinusTwo","numberFormat","getApproxText","handleCurrencyPopup","SaleItemOptionsExpander","handleOptionChange","size_guide_id","SizeGuidePopup","personalizable","handlePersonalizationChange","handleQuantityChange","subscribed","handleNotifyLater","sio","clicked","country","requestPurchase","trace","WebkitAppearance","ApplePayButtonType","ApplePayButtonStyle","handleApplePayCheckout","reviews","summary","shop_url","total_ratings","total_reviews","headerSize","css","scrollTop","offsetTop","rating_avg","Overview","bv","brand_values","shippingInfo","shipping_info","origin","cost","Description","menu","setMenu","showMore","setShowMore","descEl","showFeatures","features","showSpecs","specifications","showReturns","return_exchange_policy_title","shipping_policy","clientHeight","cx","collapsed","show","data-featuretype","ThingCard","html_url","max_price","p","sale_items","tag","Likeable","slidesPerColumn","RecentlyViewed","things","setThings","response","recently","thumb_image_url_558","convertThingsV1","useDefaultReviews","per_page","q","sort","setLoading","skip","setReviews","param","useReviews","ReviewHead","attributes","a","rating","ReviewEntry","review","photoIndex","setPhotoIndex","mainSrc","nextSrc","prevSrc","onCloseRequest","onMovePrevRequest","onMoveNextRequest","ReviewList","reviewOption","setReviewOption","currentPage","debounceEventUntilTimeout","total_pages","pageNum","review_count","applying","AdminMessages","messages","BreadCrumb","breadcrumbs","AdminSidebar","AppV2","pt","ct","minimumOption","nonSoldoutOptions","getFancyContext","connect","ReduxComponentEnhancer","EXPIRED","REMOVED","PENDING","COMING_SOON","ACTIVE","SOLD_OUT","FancyStatus","Addition","Removal","AfterAddition","AfterRemoval","Idle","Selectors","HomepageWrapper","ThingViewConfig","StaticThingViewConfig","ThumbnailsLimit","Basic","More","handleOverlayThingKeyEvents","conditionalTransition","aElement","isStream","has","LinkTypes","oneshotEventAttached","attachEntryEvents","body","__INIT_THING_ANCHOR","isPlainLeftClick","getObjectTypeFromUrl","getPathname","$targ","didClickOn","eitherFancy","sharedState","draggingAdmin","OtContainer","isStaticCache","isStatic","getDynamic","getStatic","scrollToTop","parentElement","scrollEvent","handleScroll","attach","func","prepare","detach","_prepare","throttle","viewportHeight","documentElement","scrollHeight","addEventListener","passive","removeEventListener","initialThingPageID","extractMetaFromURL","pathname","initialPageIsThingPage","initialPath","preservedHref","initialTitle","locationIsThingPage","overlayIsOn","runOverlay","thingURLType","hasClass","requestIdleCallback","addClass","historyHook","search","Dynamic","Static","Timeline","Internal","redirect","removeClass","init","movePrev","moveNext","destination","bugsnag","Bugsnag","apiKey","plugins","BugsnagPluginReact","user","__FancyUser","App","new","heart_icon","ready","require","overlayContainer","querySelector","selectOrCreate","Overlay","ErrorBoundary","createErrorBoundary","tree","path","Suspense","fallback","component","render","getInitialStoreState","contextName","userCountry","followStore","followUser","contexts","ThingTypeMeta","thingContext","PlainThingType","args","objectArgs","mergeObjectArgs","fancyd_friends","META","getThingType","SaleItemType","createEmptyObject","review_rating","size_chart_ids","GiftcardType","HotelType","hotel","VanityType","LaunchAppType","ThingTypes","AttachingType","ComparingType","loaded","lastFullyRenderedThingID","populateThingContext","URLMeta","combineReducers","action","updateShallow","cookie","current_country_code","Boolean","seller_follow","nextFancydState","saleOptionInclSales","nextContext","middlewares","thunk","configureStore","reducer","rootReducer","preloadedState","contextKey","middleware","getDefaultMiddleware","serializableCheck","prepend"],"mappings":"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","file":"OverlayThing.main.ce7b9554f89b68048ced.js","sourcesContent":["import { getFancyDepsRoot } from 'fancyutils';\n\nimport store from './store/store';\nimport { cache } from './cache';\nimport { pagingContext, transition } from './container/routeutils';\nimport { reloadCurrentThing } from './container/history';\n\n\ngetFancyDepsRoot().Shared = {\n    getStore: () => store.getState(),\n    cache,\n    pagingContext,\n    transition,\n    reloadCurrentThing,\n};\n","// Generate `key: String(key)` structure by given string key arguments\nfunction constantGen() {\n    var keys = [].slice.call(arguments);\n    return keys.reduce((prev, next) => {\n        prev[next] = next;\n        return prev;\n    }, {});\n}\n\nvar C = constantGen(\n  'UPDATE_APP_CONTEXT',\n  // Loading\n  'REQUEST_THING',\n  'REQUEST_THING_FAILURE',\n  'LOAD_THING',\n\n  // UI Actions\n  'OPEN_THING',\n  'CLOSE_THING',\n\n  // Comment form suggestion\n  'SET_USERNAME_KEYWORD',\n  'LOAD_SUGGESTION',\n\n  // Thumbnail\n  'SET_THUMBNAIL_INDEX',\n\n  // Follow\n  'TOGGLE_FOLLOW',\n  'CANCEL_FOLLOW',\n  'COMPLETE_FOLLOW',\n\n  // Fancy\n  'TOGGLE_FANCY',\n  'CANCEL_FANCY',\n  'COMPLETE_FANCY',\n\n  // Saleitem\n  'UPDATE_SALE_CONTEXT'\n);\n\nexport default C;\n","import { MP, getLocationArgPairs, isEmpty, isStaticPage, stripPathname } from \"fancyutils\";\nimport { Dispatch, State } from \"redux\";\nimport { ThunkAction } from \"redux-thunk\";\n\nimport { history } from \"common-components\";\nimport { historyData } from \"../container/history\";\nimport store from \"../store/store\";\nimport { closeModal } from \"../container/routeutils\";\nimport {\n    closeThing,\n    openThing,\n    loadThing,\n    requestThing,\n    requestThingFail,\n    toggleFollow as toggleFollowAction,\n    cancelFollow,\n    completeFollow,\n    toggleFancy as toggleFancyAction,\n    cancelFancy,\n    completeFancy,\n    setThumbnailIndex,\n} from \"./actions\";\nimport C from \"./action-constants\";\nimport { formatPrice, isSalesOptionsAvailable, getCurrentSaleOption, getSaleImages } from \"../components/map\";\nimport { ThingCache, cache } from \"../cache\";\nimport { salesStatus } from \"../config\";\nimport { ThingObject, SaleContext } from \"ftypes\";\n\nfunction shouldOpenThing(state) {\n    return state.appContext.visible !== true;\n}\n\n// Blocks illegal requests\nfunction shouldFetchThing(state, thingID) {\n    if (state.thing.ID === thingID || state.thing.isFetching) {\n        return false;\n    } else {\n        return true;\n    }\n}\n\nexport function closeOverlay() {\n    return (dispatch: Dispatch) => {\n        if (isStaticPage()) {\n            return;\n        }\n        closeModal();\n        historyData.overlayIsOn = false;\n        history.push(stripPathname(historyData.preservedHref), null);\n        document.title = historyData.initialTitle;\n\n        dispatch(closeThing());\n        $(document).off(\"keydown.overlayThing\");\n        $(window).trigger(\"scroll\");\n    };\n}\n\nfunction onDataFetched(dispatch: Dispatch, thingID, thing, type) {\n    addAdditionalThingContext(thing);\n    cache.add(thingID, thing, type);\n    dispatch(loadThing(thingID, thing));\n    onLoadThing(thing);\n}\n\nconst fetchedThingsIds = {};\n\nexport function fetchThing(\n    thingID: string,\n    type = ThingCache.THINGS,\n    killCache = false,\n    override = false,\n    queryString = \"\"\n) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        if (thingID == null) {\n            console.warn(\"fetchThing(): thingID was null.\");\n            return;\n        }\n        var state = getState();\n        if (shouldOpenThing(state)) {\n            dispatch(openThing());\n        }\n        if (killCache) {\n            cache.remove(thingID, type);\n            delete state.thing;\n        }\n\n        const shouldFetch = override || shouldFetchThing(state, thingID);\n        if (killCache || shouldFetch) {\n            if (cache.exists(thingID, type)) {\n                const cac = cache.get(thingID, type);\n                dispatch(loadThing(thingID, cac));\n                onLoadThing(cac);\n                // if cache is crawled one, request should continue\n                if (!cac.isCrawled) {\n                    return;\n                }\n            }\n\n            // static ot page prefetch\n            if (window.thingPageData) {\n                const thingPageData = window.thingPageData;\n                onDataFetched(dispatch, thingID, thingPageData, type);\n                delete window.thingPageData;\n                return;\n            }\n\n            dispatch(requestThing(thingID));\n            let options;\n\n            options = { owner: true, external_apps: true, viewer: true };\n            if (getLocationArgPairs(\"admin\")) {\n                options.admin = true;\n            }\n            if (type === ThingCache.SALES) {\n                options.sales = true; // /sales/(+d) URL\n            }\n            const successFn = (thing) => {\n                if (thing.need_more_fetch) {\n                    // Load main image as fast as possible.\n                    if (thing.image_resized_max && thing.image_resized_max.src) {\n                        let img = new Image();\n                        img.src = thing.image.src;\n                    }\n                    fetchedThingsIds[thingID] = 1;\n                    dispatch(loadThing(thingID, thing));\n                    onLoadThing(thing);\n                } else {\n                    fetchedThingsIds[thingID] = 2;\n                    onDataFetched(dispatch, thingID, thing, type);\n                }\n            };\n            const failFn = (failureXHR) => {\n                // FIXME: This error handling only happens when there's server-side error -\n                //        can't handle client-side ones\n                dispatch(requestThingFail(/*thingID*/));\n                if (failureXHR && failureXHR.status === 404) {\n                    alertify.alert(\"This page is not available. Please try again later.\");\n                } else {\n                    alertify.alert(\n                        'There was an error while opening the page.<br> Please try again or contact <a mailto=\"cs@fancy.com\">cs@fancy.com</a>.'\n                    );\n                }\n            };\n            if (window.requestPromise) {\n                const requestPromise = window.requestPromise;\n                delete window.requestPromise;\n                requestPromise.then(successFn).catch(failFn);\n            } else {\n                if (__Config.design_v4) {\n                    $.get(`/rest-api/v1/things/${thingID}/details${queryString}`, options).then(successFn).fail(failFn);\n                } else {\n                    $.get(`/rest-api/v1/things/${thingID}${queryString}`, options).then(successFn).fail(failFn);\n                }\n            }\n        }\n    };\n}\n\nexport function getCordialProperties(thing) {\n    const prop = {\n        thingID: thing.id,\n        productID: thing.sales.id,\n        seller: thing.sales.seller.username,\n        url: \"https://fancy.com\" + thing.url,\n        name: thing.emojified_name,\n        category: thing.sales.cordial_category,\n        instock: thing.sales.available && !thing.sales.soldout,\n        image: thing.images[0].image_url,\n        price: parseFloat(thing.sales.min_price),\n    };\n    if (thing.recommended && thing.recommended.length) {\n        prop[\"recommended\"] = thing.recommended.map((item, i) => item.id);\n    }\n    return prop;\n}\n\nfunction onLoadThing(thing) {\n    const MPArgs = { \"thing id\": thing.id };\n    const currentLocationArgPair = getLocationArgPairs(\"utm\");\n    if (currentLocationArgPair) {\n        MPArgs.utm = currentLocationArgPair[1];\n    }\n    MP(\"View Thing Detail\", MPArgs);\n    if (typeof LogExposed != \"undefined\") window.LogExposed.addLog(thing.id + \"\", \"thing\");\n    try {\n        window.crdl(\"event\", \"browse\", getCordialProperties(thing));\n    } catch (e) {}\n    try {\n        let trackingItem;\n        if (thing.sales) {\n            trackingItem = {\n                id: thing.sales.id,\n                brand: thing.sales.seller.brand_name,\n                name: thing.sales.emojified_name || thing.emojified_name,\n                price: thing.sales.price,\n            };\n            window.dataLayer.push({\n                product_id: thing.sales.id,\n                event: \"ProductPage\",\n                products: undefined,\n                products_info: undefined,\n                revenue: undefined,\n                option_id: thing.sales.options && thing.sales.options.length ? thing.sales.options[0].id : undefined,\n            });\n        } else {\n            trackingItem = {\n                id: thing.id,\n                name: thing.emojified_name,\n            };\n        }\n        window.TrackingEvents.viewItem(trackingItem);\n        ga(\"send\", { hitType: \"pageview\", page: location.href, title: document.title });\n    } catch (e) {}\n}\n\nfunction addAdditionalThingContext(thingData: ThingObject) {\n    thingData.fromServer = true;\n    thingData.sales_available =\n        !isEmpty(thingData.sales) &&\n        !thingData.sales.show_anywhere_only &&\n        thingData.sales.status !== salesStatus.EXPIRED; // TODO: need to check exact condition.\n}\n\nexport function toggleFollow({ seller_id, user_id }) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var state = getState();\n        var followType;\n        var data;\n        if (seller_id) {\n            followType = \"followStore\";\n            data = { seller_id };\n        } else if (user_id) {\n            followType = \"followUser\";\n            data = { user_id };\n        } else {\n            return;\n        }\n\n        if (state.followContext[followType].loading === false) {\n            var url = state.followContext[followType].following === true ? \"/delete_follow.xml\" : \"/add_follow.xml\";\n            dispatch(toggleFollowAction(followType));\n            $.ajax({\n                url,\n                data,\n                type: \"post\",\n                dataType: \"xml\",\n            })\n                .done(function (xml) {\n                    var $status = $(xml).find(\"status_code\");\n                    if ($status.length && $status.text() !== 0) {\n                        dispatch(completeFollow(followType));\n                    } else {\n                        dispatch(cancelFollow(followType));\n                    }\n                })\n                .fail(function () {\n                    dispatch(cancelFollow(followType));\n                });\n        }\n    };\n}\n\nexport function toggleFancy(thingID: string) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var state = getState();\n        var { fancyd, fancyd_count, loading } = state.fancyContext;\n        if (!loading) {\n            dispatch(toggleFancyAction(thingID));\n            $.ajax({\n                type: \"PUT\",\n                url: `/rest-api/v1/things/${thingID}`,\n                data: {\n                    fancyd: !fancyd,\n                },\n            })\n                .done(function (json) {\n                    var fc = 0;\n                    if (json.id && json.fancyd === !fancyd) {\n                        if (json.fancyd === true) {\n                            fc = fancyd_count + 1;\n                        } else if (json.fancyd === false) {\n                            fc = fancyd_count - 1;\n                        }\n                        // cache.update(thingID, undefined, \"fancyd\", json.fancyd);\n                        // cache.update(thingID, undefined, \"fancyd_count\", fc);\n\n                        dispatch(completeFancy(thingID, fc));\n                    } else {\n                        dispatch(cancelFancy(thingID));\n                    }\n                })\n                .fail(function () {\n                    dispatch(cancelFancy(thingID));\n                });\n        }\n    };\n}\n\nfunction calculatePrice(thing: ThingObject, saleContext: SaleContext, newContext: SaleContext) {\n    const saleOptionID = newContext.saleOptionID || saleContext.saleOptionID;\n    const sales = thing && thing.sales;\n    // Get object basis for retrieving price.\n    if (isSalesOptionsAvailable(sales)) {\n        const basis = _.find(sales.options, (option) => option.id === saleOptionID);\n        if (basis != null) {\n            return basis.price;\n        } else {\n            console.warn(\n                \"calculatePrice():\",\n                \"Wrong saleOptionID supplied, please investigate. saleOptionID: \",\n                saleOptionID\n            );\n            return 0;\n        }\n    } else if (sales != null) {\n        return sales.price;\n    } else {\n        return 0;\n    }\n}\n\nexport function updateSaleContext(newContext: SaleContext) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var { thing, saleContext, slideContext } = getState();\n        newContext.price = calculatePrice(thing.data, saleContext, newContext);\n        dispatch({ ...newContext, type: C.UPDATE_SALE_CONTEXT });\n        if (saleContext.saleOptionID !== newContext.saleOptionID) {\n            const option = getCurrentSaleOption(thing.data.sales, newContext, true);\n            const saleImages = getSaleImages(thing.data, option);\n            let firstOptionImageIdx;\n            if (\n                option &&\n                saleImages.some((img, idx) => {\n                    if (img.option_id === option.id) {\n                        firstOptionImageIdx = idx;\n                        return true;\n                    }\n                })\n            ) {\n                // blank\n            } else {\n                if (slideContext.thumbnailIndex > saleImages.length - 1) {\n                    firstOptionImageIdx = 0;\n                }\n            }\n            if (firstOptionImageIdx) {\n                dispatch(setThumbnailIndex(firstOptionImageIdx));\n            }\n        }\n    };\n}\n\nfunction requestCurrencyConversion(nextCode: string, nextPrice: string, callback) {\n    const shouldConvert = !(nextCode == null || callback == null);\n    if (shouldConvert) {\n        if (window.numberType === 2) {\n            nextPrice = nextPrice.replace(/,/g, \".\").replace(/ /g, \"\");\n        }\n        if (_.isString(nextPrice)) {\n            nextPrice = nextPrice.replace(/,/g, \"\");\n        }\n        $.ajax({\n            url: \"/convert_currency.json\",\n            type: \"GET\",\n            dataType: \"json\",\n            data: {\n                amount: nextPrice,\n                currency_code: nextCode,\n            },\n        }).success(({ amount, currency } = {}) => {\n            if (amount == null) {\n                return;\n            }\n            callback(currency.code, formatPrice(amount, currency.code), currency.symbol);\n        });\n    }\n}\n\nfunction _convertCurrency(nextCode: string, nextPrice: string, force: boolean) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        const { saleContext } = getState();\n        if (nextCode !== \"USD\") {\n            if (\n                force || // FIXME: unable to comparison since price update comes first (SaleitemSidebarHead.componentWillReceiveProps())\n                saleContext.price !== nextPrice || // currency price changed\n                saleContext.currencyCode !== nextCode || // currency code changed\n                saleContext.currencyMoney == null || // currency symbol/money is not set (changed from usd)\n                saleContext.currencySymbol == null\n            ) {\n                nextPrice = nextPrice || saleContext.price || \"0.00\";\n                requestCurrencyConversion(nextCode, nextPrice, (currencyCode, currencyMoney, currencySymbol) => {\n                    if (typeof currencyMoney === \"number\") {\n                        currencyMoney = currencyMoney.toFixed(2);\n                    }\n                    currencyMoney = currencyMoney.replace(/[ \\.]00$/, \"\");\n                    dispatch(\n                        updateSaleContext({\n                            currencyCode,\n                            currencyMoney,\n                            currencySymbol,\n                        })\n                    );\n                });\n            } else {\n                // NOOP\n            }\n        } else {\n            dispatch(\n                updateSaleContext({\n                    currencyCode: \"USD\",\n                    currencyMoney: null,\n                    currencySymbol: null,\n                })\n            );\n        }\n    };\n}\n\nexport function convertCurrency(nextCode, nextPrice, force = false) {\n    store.dispatch(_convertCurrency(nextCode, nextPrice, force));\n}\n","import C from './action-constants';\n\n\n// Action on requesting thing starts\nexport function requestThing(pendingID) {\n    return {\n        type: C.REQUEST_THING,\n        status: 'request',\n        pendingID\n    };\n}\n\n// Action on requesting thing fails\nexport function requestThingFail() {\n    return {\n        type: C.REQUEST_THING_FAILURE,\n        status: 'failed'\n    };\n}\n\n// action on loading request result\nexport function loadThing(ID, data) {\n    return {\n        type: C.LOAD_THING,\n        status: 'idle',\n        ID,\n        data\n    };\n}\n\n// Action on close overlay\nexport function openThing() {\n    return {\n        type: C.OPEN_THING\n    };\n}\n\n// Action on close overlay\nexport function closeThing() {\n    return {\n        type: C.CLOSE_THING,\n        ID: null,\n        pendingID: null,\n        thing: null\n    };\n}\n\n\nexport function setThumbnailIndex(thumbnailIndex) {\n    return {\n        type: C.SET_THUMBNAIL_INDEX,\n        thumbnailIndex,\n    };\n}\n\nexport function toggleFollow(followType) {\n    return {\n        type: C.TOGGLE_FOLLOW,\n        followType\n    };\n}\n\nexport function cancelFollow(followType) {\n    return {\n        type: C.CANCEL_FOLLOW,\n        followType\n    };\n}\n\nexport function completeFollow(followType) {\n    return {\n        type: C.COMPLETE_FOLLOW,\n        followType\n    };\n}\n\nexport function toggleFancy(thingID) {\n    return {\n        type: C.TOGGLE_FANCY,\n        thingID,\n    };\n}\n\nexport function cancelFancy(thingID) {\n    return {\n        type: C.CANCEL_FANCY,\n        thingID,\n    };\n}\n\nexport function completeFancy(thingID, fancyd_count) {\n    return {\n        type: C.COMPLETE_FANCY,\n        thingID,\n        fancyd_count\n    };\n}\n\nexport function updateAppContext(contextObject) {\n    return {\n        type: C.UPDATE_APP_CONTEXT,\n        context: contextObject\n    };\n}\n","// App state that does not usually change during app lifecycle. (i.e. Login state)\n\n// module-level login state object and setter\nconst state : { viewer: {}; loggedIn: Boolean; } = { viewer: {}, loggedIn: false };\nexport default state;\n\nexport function updateState(k, v) {\n    state[k] = v;\n}\n","import { index } from 'fancyutils';\n\n// Cache bucket\nexport class ThingCache {\n    things = {};\n    sales = {};\n    count = 0;\n    static SALES = 'sales';\n    static THINGS = 'things';\n\n    exists = (id, type, ignoreCralwed) => {\n        const cac = this.get(id, type);\n        var existence = cac != null && typeof cac === 'object';\n        if (ignoreCralwed) {\n            existence = existence && cac.isCrawled !== true;\n        }\n        return existence;\n    }\n\n    // resolver function\n    _get = (id) => {\n        return this[ThingCache.THINGS][id] || this[ThingCache.SALES][id] || null;\n    }\n\n    get = (id, type = ThingCache.THINGS) => {\n        const cac = this[type][id] || this.getCrawled(id, type);\n        return cac;\n    }\n\n    getCrawled = (id, type) => {\n        const cac = this[type][id];\n        if (cac && cac.isCrawled) {\n            return cac;\n        } else {\n            return null;\n        }\n    }\n\n    add = (id, data, type) => {\n        // to add, cache should not be exist or crawled one\n        const cac = this[type][id];\n        if (\n            cac == null || \n            cac.isCrawled === true\n        ) {\n            this[type][id] = data;\n            // Store thing information as well\n            if (type === ThingCache.SALES && data.id) {\n                this[ThingCache.THINGS][data.id] = data;\n            }\n            this.count += 1;\n        } else {\n            console.warn('cache.add(): Cache overwrite');\n        }\n    }\n\n    remove = (id, type) => {\n        if (this[type][id]) {\n            delete this[type][id];\n            this.count -= 1;\n        } else {\n            console.warn('cache.remove(): Non-existing cache removal');\n        }\n    }\n\n    // selector = 'a.b.c'\n    update = (id, type = ThingCache.THINGS, selector, value) => {\n        if (selector == null) {\n            console.warn('ThingCache#update(): selector is empty');\n            return;\n        }\n        const t = this.get(id, type);\n        if (t) {\n            index(t, selector, value);\n        }\n    }\n\n    // sweep() {\n    //     // TODO: should sweep cache if too many cache added by looking `cache.count`\n    // }\n}\n\nexport const cache = new ThingCache();\nwindow.__THING_CACHE = cache;\n","export const Keys = {\n    Sidebar: {\n        Wrap: 'SIDEBAR_WRAP',\n        Body: 'SIDEBAR_BODY',\n        Title: 'SIDEBAR_TITLE',\n        Price: 'SIDEBAR_PRICE',\n        Form: 'SIDEBAR_FORM',\n        Desc: 'SIDEBAR_DESCRIPTION',\n        Owner: 'SIDEBAR_OWNER',\n    },\n};\n","import { alertify, isEmpty } from \"fancyutils\";\nimport {\n    SaleObject,\n    SaleContext,\n    ThingObject,\n    FancyReduxState,\n    User,\n    ThingImage,\n    OverlayPropsV1,\n} from \"ftypes\";\nimport { SaleItem } from \"_static/modules/ThingDetail\";\n\nconst { gettext, _ } = window;\n\nexport function mapStateToThingProps(state: FancyReduxState): OverlayPropsV1 {\n    const {\n        appContext,\n        thing: { data, isFetching, status },\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    } = state;\n\n    return {\n        appContext,\n        status,\n        thing: data,\n        isFetching,\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    };\n}\n\nexport function getSales(type: string, thing: ThingObject) {\n    return thing.sales;\n}\n\nexport function getDescription(type: string, thing: ThingObject) {\n    if (type === \"sales\") {\n        return thing.sales.description;\n    } else if (type === \"hotel\") {\n        return thing.hotel_search.details.propertyDescription;\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSaleItemId(thing: ThingObject, viewer: User) {\n    if (viewer && viewer.is_admin_any) {\n        if (thing.sales) {\n            return thing.sales.id;\n        } else if (thing.inactive_sales) {\n            return thing.inactive_sales.id;\n        }\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSeller(thing: ThingObject) {\n    if (thing.sales) {\n        return thing.sales.seller;\n    } else if (thing.inactive_sales) {\n        return thing.inactive_sales.seller;\n    }\n}\n\nexport function getDetailType(thing: ThingObject) {\n    if (thing.hotel_search) {\n        return \"hotel\";\n    } else if (thing.sales_available && thing.type !== \"vanity_number\") {\n        return \"sales\";\n    } else if (!thing.sales_available && !thing.has_launch_app && thing.type !== \"giftcard\") {\n        return \"urlOnly\";\n    }\n}\n\nexport function isSalesOptionsAvailable<T extends SaleItem>(sales: T | null) {\n    return sales != null && !isEmpty(sales.options);\n}\n\nexport function getFirstSaleOption(sales: SaleItem, ignoreEmptySaleOption = false) {\n    if (isSalesOptionsAvailable(sales)) {\n        return sales.options[0];\n    } else if (ignoreEmptySaleOption === false) {\n        return sales || null;\n    }\n}\n\nexport function getCurrentSaleOption<T extends SaleItem>(sales: T, saleContext: SaleContext = {}, ignoreEmptySaleOption = false) {\n    const { saleOptionID } = saleContext;\n\n    if (isSalesOptionsAvailable<T>(sales)) {\n        if (saleOptionID) {\n            const opts = _(sales.options).filter((prop) => prop.id === saleOptionID);\n            if (opts[0] == null) {\n                console.warn(\"saleOption should not be null!\");\n            }\n\n            return opts[0] == null\n                ? {\n                      id: 0,\n                      discount_percentage: \"0.0\",\n                      quantity: 0,\n                      soldout: true,\n                      retail_price: 0,\n                      name: '',\n                  }\n                : opts[0];\n        } else {\n            return sales.options[0];\n        }\n    } else if (ignoreEmptySaleOption === false) {\n        return sales;\n    }\n}\n\nexport function formatPrice(amount: number, currency: string) {\n    if (currency == \"BTC\") return amount + \"\";\n    var newPrice = amount.toFixed(2) + \"\";\n    var regex = /(\\d)(\\d{3})([,\\.]|$)/;\n    while (regex.test(newPrice)) {\n        newPrice = newPrice.replace(regex, \"$1,$2$3\");\n    }\n    if (window.numberType === 2) {\n        newPrice = newPrice.replace(/,/g, \" \").replace(/\\./g, \",\");\n    }\n    return newPrice;\n}\n\n// sales: thing.sales\nexport function getDomesticDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    if (sales.expected_delivery_day_1) {\n        date += sales.expected_delivery_day_1;\n    }\n    if (sales.expected_delivery_day_2) {\n        date += \" - \" + sales.expected_delivery_day_2;\n    }\n    return date;\n}\n\n// sales: thing.sales\nexport function getIntlDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    // TODO: use moment for locale string\n    if (sales.expected_delivery_day_intl_1) {\n        date += sales.expected_delivery_day_intl_1;\n    }\n    if (sales.expected_delivery_day_intl_2) {\n        date += \" - \" + sales.expected_delivery_day_intl_2;\n    }\n    return date;\n}\n\nexport function currencyIsUSD({ saleContext }: { saleContext: SaleContext }) {\n    return saleContext.currencyCode === \"USD\";\n}\n\n// [sale option id]: { true | false }\nconst saleOptionWaitingRegistry = {};\nwindow.saleOptionWaitingRegistry = saleOptionWaitingRegistry;\nexport function setWaiting(chosenSaleOptionID, setResult) {\n    saleOptionWaitingRegistry[chosenSaleOptionID] = setResult;\n}\nexport function getWaiting<T extends SaleItem>(sales: T, saleContext) {\n    if (sales == null) {\n        return null;\n    }\n    if (saleContext.waiting != null) {\n        return saleContext.waiting;\n    }\n\n    // https://app.asana.com/0/86925821949642/160205241997173\n    // It could be a bit weird for future, but design-side decision\n    if (sales.waiting) {\n        return sales.waiting;\n    }\n\n    const chosenSaleOption = getCurrentSaleOption(sales, saleContext);\n    // options is SaleItem\n    if (sales.id === chosenSaleOption.id) {\n        return sales.waiting;\n        // option is SaleOption\n    } else {\n        if (saleOptionWaitingRegistry[chosenSaleOption.id] != null) {\n            return saleOptionWaitingRegistry[chosenSaleOption.id];\n        } else if (chosenSaleOption.waiting != null) {\n            return chosenSaleOption.waiting;\n        }\n    }\n}\n\nfunction fillArray(original: Array<unknown> /*sparse?ArrayToFill*/, filler: Array<unknown>) {\n    const ol = original.length;\n    const fl = filler.length;\n    const sparseIdxs = [];\n    // Find sparse indexes first.\n    for (let j = 0; j < ol; j++) {\n        if (!(j in original)) {\n            sparseIdxs.push(j);\n        }\n    }\n    for (let i = 0; i < fl; i++) {\n        // if sparse indexes are all in (or nonexist), push leftovers to tail\n        if (i > sparseIdxs.length - 1) {\n            original.push(filler[i]);\n        } else {\n            original[sparseIdxs[i]] = filler[i];\n        }\n    }\n    return original;\n}\n\nlet tid;\nlet optionId: undefined;\nlet hotelImages: ThingImage[] | undefined | [];\nlet salesImages;\nlet thingImages;\nexport function getSaleImages(thing: ThingObject, option, thumbnailsLimit?: number) {\n    if (thing.hotel_search != null) {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n\n            hotelImages = <ThingImage[]>thing.hotel_search.images.map((img) => ({\n                src: img.url,\n                thumbnail_src: img.thumbnailUrl,\n                width: img.width,\n                height: img.height,\n            }));\n            hotelImages.unshift(thing.image_resized_max);\n        }\n        return hotelImages;\n    } else if (thing.sales != null) {\n        if (__Config.design_v4) {\n            const images = [];\n            fillArray(images, thing.images);\n            if (option && option.images && option.images.length > 0) {\n                fillArray(images, option.images);\n            }\n            salesImages = images;\n            if (option) {\n                optionId = option.id;\n            }\n            if (thing && thing.sales && thing.sales.video) {\n                images.unshift(thing.sales.video);\n            }\n            return salesImages;\n        }\n\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            // optionId = option ? option.id : null;\n            // FIXME: do this somewhere else\n            if (thing.image_resized_max == null) {\n                if (thing.image.src) {\n                    thing.image_resized_max = {\n                        src: thing.image.src,\n                        width: thing.image.width,\n                        height: thing.image.height,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                } else {\n                    thing.image_resized_max = {\n                        src: \"/_ui/images/common/blank.gif\",\n                        width: 1,\n                        height: 1,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                }\n            }\n\n            let images = [];\n\n            if (thing.image_resized_max) {\n                images.push(thing.image_resized_max);\n            }\n\n            if (thing.images && thing.images[0]) {\n                images.push(thing.images[0]);\n            }\n\n            // set sale images\n            if (thing && thing.sales && thing.sales.video) {\n                let video = { src: thing.sales.video.thumbnail_url, thumbType: \"video\" };\n                if (thing.sales.video.position > 0) {\n                    images[thing.sales.video.position] = video;\n                } else {\n                    // set video to first unless the position is set\n                    images.unshift(video);\n                }\n            }\n            if (thing.sales.images) {\n                fillArray(images, thing.sales.images);\n            }\n            salesImages = images;\n        }\n        if (option && optionId !== option.id) {\n            optionId = option.id;\n            if (salesImages == null) {\n                salesImages = [];\n            }\n            if (option.images && option.images.length > 0) {\n                const images = salesImages.filter((img) => img.option_id == null);\n                fillArray(images, option.images);\n                salesImages = images;\n            }\n        }\n\n        return _.isNumber(thumbnailsLimit) && thumbnailsLimit > 0\n            ? salesImages.filter((image, idx) => idx < thumbnailsLimit && image.src)\n            : salesImages;\n    } else {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            if (thing.image_resized_max) {\n                thingImages = [thing.image_resized_max];\n            } else if (thing.image) {\n                thingImages = [thing.image];\n            } else {\n                thingImages = [];\n                // || (option && optionId !== option.id)\n            }\n        }\n        return thingImages;\n    }\n}\n\nexport function isVanityQueriable(props: any, suppress: boolean) {\n    var { AC, minPrice, maxPrice, keyword } = props;\n\n    keyword = $.trim(keyword);\n    AC = $.trim(AC);\n    minPrice = minPrice != null ? minPrice : \"0\";\n    minPrice = $.trim(minPrice).replace(\",\", \"\").replace(\"$\", \"\");\n    maxPrice = $.trim(maxPrice).replace(\",\", \"\").replace(\"$\", \"\");\n\n    const original_labels = alertify.labels;\n    if (AC !== \"\") {\n        if (_.isNaN(parseInt(AC, 10)) || AC.length !== 3) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Invalid area code. Area code should be 3 digits.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (minPrice !== \"\") {\n        if (_.isNaN(parseInt(minPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check min price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n\n        if (parseInt(minPrice, 10) >= parseInt(maxPrice, 10)) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"The max price number should be bigger than min price number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (maxPrice !== \"\") {\n        if (_.isNaN(parseInt(maxPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check max price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (keyword !== \"\") {\n        if (keyword.length < 4) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please enter 4 or more characters.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    return true;\n}\n\nexport function getSafeNameProp({ emojified_name, name }: ThingObject) {\n    if (emojified_name) {\n        return { dangerouslySetInnerHTML: { __html: emojified_name } };\n    } else {\n        return { children: name };\n    }\n}\n\nexport function isVideoUploadable(thing: ThingObject): boolean {\n    if ((thing && thing.hotel_search) || thing.metadata) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction salesAvailable(thing: ThingObject): boolean {\n    if (!isEmpty(thing.sales)) {\n        return thing.sales_available;\n    }\n    return false;\n}\n\nexport function getThingName(thing: ThingObject) {\n    if (thing.type === \"giftcard\") {\n        return gettext(\"Fancy Gift Card\");\n    } else if (salesAvailable(thing)) {\n        return thing.sales.name;\n    } else {\n        return thing.name;\n    }\n}\n","import { OverlayProps, ReduxProps } from 'ftypes';\nimport React from 'react';\n\nexport function getFancyContextDefaultValue() {\n  return {\n      appContext: {},\n      thing: {},\n      followContext: {},\n      fancyContext: {},\n      slideContext: {},\n      saleContext: {},\n      dispatch: () => {},\n  }\n}\n\n// @ts-ignore\nconst FancyContext = React.createContext<OverlayProps & ReduxProps>(getFancyContextDefaultValue());\n\nexport const useFancy = () : OverlayProps & ReduxProps => {\n  return React.useContext(FancyContext);\n}\n\nexport default FancyContext;\n","import React from 'react';\nimport { Display } from \"fancymixin\";\nimport classnames from 'classnames';\nimport { xmlUtil } from \"fancyutils\";\n\nexport default class AdminPopup extends React.Component {\n    static popupName = 'thing-admin';\n    state = {\n        show_on_homepage: null,\n        date_published: null, \n        exclude_from_popular: false,\n        show_in_search: true,\n        optionSaving: false,\n        ownerSaving: false,\n        mergeSaving: false,\n    };\n    \n    \n    componentDidMount() {\n        const that = this;\n        $.dialog(AdminPopup.popupName).$obj.on('open', () => {\n            const { thing: { show_on_homepage, date_published, exclude_from_popular, show_in_search }  } = that.props;\n            that.setState( { show_on_homepage, date_published, exclude_from_popular, show_in_search } );\n        });\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AdminPopup.popupName).center();\n    }\n    \n    handleSaveOptions = () => {\n        const { thing } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving } = this.state;\n        if (optionSaving) return false;\n        const payload = { thing_id: thing.id, show_on_homepage, exclude_from_popular, show_in_search }\n        if (show_on_homepage) {\n            let inputDate = new Date(date_published);\n            if (isNaN(inputDate)) {\n                alert(\"invalid date - must be in format of 2020-01-01 10:10:10\");\n                return false;\n            }            \n            payload['date_published'] = inputDate.toISOString().replace(/T/, \" \").split(\".\")[0];\n        }\n        this.setState({optionSaving:true});\n        $.post('/manage-newthing.json', payload).then((json) => {\n            if (json.status_code == 1) {\n                Object.assign(thing, payload);\n                alert(\"Updated!\");\n            } else {\n                alert(json.message || \"Failed to save the changes\");\n            }\n            this.setState({optionSaving:false})\n        }).fail(() => {\n            alert(\"Something went wrong!\");\n            this.setState({optionSaving:false})\n        });\n    }\n\n    handleChangeOwner = () => {\n        const { thing } = this.props;\n        if (this.state.ownerSaving) return false;\n        if (this.changeOwnerEl == null) return false;\n        const new_owner = this.changeOwnerEl.value.trim();\n        if (new_owner.length == 0) {\n            alert(\"Please enter a username.\");\n            return false;\n        }\n        if (new_owner.toLowerCase() == thing.thing_owner.username.toLowerCase()) {\n            alert(\"The thing is already owned by the user.\");\n            return false;\n        }\n\n        if (window.confirm(`Do you want to change the current thing's owner to ${new_owner}?`)) {\n            this.setState({ownerSaving: true})\n            $.ajax({\n                type: \"post\",\n                url: \"/change_new_thing_owner.xml\",\n                data: { new_owner_name: new_owner, thing_id: thing.id, new_thing_id: thing.ntid, old_user_id: thing.thing_owner.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    if (xmlUtil.isSuccess(xml)) {\n                        alert(\"Done!\");\n                        location.reload();                        \n                    } else if (xmlUtil.isFail(xml)) {\n                        alert(\n                            $(xml)\n                                .find(\"message\")\n                                .text()\n                        );\n                    }\n                })\n                .fail(() => {\n                    alert(\"There was an error.\");\n                })\n                .always(() => {\n                    this.setState({ownerSaving: false})\n                });\n        }\n        return false;\n    }\n\n    handleMergeThings = () => {\n\n    }\n\n    render() {\n        const { \n            thing, \n            thing: { sales },\n        } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving, ownerSaving, mergeSaving } = this.state;\n        return (\n          <>\n          \t<p className=\"ltit\">{thing.name}</p>\n            <div className=\"thing-admin-body\">\n                <ul className=\"thing-info\">\n                <li><em>Sale ID</em> {sales.id}</li>\n                    <li><em>Thing ID</em> {thing.id}</li>\n                    <li><em>Thing Owner</em> {thing.thing_owner.username}</li>\n                    <li className=\"buttons\">\n                        <a className=\"btns-blue-embo\" href={`/merchant/products/${sales.id}`} target=\"_blank\">Edit Sale</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-sale-orders-by-thing-id?thing_id=${thing.id}`} target=\"_blank\">View Orders</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-users-by-cart-item?sale_id=${sales.id}`} target=\"_blank\">View Carts</a>\n                    </li>\n                </ul>\n                <div className=\"thing-options\">\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-on-homepage\" checked={!!show_on_homepage}\n                        onChange={(event) => this.setState({ show_on_homepage: event.target.checked })}\n                        /> Show on Homepage</label>\n                        <input className=\"text\" type=\"text\" name=\"date-published\" placeholder=\"2020-01-02 10:20:30\"\n                            style={Display.NoneIf(!show_on_homepage)} value={date_published || ''}\n                            onChange={(event) => {this.setState({ date_published: event.target.value })}}\n                            />\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"exclude-from-popular\" checked={!!exclude_from_popular}\n                            onChange={(event) => this.setState({ exclude_from_popular: event.target.checked })}\n                        /> Exclude from Popular</label>\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-in-search\" checked={!!show_in_search}\n                            onChange={(event) => this.setState({ show_in_search: event.target.checked })}\n                        /> Show in Search</label>\n                    </p>\n                    <p>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": optionSaving })} onClick={this.handleSaveOptions}>Save Changes</button>\n                    </p>                    \n                </div>\n                <div className=\"thing-actions\">\n                    <p>\n                        <label>Change Owner</label>\n                        <input type=\"text\" name=\"change_owner\" placeholder=\"Enter new username\" ref={(el) => {this.changeOwnerEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": ownerSaving })} onClick={this.handleChangeOwner}>Change</button>\n                    </p>\n                    {/*\n                    <p>\n                        <label>Merge Things</label>\n                        <input type=\"text\" name=\"merge_thing_id\" placeholder=\"Enter Thing ID\" ref={(el) => {this.mergeThingEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": mergeSaving })} onClick={this.handleMergeThings}>Merge</button>\n                    </p>*/}\n                </div>\n\n            </div>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React from 'react';\nimport classnames from 'classnames';\nimport { closePopup, copyToClipboard } from 'fancyutils';\n\nexport default class SimpleSharePopup extends React.Component {\n    static popupName = 'minimum-share';\n\n    constructor(props) {\n        super(props);\n        const { thing, viewer } = props;\n        let url = `https://fancy.com${thing.url}`;\n        if (viewer && viewer.username) {\n            let connector = ~url.indexOf('?') ? '&' : '?';\n            url = `${url}${connector}ref=${viewer.username}`\n        }\n        console.log(url)\n        this.state = {\n            shareUrl: url,\n            urlCopied: false,\n        }\n    }\n\n    handleCancelClick = (event) => {\n        event.preventDefault();\n        closePopup(SimpleSharePopup.popupName);\n    }\n\n    componentDidUpdate(){\n        $.dialog(SimpleSharePopup.popupName).center();\n    }\n\n    handleCopyLink = (event) => {\n        console.log('handleCopyLink');\n        const { shareUrl } = this.state;\n        console.log('handleCopyLink ' + shareUrl );\n        copyToClipboard(shareUrl);\n        this.setState({ urlCopied: true });\n        setTimeout(() => {\n            this.setState({ urlCopied: false });\n        }, 2000);\n    }\n\n\n    render() {\n        const { thing, viewer } = this.props;\n        const { shareUrl, urlCopied } = this.state;\n\n        return (\n          <>\n          \t<p className=\"ltit\">Share</p>\n            <ul>\n                <li><a href=\"#\" className=\"btn-copy-link link\" onClick={this.handleCopyLink}>{urlCopied ? \"Copied to clipboard\" : \"Copy link\"}</a></li>\n                <li><a \n                    href={`http://pinterest.com/pin/create/link/?url=${encodeURIComponent(shareUrl)}&media=${thing.images ? encodeURIComponent(thing.images[0].image_url) : \"\"}&description=${encodeURIComponent(thing.name)}`}\n                    target=\"_blank\" className=\"pin\">Share to Pinterest</a></li>\n                <li><a \n                    href={`mailto:?body=Check%20out%20${encodeURIComponent(thing.name)}%20on%20Fancy!%0A%0A${encodeURIComponent(shareUrl)}&subject=${encodeURIComponent(thing.name)}%20on%20Fancy`}\n                    target=\"_blank\" className=\"email\">Share via email</a></li>\n            </ul>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { closePopup, KEYS, MP, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nexport default class AddlistPopup extends Component {\n    static popupName = 'add-list';\n    state = {\n        lists: [],\n        listSearchQuery: '',\n        listCreationQuery: '',\n        listCreating: false,\n    };\n\n    handleDialogOpen = () => {\n        this.setState({ lists: [], listSearchQuery: '', listCreationQuery: '' });\n        this.drawUserList()\n        setTimeout(() => {\n            this.listSearchInput.focus();\n        }, 0);\n\n    }\n    componentDidMount() {\n        $.dialog(AddlistPopup.popupName).$obj.on('open', this.handleDialogOpen);\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AddlistPopup.popupName).center();\n    }\n\n    drawUserList() {\n        const objectId = this.props.objectId;\n        getListCheckbox({\n            objectId,\n            callback: res => { this.setState(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setState({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (this.state.listCreating) return;\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        this.setState({ listCreating: true })\n        // save new list\n        updateList({\n            objectId,\n            createList: listCreationQuery,\n            callback: (success, updated) => {\n                if (success) {\n                    const { lists } = this.state;\n                    MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    this.setState( {\n                        listCreationQuery: '', listCreating: false,\n                        lists: [ ...updated, ...lists ],\n                    });\n                }\n            }\n        })\n    }\n\n    handleListItemToggle = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = Number(targ.getAttribute('data-listid'));\n        const theList = lists.filter(list => list.id === selectedListId)[0];\n        const prevAdded = theList.added;\n        theList.added = !theList.added;\n        const eventName = theList.added ? \"Add to List\" : \"Remove from List\";\n        this.setState({ lists })\n\n        const callback = (success, updated) => {\n            const { lists } = this.state;\n            if (success) {\n            } else {\n                const theList = lists.filter(list => list.id === selectedListId)[0];\n                theList.added = prevAdded;\n            }\n            this.setState({ lists })\n            MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n        };\n\n        const update = { objectId, callback };\n\n        if (theList.added) update['checked'] = [theList.id];\n        else update['unchecked'] = [theList.id];\n        updateList(update)\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setState({ listCreationQuery: event.target.value });\n    }\n\n    render() {\n        var { objectId } = this.props;\n        var {\n            lists,\n            listSearchQuery,\n            listCreationQuery,\n            listCreating,\n        } = this.state;\n\n        return (\n            <>\n                <p className=\"ltit\">Add to lists</p>\n                <fieldset className=\"search\">\n                    <input type=\"text\" placeholder=\"Search\" className=\"text\" \n                        value={listSearchQuery} ref={(element) => {this.listSearchInput = element;}}\n                        onChange={this.handleListSearch} />\n                </fieldset>\n                <div className=\"list\">\n                    <ul ref={(el) => {this.lists = el;}}>\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style} className={classnames({ \"added\": list.added })}>\n                                <label>{list.name}</label>\n                                <button\n                                    data-listid={list.id} \n                                    onClick={this.handleListItemToggle}\n                                    className=\"btns-blue-embo\">{list.added ? \"Remove\" : \"Add\"}</button>\n                            </li>\n                        )\n                    })}\n                    </ul>\n                </div>\n                <fieldset className=\"create\">\n                    <input \n                        type=\"text\" placeholder=\"Create new list\" \n                        ref={(element) => {this.quickCreateList = element;}}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}/>\n                    <button className={classnames(\"btn-create\", { \"loading\": listCreating })} style={Display.NoneIf($.trim(listCreationQuery).length == 0)}\n                        onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </fieldset>\n                <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n            </>\n        );\n    }\n}\n\nfunction getListCheckbox({ objectId, callback }) {\n    $.get('/get_list_checkbox.json', { tid: objectId }).done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            closePopup(AddlistPopup.popupName);\n        }\n        callback && callback({ lists: resp.lists })\n    },)\n    .error(err => { \n        alertify.alert(\"Please try again later.\");\n        console.warn(err); \n        closePopup(AddlistPopup.popupName);\n    });\n}\n\nfunction updateList({ objectId, checked, unchecked, createList, callback }) {\n    const payload = { tid: objectId };\n    if (checked) payload['add_list_ids'] = checked.join(',');\n    if (unchecked) payload['remove_list_ids'] = unchecked.join(',');\n    if (createList) payload['new_list'] = createList;\n\n    $.post('/update_list_checkbox.json', payload)\n    .done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            callback(false, null);\n        } else {\n            callback(true, resp.lists);\n        }\n    })\n    .error(err => { \n        console.warn(err); \n        alertify.alert(\"Please try again later.\");\n        callback(false, []);\n    })\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { MP, renderPopup } from \"fancyutils\";\nimport { useDispatch } from 'react-redux'\n\nimport { useFancy } from \"../FancyContext\";\nimport AdminPopup from \"../../popup/AdminPopup\"\nimport SimpleSharePopup from \"../../popup/SimpleSharePopup\"\nimport AddlistPopup from \"../../popup/AddlistPopup\"\nimport { toggleFancy, getCordialProperties } from \"../../../action/action-helpers\";\n\nfunction Favorite() {\n    const { appContext, thing, fancyContext } = useFancy();\n    const dispatch = useDispatch();\n\n    const handleClick = (event: React.MouseEvent) => {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log('favortie');\n        if (!appContext.loggedIn) {\n            window.require_login(null, \"fancy_thing\", thing.id);\n            return;\n        }\n\n        if (fancyContext.loading) {\n            return;\n        }\n\n        dispatch(toggleFancy(thing.id));\n\n        if (!fancyContext.fancyd) {\n            MP(\"Fancy\", { thing_id: thing.id });\n            try{\n                window.crdl('event', 'favorite_item', getCordialProperties(thing));\n            } catch(e) {\n            }\n        } else {\n            MP(\"Unfancy\", { thing_id: thing.id });\n        }\n    };\n\n    return (\n        <a className={classnames(\"button button-static fancy _count\", { fancyd: fancyContext.fancyd })} onClick={handleClick}>\n            Favorite\n        </a>\n    );\n}\n\nexport default function ActionButtons() {\n    const {\n        appContext: { viewer, loggedIn },\n        thing,\n        fancyContext,\n    } = useFancy();\n\n    return (\n        <>\n            <span className=\"_fancyd fancyd_user\">{fancyContext.fancyd_count} people favorited</span>\n            <a onClick={(event) => {\n                event.preventDefault();\n                if (!loggedIn) {\n                    window.require_login();\n                    return;\n                }\n                renderPopup(AddlistPopup, { objectId: thing.id });\n            }} className=\"add-list\">Add to List</a>\n            <div className=\"figure-button action-button-v2\">\n                { viewer.is_admin_any && (\n                    <a className=\"edit\" \n                        onClick={(event) => {\n                            event.preventDefault();\n                            renderPopup(AdminPopup, { viewer, thing });\n                        }}>Edit</a>\n                )}\n                <Favorite />\n                <a\n                    className=\"btn-share\"\n                    onClick={(event) => {\n                        event.preventDefault();\n                        renderPopup(SimpleSharePopup, { viewer, thing });\n                    }}>\n                    Share\n                </a>\n            </div>\n        </>\n    );\n}\n","import { minmax } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\nimport { ThingImageOrVideo } from \"ftypes\";\n\n// TODO: cache per (thing id + image index)\nconst zoomBoxMaximumSize = 240;\nconst zoomScale = 1.5;\n\nconst getBoundarySize = () => {\n    const $el = $(\n        \".thing-detail-container .figure-section .swiper-container.gallery-top .active-slide\"\n    ).eq(0);\n\n    if ($el.length !== 1) {\n        window.DEBUG && console.warn('getBoundarySize(): warning: $el.length is ', $el.length);\n    }\n\n    return {\n        $el,\n        width: $el.width()!,\n        height: $el.height()!,\n    };\n};\ntype BS = ReturnType<typeof getBoundarySize>;\n\nconst getZoomBoxSize = (bs: BS) => Math.min(bs.width / 3, zoomBoxMaximumSize);\nconst getZoomMargin = (bs: BS) => (getZoomBoxSize(bs) - 4) / 2;\n\nconst zidCac: { [o: string]: any } = {};\nconst getZoomImageDimension = (img: ThingImageOrVideo, bs = getBoundarySize()) => {\n    if (zidCac[img.image_url]) {\n        return zidCac[img.image_url];\n    }\n    const zoomMargin = getZoomMargin(bs);\n    // const imageSize = calculateImageSize(img);\n\n    const ret = {\n        width: bs.width * zoomScale /* * (imageSize.larger === \"height\" ? imageSize.proportion : 1) */ + zoomMargin,\n        height: bs.height * zoomScale + zoomMargin,\n        /* ((b.height * imageSize.height) / imageSize.width) *\n                (imageSize.larger === \"width\" ? imageSize.proportion : 1) *\n                zoomScale +\n            zoomMargin ,*/\n    };\n    zidCac[img.image_url] = ret;\n    return ret;\n};\n\nconst getImageMeta = (bs: BS) => {\n    let width, height, marginHoriz, marginVert;\n\n    const $fig = $(\".thing-detail-container .figure-section .swiper-container.gallery-top img:eq(0)\");\n    width = $fig.width()!;\n    height = $fig.height()!;\n    marginHoriz = 0;\n    if (width > height) {\n        marginHoriz = 0;\n        marginVert = (bs.height - height) / 2;\n    } else {\n        marginHoriz = (bs.width - width) / 2;\n        marginVert = 0;\n    }\n    return { width, height, marginHoriz, marginVert };\n};\n\nexport const getNextZoomImageStyle = (img: ThingImageOrVideo, pageX: number, pageY: number) => {\n    const bs = getBoundarySize();\n    const $wrapper = bs.$el;\n\n    if (!$wrapper.length) {\n        return Display.None;\n    }\n\n    const boundaryWidth = bs.width;\n    const boundaryHeight = bs.height;\n    const meta = getImageMeta(bs);\n\n    const offset = $wrapper.offset()!;\n    const left = pageX - offset.left;\n    const top = pageY - offset.top;\n\n    const topPosition = top - (boundaryHeight - meta.height) / 2;\n\n    const showZoomImage = left > 0 && topPosition > 0 && topPosition < meta.height;\n\n    const zoomBoxSize = getZoomBoxSize(bs);\n    const zoomMargin = getZoomMargin(bs);\n\n    if (showZoomImage) {\n        const zd = getZoomImageDimension(img, bs);\n        const zoomImageContainerX = minmax(\n            left - zoomMargin,\n            meta.marginHoriz,\n            meta.marginHoriz + meta.width - zoomBoxSize\n        );\n        const zoomImageContainerY = minmax(\n            top - zoomMargin,\n            meta.marginVert,\n            meta.marginVert + meta.height - zoomBoxSize\n        );\n\n        const backgroundLeft = (zd.width * left) / boundaryWidth - zoomMargin;\n        const backgroundTop = (zd.height * top) / boundaryHeight - zoomMargin;\n\n        const bgPosX = -minmax(backgroundLeft, 0, zd.width - zoomBoxSize);\n        const bgPosY = -minmax(backgroundTop, 0, zd.height - zoomBoxSize);\n\n        return {\n            left: 0,\n            top: 0,\n            width: `${zoomBoxSize}px`,\n            height: `${zoomBoxSize}px`,\n            transform: `translate(${zoomImageContainerX}px, ${zoomImageContainerY}px)`,\n            backgroundPosition: `${bgPosX}px ${bgPosY}px`,\n            display: \"inline\",\n        };\n    } else {\n        return Display.None;\n    }\n};\n\nconst RESIZED_SIZE = 1280;\nconst calculateImageSize = (img: ThingImageOrVideo) => {\n    const size = Math.max(img.width, img.height);\n    if (size < RESIZED_SIZE) {\n        const smallerSize = Math.min(img.width, img.height);\n        return {\n            width: img.width,\n            height: img.height,\n            proportion: size / smallerSize,\n            larger: img.width > img.height ? \"width\" : \"height\",\n        };\n    } else {\n        if (img.width > img.height) {\n            const proportion = RESIZED_SIZE / img.width;\n            return {\n                width: RESIZED_SIZE,\n                height: img.height / proportion,\n                proportion,\n                larger: \"width\",\n            };\n        } else {\n            const proportion = RESIZED_SIZE / img.height;\n            return {\n                width: img.width / proportion,\n                height: RESIZED_SIZE,\n                proportion,\n                larger: \"height\",\n            };\n        }\n    }\n};\n\nexport const isZoomable = (img: ThingImageOrVideo) => {\n    const imageSize = calculateImageSize(img);\n    const boundarySize = getBoundarySize();\n\n    return imageSize.width > boundarySize.width * zoomScale || imageSize.height > boundarySize.height * zoomScale;\n};\n\nexport const getZoomImageStyle = (img: ThingImageOrVideo, isZoomActive: boolean, currentZoomImageStyle: any) => {\n    if (isZoomable(img) && isZoomActive) {\n        const zd = getZoomImageDimension(img);\n        const ret = {\n            ...currentZoomImageStyle,\n            backgroundSize: `${zd.width}px ${zd.height}px`,\n        };\n        return ret;\n    } else {\n        return Display.None;\n    }\n};\n","import React, { memo, useEffect, useState, useRef } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\nimport SwiperCore, { Thumbs, Zoom } from \"swiper\";\nimport { Video } from \"common-components\";\nimport { Display } from \"fancymixin\";\n\nimport { useFancy } from \"../../FancyContext\";\nimport ActionButtons from \"../ActionButtons\";\nimport { getCurrentSaleOption, getSaleImages } from \"../../../map\";\nimport { setThumbnailIndex } from \"../../../../action/actions\";\nimport { isZoomable, getZoomImageStyle, getNextZoomImageStyle } from \"./zoom\";\n\nimport type { ThingImageOrVideo } from \"ftypes\";\nimport type { Swiper as SwiperClass } from \"ftypes\";\n\nconst isTouchDevice = \"ontouchstart\" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;\nconst SwiperAddons = [Thumbs];\nif (isTouchDevice) {\n    SwiperAddons.push(Zoom);\n}\nSwiperCore.use(SwiperAddons);\n\nconst placeholderImage = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\nconst HEIGHT = 480;\nconst PER_PAGE = 5;\n\nconst preloadImage = (src: string) =>\n    new Promise((r) => {\n        const image = new window.Image();\n        image.onload = r;\n        image.onerror = r;\n        image.src = src;\n    });\n\ninterface ImageSlideProps {\n    image: ThingImageOrVideo;\n    i: number;\n    isActive: boolean;\n    setSlideLocked: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nconst ImageSlide = memo<ImageSlideProps>(({ image, i, setSlideLocked, isActive }) => {\n    const {\n        thing,\n        slideContext: { thumbnailIndex },\n    } = useFancy();\n    const [isZoomActive, setZoomActive] = useState(false);\n    const [zoomImageStyle, setZoomImageStyle] = useState(Display.None);\n    const [zoomImageCacheKey, setZoomImageCacheKey] = useState(\"\");\n    const [zoomImageLoaded, setZoomImageLoaded] = useState(false);\n\n    const isVideo = !!image.h264_1000k_url;\n    const isMagnifyingGlassZoomable = !isVideo && !isTouchDevice;\n    const [zoomable, setZoomable] = useState(false);\n\n    useEffect(() => {\n        if (!zoomImageCacheKey && isZoomActive) {\n            preloadImage(image.large_image_url).then(() => {\n                setZoomImageCacheKey(image.large_image_url);\n                setZoomImageLoaded(true);\n            });\n        }\n        if (zoomImageCacheKey !== \"\" && image.large_image_url !== zoomImageCacheKey) {\n            setZoomImageCacheKey(\"\");\n            setZoomImageLoaded(false);\n        }\n    }, [image.large_image_url, isZoomActive, zoomImageCacheKey]);\n\n    return (\n        <SwiperSlide\n            zoom={isMagnifyingGlassZoomable}\n            key={i}\n            className={classnames({\n                \"video-slide\": isVideo,\n                startZoom: isZoomActive,\n                zoomShow: zoomable,\n                'active-slide': isActive,\n                loading: thing.loading,\n            })}\n            onClick={() => {\n                if (isMagnifyingGlassZoomable && zoomable) {\n                    setZoomActive(!isZoomActive);\n                    setSlideLocked(!isZoomActive);\n                }\n            }}\n            onMouseMove={({ pageX, pageY }) => {\n                if (!isMagnifyingGlassZoomable) {\n                    return;\n                }\n                const newZoomable = isZoomable(image);\n                if (zoomable !== newZoomable) {\n                    setZoomable(newZoomable);\n                }\n                if (isZoomActive) {\n                    const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                    setZoomImageStyle(nextZoomImageStyle);\n                }\n            }}>\n            {isVideo ? (\n                <Video\n                    object={image}\n                    display={true}\n                    playing={thumbnailIndex == i}\n                    lastFullyRenderedObjectID={thing.id}\n                    allow={{ fullScreen: true }}\n                />\n            ) : (\n                <>\n                    <img\n                        className=\"swiper-lazy\"\n                        src={image.image_url}\n                        data-src={image.image_url}\n                        onLoad={() => {\n                            setZoomable(isZoomable(image));\n                        }}\n                        title={!isTouchDevice ? \"Double click to zoom-in\" : undefined}\n                        alt={thing.name}\n                        style={zoomable ? { cursor: \"zoom-in\" } : undefined}\n                    />\n                    <em\n                        className=\"zoomImage\"\n                        onClick={() => {\n                            setZoomActive(false);\n                            setSlideLocked(false);\n                        }}\n                        style={{\n                            ...getZoomImageStyle(image, isZoomActive, zoomImageStyle),\n                            backgroundImage: `url(${zoomImageLoaded ? image.large_image_url : image.image_url})`,\n                        }}\n                    />\n                    {isTouchDevice && <div className=\"swiper-lazy-preloader\" />}\n                </>\n            )}\n        </SwiperSlide>\n    );\n}, (prevProps: ImageSlideProps, nextProps: ImageSlideProps) => {\n    return prevProps.image.image_url === nextProps.image.image_url && prevProps.isActive === nextProps.isActive;\n});\nImageSlide.displayName = \"SwiperSlide\"; // This is important to make swiper to acknowledge it's actually slide, not some random components\n\nconst Image = () => {\n    const fancyProps = useFancy();\n    const {\n        thing,\n        saleContext,\n        slideContext: { thumbnailIndex },\n    } = fancyProps;\n    const swiperRef = useRef(null);\n    const swipeThumbsRef = useRef(null);\n    const [thumbIndex, setThumbIndex] = useState(0);\n    const [slideLocked, setSlideLocked] = useState(false);\n    const [swiper, setSwiper] = useState<null | SwiperClass>(null);\n    const option = getCurrentSaleOption(thing.sales, saleContext, true);\n    const images = getSaleImages(thing, option) as ThingImageOrVideo[];\n    const lastThumbIndex = images.length - PER_PAGE;\n\n    useEffect(() => {\n        if (!swiper) {\n            return;\n        }\n        if (thumbnailIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbnailIndex);\n        }\n        if (swipeThumbsRef.current) {\n            const thumbSwiper = swipeThumbsRef.current.swiper;\n            if (!thumbSwiper.slides[thumbnailIndex].classList.contains(\"swiper-slide-visible\"))\n                thumbSwiper.slideTo(Math.min(thumbnailIndex, lastThumbIndex));\n        }\n    }, [thumbnailIndex, swiper]);\n\n    useEffect(() => {\n        if (!swipeThumbsRef.current) {\n            return;\n        }\n        const swiper = swipeThumbsRef.current.swiper;\n        if (thumbIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbIndex);\n        }\n    }, [thumbIndex]);\n\n    return (\n        <div className=\"figure-section\">\n            <Swiper\n                ref={swiperRef}\n                onSlideChange={() => {\n                    if (swiper) {\n                        fancyProps.dispatch(setThumbnailIndex(swiper.activeIndex));\n                    }\n                }}\n                preloadImages={false}\n                lazy={{\n                    loadPrevNext: true,\n                    loadPrevNextAmount: 0,\n                }}\n                zoom={\n                    isTouchDevice\n                        ? {\n                              maxRatio: 2,\n                          }\n                        : undefined\n                }\n                allowSlidePrev={!slideLocked}\n                allowSlideNext={!slideLocked}\n                onZoomChange={(_, scale) => {\n                    if (scale > 1) {\n                        setSlideLocked(true);\n                    } else {\n                        setSlideLocked(false);\n                    }\n                }}\n                onSwiper={(swiper) => {\n                    setSwiper(swiper);\n                }}\n                className=\"gallery-top\">\n                {images.map((image, i) => {\n                    return <ImageSlide key={i} image={image} i={i} setSlideLocked={setSlideLocked} isActive={swiper?.activeIndex === i} />;\n                })}\n                <ActionButtons />\n            </Swiper>\n            <div\n                className=\"prev\"\n                style={{ opacity: thumbIndex > 0 ? undefined : 0.3, display: lastThumbIndex <= 0 ? \"none\" : undefined }}\n                onClick={() => setThumbIndex(Math.max(0, thumbIndex - 5))}\n            />\n            <Swiper\n                className=\"gallery-thumbs\"\n                ref={swipeThumbsRef}\n                onSlideChange={() => {\n                    swipeThumbsRef.current && setThumbIndex(swipeThumbsRef.current.swiper.activeIndex);\n                }}\n                onClick={() =>\n                    swipeThumbsRef.current &&\n                    fancyProps.dispatch(setThumbnailIndex(swipeThumbsRef.current.swiper.clickedIndex))\n                }\n                direction=\"vertical\"\n                spaceBetween={16}\n                slidesPerView={PER_PAGE}\n                watchSlidesVisibility={true}\n                height={HEIGHT}>\n                {images.map((image, i) => {\n                    return (\n                        <SwiperSlide\n                            key={i}\n                            className={classnames({\n                                \"video-thumbnail\": image.h264_1000k_url,\n                                selected: i == thumbnailIndex,\n                            })}>\n                            <img\n                                height=\"80\"\n                                src={placeholderImage}\n                                style={{ backgroundImage: `url(${image.thumbnail_url})` }}\n                            />\n                        </SwiperSlide>\n                    );\n                })}\n            </Swiper>\n            <div\n                className=\"next\"\n                style={{\n                    opacity: thumbIndex < lastThumbIndex ? undefined : 0.3,\n                    display: lastThumbIndex <= 0 ? \"none\" : undefined,\n                }}\n                onClick={() => {\n                    setThumbIndex(Math.min(thumbIndex + 5, lastThumbIndex));\n                }}\n            />\n        </div>\n    );\n};\n\nexport default Image;\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { getCurrentSaleOption, getThingName } from \"../../map\";\nimport { addItemToCart, logAddCartMixpanel } from \"../../map.cart\";\n\n// Generic purchase handler, needs to be bound to insatnce on initialization.\n/*\n    data-sii={sales.id}\n    data-sisi={sales.seller_id}\n    data-tid={thing.id}\n*/\nexport function handlePurchase(event) {\n    event.preventDefault();\n    const {\n        thing,\n        thing: { sales },\n        saleContext,\n    } = this.props;\n    const saleOption = getCurrentSaleOption(sales, saleContext, true);\n    const soldout = saleOption == null ? sales.soldout : saleOption.soldout;\n    if (soldout || this.state.loading) {\n        return;\n    }\n    const saleOptionID = saleOption != null ? saleOption.id : null;\n\n    this.setState({ loading: true }, () => {\n        const payload = { \n            sale_id: sales.id,\n            quantity: saleContext.selectedQuantity,\n            personalization: saleContext.personalization,\n        }\n        if (saleOptionID != null) {\n            payload.option_id = saleOptionID;\n        }\n        Fancy.CartAPI.addItem(payload, (success, json) => {\n            if (success) {\n                Fancy.Cart.openPopup();\n            } else {\n                alertify.alert((json && json.error) || \"Failed to add the item to cart. Please contact us at cs@fancy.com if the problem persists.\");\n            }\n            this.setState({ loading: false });\n        })\n    });\n}\n\nconst SaleOptions = ({\n    options = [\"1\"],\n    currentValue = \"1\",\n    id = \"\",\n    value = (v) => v,\n    expander,\n    defaultValue,\n    printer,\n    disabled,\n    onChange,\n    onClick,\n    onFocus,\n    unselectedLabel,\n}) => {\n    expander =\n        expander ||\n        ((option, idx) => (\n            <option key={`sale_options-${idx}`} value={value(option)}>\n                {printer(option)}\n            </option>\n        ));\n\n    return (\n        <select\n            id={id}\n            className={classnames(\"select-boxes2\", { \"one-option\": options.length <= 1 })}\n            value={value(currentValue) || defaultValue}\n            disabled={disabled}\n            onChange={onChange}\n            onClick={onClick}\n            onFocus={onFocus}>\n            {unselectedLabel && <option value=\"\">{unselectedLabel}</option>}\n            {options.map(expander)}\n        </select>\n    );\n};\n\nexport const CartButton = (props) => (\n    <button {...props} label={null}>\n        {props.label}\n    </button>\n);\n\nexport const SelectBox = (props) => {\n    let {\n        className,\n        disabled,\n        label,\n        currentValue,\n        defaultValue,\n        id,\n        printer,\n        tabIndex,\n        unselectedLabel,\n        options = [\"1\"],\n        SizeGuide,\n    } = props;\n\n    printer = printer != null ? printer : (s) => s;\n    defaultValue = defaultValue != null ? defaultValue : \"1\";\n    className = className != null ? className : null;\n\n    var labelValue;\n    if (unselectedLabel != null && currentValue === \"\") {\n        labelValue = unselectedLabel;\n    } else {\n        labelValue = printer(currentValue != null ? currentValue : defaultValue);\n    }\n\n    return (\n        <div className={className}>\n            <label>{label}</label>\n            <span className={`trick-select ${id}`}>\n                <a\n                    className={classnames(\"selectBox\", { disabled, \"one-option\": options.length <= 1 })}\n                    tabIndex={tabIndex || \"1\"}>\n                    <span className=\"selectBox-label\">{labelValue}</span>\n                    <span className=\"selectBox-arrow\" />\n                </a>\n                <SaleOptions {...props} printer={printer} defaultValue={defaultValue} />\n            </span>\n            { SizeGuide && <SizeGuide key=\"size-guide\" /> }\n        </div>\n    );\n};\n\nexport class MultiOptionState {\n    constructor(options, option_meta) {\n        this.options = options;\n        this.option_meta = option_meta;\n        const orderMap = {};\n        option_meta.forEach((m) => {\n            if (orderMap[m.type] == null) {\n                orderMap[m.type] = { length: 1 };\n                orderMap[m.type][m.name] = 0;\n            } else {\n                orderMap[m.type][m.name] = orderMap[m.type].length;\n                orderMap[m.type].length += 1;\n            }\n        });\n        this.orderMap = orderMap;\n    }\n    // i.e.) getPossibleValues(['a', '1', ''], 1) => ['1', '3', '6']\n    // output: get possible options for 2nd option dependent on ('a' / 1st option)\n    getPossibleValuesForIndex(selected, targetIndex) {\n        const { options, option_meta, orderMap } = this;\n        if (targetIndex === 0) {\n            return option_meta[0].values;\n        }\n        let filteredOptions = options;\n        option_meta\n            .map((m) => {\n                const order = orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            })\n            .forEach((sel, idx) => {\n                if (idx < targetIndex) {\n                    filteredOptions = filteredOptions.filter((option) => option.values[idx] === sel);\n                }\n            });\n        return _.uniq(filteredOptions.map((o) => o.values[targetIndex])); // FIXME\n    }\n\n    getMultiOptions(selected) {\n        return this.option_meta.map((meta, idx) => {\n            return [meta, this.getPossibleValuesForIndex(selected, idx)];\n        });\n        /*\n        returns [\n            [type, ['a', 'b', 'c']],\n            [type, ['1', '2']],\n            [tyep, ['red', 'white', 'black']]\n        ]\n        */\n    }\n}\n\nexport const MultiOption = (props) => {\n    const { selected, multiOptionState, sid, SizeGuide } = props;\n    if (multiOptionState == null) {\n        return null;\n    }\n    const multiOptions = multiOptionState.getMultiOptions(selected);\n    var sizeGuidePos = -1;\n    if (SizeGuide) {\n        multiOptions.map(([meta, values], idx) => {\n            if (meta.name && meta.name.trim().toLowerCase() === \"size\") sizeGuidePos = idx;\n        });\n        if (sizeGuidePos < 0) sizeGuidePos = multiOptions.length - 1;\n    }\n    return multiOptions.map(([meta, values], idx) => {\n        const { type, name } = meta;\n\n        const indexTypeOf = multiOptionState.orderMap[type] && multiOptionState.orderMap[type][name];\n        const additional = {\n            name,\n            values,\n            indexTypeOf,\n            selectedArray: selected && selected[type],\n            selectedValue: selected && selected[type] && selected[type][indexTypeOf],\n            key: `${sid}-${idx}`,\n            showSizeGuide: idx == sizeGuidePos,\n        };\n        if (type === \"dropdown\") {\n            return <MultiSelectBox {...props} {...additional} />;\n        } else if (type === \"swatch\") {\n            additional.swatch = meta.swatch;\n            return <MultiSwatch {...props} {...additional} />;\n        } else if (type === \"thumbnail\") {\n            additional.thumbnail = meta.thumbnail;\n            return <MultiThumbnail {...props} {...additional} />;\n        } else if (type === \"button\") {\n            return <MultiButton {...props} {...additional} />;\n        }\n    });\n};\n\nexport const MultiSelectBox = (props) => {\n    const { values, name, onMultiSelectBoxChange, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option\">\n            <label>{name}</label>\n            <select\n                onChange={onMultiSelectBoxChange}\n                selected={selectedValue}\n                className={values.length <= 1 ? \"one-option\" : undefined}>\n                {values.map((value, i) => {\n                    return <MultiSelectBoxOption key={i} value={value} indexTypeOf={indexTypeOf} />;\n                })}\n            </select>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSelectBoxOption = (props) => {\n    const { value, indexTypeOf } = props;\n    return (\n        <option data-value={value} data-index-typeof={indexTypeOf} value={value}>\n            {value}\n        </option>\n    );\n};\n\nexport const MultiSwatch = (props) => {\n    const { name, values, swatch, indexTypeOf, selectedValue, onClickSwatch, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option swatch\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiSwatchOption\n                            key={i}\n                            value={value}\n                            swatch={swatch}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            onClick={onClickSwatch}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSwatchOption = (props) => {\n    const { value, swatch, indexTypeOf, selectedValue, onClick } = props;\n    return (\n        <a\n            href=\"#\"\n            style={{ backgroundColor: swatch[value] }}\n            onClick={onClick}\n            data-value={value}\n            data-label={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}\n        />\n    );\n};\n\nexport const MultiThumbnail = (props) => {\n    const { values, name, thumbnail, onClickThumbnail, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n\n    return (\n        <div className=\"multi-option thumbnail\">\n            <label>{name}</label>\n            <span className=\"value\">{selectedValue}</span>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiThumbnailOption\n                            key={i}\n                            onClick={onClickThumbnail}\n                            value={value}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            thumbnail={thumbnail}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiThumbnailOption = ({ onClick, value, indexTypeOf, selectedValue, thumbnail }) => {\n    return (\n        <a\n            href=\"#\"\n            onClick={onClick}\n            data-value={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}>\n            <img\n                src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage: `url(\"${thumbnail[value]}\")`, backgroundSize: \"cover\" }}\n                alt={value}\n            />\n        </a>\n    );\n};\n\nexport const MultiButton = (props) => {\n    const { values, name, onClickMutliButton, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option button\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiButtonOption key={i}\n                            onClick={onClickMutliButton}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            value={value}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiButtonOption = (props) => {\n    const { value, onClick, indexTypeOf, selectedValue } = props;\n    return (\n        <button\n            onClick={onClick}\n            className={selectedValue === value ? \"selected\" : \"\"}\n            data-value={value}\n            data-index-typeof={indexTypeOf}>\n            {value}\n        </button>\n    );\n};\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { floatFormatMinusTwo, numberFormat, renderPopup, escapeSelector, getLocationArgPairs } from \"fancyutils\";\n\nimport appState from \"../../../appstate\";\nimport { convertCurrency, updateSaleContext } from \"../../../action/action-helpers\";\nimport { updateAppContext } from \"../../../action/actions\";\nimport { currencyIsUSD, getCurrentSaleOption, getSafeNameProp, getWaiting, isSalesOptionsAvailable } from \"../../map\";\nimport { Keys } from \"../../Perf\";\nimport { CartButton, SelectBox, handlePurchase, MultiOption, MultiOptionState } from \"./SaleItemForm\";\nimport { OverlayProps, ReduxProps, SaleOption, SelectedMetaOption, SaleOptionMeta } from \"ftypes\";\n\nfunction optionValueFunction(opt) {\n    return opt.id;\n}\nconst saleNamePrinter = (opt) => `${opt.name} - $${opt.price}`;\n\nexport default class SaleItemSidebarHead extends Component<\n    OverlayProps & ReduxProps,\n    {\n        loading: boolean;\n        selected: null | {} | SelectedMetaOption;\n        disabled: Array<any>;\n        multiOptionState: null | MultiOptionState;\n    }\n> {\n    state = {\n        loading: false,\n        selected: {},\n        disabled: [],\n        multiOptionState: null,\n    };\n\n    handlePurchase = null;\n\n    constructor(props: OverlayProps & ReduxProps) {\n        super(props);\n        this.handlePurchase = handlePurchase.bind(this);\n        // for multi options\n        this.onClickThumbnail = this.onClickMultiOptionGen(\"thumbnail\");\n        this.onClickSwatch = this.onClickMultiOptionGen(\"swatch\");\n        this.onMultiSelectBoxChange = this.onClickMultiOptionGen(\"dropdown\");\n        this.onClickMutliButton = this.onClickMultiOptionGen(\"button\");\n    }\n\n    renderCurrencyPopup = () => {\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\").then(({ CurrencyPopup }) => {\n            renderPopup(CurrencyPopup, { currentCurrency: this.props.saleContext.currencyCode });\n        });\n    };\n\n    handleCurrencyPopup = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        this.renderCurrencyPopup();\n    };\n\n    handleCurrencyPopupUSD = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        if (!currencyIsUSD(this.props)) {\n            return false;\n        }\n        this.renderCurrencyPopup();\n    };\n\n    getApproxText = () => {\n        var { currencySymbol, currencyMoney } = this.props.saleContext;\n        var approxText = gettext(\"Approximately\");\n        return `${approxText} ${currencySymbol}${currencyMoney} `;\n    };\n\n    handleOptionChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const saleOptionID = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    handleQuantityChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const selectedQuantity = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ selectedQuantity }));\n    };\n\n    handlePersonalizationChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const personalization = event.currentTarget.value;\n        dispatch(updateSaleContext({ personalization }));\n    };\n\n    handleNotifyLater = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!appState.loggedIn) {\n            return window.require_login();\n        }\n        const {\n            thing: { sales },\n            saleContext,\n        } = this.props;\n        const opt = getCurrentSaleOption(sales, saleContext, true);\n        const params = { sale_item_id: sales.id };\n\n        if (opt != null) {\n            params.option_id = opt.id;\n        }\n\n        const waiting = getWaiting(sales, saleContext);\n        if (waiting) {\n            params.remove = 1;\n        }\n\n        $.ajax({\n            type: \"post\",\n            url: \"/wait_for_product.json\",\n            data: params,\n            dataType: \"json\",\n        }).done((json) => {\n            if (!json || json.status_code == null) {\n                return;\n            }\n            if (json.status_code == 0 && json.message) {\n                alertify.alert(json.message);\n                return;\n            }\n            const waiting = params.remove ? false : true;\n            this.props.dispatch(updateSaleContext({ waiting }));\n        });\n    };\n\n    checkApplePay = () => {\n        if (window.FancyApplePay) {\n            const { dispatch, thing, thing: { sales } } = this.props;\n            const os = sales.options.filter((o) => !o.soldout);\n            const data = {\n                total: { label: thing.name, amount: (sales.price * 100) | 0 },\n            };\n\n            if (os.length > 0) {\n                data.displayItems = os.map((o) => ({\n                    label: o.name,\n                    amount: (Number(o.price) * 100) | 0,\n                }));\n            }\n\n            window.FancyApplePay.checkAvailability((available, testmode) => {\n                if (available) {\n                    dispatch(\n                        updateAppContext({\n                            applePayDisplay: true,\n                            applePayTest: testmode,\n                        })\n                    );\n                }\n            }, data);\n        }\n    };\n\n    componentDidMount() {\n        if (!currencyIsUSD(this.props)) {\n            const { saleContext } = this.props;\n            convertCurrency(saleContext.currencyCode, saleContext.price);\n        }\n        this.initializeMultiOption();\n        this.checkApplePay();\n    }\n\n    componentDidUpdate(prevProps: OverlayProps) {\n        if (prevProps.thing.id !== this.props.thing.id) {\n            this.initializeMultiOption();\n            this.checkApplePay();\n            return;\n        }\n\n        const {\n            saleContext,\n            thing: { sales },\n        } = prevProps;\n\n        const nsc = this.props.saleContext;\n        const nextSaleOptionID = nsc.saleOptionID;\n        if (saleContext.saleOptionID !== nextSaleOptionID) {\n            const o = _.find(sales.options, (_o) => _o.id === nextSaleOptionID);\n            // option sync\n            if (o) {\n                const mos = $(\".sale-item-input .multi-option\");\n                o.values.forEach((v, i) => {\n                    const $so = mos\n                        .eq(i)\n                        .find(`[data-value=\"${escapeSelector(v)}\"]:not(.selected)`)\n                        .eq(0);\n                    if ($so.length) {\n                        if ($so.is(\"option\")) \n                            $so.prop(\"selected\", true);\n                        else\n                            $so.get(0).click();\n                    }\n                });\n                if (window.FancyApplePay && window.FancyApplePay.paymentRequest) {\n                    window.FancyApplePay.paymentRequest.update({\n                        total: {\n                            label: o.name,\n                            amount: (Number(o.price) * 100) | 0,\n                        },\n                    });\n                }\n            }\n        }\n    }\n\n    initializeMultiOption = () => {\n        const {\n            thing: {\n                sales: { options, option_meta },\n            },\n            saleContext,\n            dispatch,\n        } = this.props;\n\n        this.setState(this.getInitialMultiOptionState(options, option_meta), () => {\n            // don't block selecting cheapest item\n            if (!(options && options.length > 1)) {\n                this.updateSaleOptionIDFromMultiOptionState();\n            }\n            // ?option={number} support\n            const presetOptionId = getLocationArgPairs(\"option\");\n            if (presetOptionId && presetOptionId[1] && String(saleContext.saleOptionID) !== presetOptionId[1]) {\n                dispatch(updateSaleContext({ saleOptionID: parseInt(presetOptionId[1], 10) }));\n            }\n        });\n    };\n\n    getInitialMultiOptionState(options: SaleOption[], option_meta: SaleOptionMeta[]) {\n        const selected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        if (option_meta.length > 0) {\n            const nonSoldout = options.filter((o) => o.quantity !== 0);\n            if (nonSoldout.length !== 0) {\n                const selectedNonSoldoutOption = nonSoldout[0]; // temporary - FIXME\n                option_meta.forEach(function (opt, i) {\n                    const { type } = opt;\n                    const nextValue = selectedNonSoldoutOption.values[i];\n                    selected[type].push(nextValue);\n                });\n            } else {\n                // set first available multi option\n                option_meta.forEach(function (opt) {\n                    const { type } = opt;\n                    const nextValue = opt.values[0];\n                    selected[type].push(nextValue);\n                });\n            }\n        }\n        const multiOptionState = new MultiOptionState(options, option_meta);\n        return { selected, multiOptionState };\n    }\n\n    extractSaleOptionIDFromMultiOptionState = (selected?: SelectedMetaOption) => {\n        const {\n            thing: { sales },\n        } = this.props;\n        if (selected == null) {\n            selected = this.state.selected;\n        }\n        const { multiOptionState } = this.state;\n\n        const selectedOptionArray = multiOptionState.option_meta\n            .map((m) => {\n                const order = multiOptionState.orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            });\n        const selectedOption = _.find(sales.options, (opt) => selectedOptionArray.every((e, i) => e === opt.values[i]));\n        if (selectedOption) {\n            return selectedOption.id;\n        } else {\n            window.DEBUG &&\n                console.warn(\"no option found for \", selectedOptionArray, \"meta:\", sales.options, this.state.selected);\n        }\n    };\n\n    updateSaleOptionIDFromMultiOptionState = () => {\n        const { dispatch } = this.props;\n        let saleOptionID = this.extractSaleOptionIDFromMultiOptionState();\n        if (saleOptionID === undefined) {\n            const amendedID = this.amendSaleOptionFromMultiOptionState();\n            if (amendedID) {\n                saleOptionID = amendedID;\n            } else {\n                window.DEBUG && console.warn(\"Couldn't recover option\");\n            }\n        }\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    amendSaleOptionFromMultiOptionState = () => {\n        const { selected, multiOptionState } = this.state;\n        const nextSelected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        multiOptionState.option_meta.forEach(({ type, name }, index) => {\n            const order = multiOptionState.orderMap[type][name];\n            const selectedValue = selected[type][order];\n            if (index === 0) {\n                nextSelected[type][order] = selectedValue;\n                return;\n            }\n            const values = multiOptionState.getPossibleValuesForIndex(selected, index);\n            let value;\n            if (values.some((v) => v === selectedValue)) {\n                value = selectedValue;\n            } else {\n                value = values[0];\n            }\n            selected[type][order] = value; // even though it will be flushed out, it will affect next options so fix it as well\n            nextSelected[type][order] = value;\n        });\n        this.setState({ selected: nextSelected });\n        return this.extractSaleOptionIDFromMultiOptionState(nextSelected);\n    };\n\n    onClickMultiOptionGen = (type) => {\n        return (e) => {\n            const el = e.currentTarget;\n            let value;\n            let indexOfType;\n            if (el.tagName === \"SELECT\") {\n                value = el.value;\n                indexOfType = Number($(el).find(\":selected\").attr(\"data-index-typeof\"));\n            } else {\n                value = $(el).attr(\"data-value\");\n                indexOfType = Number($(el).attr(\"data-index-typeof\"));\n            }\n            if (e.currentTarget.className === \"disabled\") {\n                return;\n            }\n\n            this.state.selected[type][indexOfType] = value;\n            // forceful trigger even though no differences in value.\n            this.setState({ selected: _.extend({}, this.state.selected) }, this.updateSaleOptionIDFromMultiOptionState);\n        };\n    };\n\n    UNSAFE_componentWillReceiveProps(nextProps) {\n        const { saleContext } = this.props;\n        const nsc = nextProps.saleContext;\n        const priceChanges = saleContext.price !== nsc.price;\n        const currencyChanges = saleContext.currencyCode !== nsc.currencyCode;\n        if (priceChanges || currencyChanges) {\n            if (!currencyIsUSD(nextProps)) {\n                const { saleContext } = nextProps;\n                convertCurrency(saleContext.currencyCode, saleContext.price, true); // FIXME: unable to comparison since price update comes first (SaleItemSidebarHead.componentWillReceiveProps())\n            }\n        }\n    }\n\n    isOptionMulti(): boolean {\n        const {\n            thing: { sales },\n        } = this.props;\n        // sales.\n        if (sales.option_meta.length > 1) {\n            return true;\n        } else if (sales.option_meta.length === 1) {\n            return sales.option_meta[0].type !== \"dropdown\";\n        } else {\n            return false;\n        }\n    }\n\n    render() {\n        const {\n            thing,\n            thing: { sales },\n            appContext: { applePayDisplay },\n            saleContext,\n            saleContext: { currencyCode, currencySymbol, currencyMoney, selectedQuantity, price },\n        } = this.props;\n\n        var opt = getCurrentSaleOption(sales, saleContext) as SaleOption;\n        var discountPercentage = parseFloat(opt.discount_percentage); // TODO: use decimal?\n        var retailPrice = opt.retail_price;\n        const { soldout, quantity } = opt;\n        const { option_meta, available } = sales;\n        const optionIsMulti = this.isOptionMulti();\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n        const discounting = discountPercentage > 0;\n        const converted = currencySymbol != null && currencyMoney != null;\n        const currencyCodeStyle = { display: converted && !currencyIsUSD(this.props) ? \"block\" : \"none\" };\n        const quantitySelectRange = soldout\n            ? [\"1\"]\n            : _.range(1, Math.min(10, (quantity || 0) + 1));\n        const showSelectbox = sales.options.length !== 0;\n\n        var cartButtonStyle;\n        if (!soldout) {\n            cartButtonStyle = { display: \"none\" };\n        }\n        const waiting = getWaiting(sales, saleContext);\n\n        var applePayButton;\n        if (applePayDisplay && !soldout) {\n            applePayButton = <ApplePayButton {...this.props} />;\n        }\n\n        return (\n            <>\n                <h1 key={Keys.Sidebar.Title} className=\"title\" {...getSafeNameProp(thing)} />\n                <div className=\"price\" key={Keys.Sidebar.Price}>\n                    <big className={classnames({ sale: discounting })}>\n                        ${floatFormatMinusTwo(price)}\n                        {/* <small className=\"usd\">\n                            <a\n                                className={classnames(\"code\", { \"currently-usd\": currencyIsUSD(this.props) })}\n                                onClick={this.handleCurrencyPopupUSD}>\n                                USD\n                            </a>\n                        </small> */}\n                    </big>\n                    {discounting && (\n                        <span className=\"sales\">\n                            <em>${floatFormatMinusTwo(retailPrice)}</em> (Save {numberFormat(discountPercentage, 0)}\n                            %)\n                        </span>\n                    )}\n                    <span className=\"currency_price\" style={currencyCodeStyle}>\n                        {this.getApproxText()}\n                        <a className=\"code\" onClick={this.handleCurrencyPopup}>\n                            {currencyCode}\n                        </a>\n                    </span>\n                </div>\n                <div className=\"frm\" key={Keys.Sidebar.Form}>\n                    <fieldset className=\"sale-item-input\">\n                        {showSelectbox && !optionIsMulti && (\n                            <SelectBox\n                                className=\"multi-option\"\n                                id=\"option\"\n                                label={gettext(\"Option\")}\n                                currentValue={opt}\n                                value={optionValueFunction}\n                                printer={saleNamePrinter}\n                                options={sales.options}\n                                expander={SaleItemOptionsExpander}\n                                disabled={!salesOptionsAvailable}\n                                onChange={this.handleOptionChange}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                            />\n                        )}\n                        {optionIsMulti && (\n                            <MultiOption\n                                sid={sales.id}\n                                onClickThumbnail={this.onClickThumbnail}\n                                onClickSwatch={this.onClickSwatch}\n                                onMultiSelectBoxChange={this.onMultiSelectBoxChange}\n                                onClickMutliButton={this.onClickMutliButton}\n                                selected={this.state.selected}\n                                disabled={this.state.disabled}\n                                soldout={!!soldout}\n                                option_meta={option_meta}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                                multiOptionState={this.state.multiOptionState}\n                            />\n                        )}\n                        {sales.personalizable && (\n                            <div className=\"personalization\">\n                                <label>This item can be personalized:</label>\n                                <input\n                                    type=\"text\"\n                                    className=\"text\"\n                                    name=\"personalization\"\n                                    placeholder=\"Personalization details\"\n                                    onChange={this.handlePersonalizationChange}\n                                />\n                            </div>\n                        )}\n                        {\n                            <SelectBox\n                                id=\"quantity\"\n                                className=\"multi-option\"\n                                label={gettext(\"Quantity\")}\n                                defaultValue=\"1\"\n                                currentValue={selectedQuantity}\n                                options={quantitySelectRange}\n                                disabled={!!soldout}\n                                onChange={this.handleQuantityChange}\n                            />\n                        }\n                        {applePayButton}\n                        {available ? (\n                            <>\n                                <CartButton\n                                    onClick={this.handlePurchase}\n                                    className={classnames(\"add_to_cart btn-cart\", {\n                                        \"btn-create\": soldout,\n                                        \"btns-blue-embo\": !soldout,\n                                    })}\n                                    disabled={!!soldout}\n                                    label={soldout ? gettext(\"Sold out\") : gettext(\"Add to cart\")}\n                                />\n                                <CartButton\n                                    className={classnames(\"btn-create notify-available\", { subscribed: waiting })}\n                                    label={waiting ? gettext(\"Subscribed\") : gettext(\"Notify me when available\")}\n                                    style={cartButtonStyle}\n                                    onClick={this.handleNotifyLater}\n                                />\n                            </>\n                        ) : (\n                            <CartButton\n                                className={classnames(\"btn-create not-available\")}\n                                label={gettext(\"Not Available\")}\n                                disabled={true}\n                            />\n                        )}\n                    </fieldset>\n                </div>\n            </>\n        );\n    }\n}\n\nfunction SaleItemOptionsExpander(sio, idx) {\n    return (\n        <option value={sio.id} key={`sale_options-${idx}`}>\n            {sio.soldout === true || !(sio.quantity > 0) ? `${sio.name} - ${gettext(\"Sold out\")}` : sio.name}\n        </option>\n    );\n}\n\nclass ApplePayButton extends Component<OverlayProps> {\n    handleApplePayCheckout = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (window.FancyApplePay.clicked) {\n            return;\n        }\n        window.FancyApplePay.clicked = true;\n        const {\n            appContext: { /*applePayDisplay, */ applePayTest },\n        } = this.props;\n        const {\n            thing,\n            thing: { sales },\n            saleContext: { saleOptionID, selectedQuantity, price },\n        } = this.props;\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n\n        var title = thing.name;\n        var country = sales.seller.country;\n        var sale_item_id = sales.id;\n        var seller_id = sales.seller.id;\n        var quantity = selectedQuantity;\n\n        var option_id = null;\n        var option = null;\n        if (salesOptionsAvailable) {\n            option_id = parseInt(saleOptionID, 10) || null; // ? should be same value with option except get casted\n            option = saleOptionID;\n        }\n\n        try {\n            window.FancyApplePay.requestPurchase(\"Dynamic\", {\n                sale_item_id,\n                seller_id,\n                option_id,\n                quantity,\n                price,\n                title,\n                option,\n                country,\n                testmode: applePayTest,\n            });\n        } catch (err) {\n            window.DEBUG && console.trace(err);\n            alert(err);\n            window.FancyApplePay.clicked = false;\n        }\n    };\n\n    render() {\n        return (\n            <div\n                className=\"applePayButton\"\n                style={{\n                    WebkitAppearance: \"-apple-pay-button\",\n                    ApplePayButtonType: \"plain\",\n                    ApplePayButtonStyle: \"black\",\n                }}\n                onClick={this.handleApplePayCheckout}></div>\n        );\n    }\n}\n","import React from \"react\";\nimport SaleItem from \"./SaleItem\";\n\nimport { useFancy } from \"../FancyContext\";\n\nconst Info = () => {\n    const fancyProps = useFancy();\n    const { thing, thing: { reviews, sales }, fancyContext } = fancyProps;\n    const r = reviews.summary;\n\n    return (\n        <div className=\"figure-info\">\n            <div className=\"vendor\"><a href={sales.seller.shop_url}>{sales.seller.brand_name}</a></div>\n            {r.total_ratings > 0 && (\n                <div className=\"review-points\">\n                    <span style={{ cursor: r.total_reviews > 0 ? \"pointer\" : undefined }} onClick={() => {\n                        if (r.total_reviews > 0) {\n                            const $el = $(\".review-section\");\n                            const headerSize = parseInt($(\".container\").css(\"padding-top\")) || 0;\n                            if ($el.length) {\n                                $(window).scrollTop($el[0].offsetTop - headerSize);\n                            }\n                        }\n                    }}>\n                        {r.rating_avg} <small className=\"count\">({r.total_ratings} rating{r.total_ratings != 1 ? 's' : ''})</small>{\" \"}\n                    </span>\n                </div>\n            )}\n            <span className=\"_fancyd fancyd_user\">{fancyContext.fancyd_count} people favorited</span>\n            <SaleItem {...fancyProps} />\n        </div>\n    );\n};\n\nexport default Info;\n","import React, { useEffect, useState, useRef } from \"react\";\nimport cx from \"classnames\";\n\nimport { useFancy } from \"../FancyContext\";\n\nconst Overview = () => {\n    const { thing } = useFancy();\n    const sales = thing.sales;\n    const bv = sales.seller.brand_values;\n    const shippingInfo: { [k: string]: any } = sales.shipping_info || {};\n\n    return (\n        <div className=\"overview\">\n            <dl className=\"shipping optional\">\n                <dt>Shipping Information</dt>\n                <dd>\n                    <ul>\n                        <li className=\"from\">\n                            <span>{shippingInfo.origin}</span>\n                        </li>\n                        {shippingInfo.cost && (\n                            <li className=\"cost\">\n                                <span>{shippingInfo.cost}</span>\n                            </li>\n                        )}\n                        {shippingInfo.window && (\n                            <li className=\"days\">\n                                <span>{shippingInfo.window}</span>\n                            </li>\n                        )}\n                    </ul>\n                </dd>\n            </dl>\n            {bv.length > 0 ? (\n                <dl className=\"brand-value optional\">\n                    <dt>Buy with Confidence</dt>\n                    <dd>\n                        {bv.slice(0,3).map(([className, text]) => (\n                            <span key={className} className={`badge ${className}`}>{text}</span>\n                        ))}\n                    </dd>\n                </dl>\n            ) : null}\n        </div>\n    );\n};\n\nconst Description = () => {\n    const [menu, setMenu] = useState<\"features\" | \"specification\" | \"returns\">(\"features\");\n    const [showMore, setShowMore] = useState(false);\n    const descEl = useRef<HTMLDivElement>(null);\n    const props = useFancy();\n    const { thing, thing: { sales } } = props;\n    const showFeatures = !!(sales.features && sales.features.trim());\n    const showSpecs = !!(sales.specifications && sales.specifications.trim());\n    const showReturns =\n        !!(sales.return_exchange_policy_title && sales.return_exchange_policy_title.trim()) ||\n        !!(sales.shipping_policy && sales.shipping_policy.trim());\n    \n    useEffect(() => {\n        if (showFeatures) {\n            setMenu('features');\n        } else if (showSpecs) {\n            setMenu('specification');\n        } else if (showReturns) {\n            setMenu('returns');\n        }\n        setShowMore(descEl.current ? descEl.current.clientHeight <= 76 : false);\n    }, [thing.id]);\n\n    return (\n        <div className=\"detail\">\n            <dl className={cx(\"description optional\")}>\n                <dt>Description</dt>                \n                <dd className={cx({ collapsed: !showMore })}>\n                    <div dangerouslySetInnerHTML={{ __html: sales.description }} ref={descEl}/>\n                </dd> \n                <a className=\"more\" onClick={() => setShowMore(true)} style={{display: showMore ? 'none' : undefined }}>Read more</a>\n            </dl>\n            <div className=\"features-menu\">\n                {showFeatures && (\n                    <a\n                        className={cx({ current: menu === \"features\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"features\");\n                        }}>\n                        Features\n                    </a>\n                )}\n                {showSpecs && (\n                    <a\n                        className={cx({ current: menu === \"specification\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"specification\");\n                        }}>\n                        Specifications\n                    </a>\n                )}\n                {showReturns && (\n                    <a\n                        className={cx({ current: menu === \"returns\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"returns\");\n                        }}>\n                        Returns\n                    </a>\n                )}\n            </div>\n            {showFeatures && (\n                <dl className={cx(\"features optional\", { show: menu === \"features\" })} data-featuretype=\"features\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"features\");\n                            }}>\n                            Features\n                        </a>\n                    </dt>\n                    <dd dangerouslySetInnerHTML={{ __html: sales.features }} />\n                </dl>\n            )}\n            {showSpecs && (\n                <dl\n                    className={cx(\"features optional\", { show: menu === \"specification\" })}\n                    data-featuretype=\"specifications\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"specification\");\n                            }}>\n                            Specifications\n                        </a>\n                    </dt>\n                    <dt></dt>\n                    <dd dangerouslySetInnerHTML={{ __html: sales.specifications }} />\n                </dl>\n            )}\n            {showReturns && (\n                <dl className={cx(\"features optional\", { show: menu === \"returns\" })} data-featuretype=\"returns\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"returns\");\n                            }}>\n                            Returns\n                        </a>\n                    </dt>\n                    <dd><p>{sales.return_exchange_policy_title}</p><p>{sales.shipping_policy}</p></dd>\n                </dl>\n            )}\n        </div>\n    );\n};\n\nconst Detail = () => {\n    return (\n        <div className=\"figure-detail\">\n            <Overview />\n            <Description />\n        </div>\n    );\n};\n\nexport default Detail;\n","import React from \"react\";\n\nimport Image from \"./Image\";\nimport Info from \"./Info\";\nimport Detail from \"./Detail\";\n\nconst Thing = () => {\n    return (\n        <div className=\"wrapper-content\">\n            <Image />\n            <Info />\n            <Detail />\n        </div>\n    );\n};\n\nexport default Thing;\n","import React from \"react\";\nimport { numberFormat } from \"fancyutils\";\n\nexport interface ThingCardProps {\n    brand_name: string;\n    title: string;\n    html_url: string;\n    image_url: string;\n    max_price: number;\n    min_price: number;\n}\n\nexport default function ThingCard({ brand_name, title, html_url, image_url, max_price, min_price }: ThingCardProps) {\n    let p = <>${numberFormat(min_price, 0)}</>;\n    if (max_price !== min_price) {\n        p = (\n            <>\n                <em className=\"from\">from </em> ${numberFormat(min_price, 0)}\n            </>\n        );\n    }\n\n    return (\n        <div className=\"figure-item new\">\n            <figure>\n                <a href={html_url}>\n                    <span className=\"figure\" style={{ backgroundImage: `url(${image_url})` }}>\n                        <img\n                            src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n                            style={{ backgroundImage: `url(${image_url})` }}\n                        />\n                    </span>\n                </a>\n            </figure>\n            <figcaption>\n                <a href={html_url}>\n                    <span className=\"category\">{brand_name}</span>\n                    <b className=\"title\">{title}</b>\n                    <span className=\"price\">{p}</span>\n                </a>\n            </figcaption>\n        </div>\n    );\n}\n","import React, { useState, useRef, useEffect } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\n\nimport ThingCard from \"./ThingCard\";\nimport { useFancy } from \"./FancyContext\";\n\nconst MerchantInfo = () => {\n    const {\n        thing,\n        thing: {\n            sales: { seller },\n        },\n    } = useFancy();\n    const [showMore, setShowMore] = useState(false);\n    const descEl = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        setShowMore(descEl.current ? descEl.current.clientHeight <= 80 : false);\n    }, [thing.id]);\n\n    return (\n        <div className=\"merchant-info\">\n            <h2 className=\"stit\">More about {seller.brand_name}</h2>\n            <div className={classnames(\"description\", { collapsed: !showMore })}>\n                <div dangerouslySetInnerHTML={{ __html: seller.description }} ref={descEl} />\n            </div>\n            <a className=\"more\" style={{ display: showMore ? \"none\" : undefined }} onClick={() => setShowMore(true)}>\n                Read more\n            </a>\n            <a className=\"btns-blue-embo\" href={seller.shop_url}>\n                Explore more\n            </a>\n            <Swiper className=\"swiper-no-swiping\">\n                {seller.sale_items.map((item, i) => {\n                    return (\n                        <SwiperSlide key={i} tag=\"li\">\n                            <ThingCard {...item} brand_name={seller.brand_name} />\n                        </SwiperSlide>\n                    );\n                })}\n            </Swiper>\n        </div>\n    );\n};\n\nexport default MerchantInfo;\n","import React, { useEffect, useState } from \"react\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\n\nimport ThingCard, { ThingCardProps } from \"./ThingCard\";\nimport { useFancy } from \"./FancyContext\";\n\nconst Recommendation = () => {\n    return (\n        <>\n            <Likeable />\n            <RecentlyViewed />\n        </>\n    );\n};\n\nconst convertThingsV1 = (things: {\n    url: string;\n    thumb_image_url_558: string;\n    sales: {\n        max_price: number;\n        min_price: number;\n        seller: {\n            brand_name: string;\n        };\n        title: string;\n    }[];\n    name: string;\n}[]) => {\n    return things.map(({ url: html_url, thumb_image_url_558: image_url, sales, name }) => {\n        return {\n            html_url,\n            image_url,\n            max_price: sales ? sales[0].max_price : 0,\n            min_price: sales ? sales[0].min_price : 0,\n            brand_name: sales ? sales[0].seller.brand_name : '',\n            title: sales ? sales[0].title : name,\n        };\n    });\n};\n\nconst Likeable = () => {\n    const { thing: { recommended } } = useFancy();\n\n    return (recommended?.length > 0) ? (\n        <>\n            <div className=\"recommend similar\">\n                <h2 className=\"stit\">You May Also Like</h2>\n                {/*<div className=\"control\">\n                    <div\n                        onClick={() => {\n                            setOffset(Math.max(5, offset - 5));\n                        }}>\n                        {\"<\"}\n                    </div>\n                    <div\n                        onClick={() => {\n                            setOffset(Math.min(offset + 5, ((things.length / 5) | 0) * 5));\n                        }}>\n                        {\">\"}\n                    </div>\n                </div>*/}\n            </div>\n            <Swiper className=\"recommend similar swiper-no-swiping\" slidesPerColumn={5}>\n                {recommended?.map((thing, i) => {\n                              return (\n                                  <SwiperSlide key={i}>\n                                      <ThingCard {...thing} />\n                                  </SwiperSlide>\n                              );\n                          })}\n            </Swiper>\n        </>\n    ) : null;\n};\n\nconst RecentlyViewed = () => {\n    const { thing } = useFancy();\n    const [things, setThings] = useState<ThingCardProps[] | null>(null);\n    // const [offset, setOffset] = useState(4);\n    const offset = 4;\n\n    useEffect(() => {\n        $.ajax({\n            type: \"get\",\n            url: `/recently_viewed_things_json?include_sale_item_option=True&rapi_compl=True&count=4&thing_id=${thing.id}`,\n        }).then((response) => {\n            const recently = convertThingsV1(response);\n            setThings(recently);\n        });\n    }, []);\n\n    return (\n        <>\n            <div className=\"recommend recently\">\n                <h2 className=\"stit\">Recently Viewed</h2>\n                {/*<div className=\"control\" style=\"display:none;\">\n                    <div\n                        onClick={() => {\n                            setOffset(Math.max(4, offset - 4));\n                        }}>\n                        {\"<\"}\n                    </div>\n                    <div\n                        onClick={() => {\n                            setOffset(Math.min(offset + 4, ((things.length / 4) | 0) * 4));\n                        }}>\n                        {\">\"}\n                    </div>\n                </div>*/}\n            </div>\n            <Swiper className=\"recommend recently swiper-no-swiping\" slidesPerColumn={4}>\n                {things\n                    ? things\n                          .filter((_, i) => {\n                              if (offset > 4) {\n                                  return i >= offset - 4 && i < offset;\n                              }\n                              return i < offset;\n                          })\n                          .map((thing, i) => {\n                              return (\n                                  <SwiperSlide key={i}>\n                                      <ThingCard {...thing} />\n                                  </SwiperSlide>\n                              );\n                          })\n                    : null}\n            </Swiper>\n        </>\n    );\n};\n\nexport default Recommendation;\n","import cx from \"classnames\";\nimport React, { Dispatch, SetStateAction, useEffect, useState } from \"react\";\nimport SwiperCore, { Thumbs } from \"swiper\";\nimport Lightbox from \"react-image-lightbox\";\nimport { debounceEventUntilTimeout } from \"fancyutils\";\n\nimport { useFancy } from \"./FancyContext\";\nimport type { ReviewEntry as ReviewEntryType, Reviews as ReviewsType } from \"ftypes\";\n\nSwiperCore.use([Thumbs]);\n\ninterface ReviewParams {\n    page?: number;\n    per_page?: number;\n    q?: string;\n    sort?: \"newest\" | \"rating_desc\" | \"rating_asc\";\n    setLoading?: Dispatch<SetStateAction<boolean>>;\n}\n\nfunction useDefaultReviews({ page, per_page, q, sort, setLoading }: ReviewParams) {\n    const { thing } = useFancy();\n    const {\n        sales: { id: sid },\n    } = thing;\n\n    const skip = !sort && !per_page && (!page || page === 1) && !q;\n    const reviews = useReviews({ skip, sid, page, per_page, q, sort, setLoading });\n    if (skip) {\n        return thing.reviews;\n    } else {\n        return reviews;\n    }\n}\n\nfunction useReviews({\n    skip = false,\n    sid,\n    page,\n    per_page,\n    q,\n    sort,\n    setLoading,\n}: ReviewParams & { skip: boolean; sid: number }) {\n    const [reviews, setReviews] = useState(null);\n    const param = $.extend({}, { q, page, per_page, sort });\n\n    useEffect(() => {\n        if (skip) {\n            return;\n        }\n        setLoading?.(true);\n        $.get(`/rest-api/v2/reviews/saleitem/${sid}`, param)\n            .then((res) => {\n                setReviews(res);\n            })\n            .always(() => {\n                setLoading?.(false);\n            });\n    }, [skip, sid, q, page, per_page, sort]);\n\n    return reviews;\n}\n\nconst Reviews = () => {\n    const [loading, setLoading] = useState(false);\n    const [reviewOption, setReviewOption] = useState({\n        page: undefined,\n        per_page: undefined,\n        q: undefined,\n        sort: undefined,\n    });\n\n    const reviews = useDefaultReviews({ ...reviewOption, setLoading });\n\n    if (reviewOption.q === undefined && (!reviews || reviews.review_count === 0)) {\n        return null;\n    }\n\n    return (\n        <div className={cx(\"review-points review-section\", { loading })}>\n            <ReviewHead reviews={reviews} />\n            <ReviewList\n                reviews={reviews}\n                reviewOption={reviewOption}\n                setReviewOption={(applying) => {\n                    setReviewOption({ ...reviewOption, ...applying });\n                }}\n            />\n        </div>\n    );\n};\n\nconst ReviewHead = ({ reviews } : { reviews: ReviewsType }) => {\n    return (\n        <>\n            <h3 className=\"stit\">\n                {reviews.summary.rating_avg}{\" \"}\n                <small className=\"count\">\n                    ({reviews.summary.total_ratings} rating{reviews.summary.total_ratings != 1 ? \"s\" : \"\"})\n                </small>\n            </h3>\n            <ul className=\"optional\">\n                {reviews.summary.attributes.map((a, i) => {\n                    return (\n                        <li key={i}>\n                            <label>{a.label}</label>\n                            <span className=\"review-range\">\n                                <i className=\"review-range-value\" style={{ width: `${Number(a.rating) * 20}%` }}></i>\n                            </span>\n                            <b>{a.rating}</b>\n                        </li>\n                    );\n                })}\n            </ul>\n            {/* <div className=\"btn-area\">\n                <button className=\"btns-blue-embo btn-review\">Write a Review</button>\n            </div> */}\n        </>\n    );\n};\n\nconst ReviewEntry = ({ review } : { review: ReviewEntryType }) => {\n    const [photoIndex, setPhotoIndex] = useState<number | null>(null);\n\n    return (\n        <li>\n            <small className=\"date\">{review.date}</small>\n            <span className={\"review-range \" + \"point\" + (review.rating | 0)}>\n                <span className=\"bg\"></span>\n                <i className=\"review-range-value\">\n                    <span></span>\n                </i>\n            </span>\n            <span className=\"username\">{review.name}</span>{\" \"}\n            <span className=\"verified\">\n                <em>Verified User</em>\n            </span>\n            <b className=\"title\">{review.title}</b>\n            <span className=\"description\">{review.review}</span>\n            <div>\n                {review.images.map((image, i) => {\n                    return (\n                        <div className=\"photo\" key={i}>\n                            <img\n                                onClick={() => {\n                                    setPhotoIndex(i);\n                                }}\n                                alt=\"review image\"\n                                src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n                                style={{\n                                    backgroundImage: `url('${image.thumbnail_url}')`,\n                                }}\n                            />\n                        </div>\n                    );\n                })}\n                {photoIndex !== null && (\n                    <Lightbox\n                        mainSrc={review.images[photoIndex].image_url}\n                        nextSrc={review.images[(photoIndex + 1) % review.images.length].image_url}\n                        prevSrc={\n                            review.images[(photoIndex + review.images.length - 1) % review.images.length].image_url\n                        }\n                        onCloseRequest={() => setPhotoIndex(null)}\n                        onMovePrevRequest={() =>\n                            setPhotoIndex((photoIndex + review.images.length - 1) % review.images.length)\n                        }\n                        onMoveNextRequest={() => setPhotoIndex((photoIndex + 1) % review.images.length)}\n                    />\n                )}\n            </div>\n        </li>\n    );\n};\n\nconst ReviewList = ({ reviews, reviewOption, setReviewOption } : { reviews: ReviewsType }) => {\n    const currentPage = reviewOption.page || 1;\n    return (\n        <>\n            <fieldset className=\"search\">\n                <label>Filter reviews</label>\n                <input\n                    type=\"text\"\n                    placeholder=\"Search topics and reviews\"\n                    className=\"text\"\n                    onChange={debounceEventUntilTimeout((e) => {\n                        setReviewOption({ q: e.target.value });\n                    }, 500)}\n                />\n                <span className=\"sort\">\n                    <label>Sort By:</label>\n                    <select\n                        onChange={({ target }) => {\n                            setReviewOption({ sort: target.value });\n                        }}>\n                        <option value=\"newest\">Most Recent</option>\n                        <option value=\"rating_desc\">Highest Rated</option>\n                        <option value=\"rating_asc\">Lowest Rated</option>\n                    </select>\n                </span>\n            </fieldset>\n            <ul className=\"review-list\">\n                {reviews.reviews.length > 0 ? (\n                    reviews.reviews.map((review, i) => <ReviewEntry key={i} review={review} />)\n                ) : (\n                    <li className=\"no-review\">There is no review matching your request. Please try another option.</li>\n                )}\n            </ul>\n            <div className=\"review-pagination\">\n                {currentPage > 1 && (\n                    <>\n                        <a href=\"#\" className=\"more\">\n                            See more reviews\n                        </a>\n                        <a\n                            className=\"prev\"\n                            onClick={() => {\n                                setReviewOption({ page: Math.max(1, currentPage - 1) });\n                            }}>\n                            Prev\n                        </a>\n                    </>\n                )}\n                {currentPage < reviews.total_pages && (\n                    <a\n                        className=\"next\"\n                        onClick={() => {\n                            setReviewOption({ page: Math.min(currentPage + 1, reviews.total_pages) });\n                        }}>\n                        Next\n                    </a>\n                )}\n                {_.range(1, reviews.total_pages + 1).map((pageNum, i) => (\n                    <a\n                        key={i}\n                        onClick={() => {\n                            setReviewOption({ page: pageNum });\n                        }}\n                        className={currentPage === pageNum ? \"current\" : undefined}>\n                        {pageNum}\n                    </a>\n                ))}\n            </div>\n        </>\n    );\n};\n\nexport default Reviews;\n","import React, { Component, Suspense } from \"react\";\nimport { connect } from \"react-redux\";\nimport { isStaticPage } from \"fancyutils\";\n\nimport Thing from \"./Thing\";\nimport MerchantInfo from \"./MerchantInfo\";\nimport Recommendation from \"./Recommendation\";\nimport Reviews from \"./Reviews\";\n\nimport { historyData } from \"../../container/history\";\nimport { updateSaleContext } from \"../../action/action-helpers\";\nimport store from \"../../store/store\";\nimport FancyContext, { getFancyContextDefaultValue, useFancy } from \"./FancyContext\";\n\nimport { OverlayPropsV1 } from \"ftypes\";\nimport { mapStateToThingProps } from \"../map\";\n\nfunction AdminMessages() {\n    const {\n        thing,\n    } = useFancy();\n\n    if (!thing.messages) {\n        return null;\n    }\n\n    return (\n        <div className=\"warning\">\n            <span>This item is not visible to customers because:</span>\n            <ul>\n                {thing.messages.map((m, i) => (\n                    <li key={i}>{m}</li>\n                ))}\n            </ul>\n        </div>\n    );\n}\n\nfunction BreadCrumb() {\n    const { thing } = useFancy();\n\n    return (\n        <div className=\"breadcrumb\">\n            {thing.breadcrumbs.map(({ label, href }, i) => (\n                <React.Fragment key={i}>\n                    <a href={href}>{label}</a>{\" \"}\n                    {i !== thing.breadcrumbs.length - 1 ? (\n                        <>\n                            <span className=\"arrow\">&gt;</span>{\" \"}\n                        </>\n                    ) : null}\n                </React.Fragment>\n            ))}\n        </div>\n    );\n}\n\nfunction AdminSidebar(props: OverlayPropsV1) {\n    const {\n        appContext: { viewer },\n        thing,\n    } = props;\n\n    let admin = null;\n\n    let AdminComponent = null;\n    //if (viewer.is_admin_any) {\n    //    AdminComponent = lazy(() => import(/* webpackChunkName: \"OverlayThing.admin\" */ \"../Admin\"));\n    //}\n\n    if (AdminComponent) {\n        admin = (\n            <Suspense fallback={<div />}>\n                <AdminComponent {...props} fallback={<div />} />\n            </Suspense>\n        );\n    }\n\n    return admin;\n}\n\nclass AppV2 extends Component<OverlayPropsV1> {\n    componentDidUpdate(prevProps: OverlayPropsV1) {\n        const pt = prevProps.thing;\n        const ct = this.props.thing;\n\n        if (ct != null) {\n            if (!pt || pt.id !== ct.id) {\n                if (isStaticPage()) {\n                    $(window).scrollTop(0);\n                } else {\n                    $(\"#overlay-thing > .popup\").attr(\"tabindex\", -1).focus();\n                }\n\n                if (ct.sales && ct.sales.options && ct.sales.options.length > 1) {\n                    const nonSoldoutOptions = ct.sales.options.filter((o) => !o.soldout);\n                    let minimumOption;\n                    if (nonSoldoutOptions.length > 0) {\n                        minimumOption = _.min(nonSoldoutOptions, (o) => Number(o.price));\n                    } else {\n                        minimumOption = _.min(ct.sales.options, (o) => Number(o.price));\n                    }\n                    if (ct.sales.options[0].id !== minimumOption.id) {\n                        store.dispatch(updateSaleContext({ saleOptionID: minimumOption.id }));\n                    }\n                }\n            }\n        }\n    }\n\n    getFancyContext() {\n        return this.props.thing ? this.props : getFancyContextDefaultValue();\n    }\n\n    render() {\n        const { thing } = this.props;\n\n        if (historyData.locationIsThingPage && thing != null) {\n            return (\n                <FancyContext.Provider value={this.getFancyContext()}>\n                    <AdminMessages />\n                    <BreadCrumb />\n                    <Thing />\n                    <Reviews />\n                    <MerchantInfo />\n                    <Recommendation />\n                    <AdminSidebar {...this.props} />\n                </FancyContext.Provider>\n            );\n        } else {\n            return <div />;\n        }\n    }\n}\n\nconst ReduxComponentEnhancer = connect<OverlayPropsV1>(mapStateToThingProps);\nconst Overlay = ReduxComponentEnhancer(AppV2);\n\nexport default Overlay;\n","// SaleItem#get_status\nexport const salesStatus = {\n    EXPIRED: 'Expired',\n    REMOVED: 'Deleted',\n    PENDING: 'Pending',\n    COMING_SOON: 'Coming soon',\n    ACTIVE: 'Active',\n    SOLD_OUT: 'Sold out'\n};\n\nexport const FancyStatus = {\n    Addition: 'Addition',\n    Removal: 'Removal',\n    AfterAddition: 'AfterAddition',\n    AfterRemoval: 'AfterRemoval',\n    Idle: 'Idle',\n};\n\nexport const textareaHeight = {\n    collapsed: 20,\n    expanded: 40\n};\n\nconst commonWrapperSelector = '#container-wrapper .wrapper-content #content';\nexport const Selectors = {\n    HomepageWrapper: commonWrapperSelector,\n};\n\nconst zoomMargin = 125;\nexport const ThingViewConfig = {\n    boundarySize: 640,\n    zoomMargin,                  // zoom box size 250 (246 + 2 + 2) / 2\n    zoomBoxSize: zoomMargin * 2, // zoom box size 250 (246 + 2 + 2) / 2\n    zoomScale: 1.5,\n};\n\nexport const StaticThingViewConfig = {\n    ThumbnailsLimit: {\n        Basic: 18,\n        More: 200,\n    },\n}\n","import { KEYS, didClickOn, eitherFancy, getObjectTypeFromUrl, getPathname, isPlainLeftClick, isStream } from 'fancyutils';\n\nimport store from '../store/store';\nimport { Selectors } from '../config';\nimport { LinkTypes, transition, pagingContext } from './routeutils';\nimport { closeOverlay } from '../action/action-helpers';\n\n\nfunction handleOverlayThingKeyEvents(event) {\n    if (event.target.tagName === 'TEXTAREA' ||\n        event.target.tagName === 'INPUT') {\n        return;\n    }\n\n    switch (event.which) {\n    case KEYS.LEFT:\n        pagingContext.movePrev();\n        break;\n    case KEYS.RIGHT:\n        pagingContext.moveNext();\n        break;\n    case KEYS.ESC:\n        // If popup is not on\n        if ($('#popup_container:visible').length === 0) {\n            store.dispatch(closeOverlay());\n        }\n        break;\n    }\n}\n\nfunction conditionalTransition(aElement) {\n    // Turn off video\n    $('#container-wrapper .btn-pause').attr('scroll',true).click();\n    // Ensure anchor is static (sticked to homepage timeline) or not.\n    if (isStream() && $(Selectors.HomepageWrapper).has(aElement)) {\n        transition(aElement.getAttribute('href'), LinkTypes.Static);\n    } else {\n        transition(aElement.getAttribute('href'));\n    }\n}\n\nvar oneshotEventAttached = false;\nexport function attachEntryEvents() {\n    if (oneshotEventAttached) {\n        return;\n    }\n    oneshotEventAttached = true;\n    // Remove pre-existing url event and start transition first\n    $(document.body).off('click.overlayThingInit');\n    if (window.__INIT_THING_ANCHOR != null) {\n        conditionalTransition(window.__INIT_THING_ANCHOR);\n        delete window.__INIT_THING_ANCHOR;\n    }\n    // TODO: replace to class-based event binding\n    $(document.body)\n        .on('click', 'a', function(event) {\n            if (isPlainLeftClick(event) &&\n                this.getAttribute('data-prevent-overlay') == null &&\n                getObjectTypeFromUrl(getPathname(this)) === 'Thing'\n            ) {\n                event.preventDefault();\n                // note: key event will be detached inside `closeOverlay()` call\n                $(document).on('keydown.overlayThing', handleOverlayThingKeyEvents);\n                conditionalTransition(this);\n            }\n        });\n\n    $('#overlay-thing').on('click', '.popup.overlay-thing', function(event) {\n        const $targ = $(event.target);\n        // Center container\n        if (didClickOn($targ, '.sidebar') ||\n            didClickOn($targ, '.thing-detail-container .content') ||\n            didClickOn($targ, '.thing-detail-container .timeline') ||\n            eitherFancy('Admin', ({ sharedState }) => sharedState.draggingAdmin)) {\n            // pass\n        // prev button\n        } else if (didClickOn($targ, '.popup_prev')) {\n            pagingContext.movePrev();\n            return false;\n        // next button\n        } else if (didClickOn($targ, '.popup_next')) {\n            pagingContext.moveNext();\n            return false;\n        } else {\n            store.dispatch(closeOverlay());\n        }\n    });\n}\n\nexport const OtContainer = {\n    isStaticCache: undefined,\n    isStatic() {\n        if (this.isStaticCache === undefined) {\n            this.isStaticCache = $(document.body).is('.static-ot');\n        }\n        return this.isStaticCache;\n    },\n    getDynamic() {\n        return $('#overlay-thing .thing-detail');\n    },\n    getStatic() {\n        return $(document);\n    },\n    get() {\n        return this.isStatic() ? this.getStatic() : this.getDynamic();\n    },\n    scrollToTop() {\n        if (this.isStatic()) {\n            $(document.body.parentElement).scrollTop(0);\n        } else {\n            $('#overlay-thing').scrollTop(0);\n        }\n    },\n}\nwindow.OtContainer = OtContainer;\n\n// Only one event is allowed\nexport const scrollEvent = {\n    handleScroll: null,\n    attach(func, prepare) {\n        if (scrollEvent.handleScroll != null) {\n            scrollEvent.detach();\n        }\n        const _prepare = prepare != null ? prepare : 10;\n        \n        const handleScroll = _.throttle(function() {\n            if (OtContainer.isStatic()) {\n                const viewportHeight = document.documentElement.clientHeight;\n                if (scrollEvent.visible === true) {\n                    // console.debug('$(window).height() - $(window).scrollTop() - _prepare <= viewportHeight', $(window).height(), $(window).scrollTop(), _prepare, viewportHeight, $(window).height() - $(window).scrollTop() - _prepare <= viewportHeight)\n                    if (document.documentElement.scrollHeight - $(window).scrollTop() - _prepare <= viewportHeight) {\n                        func(true);\n                    }\n                }\n            } else {\n                const el = this;\n                const viewportHeight = el.clientHeight;\n                if (scrollEvent.visible === true) {\n                    if (el.scrollHeight - el.scrollTop - _prepare <= viewportHeight) {\n                        func(true);\n                    }\n                }\n            }\n        }, 50);\n        this.handleScroll = handleScroll;\n\n        const containerEl = OtContainer.isStatic() ? OtContainer.get().get(0) : $('#overlay-thing').get(0);\n        containerEl.addEventListener('scroll', handleScroll, { passive: true });\n        handleScroll();\n    },\n\n    detach() {\n        const containerEl = OtContainer.get().get(0);\n        containerEl.removeEventListener('scroll', this.handleScroll);\n    },\n    visible: false // copied variable on `state.appContext.visible` change\n};\n","import { extractMetaFromURL } from 'fancyutils';\nimport { history } from 'common-components';\n\nimport store from '../store/store';\nimport { closeOverlay, fetchThing } from '../action/action-helpers';\n\n\nconst initialThingPageID = extractMetaFromURL(location.pathname).id;\nconst initialPageIsThingPage = initialThingPageID != null;\n\n// This stores initial static page history info that needs to be restored when modal get closed.\nexport const historyData = {\n    initialPath: location.pathname,\n    /* mut */preservedHref: location.href, // Preserved Href just before open, and to be returned when closed.\n    initialThingPageID,\n    initialPageIsThingPage,\n    initialTitle: document.title,\n    // This prop indicates current location is (static) thing page. Mutable.\n    locationIsThingPage: initialPageIsThingPage,\n    overlayIsOn: false,\n};\n\n/*\nfunction isInitialPath() {\n    return historyData.initialPath === location.pathname;\n}\n*/\nfunction runOverlay(thingID, thingURLType, killCache = false, queryString) {\n    // Context needs to be isolated from hook: https://github.com/rackt/redux-router/issues/157\n    if (!$(document.body).hasClass('error-page')) {\n        requestIdleCallback(() => {\n            $(document.body).addClass('thing-overlay-on');\n            store.dispatch(fetchThing(thingID, thingURLType, killCache, false, queryString));\n            historyData.overlayIsOn = true;\n            //EE.emit('overlay-on');\n        });\n    }\n}\n\nfunction stopOverlay() {\n    historyData.overlayIsOn = false;\n    store.dispatch(closeOverlay());\n}\n\nexport function reloadCurrentThing() {\n    const meta = extractMetaFromURL(location.href);\n    const thingID = meta && meta.id;\n    if (thingID != null && historyData.overlayIsOn) {\n        runOverlay(thingID, meta.type, true);\n    }\n}\n\nexport function historyHook({ pathname, search /*, action*/ }) {\n    const meta = extractMetaFromURL(pathname);\n    const thingID = meta && meta.id;\n    // When initially (statically) renderred page is thing page\n    // Moving to new thing page\n    historyData.locationIsThingPage = thingID != null;\n    if (historyData.locationIsThingPage) {\n        runOverlay(thingID, meta.type, false, search);\n    } else if (historyData.overlayIsOn) {\n        stopOverlay();\n    }\n}\n\nhistory.listen(historyHook)\n","import { extractMetaFromURL, getObjectTypeFromUrl, isStaticPage, stripPathname } from \"fancyutils\";\n\nimport { historyData } from \"./history\";\nimport { history } from 'common-components';\nexport const LinkTypes = {\n    Dynamic: 0,\n    Static: 1,\n    Timeline: 2,\n    Internal: 3 // no update needed\n};\n\n// `staticLink`: transition from statically attached links\nexport function transition(href, linkType = LinkTypes.Dynamic) {\n    // ID-only\n    if (!_.isNaN(Number(href))) {\n        href = `/things/${href}`;\n    }\n\n    if (getObjectTypeFromUrl(href) === \"Thing\") {\n        const meta = extractMetaFromURL(href);\n        // Update URL to go back when overlay is closed\n        if (!historyData.overlayIsOn) {\n            historyData.preservedHref = location.href;\n        }\n        history.push(stripPathname(meta.href), null);\n    } else {\n        redirect(href);\n    }\n}\n\nexport function closeModal() {\n    if (isStaticPage()) {\n        return;\n    }\n    $(document.body).removeClass(\"thing-overlay-on\"); // FIXME: isolate modal logic\n}\n\n// NOOP\nexport const pagingContext = {\n    init() {},\n    movePrev() {},\n    moveNext() {}\n}\n\nexport function redirect(destination) {\n    if (destination == null) {\n        return false;\n    } else {\n        location.href = destination;\n        return true;\n    }\n}\n\nfunction getUtm() {\n    const $nav = $('.navigation')\n    if ($nav.length > 0) {\n        if ($nav.find('a.current[data-feed=\"featured\"]').length > 0) {\n            return \"timeline_featured\";\n        } else if ($nav.find('a.current[data-feed=\"recommended\"]').length > 0) {\n            return \"timeline_recommended\";\n        } else {\n            const $shopLink = $nav.find('.shop li a');\n            if ($shopLink.eq(0).is('.current')) {\n                return \"shop\";\n            } else if ($shopLink.eq(1).is('.current')) {\n                return \"\";\n            } else if ($shopLink.eq(2).is('.current')) {\n                return \"popular\";\n            } else if ($shopLink.eq(3).is('.current')) {\n                return \"newest\";\n            } else if ($shopLink.eq(4).is('.current')) {\n                return \"editors_picks\";\n            } else if ($shopLink.eq(5).is('.current')) {\n                return \"sales\";\n            }\n        }\n    } else {\n        if ($('.wrapper-content.profile-section').length > 0) {\n            return \"userprofile\";\n        } else if ($('.wrapper-content.merchant').length > 0) {\n            return \"seller_shop\";\n        }\n    }\n}\n\nexport function getUtmString() {\n    const utm = getUtm()\n    if (utm) {\n        return `?utm=${utm}`\n    } else {\n        return ''\n    }\n}\n","// This is entrypoint, which `React.render` takes place after DOM is ready.\nimport React, { Suspense, lazy } from \"react\";\nimport classnames from \"classnames\";\nimport { Route, Router, Switch } from \"react-router-dom\";\nimport { render } from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { selectOrCreate } from \"fancyutils\";\nimport { history } from \"common-components\";\nimport Bugsnag from \"@bugsnag/js\";\nimport BugsnagPluginReact from \"@bugsnag/plugin-react\";\n\nif (__Config.bugsnag) {\n    Bugsnag.start({\n        apiKey: \"a54d48e98cb0410b7bdf0e60a905b00e\",\n        plugins: [new BugsnagPluginReact()],\n        user: {\n            id: window.__FancyUser?.id || null\n        },\n    });\n}\n\nimport { attachEntryEvents } from \"./container/entry-events\";\nimport { pagingContext } from \"./container/routeutils\";\nimport store from \"./store/store\";\nimport { historyHook } from \"./container/history\";\nimport { closeOverlay } from \"./action/action-helpers\";\n\nconst App: React.FC = ({ children }) => {\n    if (__Config.design_v4) {\n        return <>{children}</>;\n    }\n\n    return (\n        <div className={classnames(\"popup overlay-thing thing-detail\", { new: !!window.__Config.heart_icon })}>\n            {children}\n            <a\n                className=\"ly-close\"\n                onClick={(event) => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    store.dispatch(closeOverlay());\n                }}>\n                Close\n            </a>\n        </div>\n    );\n};\n\n$(document).ready(() => {\n    require(\"./Shared\");\n\n    const overlayContainer = __Config.design_v4\n        ? document.querySelector(\"#container-wrapper .container\")\n        : selectOrCreate(\"#overlay-thing\");\n\n    const Overlay = __Config.design_v4\n        ? lazy(() => import(/* webpackChunkName: \"OverlayThing.main\" */ \"./components/v2\"))\n        : lazy(() => import(/* webpackChunkName: \"OverlayThing.main.old\" */ \"./components/Overlay\"));\n\n    const ErrorBoundary = __Config.bugsnag ? Bugsnag.getPlugin(\"react\")!.createErrorBoundary(React) : React.Fragment;\n\n    const tree = (\n        <ErrorBoundary>\n            <Provider store={store}>\n                <Router history={history}>\n                    <App>\n                        <Switch>\n                            <Route path=\"/things/*\">\n                                <Suspense fallback={<div />}>\n                                    <Overlay />\n                                </Suspense>\n                            </Route>\n                            <Route path=\"/sales/*\">\n                                <Suspense fallback={<div />}>\n                                    <Overlay />\n                                </Suspense>\n                            </Route>\n                            <Route path=\"*\" component={() => null} />\n                        </Switch>\n                    </App>\n                </Router>\n            </Provider>\n        </ErrorBoundary>\n    );\n    render(tree, overlayContainer, () => {\n        history.listen(historyHook);\n        historyHook({ pathname: location.pathname, search: location.search }); // should init once\n        attachEntryEvents();\n        pagingContext.init();\n    });\n});\n","// Warning: objects has to be flat in each context\nexport function getInitialStoreState(contextName: 'appContext' | 'thing' | 'followContext' | 'fancyContext' | 'saleContext' | 'slideContext') {\n    switch(contextName) {\n    case 'appContext':\n        return {\n            visible: false,\n            viewer: {},\n            loggedIn: null,\n            userCountry: 'US',\n            applePayDisplay: false,\n            applePayTest: false,\n        };\n    case 'thing':\n        return {\n            data: null,\n            ID: null,\n            pendingID: null,\n            isFetching: null,\n            status: 'idle' // { idle | request | failed }\n        };\n    case 'followContext':\n        return {\n            id: null,\n            followStore: {\n                following: undefined,\n                loading: false,\n            },\n            followUser: {\n                following: undefined,\n                loading: false,\n            },\n        };\n    case 'fancyContext':\n        return {\n            id: null,\n            fancyd_count: 0,\n            fancyd: false,\n            loading: false,\n            status: 'Idle', // { Idle | Addition | Removal | After- } - Fancy'd status for animation control \n        };\n    case 'saleContext':\n        return {\n            selectedQuantity: 1,\n            saleOptionID: null, // `thing.id`? | `sio.id`?\n            currencyCode: null, // props.thing.currency_code\n            currencyMoney: null, //\n            currencySymbol: null, //\n            price: null, // (props.thing.sales_available && props.thing.sales.price) || null,\n            personalization: null,\n        };\n    case 'slideContext':\n        return {\n            id: null,\n            thumbnailIndex: 0,\n        };\n    default:\n        console.warn('`getInitialStoreState()`: Unknown context name ', contextName);\n    }\n};\n\nvar contexts = [\n    'slideContext',\n    'saleContext',\n    'fancyContext',\n    'followContext',\n    'thing',\n    'appContext'\n];\n\nexport function getAllInitialStoreState() {\n    return contexts.reduce((state, contextKey) => {\n        state[contextKey] = getInitialStoreState(contextKey);\n        return state;\n    } , {});\n}\n","// -- Members --\n// className: string\n// - class name that used from sidebar head 'wrapper figure-info {className}'.\n// type: string\n// - meta string that indicates type name\nimport { mergeObjectArgs } from 'fancyutils';\n\nexport class ThingTypeMeta {\n    static isSale = false;\n    static type = 'ThingTypeMeta';\n\n    getName(thingContext) {\n        return thingContext.name;\n    }\n}\n\nexport class PlainThingType extends ThingTypeMeta {\n    static className = '';\n    static type = 'PlainThing';\n    static createEmptyObject(...args) {\n        const objectArgs = mergeObjectArgs(args);\n        const thing = $.extend(true, {\n            id: '1',\n            url: '/',\n            isCrawled: false,\n            owner: {},\n            image: { src: '', width: 1, height: 1 },\n            user: {},\n            type: 'thing',\n            fancyd_friends: [],\n        }, objectArgs);\n        thing.META = getThingType(thing);\n        return thing;\n    }\n}\n\nexport class SaleItemType extends ThingTypeMeta {\n    static className = '';\n    static type = 'SaleItem';\n    static getName(thingContext) {\n        return thingContext.sales.name;\n    }\n    static createEmptyObject(objectArgs) {\n        return PlainThingType.createEmptyObject({\n            sales_available: true,\n            sales: {\n                id: '1',\n                review_rating: 1,\n                review_count: 1,\n                size_chart_ids: ['1'],\n                images: [{ src: '', width: 1, height: 1 }],\n                seller: { id: '1' }\n            },\n            type: 'sales'\n        }, objectArgs);\n    }\n}\n\nexport class GiftcardType extends SaleItemType {\n    static className = 'giftcard';\n    static type = 'Giftcard';\n\n    static getName() {\n        return window.gettext(\"Fancy Gift Card\");\n    }\n}\n\nexport class HotelType extends SaleItemType {\n    static className = 'hotel';\n    static type = 'Hotel';\n\n    static getName(thingContext) {\n        return thingContext.hotel_search.hotel.name;\n    }\n}\n\nexport class VanityType extends SaleItemType {\n    static className = 'vanity';\n    static type = 'Vanity';\n}\n\nexport class LaunchAppType extends ThingTypeMeta {\n    static className = '';\n    static type = 'LaunchApp';\n}\n\n// Retrieve meta by looking up thing object.\nexport function getThingType(thingContext) {\n    var ThingType;\n    if (thingContext.hotel_search) {\n        ThingType = HotelType;\n    } else if (thingContext.has_launch_app && thingContext.metadata) {\n        ThingType = LaunchAppType;\n    } else if (thingContext.type === 'giftcard') {\n        ThingType = GiftcardType;\n    } else if (thingContext.sales_available) {\n        if (thingContext.type === 'vanity_number') {\n            ThingType = VanityType;\n        } else {\n            ThingType = SaleItemType;\n        }\n    } else {\n        ThingType = PlainThingType;\n    }\n    return ThingType;\n}\n\nconst ThingTypes = [PlainThingType, SaleItemType, GiftcardType, HotelType, VanityType, LaunchAppType];\n\n// TODO: immutable\nThingTypes.forEach(AttachingType => {\n    ThingTypes.forEach(ComparingType => { \n        AttachingType[ComparingType.type] = AttachingType === ComparingType;\n    });\n});\n","import { combineReducers } from \"@reduxjs/toolkit\";\nimport { extractMetaFromURL, /*getConciseNumberString,*/ update, updateShallow } from \"fancyutils\";\n\nimport C from \"./action/action-constants\";\nimport { getInitialStoreState } from \"./store/initial-store\";\nimport { getFirstSaleOption, setWaiting } from \"./components/map\";\nimport { updateState } from \"./appstate\";\nimport { scrollEvent } from \"./container/entry-events\";\nimport { getThingType } from \"./ThingTypes\";\nimport { cache } from \"./cache\";\n\nvar loaded = false;\nvar lastFullyRenderedThingID = 0;\nfunction appContext(state = getInitialStoreState(\"appContext\"), action) {\n    switch (action.type) {\n        case C.OPEN_THING:\n            scrollEvent.visible = true;\n            return updateShallow(state, {\n                visible: true,\n            });\n        case C.CLOSE_THING:\n            scrollEvent.visible = false;\n            lastFullyRenderedThingID = 0;\n            loaded = false;\n            return updateShallow(state, {\n                visible: false,\n                lastFullyRenderedThingID,\n            });\n        case C.UPDATE_APP_CONTEXT:\n            return updateShallow(state, action.context);\n        case C.LOAD_THING: {\n            // Due to multi-stage rendering (cache -> from-server-data -> ...)\n            // it is unable to check state change correctly just by comparing ID;\n            // Therefore, we set internal state per every update cycle and check\n            // if state is fully updated.\n\n            // FIXME: when cached response exist, it marks as rendered before\n            if (loaded === true && lastFullyRenderedThingID !== action.data.id && action.data.fromServer) {\n                lastFullyRenderedThingID = action.data.id;\n            }\n\n            const loggedIn = window.__FancyUser.loggedIn;\n            const viewer = action.data.viewer || {};\n            const userCountry =\n                $.cookie.get(\"shipping_country_code\") || action.data.current_country_code || state.userCountry;\n\n            updateState(\"loggedIn\", loggedIn);\n            updateState(\"viewer\", viewer);\n            loaded = true;\n\n            return update(state, { lastFullyRenderedThingID, loggedIn, viewer, userCountry });\n        }\n        default:\n            return state;\n    }\n}\n\nfunction populateThingContext(thingData) {\n    thingData.loading = thingData.fromServer !== true;\n    thingData.META = getThingType(thingData);\n    thingData.URLMeta = extractMetaFromURL(location.href); // FIXME: provide current pathname\n    thingData.owner = thingData.user;\n}\n\n// Thing context\nfunction thing(state = getInitialStoreState(\"thing\"), action) {\n    switch (action.type) {\n        case C.LOAD_THING:\n            populateThingContext(action.data);\n            return updateShallow(state, {\n                data: action.data,\n                status: action.status,\n                ID: action.ID,\n                pendingID: null,\n                isFetching: false,\n            });\n        case C.REQUEST_THING:\n            return update(state, {\n                pendingID: action.pendingID,\n                status: action.status,\n                isFetching: true,\n            });\n        case C.REQUEST_THING_FAILURE:\n            return update(state, {\n                status: action.status,\n                isFetching: false,\n            });\n\n        // Reset state\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"thing\"));\n        default:\n            return state;\n    }\n}\n\n// Follow contexts\nfunction followContext(state = getInitialStoreState(\"followContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"), {\n                id: action.data.id,\n                followStore: {\n                    following: action.data.sales\n                        ? Boolean(action.data.sales.seller && action.data.sales.seller.seller_follow)\n                        : false,\n                    loading: false,\n                },\n                followUser: {\n                    following: action.data ? Boolean(action.data.following) : false,\n                    loading: false,\n                },\n            });\n\n        // Sidebar\n        // Follow seller/user\n        case C.TOGGLE_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: true,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.CANCEL_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.COMPLETE_FOLLOW:\n            if (action.followType === \"followStore\") {\n                cache.update(state.id, undefined, \"sales.seller.seller_follow\", state[action.followType].following);\n            }\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: state[action.followType].following,\n                },\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"));\n        default:\n            return state;\n    }\n}\n\n/*\nfunction getFancyStatus(nextFancydState) {\n    return nextFancydState ? FancyStatus.Addition : FancyStatus.Removal;\n}\nfunction getCompletionIdleStatus(currentFancyState) {\n    const prevFancyState = !currentFancyState;\n    return prevFancyState ? FancyStatus.AfterRemoval : FancyStatus.AfterAddition;\n}*/\n\nfunction fancyContext(state = getInitialStoreState(\"fancyContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            // Extract thing data for initial thing context data reset.\n            // onFancyButtonUpdate(action.data.id, action.data.fancyd, getConciseNumberString(action.data.fancyd_count));\n            return updateShallow(getInitialStoreState(\"fancyContext\"), {\n                id: action.data.id,\n                fancyd: action.data.fancyd,\n                fancyd_count: action.data.fancyd_count,\n                loading: false,\n                //status: FancyStatus.Idle,\n            });\n        case C.TOGGLE_FANCY:\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: true,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: true,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        case C.CANCEL_FANCY: {\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: false,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: false,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        }\n        // Update data\n        case C.COMPLETE_FANCY:\n            // cache.update(state.id, undefined, \"fancyd\", state.fancyd);\n            // cache.update(state.id, undefined, \"fancyd_count\", action.fancyd_count);\n            // onFancyButtonUpdate(state.id, state.fancyd, getConciseNumberString(action.fancyd_count));\n            // return update(state, {\n            //     loading: false,\n            //     fancyd_count: action.fancyd_count,\n            //     //status: getCompletionIdleStatus(state.fancyd)\n            // });\n            return {\n                ...state,\n                ...{\n                    loading: false,\n                    fancyd_count: action.fancyd_count,\n                    //status: getCompletionIdleStatus(state.fancyd)\n                },\n            };\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"fancyContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction slideContext(state = getInitialStoreState(\"slideContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"), {\n                id: action.data.id,\n            });\n        case C.SET_THUMBNAIL_INDEX:\n            return update(state, {\n                thumbnailIndex: action.thumbnailIndex,\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction saleContext(state = getInitialStoreState(\"saleContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING: {\n            // Extract thing data for initial thing context data reset.\n            const thing = action.data;\n            const sales = thing && thing.sales;\n            const saleOptionInclSales = getFirstSaleOption(sales);\n            const nextContext = {\n                selectedQuantity: 1,\n                saleOptionID: (saleOptionInclSales && saleOptionInclSales.id) || null,\n                currencyCode: action.data.currency_code,\n                price: (saleOptionInclSales && saleOptionInclSales.price) || null,\n                waiting: null,\n            };\n            return updateShallow(getInitialStoreState(\"saleContext\"), nextContext);\n        }\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"saleContext\"));\n        case C.UPDATE_SALE_CONTEXT: {\n            // Setting waiting\n            if (action.waiting != null) {\n                setWaiting(state.saleOptionID, action.waiting);\n            }\n\n            let waiting = action.waiting;\n            // Reset quantity / Change waiting if option is changed.\n            if (action.saleOptionID != null && action.saleOptionID !== state.saleOptionID) {\n                action.selectedQuantity = 1;\n                waiting = null;\n            }\n\n            const nextContext = {\n                selectedQuantity: action.selectedQuantity,\n                saleOptionID: action.saleOptionID, // `thing.id`? | `sio.id`?\n                price: action.price, // (props.thing.sales_available && props.thing.sales.price) || null,\n                // UI\n                currencyCode: action.currencyCode, // props.thing.currency_code\n                currencyMoney: action.currencyMoney, //\n                currencySymbol: action.currencySymbol, //\n                personalization: action.personalization,\n                waiting,\n            };\n            return update(state, nextContext);\n        }\n        default:\n            return state;\n    }\n}\n\n/*\nfunction checkNotImplementedWithURLExceptionRule(META) {\n    if (['Fancybox', 'Hermes'].some(type => META[type])) {\n        window.location.reload()\n    }\n}*/\n\nconst rootReducer = combineReducers({\n    appContext,\n    // Thing contexts\n    followContext,\n    fancyContext,\n    slideContext,\n    saleContext,\n    // etc.\n    thing,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import { configureStore } from \"@reduxjs/toolkit\";\nimport thunk from \"redux-thunk\";\nimport logger from 'redux-logger'\n\nimport { getAllInitialStoreState } from \"./initial-store\";\nimport rootReducer from \"../reducers\";\n// import type { RootState } from '../reducers';\n\nconst middlewares = [thunk];\nif (process.env.NODE_ENV !== 'production') {\n    middlewares.push(logger);\n}\n\nconst store = configureStore({\n    reducer: rootReducer,\n    preloadedState: getAllInitialStoreState(),\n    middleware: (getDefaultMiddleware) =>\n        getDefaultMiddleware({\n            serializableCheck: false,\n        }).prepend(middlewares),\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport default store;\n"],"sourceRoot":""}
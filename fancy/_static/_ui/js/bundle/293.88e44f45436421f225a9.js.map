{"version":3,"sources":["webpack://fancy/./_static/modules/ui/overlay-thing/API.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/FancydUsers.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/sidebar/heads/SaleItem.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/sidebar/heads/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/sidebar/index.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/ThingDetails.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/Thing.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/ThingCard.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/Recommendation.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/Overlay.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/map.cart.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/sidebar/action-buttons.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/sidebar/heads/Mixin.js","webpack://fancy/./_static/modules/ui/overlay-thing/data/Countries.js"],"names":["deleteThing","thing","callback","alertify","confirm","ok","param","thing_id","id","uid","user","ntid","$","post","xml","find","length","text","location","href","msg","alert","getFancyStatus","nextFancydState","FancyStatus","getCompletionIdleStatus","currentFancyState","getNextFancydCount","nextFancyd","currentFancydCount","bigContainerStyle","width","className","FancydUsers","props","fancyd_count","state","getConciseNumberString","thingID","currentState","stateSetter","_","fancyd","loading","nextFancydCount","fancyStatus","ajax","type","url","data","done","json","cache","undefined","fail","toggleFancy","ns","setState","_handleFancydStateOnLoadThing","event","preventDefault","stopPropagation","appContext","loggedIn","MP","window","require_login","_getInitialState","fancyAnimation","this","handleFancydStateOnLoadThing","prevProps","prevThing","isCrawled","bigContainer","style","onClick","handleFancyClick","classnames","getFancydCountString","Component","displayCount","optionValueFunction","opt","saleNamePrinter","name","price","SaleItemSidebarHead","selected","disabled","then","CurrencyPopup","renderPopup","currentCurrency","saleContext","currencyCode","renderCurrencyPopup","currencyIsUSD","currencySymbol","currencyMoney","approxText","gettext","dispatch","saleOptionID","parseInt","currentTarget","value","updateSaleContext","selectedQuantity","personalization","appState","sales","getCurrentSaleOption","params","sale_item_id","option_id","getWaiting","remove","dataType","status_code","message","waiting","FancyApplePay","os","options","filter","o","soldout","total","label","title","amount","displayItems","map","Number","checkAvailability","available","testmode","updateAppContext","applePayDisplay","applePayTest","option_meta","getInitialMultiOptionState","updateSaleOptionIDFromMultiOptionState","presetOptionId","getLocationArgPairs","String","multiOptionState","selectedOptionName","m","order","orderMap","replace","join","selectedOption","DEBUG","console","warn","extractSaleOptionIDFromMultiOptionState","amendedID","amendSaleOptionFromMultiOptionState","nextSelected","swatch","button","thumbnail","dropdown","forEach","index","selectedValue","values","getPossibleValuesForIndex","some","v","e","indexOfType","el","tagName","attr","extend","handlePurchase","onClickThumbnail","onClickMultiOptionGen","onClickSwatch","onMultiSelectBoxChange","onClickMutliButton","convertCurrency","initializeMultiOption","checkApplePay","nextSaleOptionID","_o","mos","i","so","eq","escapeSelector","get","click","paymentRequest","update","nonSoldout","quantity","selectedNonSoldoutOption","nextValue","push","MultiOptionState","nextProps","nsc","priceChanges","currencyChanges","cartButtonStyle","discountPercentage","parseFloat","discount_percentage","retailPrice","retail_price","remaining_quantity","optionIsMulti","isOptionMulti","salesOptionsAvailable","isSalesOptionsAvailable","discounting","currencyCodeStyle","display","quantitySelectRange","range","Math","min","showSelectbox","applePayButton","ApplePayButton","key","Keys","getSafeNameProp","sale","floatFormatMinusTwo","handleCurrencyPopupUSD","numberFormat","getApproxText","handleCurrencyPopup","currentValue","printer","expander","SaleItemOptionsExpander","onChange","handleOptionChange","handleSizeGuidePopup","defaultValue","handleQuantityChange","sid","personalizable","placeholder","handlePersonalizationChange","subscribed","handleNotifyLater","SalesOverview","sio","idx","clicked","country","seller","seller_id","option","requestPurchase","err","trace","handleApplePayCheckout","userCountry","ShippingCountriesPopup","ReturnPolicyDetailPopup","SizeGuidePopup","deliveryDate","getSales","hasSizeGuide","size_guide_id","deliveryIsDomestic","ableToShip","expected_delivery_day_1","international_shipping","hideShippingWindow","getDomesticDeliveryDate","getIntlDeliveryDate","shippingInfo","shipping_info","cost","Display","origin","return_exchange_policy_title","handlePolicyDislplay","dangerouslySetInnerHTML","__html","description","SidebarHead","META","SaleItem","lazy","viewer","is_admin_any","Head","getHead","fallback","Suspense","Sidebar","RequestSalePopup","self","reported","tid","success","$st","reported_by_viewer","showQuestion","sidebarMerchantInfo","from_list","sales_available","requestSale","Giftcard","Hotel","LaunchApp","is_seller","SidebarMerchantInfo","reportLabel","handleRequestSaleOpen","handleReport","toggleFollow","followContext","precondition","profile_is_private","following","followStore","popular_seller_saleitems","isFollowingStore","sellerImageAttrs","saleitem_seller","logo_type","indexOf","cdnUtils","schemeless","alt","brand_name","pops","uniq","__Config","nostore","position","right","fontSize","textDecoration","username","color","isEmpty","si","data-idx","rel","html_url","backgroundImage","image","handleFollowToggle","seller_followed_count","AskQuestionPopover","sending","showQuestionSuccess","questionFile","questionFileValue","question","threadUrl","target","files","trim","formData","FormData","append","processData","contentType","res","thread","always","on","didClickOn","off","handleQuestionClose","handleAsking","handleQuestionChange","handleQuestionAddFile","handleQuestionFileChange","accept","handleQuestionFileDelete","handleQuestionFileSend","ThumbnailsLimit","StaticThingViewConfig","ItemDetail","showMore","onThumbnailsLimitChange","More","closest","handleChangeFigure","shortDescription","detailRef","detail","children","toArray","reduce","p","n","outerHeight","DetailHeight","Basic","setDescriptionDisplayState","lastFullyRenderedThingID","thumbnailIndex","slideContext","thumbnailsLimit","saleImages","getSaleImages","full_name","thumbIsVideo","thumbType","thumbnailURL","src","optionProps","option_name","handleSelectImage","handleViewAllImages","ref","element","getDescription","handleMore","handleLess","zoomMargin","ThingViewConfig","zoomBoxSize","zoomScale","Thing","savedTID","loaded","setTimeout","_isRequestFresh","setThumbnailIndex","promisifiedFetchImage","getImage","transitionDuration","diff","thingImagesLength","nextIndex","changeFigureTo","getAbsoluteIndex","boundarySize","img","height","marginHoriz","marginVert","$fig","pageX","pageY","zoomImageStyle","$wrapper","wrapper","meta","getImageMeta","offset","left","top","topPosition","zd","getZoomImageDimension","zoomImageContainerX","minmax","zoomImageContainerY","backgroundLeft","backgroundTop","bgPosX","bgPosY","backgroundPosition","isZoomable","nextZoom","zoom","moveZoomImage","getImageURL","opacity","lineHeight","EditPopup","MaxDimension","shouldVideoDisplayed","trigger","ret","assign","backgroundSize","handleThumbnailsLimitChange","prevNextStyle","getDetailType","saleItemId","getSaleItemId","getSeller","showZoom","videoDisplay","PlainThing","video","handleZoomBGClick","onMouseMove","handleZoomBGMouseMove","startZoom","zoomShow","getBGImageStyle","Video","object","lastFullyRenderedObjectID","allow","fullScreen","handleVideoStyle","handleZoomImageClick","getZoomImageStyle","isFit","getBoundaryImageStyle","emojified_name","handlePrev","handleNext","is_admin_senior","is_admin_business","is_admin_brand","is_admin_cs","can_be_modified","is_admin_content","handleEdit","handleDelete","itemTraits","article","utm","section","via","similar","recently","ThingCard","fancydCount","optionID","showCart","popupOpened","addToCart","itemType","saleAvailable","isSaleAvailable","saleOptionExists","isSaleOptionExists","getSaleOption","isNaN","sale_id","traits","getThingName","log","salesID","logAddCartMixpanel","deal_price","addItemToCart","unmounted","has_options","available_for_sale","isNumber","max","isSaleOptionAvailable","onDelete","isPlainLeftClick","OtContainer","transition","LinkTypes","handleLinkClick","throttle","thumb_image_url_310","thumb_image_url_558","itemIdx","saleOptionAvailable","showFrom","max_price","min_price","new_card","active","toggled","data-prevent-overlay","showFancydUser","MoreShareFacade","objectType","objectId","viewerUsername","onShowSomething","handleShowSomething","opened","handleCartAddition","handleTrickClick","handleOptionQuantityChange","getQuantityRange","handleNotifySoldout","handleRecentlyDelete","handleQuickCartToggle","Views","scrollTouchdown","isReached","similarLoading","updateSimilar","shouldShowRecommendation","wHeight","$content","tabHeight","footerHeight","Timeline","currentView","updateRecently","reset","similarCursorEndReached","nextCursorString","similarNextCursor","CURRENT_LANGCODE","next_cursor","results","things","converted","convertThingsV1ToRest","cacheSimilarThings","logExposed","isArray","concat","xhr","response","deletedThing","scrollEvent","debounceUntilTimeout","lastthingID","idCopy","thingContext","current","handleToggleSimilar","handleToggleRecently","similarThing","RecommendationItemLoading","recentlyThing","ThingCache","LogExposed","addLog","FooterReviews","_Overlay","pt","ct","isStaticPage","scrollTop","focus","minimumOption","nonSoldoutOptions","store","historyData","showReview","reviews","isSafari","AdminComponent","admin","is_admin_design","is_admin_wholesale","show_on_homepage","getAdminSidebar","connect","mapStateToThingProps","ReduxComponentEnhancer","Fancy","track_event","from_sds_page","dataLayer","TrackingEvents","currentLocationArgPair","product_id","products","products_info","revenue","brand","variant","args","itemcode","image_url","itemname","cart_id","fancy_price","FANCY_PRICE","Cart","addItem","openPopup","ActionButtons","showShortcuts","fromThingSidebar","saleOption","request","SaleOptions","onFocus","unselectedLabel","CartButton","SelectBox","labelValue","tabIndex","s","targetIndex","filteredOptions","sel","MultiOption","getMultiOptions","indexTypeOf","additional","selectedArray","MultiSelectBox","MultiSwatch","MultiThumbnail","MultiButton","MultiSelectBoxOption","data-value","data-index-typeof","MultiSwatchOption","backgroundColor","MultiThumbnailOption","MultiButtonOption","Countries","getCountryByCode","code","CountriesPair","pairs","sort","a","b","localeCompare"],"mappings":"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","file":"293.88e44f45436421f225a9.js","sourcesContent":["export function deleteThing(thing, callback) {\n    alertify.confirm(\"Remove this from Fancy?\", function(ok) {\n        if (ok) {\n            const param = {\n                thing_id: thing.id,\n                uid: thing.user.id,\n                ntid: thing.ntid,\n            };\n            $.post(\"/remove_new_thing.xml\", param, function(xml) {\n                if ($(xml).find(\"status_code\").length>0 && $(xml).find(\"status_code\").text()==1) {\n                    location.href = $(xml).find(\"url\").text();\n                } else if ($(xml).find(\"status_code\").length>0 && $(xml).find(\"status_code\").text()==0) {\n                    var msg = $(xml).find(\"message\").text();\n                    alertify.alert(msg);\n                }\n                callback && callback();\n            }, \"xml\");\n        } else {\n            callback && callback();\n        }\n    });\n}\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { MP, getConciseNumberString } from \"fancyutils\";\n\nimport { FancyStatus } from \"../config\";\nimport { cache } from \"../cache\";\n\n\nfunction _handleFancydStateOnLoadThing(thingID, { fancyd, fancyd_count }, stateSetter = _ => _) {\n    stateSetter({\n        fancyd,\n        fancyd_count,\n        loading: false,\n        fancyStatus: FancyStatus.Idle\n    });\n}\n\nfunction getFancyStatus(nextFancydState) {\n    return nextFancydState ? FancyStatus.Addition : FancyStatus.Removal;\n}\nfunction getCompletionIdleStatus(currentFancyState) {\n    const prevFancyState = !currentFancyState;\n    return prevFancyState ? FancyStatus.AfterRemoval : FancyStatus.AfterAddition;\n}\nfunction getNextFancydCount(nextFancyd, currentFancydCount) {\n    if (nextFancyd === true) {\n        return currentFancydCount + 1;\n    } else {\n        return currentFancydCount - 1;\n    }\n}\nfunction toggleFancy(thingID, currentState, stateSetter = _ => _) {\n    const { fancyd, fancyd_count, loading } = currentState;\n    const nextFancyd = !fancyd;\n    const nextFancydCount = getNextFancydCount(nextFancyd, fancyd_count);\n\n    if (!loading) {\n        stateSetter({\n            fancyd: nextFancyd,\n            loading: true,\n            fancyd_count: nextFancydCount,\n            fancyStatus: getFancyStatus(nextFancyd)\n        });\n\n        $.ajax({\n            type: \"PUT\",\n            url: `/rest-api/v1/things/${thingID}`,\n            data: {\n                fancyd: nextFancyd\n            }\n        })\n            .done(function(json) {\n                if (json.id && json.fancyd === !fancyd) {\n                    // Completing fancy\n                    const nextFancydCount = json.fancyd === true ? (fancyd_count || 0) + 1 : (fancyd_count || 0) - 1;\n\n                    cache.update(thingID, undefined, \"fancyd\", nextFancyd);\n                    cache.update(thingID, undefined, \"fancyd_count\", nextFancydCount);\n\n                    stateSetter({\n                        loading: false,\n                        fancyd: nextFancyd,\n                        fancyd_count: nextFancydCount,\n                        fancyStatus: getCompletionIdleStatus(nextFancyd)\n                    });\n                } else {\n                    // cancelling fancy\n                    stateSetter({ loading: false, fancyd, fancyd_count, fancyStatus: getFancyStatus(fancyd) });\n                }\n            })\n            .fail(function() {\n                // cancelling fancy\n                stateSetter({ loading: false, fancyd, fancyd_count, fancyStatus: getFancyStatus(fancyd) });\n            });\n    }\n}\n\n// workaround for profile heads overflow on animation\nconst bigContainerStyle = { width: \"285px\" };\n\nexport class FancydUsers extends Component {\n    static defaultProps = {\n        displayCount: 8\n    };\n\n    _getInitialState() {\n        return {\n            fancyAnimation: false,\n            // button state\n            fancyd: null,\n            loading: false,\n            fancyd_count: null,\n            fancyStatus: FancyStatus.Idle // fancyStatus = 'Idle', { Idle | Addition | Removal | After- } - Fancy'd status for animation control\n        };\n    }\n\n    constructor(props) {\n        super(props);\n        this.state = this._getInitialState();\n    }\n\n    getFancydCountString = () => {\n        const { fancyd_count } = this.state;\n        return fancyd_count != null ? getConciseNumberString(fancyd_count, 0) : \"0\";\n    };\n\n    toggleFancy = () => {\n        toggleFancy(this.props.thing.id, this.state, ns => {\n            this.setState(ns);\n        });\n    };\n\n    handleFancydStateOnLoadThing = thing => {\n        if (thing == null) {\n            thing = this.props.thing;\n        }\n        _handleFancydStateOnLoadThing(thing.id, { fancyd: thing.fancyd, fancyd_count: thing.fancyd_count }, ns => {\n            this.setState(ns);\n        });\n    };\n\n    handleFancyClick = event => {\n        event.preventDefault();\n        event.stopPropagation();\n        const { thing } = this.props;\n        if (!this.props.appContext.loggedIn) {\n            window.require_login(null, \"fancy_thing\", thing.id);\n            return;\n        }\n        const { fancyd, loading } = this.state;\n        if (loading) {\n            return;\n        }\n\n        if (!fancyd) {\n            MP(\"Fancy\", { thing_id: thing.id });\n        } else {\n            MP(\"Unfancy\", { thing_id: thing.id });\n        }\n\n        this.toggleFancy();\n    };\n\n    componentDidMount() {\n        this.handleFancydStateOnLoadThing();\n    }\n\n    componentDidUpdate(prevProps) {\n        // Thing has been updated.\n        const { thing } = this.props;\n        const prevThing = prevProps.thing;\n        if (thing.id !== prevThing.id || thing.isCrawled !== prevThing.isCrawled) {\n            this.handleFancydStateOnLoadThing(thing);\n        }\n    }\n\n    render() {\n        const {\n            bigContainer,\n        } = this.props;\n        const { fancyd } = this.state;\n\n        return (\n            <span style={bigContainer && bigContainerStyle} className=\"fancyd_users-wrap\">\n                <span className=\"count\">\n                    <a\n                        onClick={this.handleFancyClick}\n                        className={classnames(\"button button-static fancy _count\", {\n                            fancyd\n                        })}>\n                        {this.getFancydCountString()}\n                    </a>\n                    <span className=\"_fancyd\" />\n                </span>\n            </span>\n        );\n    }\n}\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { floatFormatMinusTwo, numberFormat, renderPopup, escapeSelector, getLocationArgPairs } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\n\nimport appState from \"../../../appstate\";\nimport { convertCurrency, updateSaleContext } from \"../../../action/action-helpers\";\nimport ActionButtons from \"../action-buttons\";\nimport { updateAppContext } from \"../../../action/actions\";\nimport {\n    currencyIsUSD,\n    getCurrentSaleOption,\n    getSafeNameProp,\n    getWaiting,\n    isSalesOptionsAvailable,\n    getSales,\n    getDescription,\n    getDomesticDeliveryDate,\n    getIntlDeliveryDate,\n} from \"../../map\";\nimport { Keys } from \"../../Perf\";\nimport { CartButton, SelectBox, handlePurchase, MultiOption, MultiOptionState } from \"./Mixin\";\nimport { getCountryByCode } from \"../../../data/Countries\";\nimport { OverlayPropsV1 } from \"ftypes\";\n\nfunction optionValueFunction(opt) {\n    return opt.id;\n}\nconst saleNamePrinter = (opt) => `${opt.name} - $${opt.price}`;\n\nexport default class SaleItemSidebarHead extends Component<\n    OverlayPropsV1,\n    {\n        loading: boolean;\n        selected: Object;\n        disabled: Array<any>;\n    }\n> {\n    state = {\n        loading: false,\n        selected: {},\n        disabled: [],\n    };\n\n    constructor(props: OverlayPropsV1) {\n        super(props);\n        this.handlePurchase = handlePurchase.bind(this);\n        // for multi options\n        this.onClickThumbnail = this.onClickMultiOptionGen(\"thumbnail\");\n        this.onClickSwatch = this.onClickMultiOptionGen(\"swatch\");\n        this.onMultiSelectBoxChange = this.onClickMultiOptionGen(\"dropdown\");\n        this.onClickMutliButton = this.onClickMultiOptionGen(\"button\");\n    }\n\n    renderCurrencyPopup = () => {\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\").then(({ CurrencyPopup }) => {\n            renderPopup(CurrencyPopup, { currentCurrency: this.props.saleContext.currencyCode });\n        });\n    };\n\n    handleCurrencyPopup = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        this.renderCurrencyPopup();\n    };\n\n    handleCurrencyPopupUSD = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        if (!currencyIsUSD(this.props)) {\n            return false;\n        }\n        this.renderCurrencyPopup();\n    };\n\n    getApproxText = () => {\n        var { currencySymbol, currencyMoney } = this.props.saleContext;\n        var approxText = gettext(\"Approximately\");\n        return `${approxText} ${currencySymbol}${currencyMoney} `;\n    };\n\n    handleOptionChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const saleOptionID = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    handleQuantityChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const selectedQuantity = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ selectedQuantity }));\n    };\n\n    handlePersonalizationChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const personalization = event.currentTarget.value;\n        dispatch(updateSaleContext({ personalization }));\n    };\n\n    handleNotifyLater = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!appState.loggedIn) {\n            return window.require_login();\n        }\n        const {\n            thing: { sales },\n            saleContext,\n        } = this.props;\n        const opt = getCurrentSaleOption(sales, saleContext, true);\n        const params = { sale_item_id: sales.id };\n\n        if (opt != null) {\n            params.option_id = opt.id;\n        }\n\n        const waiting = getWaiting(sales, saleContext);\n        if (waiting) {\n            params.remove = 1;\n        }\n\n        $.ajax({\n            type: \"post\",\n            url: \"/wait_for_product.json\",\n            data: params,\n            dataType: \"json\",\n        }).done((json) => {\n            if (!json || json.status_code == null) {\n                return;\n            }\n            if (json.status_code == 0 && json.message) {\n                alertify.alert(json.message);\n                return;\n            }\n            const waiting = params.remove ? false : true;\n            this.props.dispatch(updateSaleContext({ waiting }));\n        });\n    };\n\n    checkApplePay = () => {\n        if (window.FancyApplePay) {\n            const { sales } = this.props.thing;\n            const os = sales.options.filter((o) => !o.soldout);\n            const data = {\n                total: { label: sales.title, amount: (sales.price * 100) | 0 },\n            };\n\n            if (os.length > 0) {\n                data.displayItems = os.map((o) => ({\n                    label: o.name,\n                    amount: (Number(o.price) * 100) | 0,\n                }));\n            }\n\n            FancyApplePay.checkAvailability((available, testmode) => {\n                if (available) {\n                    this.props.dispatch(\n                        updateAppContext({\n                            applePayDisplay: true,\n                            applePayTest: testmode,\n                        })\n                    );\n                }\n            }, data);\n        }\n    };\n\n    componentDidMount() {\n        if (!currencyIsUSD(this.props)) {\n            const { saleContext } = this.props;\n            convertCurrency(saleContext.currencyCode, saleContext.price);\n        }\n        this.initializeMultiOption();\n        this.checkApplePay();\n    }\n\n    componentDidUpdate(prevProps) {\n        if (prevProps.thing.id !== this.props.thing.id) {\n            this.initializeMultiOption();\n            this.checkApplePay();\n            return;\n        }\n\n        const {\n            saleContext,\n            thing: { sales },\n        } = prevProps;\n\n        const nsc = this.props.saleContext;\n        const nextSaleOptionID = nsc.saleOptionID;\n        if (saleContext.saleOptionID !== nextSaleOptionID) {\n            const o = _.find(sales.options, (_o) => _o.id === nextSaleOptionID);\n            // option sync\n            if (o) {\n                const mos = $(\".sale-item-input .multi-option\");\n                o.values.forEach((v, i) => {\n                    const so = mos\n                        .eq(i)\n                        .find(`[data-value=\"${escapeSelector(v)}\"]:not(.selected)`)\n                        .get(0);\n                    if (so) {\n                        so.click();\n                    }\n                });\n                if (window.FancyApplePay && FancyApplePay.paymentRequest) {\n                    FancyApplePay.paymentRequest.update({\n                        total: {\n                            label: o.name,\n                            amount: (Number(o.price) * 100) | 0,\n                        },\n                    });\n                }\n            }\n        }\n    }\n\n    initializeMultiOption = () => {\n        const {\n            thing: {\n                sales: { options, option_meta },\n            },\n            saleContext,\n            dispatch,\n        } = this.props;\n\n        this.setState(this.getInitialMultiOptionState(options, option_meta), () => {\n            // don't block selecting cheapest item\n            if (!(options && options.length > 1)) {\n                this.updateSaleOptionIDFromMultiOptionState();\n            }\n            // ?option={number} support\n            const presetOptionId = getLocationArgPairs(\"option\");\n            if (presetOptionId && presetOptionId[1] && String(saleContext.saleOptionID) !== presetOptionId[1]) {\n                dispatch(updateSaleContext({ saleOptionID: parseInt(presetOptionId[1], 10) }));\n            }\n        });\n    };\n\n    getInitialMultiOptionState(options, option_meta) {\n        const selected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        if (option_meta.length > 0) {\n            const nonSoldout = options.filter((o) => o.quantity !== 0);\n            if (nonSoldout.length !== 0) {\n                const selectedNonSoldoutOption = nonSoldout[0]; // temporary - FIXME\n                option_meta.forEach(function (opt, i) {\n                    const { type } = opt;\n                    const nextValue = selectedNonSoldoutOption.values[i];\n                    selected[type].push(nextValue);\n                });\n            } else {\n                // set first available multi option\n                option_meta.forEach(function (opt) {\n                    const { type } = opt;\n                    const nextValue = opt.values[0];\n                    selected[type].push(nextValue);\n                });\n            }\n        }\n        const multiOptionState = new MultiOptionState(options, option_meta);\n        return { selected, multiOptionState };\n    }\n\n    extractSaleOptionIDFromMultiOptionState = (selected) => {\n        const {\n            thing: { sales },\n        } = this.props;\n        if (selected == null) {\n            selected = this.state.selected;\n        }\n        const { multiOptionState } = this.state;\n\n        const selectedOptionName = multiOptionState.option_meta\n            .map((m) => {\n                const order = multiOptionState.orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order].replace(\" / \", \"/\");\n                } else {\n                    return selected[m.type][0];\n                }\n            })\n            .join(\" / \");\n        const selectedOption = _.find(sales.options, (opt) => opt.name === selectedOptionName);\n        if (selectedOption) {\n            return selectedOption.id;\n        } else {\n            window.DEBUG &&\n                console.warn(\"no option found for \", selectedOptionName, \"meta:\", sales.options, this.state.selected);\n        }\n    };\n\n    updateSaleOptionIDFromMultiOptionState = () => {\n        const { dispatch } = this.props;\n        let saleOptionID = this.extractSaleOptionIDFromMultiOptionState();\n        if (saleOptionID === undefined) {\n            const amendedID = this.amendSaleOptionFromMultiOptionState();\n            if (amendedID) {\n                saleOptionID = amendedID;\n            } else {\n                window.DEBUG && console.warn(\"Couldn't recover option\");\n            }\n        }\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    amendSaleOptionFromMultiOptionState = () => {\n        const { selected, multiOptionState } = this.state;\n        const nextSelected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        multiOptionState.option_meta.forEach(({ type, name }, index) => {\n            const order = multiOptionState.orderMap[type][name];\n            const selectedValue = selected[type][order];\n            if (index === 0) {\n                nextSelected[type][order] = selectedValue;\n                return;\n            }\n            const values = multiOptionState.getPossibleValuesForIndex(selected, index);\n            let value;\n            if (values.some((v) => v === selectedValue)) {\n                value = selectedValue;\n            } else {\n                value = values[0];\n            }\n            selected[type][order] = value; // even though it will be flushed out, it will affect next options so fix it as well\n            nextSelected[type][order] = value;\n        });\n        this.setState({ selected: nextSelected });\n        return this.extractSaleOptionIDFromMultiOptionState(nextSelected);\n    };\n\n    onClickMultiOptionGen = (type) => {\n        return (e) => {\n            const el = e.currentTarget;\n            let value;\n            let indexOfType;\n            if (el.tagName === \"SELECT\") {\n                value = el.value;\n                indexOfType = Number($(el).find(\":selected\").attr(\"data-index-typeof\"));\n            } else {\n                value = $(el).attr(\"data-value\");\n                indexOfType = Number($(el).attr(\"data-index-typeof\"));\n            }\n            if (e.currentTarget.className === \"disabled\") {\n                return;\n            }\n\n            this.state.selected[type][indexOfType] = value;\n            // forceful trigger even though no differences in value.\n            this.setState({ selected: _.extend({}, this.state.selected) }, this.updateSaleOptionIDFromMultiOptionState);\n        };\n    };\n\n    onClickThumbnail = null;\n    onClickSwatch = null;\n    onMultiSelectBoxChange = null;\n    onClickMutliButton = null;\n\n    UNSAFE_componentWillReceiveProps(nextProps) {\n        const { saleContext } = this.props;\n        const nsc = nextProps.saleContext;\n        const priceChanges = saleContext.price !== nsc.price;\n        const currencyChanges = saleContext.currencyCode !== nsc.currencyCode;\n        if (priceChanges || currencyChanges) {\n            if (!currencyIsUSD(nextProps)) {\n                const { saleContext } = nextProps;\n                convertCurrency(saleContext.currencyCode, saleContext.price, true); // FIXME: unable to comparison since price update comes first (SaleItemSidebarHead.componentWillReceiveProps())\n            }\n        }\n    }\n\n    isOptionMulti(): boolean {\n        const {\n            thing: { sales },\n        } = this.props;\n        // sales.\n        if (sales.option_meta.length > 1) {\n            return true;\n        } else if (sales.option_meta.length === 1) {\n            return sales.option_meta[0].type !== \"dropdown\";\n        } else {\n            return false;\n        }\n    }\n\n    render() {\n        const {\n            thing: { sales },\n            appContext: { applePayDisplay },\n            saleContext,\n            saleContext: { currencyCode, currencySymbol, currencyMoney, selectedQuantity, price },\n        } = this.props;\n\n        var opt = getCurrentSaleOption(sales, saleContext);\n        var discountPercentage = parseFloat(opt.discount_percentage); // TODO: use decimal?\n        var retailPrice = opt.retail_price;\n        const { soldout, quantity, remaining_quantity } = opt;\n        const { option_meta } = sales;\n        const optionIsMulti = this.isOptionMulti();\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n        const discounting = discountPercentage > 0;\n        const converted = currencySymbol != null && currencyMoney != null;\n        const currencyCodeStyle = { display: converted && !currencyIsUSD(this.props) ? \"block\" : \"none\" };\n        const quantitySelectRange = soldout ? [\"1\"] : _.range(1, Math.min(10, (quantity || remaining_quantity) + 1));\n        const showSelectbox = sales.options.length !== 0;\n\n        var cartButtonStyle;\n        if (!soldout) {\n            cartButtonStyle = { display: \"none\" };\n        }\n        const waiting = getWaiting(sales, saleContext);\n\n        var applePayButton;\n        if (applePayDisplay && !soldout) {\n            applePayButton = <ApplePayButton {...this.props} />;\n        }\n\n        return (\n            <div key={Keys.Sidebar.Wrap}>\n                <div className=\"wrapper figure-info\" key={Keys.Sidebar.Body}>\n                    <h1 key={Keys.Sidebar.Title} className=\"title\" {...getSafeNameProp(sales)} />\n                    <p className=\"price\" key={Keys.Sidebar.Price}>\n                        <big className={classnames({ sale: discounting })}>\n                            ${floatFormatMinusTwo(price)}\n                            <small className=\"usd\">\n                                <a\n                                    className={classnames(\"code\", { \"currently-usd\": currencyIsUSD(this.props) })}\n                                    onClick={this.handleCurrencyPopupUSD}>\n                                    USD\n                                </a>\n                            </small>\n                        </big>\n                        {discounting && (\n                            <span className=\"sales\">\n                                <em>${floatFormatMinusTwo(retailPrice, 2)}</em> (Save{\" \"}\n                                {numberFormat(discountPercentage, 0)}%)\n                            </span>\n                        )}\n                        <span className=\"currency_price\" style={currencyCodeStyle}>\n                            {this.getApproxText()}\n                            <a className=\"code\" onClick={this.handleCurrencyPopup}>\n                                {currencyCode}\n                            </a>\n                        </span>\n                    </p>\n                    <div className=\"frm\" key={Keys.Sidebar.Form}>\n                        <fieldset className=\"sale-item-input\">\n                            {showSelectbox && !optionIsMulti && (\n                                <SelectBox\n                                    id=\"option\"\n                                    label={gettext(\"Option\")}\n                                    currentValue={opt}\n                                    value={optionValueFunction}\n                                    printer={saleNamePrinter}\n                                    options={sales.options}\n                                    expander={SaleItemOptionsExpander}\n                                    disabled={!salesOptionsAvailable}\n                                    onChange={this.handleOptionChange}\n                                    handleSizeGuidePopup={this.handleSizeGuidePopup}\n                                />\n                            )}\n                            {showSelectbox && !optionIsMulti && (\n                                <SelectBox\n                                    id=\"quantity\"\n                                    label={gettext(\"Quantity\")}\n                                    defaultValue=\"1\"\n                                    currentValue={selectedQuantity}\n                                    options={quantitySelectRange}\n                                    disabled={!!soldout}\n                                    onChange={this.handleQuantityChange}\n                                />\n                            )}\n                            {optionIsMulti && (\n                                <MultiOption\n                                    sid={sales.id}\n                                    onClickThumbnail={this.onClickThumbnail}\n                                    onClickSwatch={this.onClickSwatch}\n                                    onMultiSelectBoxChange={this.onMultiSelectBoxChange}\n                                    onClickMutliButton={this.onClickMutliButton}\n                                    selected={this.state.selected}\n                                    disabled={this.state.disabled}\n                                    soldout={!!soldout}\n                                    option_meta={option_meta}\n                                    multiOptionState={this.state.multiOptionState}\n                                />\n                            )}\n                            {sales.personalizable && (\n                                <div className=\"personalization\">\n                                    <label>This item can be personalized</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"text\"\n                                        name=\"personalization\"\n                                        placeholder=\"Personalization details\"\n                                        onChange={this.handlePersonalizationChange}\n                                    />\n                                </div>\n                            )}\n                            {applePayButton}\n                            <CartButton\n                                onClick={this.handlePurchase}\n                                className={classnames(\"add_to_cart btn-cart\", {\n                                    \"btns-blue-embo disabled\": soldout,\n                                    \"btns-green-embo\": !soldout,\n                                })}\n                                disabled={!!soldout}\n                                label={soldout ? gettext(\"Sold out\") : gettext(\"Add to cart\")}\n                            />\n                        </fieldset>\n                        <CartButton\n                            className={classnames(\"btn-create notify-available\", { subscribed: waiting })}\n                            label={waiting ? gettext(\"Subscribed\") : gettext(\"Notify me when available\")}\n                            style={cartButtonStyle}\n                            onClick={this.handleNotifyLater}\n                        />\n                        <SalesOverview {...this.props} />\n                        <ActionButtons {...this.props} />\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nfunction SaleItemOptionsExpander(sio, idx) {\n    return (\n        <option value={sio.id} key={`sale_options-${idx}`}>\n            {sio.soldout === true || !(sio.quantity > 0) ? `${sio.name} - ${gettext(\"Sold out\")}` : sio.name}\n        </option>\n    );\n}\n\nclass ApplePayButton extends Component {\n    handleApplePayCheckout = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (window.FancyApplePay.clicked) {\n            return;\n        }\n        window.FancyApplePay.clicked = true;\n        const {\n            appContext: { /*applePayDisplay, */ applePayTest },\n        } = this.props;\n        const {\n            thing: { sales },\n            saleContext: { saleOptionID, selectedQuantity, price },\n        } = this.props;\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n\n        var title = sales.title;\n        var country = sales.seller.country;\n        var sale_item_id = sales.id;\n        var seller_id = sales.seller.id;\n        var quantity = selectedQuantity;\n\n        var option_id = null;\n        var option = null;\n        if (salesOptionsAvailable) {\n            option_id = parseInt(saleOptionID, 10) || null; // ? should be same value with option except get casted\n            option = saleOptionID;\n        }\n\n        try {\n            window.FancyApplePay.requestPurchase(\"Dynamic\", {\n                sale_item_id,\n                seller_id,\n                option_id,\n                quantity,\n                price,\n                title,\n                option,\n                country,\n                testmode: applePayTest,\n            });\n        } catch (err) {\n            window.DEBUG && console.trace(err);\n            alert(err);\n            window.FancyApplePay.clicked = false;\n        }\n    };\n\n    render() {\n        return (\n            <div\n                className=\"apple-pay-button apple-pay-thing-button apple-pay-button-with-text apple-pay-button-black-with-text checkout-express\"\n                onClick={this.handleApplePayCheckout}>\n                <span className=\"text\">Buy With</span>\n                <span className=\"logo\" />\n            </div>\n        );\n    }\n}\n\nexport class SalesOverview extends Component {\n    handleShipCountryClick = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const {\n            appContext: { userCountry },\n            dispatch,\n        } = this.props;\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\").then(({ ShippingCountriesPopup }) => {\n            renderPopup(ShippingCountriesPopup, { dispatch, userCountry });\n        });\n    };\n\n    handlePolicyDislplay = (event) => {\n        event.preventDefault();\n        const {\n            thing: { sales },\n        } = this.props;\n        if (sales) {\n            import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\").then(\n                ({ ReturnPolicyDetailPopup }) => {\n                    renderPopup(ReturnPolicyDetailPopup, { sales });\n                }\n            );\n        }\n    };\n\n    handleSizeGuidePopup = (event) => {\n        event.preventDefault();\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\").then(({ SizeGuidePopup }) => {\n            renderPopup(SizeGuidePopup, this.props);\n        });\n    };\n\n    render() {\n        const {\n            appContext: { userCountry },\n            thing,\n            type,\n        } = this.props;\n\n        const sales = getSales(type, thing)!;\n        const hasSizeGuide = sales.size_guide_id != null; /*|| (sales.size_chart_ids && sales.size_chart_ids.length)*/\n        const deliveryIsDomestic = sales && userCountry === \"US\";\n        const ableToShip =\n            (deliveryIsDomestic && sales.expected_delivery_day_1) ||\n            (userCountry !== \"US\" && sales.international_shipping);\n        const hideShippingWindow = deliveryIsDomestic && !sales.expected_delivery_day_1;\n\n        var deliveryDate;\n        if (ableToShip) {\n            if (deliveryIsDomestic) {\n                deliveryDate = getDomesticDeliveryDate(sales);\n            } else {\n                deliveryDate = getIntlDeliveryDate(sales);\n            }\n        }\n\n        const shippingInfo : { [k:string] : any } = sales.shipping_info || {};\n\n        return (\n            <div className=\"overview\">\n                <label>Overview</label>\n                <ul className=\"after\">\n                    {shippingInfo.cost && <li className=\"tips\">{shippingInfo.cost}</li>}\n                    <li\n                        className={`${deliveryIsDomestic ? \"domestic\" : \"international\"} shipping`}\n                        style={Display.NoneIf(hideShippingWindow)}>\n                        <label>{deliveryDate ? gettext(\"Estimated Delivery\") : gettext(\"Delivery\")}</label>\n                        <span className=\"able\">{shippingInfo.window}</span>\n                    </li>\n                    {shippingInfo.origin && (\n                        <li className=\"shipping\">\n                            <span>{shippingInfo.origin}</span>\n                        </li>\n                    )}\n                    {sales.return_exchange_policy_title && (\n                        <li>\n                            <label>{gettext(\"Return policy\")}</label>\n                            <span>\n                                {sales.return_exchange_policy_title + \". \"}\n                                <a onClick={this.handlePolicyDislplay}>{gettext(\"View details\")}</a>\n                            </span>\n                        </li>\n                    )}\n                    {hasSizeGuide && (\n                        <li className=\"sizeguide\">\n                            <a href=\"#\" onClick={this.handleSizeGuidePopup}>\n                                View size guide\n                            </a>\n                        </li>\n                    )}\n                </ul>\n                <div className=\"description\">\n                    <div className={classnames(\"detail show\")}>\n                        <h4 className=\"tit\">{gettext(\"Description\")}</h4>\n                        <div dangerouslySetInnerHTML={{ __html: sales.description }} />\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n","import React, { Component, lazy, Suspense } from \"react\";\nimport SaleItem from \"./SaleItem\";\n\nexport default class SidebarHead extends Component {\n    getHead(META) {\n        if (META.type === \"SaleItem\") {\n            return SaleItem;\n        } else {\n            if (META.type === \"PlainThing\") {\n                return lazy(() => import(/* webpackChunkName: \"OverlayThing.extras\" */ \"./PlainThing\"));\n            } else if (META.type === \"Giftcard\") {\n                return lazy(() => import(/* webpackChunkName: \"OverlayThing.extras\" */ \"./Giftcard\"));\n            } else if (META.type === \"Vanity\") {\n                return lazy(() => import(/* webpackChunkName: \"OverlayThing.extras\" */ \"./Vanity\"));\n            } else if (META.type === \"Hotel\") {\n                return lazy(() => import(/* webpackChunkName: \"OverlayThing.extras\" */ \"./Hotel\"));\n            } else if (META.type === \"LaunchApp\") {\n                return lazy(() => import(/* webpackChunkName: \"OverlayThing.extras\" */ \"./LaunchApp\"));\n            }\n        }\n    }\n\n    render() {\n        var {\n            thing: { META },\n            appContext: { viewer },\n        } = this.props;\n\n        if (!viewer.is_admin_any && META.type === 'PlainThing') {\n            location.href = '/';\n            return null;\n        }\n\n        const Head = this.getHead(META);\n        if (META.type === \"SaleItem\") {\n            return <Head {...this.props} fallback={<div className=\"wrapper figure-info\" />} />;\n        } else {\n            return (\n                <Suspense fallback={<div />}>\n                    <Head {...this.props} fallback={<div className=\"wrapper figure-info\" />} />\n                </Suspense>\n            );\n        }\n    }\n}\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { isEmpty, cdnUtils, didClickOn, renderPopup, getConciseNumberString } from \"fancyutils\";\nimport { BGImage, Display } from \"fancymixin\";\n\nimport appState from \"../../appstate\";\nimport { toggleFollow } from \"../../action/action-helpers\";\nimport SidebarHead from \"./heads/index\";\n\nexport class Sidebar extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            reported: props.thing.reported_by_viewer,\n            showQuestion: false,\n        };\n    }\n\n    handleRequestSaleOpen = (event) => {\n        event.preventDefault();\n        const { thing } = this.props;\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../popup/index\").then(({ RequestSalePopup }) => {\n            renderPopup(RequestSalePopup, { thing });\n        });\n        return false;\n    };\n\n    componentDidUpdate(prevProps) {\n        const nextProps = this.props;\n        if (nextProps.thing.id !== prevProps.thing.id) {\n            this.setState({ reported: nextProps.thing.reported_by_viewer });\n        }\n    }\n\n    handleReport = (event) => {\n        event.preventDefault();\n        if (!appState.loggedIn) {\n            window.require_login();\n            return;\n        }\n        const self = this;\n        if (self.state.reported) {\n            window.alertify.confirm(window.gettext(\"Cancel Report this?\"), function (e) {\n                if (e) {\n                    $.ajax({\n                        type: \"post\",\n                        url: \"/cancel_report_thing.xml\",\n                        data: { tid: self.props.thing.id },\n                        dataType: \"xml\",\n                        success(xml) {\n                            var $xml = $(xml);\n                            var $st = $xml.find(\"status_code\");\n                            if ($st.length && $st.text() === \"1\") {\n                                window.alertify.alert(window.gettext(\"Cancelled your report.\"));\n                                self.setState({ reported: false });\n                            }\n                        },\n                    });\n                }\n            });\n        } else {\n            window.alertify.confirm(window.gettext(\"Report this as inappropriate or broken?\"), function (e) {\n                if (e) {\n                    $.ajax({\n                        type: \"post\",\n                        url: \"/report_thing.xml\",\n                        data: { tid: self.props.thing.id },\n                        dataType: \"xml\",\n                        success(xml) {\n                            var $xml = $(xml);\n                            var $st = $xml.find(\"status_code\");\n                            if ($st.length && $st.text() === \"1\") {\n                                window.alertify.alert(window.gettext(\"Reported. We'll look into it.\"));\n                                self.setState({ reported: true });\n                            }\n                        },\n                    });\n                }\n            });\n        }\n    };\n\n    render() {\n        var {\n            thing,\n            thing: { META, from_list, sales, sales_available },\n        } = this.props;\n\n        // Should we display 'Request for sale' button?\n        var requestSale = !(sales_available || META.Giftcard || META.Hotel || META.LaunchApp);\n        // Should we show merchant information?\n        var sidebarMerchantInfo;\n        if (sales_available && sales.seller.is_seller && thing.type !== \"fancybox\" && thing.type !== \"vanity_number\") {\n            sidebarMerchantInfo = <SidebarMerchantInfo {...this.props} />;\n        }\n\n        var reported = appState.loggedIn && this.state.reported;\n        var reportLabel = reported ? gettext(\"Undo Reporting\") : gettext(\"Report as inappropriate\");\n\n        return (\n            <aside className=\"sidebar\">\n                <SidebarHead {...this.props} />\n                {/*<SidebarApplePayAd />*/}\n                {sidebarMerchantInfo}\n                {/*<SidebarFancydFriends {...this.props} />*/}\n                {/*(!isEmpty(added_lists) || category_item) && <SidebarAddmore thing={thing} />*/}\n                {/*from_list && <SidebarFromList {...this.props} />*/}\n                {thing && (\n                    <div className=\"flagged\">\n                        {requestSale && <a onClick={this.handleRequestSaleOpen}>{gettext(\"Request for sale\")}</a>}\n                        <a onClick={this.handleReport} className={classnames(\"report-link\", { reported })}>\n                            {reportLabel}\n                        </a>\n                    </div>\n                )}\n            </aside>\n        );\n    }\n}\n\nclass SidebarMerchantInfo extends Component {\n    handleFollowToggle = (event) => {\n        event.preventDefault();\n        if (!appState.loggedIn) {\n            return window.require_login();\n        }\n        var {\n            thing: { sales },\n            dispatch,\n        } = this.props;\n        dispatch(toggleFollow({ seller_id: sales.seller.id }));\n    };\n\n    isFollowingStore(sales, followContext) {\n        var precondition = sales.seller.id !== appState.viewer.id && sales.seller.profile_is_private !== 1;\n        var following = followContext.followStore.following === true;\n\n        return precondition && following;\n    }\n\n    render() {\n        const {\n            appContext: { viewer },\n            thing,\n            thing: {\n                sales,\n                sales: { popular_seller_saleitems },\n            },\n            followContext,\n        } = this.props;\n        const following = this.isFollowingStore(sales, followContext);\n\n        const sellerImageAttrs = {};\n        // FIXME: check serialization\n        if (sales.saleitem_seller && sales.saleitem_seller.logo_type) {\n            if (sales.saleitem_seller.logo_type.indexOf(\"resize-ec.thefancy.com/letters\") == -1) {\n                sellerImageAttrs.url = cdnUtils.resizedSchemelessImage(sales.saleitem_seller.logo_type, 360, \"crop\");\n            } else {\n                sellerImageAttrs.url = sales.saleitem_seller.logo_type.replace(/letters\\/[0-9]+\\//, \"letters/360/\");\n            }\n            sellerImageAttrs.schemeless = true;\n            sellerImageAttrs.alt = `${sales.seller.brand_name} logo image`;\n        }\n\n        const pops = _.uniq(popular_seller_saleitems, false, (e) => e.thing_id).filter((_, idx) => idx < 4);\n        // fill blanks\n        while (pops.length < 4) {\n            pops.push(null);\n        }\n\n        return (\n            <div className={classnames(\"wrapper from thing-more merchant-info\", { loading: thing.loading })}>\n                {__Config.nostore ? (\n                    <div style={{ display: \"flex\" }}>\n                        <h3 className=\"tit\">{gettext(\"You may also like\")}</h3>\n                        <h3\n                            className=\"tit\"\n                            style={{\n                                position: \"absolute\",\n                                right: 0,\n                                fontSize: \"14px\",\n                                textDecoration: \"underline\",\n                            }}>\n                            <a\n                                href={`/shop/${sales.seller.username}`}\n                                style={{\n                                    color: \"#373d48\",\n                                }}>\n                                {gettext(\"See more\")}\n                            </a>\n                        </h3>\n                    </div>\n                ) : (\n                    <a href={`/shop/${sales.seller.username}`} className=\"tit\">\n                        <BGImage {...sellerImageAttrs} />\n                        <small>{gettext(\"More from\")}</small>\n                        <b>\n                            {sales.discount_percentage > 0 && sales.seller.id === 616001\n                                ? \"Fancy Sales\"\n                                : sales.seller.brand_name}\n                        </b>\n                    </a>\n                )}\n                {!isEmpty(popular_seller_saleitems) && (\n                    <ul className=\"after\">\n                        {pops.map((si, idx) => (\n                            <li key={`popular_seller_saleitems-${idx}`}>\n                                <a\n                                    data-idx={idx}\n                                    className=\"figure-img\"\n                                    rel={si ? `thing-${si.thing_id}` : `thing`}\n                                    href={si ? si.html_url : \"#\"}\n                                    onClick={\n                                        si\n                                            ? null\n                                            : (e) => {\n                                                  e.preventDefault();\n                                              }\n                                    }>\n                                    <span\n                                        className=\"price\"\n                                        style={\n                                            si\n                                                ? {\n                                                      backgroundImage: `url(${cdnUtils.resizedSchemelessImage(\n                                                          si.image,\n                                                          160,\n                                                          \"crop\"\n                                                      )})`,\n                                                  }\n                                                : null\n                                        }\n                                    />\n                                </a>\n                            </li>\n                        ))}\n                    </ul>\n                )}\n                {!__Config.nostore && (\n                    <button\n                        className={classnames(\"btns-gray-embo\", following ? \"following\" : \"follow\")}\n                        onClick={this.handleFollowToggle}\n                        style={Display.NoneIf(viewer.id === sales.seller.id)}>\n                        {following ? gettext(\"Following\") : gettext(\"Follow\")}\n                        <small>{getConciseNumberString(sales.seller.seller_followed_count || 0)}</small>\n                    </button>\n                )}\n                <AskQuestionPopover {...this.props} />\n            </div>\n        );\n    }\n}\n\nclass AskQuestionPopover extends Component {\n    state = {\n        sending: false,\n        showQuestion: false,\n        showQuestionSuccess: false,\n        questionFile: null,\n        questionFileValue: \"\",\n        question: \"\",\n        threadUrl: \"\",\n    };\n\n    componentDidUpdate(prevProps) {\n        const nextProps = this.props;\n        if (nextProps.thing.id !== prevProps.thing.id) {\n            this.handleQuestionClose();\n        }\n    }\n\n    handleQuestionClose = (e) => {\n        if (e) {\n            e.preventDefault();\n        }\n        this.setState({\n            sending: false,\n            showQuestion: false,\n            showQuestionSuccess: false,\n            questionFile: null,\n            questionFileValue: \"\",\n            question: \"\",\n            threadUrl: \"\",\n        });\n    };\n\n    handleQuestionFileChange = (e) => {\n        let questionFile, questionFileValue;\n        if (e.target.files) {\n            questionFile = e.target.files[0];\n            questionFileValue = e.target.value;\n        } else {\n            questionFile = null;\n        }\n        this.setState({ questionFile, questionFileValue });\n    };\n\n    handleQuestionFileDelete = (e) => {\n        e.preventDefault();\n        this.setState({ questionFile: null });\n    };\n\n    handleQuestionChange = (event) => {\n        this.setState({ question: event.target.value });\n    };\n\n    handleQuestionFileSend = () => {\n        const { sending, question, questionFile } = this.state;\n        const {\n            thing,\n            thing: { sales },\n        } = this.props;\n\n        if (sending) {\n            return;\n        }\n        if (appState.loggedIn !== true) {\n            window.require_login();\n            return;\n        }\n        if ($.trim(question).length > 2048) {\n            window.alertify.alert(\"Sorry, message is too long. Please write less than 2048 characters.\");\n            return;\n        }\n        this.setState({ sending: true }, () => {\n            const formData = new window.FormData();\n            formData.append(\"seller_id\", sales.seller.id);\n            formData.append(\"things\", thing.id);\n            formData.append(\"message\", question);\n            formData.append(\"attachments\", questionFile);\n\n            $.ajax({\n                url: \"/messages/send-message.json\",\n                processData: false,\n                contentType: false,\n                type: \"POST\",\n                data: formData,\n            })\n                .done((res) => {\n                    if (!res.status_code) {\n                        window.alertify.alert(\n                            res.message || \"Sorry, we couldn't send your message right now. Please try again later.\"\n                        );\n                    } else {\n                        this.setState({ showQuestionSuccess: true, threadUrl: res.thread.url });\n                    }\n                })\n                .fail(() => {\n                    window.alertify.alert(\"Failed to send question. Please try again\");\n                })\n                .always(() => {\n                    this.setState({ sending: false });\n                });\n        });\n    };\n\n    handleAsking = () => {\n        this.setState({ showQuestion: true }, () => {\n            $(\"#overlay-thing\").on(\"click.showQuestion\", (event) => {\n                if (!didClickOn($(event.target), \".ask_seller\") && !didClickOn($(event.target), \".ask\")) {\n                    $(\"#overlay-thing\").off(\"click.showQuestion\");\n                    this.setState({ showQuestion: false });\n                    return false;\n                }\n            });\n            // due to preact behavior, need timeout. otherwise close popup right after opening\n        });\n        return false;\n    };\n\n    render() {\n        const {\n            thing: { sales },\n        } = this.props;\n        const { showQuestion, showQuestionSuccess, questionFile, sending, threadUrl } = this.state;\n\n        const sellerImageAttrs = {};\n        // FIXME: check serialization\n        if (sales.saleitem_seller && sales.saleitem_seller.logo_type) {\n            sellerImageAttrs.url = cdnUtils.resizedSchemelessImage(sales.saleitem_seller.logo_type, 80, \"crop\");\n            sellerImageAttrs.schemeless = true;\n            sellerImageAttrs.alt = `${sales.seller.brand_name} logo image`;\n        }\n        return (\n            <React.Fragment>\n                <a className=\"ask\" onClick={this.handleAsking}>\n                    {gettext(\"Ask a Question\")}\n                </a>\n                <div className=\"ask_seller\" style={Display.NoneIf(!showQuestion)}>\n                    <p className=\"title\">\n                        <BGImage {...sellerImageAttrs} /> {sales.seller.brand_name}\n                    </p>\n                    <fieldset>\n                        <p>\n                            <textarea\n                                className=\"text\"\n                                placeholder={`Ask a question about ${sales.title}`}\n                                onChange={this.handleQuestionChange}\n                            />\n                        </p>\n                        <div className=\"file\">\n                            <span className=\"uploader\" style={Display.NoneIf(questionFile)}>\n                                Add Attachment\n                                <input\n                                    type=\"file\"\n                                    onClick={this.handleQuestionAddFile}\n                                    onChange={this.handleQuestionFileChange}\n                                    value={this.state.questionFileValue}\n                                    accept=\"image/*\"\n                                />\n                            </span>\n                            <span className=\"uploaded\" style={Display.BlockIf(questionFile)}>\n                                {questionFile ? questionFile.name : \"\"}\n                                <a href=\"#\" className=\"delete\" onClick={this.handleQuestionFileDelete} />\n                            </span>\n                        </div>\n                        <button\n                            className=\"btns-blue-embo _send\"\n                            onClick={this.handleQuestionFileSend}\n                            disabled={sending}>\n                            Send\n                        </button>\n                    </fieldset>\n                    <a href=\"#\" className=\"close\" onClick={this.handleQuestionClose} />\n                    <div className=\"success\" style={Display.BlockIf(showQuestion && showQuestionSuccess)}>\n                        <p>\n                            Message sent <a href={threadUrl}>View message</a>\n                        </p>\n                        <a href=\"#\" className=\"close\" onClick={this.handleQuestionClose}>\n                            Close\n                        </a>\n                    </div>\n                </div>\n            </React.Fragment>\n        );\n    }\n}\n","import React, { Component } from 'react';\nimport classnames from 'classnames';\nimport { cdnUtils, renderPopup } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nimport {\n    getDescription,\n    getSales,\n    getDomesticDeliveryDate,\n    getIntlDeliveryDate,\n    getSaleImages,\n} from './map';\nimport { getCountryByCode } from '../data/Countries';\nimport { StaticThingViewConfig } from '../config';\nimport { getCurrentSaleOption } from './map';\n\nconst { ThumbnailsLimit } = StaticThingViewConfig;\n\n\nexport class ItemDetail extends Component {\n    DetailHeight = 175;\n    constructor(props) {\n        super(props);\n        this.state = {\n            showMore: false,\n            shortDescription: false\n        };\n    }\n\n    handlePolicyDislplay = (event) => {\n        event.preventDefault();\n        const { thing: { sales }} = this.props;\n        if (sales) {\n            import(/* webpackChunkName: \"OverlayThing.popup\" */'./popup/index')\n            .then(({ ReturnPolicyDetailPopup }) => {\n                renderPopup(ReturnPolicyDetailPopup, { sales });\n            });\n        }\n    }\n\n    handleMore = (event) => {\n        event.preventDefault();\n        this.setState({ showMore: true });\n    }\n\n    handleLess = (event) => {\n        event.preventDefault();\n        this.setState({ showMore: false });\n    }\n\n    handleViewAllImages = () => {\n        this.props.onThumbnailsLimitChange(ThumbnailsLimit.More);\n    }\n/*\n    handleCheckArea(event) {\n        // TODO: check log in\n        event.preventDefault();\n    }\n*/\n    handleSelectImage = (event) => {\n        event.preventDefault();\n        const idx = parseInt($(event.currentTarget).attr('data-idx'));\n        const saleOptionID = parseInt($(event.currentTarget).closest('li').attr('data-option-id')) || undefined;\n        this.props.handleChangeFigure(idx, saleOptionID);\n    }\n\n    setDescriptionDisplayState = () => {\n        const detailRef = $(this.detail);\n        var shortDescription;\n        if (detailRef.length > 0) {\n            // Get some of very first two children, which is not 'more' or 'less'\n            shortDescription = detailRef.children()\n                                        .filter(i => i <= 1)\n                                        .toArray()\n                                        .reduce((p, n) => p + $(n).outerHeight(), 0) < this.DetailHeight;\n        } else {\n            shortDescription = false;\n        }\n        this.props.onThumbnailsLimitChange(ThumbnailsLimit.Basic);\n        this.setState({\n            shortDescription,\n            showMore: false,\n        });\n    }\n\n    componentDidMount() {\n        this.setDescriptionDisplayState();\n    }\n\n    componentDidUpdate(prevProps) {\n        if (prevProps.appContext.lastFullyRenderedThingID !==\n            this.props.appContext.lastFullyRenderedThingID\n        ) {\n            this.setDescriptionDisplayState();\n        }\n    }\n\n    render () {\n        const {\n            //appContext: { userCountry },\n            thing,\n            thing: { META },\n            type,\n            slideContext: { thumbnailIndex },\n            thumbnailsLimit, \n            saleContext\n        } = this.props;\n        const { shortDescription, showMore } = this.state;\n\n        const sales = getSales(type, thing);\n        const option = getCurrentSaleOption(sales, saleContext, true);\n\n        const saleImages = getSaleImages(thing, option, thumbnailsLimit);\n\n        if (type === 'urlOnly') {\n            if(thing.user){\n                return (\n                    <div className=\"figure-detail after\" key=\"thing-figure-detail\" style={Display.NoneIf(thing.loading)}>\n                        <p className=\"asset\">\n                            {gettext(\"Added by \")}\n                            <a href={thing.user.html_url} target=\"_blank\">\n                                {thing.user.full_name}\n                            </a>\n                        </p>\n                    </div>\n                );\n            } else {\n                return null;\n            }\n        }\n\n        return (\n            <div className=\"figure-detail after\" key=\"thing-figure-detail\" style={Display.NoneIf(thing.loading)}>\n                <div className=\"thumbnail-list\">\n                    <ul className=\"after\">\n                        {saleImages\n                            .map((image, idx) => {\n                                const thumbIsVideo = image.thumbType === 'video';\n                                const thumbnailURL = (thumbIsVideo || META.Hotel) ? image.src : cdnUtils.getResizeURL(image.src, 100, 'crop', true, true);\n                                const optionProps = {};\n                                if (image.option_name) {\n                                    optionProps['data-option-name'] = image.option_name;\n                                }\n                                if (image.option_id) {\n                                    optionProps['data-option-id'] = image.option_id;\n                                }\n                                return (\n                                    <li key={idx} className={thumbnailIndex === idx ? 'current' : null} {...optionProps}>\n                                        <a data-idx={idx}\n                                           style={{ backgroundImage: `url(${thumbnailURL})`}}\n                                           className={classnames(\"thumb\", { \"active\": thumbnailIndex === idx, \"video-thumb\": thumbIsVideo })}\n                                           onClick={this.handleSelectImage}\n                                        />\n                                    </li>\n                                );\n                            })\n                        }\n                        {(saleImages.length >= thumbnailsLimit) &&\n                            <li>\n                                <a className=\"more\" onClick={this.handleViewAllImages}>{gettext(\"View all images\")}</a>\n                            </li>\n                        }\n                    </ul>\n                </div>\n                <div className=\"description\">\n                    <div className={classnames(\"detail\", { 'show': showMore, 'short': shortDescription })} ref={(element) => {this.detail = element;}}>\n                        <h4 className=\"tit\">{gettext('Description')}</h4>\n                        <div dangerouslySetInnerHTML={{ __html: getDescription(type, thing) }}/>\n                        <a onClick={this.handleMore} className=\"more\">{gettext(\"Show More\")}</a>\n                        <a onClick={this.handleLess} className=\"less\">{gettext(\"Show Less\")}</a>\n                    </div>\n                    {(type === 'sales') &&\n                        <ul className=\"after\">\n                            {/*sales.available_for_sameday_shipping &&\n                                <li>\n                                    <label>{gettext('Same-Day Delivery')}</label>\n                                    <span className=\"same-delivery\">\n                                        <i className=\"icon\"></i>{gettext('Get it delivered today.')}\n                                        <a onClick={this.handleCheckArea}\n                                           className=\"same-day-shipping-pop\"> {gettext('Check your area')}\n                                        </a>\n                                    </span>\n                                </li>\n                            */}\n                        </ul>\n                    }\n                </div>\n            </div>\n        );\n    }\n}\n\nexport class DeliveryInformation extends Component {\n    handleShipCountryClick = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const { appContext: { userCountry }, dispatch } = this.props;\n        import(/* webpackChunkName: \"OverlayThing.popup\" */'./popup/index')\n            .then(({ ShippingCountriesPopup }) => {\n                renderPopup(ShippingCountriesPopup, { dispatch, userCountry });\n            });\n    };\n\n    render() {\n        const { appContext: { userCountry }, thing, type } = this.props;\n\n        const sales = getSales(type, thing);\n        const deliveryIsDomestic = sales && userCountry === 'US';\n        const ableToShip = (deliveryIsDomestic && sales.expected_delivery_day_1) ||\n                           userCountry !== 'US' && sales.international_shipping;\n        const hideShippingWindow = deliveryIsDomestic && !sales.expected_delivery_day_1;\n\n        var deliveryDate;\n        if (ableToShip) {\n            if (deliveryIsDomestic) {\n                deliveryDate = getDomesticDeliveryDate(sales)\n            } else {\n                deliveryDate = getIntlDeliveryDate(sales)\n            }\n        }\n\n        return <li className={`${deliveryIsDomestic ? 'domestic' : 'international'} shipping`}\n                   style={Display.NoneIf(!ableToShip)}>\n            <label>{deliveryDate ? gettext('Estimated Delivery') : gettext('Delivery')}</label>\n            <span className=\"able\" style={Display.NoneIf(!ableToShip)}>\n                {deliveryDate ? `${deliveryDate} days to ` : 'Ships to '}\n                <a onClick={this.handleShipCountryClick}>{getCountryByCode(userCountry)}</a>\n            </span>\n            <span className=\"unable\" style={Display.NoneIf(ableToShip || hideShippingWindow)}>\n                Unable to ship to <a onClick={this.handleShipCountryClick}>{userCountry}</a>\n            </span>\n        </li>\n    }\n}\n","import React, { Component } from \"react\";\nimport assign from \"object-assign\";\nimport classnames from \"classnames\";\nimport { schemeless, isEmpty, promisifiedFetchImage, renderPopup, minmax, getLocationArgPairs } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\nimport { Video } from \"common-components\";\n\nimport { deleteThing } from \"../API\";\nimport { setThumbnailIndex } from \"../action/actions\";\nimport { updateSaleContext } from \"../action/action-helpers\";\nimport { getCurrentSaleOption, getSaleItemId, getDetailType, getSaleImages, getSeller } from \"./map\";\nimport { ItemDetail } from \"./ThingDetails\";\nimport { StaticThingViewConfig, ThingViewConfig } from \"../config\";\nimport { OverlayPropsV1 } from \"ftypes\";\n\nconst { zoomMargin, zoomBoxSize, zoomScale } = ThingViewConfig;\nconst { ThumbnailsLimit } = StaticThingViewConfig;\n\nexport default class Thing extends Component<OverlayPropsV1, {\n    loaded: boolean,\n    zoom: boolean,\n    zoomImageStyle: Object,\n    thumbnailsLimit: number\n}> {\n    transitionDuration = 350;\n    constructor(props) {\n        super(props);\n        this.state = {\n            loaded: true,\n            zoom: false,\n            zoomImageStyle: Display.None,\n            thumbnailsLimit: ThumbnailsLimit.Basic\n        };\n        $(window).on(\"resize.ThingView\", () => {\n            ThingViewConfig.boundarySize = $(\"#overlay-thing .figure-item figure:visible\").width();\n        });\n    }\n\n    componentDidMount() {\n        $(window).trigger(\"resize.ThingView\");\n    }\n\n    _isRequestFresh = (savedTID: string) => {\n        return !this.state.loaded && savedTID === this.props.thing.id;\n    };\n\n    changeFigureTo = (index, saleOptionID) => {\n        const tid = this.props.thing.id;\n        if (saleOptionID) {\n            this.props.dispatch(updateSaleContext({ saleOptionID }));\n        }\n        if (index !== this.props.slideContext.thumbnailIndex && this.state.loaded === true) {\n            this.setState({ loaded: false }, () => {\n                setTimeout(() => {\n                    if (this._isRequestFresh(tid)) {\n                        this.props.dispatch(setThumbnailIndex(index));\n                        promisifiedFetchImage(\n                            this.getImage(index).src,\n                            () => {\n                                if (this._isRequestFresh(tid)) {\n                                    this.setState({ loaded: true });\n                                }\n                            },\n                            1500\n                        );\n                    }\n                }, this.transitionDuration);\n            });\n        }\n    };\n\n    getAbsoluteIndex = diff => {\n        var {\n            thing,\n            thing: { sales },\n            slideContext,\n            saleContext\n        } = this.props;\n        const option = getCurrentSaleOption(sales, saleContext, true);\n        var thingImagesLength = getSaleImages(thing, option).length;\n        var nextIndex = slideContext.thumbnailIndex + diff;\n        var ret;\n        // => end of index reached (reversed)\n        if (nextIndex < 0) {\n            ret = (nextIndex + thingImagesLength) % thingImagesLength;\n            // => end of index reached\n        } else if (nextIndex >= thingImagesLength) {\n            ret = 0;\n        } else {\n            ret = nextIndex % thingImagesLength;\n        }\n        return ret;\n    };\n\n    handlePrev = event => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.changeFigureTo(this.getAbsoluteIndex(-1));\n    };\n\n    handleNext = event => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.changeFigureTo(this.getAbsoluteIndex(+1));\n    };\n\n    isZoomable = () => {\n        const { boundarySize } = ThingViewConfig;\n        return this.getImage().width > boundarySize;\n    };\n\n    // Calculate zoomed image dimension.\n    getZoomImageDimension = img => {\n        const { boundarySize } = ThingViewConfig;\n        return {\n            width: boundarySize * zoomScale + zoomMargin,\n            height: ((boundarySize * img.height) / img.width) * zoomScale + zoomMargin\n        };\n    };\n\n    // TODO: cache\n    getImageMeta = img => {\n        const { boundarySize } = ThingViewConfig;\n        let width, height, marginHoriz, marginVert;\n\n        // responsive encoding\n        // - regular mode\n        const $fig = $(\"#overlay-thing .figure-item figure\");\n        if ($(window).width() > 700) {\n            width = $fig.width();\n            height = $fig.height();\n            marginHoriz = 0;\n            if (width > height) {\n                marginHoriz = 0;\n                marginVert = (boundarySize - height) / 2;\n            } else {\n                marginHoriz = (boundarySize - width) / 2;\n                marginVert = 0;\n            }\n        // - mobile mode\n        } else {\n        }\n        return { width, height, marginHoriz, marginVert };\n    };\n\n    moveZoomImage = (pageX, pageY) => {\n        const { boundarySize } = ThingViewConfig;\n        const $wrapper = $(this.wrapper);\n        const img = this.getImage();\n        const meta = this.getImageMeta(img);\n\n        const offset = $wrapper.offset();\n        const left = pageX - offset.left;\n        const top = pageY - offset.top;\n\n        // Fishy\n        const topPosition = top - (boundarySize - meta.height) / 2;\n        let showZoomImage;\n        if ($(window).width() <= 700) {\n            showZoomImage = false;\n        } else {\n            showZoomImage = left > 0 && topPosition > 0 && topPosition < meta.height;\n        }\n\n        var zoomImageStyle;\n        if (showZoomImage) {\n            const zd = this.getZoomImageDimension(img);\n            const zoomImageContainerX = minmax(\n                left - zoomMargin,\n                meta.marginHoriz,\n                meta.marginHoriz + meta.width - zoomBoxSize\n            ); // 0 need to be fixed\n            const zoomImageContainerY = minmax(\n                top - zoomMargin,\n                meta.marginVert,\n                meta.marginVert + meta.height - zoomBoxSize\n            ); // 0 need to be fixed\n\n            const backgroundLeft = (zd.width * left) / boundarySize - zoomMargin;\n            const backgroundTop = (zd.height * top) / boundarySize - zoomMargin;\n\n            const bgPosX = -minmax(backgroundLeft, 0, zd.width - zoomBoxSize);\n            const bgPosY = -minmax(backgroundTop, 0, zd.height - zoomBoxSize);\n\n            zoomImageStyle = {\n                left: `${zoomImageContainerX}px`,\n                top: `${zoomImageContainerY}px`,\n                backgroundPosition: `${bgPosX}px ${bgPosY}px`,\n                display: \"inline\"\n            };\n        } else {\n            zoomImageStyle = Display.None;\n        }\n        this.setState({ zoomImageStyle }); // FIXME\n    };\n\n    handleZoomBGClick = event => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (this.isZoomable()) {\n            const nextZoom = !this.state.zoom;\n            this.setState({ zoom: nextZoom });\n            if (nextZoom) {\n                this.moveZoomImage(event.pageX, event.pageY);\n            }\n        }\n    };\n\n    handleZoomBGMouseMove = ({ pageX, pageY }) => {\n        // TODO: deactivate event on video thing\n        if (this.state.zoom) {\n            this.moveZoomImage(pageX, pageY);\n        }\n    };\n\n    // Disable zoom mode when zoom mode is on.\n    handleZoomImageClick = event => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setState({ zoom: false });\n    };\n\n    getImage = () => {\n        const {\n            thing,\n            thing: { sales },\n            slideContext: { thumbnailIndex },\n            saleContext\n        } = this.props;\n        const { thumbnailsLimit } = this.state;\n        const option = getCurrentSaleOption(sales, saleContext, true);\n        const saleImages = getSaleImages(thing, option, thumbnailsLimit);\n        if (saleImages.length > thumbnailIndex) {\n            return saleImages[thumbnailIndex];\n        } else {\n            return saleImages[0];\n        }\n    };\n\n    getImageURL = () => {\n        const image = this.getImage();\n        return `url(${schemeless(image.src)})`;\n    };\n\n    // Set zoomed image's style\n    getZoomImageStyle() {\n        var ret = {};\n        if (this.isZoomable() && this.state.zoom) {\n            const img = this.getImage();\n            const zd = this.getZoomImageDimension(img);\n            assign(ret, this.state.zoomImageStyle, {\n                backgroundSize: `${zd.width}px ${zd.height}px`,\n                backgroundImage: `url(${img.src})`\n            });\n        } else {\n            ret.display = \"none\";\n        }\n\n        return ret;\n    }\n\n    getBGImageStyle = () => {\n        const { boundarySize } = ThingViewConfig;\n        const style = {\n            backgroundImage: this.getImageURL(),\n            opacity: this.state.loaded ? 1 : 0,\n        };\n\n        if (this.props.slideContext.thumbnailIndex !== 0) {\n            style.lineHeight = `${boundarySize - 2}px`;\n            style.height = boundarySize;\n        }\n\n        return style;\n    };\n\n    shouldVideoDisplayed = () => {\n        const currentThumbIsVideo = this.getImage().thumbType === \"video\";\n        return currentThumbIsVideo;\n    };\n\n    isFit() {\n        return this.getImage().width > 640 || this.props.slideContext.thumbnailIndex === 0;\n    }\n\n    handleThumbnailsLimitChange = thumbnailsLimit => {\n        this.setState({ thumbnailsLimit });\n    };\n\n    handleEdit = () => {\n        const { appContext, thing } = this.props;\n        import(/* webpackChunkName: \"OverlayThing.popup\" */'./popup/index')\n            .then(({ EditPopup }) => {\n                renderPopup(EditPopup, { appContext, thing });\n            });\n    };\n\n    handleDelete = event => {\n        event.preventDefault();\n        event.stopPropagation();\n        deleteThing(this.props.thing);\n    };\n\n    // to keep image boundary as limit of height 640px\n    // https://app.asana.com/0/260912680807/231933133767205\n    MaxDimension = 640;\n    getBoundaryImageStyle = () => {\n        let { width, height } = this.getImage();\n        // let dominant;\n        if (height > width) {\n            if (height > this.MaxDimension) {\n                width = width / (height / this.MaxDimension);\n                height = this.MaxDimension;\n            }\n        }\n        return _.extend(\n            {\n                width,\n                height\n            },\n            Display.NoneIf(this.shouldVideoDisplayed())\n        );\n    };\n\n    // second-positioned vids need to be vertically centered.\n    // https://app.asana.com/0/260912680807/506063369708942/f\n    handleVideoStyle = () => {\n        if (this.props.slideContext.thumbnailIndex !== 0 && this.shouldVideoDisplayed()) {\n            return {\n                top: `${($(\"#overlay-thing .figure-item .figure\").height() -\n                    $(\"#overlay-thing .video_player\").height()) /\n                    2}px`\n            };\n        }\n        return {};\n    };\n\n    componentDidUpdate(nextProps) {\n        const thumbnailChanged = nextProps.slideContext.thumbnailIndex !== this.props.slideContext.thumbnailIndex;\n        if (thumbnailChanged && nextProps.slideContext.thumbnailIndex > this.state.thumbnailsLimit - 1) {\n            this.handleThumbnailsLimitChange(ThumbnailsLimit.More);\n        }\n    }\n\n    render() {\n        var {\n            appContext: { viewer, lastFullyRenderedThingID },\n            thing,\n            thing: { sales, META },\n            saleContext\n        } = this.props;\n        var type = getDetailType(thing);\n\n        // Admin sale item view\n        var saleItemId = getSaleItemId(thing, viewer);\n        var seller = getSeller(thing);\n        var showZoom = this.isZoomable();\n        const option = getCurrentSaleOption(sales, saleContext, true);\n\n        const videoDisplay = this.shouldVideoDisplayed();\n        // show prev/next arrow only for sale items\n        var prevNextStyle;\n        if (\n            META.PlainThing ||\n            META.LaunchApp ||\n            getSaleImages(thing, option, 2).length !== 2 // When image is only 1 (or possibly 0)\n        ) {\n            prevNextStyle = Display.None;\n        }\n        return (\n            <div\n                className=\"wrapper figure-section\"\n                ref={element => {\n                    this.wrapper = element;\n                }}>\n                <div className={classnames(\"figure-item\", { video: videoDisplay })}>\n                    <figure>\n                        <span\n                            onClick={this.handleZoomBGClick}\n                            onMouseMove={this.handleZoomBGMouseMove}\n                            className={classnames(\"figure\", {\n                                startZoom: this.state.zoom,\n                                zoomShow: showZoom,\n                                loading: thing.loading\n                            })}\n                            style={this.getBGImageStyle()}>\n                            {Video.isVideoAvailableForThing(thing) && (\n                                <Video\n                                    object={thing}\n                                    display={videoDisplay}\n                                    lastFullyRenderedObjectID={lastFullyRenderedThingID}\n                                    allow={{ fullScreen: true }}\n                                    style={this.handleVideoStyle()}\n                                />\n                            )}\n                            <em\n                                className=\"zoomImage\"\n                                onClick={this.handleZoomImageClick}\n                                style={this.getZoomImageStyle()}\n                            />\n                            <img\n                                src={schemeless(this.getImage().src)}\n                                className={this.isFit() ? \"fit\" : undefined}\n                                style={this.getBoundaryImageStyle()}\n                                alt={thing.emojified_name || thing.name}\n                            />\n                            <a onClick={this.handlePrev} className=\"prev\" style={prevNextStyle} />\n                            <a onClick={this.handleNext} className=\"next\" style={prevNextStyle} />\n                        </span>\n                        {!isEmpty(thing.user) && !isEmpty(thing.user.username) && (\n                            <span className=\"submitted\">\n                                Submitted by <b>{thing.user.username}</b>\n                            </span>\n                        )}\n                        <span className=\"figure-button\">\n                            {saleItemId &&\n                                seller &&\n                                (viewer.is_admin_senior ||\n                                    viewer.is_admin_business ||\n                                    viewer.is_admin_brand ||\n                                    viewer.is_admin_cs) && (\n                                    <a\n                                        href={`/merchant/products/${saleItemId}/edit?seller_id=${seller.id}`}\n                                        className=\"edit_sale\"\n                                        target=\"_blank\">\n                                        {gettext(\"Edit Sale\")} <small>({gettext(\"Moderator\")})</small>\n                                    </a>\n                                )}\n                            {!isEmpty(sales) &&\n                                (viewer.id == seller.id && !(viewer.is_admin_senior || viewer.is_admin_business)) && (\n                                    <a href={`/merchant/products/${sales.id}/edit`} className=\"edit_sale\" target=\"_blank\">\n                                        {gettext(\"Edit Sale\")}\n                                    </a>\n                                )}\n                            {(thing.can_be_modified || viewer.is_admin_content || viewer.is_admin_business) && (\n                                <a className=\"edit\" onClick={this.handleEdit}>\n                                    {gettext(\"Edit\")}\n                                </a>\n                            )}\n                            {((!isEmpty(thing.user) &&\n                                thing.user.username != null &&\n                                thing.user.username === viewer.username) ||\n                                viewer.is_admin_senior ||\n                                viewer.is_admin_business) && (\n                                <a className=\"remove_new_thing delete\" onClick={this.handleDelete}>\n                                    {gettext(\"Delete item\")}\n                                </a>\n                            )}\n                        </span>\n                    </figure>\n                    {type && (\n                        <ItemDetail\n                            {...this.props}\n                            type={type}\n                            handleChangeFigure={this.changeFigureTo}\n                            thumbnailsLimit={this.state.thumbnailsLimit}\n                            onThumbnailsLimitChange={this.handleThumbnailsLimitChange}\n                        />\n                    )}\n                </div>\n            </div>\n        );\n    }\n}\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { numberFormat, isPlainLeftClick } from \"fancyutils\";\nimport { MoreShareFacade } from \"common-components\";\n\nimport appState from \"../appstate\";\nimport { addItemToCart, logAddCartMixpanel } from \"./map.cart\";\nimport { getSafeNameProp, getThingName } from \"./map\";\nimport { LinkTypes, transition } from \"../container/routeutils\";\nimport { FancydUsers } from \"./FancydUsers\";\nimport { OtContainer } from \"../container/entry-events\";\n\nconst itemTraits = {\n    article: {\n        utm: \"article\",\n        section: \"items\",\n        via: \"article\",\n    },\n    similar: {\n        section: \"recommended\",\n        utm: \"rec\",\n        via: \"thing more\",\n    },\n    recently: {\n        section: \"recently viewed\",\n        utm: \"rv\",\n        via: \"thing more\",\n    },\n};\n\nexport default class ThingCard extends Component {\n    state = {\n        fancydCount: 0,\n        quantity: 1,\n        optionID: null,\n        showCart: false,\n        popupOpened: false,\n    };\n\n    constructor(props) {\n        super(props);\n        this.handleLinkClick = _.throttle(this.handleLinkClick, 500);\n    }\n\n    componentDidMount() {\n        this.setState({ fancydCount: this.props.fancyd_count || 0 });\n    }\n\n    componentWillUnmount() {\n        this.unmounted = true;\n    }\n\n    handleCartAddition = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.addToCart();\n    };\n\n    addToCart = () => {\n        if (!appState.loggedIn) {\n            window.require_login && window.require_login();\n            return;\n        }\n        const { id, itemType } = this.props;\n        const { quantity } = this.state;\n\n        const sales = this.getSales();\n        const saleAvailable = this.isSaleAvailable();\n        const saleOptionExists = this.isSaleOptionExists();\n        const option = this.getSaleOption();\n\n        if (!saleAvailable || this.state.loading) {\n            return;\n        }\n        if (isNaN(quantity) || quantity <= 0) {\n            alert(gettext(\"Please select a valid quantity.\"));\n            return;\n        }\n\n        const param = {\n            seller_id: sales.seller.id, // sisi\n            thing_id: id, // tid\n            sale_item_id: sales.sale_id, // sii\n            quantity,\n        };\n        if (saleOptionExists && option) {\n            param.option_id = option.id;\n        }\n\n        const traits = itemTraits[itemType];\n        const title = getThingName(this.props);\n        this.setState({ loading: true }, () => {\n            const log = {\n                salesID: sales.sale_id,\n                utm: traits.utm,\n                section: traits.section,\n                via: traits.via,\n            };\n            if (option) {\n                log.saleOptionID = option.id;\n            }\n            logAddCartMixpanel(log);\n            // ga shit\n            const discounting = sales && sales.discount_percentage !== \"0\";\n            const meta = {\n                title,\n                price: discounting ? sales.retail_price : sales.deal_price,\n                brand_name: sales.seller.brand_name,\n            };\n            addItemToCart(\n                param,\n                () => {\n                    if (!this.unmounted) {\n                        this.setState({ loading: false });\n                    }\n                },\n                meta\n            );\n        });\n    };\n\n    handleQuickCartToggle = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const saleAvailable = this.isSaleAvailable();\n        const saleOptionExists = this.isSaleOptionExists();\n        if (saleAvailable) {\n            if (saleOptionExists) {\n                this.setState({ showCart: !this.state.showCart });\n            } else {\n                this.addToCart();\n            }\n        } else {\n            this.setState({ showCart: !this.state.showCart });\n        }\n    };\n\n    isSaleAvailable = () => {\n        const { sales_available } = this.props;\n        const sales = this.getSales();\n        if (sales) {\n            return sales_available && sales.quantity !== 0;\n        } else {\n            return false;\n        }\n    };\n\n    getSaleOption = () => {\n        const saleOptionExists = this.isSaleOptionExists();\n        const sales = this.getSales();\n        if (sales && saleOptionExists) {\n            const optionID = this.state.optionID || sales.options[0].id;\n            const option = sales.options.filter((option) => option.id === optionID)[0] || null;\n            return option;\n        } else {\n            return null;\n        }\n    };\n\n    isSaleOptionExists = () => {\n        const sales = this.getSales();\n        if (sales) {\n            return sales.has_options === true;\n        } else {\n            return false;\n        }\n    };\n\n    isSaleOptionAvailable = () => {\n        const option = this.getSaleOption();\n        if (option) {\n            return option.available_for_sale === true && option.quantity !== 0;\n        } else {\n            return false;\n        }\n    };\n\n    getSales = () => {\n        return this.props.sales;\n    };\n\n    getFancydCount = () => {\n        return _.isNumber(this.state.fancydCount) ? this.state.fancydCount : this.props.fancyd_count;\n    };\n\n    handleFancydCount = (diff) => {\n        this.setState({\n            fancydCount: this.state.fancydCount + diff,\n        });\n    };\n\n    getQuantityRange = () => {\n        const saleOptionExists = this.isSaleOptionExists();\n        var max;\n        if (saleOptionExists && this.isSaleOptionAvailable()) {\n            max = this.getSaleOption().quantity;\n        } else if (this.isSaleAvailable()) {\n            max = this.getSales().quantity;\n        }\n        return max == null ? [\"1\"] : _.range(1, Math.min(10, max + 1));\n    };\n\n    handleOptionChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setState({ optionID: parseInt(event.target.value, 10), quantity: 1 });\n    };\n\n    handleOptionQuantityChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setState({ quantity: parseInt(event.target.value, 10) });\n    };\n\n    handleTrickClick = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setState({ showCart: false });\n    };\n\n    handleRecentlyDelete = () => {\n        $.post(\"/remove_recently_viewed_thing\", { thing_id: this.props.id }, (json) => {\n            if (!json || json.status_code !== 1) {\n                window.alertify.alert(`Sorry, failed to remove \"${this.props.name}\". Please retry.`);\n            } else {\n                this.props.onDelete(this.props);\n            }\n        }).fail(() => {\n            window.alertify.alert(`Sorry, failed to remove \"${this.props.name}\". Please retry.`);\n        });\n    };\n\n    handleLinkClick = (event) => {\n        event.stopPropagation();\n        if (isPlainLeftClick(event)) {\n            event.preventDefault();\n            OtContainer.scrollToTop();\n\n            transition(this.html_url(), LinkTypes.Timeline);\n        }\n    };\n\n    handleShowSomething = (popupOpened) => {\n        this.setState({ popupOpened });\n    };\n\n    handleNotifySoldout = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!appState.loggedIn) {\n            return window.require_login();\n        }\n        const sales = this.getSales();\n        const params = { sale_item_id: sales.sale_id };\n        const waiting = this.getWaiting(sales);\n        if (waiting) {\n            params.remove = 1;\n        }\n\n        $.ajax({\n            type: \"post\",\n            url: \"/wait_for_product.json\",\n            data: params,\n            dataType: \"json\",\n        })\n            .done((json) => {\n                if (!json || json.status_code == null) {\n                    return;\n                }\n                if (json.status_code == 0 && json.message) {\n                    window.alertify.alert(json.message);\n                    return;\n                }\n                const waiting = params.remove ? false : true;\n                this.setState({ waiting });\n            })\n            .fail(function (json) {\n                if (json && json.message) {\n                    window.alertify.alert(json.message);\n                } else {\n                    window.alertify.alert(\"There was an error while processing your request. Please try again later.\");\n                }\n            });\n    };\n\n    getWaiting = () => {\n        const sales = this.getSales();\n        if (sales) {\n            if (this.state.waiting == null) {\n                return sales.waiting;\n            } else {\n                return this.state.waiting;\n            }\n        } else {\n            return false;\n        }\n    };\n\n    html_url = () => {\n        const { utm } = itemTraits[this.props.itemType] || {};\n        return `${this.props.html_url}${utm ? \"?utm=\" + utm : \"\"}`;\n    };\n\n    render() {\n        const { id, thumb_image_url_310, thumb_image_url_558, itemIdx, loggedIn, viewer } = this.props;\n        const { showCart, loading, popupOpened } = this.state;\n        const html_url = this.html_url();\n\n        const sales = this.getSales();\n        const discounting = sales && sales.discount_percentage !== \"0\";\n        const waiting = this.getWaiting();\n\n        const saleAvailable = this.isSaleAvailable();\n        const saleOptionExists = this.isSaleOptionExists();\n        const saleOptionAvailable = this.isSaleOptionAvailable();\n        const showFrom =\n            sales && sales.max_price !== null && sales.min_price !== null && sales.max_price > sales.min_price;\n\n        return __Config.new_card ? (\n            <li className={classnames({ \"quick-cart\": loading, active: popupOpened || showCart })}>\n                <div className={classnames(\"figure-item new\", { toggled: showCart })}>\n                    <figure>\n                        <a\n                            href={html_url}\n                            rel={`thing-${id}`}\n                            onClick={this.handleLinkClick}\n                            data-prevent-overlay=\"true\">\n                            <span className=\"figure\">\n                                <img\n                                    src=\"/_ui/images/common/blank.gif\"\n                                    style={{ backgroundImage: `url(${thumb_image_url_558 || thumb_image_url_310})` }}\n                                />\n                            </span>\n                        </a>\n                        <div className=\"buttons\">\n                            <FancydUsers\n                                thing={this.props}\n                                appContext={this.props.appContext}\n                                displayCount={6}\n                                showFancydUser={false}\n                            />\n                            <MoreShareFacade\n                                objectType=\"thing\"\n                                objectId={id}\n                                loggedIn={loggedIn}\n                                title={getThingName(this.props)}\n                                viewerUsername={viewer.username}\n                                onShowSomething={this.handleShowSomething}\n                            />\n                        </div>\n                        <div\n                            className={classnames(\"show_cart\", { opened: showCart })}\n                            style={!sales ? { display: \"none\" } : undefined}>\n                            {sales && (\n                                <button\n                                    className=\"btn-cart nopopup\"\n                                    onClick={this.handleCartAddition}\n                                    disabled={!saleOptionAvailable}>\n                                    <em>Add to Cart</em>\n                                </button>\n                            )}\n                            <em className=\"sale-item-input\">\n                                <small\n                                    className=\"trick\"\n                                    style={{ display: showCart ? \"block\" : undefined }}\n                                    onClick={this.handleTrickClick}\n                                />\n                                {saleAvailable ? (\n                                    <span className=\"frm\">\n                                        {saleOptionExists && (\n                                            <select\n                                                name=\"option_id\"\n                                                id={`${id}-option_id`}\n                                                onChange={this.handleOptionChange}>\n                                                {sales.options.map((option, i) => (\n                                                    <option\n                                                        key={`other-item-${itemIdx}-saleoption-${i}`}\n                                                        value={option.id}>\n                                                        {option.option} -{\" \"}\n                                                        {!option.available_for_sale || option.quantity === 0\n                                                            ? gettext(\"Sold out\")\n                                                            : `$${numberFormat(option.deal_price, 0)}`}\n                                                    </option>\n                                                ))}\n                                            </select>\n                                        )}\n                                        <select\n                                            className=\"option\"\n                                            id={`${id}-quantity`}\n                                            name=\"quantity\"\n                                            disabled={!saleOptionAvailable}\n                                            onChange={this.handleOptionQuantityChange}>\n                                            {this.getQuantityRange().map((e, i) => (\n                                                <option key={`other-item-${itemIdx}-quantityOption-${i}`} value={e}>\n                                                    {e}\n                                                </option>\n                                            ))}\n                                        </select>\n                                        <button\n                                            className=\"add_to_cart btns-green-embo\"\n                                            onClick={this.handleCartAddition}\n                                            disabled={!saleOptionAvailable}>\n                                            {gettext(\"Add to Cart\")}\n                                        </button>\n                                    </span>\n                                ) : (\n                                    <span className=\"frm\">\n                                        <span className=\"notify-soldout\">Sorry, this item has sold out</span>\n                                        <button\n                                            className={classnames(\"btns-green-embo btn-notify\", {\n                                                subscribed: waiting,\n                                            })}\n                                            onClick={this.handleNotifySoldout}>\n                                            {waiting ? \"Subscribed\" : \"Notify me when available\"}\n                                        </button>\n                                    </span>\n                                )}\n                            </em>\n                        </div>\n                    </figure>\n                    <figcaption>\n                        <a\n                            href={html_url}\n                            className=\"title\"\n                            rel={`thing-${id}`}\n                            onClick={this.handleLinkClick}\n                            data-prevent-overlay=\"true\">\n                            <b className=\"title\" {...getSafeNameProp(this.props)} />\n                            {sales && (\n                                <span\n                                    className={`price ${discounting ? \"sales\" : \"\"} ${saleAvailable ? \"\" : \"soldout\"}`}>\n                                    {discounting && (\n                                        <small key=\"ThingCard2-price-deal\">\n                                            ${numberFormat(sales.retail_price, 0)}\n                                        </small>\n                                    )}\n                                    {showFrom ? (\n                                        <React.Fragment>\n                                            <em className=\"from\">from </em> ${numberFormat(sales.min_price, 0)}\n                                        </React.Fragment>\n                                    ) : (\n                                        `$\n                                        ${numberFormat(sales.deal_price, 0)}`\n                                    )}\n                                </span>\n                            )}\n                        </a>\n                    </figcaption>\n                    <a className=\"delete\" onClick={this.handleRecentlyDelete} />\n                </div>\n            </li>\n        ) : (\n            <li className={classnames({ \"quick-cart\": loading, active: popupOpened || showCart })}>\n                <div className={classnames(\"figure-item\", { toggled: showCart })}>\n                    <figure>\n                        <a\n                            href={html_url}\n                            rel={`thing-${id}`}\n                            onClick={this.handleLinkClick}\n                            data-prevent-overlay=\"true\">\n                            <span className=\"back\" />\n                            <span className=\"figure\">\n                                <img\n                                    src=\"/_ui/images/common/blank.gif\"\n                                    style={{ backgroundImage: `url(${thumb_image_url_558 || thumb_image_url_310})` }}\n                                />\n                            </span>\n                        </a>\n                    </figure>\n                    <figcaption>\n                        <span\n                            className={classnames(\"show_cart\", { opened: showCart })}\n                            style={!sales ? { display: \"none\" } : undefined}>\n                            {sales && (\n                                <button\n                                    className={`price btn-cart nopopup ${discounting ? \"sales\" : \"\"} ${\n                                        saleAvailable ? \"\" : \"soldout\"\n                                    }`}\n                                    onClick={this.handleQuickCartToggle}>\n                                    <em>\n                                        {discounting && (\n                                            <small key=\"ThingCard2-price-deal\">\n                                                ${numberFormat(sales.retail_price, 0)}\n                                            </small>\n                                        )}\n                                        <b>\n                                            {showFrom ? (\n                                                <React.Fragment>\n                                                    <em className=\"from\">from </em> ${numberFormat(sales.min_price, 0)}\n                                                </React.Fragment>\n                                            ) : (\n                                                `$${numberFormat(sales.deal_price, 0)}`\n                                            )}\n                                        </b>\n                                    </em>\n                                </button>\n                            )}\n                            <em className=\"sale-item-input\">\n                                <small\n                                    className=\"trick\"\n                                    style={{ display: showCart ? \"block\" : null }}\n                                    onClick={this.handleTrickClick}\n                                />\n                                {saleAvailable ? (\n                                    <span className=\"frm\">\n                                        {saleOptionExists && (\n                                            <select\n                                                name=\"option_id\"\n                                                id={`${id}-option_id`}\n                                                onChange={this.handleOptionChange}>\n                                                {sales.options.map((option, i) => (\n                                                    <option\n                                                        key={`other-item-${itemIdx}-saleoption-${i}`}\n                                                        value={option.id}>\n                                                        {option.option} -{\" \"}\n                                                        {!option.available_for_sale || option.quantity === 0\n                                                            ? gettext(\"Sold out\")\n                                                            : `$${numberFormat(option.deal_price, 0)}`}\n                                                    </option>\n                                                ))}\n                                            </select>\n                                        )}\n                                        <select\n                                            className=\"option\"\n                                            id={`${id}-quantity`}\n                                            name=\"quantity\"\n                                            disabled={!saleOptionAvailable}\n                                            onChange={this.handleOptionQuantityChange}>\n                                            {this.getQuantityRange().map((e, i) => (\n                                                <option key={`other-item-${itemIdx}-quantityOption-${i}`} value={e}>\n                                                    {e}\n                                                </option>\n                                            ))}\n                                        </select>\n                                        <button\n                                            className=\"add_to_cart btns-green-embo\"\n                                            onClick={this.handleCartAddition}\n                                            disabled={!saleOptionAvailable}>\n                                            {gettext(\"Add to Cart\")}\n                                        </button>\n                                    </span>\n                                ) : (\n                                    <span className=\"frm\">\n                                        <span className=\"notify-soldout\">Sorry, this item has sold out</span>\n                                        <button\n                                            className={classnames(\"btns-green-embo btn-notify\", {\n                                                subscribed: waiting,\n                                            })}\n                                            onClick={this.handleNotifySoldout}>\n                                            {waiting ? \"Subscribed\" : \"Notify me when available\"}\n                                        </button>\n                                    </span>\n                                )}\n                            </em>\n                        </span>\n                        <a\n                            href={html_url}\n                            className=\"title\"\n                            rel={`thing-${id}`}\n                            onClick={this.handleLinkClick}\n                            data-prevent-overlay=\"true\"\n                            {...getSafeNameProp(this.props)}\n                        />\n                        <span className={classnames(\"buttons\" /*, { 'no-cart': saleAvailable }*/)}>\n                            <FancydUsers\n                                thing={this.props}\n                                appContext={this.props.appContext}\n                                displayCount={6}\n                                showFancydUser={false}\n                            />\n                            <MoreShareFacade\n                                objectType=\"thing\"\n                                objectId={id}\n                                loggedIn={loggedIn}\n                                title={getThingName(this.props)}\n                                viewerUsername={viewer.username}\n                                onShowSomething={this.handleShowSomething}\n                            />\n                        </span>\n                    </figcaption>\n                    <a className=\"delete\" onClick={this.handleRecentlyDelete} />\n                </div>\n            </li>\n        );\n    }\n}\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\n\nimport { isEmpty, convertThingsV1ToRest, debounceUntilTimeout } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\n\nimport { OtContainer, scrollEvent } from \"../container/entry-events\";\nimport { ThingCache, cache } from \"../cache\";\nimport ThingCard from \"./ThingCard\";\n\nconst Views = {\n    Similar: \"similar\",\n    Recently: \"recently\",\n};\n\n// bound later to timeline\nfunction scrollTouchdown(isReached) {\n    if (this.state.similarLoading || isReached !== true) {\n        return;\n    }\n    this.updateSimilar(this.props.thing.id);\n}\n\nfunction shouldShowRecommendation() {\n    if (!OtContainer.isStatic()) {\n        return true;\n    }\n    const wHeight = $(window).height();\n    const $content = $(\"#overlay-thing .wrapper-content .content > .wrapper\");\n    const tabHeight = $(\"#overlay-thing .wrapper-content .timeline .tabs\").outerHeight();\n    const footerHeight = $(\"#overlay-thing .timeline .tabs\").outerHeight();\n    const topOffset = $content.offset().top;\n    return wHeight - (topOffset + ($content.height() + tabHeight) + footerHeight) > 0;\n}\n\nexport default class Timeline extends Component {\n    // Non-react states\n    similarCursorEndReached = null;\n    lastthingID = null;\n    similarNextCursor = null;\n    recentlyNextCursor = null;\n    state = {\n        currentView: Views.Similar,\n        similarLoading: false,\n        recently: [],\n        similar: [],\n    };\n\n    handleToggleSimilar = (event) => {\n        event.preventDefault();\n        this.setState({ currentView: Views.Similar });\n    };\n\n    handleToggleRecently = (event) => {\n        event.preventDefault();\n        this.updateRecently(this.props.thing.id);\n        this.setState({ currentView: Views.Recently });\n    };\n\n    // @param reset - thing is changed, page is 1\n    updateSimilar = (thingID, reset) => {\n        if (thingID == null || this.state.similarLoading || this.similarCursorEndReached) {\n            return;\n        }\n        this.setState({ similarLoading: true }, () => {\n            var nextCursorString = \"\";\n            if (this.similarNextCursor != null) {\n                nextCursorString = `&cursor=${this.similarNextCursor}`;\n            }\n\n            $.ajax({\n                type: \"get\",\n                url: `/might_also_fancy.json?include_sale_item_option=True&rapi_compl=True&thing_id=${thingID}&lang=${\n                    window.CURRENT_LANGCODE || \"\"\n                }&count=20${nextCursorString}`,\n            })\n                .done(({ next_cursor, results }) => {\n                    if (!this.unmounted) {\n                        const { similar } = this.state;\n                        const converted = convertThingsV1ToRest(results);\n                        cacheSimilarThings(converted);\n                        logExposed(converted);\n\n                        // Update/Insert things array\n                        var things;\n                        if (reset || isEmpty(similar)) {\n                            things = converted;\n                        } else if (_.isArray(similar)) {\n                            things = similar.concat(converted);\n                        }\n\n                        // Write if page is reached end.\n                        // this.similarCursorEndReached = ( next_cursor == null || !converted.length) ;    // End reached\n                        this.similarCursorEndReached = true; // End reached\n                        this.similarNextCursor = next_cursor;\n                        this.setState({ similar: things });\n                    }\n                })\n                .fail(function (xhr) {\n                    console.warn(\"updateSimilar():\", xhr);\n                })\n                .always(() => {\n                    this.setState({ similarLoading: false });\n                });\n        });\n    };\n\n    updateRecently = (thingID) => {\n        if (thingID == null) {\n            return;\n        }\n        // TODO: Should update overlay viewed things.\n        $.ajax({\n            type: \"get\",\n            url: `/recently_viewed_things_json?include_sale_item_option=True&rapi_compl=True&thing_id=${thingID}`,\n        })\n            .done((response) => {\n                if (!this.unmounted) {\n                    const recently = convertThingsV1ToRest(response).filter((_, i) => i < 20);\n                    logExposed(recently);\n\n                    this.setState({ recently });\n                }\n            })\n            .fail(function (xhr) {\n                console.warn(\"updateRecently():\", xhr);\n            });\n    };\n\n    handleDelete = (deletedThing) => {\n        this.setState({ recently: this.state.recently.filter((thing) => thing.id !== deletedThing.id) });\n    };\n\n    componentDidMount() {\n        // // in case browser is too big, load manually\n        if (shouldShowRecommendation() || !this.props.thing.sales) {\n            this.updateSimilar(this.props.thing.id);\n        }\n        scrollEvent.attach(debounceUntilTimeout(scrollTouchdown, 150, this));\n        this.lastthingID = this.props.thing.id;\n    }\n\n    componentDidUpdate() {\n        const nextProps = this.props;\n\n        // Thing has changed, reset similar things.\n        if (this.lastthingID !== nextProps.thing.id) {\n            const idCopy = nextProps.thing.id;\n            this.lastthingID = idCopy;\n            this.similarCursorEndReached = null;\n            this.similarNextCursor = null;\n            if (shouldShowRecommendation() || !nextProps.thing.sales) {\n                this.updateSimilar(nextProps.thing.id, true);\n            }\n        }\n    }\n\n    componentWillUnmount() {\n        this.unmounted = true;\n        // this.thingContext.disconnectTimeline();\n        delete this.thingContext;\n    }\n\n    render() {\n        const {\n            appContext,\n            appContext: { loggedIn },\n            thing,\n        } = this.props;\n        const { currentView, recently, similar } = this.state;\n\n        return (\n            <div className={classnames(\"timeline other-thing newcard\", { loading: thing.loading })}>\n                <ul className=\"tabs after\">\n                    <li>\n                        <a\n                            className={classnames(Views.Similar, { current: currentView === Views.Similar })}\n                            onClick={this.handleToggleSimilar}>\n                            {__Config.nostore ? gettext(\"Similar items\") : gettext(\"You may also Fancy\")}\n                        </a>\n                    </li>\n                    <li>\n                        <a\n                            className={classnames(Views.Recently, { current: currentView === Views.Recently })}\n                            onClick={this.handleToggleRecently}>\n                            {gettext(\"Recently viewed\")}\n                        </a>\n                    </li>\n                </ul>\n                {currentView === Views.Similar && (\n                    <div\n                        className=\"inner similar\"\n                        style={{ display: similar.length > 0 || this.state.similarLoading ? \"block\" : \"none\" }}>\n                        <ul className=\"after fancy-suggestions\">\n                            {similar &&\n                                similar.map((similarThing, idx) => (\n                                    <ThingCard\n                                        itemIdx={idx}\n                                        itemType=\"similar\"\n                                        loggedIn={loggedIn}\n                                        key={`timeline-similar-${idx}`}\n                                        viewer={this.props.appContext.viewer}\n                                        appContext={appContext}\n                                        {...similarThing}\n                                    />\n                                ))}\n                        </ul>\n                        <RecommendationItemLoading display={this.state.similarLoading} />\n                    </div>\n                )}\n                {currentView === Views.Recently && (\n                    <div className=\"inner recently\" style={{ display: recently.length > 0 ? \"block\" : \"none\" }}>\n                        <ul className=\"after fancy-suggestions\">\n                            {recently &&\n                                recently.map((recentlyThing, idx) => (\n                                    <ThingCard\n                                        itemIdx={idx}\n                                        itemType=\"recently\"\n                                        loggedIn={loggedIn}\n                                        key={`timeline-recently-${idx}`}\n                                        onDelete={this.handleDelete}\n                                        viewer={this.props.appContext.viewer}\n                                        appContext={appContext}\n                                        {...recentlyThing}\n                                    />\n                                ))}\n                        </ul>\n                    </div>\n                )}\n            </div>\n        );\n    }\n}\n\nfunction RecommendationItemLoading({ display }) {\n    return (\n        <div id=\"infscr-loading\" style={Display.NoneIf(!display)}>\n            <img alt=\"Loading...\" src=\"/_ui/images/common/loading.gif\" />\n            <div />\n        </div>\n    );\n}\n\nfunction cacheSimilarThings(things) {\n    things.forEach((thing) => {\n        if (!cache.exists(thing.id, ThingCache.THINGS)) {\n            cache.add(thing.id, thing, ThingCache.THINGS);\n        }\n    });\n}\n\nfunction logExposed(things) {\n    if (typeof LogExposed == \"undefined\") return;\n    things.forEach((thing) => {\n        window.LogExposed.addLog(thing.id + \"\", \"thing related\");\n    });\n}\n","import React, { Component, lazy, Suspense } from \"react\";\nimport type { ReactElement } from \"react\";\nimport { connect } from \"react-redux\";\nimport { isEmpty, isStaticPage, isSafari } from \"fancyutils\";\n\nimport { Sidebar } from \"./sidebar/index\";\nimport { historyData } from \"../container/history\";\nimport { mapStateToThingProps } from \"./map\";\n\nconst FooterReviews = lazy(() => import(/* webpackChunkName: \"OverlayThing.extras\" */ \"./FooterReviews\"));\n\nimport Thing from \"./Thing\";\nimport { OverlayPropsV1 } from \"ftypes\";\nimport Timeline from \"./Recommendation\";\n\nimport { updateSaleContext } from \"../action/action-helpers\";\nimport store from \"../store/store\";\n\nfunction getAdminSidebar(props: OverlayPropsV1) {\n    const {\n        appContext: { viewer },\n        thing,\n    } = props;\n    let admin = null;\n\n    let AdminComponent;\n    if (viewer.is_admin_business || viewer.is_admin_design) {\n        AdminComponent = lazy(() => import(/* webpackChunkName: \"OverlayThing.admin\" */ \"./Admin\"));\n    } else if (viewer.is_admin_wholesale && thing.show_on_homepage) {\n        AdminComponent = lazy(() => import(/* webpackChunkName: \"OverlayThing.admin\" */ \"./AdminSimple\"));\n    }\n    if (AdminComponent) {\n        admin = (\n            <Suspense fallback={<div />}>\n                <AdminComponent {...props} fallback={<div />} />\n            </Suspense>\n        );\n    }\n\n    return admin;\n}\n\n// Container class for overlayed thing detail.\nclass _Overlay extends Component<OverlayPropsV1> {\n    // health check\n    componentDidUpdate(prevProps: OverlayPropsV1) {\n        const pt = prevProps.thing;\n        const ct = this.props.thing;\n\n        if (ct != null) {\n            if (!pt || pt.id !== ct.id) {\n                if (isStaticPage()) {\n                    $(window).scrollTop(0);\n                } else {\n                    $(\"#overlay-thing > .popup\").attr(\"tabindex\", -1).focus();\n                }\n                if (ct.sales && ct.sales.options && ct.sales.options.length > 1) {\n                    const nonSoldoutOptions = ct.sales.options.filter((o) => !o.soldout);\n                    let minimumOption;\n                    if (nonSoldoutOptions.length > 0) {\n                        minimumOption = _.min(nonSoldoutOptions, (o) => Number(o.price));\n                    } else {\n                        minimumOption = _.min(ct.sales.options, (o) => Number(o.price));\n                    }\n                    if (ct.sales.options[0].id !== minimumOption.id) {\n                        store.dispatch(updateSaleContext({ saleOptionID: minimumOption.id }));\n                    }\n                }\n            }\n        }\n    }\n\n    render() {\n        const { thing } = this.props;\n\n        let display: ReactElement | null = null;\n        if (historyData.locationIsThingPage) {\n            if (thing != null) {\n                const showReview = thing.sales && !isEmpty(thing.sales.reviews);\n                display = (\n                    <div\n                        className={`wrapper-content thing-detail-container thing-detail-overlay ${\n                            isSafari() ? \"safari\" : \"\"\n                        }`}\n                        key=\"thing-detail-container\">\n                        <div className=\"content\">\n                            <Thing {...this.props} />\n                            {showReview && (\n                                <Suspense fallback={<div />}>\n                                    <FooterReviews {...this.props} />\n                                </Suspense>\n                            )}\n                        </div>\n                        <Sidebar {...this.props} />\n                        <Timeline fallback={<div className=\"timeline other-thing newcard loading\" />} {...this.props} />\n                        {getAdminSidebar(this.props)}\n                        <a href=\"#header\" id=\"scroll-to-top\" style={{ display: \"inline\" }}>\n                            <span>Jump to top</span>\n                        </a>\n                    </div>\n                );\n            } else {\n                display = (\n                    <div\n                        className=\"wrapper-content thing-detail-container thing-detail-overlay\"\n                        key=\"thing-detail-container\"\n                    />\n                );\n            }\n        } else {\n            display = <div key=\"thing-detail-container\" />;\n        }\n\n        return display;\n    }\n}\n\nconst ReduxComponentEnhancer = connect<OverlayPropsV1>(mapStateToThingProps);\nconst Overlay = ReduxComponentEnhancer(_Overlay);\nexport default Overlay;\n","import { getLocationArgPairs } from 'fancyutils';\nimport { GlobalFancySomething } from 'ftypes';\n\n\ndeclare global {\n    interface Window {\n        _: typeof import('underscore');\n        track_event: Function;\n        alertify: alertify.IAlertifyStatic;\n        dataLayer: Array<any>;\n        Fancy: GlobalFancySomething;\n        from_sds_page: boolean;\n        TrackingEvents: {\n            addToCart(_: any): any\n        }\n    }\n}\n\nconst { Fancy, track_event, dataLayer, from_sds_page, TrackingEvents } = window;\n\nexport function logAddCartMixpanel({\n    salesID,\n    saleOptionID,\n    utm,\n    section,\n    via,\n} : {\n    salesID: any;\n    saleOptionID: any;\n    utm: any;\n    section: any;\n    via: any;\n}) {\n    if (salesID == null) {\n        return;\n    }\n    if (utm == null) {\n        const currentLocationArgPair = getLocationArgPairs('utm');\n        if (currentLocationArgPair) {\n            utm = currentLocationArgPair[1];\n        }\n    }\n    const log = {\n        'sale id': salesID,\n        via: via || 'thing page',\n        utm: utm,\n    };\n    if (section) {\n        log.section = section;\n    }\n    if (saleOptionID && salesID !== saleOptionID) {\n        log['option id'] = saleOptionID;\n    }\n    try {\n        window.track_event && track_event('Add to Cart', log);\n    } catch (e) {}\n    return log;\n}\n\nexport function addItemToCart(param, callback, meta) {\n    // should be replaced by Fancy.CartAPI.addItem\n    param.from_sds_page = from_sds_page;\n    if (window.dataLayer) {\n        window.dataLayer.push({\n            event: 'Add_to_Cart_Button',\n            product_id: param['sale_item_id'],\n            option_id: param['option_id'],\n            products: undefined,\n            products_info: undefined,\n            revenue: undefined\n        });\n    }\n    return $.ajax({\n        type: 'POST',\n        url: '/add_item_to_cart.json',\n        data: param\n    })\n    .done(json => {\n        if (!json || json.status_code == null) {\n            return;\n        }\n        if (json.status_code === 1) {\n            if (meta) {\n                TrackingEvents.addToCart([{\n                    id: param.sale_item_id,\n                    brand: meta.brand_name,\n                    name: meta.title,\n                    quantity: param.quantity,\n                    price: meta.price,\n                    variant: json.option,\n                }]); // avoid NaN\n            }\n            var args: any = {\n                'THING_ID': param.thing_id,\n                'ITEMCODE': json.itemcode,\n                'THUMBNAIL_IMAGE_URL': json.image_url,\n                'ITEMNAME': json.itemname,\n                'QUANTITY':json.quantity,\n                'PRICE': json.price,\n                'OPTIONS': json.option,\n                'HTML_URL': json.html_url,\n                'CART_ID': json.cart_id,\n            };\n            if (json.fancy_price) {\n                args.FANCY_PRICE = json.fancy_price;\n            }\n            Fancy.Cart.addItem(args);\n            Fancy.Cart.openPopup();\n        } else if (json.status_code == 0) {\n            if(json.message) {\n                alert(json.message);\n            }\n        }\n    })\n    .always(function() { callback && callback(); });\n}\n","import React, { Component } from 'react';\nimport { MoreShareFacade } from 'common-components';\n\nimport { getThingName } from '../map';\nimport { FancydUsers } from '../FancydUsers';\n\n\nexport default class ActionButtons extends Component {\n    render() {\n        const {\n            appContext: { loggedIn, viewer },\n            thing,\n        } = this.props;\n\n        return (\n            <div className=\"figure-button action-button-v2\">\n                <span className=\"buttons\">\n                    <FancydUsers {...this.props} bigContainer={true} displayCount={4} />\n                    <MoreShareFacade objectType=\"thing\" objectId={thing.id} loggedIn={loggedIn} title={getThingName(thing)}\n                                     viewerUsername={viewer.username} showShortcuts={true} fromThingSidebar={true} />\n                </span>\n            </div>\n        );\n    }\n}\n\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { getCurrentSaleOption, getThingName } from \"../../map\";\nimport { addItemToCart, logAddCartMixpanel } from \"../../map.cart\";\n\n// Generic purchase handler, needs to be bound to insatnce on initialization.\n/*\n    data-sii={sales.id}\n    data-sisi={sales.seller_id}\n    data-tid={thing.id}\n*/\nexport function handlePurchase(event) {\n    event.preventDefault();\n    const {\n        thing,\n        thing: { sales },\n        saleContext\n    } = this.props;\n    const saleOption = getCurrentSaleOption(sales, saleContext, true);\n    const soldout = saleOption == null ? sales.soldout : saleOption.soldout;\n    if (soldout || this.state.loading) {\n        return;\n    }\n    const saleOptionID = saleOption != null ? saleOption.id : null;\n\n    this.setState({ loading: true }, () => {\n        const log = {\n            salesID: sales.id\n        };\n        if (saleOption) {\n            log.saleOptionID = saleOptionID;\n        }\n        logAddCartMixpanel(log);\n        const request = {\n            thing_id: thing.id,\n            seller_id: thing.sales.seller.id,\n            sale_item_id: sales.id,\n            quantity: saleContext.selectedQuantity,\n            personalization: saleContext.personalization\n        };\n        if (saleOptionID != null) {\n            request.option_id = saleOptionID;\n        }\n        const discounting = sales && sales.discount_percentage !== \"0\";\n        const meta = {\n            title: getThingName(thing),\n            price: discounting ? sales.retail_price : sales.deal_price,\n            brand_name: sales.seller.brand_name\n        };\n        addItemToCart(\n            request,\n            () => {\n                this.setState({ loading: false });\n            },\n            meta\n        );\n    });\n}\n\nconst SaleOptions = ({\n    options = [\"1\"],\n    currentValue = \"1\",\n    id = \"\",\n    value = v => v,\n    expander,\n    defaultValue,\n    printer,\n    disabled,\n    onChange,\n    onClick,\n    onFocus,\n    unselectedLabel\n}) => {\n    expander =\n        expander ||\n        ((option, idx) => (\n            <option key={`sale_options-${idx}`} value={value(option)}>\n                {printer(option)}\n            </option>\n        ));\n\n    return (\n        <select\n            id={id}\n            className={classnames(\"select-boxes2\", { 'one-option': options.length <= 1 })}\n            value={value(currentValue) || defaultValue}\n            disabled={disabled}\n            onChange={onChange}\n            onClick={onClick}\n            onFocus={onFocus}>\n            {unselectedLabel && <option value=\"\">{unselectedLabel}</option>}\n            {options.map(expander)}\n        </select>\n    );\n};\n\nexport const CartButton = props => (\n    <button {...props} label={null}>\n        {props.label}\n    </button>\n);\n\nexport const SelectBox = props => {\n    let { className, disabled, label, currentValue, defaultValue, id, printer, tabIndex, unselectedLabel, options = ['1'] } = props;\n\n    printer = printer != null ? printer : s => s;\n    defaultValue = defaultValue != null ? defaultValue : \"1\";\n    className = className != null ? className : null;\n\n    var labelValue;\n    if (unselectedLabel != null && currentValue === \"\") {\n        labelValue = unselectedLabel;\n    } else {\n        labelValue = printer(currentValue != null ? currentValue : defaultValue);\n    }\n\n    return (\n        <p className={className}>\n            <label>{label}</label>\n            <span className={`trick-select ${id}`}>\n                <a className={classnames(\"selectBox\", { disabled, 'one-option': options.length <= 1 })} tabIndex={tabIndex || \"1\"}>\n                    <span className=\"selectBox-label\">{labelValue}</span>\n                    <span className=\"selectBox-arrow\" />\n                </a>\n                <SaleOptions {...props} printer={printer} defaultValue={defaultValue} />\n            </span>\n        </p>\n    );\n};\n\nexport class MultiOptionState {\n    constructor(options, option_meta) {\n        this.options = options;\n        this.option_meta = option_meta;\n        const orderMap = {};\n        option_meta.forEach(m => {\n            if (orderMap[m.type] == null) {\n                orderMap[m.type] = { length: 1 };\n                orderMap[m.type][m.name] = 0;\n            } else {\n                orderMap[m.type][m.name] = orderMap[m.type].length;\n                orderMap[m.type].length += 1;\n            }\n        });\n        this.orderMap = orderMap;\n    }\n    // i.e.) getPossibleValues(['a', '1', ''], 1) => ['1', '3', '6']\n    // output: get possible options for 2nd option dependent on ('a' / 1st option)\n    getPossibleValuesForIndex(selected, targetIndex) {\n        const { options, option_meta, orderMap } = this;\n        if (targetIndex === 0) {\n            return option_meta[0].values;\n        }\n        let filteredOptions = options;\n        option_meta\n            .map(m => {\n                const order = orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            })\n            .forEach((sel, idx) => {\n                if (idx < targetIndex) {\n                    filteredOptions = filteredOptions.filter(option => option.values[idx] === sel);\n                }\n            });\n        return _.uniq(filteredOptions.map(o => o.values[targetIndex])); // FIXME\n    }\n\n    getMultiOptions(selected) {\n        return this.option_meta.map((meta, idx) => {\n            return [meta, this.getPossibleValuesForIndex(selected, idx)];\n        });\n        /*\n        returns [\n            [type, ['a', 'b', 'c']],\n            [type, ['1', '2']],\n            [tyep, ['red', 'white', 'black']]\n        ]\n        */\n    }\n}\n\nexport const MultiOption = props => {\n    const { selected, multiOptionState, sid } = props;\n    if (multiOptionState == null) {\n        return null;\n    } \n    const multiOptions = multiOptionState.getMultiOptions(selected);\n    return multiOptions.map(([meta, values], idx) => {\n        const { type, name } = meta;\n\n        const indexTypeOf = multiOptionState.orderMap[type] && multiOptionState.orderMap[type][name];\n        const additional = {\n            name,\n            values,\n            indexTypeOf,\n            selectedArray: selected && selected[type],\n            selectedValue: selected && selected[type] && selected[type][indexTypeOf],\n            key: `${sid}-${idx}`\n        };\n        if (type === \"dropdown\") {\n            return <MultiSelectBox {...props} {...additional} />;\n        } else if (type === \"swatch\") {\n            additional.swatch = meta.swatch;\n            return <MultiSwatch {...props} {...additional} />;\n        } else if (type === \"thumbnail\") {\n            additional.thumbnail = meta.thumbnail;\n            return <MultiThumbnail {...props} {...additional} />;\n        } else if (type === \"button\") {\n            return <MultiButton {...props} {...additional} />;\n        }\n    });\n};\n\nexport const MultiSelectBox = props => {\n    const { values, name, onMultiSelectBoxChange, indexTypeOf, selectedValue } = props;\n    return (\n        <div className=\"multi-option\">\n            <label>{name}</label>\n            <select onChange={onMultiSelectBoxChange} selected={selectedValue} className={values.length <= 1 ? 'one-option' : null}>\n                {values.map(value => {\n                    return <MultiSelectBoxOption value={value} indexTypeOf={indexTypeOf} />\n                })}\n            </select>\n        </div>\n    );\n};\n\nconst MultiSelectBoxOption = props => {\n    const { value, indexTypeOf } = props;\n    return (\n        <option data-value={value} data-index-typeof={indexTypeOf} value={value}>\n            {value}\n        </option>\n    );\n};\n\nexport const MultiSwatch = props => {\n    const { name, values, swatch, indexTypeOf, selectedValue, onClickSwatch } = props;\n    return (\n        <div className=\"multi-option swatch\">\n            <label>{name}</label>\n            <span className=\"value\">{selectedValue}</span>\n            <ul>\n                {values.map(value => {\n                    return <MultiSwatchOption\n                            value={value}\n                            swatch={swatch}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            onClick={onClickSwatch}\n                        />\n                })}\n            </ul>\n        </div>\n    );\n};\n\nconst MultiSwatchOption = props => {\n    const { value, swatch, indexTypeOf, selectedValue, onClick } = props;\n    return (\n        <li>\n            <a\n                href=\"#\"\n                style={{ backgroundColor: swatch[value] }}\n                onClick={onClick}\n                data-value={value}\n                data-index-typeof={indexTypeOf}\n                className={selectedValue === value ? \"selected\" : \"\"}\n            />\n        </li>\n    );\n};\n\nexport const MultiThumbnail = props => {\n    const { values, name, thumbnail, onClickThumbnail, indexTypeOf, selectedValue } = props;\n\n    return (\n        <div className=\"multi-option thumbnail\">\n            <label>{name}</label>\n            <span className=\"value\">{selectedValue}</span>\n            <ul>\n                {values.map(value => {\n                    return <MultiThumbnailOption\n                            onClick={onClickThumbnail}\n                            value={value}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            thumbnail={thumbnail}\n                        />\n                })}\n            </ul>\n        </div>\n    );\n};\n\nconst MultiThumbnailOption = ({ onClick, value, indexTypeOf, selectedValue, thumbnail }) => {\n    return (\n        <li>\n            <a\n                href=\"#\"\n                onClick={onClick}\n                data-value={value}\n                data-index-typeof={indexTypeOf}\n                className={selectedValue === value ? \"selected\" : \"\"}>\n                <img\n                    src=\"/_ui/images/common/blank.gif\"\n                    style={{ backgroundImage: `url(\"${thumbnail[value]}\")` }}\n                    alt={value}\n                />\n            </a>\n        </li>\n    );\n};\n\nexport const MultiButton = props => {\n    const { values, name, onClickMutliButton, indexTypeOf, selectedValue } = props;\n    return (\n        <div className=\"multi-option button\">\n            <label>{name}</label>\n            <ul>\n                {values.map(value => {\n                    return <MultiButtonOption\n                            onClick={onClickMutliButton}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            value={value}\n                        />\n                })}\n            </ul>\n        </div>\n    );\n};\n\nconst MultiButtonOption = props => {\n    const { value, onClick, indexTypeOf, selectedValue } = props;\n    return (\n        <li>\n            <button\n                onClick={onClick}\n                className={selectedValue === value ? \"selected\" : \"\"}\n                data-value={value}\n                data-index-typeof={indexTypeOf}>\n                {value}\n            </button>\n        </li>\n    );\n};\n","export const Countries = {\n  'AE': 'United Arab Emirates',\n  'AF': 'Afghanistan',\n  'AG': 'Antigua And Barbuda',\n  'AI': 'Anguilla',\n  'AL': 'Albania',\n  'AM': 'Armenia',\n  'AN': 'Netherlands Antilles',\n  'AO': 'Angola',\n  'AQ': 'Antarctica',\n  'AR': 'Argentina',\n  'AS': 'American Samoa',\n  'AT': 'Austria',\n  'AU': 'Australia',\n  'AW': 'Aruba',\n  'AX': 'Aaland Islands',\n  'AZ': 'Azerbaijan',\n  'BA': 'Bosnia And Herzegowina',\n  'BB': 'Barbados',\n  'BD': 'Bangladesh',\n  'BE': 'Belgium',\n  'BF': 'Burkina Faso',\n  'BG': 'Bulgaria',\n  'BH': 'Bahrain',\n  'BI': 'Burundi',\n  'BJ': 'Benin',\n  'BM': 'Bermuda',\n  'BN': 'Brunei Darussalam',\n  'BO': 'Bolivia',\n  'BR': 'Brazil',\n  'BS': 'Bahamas',\n  'BT': 'Bhutan',\n  'BV': 'Bouvet Island',\n  'BW': 'Botswana',\n  'BY': 'Belarus',\n  'BZ': 'Belize',\n  'CA': 'Canada',\n  'CC': 'Cocos (keeling) Islands',\n  'CD': 'Congo, Democratic Republic Of (was Zaire)',\n  'CF': 'Central African Republic',\n  'CG': 'Congo, Republic Of',\n  'CH': 'Switzerland',\n  'CI': \"Cote D'ivoire\",\n  'CK': 'Cook Islands',\n  'CL': 'Chile',\n  'CM': 'Cameroon',\n  'CN': 'China',\n  'CO': 'Colombia',\n  'CR': 'Costa Rica',\n  'CU': 'Cuba',\n  'CV': 'Cape Verde',\n  'CX': 'Christmas Island',\n  'CY': 'Cyprus',\n  'CZ': 'Czech Republic',\n  'DE': 'Germany',\n  'DJ': 'Djibouti',\n  'DK': 'Denmark',\n  'DM': 'Dominica',\n  'DO': 'Dominican Republic',\n  'DZ': 'Algeria',\n  'EC': 'Ecuador',\n  'EE': 'Estonia',\n  'EG': 'Egypt',\n  'EH': 'Western Sahara',\n  'ES': 'Spain',\n  'ET': 'Ethiopia',\n  'FI': 'Finland',\n  'FJ': 'Fiji',\n  'FK': 'Falkland Islands (malvinas)',\n  'FM': 'Micronesia, Federated States Of',\n  'FO': 'Faroe Islands',\n  'FR': 'France',\n  'GA': 'Gabon',\n  'GB': 'United Kingdom',\n  'GD': 'Grenada',\n  'GE': 'Georgia',\n  'GF': 'French Guiana',\n  'GH': 'Ghana',\n  'GI': 'Gibraltar',\n  'GL': 'Greenland',\n  'GM': 'Gambia',\n  'GN': 'Guinea',\n  'GP': 'Guadeloupe',\n  'GQ': 'Equatorial Guinea',\n  'GR': 'Greece',\n  'GS': 'South Georgia And The South Sandwich Islands',\n  'GT': 'Guatemala',\n  'GU': 'Guam',\n  'GW': 'Guinea-bissau',\n  'GY': 'Guyana',\n  'HK': 'Hong Kong',\n  'HM': 'Heard And Mc Donald Islands',\n  'HN': 'Honduras',\n  'HR': 'Croatia (local Name: Hrvatska)',\n  'HT': 'Haiti',\n  'HU': 'Hungary',\n  'ID': 'Indonesia',\n  'IE': 'Ireland',\n  'IL': 'Israel',\n  'IN': 'India',\n  'IO': 'British Indian Ocean Territory',\n  'IQ': 'Iraq',\n  'IR': 'Iran (islamic Republic Of)',\n  'IS': 'Iceland',\n  'IT': 'Italy',\n  'JM': 'Jamaica',\n  'JO': 'Jordan',\n  'JP': 'Japan',\n  'KE': 'Kenya',\n  'KG': 'Kyrgyzstan',\n  'KH': 'Cambodia',\n  'KI': 'Kiribati',\n  'KM': 'Comoros',\n  'KN': 'Saint Kitts And Nevis',\n  'KP': 'Korea, North',\n  'KR': 'Korea, Republic Of',\n  'KW': 'Kuwait',\n  'KY': 'Cayman Islands',\n  'KZ': 'Kazakhstan',\n  'LA': \"Lao People's Democratic Republic\",\n  'LB': 'Lebanon',\n  'LC': 'Saint Lucia',\n  'LI': 'Liechtenstein',\n  'LK': 'Sri Lanka',\n  'LR': 'Liberia',\n  'LS': 'Lesotho',\n  'LT': 'Lithuania',\n  'LU': 'Luxembourg',\n  'LV': 'Latvia',\n  'LY': 'Libyan Arab Jamahiriya',\n  'MA': 'Morocco',\n  'MC': 'Monaco',\n  'MD': 'Moldova, Republic Of',\n  'ME': 'Montenegro',\n  'MG': 'Madagascar',\n  'MH': 'Marshall Islands',\n  'MK': 'Macedonia, The Former Yugoslav Republic Of',\n  'ML': 'Mali',\n  'MM': 'Myanmar',\n  'MN': 'Mongolia',\n  'MO': 'Macau',\n  'MP': 'Northern Mariana Islands',\n  'MQ': 'Martinique',\n  'MR': 'Mauritania',\n  'MS': 'Montserrat',\n  'MT': 'Malta',\n  'MU': 'Mauritius',\n  'MV': 'Maldives',\n  'MW': 'Malawi',\n  'MX': 'Mexico',\n  'MY': 'Malaysia',\n  'MZ': 'Mozambique',\n  'NA': 'Namibia',\n  'NC': 'New Caledonia',\n  'NE': 'Niger',\n  'NF': 'Norfolk Island',\n  'NG': 'Nigeria',\n  'NI': 'Nicaragua',\n  'NL': 'Netherlands',\n  'NO': 'Norway',\n  'NP': 'Nepal',\n  'NR': 'Nauru',\n  'NU': 'Niue',\n  'NZ': 'New Zealand',\n  'OM': 'Oman',\n  'PA': 'Panama',\n  'PE': 'Peru',\n  'PF': 'French Polynesia',\n  'PG': 'Papua New Guinea',\n  'PH': 'Philippines',\n  'PK': 'Pakistan',\n  'PL': 'Poland',\n  'PM': 'Saint Pierre And Miquelon',\n  'PN': 'Pitcairn',\n  'PR': 'Puerto Rico',\n  'PS': 'Palestinian Territory',\n  'PT': 'Portugal',\n  'PW': 'Palau',\n  'PY': 'Paraguay',\n  'QA': 'Qatar',\n  'RE': 'Reunion',\n  'RO': 'Romania',\n  'RS': 'Serbia',\n  'RU': 'Russian Federation',\n  'RW': 'Rwanda',\n  'SA': 'Saudi Arabia',\n  'SB': 'Solomon Islands',\n  'SC': 'Seychelles',\n  'SD': 'Sudan',\n  'SD': 'Sudan',\n  'SE': 'Sweden',\n  'SG': 'Singapore',\n  'SH': 'Saint Helena',\n  'SI': 'Slovenia',\n  'SJ': 'Svalbard And Jan Mayen Islands',\n  'SK': 'Slovakia',\n  'SL': 'Sierra Leone',\n  'SM': 'San Marino',\n  'SN': 'Senegal',\n  'SO': 'Somalia',\n  'SR': 'Suriname',\n  'SS': 'South Sudan',\n  'ST': 'Sao Tome And Principe',\n  'SV': 'El Salvador',\n  'SY': 'Syrian Arab Republic',\n  'SZ': 'Swaziland',\n  'TC': 'Turks And Caicos Islands',\n  'TD': 'Chad',\n  'TF': 'French Southern Territories',\n  'TG': 'Togo',\n  'TH': 'Thailand',\n  'TJ': 'Tajikistan',\n  'TK': 'Tokelau',\n  'TL': 'Timor-leste',\n  'TM': 'Turkmenistan',\n  'TN': 'Tunisia',\n  'TO': 'Tonga',\n  'TR': 'Turkey',\n  'TT': 'Trinidad And Tobago',\n  'TV': 'Tuvalu',\n  'TW': 'Taiwan',\n  'TZ': 'Tanzania, United Republic Of',\n  'UA': 'Ukraine',\n  'UG': 'Uganda',\n  'UM': 'United States Minor Outlying Islands',\n  //'US': 'United States Of America',\n  'US': 'USA',\n  'UY': 'Uruguay',\n  'UZ': 'Uzbekistan',\n  'VA': 'Vatican City State (holy See)',\n  'VC': 'Saint Vincent And The Grenadines',\n  'VE': 'Venezuela',\n  'VG': 'Virgin Islands (british)',\n  'VI': 'Virgin Islands (u.s.)',\n  'VN': 'Viet Nam',\n  'VU': 'Vanuatu',\n  'WF': 'Wallis And Futuna Islands',\n  'WS': 'Samoa',\n  'YE': 'Yemen',\n  'YT': 'Mayotte',\n  'ZA': 'South Africa',\n  'ZM': 'Zambia',\n  'ZW': 'Zimbabwe'\n};\n\nexport function getCountryByCode(code) {\n    return Countries[code];\n}\n\nexport const CountriesPair = _.pairs(Countries).sort((a,b) => a[0].localeCompare(b[0])); // {code: name, ...} => [[code, name], ...] \n"],"sourceRoot":""}
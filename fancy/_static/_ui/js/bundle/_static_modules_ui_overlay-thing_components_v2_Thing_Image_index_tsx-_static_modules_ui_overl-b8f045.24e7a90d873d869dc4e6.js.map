{"version":3,"sources":["webpack://fancy/./_static/modules/ui/overlay-thing/ThingTypes.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/action-constants.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/action-helpers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/action/actions.js","webpack://fancy/./_static/modules/ui/overlay-thing/appstate.ts","webpack://fancy/./_static/modules/ui/overlay-thing/cache.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/Perf.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/map.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AddlistPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AdminPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/SimpleSharePopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/FancyContext.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/ActionButtons.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/zoom.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/ApplePayButton.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/CartButton.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/multiOption.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItemForm.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/config.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/entry-events.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/history.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/routeutils.js","webpack://fancy/./_static/modules/ui/overlay-thing/reducers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/store/initial-store.ts","webpack://fancy/./_static/modules/ui/overlay-thing/store/store.ts"],"names":["ThingTypeMeta","thingContext","name","PlainThingType","args","objectArgs","mergeObjectArgs","thing","$","extend","id","url","isCrawled","owner","image","src","width","height","user","type","fancyd_friends","META","getThingType","SaleItemType","sales","createEmptyObject","sales_available","review_rating","review_count","size_chart_ids","images","seller","GiftcardType","window","gettext","HotelType","hotel_search","hotel","VanityType","LaunchAppType","ThingType","has_launch_app","metadata","ThingTypes","forEach","AttachingType","ComparingType","constantGen","keys","slice","call","arguments","reduce","prev","next","C","shouldOpenThing","state","appContext","visible","shouldFetchThing","thingID","ID","isFetching","closeOverlay","dispatch","isStaticPage","closeModal","historyData","history","stripPathname","document","title","closeThing","off","trigger","onDataFetched","addAdditionalThingContext","cache","loadThing","onLoadThing","fetchedThingsIds","fetchThing","ThingCache","killCache","override","queryString","getState","console","warn","openThing","shouldFetch","cac","thingPageData","requestThing","options","external_apps","viewer","getLocationArgPairs","admin","successFn","need_more_fetch","image_resized_max","img","Image","failFn","failureXHR","requestThingFail","status","alertify","alert","requestPromise","then","get","fail","getCordialProperties","prop","productID","username","emojified_name","category","cordial_category","instock","available","soldout","image_url","price","parseFloat","min_price","recommended","length","map","item","i","MPArgs","currentLocationArgPair","utm","MP","LogExposed","addLog","crdl","e","trackingItem","brand","brand_name","dataLayer","push","product_id","event","products","undefined","products_info","revenue","option_id","TrackingEvents","viewItem","ga","hitType","page","location","href","thingData","fromServer","isEmpty","show_anywhere_only","salesStatus","toggleFollow","seller_id","user_id","followType","data","followContext","loading","following","toggleFollowAction","ajax","dataType","done","xml","$status","find","text","completeFollow","cancelFollow","toggleFancy","fancyContext","fancyd","fancyd_count","toggleFancyAction","json","fc","completeFancy","cancelFancy","calculatePrice","saleContext","newContext","saleOptionID","isSalesOptionsAvailable","basis","_","option","updateSaleContext","slideContext","UPDATE_SALE_CONTEXT","getCurrentSaleOption","saleImages","getSaleImages","firstOptionImageIdx","some","idx","thumbnailIndex","setThumbnailIndex","requestCurrencyConversion","nextCode","nextPrice","callback","shouldConvert","numberType","replace","isString","amount","currency_code","success","currency","code","formatPrice","symbol","_convertCurrency","force","currencyCode","currencyMoney","currencySymbol","toFixed","convertCurrency","store","pendingID","OPEN_THING","updateAppContext","contextObject","context","loggedIn","updateState","k","v","ignoreCralwed","existence","THINGS","SALES","getCrawled","count","selector","value","t","index","__THING_CACHE","Keys","Sidebar","Wrap","Body","Title","Price","Form","Desc","Owner","mapStateToThingProps","getSales","getDescription","description","details","propertyDescription","getSaleItemId","is_admin_any","inactive_sales","getSeller","getDetailType","getFirstSaleOption","ignoreEmptySaleOption","opts","filter","discount_percentage","quantity","retail_price","newPrice","regex","test","getDomesticDeliveryDate","date","expected_delivery_day_1","expected_delivery_day_2","getIntlDeliveryDate","expected_delivery_day_intl_1","expected_delivery_day_intl_2","currencyIsUSD","saleOptionWaitingRegistry","setWaiting","chosenSaleOptionID","setResult","getWaiting","waiting","chosenSaleOption","fillArray","original","filler","ol","fl","sparseIdxs","j","tid","optionId","hotelImages","salesImages","thingImages","thumbnailsLimit","thumbnail_src","thumbnailUrl","unshift","video","thumbType","thumbnail_url","position","isNumber","isVanityQueriable","props","suppress","AC","minPrice","maxPrice","keyword","trim","original_labels","isNaN","parseInt","labels","ok","getSafeNameProp","dangerouslySetInnerHTML","__html","children","isVideoUploadable","salesAvailable","getThingName","AddlistPopup","lists","listSearchQuery","listCreationQuery","listCreating","setState","drawUserList","setTimeout","listSearchInput","focus","target","preventDefault","which","KEYS","objectId","updateList","createList","updated","stopPropagation","targ","currentTarget","selectedListId","Number","getAttribute","theList","list","prevAdded","added","eventName","update","dialog","popupName","$obj","on","handleDialogOpen","prevProps","prevState","center","getListCheckbox","res","element","handleListSearch","el","term","toLowerCase","style","Display","indexOf","ident","classnames","handleListItemToggle","quickCreateList","handleListCreation","handleCreateListQueryChange","Component","resp","status_code","message","closePopup","error","err","checked","unchecked","payload","join","post","AdminPopup","show_on_homepage","date_published","exclude_from_popular","show_in_search","optionSaving","ownerSaving","mergeSaving","thing_id","inputDate","Date","toISOString","split","Object","assign","changeOwnerEl","new_owner","thing_owner","confirm","new_owner_name","new_thing_id","ntid","old_user_id","xmlUtil","reload","always","that","handleSaveOptions","handleChangeOwner","React","SimpleSharePopup","log","shareUrl","copyToClipboard","urlCopied","connector","handleCopyLink","encodeURIComponent","getFancyContextDefaultValue","FancyContext","useFancy","Favorite","useDispatch","handleClick","require_login","ActionButtons","msg","cnt","full_name","tagName","renderPopup","FancydByPopupV4","objectType","FancyUser","viewerId","isTouchDevice","navigator","maxTouchPoints","msMaxTouchPoints","SwiperAddons","Thumbs","Zoom","SwiperCore","placeholderImage","PER_PAGE","preloadImage","Promise","r","onload","onerror","ImageSlide","memo","setSlideLocked","isActive","useState","isZoomActive","setZoomActive","zoomImageStyle","setZoomImageStyle","zoomImageCacheKey","setZoomImageCacheKey","zoomImageLoaded","setZoomImageLoaded","isVideo","h264_1000k_url","isMagnifyingGlassZoomable","useEffect","large_image_url","handleMouseEvent","pageX","pageY","nextZoomImageStyle","getNextZoomImageStyle","startZoom","zoomShow","fullScreen","cursor","getZoomImageStyle","backgroundColor","backgroundImage","nextProps","displayName","imageOnly","galleryThumbsDirection","thumbsPerView","fancyProps","swiperRef","useRef","swipeThumbsRef","thumbIndex","setThumbIndex","slideLocked","swiper","setSwiper","lastThumbIndex","activeIndex","slideTo","current","thumbSwiper","slides","classList","contains","Math","min","prevEl","opacity","max","nextEl","loadPrevNext","loadPrevNextAmount","maxRatio","scale","clickedIndex","selected","zoomBoxMaximumSize","zoomScale","getBoundarySize","$el","eq","DEBUG","getZoomBoxSize","bs","getZoomMargin","zidCac","getZoomImageDimension","zoomMargin","ret","getImageMeta","marginHoriz","marginVert","$fig","$wrapper","boundaryWidth","boundaryHeight","meta","offset","left","top","topPosition","showZoomImage","zoomBoxSize","zd","zoomImageContainerX","minmax","zoomImageContainerY","backgroundLeft","backgroundTop","bgPosX","bgPosY","transform","backgroundPosition","display","RESIZED_SIZE","calculateImageSize","size","smallerSize","proportion","larger","isZoomable","imageSize","boundarySize","currentZoomImageStyle","backgroundSize","ApplePayButton","applePayTest","selectedQuantity","handleApplePayCheckout","FancyApplePay","clicked","salesOptionsAvailable","country","sale_item_id","requestPurchase","testmode","trace","WebkitAppearance","ApplePayButtonType","ApplePayButtonStyle","CartButton","onPurchase","onNotifyLater","useCallback","appState","opt","params","remove","subscribed","Button","label","optionValueFunction","saleNamePrinter","Fancy","discounting","retailPrice","discountPercentage","sale","floatFormatMinusTwo","numberFormat","SaleItemSidebarHead","showSelectWarning","disabled","multiOptionState","CurrencyPopup","currentCurrency","renderCurrencyPopup","saleOption","optionIsMulti","isOptionMulti","sale_id","personalization","CartAPI","addItem","close","Cart","openPopup","os","o","total","displayItems","checkAvailability","applePayDisplay","option_meta","getInitialMultiOptionState","updateSaleOptionIDFromMultiOptionState","presetOptionId","String","selectedOptionArray","m","order","orderMap","selectedOption","every","values","extractSaleOptionIDFromMultiOptionState","amendedID","amendSaleOptionFromMultiOptionState","nextSelected","swatch","button","thumbnail","dropdown","selectedValue","getPossibleValuesForIndex","indexOfType","attr","className","onClickThumbnail","onClickMultiOptionGen","onClickSwatch","onMultiSelectBoxChange","onClickMutliButton","initializeMultiOption","checkApplePay","nsc","nextSaleOptionID","_o","mos","$so","escapeSelector","is","click","paymentRequest","nonSoldout","selectedNonSoldoutOption","nextValue","MultiOptionState","priceChanges","currencyChanges","showInfo","quantitySelectRange","range","showSelectbox","applePayButton","SaleItemOptionsExpander","handleOptionChange","hasSizeGuide","size_guide_id","SizeGuidePopup","personalizable","handlePersonalizationChange","handleQuantityChange","handlePurchase","sio","SaleOptions","currentValue","expander","defaultValue","printer","onChange","onClick","onFocus","unselectedLabel","SelectBox","tabIndex","SizeGuide","s","labelValue","targetIndex","filteredOptions","sel","uniq","MultiOption","sid","multiOptions","getMultiOptions","sizeGuidePos","indexTypeOf","additional","selectedArray","key","showSizeGuide","MultiSelectBox","MultiSelectBoxOption","MultiSwatch","MultiSwatchOption","MultiThumbnail","MultiThumbnailOption","MultiButton","MultiButtonOption","EXPIRED","REMOVED","PENDING","COMING_SOON","ACTIVE","SOLD_OUT","FancyStatus","Addition","Removal","AfterAddition","AfterRemoval","Idle","textareaHeight","collapsed","expanded","commonWrapperSelector","Selectors","HomepageWrapper","ThingViewConfig","StaticThingViewConfig","ThumbnailsLimit","Basic","More","handleOverlayThingKeyEvents","pagingContext","conditionalTransition","aElement","isStream","has","transition","LinkTypes","oneshotEventAttached","attachEntryEvents","body","__INIT_THING_ANCHOR","isPlainLeftClick","getObjectTypeFromUrl","getPathname","$targ","didClickOn","eitherFancy","sharedState","draggingAdmin","OtContainer","isStaticCache","isStatic","getDynamic","getStatic","scrollToTop","parentElement","scrollTop","scrollEvent","handleScroll","attach","func","prepare","detach","_prepare","throttle","viewportHeight","documentElement","clientHeight","scrollHeight","containerEl","addEventListener","passive","removeEventListener","initialThingPageID","extractMetaFromURL","pathname","initialPageIsThingPage","initialPath","preservedHref","initialTitle","locationIsThingPage","overlayIsOn","runOverlay","thingURLType","hasClass","requestIdleCallback","addClass","stopOverlay","reloadCurrentThing","historyHook","search","Dynamic","Static","Timeline","Internal","linkType","redirect","removeClass","init","movePrev","moveNext","destination","getUtm","$nav","$shopLink","getUtmString","loaded","lastFullyRenderedThingID","getInitialStoreState","action","updateShallow","__FancyUser","userCountry","cookie","current_country_code","populateThingContext","URLMeta","followStore","Boolean","seller_follow","followUser","nextFancydState","saleOptionInclSales","nextContext","rootReducer","combineReducers","contextName","contexts","getAllInitialStoreState","contextKey","middlewares","thunk","process","logger","configureStore","reducer","preloadedState","middleware","getDefaultMiddleware","serializableCheck","prepend"],"mappings":"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","file":"_static_modules_ui_overlay-thing_components_v2_Thing_Image_index_tsx-_static_modules_ui_overl-b8f045.24e7a90d873d869dc4e6.js","sourcesContent":["// -- Members --\n// className: string\n// - class name that used from sidebar head 'wrapper figure-info {className}'.\n// type: string\n// - meta string that indicates type name\nimport { mergeObjectArgs } from 'fancyutils';\n\nexport class ThingTypeMeta {\n    static isSale = false;\n    static type = 'ThingTypeMeta';\n\n    getName(thingContext) {\n        return thingContext.name;\n    }\n}\n\nexport class PlainThingType extends ThingTypeMeta {\n    static className = '';\n    static type = 'PlainThing';\n    static createEmptyObject(...args) {\n        const objectArgs = mergeObjectArgs(args);\n        const thing = $.extend(true, {\n            id: '1',\n            url: '/',\n            isCrawled: false,\n            owner: {},\n            image: { src: '', width: 1, height: 1 },\n            user: {},\n            type: 'thing',\n            fancyd_friends: [],\n        }, objectArgs);\n        thing.META = getThingType(thing);\n        return thing;\n    }\n}\n\nexport class SaleItemType extends ThingTypeMeta {\n    static className = '';\n    static type = 'SaleItem';\n    static getName(thingContext) {\n        return thingContext.sales.name;\n    }\n    static createEmptyObject(objectArgs) {\n        return PlainThingType.createEmptyObject({\n            sales_available: true,\n            sales: {\n                id: '1',\n                review_rating: 1,\n                review_count: 1,\n                size_chart_ids: ['1'],\n                images: [{ src: '', width: 1, height: 1 }],\n                seller: { id: '1' }\n            },\n            type: 'sales'\n        }, objectArgs);\n    }\n}\n\nexport class GiftcardType extends SaleItemType {\n    static className = 'giftcard';\n    static type = 'Giftcard';\n\n    static getName() {\n        return window.gettext(\"Fancy Gift Card\");\n    }\n}\n\nexport class HotelType extends SaleItemType {\n    static className = 'hotel';\n    static type = 'Hotel';\n\n    static getName(thingContext) {\n        return thingContext.hotel_search.hotel.name;\n    }\n}\n\nexport class VanityType extends SaleItemType {\n    static className = 'vanity';\n    static type = 'Vanity';\n}\n\nexport class LaunchAppType extends ThingTypeMeta {\n    static className = '';\n    static type = 'LaunchApp';\n}\n\n// Retrieve meta by looking up thing object.\nexport function getThingType(thingContext) {\n    var ThingType;\n    if (thingContext.hotel_search) {\n        ThingType = HotelType;\n    } else if (thingContext.has_launch_app && thingContext.metadata) {\n        ThingType = LaunchAppType;\n    } else if (thingContext.type === 'giftcard') {\n        ThingType = GiftcardType;\n    } else if (thingContext.sales_available) {\n        if (thingContext.type === 'vanity_number') {\n            ThingType = VanityType;\n        } else {\n            ThingType = SaleItemType;\n        }\n    } else {\n        ThingType = PlainThingType;\n    }\n    return ThingType;\n}\n\nconst ThingTypes = [PlainThingType, SaleItemType, GiftcardType, HotelType, VanityType, LaunchAppType];\n\n// TODO: immutable\nThingTypes.forEach(AttachingType => {\n    ThingTypes.forEach(ComparingType => { \n        AttachingType[ComparingType.type] = AttachingType === ComparingType;\n    });\n});\n","// Generate `key: String(key)` structure by given string key arguments\nfunction constantGen() {\n    var keys = [].slice.call(arguments);\n    return keys.reduce((prev, next) => {\n        prev[next] = next;\n        return prev;\n    }, {});\n}\n\nvar C = constantGen(\n  'UPDATE_APP_CONTEXT',\n  // Loading\n  'REQUEST_THING',\n  'REQUEST_THING_FAILURE',\n  'LOAD_THING',\n\n  // UI Actions\n  'OPEN_THING',\n  'CLOSE_THING',\n\n  // Comment form suggestion\n  'SET_USERNAME_KEYWORD',\n  'LOAD_SUGGESTION',\n\n  // Thumbnail\n  'SET_THUMBNAIL_INDEX',\n\n  // Follow\n  'TOGGLE_FOLLOW',\n  'CANCEL_FOLLOW',\n  'COMPLETE_FOLLOW',\n\n  // Fancy\n  'TOGGLE_FANCY',\n  'CANCEL_FANCY',\n  'COMPLETE_FANCY',\n\n  // Saleitem\n  'UPDATE_SALE_CONTEXT'\n);\n\nexport default C;\n","import { MP, getLocationArgPairs, isEmpty, isStaticPage, stripPathname } from \"fancyutils\";\nimport { Dispatch, State } from \"redux\";\nimport { ThunkAction } from \"redux-thunk\";\n\nimport { history } from \"common-components\";\nimport { historyData } from \"../container/history\";\nimport store from \"../store/store\";\nimport { closeModal } from \"../container/routeutils\";\nimport {\n    closeThing,\n    openThing,\n    loadThing,\n    requestThing,\n    requestThingFail,\n    toggleFollow as toggleFollowAction,\n    cancelFollow,\n    completeFollow,\n    toggleFancy as toggleFancyAction,\n    cancelFancy,\n    completeFancy,\n    setThumbnailIndex,\n} from \"./actions\";\nimport C from \"./action-constants\";\nimport { formatPrice, isSalesOptionsAvailable, getCurrentSaleOption, getSaleImages } from \"../components/map\";\nimport { ThingCache, cache } from \"../cache\";\nimport { salesStatus } from \"../config\";\nimport { ThingObject, SaleContext } from \"ftypes\";\n\nfunction shouldOpenThing(state) {\n    return state.appContext.visible !== true;\n}\n\n// Blocks illegal requests\nfunction shouldFetchThing(state, thingID) {\n    if (state.thing.ID === thingID || state.thing.isFetching) {\n        return false;\n    } else {\n        return true;\n    }\n}\n\nexport function closeOverlay() {\n    return (dispatch: Dispatch) => {\n        if (isStaticPage()) {\n            return;\n        }\n        closeModal();\n        historyData.overlayIsOn = false;\n        history.push(stripPathname(historyData.preservedHref), null);\n        document.title = historyData.initialTitle;\n\n        dispatch(closeThing());\n        $(document).off(\"keydown.overlayThing\");\n        $(window).trigger(\"scroll\");\n    };\n}\n\nfunction onDataFetched(dispatch: Dispatch, thingID, thing, type) {\n    addAdditionalThingContext(thing);\n    cache.add(thingID, thing, type);\n    dispatch(loadThing(thingID, thing));\n    onLoadThing(thing);\n}\n\nconst fetchedThingsIds = {};\n\nexport function fetchThing(\n    thingID: string,\n    type = ThingCache.THINGS,\n    killCache = false,\n    override = false,\n    queryString = \"\"\n) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        if (thingID == null) {\n            console.warn(\"fetchThing(): thingID was null.\");\n            return;\n        }\n        var state = getState();\n        if (shouldOpenThing(state)) {\n            dispatch(openThing());\n        }\n        if (killCache) {\n            cache.remove(thingID, type);\n            delete state.thing;\n        }\n\n        const shouldFetch = override || shouldFetchThing(state, thingID);\n        if (killCache || shouldFetch) {\n            if (cache.exists(thingID, type)) {\n                const cac = cache.get(thingID, type);\n                dispatch(loadThing(thingID, cac));\n                onLoadThing(cac);\n                // if cache is crawled one, request should continue\n                if (!cac.isCrawled) {\n                    return;\n                }\n            }\n\n            // static ot page prefetch\n            if (window.thingPageData) {\n                const thingPageData = window.thingPageData;\n                onDataFetched(dispatch, thingID, thingPageData, type);\n                delete window.thingPageData;\n                return;\n            }\n\n            dispatch(requestThing(thingID));\n            let options;\n\n            options = { owner: true, external_apps: true, viewer: true };\n            if (getLocationArgPairs(\"admin\")) {\n                options.admin = true;\n            }\n            if (type === ThingCache.SALES) {\n                options.sales = true; // /sales/(+d) URL\n            }\n            const successFn = (thing) => {\n                if (thing.need_more_fetch) {\n                    // Load main image as fast as possible.\n                    if (thing.image_resized_max && thing.image_resized_max.src) {\n                        let img = new Image();\n                        img.src = thing.image.src;\n                    }\n                    fetchedThingsIds[thingID] = 1;\n                    dispatch(loadThing(thingID, thing));\n                    onLoadThing(thing);\n                } else {\n                    fetchedThingsIds[thingID] = 2;\n                    onDataFetched(dispatch, thingID, thing, type);\n                }\n            };\n            const failFn = (failureXHR) => {\n                // FIXME: This error handling only happens when there's server-side error -\n                //        can't handle client-side ones\n                dispatch(requestThingFail(/*thingID*/));\n                if (failureXHR && failureXHR.status === 404) {\n                    alertify.alert(\"This page is not available. Please try again later.\");\n                } else {\n                    alertify.alert(\n                        'There was an error while opening the page.<br> Please try again or contact <a mailto=\"cs@fancy.com\">cs@fancy.com</a>.'\n                    );\n                }\n            };\n            if (window.requestPromise) {\n                const requestPromise = window.requestPromise;\n                delete window.requestPromise;\n                requestPromise.then(successFn).catch(failFn);\n            } else {\n                $.get(`/rest-api/v1/things/${thingID}/details${queryString}`, options).then(successFn).fail(failFn);\n            }\n        }\n    };\n}\n\nexport function getCordialProperties(thing) {\n    const prop = {\n        thingID: thing.id,\n        productID: thing.sales.id,\n        seller: thing.sales.seller.username,\n        url: \"https://fancy.com\" + thing.url,\n        name: thing.emojified_name,\n        category: thing.sales.cordial_category,\n        instock: thing.sales.available && !thing.sales.soldout,\n        image: thing.images[0].image_url,\n        price: parseFloat(thing.sales.min_price),\n    };\n    if (thing.recommended && thing.recommended.length) {\n        prop[\"recommended\"] = thing.recommended.map((item, i) => item.id);\n    }\n    return prop;\n}\n\nfunction onLoadThing(thing) {\n    const MPArgs = { \"thing id\": thing.id };\n    const currentLocationArgPair = getLocationArgPairs(\"utm\");\n    if (currentLocationArgPair) {\n        MPArgs.utm = currentLocationArgPair[1];\n    }\n    MP(\"View Thing Detail\", MPArgs);\n    if (typeof LogExposed != \"undefined\") window.LogExposed.addLog(thing.id + \"\", \"thing\");\n    try {\n        window.crdl(\"event\", \"browse\", getCordialProperties(thing));\n    } catch (e) {}\n    try {\n        let trackingItem;\n        if (thing.sales) {\n            trackingItem = {\n                id: thing.sales.id,\n                brand: thing.sales.seller.brand_name,\n                name: thing.sales.emojified_name || thing.emojified_name,\n                price: thing.sales.price,\n            };\n            window.dataLayer.push({\n                product_id: thing.sales.id,\n                event: \"ProductPage\",\n                products: undefined,\n                products_info: undefined,\n                revenue: undefined,\n                option_id: thing.sales.options && thing.sales.options.length ? thing.sales.options[0].id : undefined,\n            });\n        } else {\n            trackingItem = {\n                id: thing.id,\n                name: thing.emojified_name,\n            };\n        }\n        window.TrackingEvents.viewItem(trackingItem);\n        ga(\"send\", { hitType: \"pageview\", page: location.href, title: document.title });\n    } catch (e) {}\n}\n\nfunction addAdditionalThingContext(thingData: ThingObject) {\n    thingData.fromServer = true;\n    thingData.sales_available =\n        !isEmpty(thingData.sales) &&\n        !thingData.sales.show_anywhere_only &&\n        thingData.sales.status !== salesStatus.EXPIRED; // TODO: need to check exact condition.\n}\n\nexport function toggleFollow({ seller_id, user_id }) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var state = getState();\n        var followType;\n        var data;\n        if (seller_id) {\n            followType = \"followStore\";\n            data = { seller_id };\n        } else if (user_id) {\n            followType = \"followUser\";\n            data = { user_id };\n        } else {\n            return;\n        }\n\n        if (state.followContext[followType].loading === false) {\n            var url = state.followContext[followType].following === true ? \"/delete_follow.xml\" : \"/add_follow.xml\";\n            dispatch(toggleFollowAction(followType));\n            $.ajax({\n                url,\n                data,\n                type: \"post\",\n                dataType: \"xml\",\n            })\n                .done(function (xml) {\n                    var $status = $(xml).find(\"status_code\");\n                    if ($status.length && $status.text() !== 0) {\n                        dispatch(completeFollow(followType));\n                    } else {\n                        dispatch(cancelFollow(followType));\n                    }\n                })\n                .fail(function () {\n                    dispatch(cancelFollow(followType));\n                });\n        }\n    };\n}\n\nexport function toggleFancy(thingID: string) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var state = getState();\n        var { fancyd, fancyd_count, loading } = state.fancyContext;\n        if (!loading) {\n            dispatch(toggleFancyAction(thingID));\n            $.ajax({\n                type: \"PUT\",\n                url: `/rest-api/v1/things/${thingID}`,\n                data: {\n                    fancyd: !fancyd,\n                },\n            })\n                .done(function (json) {\n                    var fc = 0;\n                    if (json.id && json.fancyd === !fancyd) {\n                        if (json.fancyd === true) {\n                            fc = fancyd_count + 1;\n                        } else if (json.fancyd === false) {\n                            fc = fancyd_count - 1;\n                        }\n                        // cache.update(thingID, undefined, \"fancyd\", json.fancyd);\n                        // cache.update(thingID, undefined, \"fancyd_count\", fc);\n\n                        dispatch(completeFancy(thingID, fc));\n                    } else {\n                        dispatch(cancelFancy(thingID));\n                    }\n                })\n                .fail(function () {\n                    dispatch(cancelFancy(thingID));\n                });\n        }\n    };\n}\n\nfunction calculatePrice(thing: ThingObject, saleContext: SaleContext, newContext: SaleContext) {\n    const saleOptionID = newContext.saleOptionID || saleContext.saleOptionID;\n    const sales = thing && thing.sales;\n    // Get object basis for retrieving price.\n    if (isSalesOptionsAvailable(sales)) {\n        const basis = _.find(sales.options, (option) => option.id === saleOptionID);\n        if (basis != null) {\n            return basis.price;\n        } else {\n            console.warn(\n                \"calculatePrice():\",\n                \"Wrong saleOptionID supplied, please investigate. saleOptionID: \",\n                saleOptionID\n            );\n            return 0;\n        }\n    } else if (sales != null) {\n        return sales.price;\n    } else {\n        return 0;\n    }\n}\n\nexport function updateSaleContext(newContext: SaleContext) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var { thing, saleContext, slideContext } = getState();\n        newContext.price = calculatePrice(thing.data, saleContext, newContext);\n        dispatch({ ...newContext, type: C.UPDATE_SALE_CONTEXT });\n        if (saleContext.saleOptionID !== newContext.saleOptionID) {\n            const option = getCurrentSaleOption(thing.data.sales, newContext, true);\n            const saleImages = getSaleImages(thing.data, option);\n            let firstOptionImageIdx;\n            if (\n                option &&\n                saleImages.some((img, idx) => {\n                    if (img.option_id === option.id) {\n                        firstOptionImageIdx = idx;\n                        return true;\n                    }\n                })\n            ) {\n                // blank\n            } else {\n                if (slideContext.thumbnailIndex > saleImages.length - 1) {\n                    firstOptionImageIdx = 0;\n                }\n            }\n            if (firstOptionImageIdx) {\n                dispatch(setThumbnailIndex(firstOptionImageIdx));\n            }\n        }\n    };\n}\n\nfunction requestCurrencyConversion(nextCode: string, nextPrice: string, callback) {\n    const shouldConvert = !(nextCode == null || callback == null);\n    if (shouldConvert) {\n        if (window.numberType === 2) {\n            nextPrice = nextPrice.replace(/,/g, \".\").replace(/ /g, \"\");\n        }\n        if (_.isString(nextPrice)) {\n            nextPrice = nextPrice.replace(/,/g, \"\");\n        }\n        $.ajax({\n            url: \"/convert_currency.json\",\n            type: \"GET\",\n            dataType: \"json\",\n            data: {\n                amount: nextPrice,\n                currency_code: nextCode,\n            },\n        }).success(({ amount, currency } = {}) => {\n            if (amount == null) {\n                return;\n            }\n            callback(currency.code, formatPrice(amount, currency.code), currency.symbol);\n        });\n    }\n}\n\nfunction _convertCurrency(nextCode: string, nextPrice: string, force: boolean) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        const { saleContext } = getState();\n        if (nextCode !== \"USD\") {\n            if (\n                force || // FIXME: unable to comparison since price update comes first (SaleitemSidebarHead.componentWillReceiveProps())\n                saleContext.price !== nextPrice || // currency price changed\n                saleContext.currencyCode !== nextCode || // currency code changed\n                saleContext.currencyMoney == null || // currency symbol/money is not set (changed from usd)\n                saleContext.currencySymbol == null\n            ) {\n                nextPrice = nextPrice || saleContext.price || \"0.00\";\n                requestCurrencyConversion(nextCode, nextPrice, (currencyCode, currencyMoney, currencySymbol) => {\n                    if (typeof currencyMoney === \"number\") {\n                        currencyMoney = currencyMoney.toFixed(2);\n                    }\n                    currencyMoney = currencyMoney.replace(/[ \\.]00$/, \"\");\n                    dispatch(\n                        updateSaleContext({\n                            currencyCode,\n                            currencyMoney,\n                            currencySymbol,\n                        })\n                    );\n                });\n            } else {\n                // NOOP\n            }\n        } else {\n            dispatch(\n                updateSaleContext({\n                    currencyCode: \"USD\",\n                    currencyMoney: null,\n                    currencySymbol: null,\n                })\n            );\n        }\n    };\n}\n\nexport function convertCurrency(nextCode, nextPrice, force = false) {\n    store.dispatch(_convertCurrency(nextCode, nextPrice, force));\n}\n","import C from './action-constants';\n\n\n// Action on requesting thing starts\nexport function requestThing(pendingID) {\n    return {\n        type: C.REQUEST_THING,\n        status: 'request',\n        pendingID\n    };\n}\n\n// Action on requesting thing fails\nexport function requestThingFail() {\n    return {\n        type: C.REQUEST_THING_FAILURE,\n        status: 'failed'\n    };\n}\n\n// action on loading request result\nexport function loadThing(ID, data) {\n    return {\n        type: C.LOAD_THING,\n        status: 'idle',\n        ID,\n        data\n    };\n}\n\n// Action on close overlay\nexport function openThing() {\n    return {\n        type: C.OPEN_THING\n    };\n}\n\n// Action on close overlay\nexport function closeThing() {\n    return {\n        type: C.CLOSE_THING,\n        ID: null,\n        pendingID: null,\n        thing: null\n    };\n}\n\n\nexport function setThumbnailIndex(thumbnailIndex) {\n    return {\n        type: C.SET_THUMBNAIL_INDEX,\n        thumbnailIndex,\n    };\n}\n\nexport function toggleFollow(followType) {\n    return {\n        type: C.TOGGLE_FOLLOW,\n        followType\n    };\n}\n\nexport function cancelFollow(followType) {\n    return {\n        type: C.CANCEL_FOLLOW,\n        followType\n    };\n}\n\nexport function completeFollow(followType) {\n    return {\n        type: C.COMPLETE_FOLLOW,\n        followType\n    };\n}\n\nexport function toggleFancy(thingID) {\n    return {\n        type: C.TOGGLE_FANCY,\n        thingID,\n    };\n}\n\nexport function cancelFancy(thingID) {\n    return {\n        type: C.CANCEL_FANCY,\n        thingID,\n    };\n}\n\nexport function completeFancy(thingID, fancyd_count) {\n    return {\n        type: C.COMPLETE_FANCY,\n        thingID,\n        fancyd_count\n    };\n}\n\nexport function updateAppContext(contextObject) {\n    return {\n        type: C.UPDATE_APP_CONTEXT,\n        context: contextObject\n    };\n}\n","// App state that does not usually change during app lifecycle. (i.e. Login state)\n\n// module-level login state object and setter\nconst state : { viewer: {}; loggedIn: Boolean; } = { viewer: {}, loggedIn: false };\nexport default state;\n\nexport function updateState(k, v) {\n    state[k] = v;\n}\n","import { index } from 'fancyutils';\n\n// Cache bucket\nexport class ThingCache {\n    things = {};\n    sales = {};\n    count = 0;\n    static SALES = 'sales';\n    static THINGS = 'things';\n\n    exists = (id, type, ignoreCralwed) => {\n        const cac = this.get(id, type);\n        var existence = cac != null && typeof cac === 'object';\n        if (ignoreCralwed) {\n            existence = existence && cac.isCrawled !== true;\n        }\n        return existence;\n    }\n\n    // resolver function\n    _get = (id) => {\n        return this[ThingCache.THINGS][id] || this[ThingCache.SALES][id] || null;\n    }\n\n    get = (id, type = ThingCache.THINGS) => {\n        const cac = this[type][id] || this.getCrawled(id, type);\n        return cac;\n    }\n\n    getCrawled = (id, type) => {\n        const cac = this[type][id];\n        if (cac && cac.isCrawled) {\n            return cac;\n        } else {\n            return null;\n        }\n    }\n\n    add = (id, data, type) => {\n        // to add, cache should not be exist or crawled one\n        const cac = this[type][id];\n        if (\n            cac == null || \n            cac.isCrawled === true\n        ) {\n            this[type][id] = data;\n            // Store thing information as well\n            if (type === ThingCache.SALES && data.id) {\n                this[ThingCache.THINGS][data.id] = data;\n            }\n            this.count += 1;\n        } else {\n            console.warn('cache.add(): Cache overwrite');\n        }\n    }\n\n    remove = (id, type) => {\n        if (this[type][id]) {\n            delete this[type][id];\n            this.count -= 1;\n        } else {\n            console.warn('cache.remove(): Non-existing cache removal');\n        }\n    }\n\n    // selector = 'a.b.c'\n    update = (id, type = ThingCache.THINGS, selector, value) => {\n        if (selector == null) {\n            console.warn('ThingCache#update(): selector is empty');\n            return;\n        }\n        const t = this.get(id, type);\n        if (t) {\n            index(t, selector, value);\n        }\n    }\n\n    // sweep() {\n    //     // TODO: should sweep cache if too many cache added by looking `cache.count`\n    // }\n}\n\nexport const cache = new ThingCache();\nwindow.__THING_CACHE = cache;\n","export const Keys = {\n    Sidebar: {\n        Wrap: 'SIDEBAR_WRAP',\n        Body: 'SIDEBAR_BODY',\n        Title: 'SIDEBAR_TITLE',\n        Price: 'SIDEBAR_PRICE',\n        Form: 'SIDEBAR_FORM',\n        Desc: 'SIDEBAR_DESCRIPTION',\n        Owner: 'SIDEBAR_OWNER',\n    },\n};\n","import { alertify, isEmpty } from \"fancyutils\";\nimport {\n    SaleObject,\n    SaleContext,\n    ThingObject,\n    FancyReduxState,\n    User,\n    ThingImage,\n    OverlayPropsV1,\n} from \"ftypes\";\nimport { SaleItem } from \"_static/modules/ThingDetail\";\n\nconst { gettext, _ } = window;\n\nexport function mapStateToThingProps(state: FancyReduxState): OverlayPropsV1 {\n    const {\n        appContext,\n        thing: { data, isFetching, status },\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    } = state;\n\n    return {\n        appContext,\n        status,\n        thing: data,\n        isFetching,\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    };\n}\n\nexport function getSales(type: string, thing: ThingObject) {\n    return thing.sales;\n}\n\nexport function getDescription(type: string, thing: ThingObject) {\n    if (type === \"sales\") {\n        return thing.sales.description;\n    } else if (type === \"hotel\") {\n        return thing.hotel_search.details.propertyDescription;\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSaleItemId(thing: ThingObject, viewer: User) {\n    if (viewer && viewer.is_admin_any) {\n        if (thing.sales) {\n            return thing.sales.id;\n        } else if (thing.inactive_sales) {\n            return thing.inactive_sales.id;\n        }\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSeller(thing: ThingObject) {\n    if (thing.sales) {\n        return thing.sales.seller;\n    } else if (thing.inactive_sales) {\n        return thing.inactive_sales.seller;\n    }\n}\n\nexport function getDetailType(thing: ThingObject) {\n    if (thing.hotel_search) {\n        return \"hotel\";\n    } else if (thing.sales_available && thing.type !== \"vanity_number\") {\n        return \"sales\";\n    } else if (!thing.sales_available && !thing.has_launch_app && thing.type !== \"giftcard\") {\n        return \"urlOnly\";\n    }\n}\n\nexport function isSalesOptionsAvailable<T extends SaleItem>(sales: T | null) {\n    return sales != null && !isEmpty(sales.options);\n}\n\nexport function getFirstSaleOption(sales: SaleItem, ignoreEmptySaleOption = false) {\n    if (isSalesOptionsAvailable(sales)) {\n        return sales.options[0];\n    } else if (ignoreEmptySaleOption === false) {\n        return sales || null;\n    }\n}\n\nexport function getCurrentSaleOption<T extends SaleItem>(sales: T, saleContext: SaleContext = {}, ignoreEmptySaleOption = false) {\n    const { saleOptionID } = saleContext;\n\n    if (isSalesOptionsAvailable<T>(sales)) {\n        if (saleOptionID) {\n            const opts = _(sales.options).filter((prop) => prop.id === saleOptionID);\n            if (opts[0] == null) {\n                console.warn(\"saleOption should not be null!\");\n            }\n\n            return opts[0] == null\n                ? {\n                      id: 0,\n                      discount_percentage: \"0.0\",\n                      quantity: 0,\n                      soldout: true,\n                      retail_price: 0,\n                      name: '',\n                  }\n                : opts[0];\n        } else {\n            return sales.options[0];\n        }\n    } else if (ignoreEmptySaleOption === false) {\n        return sales;\n    }\n}\n\nexport function formatPrice(amount: number, currency: string) {\n    if (currency == \"BTC\") return amount + \"\";\n    var newPrice = amount.toFixed(2) + \"\";\n    var regex = /(\\d)(\\d{3})([,\\.]|$)/;\n    while (regex.test(newPrice)) {\n        newPrice = newPrice.replace(regex, \"$1,$2$3\");\n    }\n    if (window.numberType === 2) {\n        newPrice = newPrice.replace(/,/g, \" \").replace(/\\./g, \",\");\n    }\n    return newPrice;\n}\n\n// sales: thing.sales\nexport function getDomesticDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    if (sales.expected_delivery_day_1) {\n        date += sales.expected_delivery_day_1;\n    }\n    if (sales.expected_delivery_day_2) {\n        date += \" - \" + sales.expected_delivery_day_2;\n    }\n    return date;\n}\n\n// sales: thing.sales\nexport function getIntlDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    // TODO: use moment for locale string\n    if (sales.expected_delivery_day_intl_1) {\n        date += sales.expected_delivery_day_intl_1;\n    }\n    if (sales.expected_delivery_day_intl_2) {\n        date += \" - \" + sales.expected_delivery_day_intl_2;\n    }\n    return date;\n}\n\nexport function currencyIsUSD({ saleContext }: { saleContext: SaleContext }) {\n    return saleContext.currencyCode === \"USD\";\n}\n\n// [sale option id]: { true | false }\nconst saleOptionWaitingRegistry = {};\nwindow.saleOptionWaitingRegistry = saleOptionWaitingRegistry;\nexport function setWaiting(chosenSaleOptionID, setResult) {\n    saleOptionWaitingRegistry[chosenSaleOptionID] = setResult;\n}\nexport function getWaiting<T extends SaleItem>(sales: T, saleContext) {\n    if (sales == null) {\n        return null;\n    }\n    if (saleContext.waiting != null) {\n        return saleContext.waiting;\n    }\n\n    // https://app.asana.com/0/86925821949642/160205241997173\n    // It could be a bit weird for future, but design-side decision\n    if (sales.waiting) {\n        return sales.waiting;\n    }\n\n    const chosenSaleOption = getCurrentSaleOption(sales, saleContext);\n    // options is SaleItem\n    if (sales.id === chosenSaleOption.id) {\n        return sales.waiting;\n        // option is SaleOption\n    } else {\n        if (saleOptionWaitingRegistry[chosenSaleOption.id] != null) {\n            return saleOptionWaitingRegistry[chosenSaleOption.id];\n        } else if (chosenSaleOption.waiting != null) {\n            return chosenSaleOption.waiting;\n        }\n    }\n}\n\nfunction fillArray(original: Array<unknown> /*sparse?ArrayToFill*/, filler: Array<unknown>) {\n    const ol = original.length;\n    const fl = filler.length;\n    const sparseIdxs = [];\n    // Find sparse indexes first.\n    for (let j = 0; j < ol; j++) {\n        if (!(j in original)) {\n            sparseIdxs.push(j);\n        }\n    }\n    for (let i = 0; i < fl; i++) {\n        // if sparse indexes are all in (or nonexist), push leftovers to tail\n        if (i > sparseIdxs.length - 1) {\n            original.push(filler[i]);\n        } else {\n            original[sparseIdxs[i]] = filler[i];\n        }\n    }\n    return original;\n}\n\nlet tid;\nlet optionId: undefined;\nlet hotelImages: ThingImage[] | undefined | [];\nlet salesImages;\nlet thingImages;\nexport function getSaleImages(thing: ThingObject, option, thumbnailsLimit?: number) {\n    if (thing.hotel_search != null) {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n\n            hotelImages = <ThingImage[]>thing.hotel_search.images.map((img) => ({\n                src: img.url,\n                thumbnail_src: img.thumbnailUrl,\n                width: img.width,\n                height: img.height,\n            }));\n            hotelImages.unshift(thing.image_resized_max);\n        }\n        return hotelImages;\n    } else if (thing.sales != null) {\n        const images = [];\n        fillArray(images, thing.images);\n        if (option && option.images && option.images.length > 0) {\n            fillArray(images, option.images);\n        }\n        salesImages = images;\n        if (option) {\n            optionId = option.id;\n        }\n        if (thing && thing.sales && thing.sales.video) {\n            images.unshift(thing.sales.video);\n        }\n        return salesImages;\n\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            // optionId = option ? option.id : null;\n            // FIXME: do this somewhere else\n            if (thing.image_resized_max == null) {\n                if (thing.image.src) {\n                    thing.image_resized_max = {\n                        src: thing.image.src,\n                        width: thing.image.width,\n                        height: thing.image.height,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                } else {\n                    thing.image_resized_max = {\n                        src: \"/_ui/images/common/blank.gif\",\n                        width: 1,\n                        height: 1,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                }\n            }\n\n            let images = [];\n\n            if (thing.image_resized_max) {\n                images.push(thing.image_resized_max);\n            }\n\n            if (thing.images && thing.images[0]) {\n                images.push(thing.images[0]);\n            }\n\n            // set sale images\n            if (thing && thing.sales && thing.sales.video) {\n                let video = { src: thing.sales.video.thumbnail_url, thumbType: \"video\" };\n                if (thing.sales.video.position > 0) {\n                    images[thing.sales.video.position] = video;\n                } else {\n                    // set video to first unless the position is set\n                    images.unshift(video);\n                }\n            }\n            if (thing.sales.images) {\n                fillArray(images, thing.sales.images);\n            }\n            salesImages = images;\n        }\n        if (option && optionId !== option.id) {\n            optionId = option.id;\n            if (salesImages == null) {\n                salesImages = [];\n            }\n            if (option.images && option.images.length > 0) {\n                const images = salesImages.filter((img) => img.option_id == null);\n                fillArray(images, option.images);\n                salesImages = images;\n            }\n        }\n\n        return _.isNumber(thumbnailsLimit) && thumbnailsLimit > 0\n            ? salesImages.filter((image, idx) => idx < thumbnailsLimit && image.src)\n            : salesImages;\n    } else {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            if (thing.image_resized_max) {\n                thingImages = [thing.image_resized_max];\n            } else if (thing.image) {\n                thingImages = [thing.image];\n            } else {\n                thingImages = [];\n                // || (option && optionId !== option.id)\n            }\n        }\n        return thingImages;\n    }\n}\n\nexport function isVanityQueriable(props: any, suppress: boolean) {\n    var { AC, minPrice, maxPrice, keyword } = props;\n\n    keyword = $.trim(keyword);\n    AC = $.trim(AC);\n    minPrice = minPrice != null ? minPrice : \"0\";\n    minPrice = $.trim(minPrice).replace(\",\", \"\").replace(\"$\", \"\");\n    maxPrice = $.trim(maxPrice).replace(\",\", \"\").replace(\"$\", \"\");\n\n    const original_labels = alertify.labels;\n    if (AC !== \"\") {\n        if (_.isNaN(parseInt(AC, 10)) || AC.length !== 3) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Invalid area code. Area code should be 3 digits.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (minPrice !== \"\") {\n        if (_.isNaN(parseInt(minPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check min price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n\n        if (parseInt(minPrice, 10) >= parseInt(maxPrice, 10)) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"The max price number should be bigger than min price number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (maxPrice !== \"\") {\n        if (_.isNaN(parseInt(maxPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check max price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (keyword !== \"\") {\n        if (keyword.length < 4) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please enter 4 or more characters.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    return true;\n}\n\nexport function getSafeNameProp({ emojified_name, name }: ThingObject) {\n    if (emojified_name) {\n        return { dangerouslySetInnerHTML: { __html: emojified_name } };\n    } else {\n        return { children: name };\n    }\n}\n\nexport function isVideoUploadable(thing: ThingObject): boolean {\n    if ((thing && thing.hotel_search) || thing.metadata) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction salesAvailable(thing: ThingObject): boolean {\n    if (!isEmpty(thing.sales)) {\n        return thing.sales_available;\n    }\n    return false;\n}\n\nexport function getThingName(thing: ThingObject) {\n    if (thing.type === \"giftcard\") {\n        return gettext(\"Fancy Gift Card\");\n    } else if (salesAvailable(thing)) {\n        return thing.sales.name;\n    } else {\n        return thing.name;\n    }\n}\n","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { closePopup, KEYS, MP, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nexport default class AddlistPopup extends Component {\n    static popupName = 'add-list';\n    state = {\n        lists: [],\n        listSearchQuery: '',\n        listCreationQuery: '',\n        listCreating: false,\n    };\n\n    handleDialogOpen = () => {\n        this.setState({ lists: [], listSearchQuery: '', listCreationQuery: '' });\n        this.drawUserList()\n        setTimeout(() => {\n            this.listSearchInput.focus();\n        }, 0);\n\n    }\n    componentDidMount() {\n        $.dialog(AddlistPopup.popupName).$obj.on('open', this.handleDialogOpen);\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AddlistPopup.popupName).center();\n    }\n\n    drawUserList() {\n        const objectId = this.props.objectId;\n        getListCheckbox({\n            objectId,\n            callback: res => { this.setState(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setState({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (this.state.listCreating) return;\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        this.setState({ listCreating: true })\n        // save new list\n        updateList({\n            objectId,\n            createList: listCreationQuery,\n            callback: (success, updated) => {\n                if (success) {\n                    const { lists } = this.state;\n                    MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    this.setState( {\n                        listCreationQuery: '', listCreating: false,\n                        lists: [ ...updated, ...lists ],\n                    });\n                }\n            }\n        })\n    }\n\n    handleListItemToggle = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = Number(targ.getAttribute('data-listid'));\n        const theList = lists.filter(list => list.id === selectedListId)[0];\n        const prevAdded = theList.added;\n        theList.added = !theList.added;\n        const eventName = theList.added ? \"Add to List\" : \"Remove from List\";\n        this.setState({ lists })\n\n        const callback = (success, updated) => {\n            const { lists } = this.state;\n            if (success) {\n            } else {\n                const theList = lists.filter(list => list.id === selectedListId)[0];\n                theList.added = prevAdded;\n            }\n            this.setState({ lists })\n            MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n        };\n\n        const update = { objectId, callback };\n\n        if (theList.added) update['checked'] = [theList.id];\n        else update['unchecked'] = [theList.id];\n        updateList(update)\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setState({ listCreationQuery: event.target.value });\n    }\n\n    render() {\n        var { objectId } = this.props;\n        var {\n            lists,\n            listSearchQuery,\n            listCreationQuery,\n            listCreating,\n        } = this.state;\n\n        return (\n            <>\n                <p className=\"ltit\">Add to collections</p>\n                <fieldset className=\"search\">\n                    <input type=\"text\" placeholder=\"Search\" className=\"text\" \n                        value={listSearchQuery} ref={(element) => {this.listSearchInput = element;}}\n                        onChange={this.handleListSearch} />\n                </fieldset>\n                <div className=\"list\">\n                    <ul ref={(el) => {this.lists = el;}}>\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style} className={classnames({ \"added\": list.added })}>\n                                <label>{list.name}</label>\n                                <button\n                                    data-listid={list.id} \n                                    onClick={this.handleListItemToggle}\n                                    className=\"btns-blue-embo\">{list.added ? \"Remove\" : \"Add\"}</button>\n                            </li>\n                        )\n                    })}\n                    </ul>\n                </div>\n                <fieldset className=\"create\">\n                    <input \n                        type=\"text\" placeholder=\"Create new collection\" \n                        ref={(element) => {this.quickCreateList = element;}}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}/>\n                    <button className={classnames(\"btn-create\", { \"loading\": listCreating })} style={Display.NoneIf($.trim(listCreationQuery).length == 0)}\n                        onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </fieldset>\n                <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n            </>\n        );\n    }\n}\n\nfunction getListCheckbox({ objectId, callback }) {\n    $.get('/get_list_checkbox.json', { tid: objectId }).done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            closePopup(AddlistPopup.popupName);\n        }\n        callback && callback({ lists: resp.lists })\n    },)\n    .error(err => { \n        alertify.alert(\"Please try again later.\");\n        console.warn(err); \n        closePopup(AddlistPopup.popupName);\n    });\n}\n\nfunction updateList({ objectId, checked, unchecked, createList, callback }) {\n    const payload = { tid: objectId };\n    if (checked) payload['add_list_ids'] = checked.join(',');\n    if (unchecked) payload['remove_list_ids'] = unchecked.join(',');\n    if (createList) payload['new_list'] = createList;\n\n    $.post('/update_list_checkbox.json', payload)\n    .done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            callback(false, null);\n        } else {\n            callback(true, resp.lists);\n        }\n    })\n    .error(err => { \n        console.warn(err); \n        alertify.alert(\"Please try again later.\");\n        callback(false, []);\n    })\n}\n","import React from 'react';\nimport { Display } from \"fancymixin\";\nimport classnames from 'classnames';\nimport { xmlUtil } from \"fancyutils\";\n\nexport default class AdminPopup extends React.Component {\n    static popupName = 'thing-admin';\n    state = {\n        show_on_homepage: null,\n        date_published: null, \n        exclude_from_popular: false,\n        show_in_search: true,\n        optionSaving: false,\n        ownerSaving: false,\n        mergeSaving: false,\n    };\n    \n    \n    componentDidMount() {\n        const that = this;\n        $.dialog(AdminPopup.popupName).$obj.on('open', () => {\n            const { thing: { show_on_homepage, date_published, exclude_from_popular, show_in_search }  } = that.props;\n            that.setState( { show_on_homepage, date_published, exclude_from_popular, show_in_search } );\n        });\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AdminPopup.popupName).center();\n    }\n    \n    handleSaveOptions = () => {\n        const { thing } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving } = this.state;\n        if (optionSaving) return false;\n        const payload = { thing_id: thing.id, show_on_homepage, exclude_from_popular, show_in_search }\n        if (show_on_homepage) {\n            let inputDate = new Date(date_published);\n            if (isNaN(inputDate)) {\n                alert(\"invalid date - must be in format of 2020-01-01 10:10:10\");\n                return false;\n            }            \n            payload['date_published'] = inputDate.toISOString().replace(/T/, \" \").split(\".\")[0];\n        }\n        this.setState({optionSaving:true});\n        $.post('/manage-newthing.json', payload).then((json) => {\n            if (json.status_code == 1) {\n                Object.assign(thing, payload);\n                alert(\"Updated!\");\n            } else {\n                alert(json.message || \"Failed to save the changes\");\n            }\n            this.setState({optionSaving:false})\n        }).fail(() => {\n            alert(\"Something went wrong!\");\n            this.setState({optionSaving:false})\n        });\n    }\n\n    handleChangeOwner = () => {\n        const { thing } = this.props;\n        if (this.state.ownerSaving) return false;\n        if (this.changeOwnerEl == null) return false;\n        const new_owner = this.changeOwnerEl.value.trim();\n        if (new_owner.length == 0) {\n            alert(\"Please enter a username.\");\n            return false;\n        }\n        if (new_owner.toLowerCase() == thing.thing_owner.username.toLowerCase()) {\n            alert(\"The thing is already owned by the user.\");\n            return false;\n        }\n\n        if (window.confirm(`Do you want to change the current thing's owner to ${new_owner}?`)) {\n            this.setState({ownerSaving: true})\n            $.ajax({\n                type: \"post\",\n                url: \"/change_new_thing_owner.xml\",\n                data: { new_owner_name: new_owner, thing_id: thing.id, new_thing_id: thing.ntid, old_user_id: thing.thing_owner.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    if (xmlUtil.isSuccess(xml)) {\n                        alert(\"Done!\");\n                        location.reload();                        \n                    } else if (xmlUtil.isFail(xml)) {\n                        alert(\n                            $(xml)\n                                .find(\"message\")\n                                .text()\n                        );\n                    }\n                })\n                .fail(() => {\n                    alert(\"There was an error.\");\n                })\n                .always(() => {\n                    this.setState({ownerSaving: false})\n                });\n        }\n        return false;\n    }\n\n    handleMergeThings = () => {\n\n    }\n\n    render() {\n        const { \n            thing, \n            thing: { sales },\n        } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving, ownerSaving, mergeSaving } = this.state;\n        return (\n          <>\n          \t<p className=\"ltit\">{thing.name}</p>\n            <div className=\"thing-admin-body\">\n                <ul className=\"thing-info\">\n                <li><em>Sale ID</em> {sales.id}</li>\n                    <li><em>Thing ID</em> {thing.id}</li>\n                    <li><em>Thing Owner</em> {thing.thing_owner.username}</li>\n                    <li className=\"buttons\">\n                        <a className=\"btns-blue-embo\" href={`/merchant/products/${sales.id}`} target=\"_blank\">Edit Sale</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-sale-orders-by-thing-id?thing_id=${thing.id}`} target=\"_blank\">View Orders</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-users-by-cart-item?sale_id=${sales.id}`} target=\"_blank\">View Carts</a>\n                    </li>\n                </ul>\n                <div className=\"thing-options\">\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-on-homepage\" checked={!!show_on_homepage}\n                        onChange={(event) => this.setState({ show_on_homepage: event.target.checked })}\n                        /> Show on Homepage</label>\n                        <input className=\"text\" type=\"text\" name=\"date-published\" placeholder=\"2020-01-02 10:20:30\"\n                            style={Display.NoneIf(!show_on_homepage)} value={date_published || ''}\n                            onChange={(event) => {this.setState({ date_published: event.target.value })}}\n                            />\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"exclude-from-popular\" checked={!!exclude_from_popular}\n                            onChange={(event) => this.setState({ exclude_from_popular: event.target.checked })}\n                        /> Exclude from Popular</label>\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-in-search\" checked={!!show_in_search}\n                            onChange={(event) => this.setState({ show_in_search: event.target.checked })}\n                        /> Show in Search</label>\n                    </p>\n                    <p>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": optionSaving })} onClick={this.handleSaveOptions}>Save Changes</button>\n                    </p>                    \n                </div>\n                <div className=\"thing-actions\">\n                    <p>\n                        <label>Change Owner</label>\n                        <input type=\"text\" name=\"change_owner\" placeholder=\"Enter new username\" ref={(el) => {this.changeOwnerEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": ownerSaving })} onClick={this.handleChangeOwner}>Change</button>\n                    </p>\n                    {/*\n                    <p>\n                        <label>Merge Things</label>\n                        <input type=\"text\" name=\"merge_thing_id\" placeholder=\"Enter Thing ID\" ref={(el) => {this.mergeThingEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": mergeSaving })} onClick={this.handleMergeThings}>Merge</button>\n                    </p>*/}\n                </div>\n\n            </div>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React from 'react';\nimport classnames from 'classnames';\nimport { closePopup, copyToClipboard } from 'fancyutils';\n\nexport default class SimpleSharePopup extends React.Component {\n    static popupName = 'minimum-share';\n\n    constructor(props) {\n        super(props);\n        const { thing, viewer } = props;\n        let url = `https://fancy.com${thing.url}`;\n        if (viewer && viewer.username) {\n            let connector = ~url.indexOf('?') ? '&' : '?';\n            url = `${url}${connector}ref=${viewer.username}`\n        }\n        console.log(url)\n        this.state = {\n            shareUrl: url,\n            urlCopied: false,\n        }\n    }\n\n    handleCancelClick = (event) => {\n        event.preventDefault();\n        closePopup(SimpleSharePopup.popupName);\n    }\n\n    componentDidUpdate(){\n        $.dialog(SimpleSharePopup.popupName).center();\n    }\n\n    handleCopyLink = (event) => {\n        console.log('handleCopyLink');\n        const { shareUrl } = this.state;\n        console.log('handleCopyLink ' + shareUrl );\n        copyToClipboard(shareUrl);\n        this.setState({ urlCopied: true });\n        setTimeout(() => {\n            this.setState({ urlCopied: false });\n        }, 2000);\n    }\n\n\n    render() {\n        const { thing, viewer } = this.props;\n        const { shareUrl, urlCopied } = this.state;\n\n        return (\n          <>\n          \t<p className=\"ltit\">Share</p>\n            <ul>\n                <li><a href=\"#\" className=\"btn-copy-link link\" onClick={this.handleCopyLink}>{urlCopied ? \"Copied to clipboard\" : \"Copy link\"}</a></li>\n                <li><a \n                    href={`http://pinterest.com/pin/create/link/?url=${encodeURIComponent(shareUrl)}&media=${thing.images ? encodeURIComponent(thing.images[0].image_url) : \"\"}&description=${encodeURIComponent(thing.name)}`}\n                    target=\"_blank\" className=\"pin\">Share to Pinterest</a></li>\n                <li><a \n                    href={`mailto:?body=Check%20out%20${encodeURIComponent(thing.name)}%20on%20Fancy!%0A%0A${encodeURIComponent(shareUrl)}&subject=${encodeURIComponent(thing.name)}%20on%20Fancy`}\n                    target=\"_blank\" className=\"email\">Share via email</a></li>\n            </ul>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import { OverlayProps, ReduxProps } from 'ftypes';\nimport React from 'react';\n\nexport function getFancyContextDefaultValue() {\n  return {\n      appContext: {},\n      thing: {},\n      followContext: {},\n      fancyContext: {},\n      slideContext: {},\n      saleContext: {},\n      dispatch: () => {},\n  }\n}\n\n// @ts-ignore\nconst FancyContext = React.createContext<OverlayProps & ReduxProps>(getFancyContextDefaultValue());\n\nexport const useFancy = () : OverlayProps & ReduxProps => {\n  return React.useContext(FancyContext);\n}\n\nexport default FancyContext;\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { FancyUser, MP, renderPopup } from \"fancyutils\";\nimport { useDispatch } from 'react-redux'\nimport { FancydByPopupV4 } from 'common-components';\n\nimport { useFancy } from \"../FancyContext\";\nimport AdminPopup from \"../../popup/AdminPopup\"\nimport SimpleSharePopup from \"../../popup/SimpleSharePopup\"\nimport AddlistPopup from \"../../popup/AddlistPopup\"\nimport { toggleFancy, getCordialProperties } from \"../../../action/action-helpers\";\n\nfunction Favorite() {\n    const { appContext, thing, fancyContext } = useFancy();\n    const dispatch = useDispatch();\n\n    const handleClick = (event: React.MouseEvent) => {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log('favortie');\n        if (!appContext.loggedIn) {\n            window.require_login(null, \"fancy_thing\", thing.id);\n            return;\n        }\n\n        if (fancyContext.loading) {\n            return;\n        }\n\n        dispatch(toggleFancy(thing.id));\n\n        if (!fancyContext.fancyd) {\n            MP(\"Fancy\", { thing_id: thing.id });\n            try {\n                window.crdl('event', 'favorite_item', getCordialProperties(thing));\n            } catch (e) {\n            }\n        } else {\n            MP(\"Unfancy\", { thing_id: thing.id });\n        }\n    };\n\n    return (\n        <a className={classnames(\"button button-static fancy _count\", { fancyd: fancyContext.fancyd })} onClick={handleClick}>\n            Favorite\n        </a>\n    );\n}\n\nexport default function ActionButtons() {\n    const {\n        appContext: { viewer, loggedIn },\n        thing,\n        thing: { id: objectId },\n        fancyContext,\n    } = useFancy();\n\n    let msg;\n    if (thing.fancyd_friends) {\n        const cnt = fancyContext.fancyd_count - 1;\n        if (cnt > 0) {\n            msg = <>\n                Favorited by <a href={thing.fancyd_friends[0].url}>{thing.fancyd_friends[0].full_name}</a> and <b>{cnt} other{(cnt > 1) ? `s` : ``}</b>\n            </>\n        } else {\n            msg = <>Favorited by <a href={thing.fancyd_friends[0].url}>{thing.fancyd_friends[0].full_name}</a></>\n        }\n    } else {\n        msg = <>{fancyContext.fancyd_count} people favorited</>\n    }\n\n    return (\n        <>\n            <span className=\"_fancyd fancyd_user\" onClick={(e : React.MouseEvent<HTMLSpanElement>) => {\n                if (e.target.tagName === 'A') {\n                    return;\n                }\n                renderPopup(FancydByPopupV4, { objectId, objectType: 'thing', loggedIn: FancyUser.loggedIn, viewerId: FancyUser.id });\n            }}>{msg}</span>\n            <a onClick={(event) => {\n                event.preventDefault();\n                if (!loggedIn) {\n                    window.require_login();\n                    return;\n                }\n                renderPopup(AddlistPopup, { objectId });\n            }} className=\"add-list\">Add to List</a>\n            <div className=\"figure-button action-button-v2\">\n                {viewer.is_admin_any && (\n                    <a className=\"edit\"\n                        onClick={(event) => {\n                            event.preventDefault();\n                            renderPopup(AdminPopup, { viewer, thing });\n                        }}>Edit</a>\n                )}\n                <Favorite />\n                <a\n                    className=\"btn-share\"\n                    onClick={(event) => {\n                        event.preventDefault();\n                        renderPopup(SimpleSharePopup, { viewer, thing });\n                    }}>\n                    Share\n                </a>\n            </div>\n        </>\n    );\n}\n","import React, { memo, useEffect, useState, useRef } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\nimport SwiperCore, { Thumbs, Zoom } from \"swiper\";\nimport { Video } from \"common-components\";\nimport { Display } from \"fancymixin\";\n\nimport { useFancy } from \"../../FancyContext\";\nimport ActionButtons from \"../ActionButtons\";\nimport { getCurrentSaleOption, getSaleImages } from \"../../../map\";\nimport { setThumbnailIndex } from \"../../../../action/actions\";\nimport { getZoomImageStyle, getNextZoomImageStyle } from \"./zoom\";\n\nimport type { ThingImageOrVideo } from \"ftypes\";\nimport type { Swiper as SwiperClass } from \"swiper\";\n\nconst isTouchDevice = \"ontouchstart\" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;\nconst SwiperAddons = [Thumbs];\nif (isTouchDevice) {\n    SwiperAddons.push(Zoom);\n}\nSwiperCore.use(SwiperAddons);\n\nconst placeholderImage = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\nconst PER_PAGE = 5;\n\nconst preloadImage = (src: string) =>\n    new Promise((r) => {\n        const image = new window.Image();\n        image.onload = r;\n        image.onerror = r;\n        image.src = src;\n    });\n\ninterface ImageSlideProps {\n    image: ThingImageOrVideo;\n    i: number;\n    isActive: boolean;\n    setSlideLocked: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nconst ImageSlide = memo<ImageSlideProps>(\n    ({ image, i, setSlideLocked, isActive }) => {\n        const {\n            thing,\n            slideContext: { thumbnailIndex },\n        } = useFancy();\n        const [isZoomActive, setZoomActive] = useState(false);\n        const [zoomImageStyle, setZoomImageStyle] = useState(Display.None);\n        const [zoomImageCacheKey, setZoomImageCacheKey] = useState(\"\");\n        const [zoomImageLoaded, setZoomImageLoaded] = useState(false);\n\n        const isVideo = !!image.h264_1000k_url;\n        const isMagnifyingGlassZoomable = !isVideo && !isTouchDevice;\n\n        useEffect(() => {\n            if (!zoomImageCacheKey && isZoomActive) {\n                preloadImage(image.large_image_url).then(() => {\n                    setZoomImageCacheKey(image.large_image_url);\n                    setZoomImageLoaded(true);\n                });\n            }\n            if (zoomImageCacheKey !== \"\" && image.large_image_url !== zoomImageCacheKey) {\n                setZoomImageCacheKey(\"\");\n                setZoomImageLoaded(false);\n            }\n        }, [image.large_image_url, isZoomActive, zoomImageCacheKey]);\n\n        const handleMouseEvent = ({ pageX, pageY }) => {\n            if (!isMagnifyingGlassZoomable) {\n                return;\n            }\n            if (isZoomActive) {\n                const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                setZoomImageStyle(nextZoomImageStyle);\n            }\n        };\n\n        return (\n            <SwiperSlide\n                zoom={isMagnifyingGlassZoomable}\n                key={i}\n                className={classnames({\n                    \"video-slide\": isVideo,\n                    startZoom: isZoomActive,\n                    zoomShow: true,\n                    \"active-slide\": isActive,\n                    loading: thing.loading,\n                })}\n                onClick={({ pageX, pageY }) => {\n                    if (!isMagnifyingGlassZoomable) {\n                        return;\n                    }\n                    const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                    setZoomImageStyle(nextZoomImageStyle);\n\n                    setZoomActive(!isZoomActive);\n                    setSlideLocked(!isZoomActive);\n                }}\n                onMouseMove={handleMouseEvent}>\n                {isVideo ? (\n                    <Video\n                        object={image}\n                        display={true}\n                        playing={thumbnailIndex == i}\n                        lastFullyRenderedObjectID={thing.id}\n                        allow={{ fullScreen: true }}\n                    />\n                ) : (\n                    <>\n                        <img\n                            className=\"swiper-lazy\"\n                            src={image.image_url}\n                            data-src={image.image_url}\n                            title={!isTouchDevice ? \"Double click to zoom-in\" : undefined}\n                            alt={thing.name}\n                            style={{ cursor: \"zoom-in\" }}\n                        />\n                        <em\n                            className=\"zoomImage\"\n                            onClick={() => {\n                                setZoomActive(false);\n                                setSlideLocked(false);\n                            }}\n                            style={{\n                                ...getZoomImageStyle(image, isZoomActive, zoomImageStyle),\n                                backgroundColor: \"white\",\n                                backgroundImage: `url(${zoomImageLoaded ? image.large_image_url : image.image_url})`,\n                            }}\n                        />\n                        {isTouchDevice && <div className=\"swiper-lazy-preloader\" />}\n                    </>\n                )}\n            </SwiperSlide>\n        );\n    },\n    (prevProps: ImageSlideProps, nextProps: ImageSlideProps) => {\n        return prevProps.image.image_url === nextProps.image.image_url && prevProps.isActive === nextProps.isActive;\n    }\n);\nImageSlide.displayName = \"SwiperSlide\"; // This is important to make swiper to acknowledge it's actually slide, not some random components\n\nconst Image = ({ imageOnly = false, galleryThumbsDirection = \"vertical\", thumbsPerView = PER_PAGE }) => {\n    const fancyProps = useFancy();\n    const {\n        thing,\n        saleContext,\n        slideContext: { thumbnailIndex },\n    } = fancyProps;\n    const swiperRef = useRef(null);\n    const swipeThumbsRef = useRef(null);\n    const [thumbIndex, setThumbIndex] = useState(0);\n    const [slideLocked, setSlideLocked] = useState(false);\n    const [swiper, setSwiper] = useState<null | SwiperClass>(null);\n    const option = getCurrentSaleOption(thing.sales, saleContext, true);\n    const images = getSaleImages(thing, option) as ThingImageOrVideo[];\n    const lastThumbIndex = images.length - thumbsPerView;\n\n    useEffect(() => {\n        if (!swiper) {\n            return;\n        }\n        if (thumbnailIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbnailIndex);\n        }\n        if (!imageOnly && swipeThumbsRef.current) {\n            const thumbSwiper = swipeThumbsRef.current.swiper;\n            if (!thumbSwiper.slides[thumbnailIndex].classList.contains(\"swiper-slide-visible\"))\n                thumbSwiper.slideTo(Math.min(thumbnailIndex, lastThumbIndex));\n        }\n    }, [thumbnailIndex, swiper, imageOnly]);\n\n    useEffect(() => {\n        if (!swipeThumbsRef.current) {\n            return;\n        }\n        const swiper = swipeThumbsRef.current.swiper;\n        if (thumbIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbIndex);\n        }\n    }, [thumbIndex, imageOnly]);\n\n    const prevEl = (\n        <div\n            className={`prev ${thumbIndex > 0 ? \"disabled\" : \"\"}`}\n            style={{ opacity: thumbIndex > 0 ? undefined : 0.3 }}\n            onClick={() => setThumbIndex(Math.max(0, thumbIndex - thumbsPerView))}\n        />\n    );\n\n    const nextEl = (\n        <div\n            className={`next ${thumbIndex < lastThumbIndex ? \"disabled\" : \"\"}`}\n            style={{\n                opacity: thumbIndex < lastThumbIndex ? undefined : 0.3,\n            }}\n            onClick={() => {\n                setThumbIndex(Math.min(thumbIndex + thumbsPerView, lastThumbIndex));\n            }}\n        />\n    );\n\n    return (\n        <div className=\"figure-section\">\n            <Swiper\n                ref={swiperRef}\n                onSlideChange={() => {\n                    const swiper = swiperRef.current?.swiper;\n                    if (swiper) {\n                        fancyProps.dispatch(setThumbnailIndex(swiper.activeIndex));\n                        setThumbIndex(swiper.activeIndex);\n                    }\n                }}\n                preloadImages={false}\n                lazy={{\n                    loadPrevNext: true,\n                    loadPrevNextAmount: 0,\n                }}\n                zoom={\n                    isTouchDevice\n                        ? {\n                              maxRatio: 2,\n                          }\n                        : undefined\n                }\n                allowSlidePrev={!slideLocked}\n                allowSlideNext={!slideLocked}\n                onZoomChange={(_, scale) => {\n                    if (scale > 1) {\n                        setSlideLocked(true);\n                    } else {\n                        setSlideLocked(false);\n                    }\n                }}\n                onSwiper={(swiper) => {\n                    setSwiper(swiper);\n                }}\n                className=\"gallery-top\">\n                {images.map((image, i) => {\n                    return (\n                        <ImageSlide\n                            key={i}\n                            image={image}\n                            i={i}\n                            setSlideLocked={setSlideLocked}\n                            isActive={swiper?.activeIndex === i}\n                        />\n                    );\n                })}\n                {!imageOnly && <ActionButtons />}\n            </Swiper>\n            {!imageOnly && prevEl}\n            <Swiper\n                className=\"gallery-thumbs\"\n                ref={swipeThumbsRef}\n                onClick={() => {\n                    if (!swipeThumbsRef.current) {\n                        return;\n                    }\n                    fancyProps.dispatch(setThumbnailIndex(swipeThumbsRef.current.swiper.clickedIndex));\n                }}\n                direction={galleryThumbsDirection}\n                spaceBetween={16}\n                slidesPerView={thumbsPerView}\n                watchSlidesVisibility={true}\n                height={80}>\n                {images.map((image, i) => {\n                    return (\n                        <SwiperSlide\n                            key={i}\n                            className={classnames({\n                                \"video-thumbnail\": image.h264_1000k_url,\n                                selected: i == thumbnailIndex,\n                            })}>\n                            <img\n                                height=\"80\"\n                                src={placeholderImage}\n                                style={{ backgroundImage: `url(${image.thumbnail_url})` }}\n                            />\n                        </SwiperSlide>\n                    );\n                })}\n                {imageOnly && (\n                    <>\n                        {prevEl}\n                        {nextEl}\n                    </>\n                )}\n            </Swiper>\n            {!imageOnly && nextEl}\n        </div>\n    );\n};\n\nexport default Image;\n","import { minmax } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\nimport { ThingImageOrVideo } from \"ftypes\";\n\n// TODO: cache per (thing id + image index)\nconst zoomBoxMaximumSize = 240;\nconst zoomScale = 1.5;\n\nconst getBoundarySize = () => {\n    const $el = $(\n        \".thing-detail-container .figure-section .swiper-container.gallery-top .active-slide\"\n    ).eq(0);\n\n    if ($el.length !== 1) {\n        window.DEBUG && console.warn('getBoundarySize(): warning: $el.length is ', $el.length);\n    }\n\n    return {\n        $el,\n        width: $el.width()!,\n        height: $el.height()!,\n    };\n};\ntype BS = ReturnType<typeof getBoundarySize>;\n\nconst getZoomBoxSize = (bs: BS) => Math.min(bs.width / 3, zoomBoxMaximumSize);\nconst getZoomMargin = (bs: BS) => (getZoomBoxSize(bs) - 4) / 2;\n\nconst zidCac: { [o: string]: any } = {};\nconst getZoomImageDimension = (img: ThingImageOrVideo, bs = getBoundarySize()) => {\n    if (zidCac[img.image_url]) {\n        return zidCac[img.image_url];\n    }\n    const zoomMargin = getZoomMargin(bs);\n    // const imageSize = calculateImageSize(img);\n\n    const ret = {\n        width: bs.width * zoomScale /* * (imageSize.larger === \"height\" ? imageSize.proportion : 1) */ + zoomMargin,\n        height: bs.height * zoomScale + zoomMargin,\n        /* ((b.height * imageSize.height) / imageSize.width) *\n                (imageSize.larger === \"width\" ? imageSize.proportion : 1) *\n                zoomScale +\n            zoomMargin ,*/\n    };\n    zidCac[img.image_url] = ret;\n    return ret;\n};\n\nconst getImageMeta = (bs: BS) => {\n    let width, height, marginHoriz, marginVert;\n\n    const $fig = $(\".thing-detail-container .figure-section .swiper-container.gallery-top img:eq(0)\");\n    width = $fig.width()!;\n    height = $fig.height()!;\n    marginHoriz = 0;\n    if (width > height) {\n        marginHoriz = 0;\n        marginVert = (bs.height - height) / 2;\n    } else {\n        marginHoriz = (bs.width - width) / 2;\n        marginVert = 0;\n    }\n    return { width, height, marginHoriz, marginVert };\n};\n\nexport const getNextZoomImageStyle = (img: ThingImageOrVideo, pageX: number, pageY: number) => {\n    const bs = getBoundarySize();\n    const $wrapper = bs.$el;\n\n    if (!$wrapper.length) {\n        return Display.None;\n    }\n\n    const boundaryWidth = bs.width;\n    const boundaryHeight = bs.height;\n    const meta = getImageMeta(bs);\n\n    const offset = $wrapper.offset()!;\n    const left = pageX - offset.left;\n    const top = pageY - offset.top;\n\n    const topPosition = top - (boundaryHeight - meta.height) / 2;\n\n    const showZoomImage = left > 0 && topPosition > 0 && topPosition < meta.height;\n\n    const zoomBoxSize = getZoomBoxSize(bs);\n    const zoomMargin = getZoomMargin(bs);\n\n    if (showZoomImage) {\n        const zd = getZoomImageDimension(img, bs);\n        const zoomImageContainerX = minmax(\n            left - zoomMargin,\n            meta.marginHoriz,\n            meta.marginHoriz + meta.width - zoomBoxSize\n        );\n        const zoomImageContainerY = minmax(\n            top - zoomMargin,\n            meta.marginVert,\n            meta.marginVert + meta.height - zoomBoxSize\n        );\n\n        const backgroundLeft = (zd.width * left) / boundaryWidth - zoomMargin;\n        const backgroundTop = (zd.height * top) / boundaryHeight - zoomMargin;\n\n        const bgPosX = -minmax(backgroundLeft, 0, zd.width - zoomBoxSize);\n        const bgPosY = -minmax(backgroundTop, 0, zd.height - zoomBoxSize);\n\n        return {\n            left: 0,\n            top: 0,\n            width: `${zoomBoxSize}px`,\n            height: `${zoomBoxSize}px`,\n            transform: `translate(${zoomImageContainerX}px, ${zoomImageContainerY}px)`,\n            backgroundPosition: `${bgPosX}px ${bgPosY}px`,\n            display: \"inline\",\n        };\n    } else {\n        return Display.None;\n    }\n};\n\nconst RESIZED_SIZE = 1280;\nconst calculateImageSize = (img: ThingImageOrVideo) => {\n    const size = Math.max(img.width, img.height);\n    if (size < RESIZED_SIZE) {\n        const smallerSize = Math.min(img.width, img.height);\n        return {\n            width: img.width,\n            height: img.height,\n            proportion: size / smallerSize,\n            larger: img.width > img.height ? \"width\" : \"height\",\n        };\n    } else {\n        if (img.width > img.height) {\n            const proportion = RESIZED_SIZE / img.width;\n            return {\n                width: RESIZED_SIZE,\n                height: img.height / proportion,\n                proportion,\n                larger: \"width\",\n            };\n        } else {\n            const proportion = RESIZED_SIZE / img.height;\n            return {\n                width: img.width / proportion,\n                height: RESIZED_SIZE,\n                proportion,\n                larger: \"height\",\n            };\n        }\n    }\n};\n\nexport const isZoomable = (img: ThingImageOrVideo) => {\n    const imageSize = calculateImageSize(img);\n    const boundarySize = getBoundarySize();\n\n    return imageSize.width > boundarySize.width * zoomScale || imageSize.height > boundarySize.height * zoomScale;\n};\n\nexport const getZoomImageStyle = (img: ThingImageOrVideo, isZoomActive: boolean, currentZoomImageStyle: any) => {\n    if (isZoomActive) {\n        const zd = getZoomImageDimension(img);\n        const ret = {\n            ...currentZoomImageStyle,\n            backgroundSize: `${zd.width}px ${zd.height}px`,\n        };\n        return ret;\n    } else {\n        return Display.None;\n    }\n};\n","import React from \"react\";\nimport type { OverlayProps } from \"ftypes\";\nimport { isSalesOptionsAvailable } from \"../../../map\";\nimport { useFancy } from \"../../FancyContext\";\n\nconst ApplePayButton: React.FC<OverlayProps> = () => {\n    const {\n        appContext: { /*applePayDisplay, */ applePayTest },\n        thing,\n        thing: { sales },\n        saleContext: { saleOptionID, selectedQuantity, price },\n    } = useFancy();\n\n    const handleApplePayCheckout : React.MouseEventHandler = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!saleOptionID || window.FancyApplePay.clicked) {\n            return;\n        }\n        window.FancyApplePay.clicked = true;\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n\n        var title = thing.name;\n        var country = sales.seller.country;\n        var sale_item_id = sales.id;\n        var seller_id = sales.seller.id;\n        var quantity = selectedQuantity;\n\n        var option_id = null;\n        var option = null;\n        if (salesOptionsAvailable) {\n            option_id = parseInt(saleOptionID, 10) || null; // ? should be same value with option except get casted\n            option = saleOptionID;\n        }\n\n        try {\n            window.FancyApplePay.requestPurchase(\"Dynamic\", {\n                sale_item_id,\n                seller_id,\n                option_id,\n                quantity,\n                price,\n                title,\n                option,\n                country,\n                testmode: applePayTest,\n            });\n        } catch (err) {\n            window.DEBUG && console.trace(err);\n            alert(err);\n            window.FancyApplePay.clicked = false;\n        }\n    };\n    return (\n        <div\n            className=\"applePayButton\"\n            style={{\n                WebkitAppearance: \"-apple-pay-button\",\n                ApplePayButtonType: \"plain\",\n                ApplePayButtonStyle: \"black\",\n            }}\n            onClick={handleApplePayCheckout}></div>\n    );\n}\n\nexport default ApplePayButton;","import React, { useCallback } from \"react\";\nimport classnames from \"classnames\";\nimport { useDispatch } from \"react-redux\";\nimport { updateSaleContext } from \"../../../../action/action-helpers\";\nimport { getCurrentSaleOption, getWaiting } from \"../../../map\";\nimport { useFancy } from \"../../FancyContext\";\nimport appState from \"../../../../appstate\";\nimport type { SaleOption } from \"ftypes\";\n\ninterface ICartButtonProps {\n  available: boolean;\n  waiting: boolean;\n  soldout: boolean;\n  loading: boolean;\n  onPurchase(): React.MouseEventHandler;\n}\n\nconst CartButton: React.FC<ICartButtonProps> = ({ onPurchase, loading }) => {\n  const dispatch = useDispatch();\n  const { thing: { sales }, saleContext } = useFancy();\n\n  const waiting = getWaiting(sales, saleContext);\n  const available = sales.available;\n  const { soldout } = getCurrentSaleOption(sales, saleContext) as SaleOption;\n\n  if (!available) {\n    return <Button\n      className=\"btn-create not-available\"\n      label={gettext(\"Not Available\")}\n      disabled={true}\n    />\n  }\n\n  const onNotifyLater = useCallback(\n    (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n      if (!appState.loggedIn) {\n        return window.require_login();\n      }\n      const opt = getCurrentSaleOption(sales, saleContext, true);\n      const params: any = { sale_item_id: sales.id };\n\n      if (opt != null) {\n        params.option_id = opt.id;\n      }\n\n      const waiting = getWaiting(sales, saleContext);\n      if (waiting) {\n        params.remove = 1;\n      }\n\n      $.ajax({\n        type: \"post\",\n        url: \"/wait_for_product.json\",\n        data: params,\n        dataType: \"json\",\n      }).done((json) => {\n        if (!json || json.status_code == null) {\n          return;\n        }\n        if (json.status_code == 0 && json.message) {\n          window.alertify.alert(json.message);\n          return;\n        }\n        const waiting = params.remove ? false : true;\n        dispatch(updateSaleContext({ waiting }));\n      });\n    }\n    , [dispatch, sales, saleContext])\n\n  return <>\n    <Button\n      onClick={onPurchase}\n      className={classnames(\"add_to_cart btn-cart\", {\n        \"btn-create\": soldout,\n        \"btns-blue-embo\": !soldout,\n        loading\n      })}\n      disabled={!!soldout}\n      label={soldout ? gettext(\"Sold out\") : gettext(\"Add to cart\")}\n    />\n    <Button\n      className={classnames(\"btn-create notify-available\", { subscribed: waiting })}\n      label={waiting ? gettext(\"Subscribed\") : gettext(\"Notify me when available\")}\n      style={!soldout ? { display: \"none\" } : undefined}\n      onClick={onNotifyLater}\n    />\n  </>\n}\n\nconst Button: React.FC<React.ButtonHTMLAttributes<null> & { label: string; }> = ({ ...props }: any) => (\n  <button {...props} label={null}>\n    {props.label}\n  </button>\n);\n\nexport default CartButton;\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { floatFormatMinusTwo, numberFormat, renderPopup, escapeSelector, getLocationArgPairs } from \"fancyutils\";\n\nimport { convertCurrency, updateSaleContext } from \"../../../../action/action-helpers\";\nimport { updateAppContext } from \"../../../../action/actions\";\nimport { currencyIsUSD, getCurrentSaleOption, getSafeNameProp, isSalesOptionsAvailable } from \"../../../map\";\nimport { Keys } from \"../../../Perf\";\nimport { SelectBox, MultiOption, MultiOptionState } from \"../SaleItemForm\";\nimport type { OverlayProps, ReduxProps, SaleOption, SelectedMetaOption, SaleOptionMeta } from \"ftypes\";\nimport type { ISaleItemSidebarHeadProps, ISaleItemSidebarHeadState } from './type';\nimport CartButton from './CartButton';\nimport { isOptionMulti } from './multiOption';\nimport ApplePayButton from './ApplePayButton';\n\nfunction optionValueFunction(opt) {\n    return opt?.id;\n}\nconst saleNamePrinter = (opt) => `${opt.name} - $${opt.price}`;\n\nconst { Fancy, alertify } = window;\n\nconst Price = ({ discounting, price, retailPrice, discountPercentage }) => {\n    return <div className=\"price\" key={Keys.Sidebar.Price}>\n        <big className={classnames({ sale: discounting })}>\n            ${floatFormatMinusTwo(price)}\n        </big>\n        {discounting && (\n            <span className=\"sales\">\n                <em>${floatFormatMinusTwo(retailPrice)}</em> (Save {numberFormat(discountPercentage, 0)}\n                            %)\n            </span>\n        )}\n    </div>\n}\n\nexport default class SaleItemSidebarHead extends Component<\n    ISaleItemSidebarHeadProps, ISaleItemSidebarHeadState\n> {\n    state = {\n        loading: false,\n        showSelectWarning: false,\n        selected: {},\n        disabled: [],\n        multiOptionState: null,\n    };\n\n    static defaultProps = {\n        showInfo: true,\n    };\n\n    constructor(props: OverlayProps & ReduxProps) {\n        super(props);\n        // for multi options\n        this.onClickThumbnail = this.onClickMultiOptionGen(\"thumbnail\");\n        this.onClickSwatch = this.onClickMultiOptionGen(\"swatch\");\n        this.onMultiSelectBoxChange = this.onClickMultiOptionGen(\"dropdown\");\n        this.onClickMutliButton = this.onClickMultiOptionGen(\"button\");\n    }\n\n    renderCurrencyPopup = () => {\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\").then(({ CurrencyPopup }) => {\n            renderPopup(CurrencyPopup, { currentCurrency: this.props.saleContext.currencyCode });\n        });\n    };\n\n    handleCurrencyPopup = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        this.renderCurrencyPopup();\n    };\n\n    handleCurrencyPopupUSD = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        if (!currencyIsUSD(this.props)) {\n            return false;\n        }\n        this.renderCurrencyPopup();\n    };\n\n    handlePurchase = (event) => {\n        event.preventDefault();\n        const {\n            thing: { sales },\n            saleContext,\n        } = this.props;\n        const saleOption = getCurrentSaleOption(sales, saleContext, true);\n        const soldout = saleOption == null ? sales.soldout : saleOption.soldout;\n        if (soldout || this.state.loading) {\n            return;\n        }\n        const optionIsMulti = isOptionMulti(sales);\n        const saleOptionID = saleOption != null ? saleOption.id : null;\n        if (!optionIsMulti && sales.options.length > 0 && saleContext.saleOptionID === null) {\n            this.setState({ showSelectWarning: true });\n            return;\n        }\n\n        this.setState({ showSelectWarning: false, loading: true }, () => {\n            const payload = {\n                sale_id: sales.id,\n                quantity: saleContext.selectedQuantity,\n                personalization: saleContext.personalization,\n            };\n            if (saleOptionID != null) {\n                payload.option_id = saleOptionID;\n            }\n            Fancy.CartAPI.addItem(payload, (success, json) => {\n                if (success) {\n                    $.dialog('thing-quickview').close();\n                    Fancy.Cart.openPopup();\n                } else {\n                    alertify.alert((json && json.error) || \"Failed to add the item to cart. Please contact us at cs@fancy.com if the problem persists.\");\n                }\n                this.setState({ loading: false });\n            })\n        });\n    }\n\n    handleOptionChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        if (!event.currentTarget.value) {\n            dispatch(updateSaleContext({ saleOptionID: null }));\n        } else {\n            const saleOptionID = parseInt(event.currentTarget.value, 10);\n            dispatch(updateSaleContext({ saleOptionID }));\n        }\n    };\n\n    handleQuantityChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const selectedQuantity = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ selectedQuantity }));\n    };\n\n    handlePersonalizationChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const personalization = event.currentTarget.value;\n        dispatch(updateSaleContext({ personalization }));\n    };\n\n    checkApplePay = () => {\n        if (window.FancyApplePay) {\n            const { dispatch, thing, thing: { sales } } = this.props;\n            const os = sales.options.filter((o) => !o.soldout);\n            const data = {\n                total: { label: thing.name, amount: (sales.price * 100) | 0 },\n            };\n\n            if (os.length > 0) {\n                data.displayItems = os.map((o) => ({\n                    label: o.name,\n                    amount: (Number(o.price) * 100) | 0,\n                }));\n            }\n\n            window.FancyApplePay.checkAvailability((available, testmode) => {\n                if (available) {\n                    dispatch(\n                        updateAppContext({\n                            applePayDisplay: true,\n                            applePayTest: testmode,\n                        })\n                    );\n                }\n            }, data);\n        }\n    };\n\n    componentDidMount() {\n        if (!currencyIsUSD(this.props)) {\n            const { saleContext } = this.props;\n            convertCurrency(saleContext.currencyCode, saleContext.price);\n        }\n        this.initializeMultiOption();\n        this.checkApplePay();\n    }\n\n    componentDidUpdate(prevProps: OverlayProps) {\n        if (prevProps.thing.id !== this.props.thing.id) {\n            this.initializeMultiOption();\n            this.checkApplePay();\n            if (this.state.showSelectWarning) {\n                this.setState({\n                    showSelectWarning: false,\n                });\n            }\n            return;\n        }\n\n        const {\n            saleContext,\n            thing: { sales },\n        } = prevProps;\n\n        const nsc = this.props.saleContext;\n        const nextSaleOptionID = nsc.saleOptionID;\n        if (saleContext.saleOptionID !== nextSaleOptionID) {\n            if (this.state.showSelectWarning) {\n                this.setState({ showSelectWarning: false });\n            }\n            const o = _.find(sales.options, (_o) => _o.id === nextSaleOptionID);\n            // option sync\n            if (o) {\n                const mos = $(\".sale-item-input .multi-option\");\n                o.values.forEach((v, i) => {\n                    const $so = mos\n                        .eq(i)\n                        .find(`[data-value=\"${escapeSelector(v)}\"]:not(.selected)`)\n                        .eq(0);\n                    if ($so.length) {\n                        if ($so.is(\"option\"))\n                            $so.prop(\"selected\", true);\n                        else\n                            $so.get(0).click();\n                    }\n                });\n                if (window.FancyApplePay && window.FancyApplePay.paymentRequest) {\n                    window.FancyApplePay.paymentRequest.update({\n                        total: {\n                            label: o.name,\n                            amount: (Number(o.price) * 100) | 0,\n                        },\n                    });\n                }\n            }\n        }\n    }\n\n    initializeMultiOption = () => {\n        const {\n            thing: {\n                sales: { options, option_meta },\n            },\n            saleContext,\n            dispatch,\n        } = this.props;\n\n        this.setState(this.getInitialMultiOptionState(options, option_meta), () => {\n            // don't block selecting cheapest item\n            if (!(options && options.length > 1)) {\n                this.updateSaleOptionIDFromMultiOptionState();\n            }\n            // ?option={number} support\n            const presetOptionId = getLocationArgPairs(\"option\");\n            if (presetOptionId && presetOptionId[1] && String(saleContext.saleOptionID) !== presetOptionId[1]) {\n                dispatch(updateSaleContext({ saleOptionID: parseInt(presetOptionId[1], 10) }));\n            }\n        });\n    };\n\n    getInitialMultiOptionState(options: SaleOption[], option_meta: SaleOptionMeta[]) {\n        const selected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        if (option_meta.length > 0) {\n            const nonSoldout = options.filter((o) => o.quantity !== 0);\n            if (nonSoldout.length !== 0) {\n                const selectedNonSoldoutOption = nonSoldout[0]; // temporary - FIXME\n                option_meta.forEach(function (opt, i) {\n                    const { type } = opt;\n                    const nextValue = selectedNonSoldoutOption.values[i];\n                    selected[type].push(nextValue);\n                });\n            } else {\n                // set first available multi option\n                option_meta.forEach(function (opt) {\n                    const { type } = opt;\n                    const nextValue = opt.values[0];\n                    selected[type].push(nextValue);\n                });\n            }\n        }\n        const multiOptionState = new MultiOptionState(options, option_meta);\n        return { selected, multiOptionState };\n    }\n\n    extractSaleOptionIDFromMultiOptionState = (selected?: SelectedMetaOption) => {\n        const {\n            thing: { sales },\n        } = this.props;\n        if (selected == null) {\n            selected = this.state.selected;\n        }\n        const { multiOptionState } = this.state;\n\n        const selectedOptionArray = multiOptionState.option_meta\n            .map((m) => {\n                const order = multiOptionState.orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            });\n        const selectedOption = _.find(sales.options, (opt) => selectedOptionArray.every((e, i) => e === opt.values[i]));\n        if (selectedOption) {\n            return selectedOption.id;\n        } else {\n            window.DEBUG &&\n                console.warn(\"no option found for \", selectedOptionArray, \"meta:\", sales.options, this.state.selected);\n        }\n    };\n\n    updateSaleOptionIDFromMultiOptionState = () => {\n        const { dispatch } = this.props;\n        let saleOptionID = this.extractSaleOptionIDFromMultiOptionState();\n        if (saleOptionID === undefined) {\n            const amendedID = this.amendSaleOptionFromMultiOptionState();\n            if (amendedID) {\n                saleOptionID = amendedID;\n            } else {\n                window.DEBUG && console.warn(\"Couldn't recover option\");\n            }\n        }\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    amendSaleOptionFromMultiOptionState = () => {\n        const { selected, multiOptionState } = this.state;\n        const nextSelected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        multiOptionState.option_meta.forEach(({ type, name }, index) => {\n            const order = multiOptionState.orderMap[type][name];\n            const selectedValue = selected[type][order];\n            if (index === 0) {\n                nextSelected[type][order] = selectedValue;\n                return;\n            }\n            const values = multiOptionState.getPossibleValuesForIndex(selected, index);\n            let value;\n            if (values.some((v) => v === selectedValue)) {\n                value = selectedValue;\n            } else {\n                value = values[0];\n            }\n            selected[type][order] = value; // even though it will be flushed out, it will affect next options so fix it as well\n            nextSelected[type][order] = value;\n        });\n        this.setState({ selected: nextSelected });\n        return this.extractSaleOptionIDFromMultiOptionState(nextSelected);\n    };\n\n    onClickMultiOptionGen = (type) => {\n        return (e) => {\n            const el = e.currentTarget;\n            let value;\n            let indexOfType;\n            if (el.tagName === \"SELECT\") {\n                value = el.value;\n                indexOfType = Number($(el).find(\":selected\").attr(\"data-index-typeof\"));\n            } else {\n                value = $(el).attr(\"data-value\");\n                indexOfType = Number($(el).attr(\"data-index-typeof\"));\n            }\n            if (e.currentTarget.className === \"disabled\") {\n                return;\n            }\n\n            this.state.selected[type][indexOfType] = value;\n            // forceful trigger even though no differences in value.\n            this.setState({ selected: _.extend({}, this.state.selected) }, this.updateSaleOptionIDFromMultiOptionState);\n        };\n    };\n\n    UNSAFE_componentWillReceiveProps(nextProps) {\n        const { saleContext } = this.props;\n        const nsc = nextProps.saleContext;\n        const priceChanges = saleContext.price !== nsc.price;\n        const currencyChanges = saleContext.currencyCode !== nsc.currencyCode;\n        if (priceChanges || currencyChanges) {\n            if (!currencyIsUSD(nextProps)) {\n                const { saleContext } = nextProps;\n                convertCurrency(saleContext.currencyCode, saleContext.price, true); // FIXME: unable to comparison since price update comes first (SaleItemSidebarHead.componentWillReceiveProps())\n            }\n        }\n    }\n\n    render() {\n        const {\n            thing,\n            thing: { sales },\n            appContext: { applePayDisplay },\n            saleContext,\n            saleContext: { selectedQuantity, price },\n            showInfo,\n        } = this.props;\n        const { showSelectWarning } = this.state;\n\n        const opt = getCurrentSaleOption(sales, saleContext) as SaleOption;\n        const discountPercentage = parseFloat(opt.discount_percentage); // TODO: use decimal?\n        const retailPrice = opt.retail_price;\n        const { soldout, quantity } = opt;\n        const { option_meta } = sales;\n        const optionIsMulti = isOptionMulti(sales);\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n        const discounting = discountPercentage > 0;\n        const quantitySelectRange = soldout\n            ? [\"1\"]\n            : _.range(1, Math.min(10, (quantity || 0) + 1));\n        const showSelectbox = sales.options.length !== 0;\n\n        var applePayButton;\n        if (applePayDisplay && !soldout) {\n            applePayButton = <ApplePayButton {...this.props} />;\n        }\n\n        return (\n            <>\n                {showInfo ? <>\n                    <h1 key={Keys.Sidebar.Title} className=\"title\" {...getSafeNameProp(thing)} />\n                    <Price {...{ discounting, price, retailPrice, discountPercentage }} />\n                </> : null}\n                <div className=\"frm\" key={Keys.Sidebar.Form}>\n                    <fieldset className=\"sale-item-input\">\n                        {showSelectbox && !optionIsMulti && (\n                            <SelectBox\n                                className=\"multi-option\"\n                                id=\"option\"\n                                label={gettext(\"Option\")}\n                                currentValue={(opt.soldout || saleContext.saleOptionID !== null) ? opt : \"\"}\n                                value={optionValueFunction}\n                                printer={saleNamePrinter}\n                                options={sales.options}\n                                unselectedLabel=\"Please select\"\n                                expander={SaleItemOptionsExpander}\n                                disabled={!salesOptionsAvailable}\n                                onChange={this.handleOptionChange}\n                                showSelectWarning={showSelectWarning}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                            />\n                        )}\n                        {optionIsMulti && (\n                            <MultiOption\n                                sid={sales.id}\n                                onClickThumbnail={this.onClickThumbnail}\n                                onClickSwatch={this.onClickSwatch}\n                                onMultiSelectBoxChange={this.onMultiSelectBoxChange}\n                                onClickMutliButton={this.onClickMutliButton}\n                                selected={this.state.selected}\n                                disabled={this.state.disabled}\n                                soldout={!!soldout}\n                                option_meta={option_meta}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                                multiOptionState={this.state.multiOptionState}\n                            />\n                        )}\n                        {sales.personalizable && (\n                            <div className=\"personalization\">\n                                <label>This item can be personalized:</label>\n                                <input\n                                    type=\"text\"\n                                    className=\"text\"\n                                    name=\"personalization\"\n                                    placeholder=\"Personalization details\"\n                                    onChange={this.handlePersonalizationChange}\n                                />\n                            </div>\n                        )}\n                        <SelectBox\n                            id=\"quantity\"\n                            className=\"multi-option\"\n                            label={gettext(\"Quantity\")}\n                            defaultValue=\"1\"\n                            currentValue={selectedQuantity}\n                            options={quantitySelectRange}\n                            disabled={!!soldout}\n                            onChange={this.handleQuantityChange}\n                        />\n                        {applePayButton}\n                        {showSelectWarning && <div className=\"error\">Please select from the available option</div>}\n                        <CartButton onPurchase={this.handlePurchase} loading={this.state.loading} />\n                    </fieldset>\n                </div>\n            </>\n        );\n    }\n}\n\n\nfunction SaleItemOptionsExpander(sio, idx) {\n    return (\n        <option value={sio.id} key={`sale_options-${idx}`}>\n            {sio.soldout === true || !(sio.quantity > 0) ? `${sio.name} - ${gettext(\"Sold out\")}` : sio.name}\n        </option>\n    );\n}\n","import type { SaleItem } from \"ftypes\";\n\nexport function isOptionMulti(sales: SaleItem): boolean {\n  if (sales.option_meta.length > 1) {\n      return true;\n  } else if (sales.option_meta.length === 1) {\n      return sales.option_meta[0].type !== \"dropdown\";\n  } else {\n      return false;\n  }\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\n\n// Generic purchase handler, needs to be bound to insatnce on initialization.\n/*\n    data-sii={sales.id}\n    data-sisi={sales.seller_id}\n    data-tid={thing.id}\n*/\nconst SaleOptions = ({\n    options = [\"1\"],\n    currentValue = \"1\",\n    id = \"\",\n    value = (v) => v,\n    expander,\n    defaultValue,\n    printer,\n    disabled,\n    onChange,\n    onClick,\n    onFocus,\n    unselectedLabel,\n}) => {\n    expander =\n        expander ||\n        ((option, idx) => (\n            <option key={`sale_options-${idx}`} value={value(option)}>\n                {printer(option)}\n            </option>\n        ));\n\n    return (\n        <select\n            id={id}\n            className={classnames(\"select-boxes2\", { \"one-option\": options.length <= 1 })}\n            value={value(currentValue) || defaultValue}\n            disabled={disabled}\n            onChange={onChange}\n            onClick={onClick}\n            onFocus={onFocus}>\n            {unselectedLabel && <option value=\"\">{unselectedLabel}</option>}\n            {options.map(expander)}\n        </select>\n    );\n};\n\nexport const SelectBox = (props) => {\n    let {\n        className,\n        disabled,\n        label,\n        currentValue,\n        defaultValue,\n        id,\n        printer,\n        tabIndex,\n        unselectedLabel,\n        options = [\"1\"],\n        SizeGuide,\n        showSelectWarning,\n    } = props;\n\n    printer = printer != null ? printer : (s) => s;\n    defaultValue = defaultValue != null ? defaultValue : \"1\";\n    className = className != null ? className : null;\n\n    var labelValue;\n    if (unselectedLabel != null && currentValue === \"\") {\n        labelValue = unselectedLabel;\n    } else {\n        labelValue = printer(currentValue != null ? currentValue : defaultValue);\n    }\n\n    return (\n        <div className={className}>\n            <label>{label}</label>\n            <span className={`trick-select ${id} ${showSelectWarning ? 'soldout' : ''}`}>\n                <a\n                    className={classnames(\"selectBox\", { disabled, \"one-option\": options.length <= 1 })}\n                    tabIndex={tabIndex || \"1\"}>\n                    <span className=\"selectBox-label\">{labelValue}</span>\n                    <span className=\"selectBox-arrow\" />\n                </a>\n                <SaleOptions {...props} printer={printer} defaultValue={defaultValue} />\n            </span>\n            {SizeGuide && <SizeGuide key=\"size-guide\" />}\n        </div>\n    );\n};\n\nexport class MultiOptionState {\n    constructor(options, option_meta) {\n        this.options = options;\n        this.option_meta = option_meta;\n        const orderMap = {};\n        option_meta.forEach((m) => {\n            if (orderMap[m.type] == null) {\n                orderMap[m.type] = { length: 1 };\n                orderMap[m.type][m.name] = 0;\n            } else {\n                orderMap[m.type][m.name] = orderMap[m.type].length;\n                orderMap[m.type].length += 1;\n            }\n        });\n        this.orderMap = orderMap;\n    }\n    // i.e.) getPossibleValues(['a', '1', '가'], 1) => ['1', '3', '6']\n    // output: get possible options for 2nd option dependent on ('a' / 1st option)\n    getPossibleValuesForIndex(selected, targetIndex) {\n        const { options, option_meta, orderMap } = this;\n        if (targetIndex === 0) {\n            return option_meta[0].values;\n        }\n        let filteredOptions = options;\n        option_meta\n            .map((m) => {\n                const order = orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            })\n            .forEach((sel, idx) => {\n                if (idx < targetIndex) {\n                    filteredOptions = filteredOptions.filter((option) => option.values[idx] === sel);\n                }\n            });\n        return _.uniq(filteredOptions.map((o) => o.values[targetIndex])); // FIXME\n    }\n\n    getMultiOptions(selected) {\n        return this.option_meta.map((meta, idx) => {\n            return [meta, this.getPossibleValuesForIndex(selected, idx)];\n        });\n        /*\n        returns [\n            [type, ['a', 'b', 'c']],\n            [type, ['1', '2']],\n            [tyep, ['red', 'white', 'black']]\n        ]\n        */\n    }\n}\n\nexport const MultiOption = (props) => {\n    const { selected, multiOptionState, sid, SizeGuide } = props;\n    if (multiOptionState == null) {\n        return null;\n    }\n    const multiOptions = multiOptionState.getMultiOptions(selected);\n    var sizeGuidePos = -1;\n    if (SizeGuide) {\n        multiOptions.map(([meta, values], idx) => {\n            if (meta.name && meta.name.trim().toLowerCase() === \"size\") sizeGuidePos = idx;\n        });\n        if (sizeGuidePos < 0) sizeGuidePos = multiOptions.length - 1;\n    }\n    return multiOptions.map(([meta, values], idx) => {\n        const { type, name } = meta;\n\n        const indexTypeOf = multiOptionState.orderMap[type] && multiOptionState.orderMap[type][name];\n        const additional = {\n            name,\n            values,\n            indexTypeOf,\n            selectedArray: selected && selected[type],\n            selectedValue: selected && selected[type] && selected[type][indexTypeOf],\n            key: `${sid}-${idx}`,\n            showSizeGuide: idx == sizeGuidePos,\n        };\n        if (type === \"dropdown\") {\n            return <MultiSelectBox {...props} {...additional} />;\n        } else if (type === \"swatch\") {\n            additional.swatch = meta.swatch;\n            return <MultiSwatch {...props} {...additional} />;\n        } else if (type === \"thumbnail\") {\n            additional.thumbnail = meta.thumbnail;\n            return <MultiThumbnail {...props} {...additional} />;\n        } else if (type === \"button\") {\n            return <MultiButton {...props} {...additional} />;\n        }\n    });\n};\n\nexport const MultiSelectBox = (props) => {\n    const { values, name, onMultiSelectBoxChange, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option\">\n            <label>{name}</label>\n            <select\n                onChange={onMultiSelectBoxChange}\n                value={selectedValue}\n                className={values.length <= 1 ? \"one-option\" : undefined}>\n                <MultiSelectBoxOption key={-1} value=\"Please select\" indexTypeOf={indexTypeOf} />\n                {values.map((value, i) => {\n                    return <MultiSelectBoxOption key={i} value={value} indexTypeOf={indexTypeOf} />;\n                })}\n            </select>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSelectBoxOption = (props) => {\n    const { value, indexTypeOf } = props;\n    return (\n        <option data-value={value} data-index-typeof={indexTypeOf} value={value}>\n            {value}\n        </option>\n    );\n};\n\nexport const MultiSwatch = (props) => {\n    const { name, values, swatch, indexTypeOf, selectedValue, onClickSwatch, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option swatch\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiSwatchOption\n                            key={i}\n                            value={value}\n                            swatch={swatch}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            onClick={onClickSwatch}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSwatchOption = (props) => {\n    const { value, swatch, indexTypeOf, selectedValue, onClick } = props;\n    return (\n        <a\n            href=\"#\"\n            style={{ backgroundColor: swatch[value] }}\n            onClick={onClick}\n            data-value={value}\n            data-label={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}\n        />\n    );\n};\n\nexport const MultiThumbnail = (props) => {\n    const { values, name, thumbnail, onClickThumbnail, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n\n    return (\n        <div className=\"multi-option thumbnail\">\n            <label>{name}</label>\n            <span className=\"value\">{selectedValue}</span>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiThumbnailOption\n                            key={i}\n                            onClick={onClickThumbnail}\n                            value={value}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            thumbnail={thumbnail}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiThumbnailOption = ({ onClick, value, indexTypeOf, selectedValue, thumbnail }) => {\n    return (\n        <a\n            href=\"#\"\n            onClick={onClick}\n            data-value={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}>\n            <img\n                src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage: `url(\"${thumbnail[value]}\")`, backgroundSize: \"cover\" }}\n                alt={value}\n            />\n        </a>\n    );\n};\n\nexport const MultiButton = (props) => {\n    const { values, name, onClickMutliButton, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option button\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiButtonOption key={i}\n                            onClick={onClickMutliButton}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            value={value}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiButtonOption = (props) => {\n    const { value, onClick, indexTypeOf, selectedValue } = props;\n    return (\n        <button\n            onClick={onClick}\n            className={selectedValue === value ? \"selected\" : \"\"}\n            data-value={value}\n            data-index-typeof={indexTypeOf}>\n            {value}\n        </button>\n    );\n};\n","// SaleItem#get_status\nexport const salesStatus = {\n    EXPIRED: 'Expired',\n    REMOVED: 'Deleted',\n    PENDING: 'Pending',\n    COMING_SOON: 'Coming soon',\n    ACTIVE: 'Active',\n    SOLD_OUT: 'Sold out'\n};\n\nexport const FancyStatus = {\n    Addition: 'Addition',\n    Removal: 'Removal',\n    AfterAddition: 'AfterAddition',\n    AfterRemoval: 'AfterRemoval',\n    Idle: 'Idle',\n};\n\nexport const textareaHeight = {\n    collapsed: 20,\n    expanded: 40\n};\n\nconst commonWrapperSelector = '#container-wrapper .wrapper-content #content';\nexport const Selectors = {\n    HomepageWrapper: commonWrapperSelector,\n};\n\nconst zoomMargin = 125;\nexport const ThingViewConfig = {\n    boundarySize: 640,\n    zoomMargin,                  // zoom box size 250 (246 + 2 + 2) / 2\n    zoomBoxSize: zoomMargin * 2, // zoom box size 250 (246 + 2 + 2) / 2\n    zoomScale: 1.5,\n};\n\nexport const StaticThingViewConfig = {\n    ThumbnailsLimit: {\n        Basic: 18,\n        More: 200,\n    },\n}\n","import { KEYS, didClickOn, eitherFancy, getObjectTypeFromUrl, getPathname, isPlainLeftClick, isStream } from 'fancyutils';\n\nimport store from '../store/store';\nimport { Selectors } from '../config';\nimport { LinkTypes, transition, pagingContext } from './routeutils';\nimport { closeOverlay } from '../action/action-helpers';\n\n\nfunction handleOverlayThingKeyEvents(event) {\n    if (event.target.tagName === 'TEXTAREA' ||\n        event.target.tagName === 'INPUT') {\n        return;\n    }\n\n    switch (event.which) {\n    case KEYS.LEFT:\n        pagingContext.movePrev();\n        break;\n    case KEYS.RIGHT:\n        pagingContext.moveNext();\n        break;\n    case KEYS.ESC:\n        // If popup is not on\n        if ($('#popup_container:visible').length === 0) {\n            store.dispatch(closeOverlay());\n        }\n        break;\n    }\n}\n\nfunction conditionalTransition(aElement) {\n    // Turn off video\n    $('#container-wrapper .btn-pause').attr('scroll',true).click();\n    // Ensure anchor is static (sticked to homepage timeline) or not.\n    if (isStream() && $(Selectors.HomepageWrapper).has(aElement)) {\n        transition(aElement.getAttribute('href'), LinkTypes.Static);\n    } else {\n        transition(aElement.getAttribute('href'));\n    }\n}\n\nvar oneshotEventAttached = false;\nexport function attachEntryEvents() {\n    if (oneshotEventAttached) {\n        return;\n    }\n    oneshotEventAttached = true;\n    // Remove pre-existing url event and start transition first\n    $(document.body).off('click.overlayThingInit');\n    if (window.__INIT_THING_ANCHOR != null) {\n        conditionalTransition(window.__INIT_THING_ANCHOR);\n        delete window.__INIT_THING_ANCHOR;\n    }\n    // TODO: replace to class-based event binding\n    $(document.body)\n        .on('click', 'a', function(event) {\n            if (isPlainLeftClick(event) &&\n                this.getAttribute('data-prevent-overlay') == null &&\n                getObjectTypeFromUrl(getPathname(this)) === 'Thing'\n            ) {\n                event.preventDefault();\n                // note: key event will be detached inside `closeOverlay()` call\n                $(document).on('keydown.overlayThing', handleOverlayThingKeyEvents);\n                conditionalTransition(this);\n            }\n        });\n\n    $('#overlay-thing').on('click', '.popup.overlay-thing', function(event) {\n        const $targ = $(event.target);\n        // Center container\n        if (didClickOn($targ, '.sidebar') ||\n            didClickOn($targ, '.thing-detail-container .content') ||\n            didClickOn($targ, '.thing-detail-container .timeline') ||\n            eitherFancy('Admin', ({ sharedState }) => sharedState.draggingAdmin)) {\n            // pass\n        // prev button\n        } else if (didClickOn($targ, '.popup_prev')) {\n            pagingContext.movePrev();\n            return false;\n        // next button\n        } else if (didClickOn($targ, '.popup_next')) {\n            pagingContext.moveNext();\n            return false;\n        } else {\n            store.dispatch(closeOverlay());\n        }\n    });\n}\n\nexport const OtContainer = {\n    isStaticCache: undefined,\n    isStatic() {\n        if (this.isStaticCache === undefined) {\n            this.isStaticCache = $(document.body).is('.static-ot');\n        }\n        return this.isStaticCache;\n    },\n    getDynamic() {\n        return $('#overlay-thing .thing-detail');\n    },\n    getStatic() {\n        return $(document);\n    },\n    get() {\n        return this.isStatic() ? this.getStatic() : this.getDynamic();\n    },\n    scrollToTop() {\n        if (this.isStatic()) {\n            $(document.body.parentElement).scrollTop(0);\n        } else {\n            $('#overlay-thing').scrollTop(0);\n        }\n    },\n}\nwindow.OtContainer = OtContainer;\n\n// Only one event is allowed\nexport const scrollEvent = {\n    handleScroll: null,\n    attach(func, prepare) {\n        if (scrollEvent.handleScroll != null) {\n            scrollEvent.detach();\n        }\n        const _prepare = prepare != null ? prepare : 10;\n        \n        const handleScroll = _.throttle(function() {\n            if (OtContainer.isStatic()) {\n                const viewportHeight = document.documentElement.clientHeight;\n                if (scrollEvent.visible === true) {\n                    // console.debug('$(window).height() - $(window).scrollTop() - _prepare <= viewportHeight', $(window).height(), $(window).scrollTop(), _prepare, viewportHeight, $(window).height() - $(window).scrollTop() - _prepare <= viewportHeight)\n                    if (document.documentElement.scrollHeight - $(window).scrollTop() - _prepare <= viewportHeight) {\n                        func(true);\n                    }\n                }\n            } else {\n                const el = this;\n                const viewportHeight = el.clientHeight;\n                if (scrollEvent.visible === true) {\n                    if (el.scrollHeight - el.scrollTop - _prepare <= viewportHeight) {\n                        func(true);\n                    }\n                }\n            }\n        }, 50);\n        this.handleScroll = handleScroll;\n\n        const containerEl = OtContainer.isStatic() ? OtContainer.get().get(0) : $('#overlay-thing').get(0);\n        containerEl.addEventListener('scroll', handleScroll, { passive: true });\n        handleScroll();\n    },\n\n    detach() {\n        const containerEl = OtContainer.get().get(0);\n        containerEl.removeEventListener('scroll', this.handleScroll);\n    },\n    visible: false // copied variable on `state.appContext.visible` change\n};\n","import { extractMetaFromURL } from 'fancyutils';\nimport { history } from 'common-components';\n\nimport store from '../store/store';\nimport { closeOverlay, fetchThing } from '../action/action-helpers';\n\n\nconst initialThingPageID = extractMetaFromURL(location.pathname).id;\nconst initialPageIsThingPage = initialThingPageID != null;\n\n// This stores initial static page history info that needs to be restored when modal get closed.\nexport const historyData = {\n    initialPath: location.pathname,\n    /* mut */preservedHref: location.href, // Preserved Href just before open, and to be returned when closed.\n    initialThingPageID,\n    initialPageIsThingPage,\n    initialTitle: document.title,\n    // This prop indicates current location is (static) thing page. Mutable.\n    locationIsThingPage: initialPageIsThingPage,\n    overlayIsOn: false,\n};\n\nexport function runOverlay(thingID, thingURLType, killCache = false, queryString) {\n    // Context needs to be isolated from hook: https://github.com/rackt/redux-router/issues/157\n    if (!$(document.body).hasClass('error-page')) {\n        requestIdleCallback(() => {\n            $(document.body).addClass('thing-overlay-on');\n            store.dispatch(fetchThing(thingID, thingURLType, killCache, false, queryString));\n            historyData.overlayIsOn = true;\n        });\n    }\n}\n\nfunction stopOverlay() {\n    historyData.overlayIsOn = false;\n    store.dispatch(closeOverlay());\n}\n\nexport function reloadCurrentThing() {\n    const meta = extractMetaFromURL(location.href);\n    const thingID = meta && meta.id;\n    if (thingID != null && historyData.overlayIsOn) {\n        runOverlay(thingID, meta.type, true);\n    }\n}\n\nexport function historyHook({ pathname, search /*, action*/ }) {\n    const meta = extractMetaFromURL(pathname);\n    const thingID = meta && meta.id;\n    // When initially (statically) renderred page is thing page\n    // Moving to new thing page\n    historyData.locationIsThingPage = thingID != null;\n    if (historyData.locationIsThingPage) {\n        runOverlay(thingID, meta.type, false, search);\n    } else if (historyData.overlayIsOn) {\n        stopOverlay();\n    }\n}\n\nhistory.listen(historyHook)\n","import { extractMetaFromURL, getObjectTypeFromUrl, isStaticPage, stripPathname } from \"fancyutils\";\n\nimport { historyData } from \"./history\";\nimport { history } from 'common-components';\nexport const LinkTypes = {\n    Dynamic: 0,\n    Static: 1,\n    Timeline: 2,\n    Internal: 3 // no update needed\n};\n\n// `staticLink`: transition from statically attached links\nexport function transition(href, linkType = LinkTypes.Dynamic) {\n    // ID-only\n    if (!_.isNaN(Number(href))) {\n        href = `/things/${href}`;\n    }\n\n    if (getObjectTypeFromUrl(href) === \"Thing\") {\n        const meta = extractMetaFromURL(href);\n        // Update URL to go back when overlay is closed\n        if (!historyData.overlayIsOn) {\n            historyData.preservedHref = location.href;\n        }\n        history.push(stripPathname(meta.href), null);\n    } else {\n        redirect(href);\n    }\n}\n\nexport function closeModal() {\n    if (isStaticPage()) {\n        return;\n    }\n    $(document.body).removeClass(\"thing-overlay-on\"); // FIXME: isolate modal logic\n}\n\n// NOOP\nexport const pagingContext = {\n    init() {},\n    movePrev() {},\n    moveNext() {}\n}\n\nexport function redirect(destination) {\n    if (destination == null) {\n        return false;\n    } else {\n        location.href = destination;\n        return true;\n    }\n}\n\nfunction getUtm() {\n    const $nav = $('.navigation')\n    if ($nav.length > 0) {\n        if ($nav.find('a.current[data-feed=\"featured\"]').length > 0) {\n            return \"timeline_featured\";\n        } else if ($nav.find('a.current[data-feed=\"recommended\"]').length > 0) {\n            return \"timeline_recommended\";\n        } else {\n            const $shopLink = $nav.find('.shop li a');\n            if ($shopLink.eq(0).is('.current')) {\n                return \"shop\";\n            } else if ($shopLink.eq(1).is('.current')) {\n                return \"\";\n            } else if ($shopLink.eq(2).is('.current')) {\n                return \"popular\";\n            } else if ($shopLink.eq(3).is('.current')) {\n                return \"newest\";\n            } else if ($shopLink.eq(4).is('.current')) {\n                return \"editors_picks\";\n            } else if ($shopLink.eq(5).is('.current')) {\n                return \"sales\";\n            }\n        }\n    } else {\n        if ($('.wrapper-content.profile-section').length > 0) {\n            return \"userprofile\";\n        } else if ($('.wrapper-content.merchant').length > 0) {\n            return \"seller_shop\";\n        }\n    }\n}\n\nexport function getUtmString() {\n    const utm = getUtm()\n    if (utm) {\n        return `?utm=${utm}`\n    } else {\n        return ''\n    }\n}\n","import { combineReducers } from \"@reduxjs/toolkit\";\nimport { extractMetaFromURL, /*getConciseNumberString,*/ update, updateShallow } from \"fancyutils\";\n\nimport C from \"./action/action-constants\";\nimport { getInitialStoreState } from \"./store/initial-store\";\nimport { getFirstSaleOption, setWaiting } from \"./components/map\";\nimport { updateState } from \"./appstate\";\nimport { scrollEvent } from \"./container/entry-events\";\nimport { getThingType } from \"./ThingTypes\";\nimport { cache } from \"./cache\";\n\nvar loaded = false;\nvar lastFullyRenderedThingID = 0;\nfunction appContext(state = getInitialStoreState(\"appContext\"), action) {\n    switch (action.type) {\n        case C.OPEN_THING:\n            scrollEvent.visible = true;\n            return updateShallow(state, {\n                visible: true,\n            });\n        case C.CLOSE_THING:\n            scrollEvent.visible = false;\n            lastFullyRenderedThingID = 0;\n            loaded = false;\n            return updateShallow(state, {\n                visible: false,\n                lastFullyRenderedThingID,\n            });\n        case C.UPDATE_APP_CONTEXT:\n            return updateShallow(state, action.context);\n        case C.LOAD_THING: {\n            // Due to multi-stage rendering (cache -> from-server-data -> ...)\n            // it is unable to check state change correctly just by comparing ID;\n            // Therefore, we set internal state per every update cycle and check\n            // if state is fully updated.\n\n            // FIXME: when cached response exist, it marks as rendered before\n            if (loaded === true && lastFullyRenderedThingID !== action.data.id && action.data.fromServer) {\n                lastFullyRenderedThingID = action.data.id;\n            }\n\n            const loggedIn = window.__FancyUser.loggedIn;\n            const viewer = action.data.viewer || {};\n            const userCountry =\n                $.cookie.get(\"shipping_country_code\") || action.data.current_country_code || state.userCountry;\n\n            updateState(\"loggedIn\", loggedIn);\n            updateState(\"viewer\", viewer);\n            loaded = true;\n\n            return update(state, { lastFullyRenderedThingID, loggedIn, viewer, userCountry });\n        }\n        default:\n            return state;\n    }\n}\n\nfunction populateThingContext(thingData) {\n    thingData.loading = thingData.fromServer !== true;\n    thingData.META = getThingType(thingData);\n    thingData.URLMeta = extractMetaFromURL(location.href); // FIXME: provide current pathname\n    thingData.owner = thingData.user;\n}\n\n// Thing context\nfunction thing(state = getInitialStoreState(\"thing\"), action) {\n    switch (action.type) {\n        case C.LOAD_THING:\n            populateThingContext(action.data);\n            return updateShallow(state, {\n                data: action.data,\n                status: action.status,\n                ID: action.ID,\n                pendingID: null,\n                isFetching: false,\n            });\n        case C.REQUEST_THING:\n            return update(state, {\n                pendingID: action.pendingID,\n                status: action.status,\n                isFetching: true,\n            });\n        case C.REQUEST_THING_FAILURE:\n            return update(state, {\n                status: action.status,\n                isFetching: false,\n            });\n\n        // Reset state\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"thing\"));\n        default:\n            return state;\n    }\n}\n\n// Follow contexts\nfunction followContext(state = getInitialStoreState(\"followContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"), {\n                id: action.data.id,\n                followStore: {\n                    following: action.data.sales\n                        ? Boolean(action.data.sales.seller && action.data.sales.seller.seller_follow)\n                        : false,\n                    loading: false,\n                },\n                followUser: {\n                    following: action.data ? Boolean(action.data.following) : false,\n                    loading: false,\n                },\n            });\n\n        // Sidebar\n        // Follow seller/user\n        case C.TOGGLE_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: true,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.CANCEL_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.COMPLETE_FOLLOW:\n            if (action.followType === \"followStore\") {\n                cache.update(state.id, undefined, \"sales.seller.seller_follow\", state[action.followType].following);\n            }\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: state[action.followType].following,\n                },\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"));\n        default:\n            return state;\n    }\n}\n\n/*\nfunction getFancyStatus(nextFancydState) {\n    return nextFancydState ? FancyStatus.Addition : FancyStatus.Removal;\n}\nfunction getCompletionIdleStatus(currentFancyState) {\n    const prevFancyState = !currentFancyState;\n    return prevFancyState ? FancyStatus.AfterRemoval : FancyStatus.AfterAddition;\n}*/\n\nfunction fancyContext(state = getInitialStoreState(\"fancyContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            // Extract thing data for initial thing context data reset.\n            // onFancyButtonUpdate(action.data.id, action.data.fancyd, getConciseNumberString(action.data.fancyd_count));\n            return updateShallow(getInitialStoreState(\"fancyContext\"), {\n                id: action.data.id,\n                fancyd: action.data.fancyd,\n                fancyd_count: action.data.fancyd_count,\n                loading: false,\n                //status: FancyStatus.Idle,\n            });\n        case C.TOGGLE_FANCY:\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: true,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: true,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        case C.CANCEL_FANCY: {\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: false,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: false,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        }\n        // Update data\n        case C.COMPLETE_FANCY:\n            // cache.update(state.id, undefined, \"fancyd\", state.fancyd);\n            // cache.update(state.id, undefined, \"fancyd_count\", action.fancyd_count);\n            // onFancyButtonUpdate(state.id, state.fancyd, getConciseNumberString(action.fancyd_count));\n            // return update(state, {\n            //     loading: false,\n            //     fancyd_count: action.fancyd_count,\n            //     //status: getCompletionIdleStatus(state.fancyd)\n            // });\n            return {\n                ...state,\n                ...{\n                    loading: false,\n                    fancyd_count: action.fancyd_count,\n                    //status: getCompletionIdleStatus(state.fancyd)\n                },\n            };\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"fancyContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction slideContext(state = getInitialStoreState(\"slideContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"), {\n                id: action.data.id,\n            });\n        case C.SET_THUMBNAIL_INDEX:\n            return update(state, {\n                thumbnailIndex: action.thumbnailIndex,\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction saleContext(state = getInitialStoreState(\"saleContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING: {\n            // Extract thing data for initial thing context data reset.\n            const thing = action.data;\n            const sales = thing && thing.sales;\n            const saleOptionInclSales = getFirstSaleOption(sales);\n            const nextContext = {\n                selectedQuantity: 1,\n                // saleOptionID: (saleOptionInclSales && saleOptionInclSales.id) || null,\n                saleOptionID: null,\n                currencyCode: action.data.currency_code,\n                price: (saleOptionInclSales && saleOptionInclSales.price) || null,\n                waiting: null,\n            };\n            return updateShallow(getInitialStoreState(\"saleContext\"), nextContext);\n        }\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"saleContext\"));\n        case C.UPDATE_SALE_CONTEXT: {\n            // Setting waiting\n            if (action.waiting != null) {\n                setWaiting(state.saleOptionID, action.waiting);\n            }\n\n            let waiting = action.waiting;\n            // Reset quantity / Change waiting if option is changed.\n            if (action.saleOptionID != null && action.saleOptionID !== state.saleOptionID) {\n                action.selectedQuantity = 1;\n                waiting = null;\n            }\n\n            const nextContext = {\n                selectedQuantity: action.selectedQuantity,\n                saleOptionID: action.saleOptionID, // `thing.id`? | `sio.id`?\n                price: action.price, // (props.thing.sales_available && props.thing.sales.price) || null,\n                // UI\n                currencyCode: action.currencyCode, // props.thing.currency_code\n                currencyMoney: action.currencyMoney, //\n                currencySymbol: action.currencySymbol, //\n                personalization: action.personalization,\n                waiting,\n            };\n            return update(state, nextContext);\n        }\n        default:\n            return state;\n    }\n}\n\n/*\nfunction checkNotImplementedWithURLExceptionRule(META) {\n    if (['Fancybox', 'Hermes'].some(type => META[type])) {\n        window.location.reload()\n    }\n}*/\n\nconst rootReducer = combineReducers({\n    appContext,\n    // Thing contexts\n    followContext,\n    fancyContext,\n    slideContext,\n    saleContext,\n    // etc.\n    thing,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","// Warning: objects has to be flat in each context\nexport function getInitialStoreState(contextName: 'appContext' | 'thing' | 'followContext' | 'fancyContext' | 'saleContext' | 'slideContext') {\n    switch(contextName) {\n    case 'appContext':\n        return {\n            visible: false,\n            viewer: {},\n            loggedIn: null,\n            userCountry: 'US',\n            applePayDisplay: false,\n            applePayTest: false,\n        };\n    case 'thing':\n        return {\n            data: null,\n            ID: null,\n            pendingID: null,\n            isFetching: null,\n            status: 'idle' // { idle | request | failed }\n        };\n    case 'followContext':\n        return {\n            id: null,\n            followStore: {\n                following: undefined,\n                loading: false,\n            },\n            followUser: {\n                following: undefined,\n                loading: false,\n            },\n        };\n    case 'fancyContext':\n        return {\n            id: null,\n            fancyd_count: 0,\n            fancyd: false,\n            loading: false,\n            status: 'Idle', // { Idle | Addition | Removal | After- } - Fancy'd status for animation control \n        };\n    case 'saleContext':\n        return {\n            selectedQuantity: 1,\n            saleOptionID: null, // `thing.id`? | `sio.id`?\n            currencyCode: null, // props.thing.currency_code\n            currencyMoney: null, //\n            currencySymbol: null, //\n            price: null, // (props.thing.sales_available && props.thing.sales.price) || null,\n            personalization: null,\n        };\n    case 'slideContext':\n        return {\n            id: null,\n            thumbnailIndex: 0,\n        };\n    default:\n        console.warn('`getInitialStoreState()`: Unknown context name ', contextName);\n    }\n};\n\nvar contexts = [\n    'slideContext',\n    'saleContext',\n    'fancyContext',\n    'followContext',\n    'thing',\n    'appContext'\n];\n\nexport function getAllInitialStoreState() {\n    return contexts.reduce((state, contextKey) => {\n        state[contextKey] = getInitialStoreState(contextKey);\n        return state;\n    } , {});\n}\n","import { configureStore } from \"@reduxjs/toolkit\";\nimport thunk from \"redux-thunk\";\nimport logger from 'redux-logger'\n\nimport { getAllInitialStoreState } from \"./initial-store\";\nimport rootReducer from \"../reducers\";\n// import type { RootState } from '../reducers';\n\nconst middlewares = [thunk];\nif (process.env.NODE_ENV !== 'production') {\n    middlewares.push(logger);\n}\n\nconst store = configureStore({\n    reducer: rootReducer,\n    preloadedState: getAllInitialStoreState(),\n    middleware: (getDefaultMiddleware) =>\n        getDefaultMiddleware({\n            serializableCheck: false,\n        }).prepend(middlewares),\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport default store;\n"],"sourceRoot":""}
{"version":3,"sources":["webpack://fancy/./_static/modules/ui/overlay-thing/action/actions.js","webpack://fancy/./_static/modules/ui/overlay-thing/appstate.ts","webpack://fancy/./_static/modules/ui/overlay-thing/cache.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/FancyContext.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AdminPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/SimpleSharePopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AddlistPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/ActionButtons.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/zoom.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/Perf.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItemForm.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/CartButton.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/multiOption.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/ApplePayButton.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/store/initial-store.ts","webpack://fancy/./_static/modules/ui/overlay-thing/ThingTypes.js","webpack://fancy/./_static/modules/ui/overlay-thing/reducers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/store/store.ts"],"names":["requestThing","pendingID","type","C","status","requestThingFail","loadThing","ID","data","openThing","closeThing","thing","setThumbnailIndex","thumbnailIndex","toggleFancy","thingID","cancelFancy","completeFancy","fancyd_count","updateAppContext","contextObject","context","state","viewer","loggedIn","updateState","k","v","ThingCache","id","ignoreCralwed","cac","get","existence","isCrawled","THINGS","SALES","getCrawled","count","console","warn","selector","value","t","index","cache","window","__THING_CACHE","getFancyContextDefaultValue","appContext","followContext","fancyContext","slideContext","saleContext","dispatch","FancyContext","React","useFancy","className","title","AdminPopup","show_on_homepage","date_published","exclude_from_popular","show_in_search","optionSaving","ownerSaving","mergeSaving","props","payload","thing_id","inputDate","Date","isNaN","alert","toISOString","replace","split","setState","$","post","then","json","status_code","Object","assign","message","fail","changeOwnerEl","new_owner","trim","length","toLowerCase","thing_owner","username","confirm","ajax","url","new_owner_name","new_thing_id","ntid","old_user_id","dataType","done","xml","xmlUtil","location","reload","find","text","always","that","this","dialog","popupName","$obj","on","prevProps","prevState","center","sales","name","href","target","checked","onChange","event","placeholder","style","Display","classnames","onClick","handleSaveOptions","ref","el","handleChangeOwner","SimpleSharePopup","preventDefault","closePopup","log","shareUrl","copyToClipboard","urlCopied","setTimeout","connector","indexOf","handleCopyLink","encodeURIComponent","images","image_url","AddlistPopup","lists","listSearchQuery","listCreationQuery","listCreating","drawUserList","listSearchInput","focus","which","KEYS","objectId","isEmpty","updateList","createList","callback","success","updated","MP","stopPropagation","targ","currentTarget","selectedListId","Number","getAttribute","theList","filter","list","prevAdded","added","eventName","update","handleDialogOpen","getListCheckbox","res","element","handleListSearch","map","idx","term","_","isString","key","data-listid","handleListItemToggle","quickCreateList","onKeyUp","handleListCreation","handleCreateListQueryChange","gettext","Component","tid","resp","alertify","error","err","unchecked","join","Favorite","useDispatch","fancyd","loading","crdl","getCordialProperties","e","require_login","ActionButtons","msg","fancyd_friends","cnt","full_name","tagName","renderPopup","FancydByPopupV4","objectType","FancyUser","viewerId","is_admin_any","zoomScale","getBoundarySize","$el","eq","DEBUG","width","height","getZoomBoxSize","bs","Math","min","getZoomMargin","zidCac","getZoomImageDimension","img","zoomMargin","ret","getNextZoomImageStyle","pageX","pageY","$wrapper","boundaryWidth","boundaryHeight","meta","marginHoriz","marginVert","$fig","getImageMeta","offset","left","top","topPosition","showZoomImage","zoomBoxSize","zd","zoomImageContainerX","minmax","zoomImageContainerY","backgroundLeft","backgroundTop","bgPosX","bgPosY","transform","backgroundPosition","display","getZoomImageStyle","isZoomActive","currentZoomImageStyle","backgroundSize","isTouchDevice","navigator","maxTouchPoints","msMaxTouchPoints","SwiperAddons","Thumbs","push","Zoom","SwiperCore","ImageSlide","memo","image","i","setSlideLocked","isActive","useState","setZoomActive","zoomImageStyle","setZoomImageStyle","zoomImageCacheKey","setZoomImageCacheKey","zoomImageLoaded","setZoomImageLoaded","isVideo","h264_1000k_url","isMagnifyingGlassZoomable","useEffect","src","large_image_url","Promise","r","Image","onload","onerror","zoom","startZoom","zoomShow","nextZoomImageStyle","onMouseMove","object","playing","lastFullyRenderedObjectID","allow","fullScreen","data-src","undefined","alt","cursor","backgroundColor","backgroundImage","nextProps","displayName","imageOnly","thumbsPerView","fancyProps","swiperRef","useRef","swipeThumbsRef","thumbIndex","setThumbIndex","slideLocked","swiper","setSwiper","option","getCurrentSaleOption","getSaleImages","lastThumbIndex","activeIndex","slideTo","current","thumbSwiper","slides","classList","contains","prevEl","opacity","max","nextEl","onSlideChange","preloadImages","lazy","loadPrevNext","loadPrevNextAmount","maxRatio","allowSlidePrev","allowSlideNext","onZoomChange","scale","onSwiper","clickedIndex","direction","spaceBetween","slidesPerView","watchSlidesVisibility","selected","thumbnail_url","Keys","Wrap","Body","Title","Price","Form","Desc","Owner","SaleOptions","options","currentValue","expander","defaultValue","printer","disabled","onFocus","unselectedLabel","SelectBox","labelValue","label","tabIndex","SizeGuide","showSelectWarning","s","MultiOptionState","option_meta","orderMap","forEach","m","targetIndex","values","filteredOptions","order","sel","uniq","o","getPossibleValuesForIndex","MultiOption","multiOptionState","sid","multiOptions","getMultiOptions","sizeGuidePos","indexTypeOf","additional","selectedArray","selectedValue","showSizeGuide","MultiSelectBox","swatch","MultiSwatch","thumbnail","MultiThumbnail","MultiButton","onMultiSelectBoxChange","MultiSelectBoxOption","data-value","data-index-typeof","onClickSwatch","MultiSwatchOption","data-label","onClickThumbnail","MultiThumbnailOption","onClickMutliButton","MultiButtonOption","Button","onPurchase","waiting","getWaiting","available","soldout","onNotifyLater","useCallback","appState","opt","params","sale_item_id","option_id","remove","updateSaleContext","subscribed","isOptionMulti","applePayTest","saleOptionID","selectedQuantity","price","WebkitAppearance","ApplePayButtonType","ApplePayButtonStyle","FancyApplePay","clicked","salesOptionsAvailable","isSalesOptionsAvailable","country","seller","seller_id","quantity","parseInt","requestPurchase","testmode","trace","optionValueFunction","saleNamePrinter","Fancy","discounting","retailPrice","discountPercentage","sale","floatFormatMinusTwo","numberFormat","SaleItemSidebarHead","CurrencyPopup","currentCurrency","currencyCode","renderCurrencyPopup","currencyIsUSD","saleOption","optionIsMulti","sale_id","personalization","CartAPI","addItem","Cart","openPopup","os","total","amount","displayItems","checkAvailability","applePayDisplay","getInitialMultiOptionState","updateSaleOptionIDFromMultiOptionState","presetOptionId","getLocationArgPairs","String","selectedOptionArray","selectedOption","every","extractSaleOptionIDFromMultiOptionState","amendedID","amendSaleOptionFromMultiOptionState","nextSelected","button","dropdown","some","indexOfType","attr","extend","onClickMultiOptionGen","convertCurrency","initializeMultiOption","checkApplePay","nextSaleOptionID","_o","mos","$so","escapeSelector","is","prop","click","paymentRequest","nonSoldout","selectedNonSoldoutOption","nextValue","nsc","priceChanges","currencyChanges","applePayButton","showInfo","parseFloat","discount_percentage","retail_price","quantitySelectRange","range","showSelectbox","getSafeNameProp","SaleItemOptionsExpander","handleOptionChange","size_guide_id","SizeGuidePopup","personalizable","handlePersonalizationChange","handleQuantityChange","handlePurchase","sio","getInitialStoreState","contextName","visible","userCountry","isFetching","followStore","following","followUser","currencyMoney","currencySymbol","contexts","ThingTypeMeta","thingContext","PlainThingType","args","objectArgs","mergeObjectArgs","owner","user","META","getThingType","SaleItemType","createEmptyObject","sales_available","review_rating","review_count","size_chart_ids","GiftcardType","HotelType","hotel_search","hotel","VanityType","LaunchAppType","has_launch_app","metadata","ThingTypes","AttachingType","ComparingType","loaded","lastFullyRenderedThingID","populateThingContext","thingData","fromServer","URLMeta","extractMetaFromURL","combineReducers","action","scrollEvent","updateShallow","__FancyUser","cookie","current_country_code","Boolean","seller_follow","followType","nextFancydState","saleOptionInclSales","getFirstSaleOption","nextContext","currency_code","setWaiting","middlewares","thunk","configureStore","reducer","rootReducer","preloadedState","reduce","contextKey","middleware","getDefaultMiddleware","serializableCheck","prepend"],"mappings":"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","file":"131.15fc02d84d6a9035d879.js","sourcesContent":["import C from './action-constants';\n\n\n// Action on requesting thing starts\nexport function requestThing(pendingID) {\n    return {\n        type: C.REQUEST_THING,\n        status: 'request',\n        pendingID\n    };\n}\n\n// Action on requesting thing fails\nexport function requestThingFail() {\n    return {\n        type: C.REQUEST_THING_FAILURE,\n        status: 'failed'\n    };\n}\n\n// action on loading request result\nexport function loadThing(ID, data) {\n    return {\n        type: C.LOAD_THING,\n        status: 'idle',\n        ID,\n        data\n    };\n}\n\n// Action on close overlay\nexport function openThing() {\n    return {\n        type: C.OPEN_THING\n    };\n}\n\n// Action on close overlay\nexport function closeThing() {\n    return {\n        type: C.CLOSE_THING,\n        ID: null,\n        pendingID: null,\n        thing: null\n    };\n}\n\n\nexport function setThumbnailIndex(thumbnailIndex) {\n    return {\n        type: C.SET_THUMBNAIL_INDEX,\n        thumbnailIndex,\n    };\n}\n\nexport function toggleFollow(followType) {\n    return {\n        type: C.TOGGLE_FOLLOW,\n        followType\n    };\n}\n\nexport function cancelFollow(followType) {\n    return {\n        type: C.CANCEL_FOLLOW,\n        followType\n    };\n}\n\nexport function completeFollow(followType) {\n    return {\n        type: C.COMPLETE_FOLLOW,\n        followType\n    };\n}\n\nexport function toggleFancy(thingID) {\n    return {\n        type: C.TOGGLE_FANCY,\n        thingID,\n    };\n}\n\nexport function cancelFancy(thingID) {\n    return {\n        type: C.CANCEL_FANCY,\n        thingID,\n    };\n}\n\nexport function completeFancy(thingID, fancyd_count) {\n    return {\n        type: C.COMPLETE_FANCY,\n        thingID,\n        fancyd_count\n    };\n}\n\nexport function updateAppContext(contextObject) {\n    return {\n        type: C.UPDATE_APP_CONTEXT,\n        context: contextObject\n    };\n}\n","// App state that does not usually change during app lifecycle. (i.e. Login state)\n\n// module-level login state object and setter\nconst state : { viewer: {}; loggedIn: Boolean; } = { viewer: {}, loggedIn: false };\nexport default state;\n\nexport function updateState(k, v) {\n    state[k] = v;\n}\n","import { index } from 'fancyutils';\n\n// Cache bucket\nexport class ThingCache {\n    things = {};\n    sales = {};\n    count = 0;\n    static SALES = 'sales';\n    static THINGS = 'things';\n\n    exists = (id, type, ignoreCralwed) => {\n        const cac = this.get(id, type);\n        var existence = cac != null && typeof cac === 'object';\n        if (ignoreCralwed) {\n            existence = existence && cac.isCrawled !== true;\n        }\n        return existence;\n    }\n\n    // resolver function\n    _get = (id) => {\n        return this[ThingCache.THINGS][id] || this[ThingCache.SALES][id] || null;\n    }\n\n    get = (id, type = ThingCache.THINGS) => {\n        const cac = this[type][id] || this.getCrawled(id, type);\n        return cac;\n    }\n\n    getCrawled = (id, type) => {\n        const cac = this[type][id];\n        if (cac && cac.isCrawled) {\n            return cac;\n        } else {\n            return null;\n        }\n    }\n\n    add = (id, data, type) => {\n        // to add, cache should not be exist or crawled one\n        const cac = this[type][id];\n        if (\n            cac == null || \n            cac.isCrawled === true\n        ) {\n            this[type][id] = data;\n            // Store thing information as well\n            if (type === ThingCache.SALES && data.id) {\n                this[ThingCache.THINGS][data.id] = data;\n            }\n            this.count += 1;\n        } else {\n            console.warn('cache.add(): Cache overwrite');\n        }\n    }\n\n    remove = (id, type) => {\n        if (this[type][id]) {\n            delete this[type][id];\n            this.count -= 1;\n        } else {\n            console.warn('cache.remove(): Non-existing cache removal');\n        }\n    }\n\n    // selector = 'a.b.c'\n    update = (id, type = ThingCache.THINGS, selector, value) => {\n        if (selector == null) {\n            console.warn('ThingCache#update(): selector is empty');\n            return;\n        }\n        const t = this.get(id, type);\n        if (t) {\n            index(t, selector, value);\n        }\n    }\n\n    // sweep() {\n    //     // TODO: should sweep cache if too many cache added by looking `cache.count`\n    // }\n}\n\nexport const cache = new ThingCache();\nwindow.__THING_CACHE = cache;\n","import { OverlayProps, ReduxProps } from 'ftypes';\nimport React from 'react';\n\nexport function getFancyContextDefaultValue() {\n  return {\n      appContext: {},\n      thing: {},\n      followContext: {},\n      fancyContext: {},\n      slideContext: {},\n      saleContext: {},\n      dispatch: () => {},\n  }\n}\n\n// @ts-ignore\nconst FancyContext = React.createContext<OverlayProps & ReduxProps>(getFancyContextDefaultValue());\n\nexport const useFancy = () : OverlayProps & ReduxProps => {\n  return React.useContext(FancyContext);\n}\n\nexport default FancyContext;\n","import React from 'react';\nimport { Display } from \"fancymixin\";\nimport classnames from 'classnames';\nimport { xmlUtil } from \"fancyutils\";\n\nexport default class AdminPopup extends React.Component {\n    static popupName = 'thing-admin';\n    state = {\n        show_on_homepage: null,\n        date_published: null, \n        exclude_from_popular: false,\n        show_in_search: true,\n        optionSaving: false,\n        ownerSaving: false,\n        mergeSaving: false,\n    };\n    \n    \n    componentDidMount() {\n        const that = this;\n        $.dialog(AdminPopup.popupName).$obj.on('open', () => {\n            const { thing: { show_on_homepage, date_published, exclude_from_popular, show_in_search }  } = that.props;\n            that.setState( { show_on_homepage, date_published, exclude_from_popular, show_in_search } );\n        });\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AdminPopup.popupName).center();\n    }\n    \n    handleSaveOptions = () => {\n        const { thing } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving } = this.state;\n        if (optionSaving) return false;\n        const payload = { thing_id: thing.id, show_on_homepage, exclude_from_popular, show_in_search }\n        if (show_on_homepage) {\n            let inputDate = new Date(date_published);\n            if (isNaN(inputDate)) {\n                alert(\"invalid date - must be in format of 2020-01-01 10:10:10\");\n                return false;\n            }            \n            payload['date_published'] = inputDate.toISOString().replace(/T/, \" \").split(\".\")[0];\n        }\n        this.setState({optionSaving:true});\n        $.post('/manage-newthing.json', payload).then((json) => {\n            if (json.status_code == 1) {\n                Object.assign(thing, payload);\n                alert(\"Updated!\");\n            } else {\n                alert(json.message || \"Failed to save the changes\");\n            }\n            this.setState({optionSaving:false})\n        }).fail(() => {\n            alert(\"Something went wrong!\");\n            this.setState({optionSaving:false})\n        });\n    }\n\n    handleChangeOwner = () => {\n        const { thing } = this.props;\n        if (this.state.ownerSaving) return false;\n        if (this.changeOwnerEl == null) return false;\n        const new_owner = this.changeOwnerEl.value.trim();\n        if (new_owner.length == 0) {\n            alert(\"Please enter a username.\");\n            return false;\n        }\n        if (new_owner.toLowerCase() == thing.thing_owner.username.toLowerCase()) {\n            alert(\"The thing is already owned by the user.\");\n            return false;\n        }\n\n        if (window.confirm(`Do you want to change the current thing's owner to ${new_owner}?`)) {\n            this.setState({ownerSaving: true})\n            $.ajax({\n                type: \"post\",\n                url: \"/change_new_thing_owner.xml\",\n                data: { new_owner_name: new_owner, thing_id: thing.id, new_thing_id: thing.ntid, old_user_id: thing.thing_owner.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    if (xmlUtil.isSuccess(xml)) {\n                        alert(\"Done!\");\n                        location.reload();                        \n                    } else if (xmlUtil.isFail(xml)) {\n                        alert(\n                            $(xml)\n                                .find(\"message\")\n                                .text()\n                        );\n                    }\n                })\n                .fail(() => {\n                    alert(\"There was an error.\");\n                })\n                .always(() => {\n                    this.setState({ownerSaving: false})\n                });\n        }\n        return false;\n    }\n\n    handleMergeThings = () => {\n\n    }\n\n    render() {\n        const { \n            thing, \n            thing: { sales },\n        } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving, ownerSaving, mergeSaving } = this.state;\n        return (\n          <>\n          \t<p className=\"ltit\">{thing.name}</p>\n            <div className=\"thing-admin-body\">\n                <ul className=\"thing-info\">\n                <li><em>Sale ID</em> {sales.id}</li>\n                    <li><em>Thing ID</em> {thing.id}</li>\n                    <li><em>Thing Owner</em> {thing.thing_owner.username}</li>\n                    <li className=\"buttons\">\n                        <a className=\"btns-blue-embo\" href={`/merchant/products/${sales.id}`} target=\"_blank\">Edit Sale</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-sale-orders-by-thing-id?thing_id=${thing.id}`} target=\"_blank\">View Orders</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-users-by-cart-item?sale_id=${sales.id}`} target=\"_blank\">View Carts</a>\n                    </li>\n                </ul>\n                <div className=\"thing-options\">\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-on-homepage\" checked={!!show_on_homepage}\n                        onChange={(event) => this.setState({ show_on_homepage: event.target.checked })}\n                        /> Show on Homepage</label>\n                        <input className=\"text\" type=\"text\" name=\"date-published\" placeholder=\"2020-01-02 10:20:30\"\n                            style={Display.NoneIf(!show_on_homepage)} value={date_published || ''}\n                            onChange={(event) => {this.setState({ date_published: event.target.value })}}\n                            />\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"exclude-from-popular\" checked={!!exclude_from_popular}\n                            onChange={(event) => this.setState({ exclude_from_popular: event.target.checked })}\n                        /> Exclude from Popular</label>\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-in-search\" checked={!!show_in_search}\n                            onChange={(event) => this.setState({ show_in_search: event.target.checked })}\n                        /> Show in Search</label>\n                    </p>\n                    <p>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": optionSaving })} onClick={this.handleSaveOptions}>Save Changes</button>\n                    </p>                    \n                </div>\n                <div className=\"thing-actions\">\n                    <p>\n                        <label>Change Owner</label>\n                        <input type=\"text\" name=\"change_owner\" placeholder=\"Enter new username\" ref={(el) => {this.changeOwnerEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": ownerSaving })} onClick={this.handleChangeOwner}>Change</button>\n                    </p>\n                    {/*\n                    <p>\n                        <label>Merge Things</label>\n                        <input type=\"text\" name=\"merge_thing_id\" placeholder=\"Enter Thing ID\" ref={(el) => {this.mergeThingEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": mergeSaving })} onClick={this.handleMergeThings}>Merge</button>\n                    </p>*/}\n                </div>\n\n            </div>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React from 'react';\nimport classnames from 'classnames';\nimport { closePopup, copyToClipboard } from 'fancyutils';\n\nexport default class SimpleSharePopup extends React.Component {\n    static popupName = 'minimum-share';\n\n    constructor(props) {\n        super(props);\n        const { thing, viewer } = props;\n        let url = `https://fancy.com${thing.url}`;\n        if (viewer && viewer.username) {\n            let connector = ~url.indexOf('?') ? '&' : '?';\n            url = `${url}${connector}ref=${viewer.username}`\n        }\n        console.log(url)\n        this.state = {\n            shareUrl: url,\n            urlCopied: false,\n        }\n    }\n\n    handleCancelClick = (event) => {\n        event.preventDefault();\n        closePopup(SimpleSharePopup.popupName);\n    }\n\n    componentDidUpdate(){\n        $.dialog(SimpleSharePopup.popupName).center();\n    }\n\n    handleCopyLink = (event) => {\n        console.log('handleCopyLink');\n        const { shareUrl } = this.state;\n        console.log('handleCopyLink ' + shareUrl );\n        copyToClipboard(shareUrl);\n        this.setState({ urlCopied: true });\n        setTimeout(() => {\n            this.setState({ urlCopied: false });\n        }, 2000);\n    }\n\n\n    render() {\n        const { thing, viewer } = this.props;\n        const { shareUrl, urlCopied } = this.state;\n\n        return (\n          <>\n          \t<p className=\"ltit\">Share</p>\n            <ul>\n                <li><a href=\"#\" className=\"btn-copy-link link\" onClick={this.handleCopyLink}>{urlCopied ? \"Copied to clipboard\" : \"Copy link\"}</a></li>\n                <li><a \n                    href={`http://pinterest.com/pin/create/link/?url=${encodeURIComponent(shareUrl)}&media=${thing.images ? encodeURIComponent(thing.images[0].image_url) : \"\"}&description=${encodeURIComponent(thing.name)}`}\n                    target=\"_blank\" className=\"pin\">Share to Pinterest</a></li>\n                <li><a \n                    href={`mailto:?body=Check%20out%20${encodeURIComponent(thing.name)}%20on%20Fancy!%0A%0A${encodeURIComponent(shareUrl)}&subject=${encodeURIComponent(thing.name)}%20on%20Fancy`}\n                    target=\"_blank\" className=\"email\">Share via email</a></li>\n            </ul>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { closePopup, KEYS, MP, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nexport default class AddlistPopup extends Component {\n    static popupName = 'add-list';\n    state = {\n        lists: [],\n        listSearchQuery: '',\n        listCreationQuery: '',\n        listCreating: false,\n    };\n\n    handleDialogOpen = () => {\n        this.setState({ lists: [], listSearchQuery: '', listCreationQuery: '' });\n        this.drawUserList()\n        setTimeout(() => {\n            this.listSearchInput.focus();\n        }, 0);\n\n    }\n    componentDidMount() {\n        $.dialog(AddlistPopup.popupName).$obj.on('open', this.handleDialogOpen);\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AddlistPopup.popupName).center();\n    }\n\n    drawUserList() {\n        const objectId = this.props.objectId;\n        getListCheckbox({\n            objectId,\n            callback: res => { this.setState(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setState({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (this.state.listCreating) return;\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        this.setState({ listCreating: true })\n        // save new list\n        updateList({\n            objectId,\n            createList: listCreationQuery,\n            callback: (success, updated) => {\n                if (success) {\n                    const { lists } = this.state;\n                    MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    this.setState( {\n                        listCreationQuery: '', listCreating: false,\n                        lists: [ ...updated, ...lists ],\n                    });\n                }\n            }\n        })\n    }\n\n    handleListItemToggle = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = Number(targ.getAttribute('data-listid'));\n        const theList = lists.filter(list => list.id === selectedListId)[0];\n        const prevAdded = theList.added;\n        theList.added = !theList.added;\n        const eventName = theList.added ? \"Add to List\" : \"Remove from List\";\n        this.setState({ lists })\n\n        const callback = (success, updated) => {\n            const { lists } = this.state;\n            if (success) {\n            } else {\n                const theList = lists.filter(list => list.id === selectedListId)[0];\n                theList.added = prevAdded;\n            }\n            this.setState({ lists })\n            MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n        };\n\n        const update = { objectId, callback };\n\n        if (theList.added) update['checked'] = [theList.id];\n        else update['unchecked'] = [theList.id];\n        updateList(update)\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setState({ listCreationQuery: event.target.value });\n    }\n\n    render() {\n        var { objectId } = this.props;\n        var {\n            lists,\n            listSearchQuery,\n            listCreationQuery,\n            listCreating,\n        } = this.state;\n\n        return (\n            <>\n                <p className=\"ltit\">Add to collections</p>\n                <fieldset className=\"search\">\n                    <input type=\"text\" placeholder=\"Search\" className=\"text\" \n                        value={listSearchQuery} ref={(element) => {this.listSearchInput = element;}}\n                        onChange={this.handleListSearch} />\n                </fieldset>\n                <div className=\"list\">\n                    <ul ref={(el) => {this.lists = el;}}>\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style} className={classnames({ \"added\": list.added })}>\n                                <label>{list.name}</label>\n                                <button\n                                    data-listid={list.id} \n                                    onClick={this.handleListItemToggle}\n                                    className=\"btns-blue-embo\">{list.added ? \"Remove\" : \"Add\"}</button>\n                            </li>\n                        )\n                    })}\n                    </ul>\n                </div>\n                <fieldset className=\"create\">\n                    <input \n                        type=\"text\" placeholder=\"Create new collection\" \n                        ref={(element) => {this.quickCreateList = element;}}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}/>\n                    <button className={classnames(\"btn-create\", { \"loading\": listCreating })} style={Display.NoneIf($.trim(listCreationQuery).length == 0)}\n                        onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </fieldset>\n                <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n            </>\n        );\n    }\n}\n\nfunction getListCheckbox({ objectId, callback }) {\n    $.get('/get_list_checkbox.json', { tid: objectId }).done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            closePopup(AddlistPopup.popupName);\n        }\n        callback && callback({ lists: resp.lists })\n    },)\n    .error(err => { \n        alertify.alert(\"Please try again later.\");\n        console.warn(err); \n        closePopup(AddlistPopup.popupName);\n    });\n}\n\nfunction updateList({ objectId, checked, unchecked, createList, callback }) {\n    const payload = { tid: objectId };\n    if (checked) payload['add_list_ids'] = checked.join(',');\n    if (unchecked) payload['remove_list_ids'] = unchecked.join(',');\n    if (createList) payload['new_list'] = createList;\n\n    $.post('/update_list_checkbox.json', payload)\n    .done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            callback(false, null);\n        } else {\n            callback(true, resp.lists);\n        }\n    })\n    .error(err => { \n        console.warn(err); \n        alertify.alert(\"Please try again later.\");\n        callback(false, []);\n    })\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { FancyUser, MP, renderPopup } from \"fancyutils\";\nimport { useDispatch } from 'react-redux'\nimport { FancydByPopupV4 } from 'common-components';\n\nimport { useFancy } from \"../FancyContext\";\nimport AdminPopup from \"../../popup/AdminPopup\"\nimport SimpleSharePopup from \"../../popup/SimpleSharePopup\"\nimport AddlistPopup from \"../../popup/AddlistPopup\"\nimport { toggleFancy, getCordialProperties } from \"../../../action/action-helpers\";\n\nfunction Favorite() {\n    const { appContext, thing, fancyContext } = useFancy();\n    const dispatch = useDispatch();\n\n    const handleClick = (event: React.MouseEvent) => {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log('favortie');\n        if (!appContext.loggedIn) {\n            window.require_login(null, \"fancy_thing\", thing.id);\n            return;\n        }\n\n        if (fancyContext.loading) {\n            return;\n        }\n\n        dispatch(toggleFancy(thing.id));\n\n        if (!fancyContext.fancyd) {\n            MP(\"Fancy\", { thing_id: thing.id });\n            try {\n                window.crdl('event', 'favorite_item', getCordialProperties(thing));\n            } catch (e) {\n            }\n        } else {\n            MP(\"Unfancy\", { thing_id: thing.id });\n        }\n    };\n\n    return (\n        <a className={classnames(\"button button-static fancy _count\", { fancyd: fancyContext.fancyd })} onClick={handleClick}>\n            Favorite\n        </a>\n    );\n}\n\nexport default function ActionButtons() {\n    const {\n        appContext: { viewer, loggedIn },\n        thing,\n        thing: { id: objectId },\n        fancyContext,\n    } = useFancy();\n\n    let msg;\n    if (thing.fancyd_friends) {\n        const cnt = fancyContext.fancyd_count - 1;\n        if (cnt > 0) {\n            msg = <>\n                Favorited by <a href={thing.fancyd_friends[0].url}>{thing.fancyd_friends[0].full_name}</a> and <b>{cnt} other{(cnt > 1) ? `s` : ``}</b>\n            </>\n        } else {\n            msg = <>Favorited by <a href={thing.fancyd_friends[0].url}>{thing.fancyd_friends[0].full_name}</a></>\n        }\n    } else {\n        msg = <>{fancyContext.fancyd_count} people favorited</>\n    }\n\n    return (\n        <>\n            <span className=\"_fancyd fancyd_user\" onClick={(e : React.MouseEvent<HTMLSpanElement>) => {\n                if (e.target.tagName === 'A') {\n                    return;\n                }\n                renderPopup(FancydByPopupV4, { objectId, objectType: 'thing', loggedIn: FancyUser.loggedIn, viewerId: FancyUser.id });\n            }}>{msg}</span>\n            <a onClick={(event) => {\n                event.preventDefault();\n                if (!loggedIn) {\n                    window.require_login();\n                    return;\n                }\n                renderPopup(AddlistPopup, { objectId });\n            }} className=\"add-list\">Add to List</a>\n            <div className=\"figure-button action-button-v2\">\n                {viewer.is_admin_any && (\n                    <a className=\"edit\"\n                        onClick={(event) => {\n                            event.preventDefault();\n                            renderPopup(AdminPopup, { viewer, thing });\n                        }}>Edit</a>\n                )}\n                <Favorite />\n                <a\n                    className=\"btn-share\"\n                    onClick={(event) => {\n                        event.preventDefault();\n                        renderPopup(SimpleSharePopup, { viewer, thing });\n                    }}>\n                    Share\n                </a>\n            </div>\n        </>\n    );\n}\n","import { minmax } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\nimport { ThingImageOrVideo } from \"ftypes\";\n\n// TODO: cache per (thing id + image index)\nconst zoomBoxMaximumSize = 240;\nconst zoomScale = 1.5;\n\nconst getBoundarySize = () => {\n    const $el = $(\n        \".thing-detail-container .figure-section .swiper-container.gallery-top .active-slide\"\n    ).eq(0);\n\n    if ($el.length !== 1) {\n        window.DEBUG && console.warn('getBoundarySize(): warning: $el.length is ', $el.length);\n    }\n\n    return {\n        $el,\n        width: $el.width()!,\n        height: $el.height()!,\n    };\n};\ntype BS = ReturnType<typeof getBoundarySize>;\n\nconst getZoomBoxSize = (bs: BS) => Math.min(bs.width / 3, zoomBoxMaximumSize);\nconst getZoomMargin = (bs: BS) => (getZoomBoxSize(bs) - 4) / 2;\n\nconst zidCac: { [o: string]: any } = {};\nconst getZoomImageDimension = (img: ThingImageOrVideo, bs = getBoundarySize()) => {\n    if (zidCac[img.image_url]) {\n        return zidCac[img.image_url];\n    }\n    const zoomMargin = getZoomMargin(bs);\n    // const imageSize = calculateImageSize(img);\n\n    const ret = {\n        width: bs.width * zoomScale /* * (imageSize.larger === \"height\" ? imageSize.proportion : 1) */ + zoomMargin,\n        height: bs.height * zoomScale + zoomMargin,\n        /* ((b.height * imageSize.height) / imageSize.width) *\n                (imageSize.larger === \"width\" ? imageSize.proportion : 1) *\n                zoomScale +\n            zoomMargin ,*/\n    };\n    zidCac[img.image_url] = ret;\n    return ret;\n};\n\nconst getImageMeta = (bs: BS) => {\n    let width, height, marginHoriz, marginVert;\n\n    const $fig = $(\".thing-detail-container .figure-section .swiper-container.gallery-top img:eq(0)\");\n    width = $fig.width()!;\n    height = $fig.height()!;\n    marginHoriz = 0;\n    if (width > height) {\n        marginHoriz = 0;\n        marginVert = (bs.height - height) / 2;\n    } else {\n        marginHoriz = (bs.width - width) / 2;\n        marginVert = 0;\n    }\n    return { width, height, marginHoriz, marginVert };\n};\n\nexport const getNextZoomImageStyle = (img: ThingImageOrVideo, pageX: number, pageY: number) => {\n    const bs = getBoundarySize();\n    const $wrapper = bs.$el;\n\n    if (!$wrapper.length) {\n        return Display.None;\n    }\n\n    const boundaryWidth = bs.width;\n    const boundaryHeight = bs.height;\n    const meta = getImageMeta(bs);\n\n    const offset = $wrapper.offset()!;\n    const left = pageX - offset.left;\n    const top = pageY - offset.top;\n\n    const topPosition = top - (boundaryHeight - meta.height) / 2;\n\n    const showZoomImage = left > 0 && topPosition > 0 && topPosition < meta.height;\n\n    const zoomBoxSize = getZoomBoxSize(bs);\n    const zoomMargin = getZoomMargin(bs);\n\n    if (showZoomImage) {\n        const zd = getZoomImageDimension(img, bs);\n        const zoomImageContainerX = minmax(\n            left - zoomMargin,\n            meta.marginHoriz,\n            meta.marginHoriz + meta.width - zoomBoxSize\n        );\n        const zoomImageContainerY = minmax(\n            top - zoomMargin,\n            meta.marginVert,\n            meta.marginVert + meta.height - zoomBoxSize\n        );\n\n        const backgroundLeft = (zd.width * left) / boundaryWidth - zoomMargin;\n        const backgroundTop = (zd.height * top) / boundaryHeight - zoomMargin;\n\n        const bgPosX = -minmax(backgroundLeft, 0, zd.width - zoomBoxSize);\n        const bgPosY = -minmax(backgroundTop, 0, zd.height - zoomBoxSize);\n\n        return {\n            left: 0,\n            top: 0,\n            width: `${zoomBoxSize}px`,\n            height: `${zoomBoxSize}px`,\n            transform: `translate(${zoomImageContainerX}px, ${zoomImageContainerY}px)`,\n            backgroundPosition: `${bgPosX}px ${bgPosY}px`,\n            display: \"inline\",\n        };\n    } else {\n        return Display.None;\n    }\n};\n\nconst RESIZED_SIZE = 1280;\nconst calculateImageSize = (img: ThingImageOrVideo) => {\n    const size = Math.max(img.width, img.height);\n    if (size < RESIZED_SIZE) {\n        const smallerSize = Math.min(img.width, img.height);\n        return {\n            width: img.width,\n            height: img.height,\n            proportion: size / smallerSize,\n            larger: img.width > img.height ? \"width\" : \"height\",\n        };\n    } else {\n        if (img.width > img.height) {\n            const proportion = RESIZED_SIZE / img.width;\n            return {\n                width: RESIZED_SIZE,\n                height: img.height / proportion,\n                proportion,\n                larger: \"width\",\n            };\n        } else {\n            const proportion = RESIZED_SIZE / img.height;\n            return {\n                width: img.width / proportion,\n                height: RESIZED_SIZE,\n                proportion,\n                larger: \"height\",\n            };\n        }\n    }\n};\n\nexport const isZoomable = (img: ThingImageOrVideo) => {\n    const imageSize = calculateImageSize(img);\n    const boundarySize = getBoundarySize();\n\n    return imageSize.width > boundarySize.width * zoomScale || imageSize.height > boundarySize.height * zoomScale;\n};\n\nexport const getZoomImageStyle = (img: ThingImageOrVideo, isZoomActive: boolean, currentZoomImageStyle: any) => {\n    if (isZoomActive) {\n        const zd = getZoomImageDimension(img);\n        const ret = {\n            ...currentZoomImageStyle,\n            backgroundSize: `${zd.width}px ${zd.height}px`,\n        };\n        return ret;\n    } else {\n        return Display.None;\n    }\n};\n","import React, { memo, useEffect, useState, useRef } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\nimport SwiperCore, { Thumbs, Zoom } from \"swiper\";\nimport { Video } from \"common-components\";\nimport { Display } from \"fancymixin\";\n\nimport { useFancy } from \"../../FancyContext\";\nimport ActionButtons from \"../ActionButtons\";\nimport { getCurrentSaleOption, getSaleImages } from \"../../../map\";\nimport { setThumbnailIndex } from \"../../../../action/actions\";\nimport { getZoomImageStyle, getNextZoomImageStyle } from \"./zoom\";\n\nimport type { ThingImageOrVideo } from \"ftypes\";\nimport type { Swiper as SwiperClass } from \"swiper\";\n\nconst isTouchDevice = \"ontouchstart\" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;\nconst SwiperAddons = [Thumbs];\nif (isTouchDevice) {\n    SwiperAddons.push(Zoom);\n}\nSwiperCore.use(SwiperAddons);\n\nconst placeholderImage = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\nconst PER_PAGE = 5;\n\nconst preloadImage = (src: string) =>\n    new Promise((r) => {\n        const image = new window.Image();\n        image.onload = r;\n        image.onerror = r;\n        image.src = src;\n    });\n\ninterface ImageSlideProps {\n    image: ThingImageOrVideo;\n    i: number;\n    isActive: boolean;\n    setSlideLocked: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nconst ImageSlide = memo<ImageSlideProps>(\n    ({ image, i, setSlideLocked, isActive }) => {\n        const {\n            thing,\n            slideContext: { thumbnailIndex },\n        } = useFancy();\n        const [isZoomActive, setZoomActive] = useState(false);\n        const [zoomImageStyle, setZoomImageStyle] = useState(Display.None);\n        const [zoomImageCacheKey, setZoomImageCacheKey] = useState(\"\");\n        const [zoomImageLoaded, setZoomImageLoaded] = useState(false);\n\n        const isVideo = !!image.h264_1000k_url;\n        const isMagnifyingGlassZoomable = !isVideo && !isTouchDevice;\n\n        useEffect(() => {\n            if (!zoomImageCacheKey && isZoomActive) {\n                preloadImage(image.large_image_url).then(() => {\n                    setZoomImageCacheKey(image.large_image_url);\n                    setZoomImageLoaded(true);\n                });\n            }\n            if (zoomImageCacheKey !== \"\" && image.large_image_url !== zoomImageCacheKey) {\n                setZoomImageCacheKey(\"\");\n                setZoomImageLoaded(false);\n            }\n        }, [image.large_image_url, isZoomActive, zoomImageCacheKey]);\n\n        const handleMouseEvent = ({ pageX, pageY }) => {\n            if (!isMagnifyingGlassZoomable) {\n                return;\n            }\n            if (isZoomActive) {\n                const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                setZoomImageStyle(nextZoomImageStyle);\n            }\n        };\n\n        return (\n            <SwiperSlide\n                zoom={isMagnifyingGlassZoomable}\n                key={i}\n                className={classnames({\n                    \"video-slide\": isVideo,\n                    startZoom: isZoomActive,\n                    zoomShow: true,\n                    \"active-slide\": isActive,\n                    loading: thing.loading,\n                })}\n                onClick={({ pageX, pageY }) => {\n                    if (!isMagnifyingGlassZoomable) {\n                        return;\n                    }\n                    const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                    setZoomImageStyle(nextZoomImageStyle);\n\n                    setZoomActive(!isZoomActive);\n                    setSlideLocked(!isZoomActive);\n                }}\n                onMouseMove={handleMouseEvent}>\n                {isVideo ? (\n                    <Video\n                        object={image}\n                        display={true}\n                        playing={thumbnailIndex == i}\n                        lastFullyRenderedObjectID={thing.id}\n                        allow={{ fullScreen: true }}\n                    />\n                ) : (\n                    <>\n                        <img\n                            className=\"swiper-lazy\"\n                            src={image.image_url}\n                            data-src={image.image_url}\n                            title={!isTouchDevice ? \"Double click to zoom-in\" : undefined}\n                            alt={thing.name}\n                            style={{ cursor: \"zoom-in\" }}\n                        />\n                        <em\n                            className=\"zoomImage\"\n                            onClick={() => {\n                                setZoomActive(false);\n                                setSlideLocked(false);\n                            }}\n                            style={{\n                                ...getZoomImageStyle(image, isZoomActive, zoomImageStyle),\n                                backgroundColor: \"white\",\n                                backgroundImage: `url(${zoomImageLoaded ? image.large_image_url : image.image_url})`,\n                            }}\n                        />\n                        {isTouchDevice && <div className=\"swiper-lazy-preloader\" />}\n                    </>\n                )}\n            </SwiperSlide>\n        );\n    },\n    (prevProps: ImageSlideProps, nextProps: ImageSlideProps) => {\n        return prevProps.image.image_url === nextProps.image.image_url && prevProps.isActive === nextProps.isActive;\n    }\n);\nImageSlide.displayName = \"SwiperSlide\"; // This is important to make swiper to acknowledge it's actually slide, not some random components\n\nconst Image = ({ imageOnly = false, thumbsPerView = PER_PAGE }) => {\n    const fancyProps = useFancy();\n    const {\n        thing,\n        saleContext,\n        slideContext: { thumbnailIndex },\n    } = fancyProps;\n    const swiperRef = useRef(null);\n    const swipeThumbsRef = useRef(null);\n    const [thumbIndex, setThumbIndex] = useState(0);\n    const [slideLocked, setSlideLocked] = useState(false);\n    const [swiper, setSwiper] = useState<null | SwiperClass>(null);\n    const option = getCurrentSaleOption(thing.sales, saleContext, true);\n    const images = getSaleImages(thing, option) as ThingImageOrVideo[];\n    const lastThumbIndex = images.length - thumbsPerView;\n\n    useEffect(() => {\n        if (!swiper) {\n            return;\n        }\n        if (thumbnailIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbnailIndex);\n        }\n        if (!imageOnly && swipeThumbsRef.current) {\n            const thumbSwiper = swipeThumbsRef.current.swiper;\n            if (!thumbSwiper.slides[thumbnailIndex].classList.contains(\"swiper-slide-visible\"))\n                thumbSwiper.slideTo(Math.min(thumbnailIndex, lastThumbIndex));\n        }\n    }, [thumbnailIndex, swiper, imageOnly]);\n\n    useEffect(() => {\n        if (!swipeThumbsRef.current) {\n            return;\n        }\n        const swiper = swipeThumbsRef.current.swiper;\n        if (!imageOnly && thumbIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbIndex);\n        }\n    }, [thumbIndex, imageOnly]);\n\n    const prevEl = (\n        <div\n            className=\"prev\"\n            style={{ opacity: thumbIndex > 0 ? undefined : 0.3, display: lastThumbIndex <= 0 ? \"none\" : undefined }}\n            onClick={() => setThumbIndex(Math.max(0, thumbIndex - thumbsPerView))}\n        />\n    );\n\n    const nextEl = (\n        <div\n            className=\"next\"\n            style={{\n                opacity: thumbIndex < lastThumbIndex ? undefined : 0.3,\n                display: lastThumbIndex <= 0 ? \"none\" : undefined,\n            }}\n            onClick={() => {\n                setThumbIndex(Math.min(thumbIndex + thumbsPerView, lastThumbIndex));\n            }}\n        />\n    );\n\n    return (\n        <div className=\"figure-section\">\n            <Swiper\n                ref={swiperRef}\n                onSlideChange={() => {\n                    const swiper = swiperRef.current?.swiper;\n                    if (swiper) {\n                        fancyProps.dispatch(setThumbnailIndex(swiper.activeIndex));\n                        setThumbIndex(swiper.activeIndex);\n                    }\n                }}\n                preloadImages={false}\n                lazy={{\n                    loadPrevNext: true,\n                    loadPrevNextAmount: 0,\n                }}\n                zoom={\n                    isTouchDevice\n                        ? {\n                              maxRatio: 2,\n                          }\n                        : undefined\n                }\n                allowSlidePrev={!slideLocked}\n                allowSlideNext={!slideLocked}\n                onZoomChange={(_, scale) => {\n                    if (scale > 1) {\n                        setSlideLocked(true);\n                    } else {\n                        setSlideLocked(false);\n                    }\n                }}\n                onSwiper={(swiper) => {\n                    setSwiper(swiper);\n                }}\n                className=\"gallery-top\">\n                {images.map((image, i) => {\n                    return (\n                        <ImageSlide\n                            key={i}\n                            image={image}\n                            i={i}\n                            setSlideLocked={setSlideLocked}\n                            isActive={swiper?.activeIndex === i}\n                        />\n                    );\n                })}\n                {!imageOnly && <ActionButtons />}\n            </Swiper>\n            {!imageOnly && prevEl}\n            <Swiper\n                className=\"gallery-thumbs\"\n                ref={swipeThumbsRef}\n                onClick={() => {\n                    if (!swipeThumbsRef.current) {\n                        return;\n                    }\n                    fancyProps.dispatch(setThumbnailIndex(swipeThumbsRef.current.swiper.clickedIndex));\n                }}\n                direction=\"vertical\"\n                spaceBetween={16}\n                slidesPerView={thumbsPerView}\n                watchSlidesVisibility={true}\n                height={80}>\n                {images.map((image, i) => {\n                    return (\n                        <SwiperSlide\n                            key={i}\n                            className={classnames({\n                                \"video-thumbnail\": image.h264_1000k_url,\n                                selected: i == thumbnailIndex,\n                            })}>\n                            <img\n                                height=\"80\"\n                                src={placeholderImage}\n                                style={{ backgroundImage: `url(${image.thumbnail_url})` }}\n                            />\n                        </SwiperSlide>\n                    );\n                })}\n                {imageOnly && (\n                    <>\n                        {prevEl}\n                        {nextEl}\n                    </>\n                )}\n            </Swiper>\n            {!imageOnly && nextEl}\n        </div>\n    );\n};\n\nexport default Image;\n","export const Keys = {\n    Sidebar: {\n        Wrap: 'SIDEBAR_WRAP',\n        Body: 'SIDEBAR_BODY',\n        Title: 'SIDEBAR_TITLE',\n        Price: 'SIDEBAR_PRICE',\n        Form: 'SIDEBAR_FORM',\n        Desc: 'SIDEBAR_DESCRIPTION',\n        Owner: 'SIDEBAR_OWNER',\n    },\n};\n","import React from \"react\";\nimport classnames from \"classnames\";\n\n// Generic purchase handler, needs to be bound to insatnce on initialization.\n/*\n    data-sii={sales.id}\n    data-sisi={sales.seller_id}\n    data-tid={thing.id}\n*/\nconst SaleOptions = ({\n    options = [\"1\"],\n    currentValue = \"1\",\n    id = \"\",\n    value = (v) => v,\n    expander,\n    defaultValue,\n    printer,\n    disabled,\n    onChange,\n    onClick,\n    onFocus,\n    unselectedLabel,\n}) => {\n    expander =\n        expander ||\n        ((option, idx) => (\n            <option key={`sale_options-${idx}`} value={value(option)}>\n                {printer(option)}\n            </option>\n        ));\n\n    return (\n        <select\n            id={id}\n            className={classnames(\"select-boxes2\", { \"one-option\": options.length <= 1 })}\n            value={value(currentValue) || defaultValue}\n            disabled={disabled}\n            onChange={onChange}\n            onClick={onClick}\n            onFocus={onFocus}>\n            {unselectedLabel && <option value=\"\">{unselectedLabel}</option>}\n            {options.map(expander)}\n        </select>\n    );\n};\n\nexport const SelectBox = (props) => {\n    let {\n        className,\n        disabled,\n        label,\n        currentValue,\n        defaultValue,\n        id,\n        printer,\n        tabIndex,\n        unselectedLabel,\n        options = [\"1\"],\n        SizeGuide,\n        showSelectWarning,\n    } = props;\n\n    printer = printer != null ? printer : (s) => s;\n    defaultValue = defaultValue != null ? defaultValue : \"1\";\n    className = className != null ? className : null;\n\n    var labelValue;\n    if (unselectedLabel != null && currentValue === \"\") {\n        labelValue = unselectedLabel;\n    } else {\n        labelValue = printer(currentValue != null ? currentValue : defaultValue);\n    }\n\n    return (\n        <div className={className}>\n            <label>{label}</label>\n            <span className={`trick-select ${id} ${showSelectWarning ? 'soldout' : ''}`}>\n                <a\n                    className={classnames(\"selectBox\", { disabled, \"one-option\": options.length <= 1 })}\n                    tabIndex={tabIndex || \"1\"}>\n                    <span className=\"selectBox-label\">{labelValue}</span>\n                    <span className=\"selectBox-arrow\" />\n                </a>\n                <SaleOptions {...props} printer={printer} defaultValue={defaultValue} />\n            </span>\n            {SizeGuide && <SizeGuide key=\"size-guide\" />}\n        </div>\n    );\n};\n\nexport class MultiOptionState {\n    constructor(options, option_meta) {\n        this.options = options;\n        this.option_meta = option_meta;\n        const orderMap = {};\n        option_meta.forEach((m) => {\n            if (orderMap[m.type] == null) {\n                orderMap[m.type] = { length: 1 };\n                orderMap[m.type][m.name] = 0;\n            } else {\n                orderMap[m.type][m.name] = orderMap[m.type].length;\n                orderMap[m.type].length += 1;\n            }\n        });\n        this.orderMap = orderMap;\n    }\n    // i.e.) getPossibleValues(['a', '1', '가'], 1) => ['1', '3', '6']\n    // output: get possible options for 2nd option dependent on ('a' / 1st option)\n    getPossibleValuesForIndex(selected, targetIndex) {\n        const { options, option_meta, orderMap } = this;\n        if (targetIndex === 0) {\n            return option_meta[0].values;\n        }\n        let filteredOptions = options;\n        option_meta\n            .map((m) => {\n                const order = orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            })\n            .forEach((sel, idx) => {\n                if (idx < targetIndex) {\n                    filteredOptions = filteredOptions.filter((option) => option.values[idx] === sel);\n                }\n            });\n        return _.uniq(filteredOptions.map((o) => o.values[targetIndex])); // FIXME\n    }\n\n    getMultiOptions(selected) {\n        return this.option_meta.map((meta, idx) => {\n            return [meta, this.getPossibleValuesForIndex(selected, idx)];\n        });\n        /*\n        returns [\n            [type, ['a', 'b', 'c']],\n            [type, ['1', '2']],\n            [tyep, ['red', 'white', 'black']]\n        ]\n        */\n    }\n}\n\nexport const MultiOption = (props) => {\n    const { selected, multiOptionState, sid, SizeGuide } = props;\n    if (multiOptionState == null) {\n        return null;\n    }\n    const multiOptions = multiOptionState.getMultiOptions(selected);\n    var sizeGuidePos = -1;\n    if (SizeGuide) {\n        multiOptions.map(([meta, values], idx) => {\n            if (meta.name && meta.name.trim().toLowerCase() === \"size\") sizeGuidePos = idx;\n        });\n        if (sizeGuidePos < 0) sizeGuidePos = multiOptions.length - 1;\n    }\n    return multiOptions.map(([meta, values], idx) => {\n        const { type, name } = meta;\n\n        const indexTypeOf = multiOptionState.orderMap[type] && multiOptionState.orderMap[type][name];\n        const additional = {\n            name,\n            values,\n            indexTypeOf,\n            selectedArray: selected && selected[type],\n            selectedValue: selected && selected[type] && selected[type][indexTypeOf],\n            key: `${sid}-${idx}`,\n            showSizeGuide: idx == sizeGuidePos,\n        };\n        if (type === \"dropdown\") {\n            return <MultiSelectBox {...props} {...additional} />;\n        } else if (type === \"swatch\") {\n            additional.swatch = meta.swatch;\n            return <MultiSwatch {...props} {...additional} />;\n        } else if (type === \"thumbnail\") {\n            additional.thumbnail = meta.thumbnail;\n            return <MultiThumbnail {...props} {...additional} />;\n        } else if (type === \"button\") {\n            return <MultiButton {...props} {...additional} />;\n        }\n    });\n};\n\nexport const MultiSelectBox = (props) => {\n    const { values, name, onMultiSelectBoxChange, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option\">\n            <label>{name}</label>\n            <select\n                onChange={onMultiSelectBoxChange}\n                value={selectedValue}\n                className={values.length <= 1 ? \"one-option\" : undefined}>\n                <MultiSelectBoxOption key={-1} value=\"Please select\" indexTypeOf={indexTypeOf} />\n                {values.map((value, i) => {\n                    return <MultiSelectBoxOption key={i} value={value} indexTypeOf={indexTypeOf} />;\n                })}\n            </select>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSelectBoxOption = (props) => {\n    const { value, indexTypeOf } = props;\n    return (\n        <option data-value={value} data-index-typeof={indexTypeOf} value={value}>\n            {value}\n        </option>\n    );\n};\n\nexport const MultiSwatch = (props) => {\n    const { name, values, swatch, indexTypeOf, selectedValue, onClickSwatch, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option swatch\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiSwatchOption\n                            key={i}\n                            value={value}\n                            swatch={swatch}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            onClick={onClickSwatch}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSwatchOption = (props) => {\n    const { value, swatch, indexTypeOf, selectedValue, onClick } = props;\n    return (\n        <a\n            href=\"#\"\n            style={{ backgroundColor: swatch[value] }}\n            onClick={onClick}\n            data-value={value}\n            data-label={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}\n        />\n    );\n};\n\nexport const MultiThumbnail = (props) => {\n    const { values, name, thumbnail, onClickThumbnail, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n\n    return (\n        <div className=\"multi-option thumbnail\">\n            <label>{name}</label>\n            <span className=\"value\">{selectedValue}</span>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiThumbnailOption\n                            key={i}\n                            onClick={onClickThumbnail}\n                            value={value}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            thumbnail={thumbnail}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiThumbnailOption = ({ onClick, value, indexTypeOf, selectedValue, thumbnail }) => {\n    return (\n        <a\n            href=\"#\"\n            onClick={onClick}\n            data-value={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}>\n            <img\n                src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage: `url(\"${thumbnail[value]}\")`, backgroundSize: \"cover\" }}\n                alt={value}\n            />\n        </a>\n    );\n};\n\nexport const MultiButton = (props) => {\n    const { values, name, onClickMutliButton, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option button\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiButtonOption key={i}\n                            onClick={onClickMutliButton}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            value={value}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiButtonOption = (props) => {\n    const { value, onClick, indexTypeOf, selectedValue } = props;\n    return (\n        <button\n            onClick={onClick}\n            className={selectedValue === value ? \"selected\" : \"\"}\n            data-value={value}\n            data-index-typeof={indexTypeOf}>\n            {value}\n        </button>\n    );\n};\n","import React, { useCallback } from \"react\";\nimport classnames from \"classnames\";\nimport { useDispatch } from \"react-redux\";\nimport { updateSaleContext } from \"../../../../action/action-helpers\";\nimport { getCurrentSaleOption, getWaiting } from \"../../../map\";\nimport { useFancy } from \"../../FancyContext\";\nimport appState from \"../../../../appstate\";\nimport type { SaleOption } from \"ftypes\";\n\ninterface ICartButtonProps {\n  available: boolean;\n  waiting: boolean;\n  soldout: boolean;\n  onPurchase(): React.MouseEventHandler;\n}\n\nconst CartButton: React.FC<ICartButtonProps> = ({ onPurchase }) => {\n  const dispatch = useDispatch();\n  const { thing: { sales }, saleContext } = useFancy();\n\n  const waiting = getWaiting(sales, saleContext);\n  const available = sales.available;\n  const { soldout } = getCurrentSaleOption(sales, saleContext) as SaleOption;\n\n  if (!available) {\n    return <Button\n      className={classnames(\"btn-create not-available\")}\n      label={gettext(\"Not Available\")}\n      disabled={true}\n    />\n  }\n\n  const onNotifyLater = useCallback(\n    (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n      if (!appState.loggedIn) {\n        return window.require_login();\n      }\n      const opt = getCurrentSaleOption(sales, saleContext, true);\n      const params: any = { sale_item_id: sales.id };\n\n      if (opt != null) {\n        params.option_id = opt.id;\n      }\n\n      const waiting = getWaiting(sales, saleContext);\n      if (waiting) {\n        params.remove = 1;\n      }\n\n      $.ajax({\n        type: \"post\",\n        url: \"/wait_for_product.json\",\n        data: params,\n        dataType: \"json\",\n      }).done((json) => {\n        if (!json || json.status_code == null) {\n          return;\n        }\n        if (json.status_code == 0 && json.message) {\n          window.alertify.alert(json.message);\n          return;\n        }\n        const waiting = params.remove ? false : true;\n        dispatch(updateSaleContext({ waiting }));\n      });\n    }\n    , [dispatch, sales, saleContext])\n\n  return <>\n    <Button\n      onClick={onPurchase}\n      className={classnames(\"add_to_cart btn-cart\", {\n        \"btn-create\": soldout,\n        \"btns-blue-embo\": !soldout,\n      })}\n      disabled={!!soldout}\n      label={soldout ? gettext(\"Sold out\") : gettext(\"Add to cart\")}\n    />\n    <Button\n      className={classnames(\"btn-create notify-available\", { subscribed: waiting })}\n      label={waiting ? gettext(\"Subscribed\") : gettext(\"Notify me when available\")}\n      style={!soldout ? { display: \"none\" } : undefined}\n      onClick={onNotifyLater}\n    />\n  </>\n}\n\nconst Button: React.FC<React.ButtonHTMLAttributes<null> & { label: string; }> = ({ ...props }: any) => (\n  <button {...props} label={null}>\n    {props.label}\n  </button>\n);\n\nexport default CartButton;\n","import type { SaleItem } from \"ftypes\";\n\nexport function isOptionMulti(sales: SaleItem): boolean {\n  if (sales.option_meta.length > 1) {\n      return true;\n  } else if (sales.option_meta.length === 1) {\n      return sales.option_meta[0].type !== \"dropdown\";\n  } else {\n      return false;\n  }\n}\n","import React from \"react\";\nimport type { OverlayProps } from \"ftypes\";\nimport { isSalesOptionsAvailable } from \"../../../map\";\nimport { useFancy } from \"../../FancyContext\";\n\nconst ApplePayButton: React.FC<OverlayProps> = () => {\n    const {\n        appContext: { /*applePayDisplay, */ applePayTest },\n        thing,\n        thing: { sales },\n        saleContext: { saleOptionID, selectedQuantity, price },\n    } = useFancy();\n\n    const handleApplePayCheckout : React.MouseEventHandler = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!saleOptionID || window.FancyApplePay.clicked) {\n            return;\n        }\n        window.FancyApplePay.clicked = true;\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n\n        var title = thing.name;\n        var country = sales.seller.country;\n        var sale_item_id = sales.id;\n        var seller_id = sales.seller.id;\n        var quantity = selectedQuantity;\n\n        var option_id = null;\n        var option = null;\n        if (salesOptionsAvailable) {\n            option_id = parseInt(saleOptionID, 10) || null; // ? should be same value with option except get casted\n            option = saleOptionID;\n        }\n\n        try {\n            window.FancyApplePay.requestPurchase(\"Dynamic\", {\n                sale_item_id,\n                seller_id,\n                option_id,\n                quantity,\n                price,\n                title,\n                option,\n                country,\n                testmode: applePayTest,\n            });\n        } catch (err) {\n            window.DEBUG && console.trace(err);\n            alert(err);\n            window.FancyApplePay.clicked = false;\n        }\n    };\n    return (\n        <div\n            className=\"applePayButton\"\n            style={{\n                WebkitAppearance: \"-apple-pay-button\",\n                ApplePayButtonType: \"plain\",\n                ApplePayButtonStyle: \"black\",\n            }}\n            onClick={handleApplePayCheckout}></div>\n    );\n}\n\nexport default ApplePayButton;","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { floatFormatMinusTwo, numberFormat, renderPopup, escapeSelector, getLocationArgPairs } from \"fancyutils\";\n\nimport { convertCurrency, updateSaleContext } from \"../../../../action/action-helpers\";\nimport { updateAppContext } from \"../../../../action/actions\";\nimport { currencyIsUSD, getCurrentSaleOption, getSafeNameProp, isSalesOptionsAvailable } from \"../../../map\";\nimport { Keys } from \"../../../Perf\";\nimport { SelectBox, MultiOption, MultiOptionState } from \"../SaleItemForm\";\nimport type { OverlayProps, ReduxProps, SaleOption, SelectedMetaOption, SaleOptionMeta } from \"ftypes\";\nimport type { ISaleItemSidebarHeadProps, ISaleItemSidebarHeadState } from './type';\nimport CartButton from './CartButton';\nimport { isOptionMulti } from './multiOption';\nimport ApplePayButton from './ApplePayButton';\n\nfunction optionValueFunction(opt) {\n    return opt?.id;\n}\nconst saleNamePrinter = (opt) => `${opt.name} - $${opt.price}`;\n\nconst { Fancy, alertify } = window;\n\nconst Price = ({ discounting, price, retailPrice, discountPercentage }) => {\n    return <div className=\"price\" key={Keys.Sidebar.Price}>\n        <big className={classnames({ sale: discounting })}>\n            ${floatFormatMinusTwo(price)}\n        </big>\n        {discounting && (\n            <span className=\"sales\">\n                <em>${floatFormatMinusTwo(retailPrice)}</em> (Save {numberFormat(discountPercentage, 0)}\n                            %)\n            </span>\n        )}\n    </div>\n}\n\nexport default class SaleItemSidebarHead extends Component<\n    ISaleItemSidebarHeadProps, ISaleItemSidebarHeadState\n> {\n    state = {\n        loading: false,\n        showSelectWarning: false,\n        selected: {},\n        disabled: [],\n        multiOptionState: null,\n    };\n\n    static defaultProps = {\n        showInfo: true,\n    };\n\n    constructor(props: OverlayProps & ReduxProps) {\n        super(props);\n        // for multi options\n        this.onClickThumbnail = this.onClickMultiOptionGen(\"thumbnail\");\n        this.onClickSwatch = this.onClickMultiOptionGen(\"swatch\");\n        this.onMultiSelectBoxChange = this.onClickMultiOptionGen(\"dropdown\");\n        this.onClickMutliButton = this.onClickMultiOptionGen(\"button\");\n    }\n\n    renderCurrencyPopup = () => {\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\").then(({ CurrencyPopup }) => {\n            renderPopup(CurrencyPopup, { currentCurrency: this.props.saleContext.currencyCode });\n        });\n    };\n\n    handleCurrencyPopup = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        this.renderCurrencyPopup();\n    };\n\n    handleCurrencyPopupUSD = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        if (!currencyIsUSD(this.props)) {\n            return false;\n        }\n        this.renderCurrencyPopup();\n    };\n\n    handlePurchase = (event) => {\n        event.preventDefault();\n        const {\n            thing: { sales },\n            saleContext,\n        } = this.props;\n        const saleOption = getCurrentSaleOption(sales, saleContext, true);\n        const soldout = saleOption == null ? sales.soldout : saleOption.soldout;\n        if (soldout || this.state.loading) {\n            return;\n        }\n        const optionIsMulti = isOptionMulti(sales);\n        const saleOptionID = saleOption != null ? saleOption.id : null;\n        if (!optionIsMulti && sales.options.length > 0 && saleContext.saleOptionID === null) {\n            this.setState({ showSelectWarning: true });\n            return;\n        }\n\n        this.setState({ showSelectWarning: false, loading: true }, () => {\n            const payload = {\n                sale_id: sales.id,\n                quantity: saleContext.selectedQuantity,\n                personalization: saleContext.personalization,\n            };\n            if (saleOptionID != null) {\n                payload.option_id = saleOptionID;\n            }\n            Fancy.CartAPI.addItem(payload, (success, json) => {\n                if (success) {\n                    Fancy.Cart.openPopup();\n                } else {\n                    alertify.alert((json && json.error) || \"Failed to add the item to cart. Please contact us at cs@fancy.com if the problem persists.\");\n                }\n                this.setState({ loading: false });\n            })\n        });\n    }\n\n    handleOptionChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        if (!event.currentTarget.value) {\n            dispatch(updateSaleContext({ saleOptionID: null }));\n        } else {\n            const saleOptionID = parseInt(event.currentTarget.value, 10);\n            dispatch(updateSaleContext({ saleOptionID }));\n        }\n    };\n\n    handleQuantityChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const selectedQuantity = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ selectedQuantity }));\n    };\n\n    handlePersonalizationChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const personalization = event.currentTarget.value;\n        dispatch(updateSaleContext({ personalization }));\n    };\n\n    checkApplePay = () => {\n        if (window.FancyApplePay) {\n            const { dispatch, thing, thing: { sales } } = this.props;\n            const os = sales.options.filter((o) => !o.soldout);\n            const data = {\n                total: { label: thing.name, amount: (sales.price * 100) | 0 },\n            };\n\n            if (os.length > 0) {\n                data.displayItems = os.map((o) => ({\n                    label: o.name,\n                    amount: (Number(o.price) * 100) | 0,\n                }));\n            }\n\n            window.FancyApplePay.checkAvailability((available, testmode) => {\n                if (available) {\n                    dispatch(\n                        updateAppContext({\n                            applePayDisplay: true,\n                            applePayTest: testmode,\n                        })\n                    );\n                }\n            }, data);\n        }\n    };\n\n    componentDidMount() {\n        if (!currencyIsUSD(this.props)) {\n            const { saleContext } = this.props;\n            convertCurrency(saleContext.currencyCode, saleContext.price);\n        }\n        this.initializeMultiOption();\n        this.checkApplePay();\n    }\n\n    componentDidUpdate(prevProps: OverlayProps) {\n        if (prevProps.thing.id !== this.props.thing.id) {\n            this.initializeMultiOption();\n            this.checkApplePay();\n            if (this.state.showSelectWarning) {\n                this.setState({\n                    showSelectWarning: false,\n                });\n            }\n            return;\n        }\n\n        const {\n            saleContext,\n            thing: { sales },\n        } = prevProps;\n\n        const nsc = this.props.saleContext;\n        const nextSaleOptionID = nsc.saleOptionID;\n        if (saleContext.saleOptionID !== nextSaleOptionID) {\n            if (this.state.showSelectWarning) {\n                this.setState({ showSelectWarning: false });\n            }\n            const o = _.find(sales.options, (_o) => _o.id === nextSaleOptionID);\n            // option sync\n            if (o) {\n                const mos = $(\".sale-item-input .multi-option\");\n                o.values.forEach((v, i) => {\n                    const $so = mos\n                        .eq(i)\n                        .find(`[data-value=\"${escapeSelector(v)}\"]:not(.selected)`)\n                        .eq(0);\n                    if ($so.length) {\n                        if ($so.is(\"option\"))\n                            $so.prop(\"selected\", true);\n                        else\n                            $so.get(0).click();\n                    }\n                });\n                if (window.FancyApplePay && window.FancyApplePay.paymentRequest) {\n                    window.FancyApplePay.paymentRequest.update({\n                        total: {\n                            label: o.name,\n                            amount: (Number(o.price) * 100) | 0,\n                        },\n                    });\n                }\n            }\n        }\n    }\n\n    initializeMultiOption = () => {\n        const {\n            thing: {\n                sales: { options, option_meta },\n            },\n            saleContext,\n            dispatch,\n        } = this.props;\n\n        this.setState(this.getInitialMultiOptionState(options, option_meta), () => {\n            // don't block selecting cheapest item\n            if (!(options && options.length > 1)) {\n                this.updateSaleOptionIDFromMultiOptionState();\n            }\n            // ?option={number} support\n            const presetOptionId = getLocationArgPairs(\"option\");\n            if (presetOptionId && presetOptionId[1] && String(saleContext.saleOptionID) !== presetOptionId[1]) {\n                dispatch(updateSaleContext({ saleOptionID: parseInt(presetOptionId[1], 10) }));\n            }\n        });\n    };\n\n    getInitialMultiOptionState(options: SaleOption[], option_meta: SaleOptionMeta[]) {\n        const selected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        if (option_meta.length > 0) {\n            const nonSoldout = options.filter((o) => o.quantity !== 0);\n            if (nonSoldout.length !== 0) {\n                const selectedNonSoldoutOption = nonSoldout[0]; // temporary - FIXME\n                option_meta.forEach(function (opt, i) {\n                    const { type } = opt;\n                    const nextValue = selectedNonSoldoutOption.values[i];\n                    selected[type].push(nextValue);\n                });\n            } else {\n                // set first available multi option\n                option_meta.forEach(function (opt) {\n                    const { type } = opt;\n                    const nextValue = opt.values[0];\n                    selected[type].push(nextValue);\n                });\n            }\n        }\n        const multiOptionState = new MultiOptionState(options, option_meta);\n        return { selected, multiOptionState };\n    }\n\n    extractSaleOptionIDFromMultiOptionState = (selected?: SelectedMetaOption) => {\n        const {\n            thing: { sales },\n        } = this.props;\n        if (selected == null) {\n            selected = this.state.selected;\n        }\n        const { multiOptionState } = this.state;\n\n        const selectedOptionArray = multiOptionState.option_meta\n            .map((m) => {\n                const order = multiOptionState.orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            });\n        const selectedOption = _.find(sales.options, (opt) => selectedOptionArray.every((e, i) => e === opt.values[i]));\n        if (selectedOption) {\n            return selectedOption.id;\n        } else {\n            window.DEBUG &&\n                console.warn(\"no option found for \", selectedOptionArray, \"meta:\", sales.options, this.state.selected);\n        }\n    };\n\n    updateSaleOptionIDFromMultiOptionState = () => {\n        const { dispatch } = this.props;\n        let saleOptionID = this.extractSaleOptionIDFromMultiOptionState();\n        if (saleOptionID === undefined) {\n            const amendedID = this.amendSaleOptionFromMultiOptionState();\n            if (amendedID) {\n                saleOptionID = amendedID;\n            } else {\n                window.DEBUG && console.warn(\"Couldn't recover option\");\n            }\n        }\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    amendSaleOptionFromMultiOptionState = () => {\n        const { selected, multiOptionState } = this.state;\n        const nextSelected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        multiOptionState.option_meta.forEach(({ type, name }, index) => {\n            const order = multiOptionState.orderMap[type][name];\n            const selectedValue = selected[type][order];\n            if (index === 0) {\n                nextSelected[type][order] = selectedValue;\n                return;\n            }\n            const values = multiOptionState.getPossibleValuesForIndex(selected, index);\n            let value;\n            if (values.some((v) => v === selectedValue)) {\n                value = selectedValue;\n            } else {\n                value = values[0];\n            }\n            selected[type][order] = value; // even though it will be flushed out, it will affect next options so fix it as well\n            nextSelected[type][order] = value;\n        });\n        this.setState({ selected: nextSelected });\n        return this.extractSaleOptionIDFromMultiOptionState(nextSelected);\n    };\n\n    onClickMultiOptionGen = (type) => {\n        return (e) => {\n            const el = e.currentTarget;\n            let value;\n            let indexOfType;\n            if (el.tagName === \"SELECT\") {\n                value = el.value;\n                indexOfType = Number($(el).find(\":selected\").attr(\"data-index-typeof\"));\n            } else {\n                value = $(el).attr(\"data-value\");\n                indexOfType = Number($(el).attr(\"data-index-typeof\"));\n            }\n            if (e.currentTarget.className === \"disabled\") {\n                return;\n            }\n\n            this.state.selected[type][indexOfType] = value;\n            // forceful trigger even though no differences in value.\n            this.setState({ selected: _.extend({}, this.state.selected) }, this.updateSaleOptionIDFromMultiOptionState);\n        };\n    };\n\n    UNSAFE_componentWillReceiveProps(nextProps) {\n        const { saleContext } = this.props;\n        const nsc = nextProps.saleContext;\n        const priceChanges = saleContext.price !== nsc.price;\n        const currencyChanges = saleContext.currencyCode !== nsc.currencyCode;\n        if (priceChanges || currencyChanges) {\n            if (!currencyIsUSD(nextProps)) {\n                const { saleContext } = nextProps;\n                convertCurrency(saleContext.currencyCode, saleContext.price, true); // FIXME: unable to comparison since price update comes first (SaleItemSidebarHead.componentWillReceiveProps())\n            }\n        }\n    }\n\n    render() {\n        const {\n            thing,\n            thing: { sales },\n            appContext: { applePayDisplay },\n            saleContext,\n            saleContext: { selectedQuantity, price },\n            showInfo,\n        } = this.props;\n        const { showSelectWarning } = this.state;\n\n        const opt = getCurrentSaleOption(sales, saleContext) as SaleOption;\n        const discountPercentage = parseFloat(opt.discount_percentage); // TODO: use decimal?\n        const retailPrice = opt.retail_price;\n        const { soldout, quantity } = opt;\n        const { option_meta } = sales;\n        const optionIsMulti = isOptionMulti(sales);\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n        const discounting = discountPercentage > 0;\n        const quantitySelectRange = soldout\n            ? [\"1\"]\n            : _.range(1, Math.min(10, (quantity || 0) + 1));\n        const showSelectbox = sales.options.length !== 0;\n\n        var applePayButton;\n        if (applePayDisplay && !soldout) {\n            applePayButton = <ApplePayButton {...this.props} />;\n        }\n\n        return (\n            <>\n                {showInfo ? <>\n                    <h1 key={Keys.Sidebar.Title} className=\"title\" {...getSafeNameProp(thing)} />\n                    <Price {...{ discounting, price, retailPrice, discountPercentage }} />\n                </> : null}\n                <div className=\"frm\" key={Keys.Sidebar.Form}>\n                    <fieldset className=\"sale-item-input\">\n                        {showSelectbox && !optionIsMulti && (\n                            <SelectBox\n                                className=\"multi-option\"\n                                id=\"option\"\n                                label={gettext(\"Option\")}\n                                currentValue={(opt.soldout || saleContext.saleOptionID !== null) ? opt : \"\"}\n                                value={optionValueFunction}\n                                printer={saleNamePrinter}\n                                options={sales.options}\n                                unselectedLabel=\"Please select\"\n                                expander={SaleItemOptionsExpander}\n                                disabled={!salesOptionsAvailable}\n                                onChange={this.handleOptionChange}\n                                showSelectWarning={showSelectWarning}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                            />\n                        )}\n                        {optionIsMulti && (\n                            <MultiOption\n                                sid={sales.id}\n                                onClickThumbnail={this.onClickThumbnail}\n                                onClickSwatch={this.onClickSwatch}\n                                onMultiSelectBoxChange={this.onMultiSelectBoxChange}\n                                onClickMutliButton={this.onClickMutliButton}\n                                selected={this.state.selected}\n                                disabled={this.state.disabled}\n                                soldout={!!soldout}\n                                option_meta={option_meta}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                                multiOptionState={this.state.multiOptionState}\n                            />\n                        )}\n                        {sales.personalizable && (\n                            <div className=\"personalization\">\n                                <label>This item can be personalized:</label>\n                                <input\n                                    type=\"text\"\n                                    className=\"text\"\n                                    name=\"personalization\"\n                                    placeholder=\"Personalization details\"\n                                    onChange={this.handlePersonalizationChange}\n                                />\n                            </div>\n                        )}\n                        <SelectBox\n                            id=\"quantity\"\n                            className=\"multi-option\"\n                            label={gettext(\"Quantity\")}\n                            defaultValue=\"1\"\n                            currentValue={selectedQuantity}\n                            options={quantitySelectRange}\n                            disabled={!!soldout}\n                            onChange={this.handleQuantityChange}\n                        />\n                        {applePayButton}\n                        {showSelectWarning && <div className=\"error\">Please select from the available option</div>}\n                        <CartButton onPurchase={this.handlePurchase} />\n                    </fieldset>\n                </div>\n            </>\n        );\n    }\n}\n\n\nfunction SaleItemOptionsExpander(sio, idx) {\n    return (\n        <option value={sio.id} key={`sale_options-${idx}`}>\n            {sio.soldout === true || !(sio.quantity > 0) ? `${sio.name} - ${gettext(\"Sold out\")}` : sio.name}\n        </option>\n    );\n}\n","// Warning: objects has to be flat in each context\nexport function getInitialStoreState(contextName: 'appContext' | 'thing' | 'followContext' | 'fancyContext' | 'saleContext' | 'slideContext') {\n    switch(contextName) {\n    case 'appContext':\n        return {\n            visible: false,\n            viewer: {},\n            loggedIn: null,\n            userCountry: 'US',\n            applePayDisplay: false,\n            applePayTest: false,\n        };\n    case 'thing':\n        return {\n            data: null,\n            ID: null,\n            pendingID: null,\n            isFetching: null,\n            status: 'idle' // { idle | request | failed }\n        };\n    case 'followContext':\n        return {\n            id: null,\n            followStore: {\n                following: undefined,\n                loading: false,\n            },\n            followUser: {\n                following: undefined,\n                loading: false,\n            },\n        };\n    case 'fancyContext':\n        return {\n            id: null,\n            fancyd_count: 0,\n            fancyd: false,\n            loading: false,\n            status: 'Idle', // { Idle | Addition | Removal | After- } - Fancy'd status for animation control \n        };\n    case 'saleContext':\n        return {\n            selectedQuantity: 1,\n            saleOptionID: null, // `thing.id`? | `sio.id`?\n            currencyCode: null, // props.thing.currency_code\n            currencyMoney: null, //\n            currencySymbol: null, //\n            price: null, // (props.thing.sales_available && props.thing.sales.price) || null,\n            personalization: null,\n        };\n    case 'slideContext':\n        return {\n            id: null,\n            thumbnailIndex: 0,\n        };\n    default:\n        console.warn('`getInitialStoreState()`: Unknown context name ', contextName);\n    }\n};\n\nvar contexts = [\n    'slideContext',\n    'saleContext',\n    'fancyContext',\n    'followContext',\n    'thing',\n    'appContext'\n];\n\nexport function getAllInitialStoreState() {\n    return contexts.reduce((state, contextKey) => {\n        state[contextKey] = getInitialStoreState(contextKey);\n        return state;\n    } , {});\n}\n","// -- Members --\n// className: string\n// - class name that used from sidebar head 'wrapper figure-info {className}'.\n// type: string\n// - meta string that indicates type name\nimport { mergeObjectArgs } from 'fancyutils';\n\nexport class ThingTypeMeta {\n    static isSale = false;\n    static type = 'ThingTypeMeta';\n\n    getName(thingContext) {\n        return thingContext.name;\n    }\n}\n\nexport class PlainThingType extends ThingTypeMeta {\n    static className = '';\n    static type = 'PlainThing';\n    static createEmptyObject(...args) {\n        const objectArgs = mergeObjectArgs(args);\n        const thing = $.extend(true, {\n            id: '1',\n            url: '/',\n            isCrawled: false,\n            owner: {},\n            image: { src: '', width: 1, height: 1 },\n            user: {},\n            type: 'thing',\n            fancyd_friends: [],\n        }, objectArgs);\n        thing.META = getThingType(thing);\n        return thing;\n    }\n}\n\nexport class SaleItemType extends ThingTypeMeta {\n    static className = '';\n    static type = 'SaleItem';\n    static getName(thingContext) {\n        return thingContext.sales.name;\n    }\n    static createEmptyObject(objectArgs) {\n        return PlainThingType.createEmptyObject({\n            sales_available: true,\n            sales: {\n                id: '1',\n                review_rating: 1,\n                review_count: 1,\n                size_chart_ids: ['1'],\n                images: [{ src: '', width: 1, height: 1 }],\n                seller: { id: '1' }\n            },\n            type: 'sales'\n        }, objectArgs);\n    }\n}\n\nexport class GiftcardType extends SaleItemType {\n    static className = 'giftcard';\n    static type = 'Giftcard';\n\n    static getName() {\n        return window.gettext(\"Fancy Gift Card\");\n    }\n}\n\nexport class HotelType extends SaleItemType {\n    static className = 'hotel';\n    static type = 'Hotel';\n\n    static getName(thingContext) {\n        return thingContext.hotel_search.hotel.name;\n    }\n}\n\nexport class VanityType extends SaleItemType {\n    static className = 'vanity';\n    static type = 'Vanity';\n}\n\nexport class LaunchAppType extends ThingTypeMeta {\n    static className = '';\n    static type = 'LaunchApp';\n}\n\n// Retrieve meta by looking up thing object.\nexport function getThingType(thingContext) {\n    var ThingType;\n    if (thingContext.hotel_search) {\n        ThingType = HotelType;\n    } else if (thingContext.has_launch_app && thingContext.metadata) {\n        ThingType = LaunchAppType;\n    } else if (thingContext.type === 'giftcard') {\n        ThingType = GiftcardType;\n    } else if (thingContext.sales_available) {\n        if (thingContext.type === 'vanity_number') {\n            ThingType = VanityType;\n        } else {\n            ThingType = SaleItemType;\n        }\n    } else {\n        ThingType = PlainThingType;\n    }\n    return ThingType;\n}\n\nconst ThingTypes = [PlainThingType, SaleItemType, GiftcardType, HotelType, VanityType, LaunchAppType];\n\n// TODO: immutable\nThingTypes.forEach(AttachingType => {\n    ThingTypes.forEach(ComparingType => { \n        AttachingType[ComparingType.type] = AttachingType === ComparingType;\n    });\n});\n","import { combineReducers } from \"@reduxjs/toolkit\";\nimport { extractMetaFromURL, /*getConciseNumberString,*/ update, updateShallow } from \"fancyutils\";\n\nimport C from \"./action/action-constants\";\nimport { getInitialStoreState } from \"./store/initial-store\";\nimport { getFirstSaleOption, setWaiting } from \"./components/map\";\nimport { updateState } from \"./appstate\";\nimport { scrollEvent } from \"./container/entry-events\";\nimport { getThingType } from \"./ThingTypes\";\nimport { cache } from \"./cache\";\n\nvar loaded = false;\nvar lastFullyRenderedThingID = 0;\nfunction appContext(state = getInitialStoreState(\"appContext\"), action) {\n    switch (action.type) {\n        case C.OPEN_THING:\n            scrollEvent.visible = true;\n            return updateShallow(state, {\n                visible: true,\n            });\n        case C.CLOSE_THING:\n            scrollEvent.visible = false;\n            lastFullyRenderedThingID = 0;\n            loaded = false;\n            return updateShallow(state, {\n                visible: false,\n                lastFullyRenderedThingID,\n            });\n        case C.UPDATE_APP_CONTEXT:\n            return updateShallow(state, action.context);\n        case C.LOAD_THING: {\n            // Due to multi-stage rendering (cache -> from-server-data -> ...)\n            // it is unable to check state change correctly just by comparing ID;\n            // Therefore, we set internal state per every update cycle and check\n            // if state is fully updated.\n\n            // FIXME: when cached response exist, it marks as rendered before\n            if (loaded === true && lastFullyRenderedThingID !== action.data.id && action.data.fromServer) {\n                lastFullyRenderedThingID = action.data.id;\n            }\n\n            const loggedIn = window.__FancyUser.loggedIn;\n            const viewer = action.data.viewer || {};\n            const userCountry =\n                $.cookie.get(\"shipping_country_code\") || action.data.current_country_code || state.userCountry;\n\n            updateState(\"loggedIn\", loggedIn);\n            updateState(\"viewer\", viewer);\n            loaded = true;\n\n            return update(state, { lastFullyRenderedThingID, loggedIn, viewer, userCountry });\n        }\n        default:\n            return state;\n    }\n}\n\nfunction populateThingContext(thingData) {\n    thingData.loading = thingData.fromServer !== true;\n    thingData.META = getThingType(thingData);\n    thingData.URLMeta = extractMetaFromURL(location.href); // FIXME: provide current pathname\n    thingData.owner = thingData.user;\n}\n\n// Thing context\nfunction thing(state = getInitialStoreState(\"thing\"), action) {\n    switch (action.type) {\n        case C.LOAD_THING:\n            populateThingContext(action.data);\n            return updateShallow(state, {\n                data: action.data,\n                status: action.status,\n                ID: action.ID,\n                pendingID: null,\n                isFetching: false,\n            });\n        case C.REQUEST_THING:\n            return update(state, {\n                pendingID: action.pendingID,\n                status: action.status,\n                isFetching: true,\n            });\n        case C.REQUEST_THING_FAILURE:\n            return update(state, {\n                status: action.status,\n                isFetching: false,\n            });\n\n        // Reset state\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"thing\"));\n        default:\n            return state;\n    }\n}\n\n// Follow contexts\nfunction followContext(state = getInitialStoreState(\"followContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"), {\n                id: action.data.id,\n                followStore: {\n                    following: action.data.sales\n                        ? Boolean(action.data.sales.seller && action.data.sales.seller.seller_follow)\n                        : false,\n                    loading: false,\n                },\n                followUser: {\n                    following: action.data ? Boolean(action.data.following) : false,\n                    loading: false,\n                },\n            });\n\n        // Sidebar\n        // Follow seller/user\n        case C.TOGGLE_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: true,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.CANCEL_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.COMPLETE_FOLLOW:\n            if (action.followType === \"followStore\") {\n                cache.update(state.id, undefined, \"sales.seller.seller_follow\", state[action.followType].following);\n            }\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: state[action.followType].following,\n                },\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"));\n        default:\n            return state;\n    }\n}\n\n/*\nfunction getFancyStatus(nextFancydState) {\n    return nextFancydState ? FancyStatus.Addition : FancyStatus.Removal;\n}\nfunction getCompletionIdleStatus(currentFancyState) {\n    const prevFancyState = !currentFancyState;\n    return prevFancyState ? FancyStatus.AfterRemoval : FancyStatus.AfterAddition;\n}*/\n\nfunction fancyContext(state = getInitialStoreState(\"fancyContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            // Extract thing data for initial thing context data reset.\n            // onFancyButtonUpdate(action.data.id, action.data.fancyd, getConciseNumberString(action.data.fancyd_count));\n            return updateShallow(getInitialStoreState(\"fancyContext\"), {\n                id: action.data.id,\n                fancyd: action.data.fancyd,\n                fancyd_count: action.data.fancyd_count,\n                loading: false,\n                //status: FancyStatus.Idle,\n            });\n        case C.TOGGLE_FANCY:\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: true,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: true,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        case C.CANCEL_FANCY: {\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: false,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: false,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        }\n        // Update data\n        case C.COMPLETE_FANCY:\n            // cache.update(state.id, undefined, \"fancyd\", state.fancyd);\n            // cache.update(state.id, undefined, \"fancyd_count\", action.fancyd_count);\n            // onFancyButtonUpdate(state.id, state.fancyd, getConciseNumberString(action.fancyd_count));\n            // return update(state, {\n            //     loading: false,\n            //     fancyd_count: action.fancyd_count,\n            //     //status: getCompletionIdleStatus(state.fancyd)\n            // });\n            return {\n                ...state,\n                ...{\n                    loading: false,\n                    fancyd_count: action.fancyd_count,\n                    //status: getCompletionIdleStatus(state.fancyd)\n                },\n            };\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"fancyContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction slideContext(state = getInitialStoreState(\"slideContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"), {\n                id: action.data.id,\n            });\n        case C.SET_THUMBNAIL_INDEX:\n            return update(state, {\n                thumbnailIndex: action.thumbnailIndex,\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction saleContext(state = getInitialStoreState(\"saleContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING: {\n            // Extract thing data for initial thing context data reset.\n            const thing = action.data;\n            const sales = thing && thing.sales;\n            const saleOptionInclSales = getFirstSaleOption(sales);\n            const nextContext = {\n                selectedQuantity: 1,\n                // saleOptionID: (saleOptionInclSales && saleOptionInclSales.id) || null,\n                saleOptionID: null,\n                currencyCode: action.data.currency_code,\n                price: (saleOptionInclSales && saleOptionInclSales.price) || null,\n                waiting: null,\n            };\n            return updateShallow(getInitialStoreState(\"saleContext\"), nextContext);\n        }\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"saleContext\"));\n        case C.UPDATE_SALE_CONTEXT: {\n            // Setting waiting\n            if (action.waiting != null) {\n                setWaiting(state.saleOptionID, action.waiting);\n            }\n\n            let waiting = action.waiting;\n            // Reset quantity / Change waiting if option is changed.\n            if (action.saleOptionID != null && action.saleOptionID !== state.saleOptionID) {\n                action.selectedQuantity = 1;\n                waiting = null;\n            }\n\n            const nextContext = {\n                selectedQuantity: action.selectedQuantity,\n                saleOptionID: action.saleOptionID, // `thing.id`? | `sio.id`?\n                price: action.price, // (props.thing.sales_available && props.thing.sales.price) || null,\n                // UI\n                currencyCode: action.currencyCode, // props.thing.currency_code\n                currencyMoney: action.currencyMoney, //\n                currencySymbol: action.currencySymbol, //\n                personalization: action.personalization,\n                waiting,\n            };\n            return update(state, nextContext);\n        }\n        default:\n            return state;\n    }\n}\n\n/*\nfunction checkNotImplementedWithURLExceptionRule(META) {\n    if (['Fancybox', 'Hermes'].some(type => META[type])) {\n        window.location.reload()\n    }\n}*/\n\nconst rootReducer = combineReducers({\n    appContext,\n    // Thing contexts\n    followContext,\n    fancyContext,\n    slideContext,\n    saleContext,\n    // etc.\n    thing,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import { configureStore } from \"@reduxjs/toolkit\";\nimport thunk from \"redux-thunk\";\nimport logger from 'redux-logger'\n\nimport { getAllInitialStoreState } from \"./initial-store\";\nimport rootReducer from \"../reducers\";\n// import type { RootState } from '../reducers';\n\nconst middlewares = [thunk];\nif (process.env.NODE_ENV !== 'production') {\n    middlewares.push(logger);\n}\n\nconst store = configureStore({\n    reducer: rootReducer,\n    preloadedState: getAllInitialStoreState(),\n    middleware: (getDefaultMiddleware) =>\n        getDefaultMiddleware({\n            serializableCheck: false,\n        }).prepend(middlewares),\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport default store;\n"],"sourceRoot":""}
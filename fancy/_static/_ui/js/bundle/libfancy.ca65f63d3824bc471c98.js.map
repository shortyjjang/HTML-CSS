{"version":3,"sources":["webpack://fancy/./_static/modules/libf/DOMHelper.ts","webpack://fancy/./_static/modules/libf/FancyMixin.js","webpack://fancy/./_static/modules/libf/PopupHelper.js","webpack://fancy/./_static/modules/libf/CDNUtils.js","webpack://fancy/./_static/modules/libf/CopyToClipboard.js","webpack://fancy/./_static/modules/libf/FancyUtils.ts","webpack://fancy/./_static/modules/libf/common-components/Video.js","webpack://fancy/./_static/modules/libf/common-components/MoreShareUtils.js","webpack://fancy/./_static/modules/libf/common-components/SharePopover.js","webpack://fancy/./_static/modules/libf/common-components/AddlistPopover.js","webpack://fancy/./_static/modules/libf/common-components/Popup.js","webpack://fancy/./_static/modules/libf/common-components/MoreShare.js","webpack://fancy/./_static/modules/libf/common-components/MoreShareFacade.js","webpack://fancy/./_static/modules/libf/common-components/AddlistAction.js","webpack://fancy/./_static/modules/libf/common-components/History.ts","webpack://fancy/./_static/modules/libf/common-components/ProductSlide.js"],"names":["jsRender","Component","data","targetElement","callback","rEl","React","ReactDOM","RenderModes","Prepend","rctElDomRef","$","prependTo","Append","appendTo","After","insertAfter","Before","insertBefore","Replace","replaceWith","externalRender","mode","FACTORY_DIV_REF","document","createElement","id","body","appendChild","rctElRef","cs","children","length","console","warn","Element","remove","mountToDisposable","unmountedDOM","$disposable","find","eq","empty","style","append","Display","None","display","Block","Inline","InlineBlock","NoneIf","cond","undefined","BlockIf","InlineIf","InlineBlockIf","BGImage","alt","className","schemeless","url","backgroundImage","getSchemelessURL","src","getElementGapFromHeader","measurePointElement","$headerFeatured","destHeight","height","attr","scrollTop","offset","top","selectPopup","popupName","dialog","openPopup","bindOverlayData","popup","$obj","one","this","open","closePopup","close","popupContainer","getElementById","renderPopup","PopupComponent","attrs","openOnMount","name","selectOrCreate","match","cdnUtils","makeServer","type","template","HOSTS","push","size","method","isSchemeless","cdn","resizeUrl","parts","window","parseURL","fixedName","test","pathname","path","getCDNURL","protocol","hostname","candidates","replace","THEFANCY_MEDIA","THINGD_MEDIA","FANCY_WEB","RESIZE_IMAGE","STATICFILES","str","i","c","sum","charCodeAt","sumChars","getResizeURL","copyToClipboard","text","options","cb","reselectPrevious","range","selection","mark","Function","prototype","deselectCurrent","createRange","getSelection","textContent","whiteSpace","selectNode","addRange","execCommand","clipboardData","setData","err","removeRange","removeAllRanges","removeChild","_","padStart","max","mask","cur","masked","filler","String","slice","zfill","selector","attrValue","container","element","classNames","split","filter","e","join","substr","Error","target","get","requestIdleCallback","args","setTimeout","Number","isNaN","value","isInteger","isFinite","Math","floor","thingRegex","extractMetaFromURL","stripDomain","ret","href","stripURL","articleRegex","extractMetaFromArticleURL","parser","a","setAttribute","createElementParser","result","search","hash","indexOf","getObjectTypeFromUrl","getPathname","aElement","location","stripped","floatFormatMinusTwo","number","num","numberFormat","splitted","isEmpty","obj","Array","Object","getOwnPropertyNames","setCaretPos","position","focus","setSelectionRange","createTextRange","moveEnd","collapse","select","getCaretPos","selectionStart","moveStart","_isHomepage","_isStream","KEYS","TAB","ENTER","SPACE","ESC","UP","DOWN","LEFT","RIGHT","SEMICOLON","COMMA","triggerEvent","DOMRef","eventName","event","CustomEvent","Event","dispatchEvent","update","state","next","extend","apply","updateShallow","getDisplay","stripTags","html","div","innerHTML","innerText","isPlainLeftClick","button","altKey","metaKey","ctrlKey","shiftKey","isHomepage","isStream","testLegacyContextLocation","promisifiedFetchImage","resolveCallback","timeout","deferred","Deferred","then","resolve","img","Image","onload","onerror","debounceUntilTimeout","fun","delay","timer","context","clearTimeout","unshift","bind","debounceEventUntilTimeout","eventHandler","persist","numberUnitPostfixes","getConciseNumberString","_num","isNumber","pos","toFixed","decimals","decPoint","thousandsSep","abs","sign","intPartNum","parseInt","intPart","j","proportionFormat","isFixed","isStaticPage","isStaticArticlePage","index","is","log","isVisible","elm","vpH","st","$elm","elementHeight","y","dedupeArray","vals","sort","reduce","b","getFancyDepsRoot","eitherFancy","namespace","doWith","Deps","didClickOn","$targ","parents","xmlUtil","isSuccess","xml","sc","isFail","MP","track_event","getLocationArgPairs","key","originalArgStr","argStr","map","some","argPair","formatDuration","val","remainder","seconds","minmax","lb","ub","min","mergeObjectArgs","p","n","ClickOutside","component","popupElementRefKey","closePopupFunction","attached","eventKey","handleDetach","on","isTrigger","contains","startingElement","start","documentElement","parentElement","closestUntil","off","random","toString","isClipboardSupported","queryCommandSupported","convertThingsV1ToRest","things","thing","converted","assign","sales_available","id_str","fancyd","thumb_image_url_310","thumb_image_url_558","fancyd_count","fancys","image","image_url","width","image_url_width","image_url_height","owner","user","html_url","fancyd_users","sales","isSaleResponse","sale_id","quantity","remaining_quantity","price","fancy_price","available_for_sale","isCrawled","isElementOutsideViewport","excludingElement","elementRect","getBoundingClientRect","upperBound","leftBound","exclusionRect","bottom","right","lowerBound","innerHeight","clientHeight","rightBound","innerWidth","clientWidth","left","_FancyUser","loggedIn","merchant","__FancyUser","FancyUser","locationHostname","stripPathname","sp","cartesianProductOf","flatten","x","concat","jQueryPromiseAll","arrayOfPromises","jQuery","when","call","arguments","_loaded","loadCss","AppName","B","Bundle","cssToLoad","nextUrl","pop","head","isSafari_cac","alertify","alert","prompt","message","fn","placeholder","cssClass","msg","confirm","set","labels","ok","cancel","escapeSelector","sel","ch","asCodePoint","isSafari","navigator","userAgent","getVideo","object","h264_1000k_url","saleVideo","video","thingOrArticleVideo","video_cover","cover_video","outputs","h264_1000k","metadata","video_url","thumbnail_url","original_url","Video","props","Date","original","loop","nextProps","lastFullyRenderedObjectID","playing","domCls","$el","getSrc","getLoop","currentTime","getThumbnail","videoEl","el","prevProps","np","pause","play","prepare","ref","thingHasVideo","article","status","ShareObjectTypes","list","store","getShareURL","loading","referrerURL","originalUrl","viewerUsername","objectId","objectType","objectMeta","slug","connector","createReferredUrl","post","done","res","setState","short_url","fail","SNSDict","followingUsers","followingUsersRequested","ViewClasses","SharePopover","friendSearchQuery","searchedFriends","selectedUserID","sentUser","sendNote","sendSuccess","searching","isContact","profile_image_url","fullname","username","preventDefault","clearFriendList","handleHide","prevQuery","searchFriends","title","sending","mailUser","handleSendMail","params","user_id","trim","json","status_code","sentUserID","xhr","always","object_type","email_address","object_id","object_meta","responseObject","JSON","parse","responseText","statusText","additionals","excludes","nextState","forEach","excludeKey","nextID","currentTarget","getSearchedFriends","loadingDisplayUsers","users","forceUpdate","isInputEmail","getSharedMailUser","isEmailOnlyMode","term","filter_messages_permission","showShare","getDisplayUsers","headerGap","emptyClassName","searchedFriendsDisplay","selectedUser","getSelectedUser","getSentUser","emptyDisplay","inputIsEmail","emailOnlyMode","noteSendable","isSNS","sentMessage","gettext","classnames","bot","getShareMessage","onClick","autoComplete","onChange","handleFriendSearch","idx","imgClass","toLowerCase","prefix","getPrefix","handleUserSelect","data-userid","handleClickContactImport","handleContinue","handleSendNoteInput","disabled","handleSend","SNSShareBox","showShareBox","handleClickBackFromContact","defaultMessage","shareMessage","copied","textboxDisplay","updateEmbedOption","$ep","removeClass","prop","detail","faintClick","snsShareWindow","getAttribute","getRefURL","directClick","$li","$thumb","$options","types","each","checked","addClass","snippet","handleShare","encodeURI","handleEmbed","AddlistPopover","lists","wanted","listSearchQuery","listCreationQuery","createListFocused","setStateSafe","which","merchantId","createList","drawUserList","quickCreateList","stopPropagation","targ","owned","dataLayer","ajax","error","isChecked","selectedListId","collectionAction","theList","updateList","unchecked","listId","mounted","selected_object_id","collections","selected","tid","$html","$items","end","item","$item","getListCheckbox","listDrawn","pp","showList","listSearchInput","handleListSearch","htmlFor","isWishlistQuery","handleWishlistCheckboxChange","isString","ident","data-listid","handleListCheckboxChange","handleCreateListLabelClick","onBlur","handleCreateListBlur","onKeyUp","handleListCreation","handleCreateListQueryChange","list_name","reaction","collectionId","add","action","checked_list_ids","unchecked_list_ids","FancydPerson","following","dataType","nextFollowing","$status","require_login","isAddedUser","viewerId","handleTransition","user_square_image_small","full_name","handleFollow","FancydByPopup","getFollowList","_getInitialState","nextPage","ended","added_user","reset","immediateNextStateUpdate","thing_id","page","has_next","max_page","current_page","saved_users","__last_tid","handleMore","FancydByPopupV4","next_cursor","keys","toggleShow","toggleKeys","MoreShare","showMenu","linkCopied","moreMenuButton","handleHook","showSellerList","removeViewportCheck","viewPortChecking","evtName","$root","MoreShareEl","headerEl","handleShareDisplay","onShowSomething","linkCopiedRemovalTimer","clickOutside","facadeShowShare","facadeShowList","handleMoreShareToggle","destroy","ps","ns","handleAttach","checkViewport","componentClass","btnClass","showShortcuts","fromThingSidebar","isThing","isArticle","showMerchantList","shouldShowMerchantCollection","newLayout","data-rendered","opened","handleFancydByDisplay","handleListDisplay","handleMerchantListDisplay","opacity","handleCopyLink","handleHideList","handleHideShare","MoreShareFacade","share","FakeMoreShare","onClickShare","handleClickShare","onClickAddlist","handleClickList","AddlistAction","via","product_id","products_info","products","revenue","option_id","history","createHistory","applyProductSlide","initSlide","option","$slide","$list","itemWidth","$prev","$next","slideWidth","getPrevLeft","css","prepareCount","ceil","last","clone","first","preparePrev","getNextLeft","listWidth","spare","prepareNext","clearOld","prevCnt","itemPerSlide","center","scrollLeft","hide","$this","hasClass","animate","productSlide"],"mappings":"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","file":"libfancy.ca65f63d3824bc471c98.js","sourcesContent":["import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\n// render without using JSX\nexport function jsRender(Component: React.ComponentClass<{}, any>, data = {}, targetElement: Element, callback = () => {}) {\n    const rEl = React.createElement(Component, data);\n    return ReactDOM.render(rEl, targetElement, callback);\n}\n\n// Render to specific element position with a wrap.\n// function wrappedRenderCreator(\n//     $WrapperMethodKey/* appendTo, prependTo, insertAfter, insertBefore, ... */,\n//     Component,\n//     data,\n//     targetElement,\n//     wrapElementTag='div',\n//     callback\n// ) {\n//     let wrapper = $(`<${wrapElementTag} />`)[$WrapperMethodKey](targetElement).get(0);\n//     return function renderAfter() {\n//         return jsRender(Component, data, wrapper, callback);\n//     };\n// }\n\nfunction Prepend(rctElDomRef: Element, targetElement: Element) {\n    $(rctElDomRef).prependTo(targetElement);\n}\nfunction Append(rctElDomRef: Element, targetElement: Element) {\n    $(rctElDomRef).appendTo(targetElement);\n}\nfunction After(rctElDomRef: Element, targetElement: Element) {\n    $(rctElDomRef).insertAfter(targetElement);\n}\nfunction Before(rctElDomRef: Element, targetElement: Element) {\n    $(rctElDomRef).insertBefore(targetElement);\n}\nfunction Replace(rctElDomRef: Element, targetElement: Element) {\n    $(targetElement).replaceWith(rctElDomRef);\n}\n\nexport const RenderModes = {\n    Prepend,\n    Append,\n    After,\n    Before,\n    Replace\n};\n\ntype RenderModeMethods = typeof Prepend | typeof Append | typeof After | typeof Before | typeof Replace;\n\nconst FACTORY_DIV_ID = \"__external_render_factory__\";\n// Warning: this works until React 16, and it could get broken at some point.\nexport function externalRender(\n    mode: RenderModeMethods,\n    Component: React.ComponentClass,\n    data: Object,\n    targetElement: Element,\n    callback?: Function\n) {\n    const FACTORY_DIV_REF = document.createElement(\"div\");\n    FACTORY_DIV_REF.id = FACTORY_DIV_ID;\n    document.body.appendChild(FACTORY_DIV_REF);\n    const rctElRef = jsRender(Component, data, FACTORY_DIV_REF);\n    let rctElDomRef;\n    if (rctElRef) {\n        // non-stateless component\n        rctElDomRef = ReactDOM.findDOMNode(rctElRef);\n    } else {\n        // Stateless component\n        const cs = FACTORY_DIV_REF.children;\n        if (cs.length === 0) {\n            console.warn(\"externalRender: There might be a chance element is not rendered.\");\n        }\n        rctElDomRef = cs[0];\n    }\n\n    if (rctElDomRef && rctElDomRef instanceof Element) {\n        mode(rctElDomRef, targetElement);\n        if (callback) {\n            callback([rctElRef, rctElDomRef]);\n        }\n\n        FACTORY_DIV_REF.remove(); // Due to restriction, need to remove\n        return [rctElRef, rctElDomRef];\n    }\n}\n\n/*\n// TEST\nconst ASDF = ({foo}) => <div className=\"asdfasdfasdfasdfasadsfdasfasdfdasf\">{foo}</div>\nclass ASDF2 extends React.Component {\n    render() {\n        return <div className=\"213480123794578902349870239804129830\">{this.props.foo}</div>\n    }\n}\nexternalRender(RenderModes.Prepend, ASDF, {foo: 1}, document.body);\nexternalRender(RenderModes.Prepend, ASDF2, {foo: 'heydsaasdfasdfldasflasdflfdaslkfsdakmdsaf'}, document.body);\n*/\n\nexport function mountToDisposable(unmountedDOM: Element) {\n    // Create/Select disposable mounting DIV to correctly modify a element.\n    let $disposable = $(document.body).find(\".disposable\");\n    if ($disposable.length > 0) {\n        $disposable = $disposable.eq(0).empty();\n    } else {\n        $disposable = $(\"<div />\", { id: \"disposable\", style: \"display:none;\" }).appendTo(document.body);\n    }\n\n    if (unmountedDOM) {\n        // Append unmounted DOM if exists\n        $disposable.append(unmountedDOM);\n    }\n    // return disposable DOM\n    return $disposable;\n}\n","// built from 'webpack.FancyUtils.config.js'\n// loaded from 'FancyUtils.js' and exported as global module 'fancymixin'\nimport React from 'react';\nimport { schemeless as getSchemelessURL } from './FancyUtils';\n\n\nexport const initialDisplayNone = { display: 'none' }; // DEPRECATED\nexport const Display = {\n    None: { display: 'none' },\n    Block: { display: 'block' },\n    Inline: { display: 'inline' },\n    InlineBlock: { display: 'inline-block' },\n    NoneIf(cond) {\n        return cond ? Display.None : undefined;\n    },\n    BlockIf(cond) {\n        return cond ? Display.Block : undefined;\n    },\n    InlineIf(cond) {\n        return cond ? Display.Inline : undefined;\n    },\n    InlineBlockIf(cond) {\n        return cond ? Display.InlineBlock : undefined;\n    }\n};\n\n// Image using background-image\nexport const BGImage = ({ alt, className, schemeless, url }) => {\n    var backgroundImage = '';\n    if (url) {\n        backgroundImage = `url(${schemeless ? getSchemelessURL(url) : url})`;\n    }\n\n    return <img src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage }}\n                className={className}\n                alt={alt} />\n}\n\n// measurePointElement = .figure-item.btn-more\n// https://app.asana.com/0/260912680807/218844368911219\nexport function getElementGapFromHeader(measurePointElement/*:Element*/) /*:number*/{\n    const $headerFeatured = $('#header .header-featured');\n    const $header = $('#header')\n    let destHeight = $header.height()\n    if ($headerFeatured.attr('data-expanded') === 'true') {\n        destHeight += $headerFeatured.height()\n    }\n    return ~(document.body.scrollTop - $(measurePointElement).offset().top + destHeight) + 1 // convert - => + / + => -, integer\n}\n","import ReactDOM from 'react-dom';\nimport React from 'react';\nimport { selectOrCreate } from './FancyUtils';\n\n\nfunction selectPopup(popupName) {\n    if ($(`#popup_container .${popupName}`).length > 0) {\n        if (popupName) {\n            return $.dialog(popupName);\n        }\n    }\n    return null;\n}\n\nexport function openPopup(popupName, bindOverlayData = true) {\n    const popup = selectPopup(popupName);\n    if (popup) {\n        if (bindOverlayData) {\n            popup.$obj.data('via-overlay', true);\n            popup.$obj.one('close', function() {\n                $(this).data('via-overlay', false);\n            });\n        }\n        popup.open();\n    }\n}\n\nexport function closePopup(popupName) {\n    const popup = selectPopup(popupName);\n    if (popup) {\n        popup.$obj.data('via-overlay', false);\n        popup.close();\n    }\n}\n\nconst popupContainer = document.getElementById('popup_container');\nexport function renderPopup(PopupComponent, attrs, callback) {\n    // unless `attrs.openOnMount` is explicitly set as `false` and callback is set, it will open right after mount.\n    attrs = attrs || {};\n    if (attrs.openOnMount !== false && callback == null) {\n        callback = function () {\n            openPopup(PopupComponent.popupName);\n        };\n    }\n\n    if (!PopupComponent.popupName) {\n        console.warn(`renderPopup: Please set \\`popupName\\` property of ${PopupComponent.name}`);\n    }\n    return ReactDOM.render(\n        <PopupComponent {...attrs} />,\n        selectOrCreate(`.popup.${PopupComponent.popupName || ''}`, popupContainer),\n        callback\n    );\n}\n","class CDNUtils {\n    HOSTS = {};\n\n    constructor() {\n        // init hosts\n        this.makeServer('THINGD_MEDIA', 'thingd-media-ec.thefancy.com');\n        this.makeServer('THEFANCY_MEDIA', 'thefancy-media-ec.thefancy.com');\n        this.makeServer('RESIZE_IMAGE', 'resize-ec.thefancy.com');\n        this.makeServer('STATICFILES', 'static-ec.thefancy.com');\n        this.makeServer('FANCY_WEB', 'site-ec.thefancy.com');\n    }\n\n    makeServer(type, template) {\n        const { HOSTS } = this;\n        if (!HOSTS[type]) {\n            HOSTS[type] = [];\n        }\n        HOSTS[type].push(template);\n    }\n\n    getResizeURL(url, size, method, isSchemeless, cdn) {\n        var parts = window.parseURL(url);\n        var fixedName = (/test_default/.test(parts.pathname)) ? 'thingd' : 'thefancy';\n        var path = `/resize/${method ? method + '/' : ''}${size}/${fixedName}${parts.pathname}`;\n\n        var resizeUrl;\n        if (cdn) {\n            resizeUrl = this.getCDNURL(path);\n        } else {\n            resizeUrl = `${parts.protocol}//${parts.hostname}${path}`;\n        }\n\n        if (isSchemeless) {\n            resizeUrl = schemeless(resizeUrl);\n        }\n        return resizeUrl;\n    }\n\n    getCDNURL(url) {\n        const { HOSTS } = this;\n        let candidates;\n        const parts = window.parseURL ? window.parseURL(url) : {};\n        let path = parts.pathname;\n\n        if (parts.hostname == 's3.amazonaws.com') {\n            if (/\\/media\\.thefancy\\.com/.test(parts.pathname)) {\n                path = parts.pathname.replace(/^\\/media\\.thefancy\\.com/, '');\n                candidates = HOSTS.THEFANCY_MEDIA;\n            } else if (/\\/media\\.thingd\\.com/.test(parts.pathname)) {\n                path = parts.pathname.replace(/^\\/media\\.thingd\\.com/, '');\n                candidates = HOSTS.THINGD_MEDIA;\n            }\n        } else if (/^\\/(test_)?default/.test(path)) {\n            candidates = HOSTS.THINGD_MEDIA;\n        } else if (/^\\/_ui/.test(path)) {\n            candidates = HOSTS.FANCY_WEB;\n        } else if (/^\\/(resize|mark)/.test(path)) {\n            candidates = HOSTS.RESIZE_IMAGE;\n        } else if (/^\\/_static_gen/.test(path)) {\n            candidates = HOSTS.STATICFILES;\n        } else {\n            candidates = HOSTS.THEFANCY_MEDIA;\n        }\n\n        const hostname = candidates[sumChars(path.replace(/[^a-zA-Z0-9_]+/g,'')) % candidates.length];\n\n        return '//'+ hostname + path;\n    }\n\n    // Get REST URI for given resized_schemeless_image arguments\n    // See `fancy.templatetags.resized_images`\n    resizedSchemelessImage(url, size, method) {\n        // FIXME: some url (like cover image, user image, etc) gives weird url\n        //        and `window.parseURL()` attaches it to location.pathname.\n        //        This is temporary fix for it\n        if (url.match(/^(CoverImages\\/|UserImages\\/)/)) {\n            url = `/${url}`\n        }\n        return this.getResizeURL(url, size, method, true, true);\n    }\n}\n\nfunction sumChars(str) {\n    var sum = 0, i, c;\n    for (i=0,c=str.length; i < c; i++) {\n        sum += str.charCodeAt(i);\n    }\n    return sum;\n}\n\nexport function schemeless(url) {\n    var match = (typeof url === 'string') && url.match(/[http|https]\\:(\\/\\/.*)/);\n    return (match == null) ? url : match[1];\n}\n\nexport const cdnUtils = new CDNUtils();\n","// Removed prompt from 'copy-to-clipboard'\n// https://github.com/sudodoki/copy-to-clipboard/blob/04386fe925e10fec353e35e81684c5c96920102e/index.js\nimport deselectCurrent from 'toggle-selection';\n\n\nexport function copyToClipboard (text, options) {\n  var cb, reselectPrevious, range, selection, mark;\n  if (!options) { options = {}; }\n  cb = options.cb || Function.prototype;\n  try {\n    reselectPrevious = deselectCurrent();\n\n    range = document.createRange();\n    selection = document.getSelection();\n\n    mark = document.createElement('mark');\n    mark.textContent = text;\n    // used to conserve newline, etc\n    mark.style.whiteSpace = 'pre';\n    document.body.appendChild(mark);\n\n    range.selectNode(mark);\n    selection.addRange(range);\n\n    var successful = document.execCommand('copy');\n    if (!successful) {\n      console.warn('unable to copy via execCommand')\n      window.clipboardData.setData('text', text)\n    }\n  } catch (err) {\n    console.warn(err)\n  } finally {\n    cb(null);\n    if (selection) {\n      if (typeof selection.removeRange == 'function') {\n        selection.removeRange(range);\n      } else {\n        selection.removeAllRanges();\n      }\n    }\n    if (mark) {\n      document.body.removeChild(mark);\n    }\n    reselectPrevious();\n  }\n}\n","import {\n    ThingV1Response,\n    ThingObject,\n    FancyUserConfig,\n    SalesResponse,\n} from \"ftypes\";\nimport { BaseSyntheticEvent } from \"react\";\n\nconst __KEY__ = '__F';\n\nconst { _ } = window;\n\nwindow.requestIdleCallback = window.requestIdleCallback || function(cb: Function, ...args: any[]) {\n    window.setTimeout(cb, 0, ...args);\n};\n\n// Polyfills\nNumber.isNaN = Number.isNaN || function isNaN(value) {\n    return value !== value;\n};\n\nNumber.isInteger = Number.isInteger || function(value) {\n    return typeof value === \"number\" &&\n           isFinite(value) &&\n           Math.floor(value) === value;\n};\n\n// https://ponyfoo.com/articles/ecmascript-string-padding\nexport function padStart(text: string, max: number, mask: string) {\n  const cur = text.length;\n  if (max <= cur) {\n    return text;\n  }\n  const masked = max - cur;\n  let filler = String(mask) || ' ';\n  while (filler.length < masked) {\n    filler += filler;\n  }\n  const fillerSlice = filler.slice(0, masked);\n  return fillerSlice + text;\n}\n\nexport function zfill(text: string, max: number) {\n    return padStart(text, max, '0');\n}\n\n// Select element or create element via selector\nexport function selectOrCreate(selector:string, container: Element = document.body, element: string = 'div'): Element {\n    var attr;\n    var attrValue;\n    if (selector[0] === '.') {\n        attr = 'class';\n        var classNames = selector.split('.').filter(e=>e);\n        if (classNames.length > 1) { // .abc.def\n            attrValue = classNames.join(' ');\n        } else { // .abc\n            attrValue = selector.substr(1);\n        }\n    } else if (selector[0] === '#') {\n        attr = 'id';\n        attrValue = selector.substr(1);\n    } else {\n        // TODO: error handling - redirect to the page\n        throw new Error('non-recognized selector:' + selector);\n    }\n\n    var target = $(container).find(selector).get(0);\n    if (target == null) {\n        target = $(`<${element} ${attr}=\"${attrValue}\" />`).appendTo(container).get(0);\n    }\n    return target;\n}\n\ninterface URLMeta {\n    href?: string | null;\n    type?: string;\n    id?: string;\n}\nconst thingRegex = /^\\/(sales|things)\\/(\\d+)/;\nexport function extractMetaFromURL(url: string) {\n    url = stripDomain(url);\n    const match = url.match(thingRegex); // [\"/(sales|things)/1234\", \"sales\", \"1234\"] | null\n    const ret: URLMeta = {};\n    if (match != null) {\n        ret.href = stripURL(url); // Stripped relative URL\n        ret.type = match[1];      // either { 'sales' | 'things' }\n        ret.id = match[2];        // Integer\n    }\n    return ret;\n}\n\nconst articleRegex = /^\\/(articles)\\/([^\\?]+)/;\nexport function extractMetaFromArticleURL(url: string) {\n    url = stripDomain(url);\n    const match = url.match(articleRegex); // [\"/articles/test\", \"articles\", \"test\"] | null\n    const ret: URLMeta = {};\n    if (match != null) {\n        ret.href = stripURL(url); // Stripped relative URL\n        ret.type = match[1];      // always { 'article' }\n        ret.id = match[2];        // String\n    }\n    return ret;\n}\n\nfunction createElementParser(url: string) {\n    const a = document.createElement('a');\n    a.setAttribute('href', url);\n    return a;\n}\n\nfunction stripDomain(url: string) {\n    if (url) {\n        const parser = createElementParser(url);\n        let result = parser.pathname + parser.search + parser.hash;\n        // IE FIX\n        if (result.indexOf('/') !== 0) {\n            result = '/' + result\n        }\n        return result\n    } else {\n        return '/';\n    }\n}\n\nexport function getObjectTypeFromUrl(url: string) {\n    const path = stripDomain(url);\n    if (thingRegex.test(path)) {\n        return 'Thing';\n    } else if (articleRegex.test(path)) {\n        return 'Article';\n    } else {\n        return null;\n    }\n}\n\n// Due to <a href=# /> -> a.pathname = location.pathname, we need cleaner\nexport function getPathname(aElement: HTMLAnchorElement) {\n    if (aElement.pathname === location.pathname) {\n        return '';\n    } else {\n        return aElement.pathname;\n    }\n}\n\n// http://domain/things/1234 => /things/1234\n// deprecated, use stripDomain()\nfunction stripURL(url: string) {\n    const stripped = stripDomain(url);\n    if (stripped) {\n        return stripped;\n    } else {\n        return null;\n    }\n}\n\nexport function floatFormatMinusTwo(number: number) {\n    // simulates effect of floatformat:-2|intcomma\n    var num = numberFormat(number, 2);\n    var splitted = numberFormat(number, 2).split('.');\n    if (splitted[1] === '00') {\n        return splitted[0];\n    } else return num;\n}\n\n// Either empty or null/undefined; Python-side falsy values like {}, []\nexport function isEmpty(obj: any) : boolean {\n    return obj == null ||\n           obj === ''  ||\n           (obj instanceof Array && obj.length === 0) ||\n           (typeof obj === 'object' && Object.getOwnPropertyNames(obj).length === 0);\n}\n\nexport function setCaretPos(element: HTMLInputElement, position: number) {\n    element.focus();\n    if (element.setSelectionRange){\n        element.setSelectionRange(position, position);\n    } else if (element.createTextRange) {\n        var range = element.createTextRange();\n        range.moveEnd('character', position);\n        range.collapse(false);\n        range.select();\n    }\n};\n\nexport function getCaretPos(element: HTMLInputElement) {\n    if (element.selectionStart) {\n        return element.selectionStart;\n    } else if (document.selection) {\n        var range = document.selection.createRange();\n        range.moveStart('character', -element.value.length);\n        return range.text.length;\n    } else {\n        return -1;\n    }\n}\n\nexport var KEYS = {\n    TAB: 9,\n    ENTER: 13,\n    SPACE: 32,\n    ESC: 27,\n    UP: 38,\n    DOWN: 40,\n    LEFT: 37,\n    RIGHT: 39,\n    SEMICOLON: 186,\n    COMMA: 188 // ,\n};\n\n// Using DOM high-level event triggering system for React to recognize event\nexport function triggerEvent(DOMRef: Element, eventName: string, data: Object) {\n    var event;\n    if (data) {\n        event = new CustomEvent(eventName, {\n            'bubbles'    : true, // Whether the event will bubble up through the DOM or not\n            'cancelable' : true, // Whether the event may be canceled or not\n            'detail': data\n        });\n    } else {\n        event = new Event(eventName, {\n            'bubbles'    : true, // Whether the event will bubble up through the DOM or not\n            'cancelable' : true  // Whether the event may be canceled or not\n        });\n    }\n    return DOMRef.dispatchEvent(event);\n}\n\n// Deep merge for reducers\nexport function update(state: unknown, next: unknown) {\n    var args = [true, {}, state];\n    if (next) {\n        args.push(next)\n    }\n    return $.extend.apply(null, args);\n}\n\n// 'Shallow merge'\nexport function updateShallow(state: unknown, next: unknown) {\n    var args = [{}, state];\n    if (next) {\n        args.push(next)\n    }\n    return _.extend.apply(null, args);\n}\n\nexport function getDisplay(display: unknown) {\n    return {\n        display: display ? 'block' : 'none'\n    };\n}\n\n// '<a>b</a>' => 'b'\nexport function stripTags(html: string) {\n    var div = document.createElement(\"div\");\n    div.innerHTML = html;\n    return div.textContent || div.innerText || null;\n}\n\nexport function isPlainLeftClick(event: JQueryEventObject) : boolean {\n    return !(event.button !== 0 || event.altKey || event.metaKey || event.ctrlKey || event.shiftKey);\n}\n\nfunction testLegacyContextLocation() {\n    try {\n        // Root - /\n        if (location.pathname === '/' && $('#container-wrapper .timeline').length > 0) {\n            return true;\n        // Search page - /search?q=foo\n        } else if (/\\/search\\?q\\=/.test(location.href)) {\n            return true;\n        // User page - /foo\n        } else if (\n            $('#container-wrapper .wrapper-content.profile-section').length > 0 &&\n            /^\\/((?!\\/).)*$/.test(location.pathname)\n        ) {\n            return true;\n        } else if ('/shop' === location.pathname || /^\\/shop\\/.*/.test(location.pathname)) {\n            return true;\n        // <username | shopname>/lists/<id>\n        // <shopname>/collection/<id>\n        } else if (\n            /.*\\/list\\/\\d+/.test(location.pathname) ||\n            /.*\\/collection\\/\\d+/.test(location.pathname)\n        ) {\n            return true;\n        }\n    } catch(e) {}\n\n    return false;\n}\n\nlet _isHomepage: boolean;\nexport function isHomepage() {\n    if (_isHomepage == null) {\n        _isHomepage = location.pathname === '/'\n    }\n    return _isHomepage;\n}\n\nlet _isStream: boolean;\nexport function isStream() {\n    if (_isStream == null) {\n        return _isStream = testLegacyContextLocation();\n    } else {\n        return _isStream;\n    }\n}\n\nexport function promisifiedFetchImage(src: string, resolveCallback: any, timeout: number) {\n    const deferred = $.Deferred();\n    deferred.then(resolveCallback);\n\n    if (timeout) {\n        setTimeout(function () { deferred.resolve() }, timeout);\n    }\n\n    const img = new Image();\n    img.onload = () => { deferred.resolve(); };\n    img.onerror = () => { deferred.resolve(); };\n    img.src = src;\n}\n\nexport function debounceUntilTimeout(fun: Function, delay: number, context = null) {\n    let timer: any;\n    return function delayedFunctionWrapper(...args: unknown[]) {\n        clearTimeout(timer);\n        args.unshift(context);\n        timer = setTimeout(fun.bind.apply(fun, args), delay);\n    };\n}\n\nexport function debounceEventUntilTimeout(eventHandler: Function, delay: number) {\n    let timer: any;\n    return (e: BaseSyntheticEvent) => {\n        e.persist();\n        clearTimeout(timer);\n        timer = setTimeout(() => eventHandler(e), delay);\n    }\n}\n\nconst numberUnitPostfixes = ['', 'K', 'M', 'B', 'T'];\nexport function getConciseNumberString(_num: string | number) {\n    let num = Number(_num);\n    if (_.isNaN(num) || !_.isNumber(num)) {\n        return ''\n    }\n    let pos = 0\n    while (num > 1000) {\n        num = num / 1000\n        pos += 1\n    }\n    if (num % 1 !== 0) { // has some number after decimal point, i.e.) 10.5\n        return num.toFixed(1) + numberUnitPostfixes[pos]\n    } else { // integer i.e.) 10\n        return String(num) + numberUnitPostfixes[pos]\n    }\n}\n\n// humanize.js\nexport function numberFormat(number: number, decimals: number, decPoint?: string, thousandsSep?: string) : string {\n    decimals = isNaN(decimals) ? 2 : Math.abs(decimals);\n    decPoint = (decPoint === undefined) ? '.' : decPoint;\n    thousandsSep = (thousandsSep === undefined) ? ',' : thousandsSep;\n\n    var sign = number < 0 ? '-' : '';\n    number = Math.abs(+number || 0);\n\n    var intPartNum = parseInt(number.toFixed(decimals), 10);\n    var intPart = intPartNum + '';\n    var j = intPart.length > 3 ? intPart.length % 3 : 0;\n\n    return sign + (j ? intPart.substr(0, j) + thousandsSep : '') + intPart.substr(j).replace(/(\\d{3})(?=\\d)/g, '$1' + thousandsSep) + (decimals ? decPoint + Math.abs(number - intPartNum).toFixed(decimals).slice(2) : '');\n}\n\n// Number formatting utility i.e) 0.1 => 10%\nexport function proportionFormat(number: string | number, isFixed: boolean) : string {\n    const num = Number(number);\n    if (_.isNumber(num) && !_.isNaN(num)) {\n        if (isFixed) {\n            return (num * 100).toFixed(0) + '%';\n        } else {\n            return (num * 100) + '%';\n        }\n    } else {\n        return '';\n    }\n}\n\nexport function isStaticPage() : boolean {\n    return document.body.className.indexOf('static-ot') !== -1;\n}\n\nexport function isStaticArticlePage() : boolean {\n    return document.body.className.indexOf('static-article') !== -1;\n}\n\n// http://stackoverflow.com/questions/6393943/convert-javascript-string-in-dot-notation-into-an-object-reference\nexport function index(obj: Object, is: string, value : any): any {\n    if (typeof is == 'string') {\n        return index(obj, is.split('.'), value);\n    } else if (is.length === 1 && value !== undefined) {\n        obj[is[0]] = value;\n        return value;\n    } else if (is.length === 0) {\n        return obj;\n    } else if (obj[is[0]] !== undefined) {\n        return index(obj[is[0]], is.slice(1), value);\n    } else {\n        // was unable to reach via selector\n    }\n}\n\n// export function dateFormat(format, datetime) {\n//     return $.datepicker ? $.datepicker.formatDate(format, datetime) : datetime;\n// }\n\nexport function log(...args: unknown[]) {\n    if (process.env.NODE_ENV !== 'production') {\n        console.debug.apply(console, args);\n    }\n}\n\nexport function isVisible(elm: Element) {\n    const vpH = $(window).height(); // Viewport Height\n    const st = $(window).scrollTop(); // Scroll Top\n    const $elm = $(elm);\n    const offset= $elm.offset();\n    const elementHeight = $elm.height();\n\n    if (offset !== undefined && vpH !== undefined && st !== undefined && elementHeight !== undefined) {\n        const y = offset.top;\n        return ((y < (vpH + st)) && (y > (st - elementHeight)));\n    }\n}\n\n// http://stackoverflow.com/a/32533637/1189421\n// Object deduping / boxed value is not supported.\nexport function dedupeArray(vals: any[]): unknown[] | null {\n    if (vals) {\n        return vals.sort().reduce((a, b) => {\n            if (b !== a[0]) {\n                a.unshift(b);\n            }\n            return a;\n        }, []);\n    } else {\n        return null;\n    }\n}\n\n// Access global state\nexport function getFancyDepsRoot() {\n    window[__KEY__] = window[__KEY__] || {};\n    return window[__KEY__];\n}\n\n// eitherFancy('jQuery', $ => $(...)); -> $(...)\nexport function eitherFancy(namespace: string, doWith = (Deps: any) => Deps) /*:object? */{\n    if (window[__KEY__]) {\n        if (window[__KEY__][namespace]) {\n            return doWith(window[__KEY__][namespace]);\n        }\n    } else {\n        getFancyDepsRoot();\n    }\n    return null;\n}\n\nexport function didClickOn($targ: JQuery, selector: string) {\n    return $targ.parents(selector).length > 0 ||\n           $targ.is(selector);\n}\n\nexport const xmlUtil = {\n    isSuccess(xml: string) {\n        const sc = $(xml).find(\"status_code\");\n        return sc.length > 0 && sc.text() === '1';\n    },\n    isFail(xml: string) {\n        const sc = $(xml).find(\"status_code\");\n        return sc.length > 0 && sc.text() === '0';\n    }\n};\n\nexport function MP(...args: unknown[]) {\n    if (process.env.NODE_ENV === 'production') {\n        window.track_event && window.track_event(...args)\n    }\n}\n\n// ?a=1 -> ['a', '1']\nexport function getLocationArgPairs(key: string, originalArgStr:string=location.search) {\n    const argStr = originalArgStr.substr(1, originalArgStr.length);\n    if (argStr) {\n        const args = argStr.split('&').map(e => e.split('='));\n        if (key) {\n            let ret;\n            args.some(argPair => {\n                if (argPair[0] === key) {\n                    ret = argPair;\n                }\n            });\n            if (ret) {\n                return ret;\n            }\n        } else {\n            return args;\n        }\n    }\n}\n\nexport function formatDuration(value: string | number) {\n    if (value == null) {\n        // console.warn('formatDuration: undefined value', value)\n        return '00:00';\n    }\n    const val = Number(value);\n    if (_.isNaN(val)) {\n        // console.warn('formatDuration: value causing NaN', value)\n        return '00:00';\n    }\n    const remainder = (val % 3600) | 0;\n    const minutes = (remainder / 60) | 0;\n    const seconds = (remainder % 60) | 0;\n    return `${zfill(String(minutes), 2)}:${zfill(String(seconds), 2)}`;\n}\n\nexport function minmax(value: number, lb: number, ub: number) {\n    return Math.max(Math.min(value, ub), lb);\n}\n\nexport { openPopup, closePopup, renderPopup } from './PopupHelper';\nexport { cdnUtils, schemeless } from './CDNUtils';\n\nexport function mergeObjectArgs(args: unknown[]) {\n    return args.reduce((p, n)=> $.extend(true, p, n), null);\n}\n\n\nfunction closestUntil(startingElement: Element | null, targetElement : Element | null): Element | null {\n    let start = startingElement;\n    while (start != null) {\n        if (start === targetElement) return targetElement;\n        if (start === document.body || start === document.documentElement) {\n            return null;\n        }\n        start = start.parentElement;\n    }\n    return null;\n}\n\nexport class ClickOutside {\n    eventKey: string = '';\n    component?: import('react').Component = undefined;\n    popupElementRefKey: string = '';\n\n    constructor({ component, popupElementRefKey = 'popupElement' } : { component: import('react').Component, popupElementRefKey: string }) {\n        const key = Math.random().toString().substr(2, 8);\n        this.eventKey = \"click.attachClickOutside\" + key;\n        this.component = component;\n        this.popupElementRefKey = popupElementRefKey;\n    }\n\n    attached = false;\n    handleAttach = (closePopupFunction: Function) => {\n        if (this.attached || closePopupFunction == null) {\n            return;\n        }\n        const { component, eventKey, handleDetach, popupElementRefKey } = this;\n        $(document.body).on(eventKey, function(event: JQueryOldTriggeredEvent) {\n            if (!event.isTrigger &&\n                $.contains(document.body, event.target) && // check if element exists on DOM\n                closestUntil(event.target, component[popupElementRefKey]) === null // is target element exist below popup element?\n            ) {\n                closePopupFunction(component);\n                handleDetach();\n            }\n        });\n        this.attached = true;\n    }\n\n    handleDetach = () => {\n        $(document.body).off(this.eventKey);\n        this.attached = false;\n    }\n\n    destroy() {\n        delete this.component;\n        this.handleDetach();\n    }\n}\n\nexport { copyToClipboard } from './CopyToClipboard'\n\nexport function isClipboardSupported() : boolean {\n    return document.queryCommandSupported != null && document.queryCommandSupported('copy');\n}\n\nfunction isSaleResponse(sales: SalesResponse[]) : sales is SalesResponse[] {\n    return sales != null && sales[0] != null;\n}\n\n// Adapt server response (thing.to_v1 -> rest API)\nexport function convertThingsV1ToRest(things: ThingV1Response[]): ThingObject[] {\n    return things.map((thing: ThingV1Response) => {\n        const converted: ThingObject = Object.assign({\n            sales_available: false,\n            id: thing.id_str,\n            name: thing.name,\n            fancyd: thing[\"fancy'd\"],\n            thumb_image_url_310: thing.thumb_image_url_310,\n            thumb_image_url_558: thing.thumb_image_url_558,\n            fancyd_count: thing.fancys,\n            image: {\n                src: thing.image_url,\n                width: thing.image_url_width,\n                height: thing.image_url_height\n            },\n            owner: thing.user,\n            html_url: window.parseURL(thing.url).pathname,\n            fancyd_users: thing.fancyd_users,\n            sales: thing.sales,\n        }, thing);\n\n        const { sales } = thing;\n        if (isSaleResponse(sales)) {\n            const sales: SalesResponse = thing.sales[0];\n            if (sales.id == null && sales.sale_id != null) {\n                sales.id = sales.sale_id\n            }\n            // converted.sales.waiting = sales.waiting;\n            converted.sales = sales;\n            converted.sales.quantity = sales.remaining_quantity;\n            converted.sales.price = sales.fancy_price;\n            converted.sales_available = sales.available_for_sale;\n        } else {\n            converted.sales = null;\n        }\n\n        // Flag for cache\n        converted.isCrawled = true;\n        return converted;\n    });\n}\nexport function isElementOutsideViewport(element: Element, excludingElement: { element: Element, type: string }) {\n    let elementRect = element.getBoundingClientRect();\n    let upperBound = 0;\n    let leftBound = 0;\n    if (excludingElement) {\n        const { element, type } = excludingElement;\n        if(element){\n            const exclusionRect = element.getBoundingClientRect();\n            if (type === 'top') {\n                upperBound = exclusionRect.bottom; // exclusion on top of el (header, etc)\n            } else if (type === 'left') {\n                leftBound = exclusionRect.right; // exclusion on left of el (sidebar, etc)\n            } // right, bottom is TODO\n        }\n    }\n    const html = document.documentElement\n    const lowerBound = window.innerHeight || html.clientHeight\n    const rightBound = window.innerWidth || html.clientWidth\n    const { bottom, top, left, right } = elementRect\n\n    return (\n        (top <= upperBound && bottom <= upperBound) ||\n        (top >= lowerBound && bottom >= upperBound) ||\n        (left <= leftBound && right <= leftBound) ||\n        (left >= rightBound && right >= rightBound)\n    );\n}\n\nlet _FancyUser : FancyUserConfig = {\n    loggedIn: false,\n    merchant: false,\n    id: null,\n};\n\nif (window.__FancyUser) {\n    Object.assign(_FancyUser, window.__FancyUser);\n}\nexport const FancyUser = _FancyUser;\n\nconst locationHostname = `${location.protocol}//${location.hostname}`\nexport function stripPathname(href: string) {\n    const sp = href.split(locationHostname)\n    return sp.length > 1 ? sp[1] : sp[0]\n}\n\n// https://gist.github.com/ijy/6094414\nexport function cartesianProductOf(...args) {\n    return _.reduce(args, (a, b) => {\n        return _.flatten(_.map(a, (x) => {\n            return _.map(b, (y) => {\n                return x.concat([y]);\n            });\n        }), true);\n    }, [ [] ]);\n}\n\nexport function jQueryPromiseAll(arrayOfPromises: Array<Promise<unknown>>) {\n    return jQuery.when.apply(jQuery, arrayOfPromises).then(function() {\n        return Array.prototype.slice.call(arguments, 0);\n    });\n}\n\nconst _loaded = {};\nexport function loadCss(AppName: string) {\n    const B = window.Bundle;\n    if (_loaded[AppName]) {\n        return;\n    }\n    if (B && B.cssToLoad && B.cssToLoad[AppName] && B.cssToLoad[AppName].length > 0) {\n        while (B.cssToLoad[AppName].length > 0) {\n            const nextUrl = B.cssToLoad[AppName].pop();\n            $(document.head).append(`<link href=\"${nextUrl}\" rel=\"stylesheet\">`);\n            _loaded[AppName] = true;\n        }\n    }\n}\n\nconst _alertify = window.alertify || {\n    alert(...args: unknown[]) { window.alert(...args); },\n    prompt(message: string, fn?: Function | undefined, placeholder?: string | undefined, cssClass?: string | undefined) {\n        if (fn) {\n            let msg : string | undefined | null;\n            if (placeholder) {\n                msg = window.prompt(message, placeholder)\n            } else {\n                msg = window.prompt(message)\n            }\n            if (msg === null) {\n                fn(false);\n            } else {\n                fn(true, msg);\n            }\n        } \n    },\n    confirm(message: string, fn?: Function | undefined, cssClass?: string | undefined) {\n        if (fn) {\n            fn(window.confirm(message));\n        }\n    },\n    set: function() {},\n    labels: { ok: 'OK', cancel: 'Cancel' },\n};\nexport const alertify = _alertify;\n\n// https://code.jquery.com/jquery-3.3.1.js\nexport function escapeSelector(sel: string) { // $.escapeSelector()\n    var rcssescape = /([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\0-\\x1f\\x7f-\\uFFFF\\w-]/g;\n    var fcssescape = function(ch: string, asCodePoint: boolean) {\n        if (asCodePoint) {\n            // U+0000 NULL becomes U+FFFD REPLACEMENT CHARACTER\n            if (ch === \"\\0\") {\n                return \"\\uFFFD\";\n            }\n            // Control characters and (dependent upon position) numbers get escaped as code points\n            return ch.slice(0, -1) + \"\\\\\" + ch.charCodeAt(ch.length - 1).toString(16) + \" \";\n        }\n        // Other potentially-special ASCII characters get backslash-escaped\n        return \"\\\\\" + ch;\n    };\n\n    return (sel + '').replace(rcssescape, fcssescape);\n};\n\nlet isSafari_cac : undefined | boolean;\nexport const isSafari = () => {\n    if (isSafari_cac === undefined) {\n        isSafari_cac = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n    }\n    return isSafari_cac;\n};\n","import React from \"react\";\n// import classnames from \"classnames\";\n// import { proportionFormat, isSafari as isSafariUtil } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\n\nexport function getVideo(object) {\n    if (object.h264_1000k_url) return object;\n    const saleVideo = object && object.sales && object.sales.video;\n    const thingOrArticleVideo = (object && object.video_cover) || (object && object.cover_video);\n    if (saleVideo) {\n        return saleVideo;\n    } else if (thingOrArticleVideo) {\n        try {\n            if (!thingOrArticleVideo.h264_1000k_url && object.cover_video.outputs.h264_1000k) {\n                thingOrArticleVideo.h264_1000k_url = object.cover_video.outputs.h264_1000k.url;\n            }\n        } catch (e) {}\n        return thingOrArticleVideo;\n    } else if (object.metadata && object.metadata.video_url) {\n        return {\n            thumbnail_url: object.image.src,\n            original_url: object.metadata.video_url\n        };\n    } else {\n        console.warn(\"<Video /> component is mounted but with unknown type\");\n        return {};\n    }\n}\n\nexport class Video extends React.Component {\n    constructor(props) {\n        super(props);\n        this.id = +new Date();\n    }\n    el = null;\n    videoEl = null;\n    static isVideoAvailableForThing(thing) {\n        let thingHasVideo = false;\n        if (thing) {\n            if (thing.video_cover) {\n                thingHasVideo = true;\n            } else if (thing.metadata) {\n                if (thing.metadata.video_url) {\n                    thingHasVideo = true;\n                }\n            } else if (thing.sales) {\n                if (thing.sales.video) {\n                    thingHasVideo = true;\n                }\n            }\n        }\n        return thingHasVideo;\n    }\n    static isVideoAvailableForArticle(article) {\n        if (article && article.cover_video && article.cover_video.status == \"ready\") {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    getSrc() {\n        const { object } = this.props;\n        const video = getVideo(object);\n        return video.h264_1000k_url || video.original_url || video.original;\n    }\n\n    getThumbnail() {\n        const { object } = this.props;\n        const video = getVideo(object);\n        return video.thumbnail_url;\n    }\n\n    getLoop() {\n        const { object } = this.props;\n        return getVideo(object).loop;\n    }\n\n    shouldComponentUpdate(nextProps) {\n        return (\n            nextProps.lastFullyRenderedObjectID !== this.props.lastFullyRenderedObjectID ||\n            nextProps.display !== this.props.display ||\n            nextProps.playing !== this.props.playing ||\n            nextProps.object !== this.props.object);\n    }\n\n    prepare() {\n        const domCls = `video-${this.id}`;\n        let $el = $(`.${domCls}`);\n        if ($el.length) {\n            if ($el[0].src !== this.getSrc()) {\n                $el[0].src = this.getSrc();\n                $el[0].loop = !!this.getLoop();\n                $el[0].currentTime = 0;\n            }\n        } else {\n            $el = $(\n                `<video id=\"myVideo\" class=\"${domCls}\" preload=\"auto\" playsInline disablePictureInPicture autoplay muted controls controlslist=\"nodownload nofullscreen noremoteplayback\" src=\"${this.getSrc()}\" loop=\"${!!this.getLoop()}\" poster=\"${this.getThumbnail()}\"/>`\n            )\n                .on(\"ended\", function() {\n                    this.currentTime = 0;\n                })\n            this.videoEl = $el.get(0);\n            $(this.el).empty().append(this.videoEl);\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n        const np = this.props;\n        if (np.display !== prevProps.display) {\n            if (np.display === false) {\n                this.videoEl && this.videoEl.pause();\n            } else {\n                this.videoEl && this.videoEl.play();\n            }\n        }\n        if (np.display && np.playing != prevProps.playing) {\n            if (np.playing === false) {\n                this.videoEl && this.videoEl.pause();\n            } else {\n                this.videoEl && this.videoEl.play();\n            }\n        }\n        this.prepare();\n    }\n\n    render() {\n        const { display, style = {}, playing } = this.props;\n        \n        return (\n            <div\n                style={_.extend(style, Display.NoneIf(!display))}\n                className=\"video_player nozoom\"\n                ref={el => {\n                    this.el = el;\n                    if (!this.videoEl) {\n                        this.prepare();\n                    }\n                }}\n            />\n        );\n    }\n}\n","export const ShareObjectTypes = {\n    thing: 'thing',\n    list: 'list',\n    store: 'store',\n    user: 'user',\n    article: 'article',\n}\n\nfunction createReferredUrl(viewerUsername, objectId, objectType, objectMeta) {\n    let url;\n    if (objectType === ShareObjectTypes.thing) {\n        url = `https://${location.hostname}/things/${objectId}`;\n    } else if (objectType === ShareObjectTypes.article && objectMeta) {\n        url = `https://${location.hostname}/articles/${objectMeta.slug}`;\n    } else {\n        url = location.href.replace(/(#.*)/, ''); // Remove hash\n    }\n\n    if (viewerUsername) {\n        let connector = ~url.indexOf('?') ? '&' : '?';\n        url = `${url}${connector}ref=${viewerUsername}`\n    }\n\n    return url;\n}\n\nexport function getShareURL(component, callback) {\n    if (component.loading || component.state.referrerURL || component.props.referrerURL) {\n        callback && callback(true);\n        return;\n    }\n    component.loading = true;\n\n    // If async loading is needed, assign setState callback.\n    let cb = null;\n    if (callback) {\n        cb = () => {\n            callback(false);\n            component.loading = false;\n        };\n    }\n    const { viewerUsername, objectId, objectType, objectMeta } = component.props;\n    const originalUrl = createReferredUrl(viewerUsername, objectId, objectType, objectMeta);\n    $.post('/get_short_url.json', { url: originalUrl })\n        .done(res => {\n            component.setState({ referrerURL: res.short_url }, cb);\n        })\n        .fail(() => {\n            component.setState({ referrerURL: originalUrl }, cb);\n            console.warn('/get_short_url failed');\n        });\n}\n","import React from 'react';\nimport classnames from 'classnames';\nimport { FancyUser, debounceUntilTimeout, MP, getDisplay, triggerEvent, alertify } from 'fancyutils';\nimport { ShareObjectTypes, getShareURL } from './MoreShareUtils';\n\nimport { Display } from 'fancymixin';\n\n\nconst SNSDict = { \"fb\": \"Facebook\", \"tw\": \"Twitter\", \"tb\": \"Tumblr\" };\n\nconst followingUsers = [];\nlet followingUsersRequested = false;\n\nconst ViewClasses = {\n    Success: 'empty success',\n    Default: 'empty default',\n    Searching: 'empty searching',\n    NoResult: 'empty no-result',\n};\n\n\nexport class SharePopover extends React.Component {\n    state = {\n        friendSearchQuery: '',\n        searchedFriends: [],\n        selectedUserID: null,\n        sentUser: null,\n        sendNote: '',\n        sendSuccess: false,\n        searching: false,\n        isContact: false,\n    };\n\n    mailUser = {\n        id: 'EMAIL',\n        type: 'email',\n        profile_image_url: '/_ui/images/common/blank.gif',\n        fullname: 'Email',\n        /* mut */ username: null,\n    };\n\n    constructor(props) {\n        super(props);\n        this.searchFriends = debounceUntilTimeout(function searchFriends(prevQuery, friendSearchQuery) {\n            if (this.isEmailOnlyMode()) {\n                this.setState({ searching: false });\n                return;\n            }\n\n            const term = $.trim(friendSearchQuery);\n            if ($.trim(prevQuery) === term) {\n                return;\n            }\n            if (term === '') {\n                this.setState({\n                    searchedFriends: [],\n                    selectedUserID: null,\n                });\n                return;\n            }\n            this.setState({ searching: true }, () => {\n                $.get('/search-users.json', {\n                    term, \n                    filter_messages_permission: true\n                })\n                .done(searchedFriends => {\n                    const nextState = { searching: false };\n                    if (this.state.friendSearchQuery === friendSearchQuery) {\n                        nextState.searchedFriends = searchedFriends;\n                        nextState.selectedUserID = null;\n                    }\n                    this.setState(nextState);\n                });\n            })\n        }, 200, this);\n    }\n\n    handleContinue = (event) => {\n        event.preventDefault();\n        this.clearFriendList();\n        if (this.props.handleHide) {\n            this.props.handleHide()\n        }\n    }\n\n    handleFriendSearch = (event) => {\n        const friendSearchQuery = event.target.value;\n        const prevQuery = this.state.friendSearchQuery;\n        this.setState({ friendSearchQuery, sendSuccess: false, searching: true }, () => {\n            this.searchFriends(prevQuery, friendSearchQuery);\n        });\n    }\n\n    handleSend = () => {\n        const { sendNote, selectedUserID, searchedFriends } = this.state;\n        const { title, referrerURL } = this.props;\n        if (this.sending) {\n            return;\n        }\n\n        const isMailuser = selectedUserID === this.mailUser.id;\n        if (isMailuser) {\n            this.handleSendMail();\n            return;\n        } else if (searchedFriends.length === 0 || selectedUserID == null) {\n            return;\n        }\n\n\n        const { objectType } = this.props;\n        let params;\n        if (objectType === ShareObjectTypes.thing) {\n            params = {\n                things: this.props.objectId,\n                user_id: selectedUserID\n            };\n        } else {\n            params = {\n                user_id: selectedUserID,\n                message: `${title} ${referrerURL}`,\n            };\n        }\n        \n        this.sending = true;\n        if ($.trim(sendNote)) {\n            params.message += (' ' + $.trim(sendNote));\n        }\n\n        $.post('/messages/send-message.json', params)\n            .done(json => {\n                if (json.status_code !== 1) {\n                    if (json.message) {\n                        alertify.alert(json.message);\n                    } else {\n                        alertify.alert(\"There was an error while sending message. Please try again.\");\n                    }\n                    return;\n                }\n                this.clearFriendList({\n                    sendSuccess: true,\n                    sentUserID: selectedUserID,\n                    selectedUserID: null,\n                }, ['searchedFriends']);\n                MP('Complete Share', { \"thing id\": params.things, \"type\": \"FancyMessage\" });\n            })\n            .fail(xhr => {\n                console.warn(xhr);\n            })\n            .always(() => {\n                this.sending = false;\n            });\n    }\n\n    handleSendMail = () => {\n        if (this.sending) {\n            return;\n        }\n        if (this.props.objectType == null) {\n            console.warn('objectType should be provided.');\n        }\n        const object_type = this.props.objectType || 'thing';\n        const email_address = this.mailUser.username.trim();\n\n        const object_id = this.props.objectId;\n        this.sending = true;\n        const params = { email_address, object_type, object_id };\n        const message = $.trim(this.state.sendNote);\n        if (message) {\n            params.message = message;\n        }\n        if (this.props.objectMeta && this.props.objectMeta.type === 'shoplist') {\n            params.object_meta = this.props.objectMeta.type;\n        }\n\n        $.post('/messages/send-email.json', params)\n            .done(json => {\n                if (json.status_code !== 1) {\n                    if (json.message) {\n                        alertify.alert(json.message);\n                    } else {\n                        alertify.alert(\"There was an error while sending message. Please try again.\");\n                    }\n                    return;\n                }\n                this.clearFriendList({\n                    sendSuccess: true,\n                    sentUserID: params.email_address,\n                    selectedUserID: null,\n                });\n                MP('Complete Share', { \"object id\": params.object_id, \"object type\": params.object_type, \"type\": \"Email\" });\n            })\n            .fail(xhr => {\n                var responseObject = null\n                try { responseObject = JSON.parse(xhr.responseText) } catch(e) { }\n                if(responseObject && responseObject.message) {\n                    alertify.alert(responseObject.message)\n                } else {\n                    alertify.alert(\"Error occured. please try again.\\n\"+xhr.status + ' ' + xhr.statusText);\n                }\n                console.warn(xhr);\n            })\n            .always(() => {\n                this.sending = false;\n            });\n    }\n\n    clearFriendList = (additionals, excludes) => {\n        // remove search history for users\n        const nextState = _.extend({\n            friendSearchQuery: '',\n            searchedFriends: [],\n            sendNote: '',\n            sendSuccess: false,\n            sentUserID: null,\n        }, additionals);\n        if (excludes) {\n            excludes.forEach(excludeKey => {\n                delete nextState[excludeKey];\n                nextState[excludeKey] = this.state[excludeKey];\n            });\n        }\n        this.setState(nextState);\n    }\n\n    handleSendNoteInput = (event) => {\n        const sendNote = event.target.value;\n        this.setState({ sendNote });\n    }\n\n    handleUserSelect = (event) => {\n        event.preventDefault();\n        const { selectedUserID } = this.state;\n        const nextID = $(event.currentTarget).attr('data-userid');\n        // Canceling\n        if (String(selectedUserID) === $(event.currentTarget).attr('data-userid')) {\n            this.setState({ selectedUserID: null });\n        // Selecting\n        } else {\n            this.setState({ selectedUserID: nextID });\n        }\n    }\n\n    getSelectedUser = () => {\n        const { selectedUserID } = this.state;\n        return _.find(this.getSearchedFriends(), e => String(e.id) === selectedUserID);\n    }\n\n    getSentUser = () => {\n        const { sentUserID } = this.state;\n        return _.find(this.getSearchedFriends(), e => String(e.id) === sentUserID);\n    }\n\n    getDisplayUsers = () => {\n        if (followingUsersRequested) {\n            return;\n        }\n        this.loadingDisplayUsers = true;\n        followingUsersRequested = true;\n        $.get('/get-share-display-users.json').done(res => {\n            if (res.status_code === 1 && res.users.length > 0) {\n                followingUsers.push.apply(followingUsers, res.users);\n            }\n        }).fail(() => {\n            console.warn('failed to fetch display users')\n        })\n        .always(() => {\n            this.loadingDisplayUsers = false;\n            this.forceUpdate();\n        });\n    }\n\n    handleClickBackFromContact = () => {\n        this.setState({ isContact: false });\n    }\n\n    handleClickContactImport = (event) => {\n        event.preventDefault();\n        this.setState({ isContact: true });\n    }\n\n    getSharedMailUser = () => {\n        const {\n            friendSearchQuery,\n        } = this.state;\n        this.mailUser.username = friendSearchQuery;\n        return [this.mailUser];\n    }\n\n    getSearchedFriends = () => {\n        if (\n            this.state.friendSearchQuery.length !== 0 || \n            this.state.sendSuccess\n        ) {\n            if (this.isInputEmail()) {\n                return this.getSharedMailUser();\n            } else {\n                return this.state.searchedFriends;\n            }\n        } else {\n            return followingUsers;\n        }\n    }\n\n    isInputEmail = () => {\n        const { friendSearchQuery } = this.state;\n        return friendSearchQuery.length > 1 && \n               friendSearchQuery.indexOf('@') > 0;\n    }\n\n    getPrefix(user) {\n        return user.type === 'email' ? '' : '@';\n    }\n\n    static getShareMessage(objectType, defaultMessage = '') {\n        let shareMessage = defaultMessage;\n        if (objectType === ShareObjectTypes.list) {\n            shareMessage = 'Share collection';\n        } else if (objectType === ShareObjectTypes.store) {\n            shareMessage = 'Share store';\n        } else if (objectType === ShareObjectTypes.user) {\n            shareMessage = 'Share profile';\n        } else if (objectType === ShareObjectTypes.article) {\n            shareMessage = 'Share article';\n        }\n        return shareMessage;\n    }\n\n    isEmailOnlyMode = () => {\n        return !(this.props.objectType === ShareObjectTypes.thing || this.props.objectType === ShareObjectTypes.article) || !FancyUser.loggedIn;\n    }\n\n    componentDidUpdate(prevProps) {\n        const { showShare } = this.props;\n        const { isContact } = this.state;\n        // share is closed, if contact mode close it.\n        if (isContact && !showShare && prevProps.showShare !== showShare) {\n            this.setState({ isContact: false });\n        }\n    }\n\n    componentDidMount() {\n        // Do loading friends stuff.\n        if (!this.isEmailOnlyMode()) {\n            this.getDisplayUsers();\n        }\n    }\n\n    render() {\n        const {\n            showShare,\n            title,\n            headerGap,\n            objectType,\n            objectId,\n            objectMeta,\n            viewerUsername,\n            referrerURL,\n        } = this.props;\n\n        if (process.env.NODE_ENV !== 'production') {\n            viewerUsername == null &&\n            console.warn('SharePopover: viewerUsername missing');\n        }\n\n        const {\n            friendSearchQuery,\n            sendNote,\n            sendSuccess,\n            sentUserID,\n            searching,\n            isContact\n        } = this.state;\n        const searchedFriends = this.getSearchedFriends();\n\n        const selectedUser = this.getSelectedUser();\n        const sentUser = this.getSentUser();\n\n        var emptyDisplay = Display.Block;\n        var emptyClassName;\n        var searchedFriendsDisplay;\n        const inputIsEmail = this.isInputEmail();\n        const emailOnlyMode = this.isEmailOnlyMode(); \n        // Search returns nothing\n        \n        if (sendSuccess) {\n            emptyClassName = ViewClasses.Success;\n        } else {\n            if (emailOnlyMode && !inputIsEmail) {\n                emptyClassName = ViewClasses.Default;\n            } else if (searchedFriends.length > 0) {\n                if (!inputIsEmail && searching) {\n                    emptyClassName = ViewClasses.Searching;\n                }\n            } else if (searchedFriends.length === 0) {\n                if (friendSearchQuery.length === 0) {\n                    if (this.loadingDisplayUsers) {\n                        emptyClassName = ViewClasses.Searching;\n                    } else {\n                        emptyClassName = ViewClasses.Default;\n                    }\n                } else {\n                    if (searching) {\n                        emptyClassName = ViewClasses.Searching;\n                    } else {\n                        emptyClassName = ViewClasses.NoResult;\n                    }\n                }\n            }\n        }\n\n        if (emptyClassName) {\n            searchedFriendsDisplay = Display.None;\n        } else {\n            emptyDisplay = Display.None;\n        }\n\n        if (selectedUser) {\n            searchedFriendsDisplay = Display.None;\n        }\n\n        const noteSendable = (\n            !this.sending &&\n            searchedFriends.length > 0 &&\n            !!selectedUser\n        );\n\n        // Sliding indicator style\n        const isSNS = !(selectedUser || sendSuccess);\n\n        let sentMessage = '';\n        if (sendSuccess) {\n            sentMessage += gettext(\"Sent to \");\n            sentMessage += sentUser ? (sentUser.fullname || sentUser.username) : sentUserID\n        }\n\n        let bottom = false;\n        if (headerGap < 290) {\n            bottom = true;\n        }\n\n        return (\n            <div id=\"show-share\" className={classnames(\"more-share-popup more-share-popup-2 has-arrow\", { bot: bottom })} style={getDisplay(showShare)}>\n                <h3 className=\"tit\" style={Display.NoneIf(isContact || selectedUser)}>{SharePopover.getShareMessage(objectType, 'Share')}</h3>\n                <a className=\"btn-back\" style={Display.NoneIf(!selectedUser || sentUser)}\n                   onClick={() => {this.setState({ selectedUserID: null });return false;}}>Back</a>\n                <div className=\"frm\" style={Display.NoneIf(isContact)}>\n                    {FancyUser.loggedIn &&\n                    <div id=\"more-share-send\">\n                        <span className=\"textbox before-bg-share2\" style={Display.NoneIf(selectedUser || sendSuccess)}>\n                            <input id=\"more-share-email\"\n                                   className=\"text\" type=\"text\"\n                                   placeholder={emailOnlyMode ? gettext(\"Enter email address\") : gettext(\"Username or email address\")}\n                                   autoComplete=\"off\"\n                                   onChange={this.handleFriendSearch}\n                                   value={friendSearchQuery} />\n                        </span>\n                        <ul className=\"lists\" style={searchedFriendsDisplay}>\n                            {searchedFriends\n                                .map((user, idx) => {\n                                    const term = $.trim(friendSearchQuery).toLowerCase();\n                                    const prefix = this.getPrefix(user);\n                                    let style;\n                                    if (term) {\n                                        if (\n                                            `${user.fullname} ${prefix}${user.username}`.toLowerCase().indexOf(term) === -1\n                                        ) {\n                                            style = Display.None;\n                                        }\n                                    }\n                                    let username;\n                                    let imgClass;\n                                    if (user.type === 'email') {\n                                        username = user.username;\n                                        imgClass = 'email';\n                                    } else {\n                                        username = `${prefix}${user.username}`;\n                                    }\n\n                                    return (\n                                        <li key={idx} style={style}>\n                                            <a className=\"before-bg-share2\"\n                                                onClick={this.handleUserSelect}\n                                                data-userid={user.id}>\n                                                <img alt=\"\" className={imgClass} src={user.profile_image_url} />\n                                                <b>{user.fullname}</b>\n                                                <small>{username}</small>\n                                            </a>\n                                        </li>\n                                    )\n                            })}\n                        </ul>\n                        <div className={emptyClassName} style={emptyDisplay}>\n                            <i className=\"circle bg-share2\" />\n                            {emailOnlyMode ?\n                                <span className=\"default\">\n                                    {gettext(\"Share this via Email\")}\n                                </span>\n                                :\n                                <span className=\"default\">\n                                    <b>{gettext(\"Find people to share with\")}</b>\n                                    <a onClick={this.handleClickContactImport}>{gettext(\"Import from contacts\")}</a>\n                                </span>\n                            }\n                            <span className=\"searching\">\n                                {gettext(\"Searching...\")}\n                            </span>\n                            <span className=\"no-result\">\n                                {gettext(\"No users found\")}\n                            </span>\n                            <span className=\"success\">\n                                <b>{gettext(\"Success!\")}</b>\n                                {sentMessage}\n                                <a className=\"close\" onClick={this.handleContinue}>{gettext(\"Continue\")}</a>\n                            </span>\n                        </div>\n                        <div className=\"send\" style={Display.NoneIf(selectedUser == null)}>\n                            {selectedUser && \n                                <span className=\"recipient\">\n                                    <img alt=\"user image\" className={selectedUser.type === 'email' && 'email'} src={selectedUser.profile_image_url} />\n                                    <b>{selectedUser.fullname}</b>\n                                    <small>{this.getPrefix(selectedUser)}{selectedUser.username}</small>\n                                </span>\n                            }\n                            <fieldset>\n                                <textarea placeholder=\"Add a message\" value={sendNote} onChange={this.handleSendNoteInput} />\n                                <button className=\"btn-send\" disabled={!noteSendable} onClick={this.handleSend}>Send</button>\n                            </fieldset>\n                        </div>\n                    </div>\n                    }\n                    <SNSShareBox showShareBox={isSNS} title={title} referrerURL={referrerURL}\n                                 objectId={objectId} objectType={objectType} objectMeta={objectMeta}\n                                 viewerUsername={viewerUsername} />\n                </div>\n                <div className=\"contact-sns\" style={Display.NoneIf(!isContact)}>\n                    <a onClick={this.handleClickBackFromContact} className=\"back\">Back</a>\n                    <a href=\"/find-friends\" className=\"fb\" target=\"_blank\"><em> Facebook</em></a>\n                    <a href=\"/find-friends?type=twitter\" className=\"tw\" target=\"_blank\"><em> Twitter</em></a>\n                    <a href=\"/find-friends?type=gmail\" className=\"gm\" target=\"_blank\"><em> Gmail</em></a>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport class SNSShareBox extends React.Component {\n    state = {\n        copied: false,\n        referrerURL: '',\n        textboxDisplay: false\n    };\n    loading = false;\n    snsShareWindow = null;\n\n    getRefURL() {\n        return this.state.referrerURL || this.props.referrerURL\n    }\n\n    updateEmbedOption($li, viewerUsername) {\n        const $thumb = $li.find('.embed-thum');\n        const $options = $li.find('input[name=\"embed-info\"]');\n        const types = [];\n\n        $options.each(function() {\n            const { value, checked } = this;\n            if (checked) {\n                $thumb.addClass(value);\n                types.push(value);\n            } else {\n                $thumb.removeClass(value);\n            }\n        });\n        const width = parseInt($li.find('input[name=\"embed-width\"]').val(), 10) || undefined;\n\n        const snippet = $('<script />', {\n            'src': `//${location.hostname}/embed.js?v=150608`,\n            'async': true,\n            'class': 'fancy-embed',\n            'data-id': $li.attr('tid') || $li.attr('objectId') || '',\n            'data-ref': viewerUsername,\n            'data-type': types.length > 0 ? types.join(',') : '',\n            'data-width': width\n        }).prop('outerHTML');\n        $li.find('textarea[name=\"embed-code\"]').val(snippet);\n    }\n\n    handleEmbed = () => {\n        const { updateEmbedOption, props: { objectType, objectId, viewerUsername } } = this;\n\n        if (objectType === ShareObjectTypes.thing) {\n            const $ep = $(\"#embed_popup\");\n            $ep\n                .off('click.fancyembed')\n                .off('keyup.fancyembed')\n                .on('click.fancyembed', 'input[name=\"embed-info\"]', function() {\n                    updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n                })\n                .on('keyup.fancyembed', 'input[name=\"embed-width\"]', function() {\n                    updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n                });\n\n            $ep.find('.customize').removeClass('opened');\n            $ep.find('input[name=\"embed-info\"]').prop('checked', true);\n            $ep.find('input[name=\"embed-width\"]').val(450);\n            $ep.attr('tid', objectId);\n            updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n\n            $.dialog(\"embed_item\").open(true);\n        }\n\n        return false;\n    }\n\n    handleShare = (event) => {\n        const { props: { objectId, objectType } } = this;\n        const element = event.currentTarget;\n\n        // redirect to acquired URL using blank window, which does not blocked by blocker usually.\n        // Low possiblity, but if assign fails with DOMException, silently pass so\n        // user can retry without confusion.\n        if (event.detail && event.detail.faintClick) {\n            try {\n                this.snsShareWindow.location.assign(element.getAttribute('href'));\n            } catch (e) {}\n            // Remove disposable window \n            this.snsShareWindow = null;\n            return;\n        } else {\n            if (!this.getRefURL()) {\n                this.snsShareWindow = window.open('about:blank', '_fancy_sns_share');\n            }\n            event.preventDefault();\n        }\n\n        getShareURL(this, (directClick) => {\n            if (directClick) {\n                window.open(element.getAttribute('href'), '_fancy_sns_share');\n            } else {\n                triggerEvent(element, 'click', { faintClick: true });\n            }\n        });\n\n        if (objectType === ShareObjectTypes.thing) {\n            const type = SNSDict[element.className];\n            MP('Complete Share', { \"thing id\": objectId, type });\n        }\n    }\n\n    render() {\n        const { title, showShareBox, objectType } = this.props;\n        const { textboxDisplay } = this.state;\n        const referrerURL = this.getRefURL()\n\n        return (\n            <div id=\"more-share-sns\" className=\"more-share-sns\" style={showShareBox ? Display.Block : Display.None}>\n                <span className=\"via after\" style={Display.NoneIf(textboxDisplay)}>\n                    <a href={`https://www.facebook.com/sharer.php?u=${referrerURL}`}\n                        onClick={this.handleShare} className=\"fb\" target=\"_blank\">\n                        <span className=\"ic-fb\" /> <em>{gettext(\"Share with Facebook\")}</em>\n                    </a>\n                    <a href={`https://twitter.com/share?text=${encodeURI(title)}&url=${referrerURL}&via=fancy`}\n                        onClick={this.handleShare} className=\"tw\" target=\"_blank\">\n                        <span className=\"ic-tw\" /> <em>{gettext(\"Share with Twitter\")}</em>\n                    </a>\n                    <a href={`https://www.tumblr.com/share/link?url=${referrerURL}&name=${encodeURI(title)}&description=${encodeURI(title)}`}\n                        onClick={this.handleShare} className=\"tb\" target=\"_blank\">\n                        <span className=\"ic-tb\" /> <em>{gettext(\"Share with Tumblr\")}</em>\n                    </a>\n                    {objectType === ShareObjectTypes.thing &&\n                        <a onClick={this.handleEmbed} className=\"embed\">\n                            <span className=\"ic-em\" /> <em>{gettext(\"Embed this item\")}</em>\n                        </a>\n                    }\n                </span>\n            </div>\n        );\n    }\n}\n","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { KEYS, MP, getDisplay, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\n\nexport class AddlistPopover extends Component {\n    state = {\n        lists: [],\n        wanted: false,\n        listSearchQuery: '',\n        listCreationQuery: '',\n        createListFocused: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    drawUserList(objectId) {\n        objectId = objectId || this.props.objectId;\n        getListCheckbox({\n            merchantId: this.props.merchantId,\n            objectId,\n            callback: res => { this.setStateSafe(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setStateSafe({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId, objectType, merchantId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        // save new list\n        createList({\n            merchantId,\n            listCreationQuery,\n            callback: () => {\n                this.setStateSafe({ listCreationQuery: '' }, () => {\n                    this.drawUserList(objectId);\n                    this.quickCreateList.focus();\n                    if (objectType === 'thing') {\n                        MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    }\n                })\n            }\n        })\n    }\n\n    handleWishlistCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectType, objectId, handleHide } = this.props;\n        const name = 'wanted';\n        const params = { owned: false, wanted: targ.checked };\n        const eventName = targ.checked ? \"Add to List\" : \"Remove from List\";\n\n        if (objectType === 'thing') {\n            if (params.wanted && window.dataLayer) {\n                window.dataLayer.push({'event': 'Add_to_Wishlist_Check', 'product_id': undefined, 'products_info': undefined, 'products': undefined, 'revenue': undefined, 'option_id': undefined });\n            }\n\n            $.ajax(`/rest-api/v1/things/${objectId}`, { type:'PUT', data: params })\n                .done(() => {\n                    this.drawUserList(objectId);\n                    this.setStateSafe({ wanted: params.wanted });\n                    if (params.wanted) {\n                        handleHide && handleHide();\n                    }\n                })\n                .error(err => { console.warn(err); });\n\n            MP(eventName, { 'thing id': objectId, 'list name': name, 'list id': -1, 'via': 'thing detail' });\n        } else {\n            console.warn('Add to list does not work with non-thing type')\n            return;\n        }\n    }\n\n    handleListCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const isChecked = targ.checked;\n        const { objectId, objectType, handleHide, merchantId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = targ.getAttribute('data-listid')\n        const collectionAction = [Number(selectedListId), targ.checked]\n\n        if (objectType === 'thing') {\n            const eventName = isChecked ? \"Add to List\" : \"Remove from List\";\n            const theList = lists.filter(list => list.id === selectedListId)[0];\n            const callback = () => {\n                this.drawUserList(objectId);\n                if (isChecked) {\n                    handleHide && handleHide();\n                }\n                MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n            };\n\n            if (merchantId) {\n                updateList({ merchantId, objectId, collectionAction, callback })\n            } else {\n                const checked = [];\n                const unchecked = [];\n                $(this.lists).find('input[type=\"checkbox\"]:not(.tag)').each(function() {\n                    const listId = this.getAttribute('data-listid');\n                    if (this.checked) {\n                        checked.push(listId);\n                    } else {\n                        unchecked.push(listId)\n                    }\n                });\n                updateList({ checked, unchecked, objectId, callback })\n            }\n\n        } else {\n            console.warn('Add to list does not work with non-thing type')\n            return;\n        }\n    }\n\n    isWishlistQuery(listSearchQuery) {\n        return 'wishlist'.indexOf($.trim(listSearchQuery).toLowerCase()) !== -1\n    }\n\n    handleCreateListLabelClick = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setStateSafe({ createListFocused: true }, () => {\n            this.quickCreateList.focus();\n        });\n    }\n\n    handleCreateListBlur = () => {\n        this.setStateSafe({ createListFocused: false });\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setStateSafe({ listCreationQuery: event.target.value });\n    }\n\n    componentDidMount() {\n        this.mounted = true;\n        this.listDrawn = false;\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n    }\n\n    componentDidUpdate(pp) {\n        if (\n            (pp.showList !== this.props.showList || this.listDrawn === false) &&\n            this.props.showList === true\n        ) {\n            if (this.listDrawn === false) {\n                this.listDrawn = true\n            }\n            this.drawUserList(this.props.objectId);\n            setTimeout(() => {\n                this.listSearchInput.focus();\n            }, 0);\n        }\n    }\n\n    render() {\n        var { objectId, showList, headerGap, merchantId } = this.props;\n        var {\n            lists,\n            wanted,\n            listSearchQuery,\n            listCreationQuery,\n            createListFocused\n        } = this.state;\n\n        return (\n            <div id=\"show-addlist\" className={classnames(\"has-arrow more-share-popup\", { bot: headerGap && (headerGap < 16 + 269) /*= tip + bubble*/ })}\n                 style={getDisplay(showList)}>\n                <span className=\"tit\">{merchantId ? gettext(\"Add to Collection\") : gettext(\"Add to List\")}</span>\n                <span className=\"search before-bg-share2\">\n                    <input ref={(element) => {this.listSearchInput = element;}}\n                            type=\"text\"\n                            className=\"text\"\n                            placeholder={merchantId ? gettext('Search your collections') : gettext('Search your lists')}\n                            value={listSearchQuery}\n                            onChange={this.handleListSearch} />\n                </span>\n                <ul className=\"lists\" ref={(element) => {this.lists = element;}}>\n                    {!merchantId && <li>\n                        <label htmlFor={`wanted-${objectId}`}>\n                            <input type=\"checkbox\" name=\"wanted\"\n                                   checked={wanted}\n                                   id={`wanted-${objectId}`}\n                                   className={`tag ${wanted ? 'checked' : ''}`}\n                                   style={{ display: this.isWishlistQuery(listSearchQuery) ? null : 'none' }}\n                                   onChange={this.handleWishlistCheckboxChange} /> {gettext('Wish List')}</label>\n                    </li>}\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const className = list.selected ? \"selected\" : null;\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style}>\n                                <label htmlFor={ident}>\n                                    <input className={className}\n                                           type=\"checkbox\" name={ident} id={ident}\n                                           checked={list.selected}\n                                           data-listid={list.id}\n                                           onChange={this.handleListCheckboxChange} /> {list.name}</label>\n                            </li>\n                        )\n                    })}\n                </ul>\n                <div className=\"new-list\">\n                    <label htmlFor=\"quick-create-list\"\n                            style={{ display: createListFocused ? 'none' : 'block' }}\n                            onClick={this.handleCreateListLabelClick}>\n                        <i className=\"icon\" />{merchantId ? gettext('Create New Collection') : gettext(\"Create New List\")}</label>\n                    <input type=\"text\"\n                            id=\"quick-create-list\"\n                            ref={(element) => {this.quickCreateList = element;}}\n                            onBlur={this.handleCreateListBlur}\n                            onKeyUp={this.handleListCreation}\n                            onChange={this.handleCreateListQueryChange}\n                            value={listCreationQuery}\n                            placeholder={merchantId ? gettext('Create New Collection') : gettext(\"Create New List\")} />\n                    <button className=\"btn-create\"\n                            onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </div>\n            </div>\n        );\n    }\n}\n\nfunction getListCheckbox({ merchantId, objectId, callback }) {\n    if (merchantId) {\n        $.get(`/rest-api/v1/seller/${merchantId}/collections`, { selected_object_id: objectId }).done(({ collections } = {}) => {\n            let lists;\n            if (collections.length > 0) {\n                lists = collections.sort((a, b) => {\n                    var aText = $.trim(a).toLowerCase();\n                    var bText = $.trim(b).toLowerCase();\n                    return aText < bText ? -1 : 1;\n                }).map(({ id, name, selected }) => {\n                    return {\n                        id,\n                        name,\n                        selected\n                    };\n                })\n            } else {\n                lists = [];\n            }\n            callback && callback({ lists, wanted: null });\n        })\n        .error(err => { console.warn(err); });\n    } else {\n        $.get('/_get_list_checkbox.html', { tid: objectId }).done(html => {\n            const $html = $(html);\n            const $items = $html.filter('li').find('img').remove().end();\n            var lists;\n            if ($items.length > 0) {\n                lists = $items.sort((a, b) => {\n                    var aText = $.trim($(a).text()).toLowerCase();\n                    var bText = $.trim($(b).text()).toLowerCase();\n                    return aText < bText ? -1 : 1;\n                }).map((_, item) => {\n                    var $item = $(item);\n                    return {\n                        id: $item.find('label').attr('for'),\n                        name: $.trim($item.find('label').text()),\n                        selected: $item.find('input').prop('checked'),\n                    };\n                }).get();\n            } else {\n                lists = [];\n            }\n            const wanted = $html.filter('input[name=\"wanted\"]').val() === 'true';\n            callback && callback({ lists, wanted });\n        })\n        .error(err => { console.warn(err); });\n    }\n}\n\n\nfunction createList({ merchantId, listCreationQuery, callback }) {\n    if (merchantId) {\n        $.post(`/rest-api/v1/seller/${merchantId}/collections`, { list_name: listCreationQuery })\n            .done(res => {\n                // if ($(res).find(\"created\").text() == 'False') {\n                // if (false){\n                //     alertify.alert(`List Title Not Available`, `There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                // } else {\n                    callback && callback();\n                // }\n            })\n            .error(err => { console.warn(err); });\n    } else {\n        $.post('/create_list.xml', { list_name: listCreationQuery, reaction: 0 })\n            .done(res => {\n                if ($(res).find(\"created\").text() == 'False') {\n                    alertify.alert(`<b>List Title Not Available</b><br><br>There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                } else {\n                    callback && callback();\n                }\n            })\n            .error(err => { console.warn(err); });\n    }\n}\n\nfunction updateList({ merchantId, collectionAction, objectId, checked, unchecked, callback }) {\n    if (merchantId) {\n        const [collectionId, add] = collectionAction\n        $.ajax({\n            url: `/rest-api/v1/seller/${merchantId}/collections/${collectionId}`,\n            type: 'POST',\n            data: {\n                object_id: objectId,\n                action: add ? 'add': 'remove',\n            },\n        })\n        .done(callback)\n        .error(err => { console.warn(err); })\n    } else {\n        $.post('/save_list_items', {\n            tid: objectId,\n            checked_list_ids: checked.join(','),\n            unchecked_list_ids: unchecked.join(',')\n        })\n        .done(callback)\n        .error(err => { console.warn(err); })\n    }\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\n\nimport { FancyUser, renderPopup, isPlainLeftClick } from \"fancyutils\";\nimport { ShareObjectTypes } from './MoreShareUtils';\n\n\nexport class FancydPerson extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            loading: false,\n            following: false\n        };\n    }\n\n    componentDidMount() {\n        const following = this.props.following || this.props.user.following;\n        if (following) {\n            this.setState({ following });\n        }\n    }\n\n    handleFollow = event => {\n        event.preventDefault();\n        event.stopPropagation();\n\n        const { user } = this.props;\n        const { following, loading } = this.state;\n\n        if (this.props.loggedIn !== true) {\n            window.require_login();\n            return;\n        }\n\n        if (loading) {\n            return;\n        }\n\n        const url = following ? \"/delete_follow.xml\" : \"/add_follow.xml\";\n\n        this.setState({ loading: true }, () => {\n            $.ajax({\n                type: \"post\",\n                url,\n                data: { user_id: user.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    const nextFollowing = !following;\n                    const $status = $(xml).find(\"status_code\");\n                    if ($status.length && $status.text() !== 0) {\n                        this.setState({ following: nextFollowing });\n                    }\n                })\n                .always(() => {\n                    this.setState({ loading: false });\n                });\n        });\n    };\n\n    handleTransition = event => {\n        if (isPlainLeftClick(event)) {\n            const href = event.currentTarget.getAttribute(\"href\");\n            if (href) {\n                location.href = href;\n            }\n        }\n    };\n\n    render() {\n        const { user, isAddedUser, viewerId } = this.props;\n        const { following } = this.state;\n\n        return (\n            <li>\n                <a href={`/${user.username}`} className=\"username\" onClick={this.handleTransition}>\n                    <img\n                        src=\"/_ui/images/common/blank.gif\"\n                        style={{ backgroundImage: `url(${user.image_url || user.user_square_image_small})` }}\n                    />\n                    {isAddedUser ? \"Added by \" : \"\"}\n                    <b>{user.fullname || user.full_name}</b>\n                    {isAddedUser ? \"\" : `@${user.username}`}\n                </a>\n                {viewerId !== user.id && (\n                    <button\n                        className={classnames(\"btns-gray-embo\", following ? \"following\" : \"follow\")}\n                        onClick={this.handleFollow}\n                    />\n                )}\n            </li>\n        );\n    }\n}\n\nexport class FancydByPopup extends React.Component {\n    static popupName = \"fancyd_list\";\n\n    constructor(props) {\n        super(props);\n        this.state = this._getInitialState();\n    }\n\n    _getInitialState() {\n        return {\n            loading: false,\n            nextPage: 1,\n            ended: null,\n            added_user: null,\n            users: [],\n            owner: null\n        };\n    }\n\n    getFollowList(nextProps, reset) {\n        const { objectId, objectType } = nextProps || this.props;\n        const { nextPage } = this.state;\n\n        var immediateNextStateUpdate;\n        if (reset) {\n            immediateNextStateUpdate = this._getInitialState();\n            immediateNextStateUpdate.loading = true;\n        } else {\n            immediateNextStateUpdate = { loading: true };\n        }\n\n        if (reset || (this.state.loading !== true && this.state.ended !== true)) {\n            this.setState(immediateNextStateUpdate, () => {\n                if (objectType === ShareObjectTypes.thing) {\n                    $.get(\"/thing_follower_list.json\", { thing_id: objectId, page: nextPage }, ({ has_next, users, owner }) => {\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                } else if (objectType === ShareObjectTypes.article) {\n                    $.get(`/rest-api/v1/articles/${objectId}/saved_users`, { page: nextPage }, ({ max_page, current_page, saved_users }) => {\n                        const users = saved_users;\n                        const has_next = max_page > current_page;\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner: null };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                }\n                \n            });\n        }\n    }\n\n    componentDidMount() {\n        this.getFollowList();\n        this.__last_tid = this.props.objectId;\n    }\n\n    componentDidUpdate(nextProps) {\n        if (this.__last_tid !== nextProps.objectId) {\n            this.__last_tid = nextProps.objectId;\n            this.getFollowList(nextProps, true);\n        }\n    }\n\n    handleMore = event => {\n        event.preventDefault();\n        this.getFollowList();\n    };\n\n    render() {\n        const { ended, users, owner } = this.state;\n        const { loggedIn, viewerId } = this.props;\n        return (\n            <div>\n                {/* TODO: via-overlay is needed to distinguish jQuery-attached Events and React Events -\n                    need to deliver better alternative \n                    rel task: https://app.asana.com/0/86925821949642/152825012917493 */}\n                <p className=\"ltit\">{gettext(\"Fancy'd by\")}</p>\n                <ul>\n                    {owner ? (\n                        <FancydPerson user={owner} isAddedUser={true} viewerId={viewerId} loggedIn={loggedIn} />\n                    ) : null}\n                    {users.map((user, idx) => (\n                        <FancydPerson key={`FancydBy-${idx}`} user={user} viewerId={viewerId} loggedIn={loggedIn} />\n                    ))}\n                    {ended === false && (\n                        <li className=\"more\">\n                            <a onClick={this.handleMore}>{gettext(\"View More\")}</a>\n                        </li>\n                    )}\n                </ul>\n                <button className=\"ly-close\" title=\"Close\">\n                    <i className=\"ic-del-black\" />\n                </button>\n            </div>\n        );\n    }\n}\n\nexport class FancydByPopupV4 extends React.Component {\n    static popupName = \"fancyd_list\";\n\n    constructor(props) {\n        super(props);\n        this.state = this._getInitialState();\n    }\n\n    _getInitialState() {\n        return {\n            loading: false,\n            nextPage: 1,\n            next_cursor: null,\n            ended: null,\n            added_user: null,\n            users: [],\n            owner: null\n        };\n    }\n\n    getFollowList(nextProps, reset) {\n        const { objectId, objectType, next_cursor } = nextProps || this.props;\n        const { nextPage } = this.state;\n\n        var immediateNextStateUpdate;\n        if (reset) {\n            immediateNextStateUpdate = this._getInitialState();\n            immediateNextStateUpdate.loading = true;\n        } else {\n            immediateNextStateUpdate = { loading: true };\n        }\n\n        if (reset || (this.state.loading !== true && this.state.ended !== true)) {\n            this.setState(immediateNextStateUpdate, () => {\n                if (objectType === ShareObjectTypes.thing) {\n                    $.get(`/rest-api/v1/things/${objectId}/fancyd-users?${next_cursor ? `cursor=${next_cursor}` : '' }`, { thing_id: objectId, page: nextPage }, ({ next_cursor, fancyd_users }) => {\n                        const nextState = { loading: false, users: this.state.users.concat(fancyd_users), owner: null };\n                        if (!!next_cursor) {\n                            nextState.next_cursor = this.state.next_cursor;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                } else if (objectType === ShareObjectTypes.article) {\n                    $.get(`/rest-api/v1/articles/${objectId}/saved_users`, { page: nextPage }, ({ max_page, current_page, saved_users }) => {\n                        const users = saved_users;\n                        const has_next = max_page > current_page;\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner: null };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                }\n                \n            });\n        }\n    }\n\n    componentDidMount() {\n        this.getFollowList();\n        this.__last_tid = this.props.objectId;\n    }\n\n    componentDidUpdate(nextProps) {\n        if (this.__last_tid !== nextProps.objectId) {\n            this.__last_tid = nextProps.objectId;\n            this.getFollowList(nextProps, true);\n        }\n    }\n\n    handleMore = event => {\n        event.preventDefault();\n        this.getFollowList();\n    };\n\n    render() {\n        const { ended, users, owner } = this.state;\n        const { loggedIn, viewerId } = this.props;\n        return (\n            <div>\n                {/* TODO: via-overlay is needed to distinguish jQuery-attached Events and React Events -\n                    need to deliver better alternative \n                    rel task: https://app.asana.com/0/86925821949642/152825012917493 */}\n                <p className=\"ltit\">{gettext(\"Fancy'd by\")}</p>\n                <ul>\n                    {owner ? (\n                        <FancydPerson user={owner} isAddedUser={true} viewerId={viewerId} loggedIn={loggedIn} />\n                    ) : null}\n                    {users.map((user, idx) => (\n                        <FancydPerson key={`FancydBy-${idx}`} user={user} viewerId={viewerId} loggedIn={loggedIn} />\n                    ))}\n                    {ended === false && (\n                        <li className=\"more\">\n                            <a onClick={this.handleMore}>{gettext(\"View More\")}</a>\n                        </li>\n                    )}\n                </ul>\n                <button className=\"ly-close\" title=\"Close\">\n                    <i className=\"ic-del-black\" />\n                </button>\n            </div>\n        );\n    }\n}\n\n// const onLoad = () => { \n//     $(document.body).on(\"click\", \".buttons .fancyd_user\", function() {\n//         if ($(this).closest('#overlay-thing').length > 0) {\n//             return true;\n//         }\n//         const $container = $(this).closest(\".buttons\");\n//         const objectId = $container.find(\".fancy, .fancyd\").attr(\"tid\");\n//         const objectType = 'thing';\n//         if (objectId) {\n//             renderPopup(FancydByPopup, { objectId, objectType, loggedIn: FancyUser.loggedIn, viewerId: FancyUser.id });\n//             return false;\n//         }\n//     });\n// }\n\n// if (document.readyState !== 'loading') {\n//     onLoad()\n// } else {\n//     document.addEventListener(\"DOMContentLoaded\", onLoad)\n// }\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { renderPopup, copyToClipboard, isElementOutsideViewport, MP, ClickOutside, FancyUser } from \"fancyutils\";\nimport { getElementGapFromHeader } from \"fancymixin\";\n\nimport { SharePopover } from \"./SharePopover\";\nimport { AddlistPopover } from \"./AddlistPopover\";\nimport { ShareObjectTypes, getShareURL } from \"./MoreShareUtils\";\nimport { FancydByPopup } from \"./Popup\";\n\n// returns dictionary with only one value true and else is false\nfunction makeToggle(keys) {\n    const obj = {};\n    return function toggle(...toggleKeys) {\n        keys.forEach(key => {\n            obj[key] = false;\n        });\n        if (toggleKeys) {\n            toggleKeys.forEach(key => {\n                obj[key] = true;\n            });\n        }\n        return obj;\n    };\n}\nconst toggleShow = makeToggle([\"showShare\", \"showList\", \"showSellerList\", \"showMenu\"]);\n\n\n\nexport class MoreShare extends Component {\n    state = {\n        showShare: false,\n        showList: false,\n        showMenu: false,\n        headerGap: null,\n\n        referrerURL: null,\n        linkCopied: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    componentDidMount() {\n        this.mounted = true;\n        this.clickOutside = new ClickOutside({ component: this, popupElementRefKey: \"MoreShareEl\" });\n        \n        if (this.props.facadeShowShare) {\n            this.handleShareDisplay();\n        }\n        if (this.props.facadeShowList) {\n            this.handleMoreShareToggle();\n        }\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n        this.clickOutside.destroy();\n    }\n\n    componentDidUpdate(pp, ps) {\n        const ns = this.state;\n        const { showList, showShare, showMenu } = ns;\n        if (showList || showShare || showMenu) {\n            this.clickOutside.handleAttach(this.closePopup);\n            this.checkViewport();\n\n            if (showShare || showMenu) {\n                getShareURL(this);\n            }\n        }\n\n        if (ns.showMenu !== ps.showMenu && ns.showMenu === false) {\n            this.setState({ linkCopied: false });\n            clearTimeout(this.linkCopiedRemovalTimer);\n            this.linkCopiedRemovalTimer = null;\n        }\n    }\n\n    handleShareDisplay = () => {\n        this.setStateSafe(\n            {\n                showShare: !this.state.showShare,\n                showList: false,\n                showMenu: false,\n                headerGap: getElementGapFromHeader(this.moreMenuButton)\n            },\n            this.handleHook\n        );\n        if (this.props.objectType === ShareObjectTypes.thing) {\n            MP(\"Share\", { \"thing id\": this.props.objectId });\n        }\n    };\n\n    handleListDisplay = () => {\n        if (!FancyUser.loggedIn) {\n            this.closePopup();\n            window.require_login();\n            return;\n        }\n        const showList = !this.state.showList;\n        this.setStateSafe(toggleShow(showList ? \"showList\" : null), this.handleHook);\n    };\n\n    handleMerchantListDisplay = () => {\n        if (!FancyUser.loggedIn) {\n            this.closePopup();\n            window.require_login();\n            return;\n        }\n        const showSellerList = !this.state.showSellerList;\n        this.setStateSafe(toggleShow(showSellerList ? \"showSellerList\" : null), this.handleHook);\n    };\n\n    closePopup = () => {\n        this.removeViewportCheck();\n        this.setStateSafe(toggleShow(), this.handleHook);\n    };\n\n    viewPortChecking = false;\n    evtName = \"scrollstop.MoreShare\";\n    checkViewport = () => {\n        if (this.viewPortChecking) {\n            return;\n        }\n        this.viewPortChecking = true;\n        $(window).on(this.evtName, () => {\n            const $root = $(this.MoreShareEl);\n            const headerEl = $(\"#header .header-featured\").get(0);\n\n            const { showMenu, showShare, showList, showSellerList } = this.state;\n            let sel;\n            if (showMenu) {\n                sel = \"#more-menu\";\n            } else if (showShare) {\n                sel = \"#show-share\";\n            } else if (showList || showSellerList) {\n                sel = \"#show-addlist\";\n            }\n            const el = $root.find(sel).get(0);\n            if (el) {\n                const outsideViewport = isElementOutsideViewport(el, { element: headerEl, type: \"top\" });\n\n                if (outsideViewport) {\n                    this.closePopup();\n                }\n            }\n        });\n    };\n\n    removeViewportCheck = () => {\n        this.viewPortChecking = false;\n        $(window).off(this.evtName);\n    };\n\n    handleMoreShareToggle = () => {\n        const { objectType } = this.props;\n        const { showMenu, showShare, showList, showSellerList } = this.state;\n        // thing types will show menu\n        if (objectType === ShareObjectTypes.thing || objectType === ShareObjectTypes.article) {\n            if (showMenu || showShare || showList || showSellerList) {\n                this.closePopup();\n            } else {\n                this.setStateSafe(\n                    {\n                        showMenu: true,\n                        headerGap: getElementGapFromHeader(this.moreMenuButton)\n                    },\n                    this.handleHook\n                );\n            }\n            // non-thing types will show share popover directly, because add-to-list is not available\n        } else {\n            this.handleShareDisplay();\n        }\n        return false;\n    };\n\n    handleHook = () => {\n        if (this.props.onShowSomething) {\n            const { showList, showShare, showMenu, showSellerList } = this.state;\n            this.props.onShowSomething(showList || showShare || showMenu || showSellerList, this);\n        }\n    };\n\n    handleHideList = () => {\n        this.setStateSafe({ showList: false });\n    };\n\n    handleHideShare = () => {\n        this.setStateSafe({ showShare: false });\n    };\n\n    linkCopiedRemovalTimer = null;\n    handleCopyLink = () => {\n        if (this.linkCopiedRemovalTimer != null) {\n            return;\n        }\n        copyToClipboard(this.state.referrerURL, {\n            cb: () => {\n                this.setState({ linkCopied: true });\n                this.linkCopiedRemovalTimer = setTimeout(() => {\n                    this.setState({ linkCopied: false });\n                }, 5000);\n            }\n        });\n    };\n\n    handleFancydByDisplay = () => {\n        event.preventDefault();\n        event.stopPropagation();\n        const { viewerUsername, objectId, objectType } = this.props;\n\n        renderPopup(FancydByPopup, { objectId, objectType, loggedIn: FancyUser.loggedIn, viewerId: viewerUsername });\n    };\n\n    shouldShowMerchantCollection() {\n        return FancyUser.merchant && FancyUser.active_merchant;\n    }\n\n    render() {\n        const {\n            title,\n            viewerUsername,\n            componentClass = \"menu-container\",\n            btnClass = \"btn-more\",\n            objectType,\n            objectMeta,\n            objectId,\n            showShortcuts = true,\n            fromThingSidebar = false\n        } = this.props;\n\n        if (objectType == null) {\n            console.warn(\"objectType is not defined\");\n        }\n\n        const {\n            showShare,\n            showList,\n            showMenu,\n            headerGap,\n            referrerURL,\n            linkCopied,\n            showSellerList\n        } = this.state;\n        const isThing = objectType === ShareObjectTypes.thing;\n        const isArticle = objectType === ShareObjectTypes.article;\n\n        let showMerchantList = this.shouldShowMerchantCollection();\n        let merchantId = showMerchantList && showSellerList ? FancyUser.id : null;\n        const newLayout = fromThingSidebar;\n\n        return (\n            <em\n                className={classnames(componentClass, \"on-home ignore-ext\", {\n                    open: showShare || showList || showMenu\n                })}\n                ref={el => {\n                    this.MoreShareEl = el;\n                }}\n                data-rendered=\"true\">\n                {newLayout && <button className=\"btn-share\" onClick={this.handleShareDisplay} />}\n                <small\n                    className={btnClass}\n                    onClick={this.handleMoreShareToggle}\n                    ref={element => {\n                        this.moreMenuButton = element;\n                    }}>\n                    {<em>{SharePopover.getShareMessage(objectType, \"Share & Lists\")}</em>}\n                </small>\n                {(isThing || isArticle) && (\n                    <small\n                        id=\"more-menu\"\n                        className={classnames(\"has-arrow menu-content react new\", {\n                            opened: showMenu,\n                            bot: headerGap && headerGap < 16 + 109 /*= tip + bubble*/\n                        })}>\n                        {!newLayout && (\n                            <button className=\"share before-bg-share2\" onClick={this.handleShareDisplay}>\n                                <b>{gettext(\"Share item\")}</b>\n                                <small>{gettext(\"Share this with friends\")}</small>\n                            </button>\n                        )}\n                        {newLayout && (\n                            <button className=\"fancyd-by before-bg-share2\" onClick={this.handleFancydByDisplay}>\n                                <b>{gettext(\"Fancy'd By\")}</b>\n                                <small>{gettext(\"People who fancy'd this\")}</small>\n                            </button>\n                        )}\n                        {isThing && (\n                            <button className=\"add-list before-bg-share2\" onClick={this.handleListDisplay}>\n                                <b>{gettext(\"Lists\")}</b>\n                                <small>{gettext(\"Add this to your saved lists\")}</small>\n                            </button>\n                        )}\n                        {showMerchantList && (\n                            <button className=\"add-list before-bg-share2\" onClick={this.handleMerchantListDisplay}>\n                                <b>{gettext(\"Add to Collection\")}</b>\n                                <small>{gettext(\"Save this to your collections\")}</small>\n                            </button>\n                        )}\n                        {showShortcuts && (\n                            <span>\n                                <button\n                                    style={referrerURL ? null : { opacity: 0.7 }}\n                                    className={classnames(\"copy-link\")}\n                                    onClick={this.handleCopyLink}>\n                                    <b>{linkCopied ? \"Copied to clipboard\" : \"Item link\"}</b>\n                                    <small>Copy link to clipboard</small>\n                                </button>\n                            </span>\n                        )}\n                    </small>\n                )}\n                {isThing && (\n                    <AddlistPopover\n                        key={`${objectId}-${merchantId}` || `${objectId}-addlist`}\n                        objectType={objectType}\n                        objectId={objectId}\n                        showList={showList || showSellerList}\n                        merchantId={merchantId}\n                        viewerUsername={viewerUsername}\n                        handleHide={this.handleHideList}\n                        headerGap={headerGap}\n                    />\n                )}\n                <SharePopover\n                    objectType={objectType}\n                    objectId={objectId}\n                    objectMeta={objectMeta}\n                    showShare={showShare}\n                    title={title}\n                    referrerURL={this.state.referrerURL}\n                    viewerUsername={viewerUsername}\n                    headerGap={headerGap}\n                    handleHide={this.handleHideShare}\n                />\n            </em>\n        );\n    }\n}\n","import React, { Component } from \"react\";\nimport { MoreShare } from \"common-components\";\n\n\nexport class MoreShareFacade extends Component {\n    state = {\n        share: false,\n        list: false\n    };\n\n    handleClickShare = () => {\n        this.setState({ share: true });\n    };\n\n    handleClickList = () => {\n        this.setState({ list: true });\n    };\n\n    render() {\n        const { share, list } = this.state;\n        return (\n            <React.Fragment>\n                {!(share || list) && (\n                    <FakeMoreShare onClickShare={this.handleClickShare} onClickAddlist={this.handleClickList} />\n                )}\n                {(share || list) && <MoreShare {...this.props} facadeShowShare={share} facadeShowList={list} />}\n            </React.Fragment>\n        );\n    }\n}\n\nclass FakeMoreShare extends Component {\n    render() {\n        return (\n            <em className=\"menu-container on-home ignore-ext\" data-rendered=\"true\">\n                <button className=\"btn-share\" onClick={this.props.onClickShare}></button>\n                <small className=\"btn-more\" onClick={this.props.onClickAddlist}>\n                    <em>Share &amp; Lists</em>\n                </small>\n            </em>\n        );\n    }\n}","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\n\nimport { KEYS, MP, getDisplay, isEmpty, alertify } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\n\nexport class AddlistAction extends Component {\n    state = {\n        lists: [],\n        wanted: false,\n        listSearchQuery: \"\",\n        listCreationQuery: \"\",\n        createListFocused: false,\n        showList: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    drawUserList(objectId) {\n        objectId = objectId || this.props.objectId;\n        getListCheckbox({\n            merchantId: this.props.merchantId,\n            objectId,\n            callback: (res) => {\n                this.setStateSafe(res);\n            },\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setStateSafe({ listSearchQuery });\n    };\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (event.type === \"keyup\" && event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId, objectType, merchantId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        // save new list\n        createList({\n            merchantId,\n            listCreationQuery,\n            callback: () => {\n                this.setStateSafe({ listCreationQuery: \"\" }, () => {\n                    this.drawUserList(objectId);\n                    this.quickCreateList.focus();\n                    if (objectType === \"thing\") {\n                        MP(\"Create New List\", {\n                            \"thing id\": objectId,\n                            \"list name\": listCreationQuery,\n                            via: \"thing detail\",\n                        });\n                    }\n                });\n            },\n        });\n    };\n\n    handleWishlistCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectType, objectId, handleHide } = this.props;\n        const name = \"wanted\";\n        const params = { owned: false, wanted: targ.checked };\n        const eventName = targ.checked ? \"Add to List\" : \"Remove from List\";\n\n        if (objectType === \"thing\") {\n            if (params.wanted && window.dataLayer) {\n                window.dataLayer.push({\n                    event: \"Add_to_Wishlist_Check\",\n                    product_id: undefined,\n                    products_info: undefined,\n                    products: undefined,\n                    revenue: undefined,\n                    option_id: undefined,\n                });\n            }\n\n            $.ajax(`/rest-api/v1/things/${objectId}`, { type: \"PUT\", data: params })\n                .done(() => {\n                    this.drawUserList(objectId);\n                    this.setStateSafe({ wanted: params.wanted });\n                    if (params.wanted) {\n                        handleHide && handleHide();\n                    }\n                })\n                .error((err) => {\n                    console.warn(err);\n                });\n\n            MP(eventName, { \"thing id\": objectId, \"list name\": name, \"list id\": -1, via: \"thing detail\" });\n        } else {\n            console.warn(\"Add to list does not work with non-thing type\");\n            return;\n        }\n    };\n\n    handleListCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const isChecked = targ.checked;\n        const { objectId, objectType, handleHide, merchantId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = targ.getAttribute(\"data-listid\");\n        const collectionAction = [Number(selectedListId), targ.checked];\n\n        if (objectType === \"thing\") {\n            const eventName = isChecked ? \"Add to List\" : \"Remove from List\";\n            const theList = lists.filter((list) => list.id === selectedListId)[0];\n            const callback = () => {\n                this.drawUserList(objectId);\n                if (isChecked) {\n                    handleHide && handleHide();\n                }\n                MP(eventName, {\n                    \"thing id\": objectId,\n                    \"list name\": theList.name,\n                    \"list id\": theList.id,\n                    via: \"thing detail\",\n                });\n            };\n\n            if (merchantId) {\n                updateList({ merchantId, objectId, collectionAction, callback });\n            } else {\n                const checked = [];\n                const unchecked = [];\n                $(this.lists)\n                    .find('input[type=\"checkbox\"]:not(.tag)')\n                    .each(function () {\n                        const listId = this.getAttribute(\"data-listid\");\n                        if (this.checked) {\n                            checked.push(listId);\n                        } else {\n                            unchecked.push(listId);\n                        }\n                    });\n                updateList({ checked, unchecked, objectId, callback });\n            }\n        } else {\n            console.warn(\"Add to list does not work with non-thing type\");\n            return;\n        }\n    };\n\n    isWishlistQuery(listSearchQuery) {\n        return \"wishlist\".indexOf($.trim(listSearchQuery).toLowerCase()) !== -1;\n    }\n\n    handleCreateListLabelClick = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setStateSafe({ createListFocused: true }, () => {\n            this.quickCreateList.focus();\n        });\n    };\n\n    handleCreateListBlur = () => {\n        this.setStateSafe({ createListFocused: false });\n    };\n\n    handleCreateListQueryChange = (event) => {\n        this.setStateSafe({ listCreationQuery: event.target.value });\n    };\n\n    componentDidMount() {\n        this.mounted = true;\n        this.listDrawn = false;\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n    }\n\n    componentDidUpdate(pp, ps) {\n        if ((ps.showList !== this.state.showList || this.listDrawn === false) && this.state.showList === true) {\n            if (this.listDrawn === false) {\n                this.listDrawn = true;\n            }\n            this.drawUserList(this.props.objectId);\n            setTimeout(() => {\n                this.listSearchInput.focus();\n            }, 0);\n        }\n    }\n\n    show() {\n        this.setStateSafe({ showList: true });\n    }\n\n    hide() {\n        this.setStateSafe({ showList: false });\n    }\n\n    render() {\n        var { objectId, merchantId } = this.props;\n        var { lists, wanted, listSearchQuery, listCreationQuery, createListFocused, showList } = this.state;\n\n        return (\n            <div id=\"show-addlist\" className=\"has-arrow more-share-popup addlist-action\" style={getDisplay(showList)}>\n                <span className=\"tit\">{merchantId ? gettext(\"Add to Collection\") : gettext(\"Add to List\")}</span>\n                <span className=\"search before-bg-share2\">\n                    <input\n                        ref={(element) => {\n                            this.listSearchInput = element;\n                        }}\n                        type=\"text\"\n                        className=\"text\"\n                        placeholder={merchantId ? gettext(\"Search your collections\") : gettext(\"Search your lists\")}\n                        value={listSearchQuery}\n                        onChange={this.handleListSearch}\n                    />\n                </span>\n                <ul\n                    className=\"lists\"\n                    ref={(element) => {\n                        this.lists = element;\n                    }}>\n                    {!merchantId && (\n                        <li>\n                            <label htmlFor={`wanted-${objectId}`}>\n                                <input\n                                    type=\"checkbox\"\n                                    name=\"wanted\"\n                                    checked={wanted}\n                                    id={`wanted-${objectId}`}\n                                    className={`tag ${wanted ? \"checked\" : \"\"}`}\n                                    style={{ display: this.isWishlistQuery(listSearchQuery) ? null : \"none\" }}\n                                    onChange={this.handleWishlistCheckboxChange}\n                                />{\" \"}\n                                {gettext(\"Wish List\")}\n                            </label>\n                        </li>\n                    )}\n                    {lists &&\n                        lists.map((list, idx) => {\n                            const term = $.trim(listSearchQuery).toLowerCase();\n                            var style;\n                            if (_.isString(term) && term.length > 0) {\n                                style = Display.NoneIf(list.name.toLowerCase().indexOf(term.toLowerCase()) === -1);\n                            }\n                            const className = list.selected ? \"selected\" : null;\n                            const ident = `${objectId}-${list.id}`;\n                            return (\n                                <li key={idx} style={style}>\n                                    <label htmlFor={ident}>\n                                        <input\n                                            className={className}\n                                            type=\"checkbox\"\n                                            name={ident}\n                                            id={ident}\n                                            checked={list.selected}\n                                            data-listid={list.id}\n                                            onChange={this.handleListCheckboxChange}\n                                        />{\" \"}\n                                        {list.name}\n                                    </label>\n                                </li>\n                            );\n                        })}\n                </ul>\n                <div className=\"new-list\">\n                    <label\n                        htmlFor=\"quick-create-list\"\n                        style={{ display: createListFocused ? \"none\" : \"block\" }}\n                        onClick={this.handleCreateListLabelClick}>\n                        <i className=\"icon\" />\n                        {merchantId ? gettext(\"Create New Collection\") : gettext(\"Create New List\")}\n                    </label>\n                    <input\n                        type=\"text\"\n                        id=\"quick-create-list\"\n                        ref={(element) => {\n                            this.quickCreateList = element;\n                        }}\n                        onBlur={this.handleCreateListBlur}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}\n                        placeholder={merchantId ? gettext(\"Create New Collection\") : gettext(\"Create New List\")}\n                    />\n                    <button className=\"btn-create\" onClick={this.handleListCreation}>\n                        {gettext(\"Create\")}\n                    </button>\n                </div>\n            </div>\n        );\n    }\n}\n\nfunction getListCheckbox({ merchantId, objectId, callback }) {\n    if (merchantId) {\n        $.get(`/rest-api/v1/seller/${merchantId}/collections`, { selected_object_id: objectId })\n            .done(({ collections } = {}) => {\n                let lists;\n                if (collections.length > 0) {\n                    lists = collections\n                        .sort((a, b) => {\n                            var aText = $.trim(a).toLowerCase();\n                            var bText = $.trim(b).toLowerCase();\n                            return aText < bText ? -1 : 1;\n                        })\n                        .map(({ id, name, selected }) => {\n                            return {\n                                id,\n                                name,\n                                selected,\n                            };\n                        });\n                } else {\n                    lists = [];\n                }\n                callback && callback({ lists, wanted: null });\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    } else {\n        $.get(\"/_get_list_checkbox.html\", { tid: objectId })\n            .done((html) => {\n                const $html = $(html);\n                const $items = $html.filter(\"li\").find(\"img\").remove().end();\n                var lists;\n                if ($items.length > 0) {\n                    lists = $items\n                        .sort((a, b) => {\n                            var aText = $.trim($(a).text()).toLowerCase();\n                            var bText = $.trim($(b).text()).toLowerCase();\n                            return aText < bText ? -1 : 1;\n                        })\n                        .map((_, item) => {\n                            var $item = $(item);\n                            return {\n                                id: $item.find(\"label\").attr(\"for\"),\n                                name: $.trim($item.find(\"label\").text()),\n                                selected: $item.find(\"input\").prop(\"checked\"),\n                            };\n                        })\n                        .get();\n                } else {\n                    lists = [];\n                }\n                const wanted = $html.filter('input[name=\"wanted\"]').val() === \"true\";\n                callback && callback({ lists, wanted });\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    }\n}\n\nfunction createList({ merchantId, listCreationQuery, callback }) {\n    if (merchantId) {\n        $.post(`/rest-api/v1/seller/${merchantId}/collections`, { list_name: listCreationQuery })\n            .done((res) => {\n                // if ($(res).find(\"created\").text() == 'False') {\n                // if (false){\n                //     alertify.alert(`List Title Not Available`, `There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                // } else {\n                callback && callback();\n                // }\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    } else {\n        $.post(\"/create_list.xml\", { list_name: listCreationQuery, reaction: 0 })\n            .done((res) => {\n                if ($(res).find(\"created\").text() == \"False\") {\n                    alertify.alert(\n                        `<b>List Title Not Available</b><br><br>There is already a list named ${listCreationQuery}. Try again with a different name.`\n                    );\n                } else {\n                    callback && callback();\n                }\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    }\n}\n\nfunction updateList({ merchantId, collectionAction, objectId, checked, unchecked, callback }) {\n    if (merchantId) {\n        const [collectionId, add] = collectionAction;\n        $.ajax({\n            url: `/rest-api/v1/seller/${merchantId}/collections/${collectionId}`,\n            type: \"POST\",\n            data: {\n                object_id: objectId,\n                action: add ? \"add\" : \"remove\",\n            },\n        })\n            .done(callback)\n            .error((err) => {\n                console.warn(err);\n            });\n    } else {\n        $.post(\"/save_list_items\", {\n            tid: objectId,\n            checked_list_ids: checked.join(\",\"),\n            unchecked_list_ids: unchecked.join(\",\"),\n        })\n            .done(callback)\n            .error((err) => {\n                console.warn(err);\n            });\n    }\n}\n","import createHistory from \"history/createBrowserHistory\";\n\nexport const history = createHistory()\n","// fork of recommend-slide (accacb79d2af557369e02132ef5f486d226aa5d3)\nexport default function applyProductSlide() {\n    $(function() {\n        var mWidth = 920;\n\n        function initSlide($el, option) {\n            var $slide;\n            if ($el.is('.itemSlide, .slideshow')) {\n                $slide = $el;\n            } else {\n                $slide = $el.find(\".itemSlide, .slideshow\");\n            }\n            $slide.data('slideInit', true);\n            var $list = $el.find(\"ul\"),\n                $li = $list.find(\"li\"),\n                itemWidth = $li.width() + 20,\n                $prev = $el.find(\"a.prev\"),\n                $next = $el.find(\"a.next\");\n            var slideWidth = null;\n\n            if (option.itemPerSlide) slideWidth = itemWidth * option.itemPerSlide;\n\n            function resetRecommend() {\n                if (!$slide || !$li) {\n                    $el.css(\"visibility\", \"visible\");\n                    return;\n                }\n\n                if (slideWidth && slideWidth > itemWidth * $li.length) {\n                    $el.css(\"visibility\", \"visible\");\n                    return;\n                }\n\n                if ($(window).width() < mWidth) {\n                    if (option.center) {\n                        $slide.find(\".itemList\").scrollLeft(($li.length * 147 - $(window).width() + 20) / 2);\n                    }\n                    $prev.removeClass(\"disabled\");\n                    $next.removeClass(\"disabled\");\n                } else {\n                    if ($slide.width() > itemWidth * $li.length) {\n                        $prev.addClass(\"disabled\");\n                        $next.addClass(\"disabled\");\n                        if (option.center) {\n                            $slide.find(\".itemList\").css(\"left\", \"0px\");\n                        }\n                    } else {\n                        if (option.center) {\n                            $slide\n                                .find(\".itemList\")\n                                .css(\"left\", -parseInt(($li.length * 285 - $(window).width() + 20) / 2) + \"px\");\n                        }\n                        $prev.removeClass(\"disabled\");\n                        $next.removeClass(\"disabled\");\n                    }\n                }\n                $el.css(\"visibility\", \"visible\");\n            }\n\n            function getPrevLeft($el) {\n                preparePrev();\n                var left = Math.abs(parseInt($list.css(\"left\"))),\n                    nextLeft,\n                    width = $slide.width();\n                if (slideWidth) width = slideWidth;\n                nextLeft = left - width;\n                return nextLeft;\n            }\n\n            function getNextLeft($el) {\n                prepareNext();\n                var left = Math.abs(parseInt($list.css(\"left\"))),\n                    nextLeft,\n                    width = $slide.width();\n                if (slideWidth) width = slideWidth;\n                nextLeft = left + width;\n                return nextLeft;\n            }\n\n            function preparePrev() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    width = $slide.width(),\n                    itemWidth = $li.width() + 20;\n                if (slideWidth) width = slideWidth;\n\n                if (left < width) {\n                    var prepareCount = Math.ceil(Math.abs(width - left) / itemWidth);\n                    for (var i = 0; i < prepareCount; i++) {\n                        var $el = $list.find(\"li:not([_prev])\").last();\n                        $el.clone().insertBefore($list.find(\"li\").first());\n                        $el.attr(\"_prev\", true);\n                    }\n                    $list.css(\"left\", 0 - left - prepareCount * itemWidth + \"px\");\n                }\n            }\n\n            function prepareNext() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    width = $slide.width(),\n                    listWidth = $li.length * ($li.width() + 20),\n                    itemWidth = $li.width() + 20,\n                    spare = listWidth - (left + width);\n                if (slideWidth) width = slideWidth;\n                if (spare - width < width) {\n                    var prepareCount = Math.ceil(Math.abs(width - (listWidth - (left + width))) / itemWidth);\n                    for (var i = 0; i < prepareCount; i++) {\n                        var $el = $list.find(\"li:not([_next])\").first();\n                        $el.clone().insertAfter($list.find(\"li\").last());\n                        $el.attr(\"_next\", true);\n                    }\n                }\n            }\n\n            function clearOld() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    itemWidth = $li.width() + 20,\n                    $prev = $list.find(\"li[_next]:not(:in-viewport)\"),\n                    prevCnt = $prev.length;\n                $list.find(\"li[_prev]:not(:in-viewport)\").remove();\n                $prev.remove();\n                $list.css(\"left\", 0 - left + prevCnt * itemWidth + \"px\");\n            }\n\n            resetRecommend();\n\n            if (slideWidth && slideWidth > itemWidth * $li.length) {\n                $prev.hide();\n                $next.hide();\n            }\n\n            $el.on(\"click\", \"a.prev\", function(e) {\n                e.preventDefault();\n                var $this = $(this);\n                if ($this.hasClass(\"_disabled\")) return;\n                var left = getPrevLeft($el);\n                $this.addClass(\"_disabled\");\n                $list.animate({ left: 0 - left + \"px\" }, 300, \"easeInOutExpo\", function() {\n                    clearOld();\n                    $this.removeClass(\"_disabled\");\n                });\n            }).on(\"click\", \"a.next\", function(e) {\n                e.preventDefault();\n                var $this = $(this);\n                if ($this.hasClass(\"_disabled\")) return;\n                var left = getNextLeft($el);\n                $this.addClass(\"_disabled\");\n                $list.animate({ left: 0 - left + \"px\" }, 300, \"easeInOutExpo\", function() {\n                    clearOld();\n                    $this.removeClass(\"_disabled\");\n                });\n            });\n        }\n\n        $.fn.productSlide = function(option) {\n            var option = option || { center: true };\n            var self = this;\n            var $slides = this.each(function() {\n                var $el = $(this);\n                initSlide($el, option);\n            });\n\n            return $slides;\n        };\n    });\n}\n"],"sourceRoot":""}
{"version":3,"sources":["webpack://fancy/./_static/modules/ui/overlay-thing/Shared.js","webpack://fancy/./_static/modules/ui/overlay-thing/ThingTypes.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/action-constants.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/action-helpers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/action/actions.js","webpack://fancy/./_static/modules/ui/overlay-thing/appstate.ts","webpack://fancy/./_static/modules/ui/overlay-thing/cache.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/Perf.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/map.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AddlistPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AdminPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/SimpleSharePopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/FancyContext.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/MerchantInfo.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Recommendation.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Reviews.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/ActionButtons.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Detail.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/zoom.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Info.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItemForm.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/ThingCard.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/config.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/entry-events.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/history.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/routeutils.js","webpack://fancy/./_static/modules/ui/overlay-thing/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/reducers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/store/initial-store.ts","webpack://fancy/./_static/modules/ui/overlay-thing/store/store.ts"],"names":["getFancyDepsRoot","Shared","getStore","store","cache","pagingContext","transition","reloadCurrentThing","ThingTypeMeta","thingContext","name","PlainThingType","args","objectArgs","mergeObjectArgs","thing","$","extend","id","url","isCrawled","owner","image","src","width","height","user","type","fancyd_friends","META","getThingType","SaleItemType","sales","createEmptyObject","sales_available","review_rating","review_count","size_chart_ids","images","seller","GiftcardType","window","gettext","HotelType","hotel_search","hotel","VanityType","LaunchAppType","ThingType","has_launch_app","metadata","ThingTypes","forEach","AttachingType","ComparingType","constantGen","keys","slice","call","arguments","reduce","prev","next","C","shouldOpenThing","state","appContext","visible","shouldFetchThing","thingID","ID","isFetching","closeOverlay","dispatch","isStaticPage","closeModal","historyData","history","stripPathname","document","title","closeThing","off","trigger","onDataFetched","addAdditionalThingContext","loadThing","onLoadThing","fetchedThingsIds","fetchThing","ThingCache","killCache","override","queryString","getState","console","warn","openThing","shouldFetch","cac","thingPageData","requestThing","options","external_apps","viewer","getLocationArgPairs","admin","successFn","need_more_fetch","image_resized_max","img","Image","failFn","failureXHR","requestThingFail","status","alertify","alert","requestPromise","then","__Config","design_v4","get","fail","getCordialProperties","prop","productID","username","emojified_name","category","cordial_category","instock","available","soldout","image_url","price","parseFloat","min_price","recommended","length","map","item","i","MPArgs","currentLocationArgPair","utm","MP","LogExposed","addLog","crdl","e","trackingItem","brand","brand_name","dataLayer","push","product_id","event","products","undefined","products_info","revenue","option_id","TrackingEvents","viewItem","ga","hitType","page","location","href","thingData","fromServer","isEmpty","show_anywhere_only","salesStatus","toggleFollow","seller_id","user_id","followType","data","followContext","loading","following","toggleFollowAction","ajax","dataType","done","xml","$status","find","text","completeFollow","cancelFollow","toggleFancy","fancyContext","fancyd","fancyd_count","toggleFancyAction","json","fc","completeFancy","cancelFancy","calculatePrice","saleContext","newContext","saleOptionID","isSalesOptionsAvailable","basis","_","option","updateSaleContext","slideContext","UPDATE_SALE_CONTEXT","getCurrentSaleOption","saleImages","getSaleImages","firstOptionImageIdx","some","idx","thumbnailIndex","setThumbnailIndex","requestCurrencyConversion","nextCode","nextPrice","callback","shouldConvert","numberType","replace","isString","amount","currency_code","success","currency","code","formatPrice","symbol","_convertCurrency","force","currencyCode","currencyMoney","currencySymbol","toFixed","convertCurrency","pendingID","OPEN_THING","updateAppContext","contextObject","context","loggedIn","updateState","k","v","ignoreCralwed","existence","THINGS","SALES","getCrawled","count","selector","value","t","index","__THING_CACHE","Keys","Sidebar","Wrap","Body","Title","Price","Form","Desc","Owner","mapStateToThingProps","getSales","getDescription","description","details","propertyDescription","getSaleItemId","is_admin_any","inactive_sales","getSeller","getDetailType","getFirstSaleOption","ignoreEmptySaleOption","opts","filter","discount_percentage","quantity","retail_price","newPrice","regex","test","getDomesticDeliveryDate","date","expected_delivery_day_1","expected_delivery_day_2","getIntlDeliveryDate","expected_delivery_day_intl_1","expected_delivery_day_intl_2","currencyIsUSD","saleOptionWaitingRegistry","setWaiting","chosenSaleOptionID","setResult","getWaiting","waiting","chosenSaleOption","fillArray","original","filler","ol","fl","sparseIdxs","j","tid","optionId","hotelImages","salesImages","thingImages","thumbnailsLimit","thumbnail_src","thumbnailUrl","unshift","video","thumbType","thumbnail_url","position","isNumber","isVanityQueriable","props","suppress","AC","minPrice","maxPrice","keyword","trim","original_labels","isNaN","parseInt","labels","ok","getSafeNameProp","dangerouslySetInnerHTML","__html","children","isVideoUploadable","salesAvailable","getThingName","AddlistPopup","lists","listSearchQuery","listCreationQuery","listCreating","setState","drawUserList","setTimeout","listSearchInput","focus","target","preventDefault","which","KEYS","objectId","updateList","createList","updated","stopPropagation","targ","currentTarget","selectedListId","Number","getAttribute","theList","list","prevAdded","added","eventName","update","dialog","popupName","$obj","on","handleDialogOpen","prevProps","prevState","center","getListCheckbox","res","element","handleListSearch","el","term","toLowerCase","style","Display","indexOf","ident","classnames","handleListItemToggle","quickCreateList","handleListCreation","handleCreateListQueryChange","Component","resp","status_code","message","closePopup","error","err","checked","unchecked","payload","join","post","AdminPopup","show_on_homepage","date_published","exclude_from_popular","show_in_search","optionSaving","ownerSaving","mergeSaving","thing_id","inputDate","Date","toISOString","split","Object","assign","changeOwnerEl","new_owner","thing_owner","confirm","new_owner_name","new_thing_id","ntid","old_user_id","xmlUtil","reload","always","that","handleSaveOptions","handleChangeOwner","React","SimpleSharePopup","log","shareUrl","copyToClipboard","urlCopied","connector","handleCopyLink","encodeURIComponent","getFancyContextDefaultValue","FancyContext","useFancy","MerchantInfo","useState","showMore","setShowMore","descEl","useRef","useEffect","current","clientHeight","collapsed","display","shop_url","sale_items","Recommendation","convertThingsV1","things","html_url","thumb_image_url_558","max_price","Likeable","RecentlyViewed","setThings","offset","response","recently","SwiperCore","Thumbs","useDefaultReviews","per_page","q","sort","setLoading","sid","skip","reviews","useReviews","setReviews","param","Reviews","reviewOption","setReviewOption","cx","applying","ReviewHead","summary","rating_avg","total_ratings","attributes","a","label","rating","ReviewEntry","review","photoIndex","setPhotoIndex","backgroundImage","ReviewList","currentPage","debounceEventUntilTimeout","Math","max","total_pages","min","range","pageNum","Favorite","useDispatch","handleClick","require_login","ActionButtons","renderPopup","Overview","bv","brand_values","shippingInfo","shipping_info","origin","cost","className","Description","menu","setMenu","showFeatures","features","showSpecs","specifications","showReturns","return_exchange_policy_title","shipping_policy","show","Detail","isTouchDevice","navigator","maxTouchPoints","msMaxTouchPoints","SwiperAddons","Zoom","placeholderImage","HEIGHT","PER_PAGE","preloadImage","Promise","r","onload","onerror","ImageSlide","memo","setSlideLocked","isActive","isZoomActive","setZoomActive","zoomImageStyle","setZoomImageStyle","zoomImageCacheKey","setZoomImageCacheKey","zoomImageLoaded","setZoomImageLoaded","isVideo","h264_1000k_url","isMagnifyingGlassZoomable","zoomable","setZoomable","large_image_url","startZoom","zoomShow","pageX","pageY","newZoomable","isZoomable","nextZoomImageStyle","getNextZoomImageStyle","fullScreen","cursor","getZoomImageStyle","nextProps","displayName","fancyProps","swiperRef","swipeThumbsRef","thumbIndex","setThumbIndex","slideLocked","swiper","setSwiper","lastThumbIndex","activeIndex","slideTo","thumbSwiper","slides","classList","contains","loadPrevNext","loadPrevNextAmount","maxRatio","scale","opacity","clickedIndex","selected","zoomBoxMaximumSize","zoomScale","getBoundarySize","$el","eq","DEBUG","getZoomBoxSize","bs","getZoomMargin","zidCac","getZoomImageDimension","zoomMargin","ret","getImageMeta","marginHoriz","marginVert","$fig","$wrapper","boundaryWidth","boundaryHeight","meta","left","top","topPosition","showZoomImage","zoomBoxSize","zd","zoomImageContainerX","minmax","zoomImageContainerY","backgroundLeft","backgroundTop","bgPosX","bgPosY","transform","backgroundPosition","RESIZED_SIZE","calculateImageSize","size","smallerSize","proportion","larger","imageSize","boundarySize","currentZoomImageStyle","backgroundSize","Info","total_reviews","headerSize","css","scrollTop","offsetTop","optionValueFunction","opt","saleNamePrinter","SaleItemSidebarHead","disabled","multiOptionState","CurrencyPopup","currentCurrency","renderCurrencyPopup","approxText","selectedQuantity","personalization","appState","params","sale_item_id","remove","FancyApplePay","os","o","total","displayItems","checkAvailability","testmode","applePayDisplay","applePayTest","option_meta","getInitialMultiOptionState","updateSaleOptionIDFromMultiOptionState","presetOptionId","String","selectedOptionArray","m","order","orderMap","selectedOption","every","values","extractSaleOptionIDFromMultiOptionState","amendedID","amendSaleOptionFromMultiOptionState","nextSelected","swatch","button","thumbnail","dropdown","selectedValue","getPossibleValuesForIndex","indexOfType","tagName","attr","handlePurchase","onClickThumbnail","onClickMultiOptionGen","onClickSwatch","onMultiSelectBoxChange","onClickMutliButton","initializeMultiOption","checkApplePay","nsc","nextSaleOptionID","_o","mos","$so","escapeSelector","is","click","paymentRequest","nonSoldout","selectedNonSoldoutOption","nextValue","MultiOptionState","priceChanges","currencyChanges","discountPercentage","retailPrice","optionIsMulti","isOptionMulti","salesOptionsAvailable","discounting","converted","currencyCodeStyle","quantitySelectRange","showSelectbox","cartButtonStyle","applePayButton","sale","floatFormatMinusTwo","numberFormat","getApproxText","handleCurrencyPopup","SaleItemOptionsExpander","handleOptionChange","hasSizeGuide","size_guide_id","SizeGuidePopup","personalizable","handlePersonalizationChange","handleQuantityChange","subscribed","handleNotifyLater","sio","ApplePayButton","clicked","country","requestPurchase","trace","WebkitAppearance","ApplePayButtonType","ApplePayButtonStyle","handleApplePayCheckout","saleOption","sale_id","Fancy","CartAPI","addItem","Cart","openPopup","SaleOptions","currentValue","expander","defaultValue","printer","onChange","onClick","onFocus","unselectedLabel","CartButton","SelectBox","tabIndex","SizeGuide","s","labelValue","targetIndex","filteredOptions","sel","uniq","MultiOption","multiOptions","getMultiOptions","sizeGuidePos","indexTypeOf","additional","selectedArray","key","showSizeGuide","MultiSelectBox","MultiSelectBoxOption","MultiSwatch","MultiSwatchOption","backgroundColor","MultiThumbnail","MultiThumbnailOption","MultiButton","MultiButtonOption","Thing","ThingCard","p","AdminMessages","messages","BreadCrumb","breadcrumbs","AdminSidebar","AdminComponent","AppV2","pt","ct","nonSoldoutOptions","minimumOption","getFancyContext","ReduxComponentEnhancer","connect","Overlay","EXPIRED","REMOVED","PENDING","COMING_SOON","ACTIVE","SOLD_OUT","FancyStatus","Addition","Removal","AfterAddition","AfterRemoval","Idle","textareaHeight","expanded","commonWrapperSelector","Selectors","HomepageWrapper","ThingViewConfig","StaticThingViewConfig","ThumbnailsLimit","Basic","More","handleOverlayThingKeyEvents","conditionalTransition","aElement","isStream","has","LinkTypes","oneshotEventAttached","attachEntryEvents","body","__INIT_THING_ANCHOR","isPlainLeftClick","getObjectTypeFromUrl","getPathname","$targ","didClickOn","eitherFancy","sharedState","draggingAdmin","OtContainer","isStaticCache","isStatic","getDynamic","getStatic","scrollToTop","parentElement","scrollEvent","handleScroll","attach","func","prepare","detach","_prepare","throttle","viewportHeight","documentElement","scrollHeight","containerEl","addEventListener","passive","removeEventListener","initialThingPageID","extractMetaFromURL","pathname","initialPageIsThingPage","initialPath","preservedHref","initialTitle","locationIsThingPage","overlayIsOn","runOverlay","thingURLType","hasClass","requestIdleCallback","addClass","stopOverlay","historyHook","search","Dynamic","Static","Timeline","Internal","linkType","redirect","removeClass","init","movePrev","moveNext","destination","getUtm","$nav","$shopLink","getUtmString","bugsnag","Bugsnag","apiKey","plugins","BugsnagPluginReact","__FancyUser","App","heart_icon","ready","require","overlayContainer","querySelector","selectOrCreate","lazy","ErrorBoundary","createErrorBoundary","tree","render","loaded","lastFullyRenderedThingID","getInitialStoreState","action","updateShallow","userCountry","cookie","current_country_code","populateThingContext","URLMeta","followStore","Boolean","seller_follow","followUser","nextFancydState","saleOptionInclSales","nextContext","rootReducer","combineReducers","contextName","contexts","getAllInitialStoreState","contextKey","middlewares","thunk","process","logger","configureStore","reducer","preloadedState","middleware","getDefaultMiddleware","serializableCheck","prepend"],"mappings":"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","file":"OverlayThing.main.c83b7842a21ae532a51a.js","sourcesContent":["import { getFancyDepsRoot } from 'fancyutils';\n\nimport store from './store/store';\nimport { cache } from './cache';\nimport { pagingContext, transition } from './container/routeutils';\nimport { reloadCurrentThing } from './container/history';\n\n\ngetFancyDepsRoot().Shared = {\n    getStore: () => store.getState(),\n    cache,\n    pagingContext,\n    transition,\n    reloadCurrentThing,\n};\n","// -- Members --\n// className: string\n// - class name that used from sidebar head 'wrapper figure-info {className}'.\n// type: string\n// - meta string that indicates type name\nimport { mergeObjectArgs } from 'fancyutils';\n\nexport class ThingTypeMeta {\n    static isSale = false;\n    static type = 'ThingTypeMeta';\n\n    getName(thingContext) {\n        return thingContext.name;\n    }\n}\n\nexport class PlainThingType extends ThingTypeMeta {\n    static className = '';\n    static type = 'PlainThing';\n    static createEmptyObject(...args) {\n        const objectArgs = mergeObjectArgs(args);\n        const thing = $.extend(true, {\n            id: '1',\n            url: '/',\n            isCrawled: false,\n            owner: {},\n            image: { src: '', width: 1, height: 1 },\n            user: {},\n            type: 'thing',\n            fancyd_friends: [],\n        }, objectArgs);\n        thing.META = getThingType(thing);\n        return thing;\n    }\n}\n\nexport class SaleItemType extends ThingTypeMeta {\n    static className = '';\n    static type = 'SaleItem';\n    static getName(thingContext) {\n        return thingContext.sales.name;\n    }\n    static createEmptyObject(objectArgs) {\n        return PlainThingType.createEmptyObject({\n            sales_available: true,\n            sales: {\n                id: '1',\n                review_rating: 1,\n                review_count: 1,\n                size_chart_ids: ['1'],\n                images: [{ src: '', width: 1, height: 1 }],\n                seller: { id: '1' }\n            },\n            type: 'sales'\n        }, objectArgs);\n    }\n}\n\nexport class GiftcardType extends SaleItemType {\n    static className = 'giftcard';\n    static type = 'Giftcard';\n\n    static getName() {\n        return window.gettext(\"Fancy Gift Card\");\n    }\n}\n\nexport class HotelType extends SaleItemType {\n    static className = 'hotel';\n    static type = 'Hotel';\n\n    static getName(thingContext) {\n        return thingContext.hotel_search.hotel.name;\n    }\n}\n\nexport class VanityType extends SaleItemType {\n    static className = 'vanity';\n    static type = 'Vanity';\n}\n\nexport class LaunchAppType extends ThingTypeMeta {\n    static className = '';\n    static type = 'LaunchApp';\n}\n\n// Retrieve meta by looking up thing object.\nexport function getThingType(thingContext) {\n    var ThingType;\n    if (thingContext.hotel_search) {\n        ThingType = HotelType;\n    } else if (thingContext.has_launch_app && thingContext.metadata) {\n        ThingType = LaunchAppType;\n    } else if (thingContext.type === 'giftcard') {\n        ThingType = GiftcardType;\n    } else if (thingContext.sales_available) {\n        if (thingContext.type === 'vanity_number') {\n            ThingType = VanityType;\n        } else {\n            ThingType = SaleItemType;\n        }\n    } else {\n        ThingType = PlainThingType;\n    }\n    return ThingType;\n}\n\nconst ThingTypes = [PlainThingType, SaleItemType, GiftcardType, HotelType, VanityType, LaunchAppType];\n\n// TODO: immutable\nThingTypes.forEach(AttachingType => {\n    ThingTypes.forEach(ComparingType => { \n        AttachingType[ComparingType.type] = AttachingType === ComparingType;\n    });\n});\n","// Generate `key: String(key)` structure by given string key arguments\nfunction constantGen() {\n    var keys = [].slice.call(arguments);\n    return keys.reduce((prev, next) => {\n        prev[next] = next;\n        return prev;\n    }, {});\n}\n\nvar C = constantGen(\n  'UPDATE_APP_CONTEXT',\n  // Loading\n  'REQUEST_THING',\n  'REQUEST_THING_FAILURE',\n  'LOAD_THING',\n\n  // UI Actions\n  'OPEN_THING',\n  'CLOSE_THING',\n\n  // Comment form suggestion\n  'SET_USERNAME_KEYWORD',\n  'LOAD_SUGGESTION',\n\n  // Thumbnail\n  'SET_THUMBNAIL_INDEX',\n\n  // Follow\n  'TOGGLE_FOLLOW',\n  'CANCEL_FOLLOW',\n  'COMPLETE_FOLLOW',\n\n  // Fancy\n  'TOGGLE_FANCY',\n  'CANCEL_FANCY',\n  'COMPLETE_FANCY',\n\n  // Saleitem\n  'UPDATE_SALE_CONTEXT'\n);\n\nexport default C;\n","import { MP, getLocationArgPairs, isEmpty, isStaticPage, stripPathname } from \"fancyutils\";\nimport { Dispatch, State } from \"redux\";\nimport { ThunkAction } from \"redux-thunk\";\n\nimport { history } from \"common-components\";\nimport { historyData } from \"../container/history\";\nimport store from \"../store/store\";\nimport { closeModal } from \"../container/routeutils\";\nimport {\n    closeThing,\n    openThing,\n    loadThing,\n    requestThing,\n    requestThingFail,\n    toggleFollow as toggleFollowAction,\n    cancelFollow,\n    completeFollow,\n    toggleFancy as toggleFancyAction,\n    cancelFancy,\n    completeFancy,\n    setThumbnailIndex,\n} from \"./actions\";\nimport C from \"./action-constants\";\nimport { formatPrice, isSalesOptionsAvailable, getCurrentSaleOption, getSaleImages } from \"../components/map\";\nimport { ThingCache, cache } from \"../cache\";\nimport { salesStatus } from \"../config\";\nimport { ThingObject, SaleContext } from \"ftypes\";\n\nfunction shouldOpenThing(state) {\n    return state.appContext.visible !== true;\n}\n\n// Blocks illegal requests\nfunction shouldFetchThing(state, thingID) {\n    if (state.thing.ID === thingID || state.thing.isFetching) {\n        return false;\n    } else {\n        return true;\n    }\n}\n\nexport function closeOverlay() {\n    return (dispatch: Dispatch) => {\n        if (isStaticPage()) {\n            return;\n        }\n        closeModal();\n        historyData.overlayIsOn = false;\n        history.push(stripPathname(historyData.preservedHref), null);\n        document.title = historyData.initialTitle;\n\n        dispatch(closeThing());\n        $(document).off(\"keydown.overlayThing\");\n        $(window).trigger(\"scroll\");\n    };\n}\n\nfunction onDataFetched(dispatch: Dispatch, thingID, thing, type) {\n    addAdditionalThingContext(thing);\n    cache.add(thingID, thing, type);\n    dispatch(loadThing(thingID, thing));\n    onLoadThing(thing);\n}\n\nconst fetchedThingsIds = {};\n\nexport function fetchThing(\n    thingID: string,\n    type = ThingCache.THINGS,\n    killCache = false,\n    override = false,\n    queryString = \"\"\n) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        if (thingID == null) {\n            console.warn(\"fetchThing(): thingID was null.\");\n            return;\n        }\n        var state = getState();\n        if (shouldOpenThing(state)) {\n            dispatch(openThing());\n        }\n        if (killCache) {\n            cache.remove(thingID, type);\n            delete state.thing;\n        }\n\n        const shouldFetch = override || shouldFetchThing(state, thingID);\n        if (killCache || shouldFetch) {\n            if (cache.exists(thingID, type)) {\n                const cac = cache.get(thingID, type);\n                dispatch(loadThing(thingID, cac));\n                onLoadThing(cac);\n                // if cache is crawled one, request should continue\n                if (!cac.isCrawled) {\n                    return;\n                }\n            }\n\n            // static ot page prefetch\n            if (window.thingPageData) {\n                const thingPageData = window.thingPageData;\n                onDataFetched(dispatch, thingID, thingPageData, type);\n                delete window.thingPageData;\n                return;\n            }\n\n            dispatch(requestThing(thingID));\n            let options;\n\n            options = { owner: true, external_apps: true, viewer: true };\n            if (getLocationArgPairs(\"admin\")) {\n                options.admin = true;\n            }\n            if (type === ThingCache.SALES) {\n                options.sales = true; // /sales/(+d) URL\n            }\n            const successFn = (thing) => {\n                if (thing.need_more_fetch) {\n                    // Load main image as fast as possible.\n                    if (thing.image_resized_max && thing.image_resized_max.src) {\n                        let img = new Image();\n                        img.src = thing.image.src;\n                    }\n                    fetchedThingsIds[thingID] = 1;\n                    dispatch(loadThing(thingID, thing));\n                    onLoadThing(thing);\n                } else {\n                    fetchedThingsIds[thingID] = 2;\n                    onDataFetched(dispatch, thingID, thing, type);\n                }\n            };\n            const failFn = (failureXHR) => {\n                // FIXME: This error handling only happens when there's server-side error -\n                //        can't handle client-side ones\n                dispatch(requestThingFail(/*thingID*/));\n                if (failureXHR && failureXHR.status === 404) {\n                    alertify.alert(\"This page is not available. Please try again later.\");\n                } else {\n                    alertify.alert(\n                        'There was an error while opening the page.<br> Please try again or contact <a mailto=\"cs@fancy.com\">cs@fancy.com</a>.'\n                    );\n                }\n            };\n            if (window.requestPromise) {\n                const requestPromise = window.requestPromise;\n                delete window.requestPromise;\n                requestPromise.then(successFn).catch(failFn);\n            } else {\n                if (__Config.design_v4) {\n                    $.get(`/rest-api/v1/things/${thingID}/details${queryString}`, options).then(successFn).fail(failFn);\n                } else {\n                    $.get(`/rest-api/v1/things/${thingID}${queryString}`, options).then(successFn).fail(failFn);\n                }\n            }\n        }\n    };\n}\n\nexport function getCordialProperties(thing) {\n    const prop = {\n        thingID: thing.id,\n        productID: thing.sales.id,\n        seller: thing.sales.seller.username,\n        url: \"https://fancy.com\" + thing.url,\n        name: thing.emojified_name,\n        category: thing.sales.cordial_category,\n        instock: thing.sales.available && !thing.sales.soldout,\n        image: thing.images[0].image_url,\n        price: parseFloat(thing.sales.min_price),\n    };\n    if (thing.recommended && thing.recommended.length) {\n        prop[\"recommended\"] = thing.recommended.map((item, i) => item.id);\n    }\n    return prop;\n}\n\nfunction onLoadThing(thing) {\n    const MPArgs = { \"thing id\": thing.id };\n    const currentLocationArgPair = getLocationArgPairs(\"utm\");\n    if (currentLocationArgPair) {\n        MPArgs.utm = currentLocationArgPair[1];\n    }\n    MP(\"View Thing Detail\", MPArgs);\n    if (typeof LogExposed != \"undefined\") window.LogExposed.addLog(thing.id + \"\", \"thing\");\n    try {\n        window.crdl(\"event\", \"browse\", getCordialProperties(thing));\n    } catch (e) {}\n    try {\n        let trackingItem;\n        if (thing.sales) {\n            trackingItem = {\n                id: thing.sales.id,\n                brand: thing.sales.seller.brand_name,\n                name: thing.sales.emojified_name || thing.emojified_name,\n                price: thing.sales.price,\n            };\n            window.dataLayer.push({\n                product_id: thing.sales.id,\n                event: \"ProductPage\",\n                products: undefined,\n                products_info: undefined,\n                revenue: undefined,\n                option_id: thing.sales.options && thing.sales.options.length ? thing.sales.options[0].id : undefined,\n            });\n        } else {\n            trackingItem = {\n                id: thing.id,\n                name: thing.emojified_name,\n            };\n        }\n        window.TrackingEvents.viewItem(trackingItem);\n        ga(\"send\", { hitType: \"pageview\", page: location.href, title: document.title });\n    } catch (e) {}\n}\n\nfunction addAdditionalThingContext(thingData: ThingObject) {\n    thingData.fromServer = true;\n    thingData.sales_available =\n        !isEmpty(thingData.sales) &&\n        !thingData.sales.show_anywhere_only &&\n        thingData.sales.status !== salesStatus.EXPIRED; // TODO: need to check exact condition.\n}\n\nexport function toggleFollow({ seller_id, user_id }) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var state = getState();\n        var followType;\n        var data;\n        if (seller_id) {\n            followType = \"followStore\";\n            data = { seller_id };\n        } else if (user_id) {\n            followType = \"followUser\";\n            data = { user_id };\n        } else {\n            return;\n        }\n\n        if (state.followContext[followType].loading === false) {\n            var url = state.followContext[followType].following === true ? \"/delete_follow.xml\" : \"/add_follow.xml\";\n            dispatch(toggleFollowAction(followType));\n            $.ajax({\n                url,\n                data,\n                type: \"post\",\n                dataType: \"xml\",\n            })\n                .done(function (xml) {\n                    var $status = $(xml).find(\"status_code\");\n                    if ($status.length && $status.text() !== 0) {\n                        dispatch(completeFollow(followType));\n                    } else {\n                        dispatch(cancelFollow(followType));\n                    }\n                })\n                .fail(function () {\n                    dispatch(cancelFollow(followType));\n                });\n        }\n    };\n}\n\nexport function toggleFancy(thingID: string) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var state = getState();\n        var { fancyd, fancyd_count, loading } = state.fancyContext;\n        if (!loading) {\n            dispatch(toggleFancyAction(thingID));\n            $.ajax({\n                type: \"PUT\",\n                url: `/rest-api/v1/things/${thingID}`,\n                data: {\n                    fancyd: !fancyd,\n                },\n            })\n                .done(function (json) {\n                    var fc = 0;\n                    if (json.id && json.fancyd === !fancyd) {\n                        if (json.fancyd === true) {\n                            fc = fancyd_count + 1;\n                        } else if (json.fancyd === false) {\n                            fc = fancyd_count - 1;\n                        }\n                        // cache.update(thingID, undefined, \"fancyd\", json.fancyd);\n                        // cache.update(thingID, undefined, \"fancyd_count\", fc);\n\n                        dispatch(completeFancy(thingID, fc));\n                    } else {\n                        dispatch(cancelFancy(thingID));\n                    }\n                })\n                .fail(function () {\n                    dispatch(cancelFancy(thingID));\n                });\n        }\n    };\n}\n\nfunction calculatePrice(thing: ThingObject, saleContext: SaleContext, newContext: SaleContext) {\n    const saleOptionID = newContext.saleOptionID || saleContext.saleOptionID;\n    const sales = thing && thing.sales;\n    // Get object basis for retrieving price.\n    if (isSalesOptionsAvailable(sales)) {\n        const basis = _.find(sales.options, (option) => option.id === saleOptionID);\n        if (basis != null) {\n            return basis.price;\n        } else {\n            console.warn(\n                \"calculatePrice():\",\n                \"Wrong saleOptionID supplied, please investigate. saleOptionID: \",\n                saleOptionID\n            );\n            return 0;\n        }\n    } else if (sales != null) {\n        return sales.price;\n    } else {\n        return 0;\n    }\n}\n\nexport function updateSaleContext(newContext: SaleContext) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var { thing, saleContext, slideContext } = getState();\n        newContext.price = calculatePrice(thing.data, saleContext, newContext);\n        dispatch({ ...newContext, type: C.UPDATE_SALE_CONTEXT });\n        if (saleContext.saleOptionID !== newContext.saleOptionID) {\n            const option = getCurrentSaleOption(thing.data.sales, newContext, true);\n            const saleImages = getSaleImages(thing.data, option);\n            let firstOptionImageIdx;\n            if (\n                option &&\n                saleImages.some((img, idx) => {\n                    if (img.option_id === option.id) {\n                        firstOptionImageIdx = idx;\n                        return true;\n                    }\n                })\n            ) {\n                // blank\n            } else {\n                if (slideContext.thumbnailIndex > saleImages.length - 1) {\n                    firstOptionImageIdx = 0;\n                }\n            }\n            if (firstOptionImageIdx) {\n                dispatch(setThumbnailIndex(firstOptionImageIdx));\n            }\n        }\n    };\n}\n\nfunction requestCurrencyConversion(nextCode: string, nextPrice: string, callback) {\n    const shouldConvert = !(nextCode == null || callback == null);\n    if (shouldConvert) {\n        if (window.numberType === 2) {\n            nextPrice = nextPrice.replace(/,/g, \".\").replace(/ /g, \"\");\n        }\n        if (_.isString(nextPrice)) {\n            nextPrice = nextPrice.replace(/,/g, \"\");\n        }\n        $.ajax({\n            url: \"/convert_currency.json\",\n            type: \"GET\",\n            dataType: \"json\",\n            data: {\n                amount: nextPrice,\n                currency_code: nextCode,\n            },\n        }).success(({ amount, currency } = {}) => {\n            if (amount == null) {\n                return;\n            }\n            callback(currency.code, formatPrice(amount, currency.code), currency.symbol);\n        });\n    }\n}\n\nfunction _convertCurrency(nextCode: string, nextPrice: string, force: boolean) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        const { saleContext } = getState();\n        if (nextCode !== \"USD\") {\n            if (\n                force || // FIXME: unable to comparison since price update comes first (SaleitemSidebarHead.componentWillReceiveProps())\n                saleContext.price !== nextPrice || // currency price changed\n                saleContext.currencyCode !== nextCode || // currency code changed\n                saleContext.currencyMoney == null || // currency symbol/money is not set (changed from usd)\n                saleContext.currencySymbol == null\n            ) {\n                nextPrice = nextPrice || saleContext.price || \"0.00\";\n                requestCurrencyConversion(nextCode, nextPrice, (currencyCode, currencyMoney, currencySymbol) => {\n                    if (typeof currencyMoney === \"number\") {\n                        currencyMoney = currencyMoney.toFixed(2);\n                    }\n                    currencyMoney = currencyMoney.replace(/[ \\.]00$/, \"\");\n                    dispatch(\n                        updateSaleContext({\n                            currencyCode,\n                            currencyMoney,\n                            currencySymbol,\n                        })\n                    );\n                });\n            } else {\n                // NOOP\n            }\n        } else {\n            dispatch(\n                updateSaleContext({\n                    currencyCode: \"USD\",\n                    currencyMoney: null,\n                    currencySymbol: null,\n                })\n            );\n        }\n    };\n}\n\nexport function convertCurrency(nextCode, nextPrice, force = false) {\n    store.dispatch(_convertCurrency(nextCode, nextPrice, force));\n}\n","import C from './action-constants';\n\n\n// Action on requesting thing starts\nexport function requestThing(pendingID) {\n    return {\n        type: C.REQUEST_THING,\n        status: 'request',\n        pendingID\n    };\n}\n\n// Action on requesting thing fails\nexport function requestThingFail() {\n    return {\n        type: C.REQUEST_THING_FAILURE,\n        status: 'failed'\n    };\n}\n\n// action on loading request result\nexport function loadThing(ID, data) {\n    return {\n        type: C.LOAD_THING,\n        status: 'idle',\n        ID,\n        data\n    };\n}\n\n// Action on close overlay\nexport function openThing() {\n    return {\n        type: C.OPEN_THING\n    };\n}\n\n// Action on close overlay\nexport function closeThing() {\n    return {\n        type: C.CLOSE_THING,\n        ID: null,\n        pendingID: null,\n        thing: null\n    };\n}\n\n\nexport function setThumbnailIndex(thumbnailIndex) {\n    return {\n        type: C.SET_THUMBNAIL_INDEX,\n        thumbnailIndex,\n    };\n}\n\nexport function toggleFollow(followType) {\n    return {\n        type: C.TOGGLE_FOLLOW,\n        followType\n    };\n}\n\nexport function cancelFollow(followType) {\n    return {\n        type: C.CANCEL_FOLLOW,\n        followType\n    };\n}\n\nexport function completeFollow(followType) {\n    return {\n        type: C.COMPLETE_FOLLOW,\n        followType\n    };\n}\n\nexport function toggleFancy(thingID) {\n    return {\n        type: C.TOGGLE_FANCY,\n        thingID,\n    };\n}\n\nexport function cancelFancy(thingID) {\n    return {\n        type: C.CANCEL_FANCY,\n        thingID,\n    };\n}\n\nexport function completeFancy(thingID, fancyd_count) {\n    return {\n        type: C.COMPLETE_FANCY,\n        thingID,\n        fancyd_count\n    };\n}\n\nexport function updateAppContext(contextObject) {\n    return {\n        type: C.UPDATE_APP_CONTEXT,\n        context: contextObject\n    };\n}\n","// App state that does not usually change during app lifecycle. (i.e. Login state)\n\n// module-level login state object and setter\nconst state : { viewer: {}; loggedIn: Boolean; } = { viewer: {}, loggedIn: false };\nexport default state;\n\nexport function updateState(k, v) {\n    state[k] = v;\n}\n","import { index } from 'fancyutils';\n\n// Cache bucket\nexport class ThingCache {\n    things = {};\n    sales = {};\n    count = 0;\n    static SALES = 'sales';\n    static THINGS = 'things';\n\n    exists = (id, type, ignoreCralwed) => {\n        const cac = this.get(id, type);\n        var existence = cac != null && typeof cac === 'object';\n        if (ignoreCralwed) {\n            existence = existence && cac.isCrawled !== true;\n        }\n        return existence;\n    }\n\n    // resolver function\n    _get = (id) => {\n        return this[ThingCache.THINGS][id] || this[ThingCache.SALES][id] || null;\n    }\n\n    get = (id, type = ThingCache.THINGS) => {\n        const cac = this[type][id] || this.getCrawled(id, type);\n        return cac;\n    }\n\n    getCrawled = (id, type) => {\n        const cac = this[type][id];\n        if (cac && cac.isCrawled) {\n            return cac;\n        } else {\n            return null;\n        }\n    }\n\n    add = (id, data, type) => {\n        // to add, cache should not be exist or crawled one\n        const cac = this[type][id];\n        if (\n            cac == null || \n            cac.isCrawled === true\n        ) {\n            this[type][id] = data;\n            // Store thing information as well\n            if (type === ThingCache.SALES && data.id) {\n                this[ThingCache.THINGS][data.id] = data;\n            }\n            this.count += 1;\n        } else {\n            console.warn('cache.add(): Cache overwrite');\n        }\n    }\n\n    remove = (id, type) => {\n        if (this[type][id]) {\n            delete this[type][id];\n            this.count -= 1;\n        } else {\n            console.warn('cache.remove(): Non-existing cache removal');\n        }\n    }\n\n    // selector = 'a.b.c'\n    update = (id, type = ThingCache.THINGS, selector, value) => {\n        if (selector == null) {\n            console.warn('ThingCache#update(): selector is empty');\n            return;\n        }\n        const t = this.get(id, type);\n        if (t) {\n            index(t, selector, value);\n        }\n    }\n\n    // sweep() {\n    //     // TODO: should sweep cache if too many cache added by looking `cache.count`\n    // }\n}\n\nexport const cache = new ThingCache();\nwindow.__THING_CACHE = cache;\n","export const Keys = {\n    Sidebar: {\n        Wrap: 'SIDEBAR_WRAP',\n        Body: 'SIDEBAR_BODY',\n        Title: 'SIDEBAR_TITLE',\n        Price: 'SIDEBAR_PRICE',\n        Form: 'SIDEBAR_FORM',\n        Desc: 'SIDEBAR_DESCRIPTION',\n        Owner: 'SIDEBAR_OWNER',\n    },\n};\n","import { alertify, isEmpty } from \"fancyutils\";\nimport {\n    SaleObject,\n    SaleContext,\n    ThingObject,\n    FancyReduxState,\n    User,\n    ThingImage,\n    OverlayPropsV1,\n} from \"ftypes\";\nimport { SaleItem } from \"_static/modules/ThingDetail\";\n\nconst { gettext, _ } = window;\n\nexport function mapStateToThingProps(state: FancyReduxState): OverlayPropsV1 {\n    const {\n        appContext,\n        thing: { data, isFetching, status },\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    } = state;\n\n    return {\n        appContext,\n        status,\n        thing: data,\n        isFetching,\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    };\n}\n\nexport function getSales(type: string, thing: ThingObject) {\n    return thing.sales;\n}\n\nexport function getDescription(type: string, thing: ThingObject) {\n    if (type === \"sales\") {\n        return thing.sales.description;\n    } else if (type === \"hotel\") {\n        return thing.hotel_search.details.propertyDescription;\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSaleItemId(thing: ThingObject, viewer: User) {\n    if (viewer && viewer.is_admin_any) {\n        if (thing.sales) {\n            return thing.sales.id;\n        } else if (thing.inactive_sales) {\n            return thing.inactive_sales.id;\n        }\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSeller(thing: ThingObject) {\n    if (thing.sales) {\n        return thing.sales.seller;\n    } else if (thing.inactive_sales) {\n        return thing.inactive_sales.seller;\n    }\n}\n\nexport function getDetailType(thing: ThingObject) {\n    if (thing.hotel_search) {\n        return \"hotel\";\n    } else if (thing.sales_available && thing.type !== \"vanity_number\") {\n        return \"sales\";\n    } else if (!thing.sales_available && !thing.has_launch_app && thing.type !== \"giftcard\") {\n        return \"urlOnly\";\n    }\n}\n\nexport function isSalesOptionsAvailable<T extends SaleItem>(sales: T | null) {\n    return sales != null && !isEmpty(sales.options);\n}\n\nexport function getFirstSaleOption(sales: SaleItem, ignoreEmptySaleOption = false) {\n    if (isSalesOptionsAvailable(sales)) {\n        return sales.options[0];\n    } else if (ignoreEmptySaleOption === false) {\n        return sales || null;\n    }\n}\n\nexport function getCurrentSaleOption<T extends SaleItem>(sales: T, saleContext: SaleContext = {}, ignoreEmptySaleOption = false) {\n    const { saleOptionID } = saleContext;\n\n    if (isSalesOptionsAvailable<T>(sales)) {\n        if (saleOptionID) {\n            const opts = _(sales.options).filter((prop) => prop.id === saleOptionID);\n            if (opts[0] == null) {\n                console.warn(\"saleOption should not be null!\");\n            }\n\n            return opts[0] == null\n                ? {\n                      id: 0,\n                      discount_percentage: \"0.0\",\n                      quantity: 0,\n                      soldout: true,\n                      retail_price: 0,\n                      name: '',\n                  }\n                : opts[0];\n        } else {\n            return sales.options[0];\n        }\n    } else if (ignoreEmptySaleOption === false) {\n        return sales;\n    }\n}\n\nexport function formatPrice(amount: number, currency: string) {\n    if (currency == \"BTC\") return amount + \"\";\n    var newPrice = amount.toFixed(2) + \"\";\n    var regex = /(\\d)(\\d{3})([,\\.]|$)/;\n    while (regex.test(newPrice)) {\n        newPrice = newPrice.replace(regex, \"$1,$2$3\");\n    }\n    if (window.numberType === 2) {\n        newPrice = newPrice.replace(/,/g, \" \").replace(/\\./g, \",\");\n    }\n    return newPrice;\n}\n\n// sales: thing.sales\nexport function getDomesticDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    if (sales.expected_delivery_day_1) {\n        date += sales.expected_delivery_day_1;\n    }\n    if (sales.expected_delivery_day_2) {\n        date += \" - \" + sales.expected_delivery_day_2;\n    }\n    return date;\n}\n\n// sales: thing.sales\nexport function getIntlDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    // TODO: use moment for locale string\n    if (sales.expected_delivery_day_intl_1) {\n        date += sales.expected_delivery_day_intl_1;\n    }\n    if (sales.expected_delivery_day_intl_2) {\n        date += \" - \" + sales.expected_delivery_day_intl_2;\n    }\n    return date;\n}\n\nexport function currencyIsUSD({ saleContext }: { saleContext: SaleContext }) {\n    return saleContext.currencyCode === \"USD\";\n}\n\n// [sale option id]: { true | false }\nconst saleOptionWaitingRegistry = {};\nwindow.saleOptionWaitingRegistry = saleOptionWaitingRegistry;\nexport function setWaiting(chosenSaleOptionID, setResult) {\n    saleOptionWaitingRegistry[chosenSaleOptionID] = setResult;\n}\nexport function getWaiting<T extends SaleItem>(sales: T, saleContext) {\n    if (sales == null) {\n        return null;\n    }\n    if (saleContext.waiting != null) {\n        return saleContext.waiting;\n    }\n\n    // https://app.asana.com/0/86925821949642/160205241997173\n    // It could be a bit weird for future, but design-side decision\n    if (sales.waiting) {\n        return sales.waiting;\n    }\n\n    const chosenSaleOption = getCurrentSaleOption(sales, saleContext);\n    // options is SaleItem\n    if (sales.id === chosenSaleOption.id) {\n        return sales.waiting;\n        // option is SaleOption\n    } else {\n        if (saleOptionWaitingRegistry[chosenSaleOption.id] != null) {\n            return saleOptionWaitingRegistry[chosenSaleOption.id];\n        } else if (chosenSaleOption.waiting != null) {\n            return chosenSaleOption.waiting;\n        }\n    }\n}\n\nfunction fillArray(original: Array<unknown> /*sparse?ArrayToFill*/, filler: Array<unknown>) {\n    const ol = original.length;\n    const fl = filler.length;\n    const sparseIdxs = [];\n    // Find sparse indexes first.\n    for (let j = 0; j < ol; j++) {\n        if (!(j in original)) {\n            sparseIdxs.push(j);\n        }\n    }\n    for (let i = 0; i < fl; i++) {\n        // if sparse indexes are all in (or nonexist), push leftovers to tail\n        if (i > sparseIdxs.length - 1) {\n            original.push(filler[i]);\n        } else {\n            original[sparseIdxs[i]] = filler[i];\n        }\n    }\n    return original;\n}\n\nlet tid;\nlet optionId: undefined;\nlet hotelImages: ThingImage[] | undefined | [];\nlet salesImages;\nlet thingImages;\nexport function getSaleImages(thing: ThingObject, option, thumbnailsLimit?: number) {\n    if (thing.hotel_search != null) {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n\n            hotelImages = <ThingImage[]>thing.hotel_search.images.map((img) => ({\n                src: img.url,\n                thumbnail_src: img.thumbnailUrl,\n                width: img.width,\n                height: img.height,\n            }));\n            hotelImages.unshift(thing.image_resized_max);\n        }\n        return hotelImages;\n    } else if (thing.sales != null) {\n        if (__Config.design_v4) {\n            const images = [];\n            fillArray(images, thing.images);\n            if (option && option.images && option.images.length > 0) {\n                fillArray(images, option.images);\n            }\n            salesImages = images;\n            if (option) {\n                optionId = option.id;\n            }\n            if (thing && thing.sales && thing.sales.video) {\n                images.unshift(thing.sales.video);\n            }\n            return salesImages;\n        }\n\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            // optionId = option ? option.id : null;\n            // FIXME: do this somewhere else\n            if (thing.image_resized_max == null) {\n                if (thing.image.src) {\n                    thing.image_resized_max = {\n                        src: thing.image.src,\n                        width: thing.image.width,\n                        height: thing.image.height,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                } else {\n                    thing.image_resized_max = {\n                        src: \"/_ui/images/common/blank.gif\",\n                        width: 1,\n                        height: 1,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                }\n            }\n\n            let images = [];\n\n            if (thing.image_resized_max) {\n                images.push(thing.image_resized_max);\n            }\n\n            if (thing.images && thing.images[0]) {\n                images.push(thing.images[0]);\n            }\n\n            // set sale images\n            if (thing && thing.sales && thing.sales.video) {\n                let video = { src: thing.sales.video.thumbnail_url, thumbType: \"video\" };\n                if (thing.sales.video.position > 0) {\n                    images[thing.sales.video.position] = video;\n                } else {\n                    // set video to first unless the position is set\n                    images.unshift(video);\n                }\n            }\n            if (thing.sales.images) {\n                fillArray(images, thing.sales.images);\n            }\n            salesImages = images;\n        }\n        if (option && optionId !== option.id) {\n            optionId = option.id;\n            if (salesImages == null) {\n                salesImages = [];\n            }\n            if (option.images && option.images.length > 0) {\n                const images = salesImages.filter((img) => img.option_id == null);\n                fillArray(images, option.images);\n                salesImages = images;\n            }\n        }\n\n        return _.isNumber(thumbnailsLimit) && thumbnailsLimit > 0\n            ? salesImages.filter((image, idx) => idx < thumbnailsLimit && image.src)\n            : salesImages;\n    } else {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            if (thing.image_resized_max) {\n                thingImages = [thing.image_resized_max];\n            } else if (thing.image) {\n                thingImages = [thing.image];\n            } else {\n                thingImages = [];\n                // || (option && optionId !== option.id)\n            }\n        }\n        return thingImages;\n    }\n}\n\nexport function isVanityQueriable(props: any, suppress: boolean) {\n    var { AC, minPrice, maxPrice, keyword } = props;\n\n    keyword = $.trim(keyword);\n    AC = $.trim(AC);\n    minPrice = minPrice != null ? minPrice : \"0\";\n    minPrice = $.trim(minPrice).replace(\",\", \"\").replace(\"$\", \"\");\n    maxPrice = $.trim(maxPrice).replace(\",\", \"\").replace(\"$\", \"\");\n\n    const original_labels = alertify.labels;\n    if (AC !== \"\") {\n        if (_.isNaN(parseInt(AC, 10)) || AC.length !== 3) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Invalid area code. Area code should be 3 digits.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (minPrice !== \"\") {\n        if (_.isNaN(parseInt(minPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check min price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n\n        if (parseInt(minPrice, 10) >= parseInt(maxPrice, 10)) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"The max price number should be bigger than min price number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (maxPrice !== \"\") {\n        if (_.isNaN(parseInt(maxPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check max price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (keyword !== \"\") {\n        if (keyword.length < 4) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please enter 4 or more characters.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    return true;\n}\n\nexport function getSafeNameProp({ emojified_name, name }: ThingObject) {\n    if (emojified_name) {\n        return { dangerouslySetInnerHTML: { __html: emojified_name } };\n    } else {\n        return { children: name };\n    }\n}\n\nexport function isVideoUploadable(thing: ThingObject): boolean {\n    if ((thing && thing.hotel_search) || thing.metadata) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction salesAvailable(thing: ThingObject): boolean {\n    if (!isEmpty(thing.sales)) {\n        return thing.sales_available;\n    }\n    return false;\n}\n\nexport function getThingName(thing: ThingObject) {\n    if (thing.type === \"giftcard\") {\n        return gettext(\"Fancy Gift Card\");\n    } else if (salesAvailable(thing)) {\n        return thing.sales.name;\n    } else {\n        return thing.name;\n    }\n}\n","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { closePopup, KEYS, MP, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nexport default class AddlistPopup extends Component {\n    static popupName = 'add-list';\n    state = {\n        lists: [],\n        listSearchQuery: '',\n        listCreationQuery: '',\n        listCreating: false,\n    };\n\n    handleDialogOpen = () => {\n        this.setState({ lists: [], listSearchQuery: '', listCreationQuery: '' });\n        this.drawUserList()\n        setTimeout(() => {\n            this.listSearchInput.focus();\n        }, 0);\n\n    }\n    componentDidMount() {\n        $.dialog(AddlistPopup.popupName).$obj.on('open', this.handleDialogOpen);\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AddlistPopup.popupName).center();\n    }\n\n    drawUserList() {\n        const objectId = this.props.objectId;\n        getListCheckbox({\n            objectId,\n            callback: res => { this.setState(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setState({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (this.state.listCreating) return;\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        this.setState({ listCreating: true })\n        // save new list\n        updateList({\n            objectId,\n            createList: listCreationQuery,\n            callback: (success, updated) => {\n                if (success) {\n                    const { lists } = this.state;\n                    MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    this.setState( {\n                        listCreationQuery: '', listCreating: false,\n                        lists: [ ...updated, ...lists ],\n                    });\n                }\n            }\n        })\n    }\n\n    handleListItemToggle = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = Number(targ.getAttribute('data-listid'));\n        const theList = lists.filter(list => list.id === selectedListId)[0];\n        const prevAdded = theList.added;\n        theList.added = !theList.added;\n        const eventName = theList.added ? \"Add to List\" : \"Remove from List\";\n        this.setState({ lists })\n\n        const callback = (success, updated) => {\n            const { lists } = this.state;\n            if (success) {\n            } else {\n                const theList = lists.filter(list => list.id === selectedListId)[0];\n                theList.added = prevAdded;\n            }\n            this.setState({ lists })\n            MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n        };\n\n        const update = { objectId, callback };\n\n        if (theList.added) update['checked'] = [theList.id];\n        else update['unchecked'] = [theList.id];\n        updateList(update)\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setState({ listCreationQuery: event.target.value });\n    }\n\n    render() {\n        var { objectId } = this.props;\n        var {\n            lists,\n            listSearchQuery,\n            listCreationQuery,\n            listCreating,\n        } = this.state;\n\n        return (\n            <>\n                <p className=\"ltit\">Add to lists</p>\n                <fieldset className=\"search\">\n                    <input type=\"text\" placeholder=\"Search\" className=\"text\" \n                        value={listSearchQuery} ref={(element) => {this.listSearchInput = element;}}\n                        onChange={this.handleListSearch} />\n                </fieldset>\n                <div className=\"list\">\n                    <ul ref={(el) => {this.lists = el;}}>\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style} className={classnames({ \"added\": list.added })}>\n                                <label>{list.name}</label>\n                                <button\n                                    data-listid={list.id} \n                                    onClick={this.handleListItemToggle}\n                                    className=\"btns-blue-embo\">{list.added ? \"Remove\" : \"Add\"}</button>\n                            </li>\n                        )\n                    })}\n                    </ul>\n                </div>\n                <fieldset className=\"create\">\n                    <input \n                        type=\"text\" placeholder=\"Create new list\" \n                        ref={(element) => {this.quickCreateList = element;}}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}/>\n                    <button className={classnames(\"btn-create\", { \"loading\": listCreating })} style={Display.NoneIf($.trim(listCreationQuery).length == 0)}\n                        onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </fieldset>\n                <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n            </>\n        );\n    }\n}\n\nfunction getListCheckbox({ objectId, callback }) {\n    $.get('/get_list_checkbox.json', { tid: objectId }).done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            closePopup(AddlistPopup.popupName);\n        }\n        callback && callback({ lists: resp.lists })\n    },)\n    .error(err => { \n        alertify.alert(\"Please try again later.\");\n        console.warn(err); \n        closePopup(AddlistPopup.popupName);\n    });\n}\n\nfunction updateList({ objectId, checked, unchecked, createList, callback }) {\n    const payload = { tid: objectId };\n    if (checked) payload['add_list_ids'] = checked.join(',');\n    if (unchecked) payload['remove_list_ids'] = unchecked.join(',');\n    if (createList) payload['new_list'] = createList;\n\n    $.post('/update_list_checkbox.json', payload)\n    .done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            callback(false, null);\n        } else {\n            callback(true, resp.lists);\n        }\n    })\n    .error(err => { \n        console.warn(err); \n        alertify.alert(\"Please try again later.\");\n        callback(false, []);\n    })\n}\n","import React from 'react';\nimport { Display } from \"fancymixin\";\nimport classnames from 'classnames';\nimport { xmlUtil } from \"fancyutils\";\n\nexport default class AdminPopup extends React.Component {\n    static popupName = 'thing-admin';\n    state = {\n        show_on_homepage: null,\n        date_published: null, \n        exclude_from_popular: false,\n        show_in_search: true,\n        optionSaving: false,\n        ownerSaving: false,\n        mergeSaving: false,\n    };\n    \n    \n    componentDidMount() {\n        const that = this;\n        $.dialog(AdminPopup.popupName).$obj.on('open', () => {\n            const { thing: { show_on_homepage, date_published, exclude_from_popular, show_in_search }  } = that.props;\n            that.setState( { show_on_homepage, date_published, exclude_from_popular, show_in_search } );\n        });\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AdminPopup.popupName).center();\n    }\n    \n    handleSaveOptions = () => {\n        const { thing } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving } = this.state;\n        if (optionSaving) return false;\n        const payload = { thing_id: thing.id, show_on_homepage, exclude_from_popular, show_in_search }\n        if (show_on_homepage) {\n            let inputDate = new Date(date_published);\n            if (isNaN(inputDate)) {\n                alert(\"invalid date - must be in format of 2020-01-01 10:10:10\");\n                return false;\n            }            \n            payload['date_published'] = inputDate.toISOString().replace(/T/, \" \").split(\".\")[0];\n        }\n        this.setState({optionSaving:true});\n        $.post('/manage-newthing.json', payload).then((json) => {\n            if (json.status_code == 1) {\n                Object.assign(thing, payload);\n                alert(\"Updated!\");\n            } else {\n                alert(json.message || \"Failed to save the changes\");\n            }\n            this.setState({optionSaving:false})\n        }).fail(() => {\n            alert(\"Something went wrong!\");\n            this.setState({optionSaving:false})\n        });\n    }\n\n    handleChangeOwner = () => {\n        const { thing } = this.props;\n        if (this.state.ownerSaving) return false;\n        if (this.changeOwnerEl == null) return false;\n        const new_owner = this.changeOwnerEl.value.trim();\n        if (new_owner.length == 0) {\n            alert(\"Please enter a username.\");\n            return false;\n        }\n        if (new_owner.toLowerCase() == thing.thing_owner.username.toLowerCase()) {\n            alert(\"The thing is already owned by the user.\");\n            return false;\n        }\n\n        if (window.confirm(`Do you want to change the current thing's owner to ${new_owner}?`)) {\n            this.setState({ownerSaving: true})\n            $.ajax({\n                type: \"post\",\n                url: \"/change_new_thing_owner.xml\",\n                data: { new_owner_name: new_owner, thing_id: thing.id, new_thing_id: thing.ntid, old_user_id: thing.thing_owner.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    if (xmlUtil.isSuccess(xml)) {\n                        alert(\"Done!\");\n                        location.reload();                        \n                    } else if (xmlUtil.isFail(xml)) {\n                        alert(\n                            $(xml)\n                                .find(\"message\")\n                                .text()\n                        );\n                    }\n                })\n                .fail(() => {\n                    alert(\"There was an error.\");\n                })\n                .always(() => {\n                    this.setState({ownerSaving: false})\n                });\n        }\n        return false;\n    }\n\n    handleMergeThings = () => {\n\n    }\n\n    render() {\n        const { \n            thing, \n            thing: { sales },\n        } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving, ownerSaving, mergeSaving } = this.state;\n        return (\n          <>\n          \t<p className=\"ltit\">{thing.name}</p>\n            <div className=\"thing-admin-body\">\n                <ul className=\"thing-info\">\n                <li><em>Sale ID</em> {sales.id}</li>\n                    <li><em>Thing ID</em> {thing.id}</li>\n                    <li><em>Thing Owner</em> {thing.thing_owner.username}</li>\n                    <li className=\"buttons\">\n                        <a className=\"btns-blue-embo\" href={`/merchant/products/${sales.id}`} target=\"_blank\">Edit Sale</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-sale-orders-by-thing-id?thing_id=${thing.id}`} target=\"_blank\">View Orders</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-users-by-cart-item?sale_id=${sales.id}`} target=\"_blank\">View Carts</a>\n                    </li>\n                </ul>\n                <div className=\"thing-options\">\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-on-homepage\" checked={!!show_on_homepage}\n                        onChange={(event) => this.setState({ show_on_homepage: event.target.checked })}\n                        /> Show on Homepage</label>\n                        <input className=\"text\" type=\"text\" name=\"date-published\" placeholder=\"2020-01-02 10:20:30\"\n                            style={Display.NoneIf(!show_on_homepage)} value={date_published || ''}\n                            onChange={(event) => {this.setState({ date_published: event.target.value })}}\n                            />\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"exclude-from-popular\" checked={!!exclude_from_popular}\n                            onChange={(event) => this.setState({ exclude_from_popular: event.target.checked })}\n                        /> Exclude from Popular</label>\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-in-search\" checked={!!show_in_search}\n                            onChange={(event) => this.setState({ show_in_search: event.target.checked })}\n                        /> Show in Search</label>\n                    </p>\n                    <p>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": optionSaving })} onClick={this.handleSaveOptions}>Save Changes</button>\n                    </p>                    \n                </div>\n                <div className=\"thing-actions\">\n                    <p>\n                        <label>Change Owner</label>\n                        <input type=\"text\" name=\"change_owner\" placeholder=\"Enter new username\" ref={(el) => {this.changeOwnerEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": ownerSaving })} onClick={this.handleChangeOwner}>Change</button>\n                    </p>\n                    {/*\n                    <p>\n                        <label>Merge Things</label>\n                        <input type=\"text\" name=\"merge_thing_id\" placeholder=\"Enter Thing ID\" ref={(el) => {this.mergeThingEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": mergeSaving })} onClick={this.handleMergeThings}>Merge</button>\n                    </p>*/}\n                </div>\n\n            </div>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React from 'react';\nimport classnames from 'classnames';\nimport { closePopup, copyToClipboard } from 'fancyutils';\n\nexport default class SimpleSharePopup extends React.Component {\n    static popupName = 'minimum-share';\n\n    constructor(props) {\n        super(props);\n        const { thing, viewer } = props;\n        let url = `https://fancy.com${thing.url}`;\n        if (viewer && viewer.username) {\n            let connector = ~url.indexOf('?') ? '&' : '?';\n            url = `${url}${connector}ref=${viewer.username}`\n        }\n        console.log(url)\n        this.state = {\n            shareUrl: url,\n            urlCopied: false,\n        }\n    }\n\n    handleCancelClick = (event) => {\n        event.preventDefault();\n        closePopup(SimpleSharePopup.popupName);\n    }\n\n    componentDidUpdate(){\n        $.dialog(SimpleSharePopup.popupName).center();\n    }\n\n    handleCopyLink = (event) => {\n        console.log('handleCopyLink');\n        const { shareUrl } = this.state;\n        console.log('handleCopyLink ' + shareUrl );\n        copyToClipboard(shareUrl);\n        this.setState({ urlCopied: true });\n        setTimeout(() => {\n            this.setState({ urlCopied: false });\n        }, 2000);\n    }\n\n\n    render() {\n        const { thing, viewer } = this.props;\n        const { shareUrl, urlCopied } = this.state;\n\n        return (\n          <>\n          \t<p className=\"ltit\">Share</p>\n            <ul>\n                <li><a href=\"#\" className=\"btn-copy-link link\" onClick={this.handleCopyLink}>{urlCopied ? \"Copied to clipboard\" : \"Copy link\"}</a></li>\n                <li><a \n                    href={`http://pinterest.com/pin/create/link/?url=${encodeURIComponent(shareUrl)}&media=${thing.images ? encodeURIComponent(thing.images[0].image_url) : \"\"}&description=${encodeURIComponent(thing.name)}`}\n                    target=\"_blank\" className=\"pin\">Share to Pinterest</a></li>\n                <li><a \n                    href={`mailto:?body=Check%20out%20${encodeURIComponent(thing.name)}%20on%20Fancy!%0A%0A${encodeURIComponent(shareUrl)}&subject=${encodeURIComponent(thing.name)}%20on%20Fancy`}\n                    target=\"_blank\" className=\"email\">Share via email</a></li>\n            </ul>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import { OverlayProps, ReduxProps } from 'ftypes';\nimport React from 'react';\n\nexport function getFancyContextDefaultValue() {\n  return {\n      appContext: {},\n      thing: {},\n      followContext: {},\n      fancyContext: {},\n      slideContext: {},\n      saleContext: {},\n      dispatch: () => {},\n  }\n}\n\n// @ts-ignore\nconst FancyContext = React.createContext<OverlayProps & ReduxProps>(getFancyContextDefaultValue());\n\nexport const useFancy = () : OverlayProps & ReduxProps => {\n  return React.useContext(FancyContext);\n}\n\nexport default FancyContext;\n","import React, { useState, useRef, useEffect } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\n\nimport ThingCard from \"./ThingCard\";\nimport { useFancy } from \"./FancyContext\";\n\nconst MerchantInfo = () => {\n    const {\n        thing,\n        thing: {\n            sales: { seller },\n        },\n    } = useFancy();\n    const [showMore, setShowMore] = useState(false);\n    const descEl = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        setShowMore(descEl.current ? descEl.current.clientHeight <= 80 : false);\n    }, [thing.id]);\n\n    return (\n        <div className=\"merchant-info\">\n            <h2 className=\"stit\">More about {seller.brand_name}</h2>\n            <div className={classnames(\"description\", { collapsed: !showMore })}>\n                <div dangerouslySetInnerHTML={{ __html: seller.description }} ref={descEl} />\n            </div>\n            <a className=\"more\" style={{ display: showMore ? \"none\" : undefined }} onClick={() => setShowMore(true)}>\n                Read more\n            </a>\n            <a className=\"btns-blue-embo\" href={seller.shop_url}>\n                Explore more\n            </a>\n            <Swiper className=\"swiper-no-swiping\">\n                {seller.sale_items.map((item, i) => {\n                    return (\n                        <SwiperSlide key={i} tag=\"li\">\n                            <ThingCard {...item} brand_name={seller.brand_name} />\n                        </SwiperSlide>\n                    );\n                })}\n            </Swiper>\n        </div>\n    );\n};\n\nexport default MerchantInfo;\n","import React, { useEffect, useState } from \"react\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\n\nimport ThingCard, { ThingCardProps } from \"./ThingCard\";\nimport { useFancy } from \"./FancyContext\";\n\nconst Recommendation = () => {\n    return (\n        <>\n            <Likeable />\n            <RecentlyViewed />\n        </>\n    );\n};\n\nconst convertThingsV1 = (things: {\n    url: string;\n    thumb_image_url_558: string;\n    sales: {\n        max_price: number;\n        min_price: number;\n        seller: {\n            brand_name: string;\n        };\n        title: string;\n    }[];\n    name: string;\n}[]) => {\n    return things.map(({ url: html_url, thumb_image_url_558: image_url, sales, name }) => {\n        return {\n            html_url,\n            image_url,\n            max_price: sales ? sales[0].max_price : 0,\n            min_price: sales ? sales[0].min_price : 0,\n            brand_name: sales ? sales[0].seller.brand_name : '',\n            title: sales ? sales[0].title : name,\n        };\n    });\n};\n\nconst Likeable = () => {\n    const { thing: { recommended } } = useFancy();\n\n    return (recommended?.length > 0) ? (\n        <>\n            <div className=\"recommend similar\">\n                <h2 className=\"stit\">You May Also Like</h2>\n                {/*<div className=\"control\">\n                    <div\n                        onClick={() => {\n                            setOffset(Math.max(5, offset - 5));\n                        }}>\n                        {\"<\"}\n                    </div>\n                    <div\n                        onClick={() => {\n                            setOffset(Math.min(offset + 5, ((things.length / 5) | 0) * 5));\n                        }}>\n                        {\">\"}\n                    </div>\n                </div>*/}\n            </div>\n            <Swiper className=\"recommend similar swiper-no-swiping\" slidesPerColumn={5}>\n                {recommended?.map((thing, i) => {\n                              return (\n                                  <SwiperSlide key={i}>\n                                      <ThingCard {...thing} />\n                                  </SwiperSlide>\n                              );\n                          })}\n            </Swiper>\n        </>\n    ) : null;\n};\n\nconst RecentlyViewed = () => {\n    const { thing } = useFancy();\n    const [things, setThings] = useState<ThingCardProps[] | null>(null);\n    // const [offset, setOffset] = useState(4);\n    const offset = 4;\n\n    useEffect(() => {\n        $.ajax({\n            type: \"get\",\n            url: `/recently_viewed_things_json?include_sale_item_option=True&rapi_compl=True&count=4&thing_id=${thing.id}`,\n        }).then((response) => {\n            const recently = convertThingsV1(response);\n            setThings(recently);\n        });\n    }, []);\n\n    return (\n        <>\n            <div className=\"recommend recently\">\n                <h2 className=\"stit\">Recently Viewed</h2>\n                {/*<div className=\"control\" style=\"display:none;\">\n                    <div\n                        onClick={() => {\n                            setOffset(Math.max(4, offset - 4));\n                        }}>\n                        {\"<\"}\n                    </div>\n                    <div\n                        onClick={() => {\n                            setOffset(Math.min(offset + 4, ((things.length / 4) | 0) * 4));\n                        }}>\n                        {\">\"}\n                    </div>\n                </div>*/}\n            </div>\n            <Swiper className=\"recommend recently swiper-no-swiping\" slidesPerColumn={4}>\n                {things\n                    ? things\n                          .filter((_, i) => {\n                              if (offset > 4) {\n                                  return i >= offset - 4 && i < offset;\n                              }\n                              return i < offset;\n                          })\n                          .map((thing, i) => {\n                              return (\n                                  <SwiperSlide key={i}>\n                                      <ThingCard {...thing} />\n                                  </SwiperSlide>\n                              );\n                          })\n                    : null}\n            </Swiper>\n        </>\n    );\n};\n\nexport default Recommendation;\n","import cx from \"classnames\";\nimport React, { Dispatch, SetStateAction, useEffect, useState } from \"react\";\nimport SwiperCore, { Thumbs } from \"swiper\";\nimport Lightbox from \"react-image-lightbox\";\nimport { debounceEventUntilTimeout } from \"fancyutils\";\n\nimport { useFancy } from \"./FancyContext\";\nimport type { ReviewEntry as ReviewEntryType, Reviews as ReviewsType } from \"ftypes\";\n\nSwiperCore.use([Thumbs]);\n\ninterface ReviewParams {\n    page?: number;\n    per_page?: number;\n    q?: string;\n    sort?: \"newest\" | \"rating_desc\" | \"rating_asc\";\n    setLoading?: Dispatch<SetStateAction<boolean>>;\n}\n\nfunction useDefaultReviews({ page, per_page, q, sort, setLoading }: ReviewParams) {\n    const { thing } = useFancy();\n    const {\n        sales: { id: sid },\n    } = thing;\n\n    const skip = !sort && !per_page && (!page || page === 1) && !q;\n    const reviews = useReviews({ skip, sid, page, per_page, q, sort, setLoading });\n    if (skip) {\n        return thing.reviews;\n    } else {\n        return reviews;\n    }\n}\n\nfunction useReviews({\n    skip = false,\n    sid,\n    page,\n    per_page,\n    q,\n    sort,\n    setLoading,\n}: ReviewParams & { skip: boolean; sid: number }) {\n    const [reviews, setReviews] = useState(null);\n    const param = $.extend({}, { q, page, per_page, sort });\n\n    useEffect(() => {\n        if (skip) {\n            return;\n        }\n        setLoading?.(true);\n        $.get(`/rest-api/v2/reviews/saleitem/${sid}`, param)\n            .then((res) => {\n                setReviews(res);\n            })\n            .always(() => {\n                setLoading?.(false);\n            });\n    }, [skip, sid, q, page, per_page, sort]);\n\n    return reviews;\n}\n\nconst Reviews = () => {\n    const [loading, setLoading] = useState(false);\n    const [reviewOption, setReviewOption] = useState({\n        page: undefined,\n        per_page: undefined,\n        q: undefined,\n        sort: undefined,\n    });\n\n    const reviews = useDefaultReviews({ ...reviewOption, setLoading });\n\n    if (reviewOption.q === undefined && (!reviews || reviews.review_count === 0)) {\n        return null;\n    }\n\n    return (\n        <div className={cx(\"review-points review-section\", { loading })}>\n            <ReviewHead reviews={reviews} />\n            <ReviewList\n                reviews={reviews}\n                reviewOption={reviewOption}\n                setReviewOption={(applying) => {\n                    setReviewOption({ ...reviewOption, ...applying });\n                }}\n            />\n        </div>\n    );\n};\n\nconst ReviewHead = ({ reviews } : { reviews: ReviewsType }) => {\n    return (\n        <>\n            <h3 className=\"stit\">\n                {reviews.summary.rating_avg}{\" \"}\n                <small className=\"count\">\n                    ({reviews.summary.total_ratings} rating{reviews.summary.total_ratings != 1 ? \"s\" : \"\"})\n                </small>\n            </h3>\n            <ul className=\"optional\">\n                {reviews.summary.attributes.map((a, i) => {\n                    return (\n                        <li key={i}>\n                            <label>{a.label}</label>\n                            <span className=\"review-range\">\n                                <i className=\"review-range-value\" style={{ width: `${Number(a.rating) * 20}%` }}></i>\n                            </span>\n                            <b>{a.rating}</b>\n                        </li>\n                    );\n                })}\n            </ul>\n            {/* <div className=\"btn-area\">\n                <button className=\"btns-blue-embo btn-review\">Write a Review</button>\n            </div> */}\n        </>\n    );\n};\n\nconst ReviewEntry = ({ review } : { review: ReviewEntryType }) => {\n    const [photoIndex, setPhotoIndex] = useState<number | null>(null);\n\n    return (\n        <li>\n            <small className=\"date\">{review.date}</small>\n            <span className={\"review-range \" + \"point\" + (review.rating | 0)}>\n                <span className=\"bg\"></span>\n                <i className=\"review-range-value\">\n                    <span></span>\n                </i>\n            </span>\n            <span className=\"username\">{review.name}</span>{\" \"}\n            <span className=\"verified\">\n                <em>Verified User</em>\n            </span>\n            <b className=\"title\">{review.title}</b>\n            <span className=\"description\">{review.review}</span>\n            <div>\n                {review.images.map((image, i) => {\n                    return (\n                        <div className=\"photo\" key={i}>\n                            <img\n                                onClick={() => {\n                                    setPhotoIndex(i);\n                                }}\n                                alt=\"review image\"\n                                src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n                                style={{\n                                    backgroundImage: `url('${image.thumbnail_url}')`,\n                                }}\n                            />\n                        </div>\n                    );\n                })}\n                {photoIndex !== null && (\n                    <Lightbox\n                        mainSrc={review.images[photoIndex].image_url}\n                        nextSrc={review.images[(photoIndex + 1) % review.images.length].image_url}\n                        prevSrc={\n                            review.images[(photoIndex + review.images.length - 1) % review.images.length].image_url\n                        }\n                        onCloseRequest={() => setPhotoIndex(null)}\n                        onMovePrevRequest={() =>\n                            setPhotoIndex((photoIndex + review.images.length - 1) % review.images.length)\n                        }\n                        onMoveNextRequest={() => setPhotoIndex((photoIndex + 1) % review.images.length)}\n                    />\n                )}\n            </div>\n        </li>\n    );\n};\n\nconst ReviewList = ({ reviews, reviewOption, setReviewOption } : { reviews: ReviewsType }) => {\n    const currentPage = reviewOption.page || 1;\n    return (\n        <>\n            <fieldset className=\"search\">\n                <label>Filter reviews</label>\n                <input\n                    type=\"text\"\n                    placeholder=\"Search topics and reviews\"\n                    className=\"text\"\n                    onChange={debounceEventUntilTimeout((e) => {\n                        setReviewOption({ q: e.target.value });\n                    }, 500)}\n                />\n                <span className=\"sort\">\n                    <label>Sort By:</label>\n                    <select\n                        onChange={({ target }) => {\n                            setReviewOption({ sort: target.value });\n                        }}>\n                        <option value=\"newest\">Most Recent</option>\n                        <option value=\"rating_desc\">Highest Rated</option>\n                        <option value=\"rating_asc\">Lowest Rated</option>\n                    </select>\n                </span>\n            </fieldset>\n            <ul className=\"review-list\">\n                {reviews.reviews.length > 0 ? (\n                    reviews.reviews.map((review, i) => <ReviewEntry key={i} review={review} />)\n                ) : (\n                    <li className=\"no-review\">There is no review matching your request. Please try another option.</li>\n                )}\n            </ul>\n            <div className=\"review-pagination\">\n                {currentPage > 1 && (\n                    <>\n                        <a href=\"#\" className=\"more\">\n                            See more reviews\n                        </a>\n                        <a\n                            className=\"prev\"\n                            onClick={() => {\n                                setReviewOption({ page: Math.max(1, currentPage - 1) });\n                            }}>\n                            Prev\n                        </a>\n                    </>\n                )}\n                {currentPage < reviews.total_pages && (\n                    <a\n                        className=\"next\"\n                        onClick={() => {\n                            setReviewOption({ page: Math.min(currentPage + 1, reviews.total_pages) });\n                        }}>\n                        Next\n                    </a>\n                )}\n                {_.range(1, reviews.total_pages + 1).map((pageNum, i) => (\n                    <a\n                        key={i}\n                        onClick={() => {\n                            setReviewOption({ page: pageNum });\n                        }}\n                        className={currentPage === pageNum ? \"current\" : undefined}>\n                        {pageNum}\n                    </a>\n                ))}\n            </div>\n        </>\n    );\n};\n\nexport default Reviews;\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { MP, renderPopup } from \"fancyutils\";\nimport { useDispatch } from 'react-redux'\n\nimport { useFancy } from \"../FancyContext\";\nimport AdminPopup from \"../../popup/AdminPopup\"\nimport SimpleSharePopup from \"../../popup/SimpleSharePopup\"\nimport AddlistPopup from \"../../popup/AddlistPopup\"\nimport { toggleFancy, getCordialProperties } from \"../../../action/action-helpers\";\n\nfunction Favorite() {\n    const { appContext, thing, fancyContext } = useFancy();\n    const dispatch = useDispatch();\n\n    const handleClick = (event: React.MouseEvent) => {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log('favortie');\n        if (!appContext.loggedIn) {\n            window.require_login(null, \"fancy_thing\", thing.id);\n            return;\n        }\n\n        if (fancyContext.loading) {\n            return;\n        }\n\n        dispatch(toggleFancy(thing.id));\n\n        if (!fancyContext.fancyd) {\n            MP(\"Fancy\", { thing_id: thing.id });\n            try{\n                window.crdl('event', 'favorite_item', getCordialProperties(thing));\n            } catch(e) {\n            }\n        } else {\n            MP(\"Unfancy\", { thing_id: thing.id });\n        }\n    };\n\n    return (\n        <a className={classnames(\"button button-static fancy _count\", { fancyd: fancyContext.fancyd })} onClick={handleClick}>\n            Favorite\n        </a>\n    );\n}\n\nexport default function ActionButtons() {\n    const {\n        appContext: { viewer, loggedIn },\n        thing,\n        fancyContext,\n    } = useFancy();\n\n    return (\n        <>\n            <span className=\"_fancyd fancyd_user\">{fancyContext.fancyd_count} people favorited</span>\n            <a onClick={(event) => {\n                event.preventDefault();\n                if (!loggedIn) {\n                    window.require_login();\n                    return;\n                }\n                renderPopup(AddlistPopup, { objectId: thing.id });\n            }} className=\"add-list\">Add to List</a>\n            <div className=\"figure-button action-button-v2\">\n                { viewer.is_admin_any && (\n                    <a className=\"edit\" \n                        onClick={(event) => {\n                            event.preventDefault();\n                            renderPopup(AdminPopup, { viewer, thing });\n                        }}>Edit</a>\n                )}\n                <Favorite />\n                <a\n                    className=\"btn-share\"\n                    onClick={(event) => {\n                        event.preventDefault();\n                        renderPopup(SimpleSharePopup, { viewer, thing });\n                    }}>\n                    Share\n                </a>\n            </div>\n        </>\n    );\n}\n","import React, { useEffect, useState, useRef } from \"react\";\nimport cx from \"classnames\";\n\nimport { useFancy } from \"../FancyContext\";\n\nconst Overview = () => {\n    const { thing } = useFancy();\n    const sales = thing.sales;\n    const bv = sales.seller.brand_values;\n    const shippingInfo: { [k: string]: any } = sales.shipping_info || {};\n\n    return (\n        <div className=\"overview\">\n            <dl className=\"shipping optional\">\n                <dt>Shipping Information</dt>\n                <dd>\n                    <ul>\n                        <li className=\"from\">\n                            <span>{shippingInfo.origin}</span>\n                        </li>\n                        {shippingInfo.cost && (\n                            <li className=\"cost\">\n                                <span>{shippingInfo.cost}</span>\n                            </li>\n                        )}\n                        {shippingInfo.window && (\n                            <li className=\"days\">\n                                <span>{shippingInfo.window}</span>\n                            </li>\n                        )}\n                    </ul>\n                </dd>\n            </dl>\n            {bv.length > 0 ? (\n                <dl className=\"brand-value optional\">\n                    <dt>Buy with Confidence</dt>\n                    <dd>\n                        {bv.slice(0,3).map(([className, text]) => (\n                            <span key={className} className={`badge ${className}`}>{text}</span>\n                        ))}\n                    </dd>\n                </dl>\n            ) : null}\n        </div>\n    );\n};\n\nconst Description = () => {\n    const [menu, setMenu] = useState<\"features\" | \"specification\" | \"returns\">(\"features\");\n    const [showMore, setShowMore] = useState(false);\n    const descEl = useRef<HTMLDivElement>(null);\n    const props = useFancy();\n    const { thing, thing: { sales } } = props;\n    const showFeatures = !!(sales.features && sales.features.trim());\n    const showSpecs = !!(sales.specifications && sales.specifications.trim());\n    const showReturns =\n        !!(sales.return_exchange_policy_title && sales.return_exchange_policy_title.trim()) ||\n        !!(sales.shipping_policy && sales.shipping_policy.trim());\n    \n    useEffect(() => {\n        if (showFeatures) {\n            setMenu('features');\n        } else if (showSpecs) {\n            setMenu('specification');\n        } else if (showReturns) {\n            setMenu('returns');\n        }\n        setShowMore(descEl.current ? descEl.current.clientHeight <= 76 : false);\n    }, [thing.id]);\n\n    return (\n        <div className=\"detail\">\n            <dl className={cx(\"description optional\")}>\n                <dt>Description</dt>                \n                <dd className={cx({ collapsed: !showMore })}>\n                    <div dangerouslySetInnerHTML={{ __html: sales.description }} ref={descEl}/>\n                </dd> \n                <a className=\"more\" onClick={() => setShowMore(true)} style={{display: showMore ? 'none' : undefined }}>Read more</a>\n            </dl>\n            <div className=\"features-menu\">\n                {showFeatures && (\n                    <a\n                        className={cx({ current: menu === \"features\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"features\");\n                        }}>\n                        Features\n                    </a>\n                )}\n                {showSpecs && (\n                    <a\n                        className={cx({ current: menu === \"specification\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"specification\");\n                        }}>\n                        Specifications\n                    </a>\n                )}\n                {showReturns && (\n                    <a\n                        className={cx({ current: menu === \"returns\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"returns\");\n                        }}>\n                        Returns\n                    </a>\n                )}\n            </div>\n            {showFeatures && (\n                <dl className={cx(\"features optional\", { show: menu === \"features\" })} data-featuretype=\"features\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"features\");\n                            }}>\n                            Features\n                        </a>\n                    </dt>\n                    <dd dangerouslySetInnerHTML={{ __html: sales.features }} />\n                </dl>\n            )}\n            {showSpecs && (\n                <dl\n                    className={cx(\"features optional\", { show: menu === \"specification\" })}\n                    data-featuretype=\"specifications\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"specification\");\n                            }}>\n                            Specifications\n                        </a>\n                    </dt>\n                    <dt></dt>\n                    <dd dangerouslySetInnerHTML={{ __html: sales.specifications }} />\n                </dl>\n            )}\n            {showReturns && (\n                <dl className={cx(\"features optional\", { show: menu === \"returns\" })} data-featuretype=\"returns\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"returns\");\n                            }}>\n                            Returns\n                        </a>\n                    </dt>\n                    <dd><p>{sales.return_exchange_policy_title}</p><p>{sales.shipping_policy}</p></dd>\n                </dl>\n            )}\n        </div>\n    );\n};\n\nconst Detail = () => {\n    return (\n        <div className=\"figure-detail\">\n            <Overview />\n            <Description />\n        </div>\n    );\n};\n\nexport default Detail;\n","import React, { memo, useEffect, useState, useRef } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\nimport SwiperCore, { Thumbs, Zoom } from \"swiper\";\nimport { Video } from \"common-components\";\nimport { Display } from \"fancymixin\";\n\nimport { useFancy } from \"../../FancyContext\";\nimport ActionButtons from \"../ActionButtons\";\nimport { getCurrentSaleOption, getSaleImages } from \"../../../map\";\nimport { setThumbnailIndex } from \"../../../../action/actions\";\nimport { isZoomable, getZoomImageStyle, getNextZoomImageStyle } from \"./zoom\";\n\nimport type { ThingImageOrVideo } from \"ftypes\";\nimport type { Swiper as SwiperClass } from \"ftypes\";\n\nconst isTouchDevice = \"ontouchstart\" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;\nconst SwiperAddons = [Thumbs];\nif (isTouchDevice) {\n    SwiperAddons.push(Zoom);\n}\nSwiperCore.use(SwiperAddons);\n\nconst placeholderImage = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\nconst HEIGHT = 480;\nconst PER_PAGE = 5;\n\nconst preloadImage = (src: string) =>\n    new Promise((r) => {\n        const image = new window.Image();\n        image.onload = r;\n        image.onerror = r;\n        image.src = src;\n    });\n\ninterface ImageSlideProps {\n    image: ThingImageOrVideo;\n    i: number;\n    isActive: boolean;\n    setSlideLocked: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nconst ImageSlide = memo<ImageSlideProps>(({ image, i, setSlideLocked, isActive }) => {\n    const {\n        thing,\n        slideContext: { thumbnailIndex },\n    } = useFancy();\n    const [isZoomActive, setZoomActive] = useState(false);\n    const [zoomImageStyle, setZoomImageStyle] = useState(Display.None);\n    const [zoomImageCacheKey, setZoomImageCacheKey] = useState(\"\");\n    const [zoomImageLoaded, setZoomImageLoaded] = useState(false);\n\n    const isVideo = !!image.h264_1000k_url;\n    const isMagnifyingGlassZoomable = !isVideo && !isTouchDevice;\n    const [zoomable, setZoomable] = useState(false);\n\n    useEffect(() => {\n        if (!zoomImageCacheKey && isZoomActive) {\n            preloadImage(image.large_image_url).then(() => {\n                setZoomImageCacheKey(image.large_image_url);\n                setZoomImageLoaded(true);\n            });\n        }\n        if (zoomImageCacheKey !== \"\" && image.large_image_url !== zoomImageCacheKey) {\n            setZoomImageCacheKey(\"\");\n            setZoomImageLoaded(false);\n        }\n    }, [image.large_image_url, isZoomActive, zoomImageCacheKey]);\n\n    return (\n        <SwiperSlide\n            zoom={isMagnifyingGlassZoomable}\n            key={i}\n            className={classnames({\n                \"video-slide\": isVideo,\n                startZoom: isZoomActive,\n                zoomShow: zoomable,\n                'active-slide': isActive,\n                loading: thing.loading,\n            })}\n            onClick={() => {\n                if (isMagnifyingGlassZoomable && zoomable) {\n                    setZoomActive(!isZoomActive);\n                    setSlideLocked(!isZoomActive);\n                }\n            }}\n            onMouseMove={({ pageX, pageY }) => {\n                if (!isMagnifyingGlassZoomable) {\n                    return;\n                }\n                const newZoomable = isZoomable(image);\n                if (zoomable !== newZoomable) {\n                    setZoomable(newZoomable);\n                }\n                if (isZoomActive) {\n                    const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                    setZoomImageStyle(nextZoomImageStyle);\n                }\n            }}>\n            {isVideo ? (\n                <Video\n                    object={image}\n                    display={true}\n                    playing={thumbnailIndex == i}\n                    lastFullyRenderedObjectID={thing.id}\n                    allow={{ fullScreen: true }}\n                />\n            ) : (\n                <>\n                    <img\n                        className=\"swiper-lazy\"\n                        src={image.image_url}\n                        data-src={image.image_url}\n                        onLoad={() => {\n                            setZoomable(isZoomable(image));\n                        }}\n                        title={!isTouchDevice ? \"Double click to zoom-in\" : undefined}\n                        alt={thing.name}\n                        style={zoomable ? { cursor: \"zoom-in\" } : undefined}\n                    />\n                    <em\n                        className=\"zoomImage\"\n                        onClick={() => {\n                            setZoomActive(false);\n                            setSlideLocked(false);\n                        }}\n                        style={{\n                            ...getZoomImageStyle(image, isZoomActive, zoomImageStyle),\n                            backgroundImage: `url(${zoomImageLoaded ? image.large_image_url : image.image_url})`,\n                        }}\n                    />\n                    {isTouchDevice && <div className=\"swiper-lazy-preloader\" />}\n                </>\n            )}\n        </SwiperSlide>\n    );\n}, (prevProps: ImageSlideProps, nextProps: ImageSlideProps) => {\n    return prevProps.image.image_url === nextProps.image.image_url && prevProps.isActive === nextProps.isActive;\n});\nImageSlide.displayName = \"SwiperSlide\"; // This is important to make swiper to acknowledge it's actually slide, not some random components\n\nconst Image = () => {\n    const fancyProps = useFancy();\n    const {\n        thing,\n        saleContext,\n        slideContext: { thumbnailIndex },\n    } = fancyProps;\n    const swiperRef = useRef(null);\n    const swipeThumbsRef = useRef(null);\n    const [thumbIndex, setThumbIndex] = useState(0);\n    const [slideLocked, setSlideLocked] = useState(false);\n    const [swiper, setSwiper] = useState<null | SwiperClass>(null);\n    const option = getCurrentSaleOption(thing.sales, saleContext, true);\n    const images = getSaleImages(thing, option) as ThingImageOrVideo[];\n    const lastThumbIndex = images.length - PER_PAGE;\n\n    useEffect(() => {\n        if (!swiper) {\n            return;\n        }\n        if (thumbnailIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbnailIndex);\n        }\n        if (swipeThumbsRef.current) {\n            const thumbSwiper = swipeThumbsRef.current.swiper;\n            if (!thumbSwiper.slides[thumbnailIndex].classList.contains(\"swiper-slide-visible\"))\n                thumbSwiper.slideTo(Math.min(thumbnailIndex, lastThumbIndex));\n        }\n    }, [thumbnailIndex, swiper]);\n\n    useEffect(() => {\n        if (!swipeThumbsRef.current) {\n            return;\n        }\n        const swiper = swipeThumbsRef.current.swiper;\n        if (thumbIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbIndex);\n        }\n    }, [thumbIndex]);\n\n    return (\n        <div className=\"figure-section\">\n            <Swiper\n                ref={swiperRef}\n                onSlideChange={() => {\n                    if (swiper) {\n                        fancyProps.dispatch(setThumbnailIndex(swiper.activeIndex));\n                    }\n                }}\n                preloadImages={false}\n                lazy={{\n                    loadPrevNext: true,\n                    loadPrevNextAmount: 0,\n                }}\n                zoom={\n                    isTouchDevice\n                        ? {\n                              maxRatio: 2,\n                          }\n                        : undefined\n                }\n                allowSlidePrev={!slideLocked}\n                allowSlideNext={!slideLocked}\n                onZoomChange={(_, scale) => {\n                    if (scale > 1) {\n                        setSlideLocked(true);\n                    } else {\n                        setSlideLocked(false);\n                    }\n                }}\n                onSwiper={(swiper) => {\n                    setSwiper(swiper);\n                }}\n                className=\"gallery-top\">\n                {images.map((image, i) => {\n                    return <ImageSlide key={i} image={image} i={i} setSlideLocked={setSlideLocked} isActive={swiper?.activeIndex === i} />;\n                })}\n                <ActionButtons />\n            </Swiper>\n            <div\n                className=\"prev\"\n                style={{ opacity: thumbIndex > 0 ? undefined : 0.3, display: lastThumbIndex <= 0 ? \"none\" : undefined }}\n                onClick={() => setThumbIndex(Math.max(0, thumbIndex - 5))}\n            />\n            <Swiper\n                className=\"gallery-thumbs\"\n                ref={swipeThumbsRef}\n                onSlideChange={() => {\n                    swipeThumbsRef.current && setThumbIndex(swipeThumbsRef.current.swiper.activeIndex);\n                }}\n                onClick={() =>\n                    swipeThumbsRef.current &&\n                    fancyProps.dispatch(setThumbnailIndex(swipeThumbsRef.current.swiper.clickedIndex))\n                }\n                direction=\"vertical\"\n                spaceBetween={16}\n                slidesPerView={PER_PAGE}\n                watchSlidesVisibility={true}\n                height={HEIGHT}>\n                {images.map((image, i) => {\n                    return (\n                        <SwiperSlide\n                            key={i}\n                            className={classnames({\n                                \"video-thumbnail\": image.h264_1000k_url,\n                                selected: i == thumbnailIndex,\n                            })}>\n                            <img\n                                height=\"80\"\n                                src={placeholderImage}\n                                style={{ backgroundImage: `url(${image.thumbnail_url})` }}\n                            />\n                        </SwiperSlide>\n                    );\n                })}\n            </Swiper>\n            <div\n                className=\"next\"\n                style={{\n                    opacity: thumbIndex < lastThumbIndex ? undefined : 0.3,\n                    display: lastThumbIndex <= 0 ? \"none\" : undefined,\n                }}\n                onClick={() => {\n                    setThumbIndex(Math.min(thumbIndex + 5, lastThumbIndex));\n                }}\n            />\n        </div>\n    );\n};\n\nexport default Image;\n","import { minmax } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\nimport { ThingImageOrVideo } from \"ftypes\";\n\n// TODO: cache per (thing id + image index)\nconst zoomBoxMaximumSize = 240;\nconst zoomScale = 1.5;\n\nconst getBoundarySize = () => {\n    const $el = $(\n        \".thing-detail-container .figure-section .swiper-container.gallery-top .active-slide\"\n    ).eq(0);\n\n    if ($el.length !== 1) {\n        window.DEBUG && console.warn('getBoundarySize(): warning: $el.length is ', $el.length);\n    }\n\n    return {\n        $el,\n        width: $el.width()!,\n        height: $el.height()!,\n    };\n};\ntype BS = ReturnType<typeof getBoundarySize>;\n\nconst getZoomBoxSize = (bs: BS) => Math.min(bs.width / 3, zoomBoxMaximumSize);\nconst getZoomMargin = (bs: BS) => (getZoomBoxSize(bs) - 4) / 2;\n\nconst zidCac: { [o: string]: any } = {};\nconst getZoomImageDimension = (img: ThingImageOrVideo, bs = getBoundarySize()) => {\n    if (zidCac[img.image_url]) {\n        return zidCac[img.image_url];\n    }\n    const zoomMargin = getZoomMargin(bs);\n    // const imageSize = calculateImageSize(img);\n\n    const ret = {\n        width: bs.width * zoomScale /* * (imageSize.larger === \"height\" ? imageSize.proportion : 1) */ + zoomMargin,\n        height: bs.height * zoomScale + zoomMargin,\n        /* ((b.height * imageSize.height) / imageSize.width) *\n                (imageSize.larger === \"width\" ? imageSize.proportion : 1) *\n                zoomScale +\n            zoomMargin ,*/\n    };\n    zidCac[img.image_url] = ret;\n    return ret;\n};\n\nconst getImageMeta = (bs: BS) => {\n    let width, height, marginHoriz, marginVert;\n\n    const $fig = $(\".thing-detail-container .figure-section .swiper-container.gallery-top img:eq(0)\");\n    width = $fig.width()!;\n    height = $fig.height()!;\n    marginHoriz = 0;\n    if (width > height) {\n        marginHoriz = 0;\n        marginVert = (bs.height - height) / 2;\n    } else {\n        marginHoriz = (bs.width - width) / 2;\n        marginVert = 0;\n    }\n    return { width, height, marginHoriz, marginVert };\n};\n\nexport const getNextZoomImageStyle = (img: ThingImageOrVideo, pageX: number, pageY: number) => {\n    const bs = getBoundarySize();\n    const $wrapper = bs.$el;\n\n    if (!$wrapper.length) {\n        return Display.None;\n    }\n\n    const boundaryWidth = bs.width;\n    const boundaryHeight = bs.height;\n    const meta = getImageMeta(bs);\n\n    const offset = $wrapper.offset()!;\n    const left = pageX - offset.left;\n    const top = pageY - offset.top;\n\n    const topPosition = top - (boundaryHeight - meta.height) / 2;\n\n    const showZoomImage = left > 0 && topPosition > 0 && topPosition < meta.height;\n\n    const zoomBoxSize = getZoomBoxSize(bs);\n    const zoomMargin = getZoomMargin(bs);\n\n    if (showZoomImage) {\n        const zd = getZoomImageDimension(img, bs);\n        const zoomImageContainerX = minmax(\n            left - zoomMargin,\n            meta.marginHoriz,\n            meta.marginHoriz + meta.width - zoomBoxSize\n        );\n        const zoomImageContainerY = minmax(\n            top - zoomMargin,\n            meta.marginVert,\n            meta.marginVert + meta.height - zoomBoxSize\n        );\n\n        const backgroundLeft = (zd.width * left) / boundaryWidth - zoomMargin;\n        const backgroundTop = (zd.height * top) / boundaryHeight - zoomMargin;\n\n        const bgPosX = -minmax(backgroundLeft, 0, zd.width - zoomBoxSize);\n        const bgPosY = -minmax(backgroundTop, 0, zd.height - zoomBoxSize);\n\n        return {\n            left: 0,\n            top: 0,\n            width: `${zoomBoxSize}px`,\n            height: `${zoomBoxSize}px`,\n            transform: `translate(${zoomImageContainerX}px, ${zoomImageContainerY}px)`,\n            backgroundPosition: `${bgPosX}px ${bgPosY}px`,\n            display: \"inline\",\n        };\n    } else {\n        return Display.None;\n    }\n};\n\nconst RESIZED_SIZE = 1280;\nconst calculateImageSize = (img: ThingImageOrVideo) => {\n    const size = Math.max(img.width, img.height);\n    if (size < RESIZED_SIZE) {\n        const smallerSize = Math.min(img.width, img.height);\n        return {\n            width: img.width,\n            height: img.height,\n            proportion: size / smallerSize,\n            larger: img.width > img.height ? \"width\" : \"height\",\n        };\n    } else {\n        if (img.width > img.height) {\n            const proportion = RESIZED_SIZE / img.width;\n            return {\n                width: RESIZED_SIZE,\n                height: img.height / proportion,\n                proportion,\n                larger: \"width\",\n            };\n        } else {\n            const proportion = RESIZED_SIZE / img.height;\n            return {\n                width: img.width / proportion,\n                height: RESIZED_SIZE,\n                proportion,\n                larger: \"height\",\n            };\n        }\n    }\n};\n\nexport const isZoomable = (img: ThingImageOrVideo) => {\n    const imageSize = calculateImageSize(img);\n    const boundarySize = getBoundarySize();\n\n    return imageSize.width > boundarySize.width * zoomScale || imageSize.height > boundarySize.height * zoomScale;\n};\n\nexport const getZoomImageStyle = (img: ThingImageOrVideo, isZoomActive: boolean, currentZoomImageStyle: any) => {\n    if (isZoomable(img) && isZoomActive) {\n        const zd = getZoomImageDimension(img);\n        const ret = {\n            ...currentZoomImageStyle,\n            backgroundSize: `${zd.width}px ${zd.height}px`,\n        };\n        return ret;\n    } else {\n        return Display.None;\n    }\n};\n","import React from \"react\";\nimport SaleItem from \"./SaleItem\";\n\nimport { useFancy } from \"../FancyContext\";\n\nconst Info = () => {\n    const fancyProps = useFancy();\n    const { thing, thing: { reviews, sales }, fancyContext } = fancyProps;\n    const r = reviews.summary;\n\n    return (\n        <div className=\"figure-info\">\n            <div className=\"vendor\"><a href={sales.seller.shop_url}>{sales.seller.brand_name}</a></div>\n            {r.total_ratings > 0 && (\n                <div className=\"review-points\">\n                    <span style={{ cursor: r.total_reviews > 0 ? \"pointer\" : undefined }} onClick={() => {\n                        if (r.total_reviews > 0) {\n                            const $el = $(\".review-section\");\n                            const headerSize = parseInt($(\".container\").css(\"padding-top\")) || 0;\n                            if ($el.length) {\n                                $(window).scrollTop($el[0].offsetTop - headerSize);\n                            }\n                        }\n                    }}>\n                        {r.rating_avg} <small className=\"count\">({r.total_ratings} rating{r.total_ratings != 1 ? 's' : ''})</small>{\" \"}\n                    </span>\n                </div>\n            )}\n            <span className=\"_fancyd fancyd_user\">{fancyContext.fancyd_count} people favorited</span>\n            <SaleItem {...fancyProps} />\n        </div>\n    );\n};\n\nexport default Info;\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { floatFormatMinusTwo, numberFormat, renderPopup, escapeSelector, getLocationArgPairs } from \"fancyutils\";\n\nimport appState from \"../../../appstate\";\nimport { convertCurrency, updateSaleContext } from \"../../../action/action-helpers\";\nimport { updateAppContext } from \"../../../action/actions\";\nimport { currencyIsUSD, getCurrentSaleOption, getSafeNameProp, getWaiting, isSalesOptionsAvailable } from \"../../map\";\nimport { Keys } from \"../../Perf\";\nimport { CartButton, SelectBox, handlePurchase, MultiOption, MultiOptionState } from \"./SaleItemForm\";\nimport { OverlayProps, ReduxProps, SaleOption, SelectedMetaOption, SaleOptionMeta } from \"ftypes\";\n\nfunction optionValueFunction(opt) {\n    return opt.id;\n}\nconst saleNamePrinter = (opt) => `${opt.name} - $${opt.price}`;\n\nexport default class SaleItemSidebarHead extends Component<\n    OverlayProps & ReduxProps,\n    {\n        loading: boolean;\n        selected: null | {} | SelectedMetaOption;\n        disabled: Array<any>;\n        multiOptionState: null | MultiOptionState;\n    }\n> {\n    state = {\n        loading: false,\n        selected: {},\n        disabled: [],\n        multiOptionState: null,\n    };\n\n    handlePurchase = null;\n\n    constructor(props: OverlayProps & ReduxProps) {\n        super(props);\n        this.handlePurchase = handlePurchase.bind(this);\n        // for multi options\n        this.onClickThumbnail = this.onClickMultiOptionGen(\"thumbnail\");\n        this.onClickSwatch = this.onClickMultiOptionGen(\"swatch\");\n        this.onMultiSelectBoxChange = this.onClickMultiOptionGen(\"dropdown\");\n        this.onClickMutliButton = this.onClickMultiOptionGen(\"button\");\n    }\n\n    renderCurrencyPopup = () => {\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\").then(({ CurrencyPopup }) => {\n            renderPopup(CurrencyPopup, { currentCurrency: this.props.saleContext.currencyCode });\n        });\n    };\n\n    handleCurrencyPopup = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        this.renderCurrencyPopup();\n    };\n\n    handleCurrencyPopupUSD = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        if (!currencyIsUSD(this.props)) {\n            return false;\n        }\n        this.renderCurrencyPopup();\n    };\n\n    getApproxText = () => {\n        var { currencySymbol, currencyMoney } = this.props.saleContext;\n        var approxText = gettext(\"Approximately\");\n        return `${approxText} ${currencySymbol}${currencyMoney} `;\n    };\n\n    handleOptionChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const saleOptionID = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    handleQuantityChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const selectedQuantity = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ selectedQuantity }));\n    };\n\n    handlePersonalizationChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const personalization = event.currentTarget.value;\n        dispatch(updateSaleContext({ personalization }));\n    };\n\n    handleNotifyLater = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!appState.loggedIn) {\n            return window.require_login();\n        }\n        const {\n            thing: { sales },\n            saleContext,\n        } = this.props;\n        const opt = getCurrentSaleOption(sales, saleContext, true);\n        const params = { sale_item_id: sales.id };\n\n        if (opt != null) {\n            params.option_id = opt.id;\n        }\n\n        const waiting = getWaiting(sales, saleContext);\n        if (waiting) {\n            params.remove = 1;\n        }\n\n        $.ajax({\n            type: \"post\",\n            url: \"/wait_for_product.json\",\n            data: params,\n            dataType: \"json\",\n        }).done((json) => {\n            if (!json || json.status_code == null) {\n                return;\n            }\n            if (json.status_code == 0 && json.message) {\n                alertify.alert(json.message);\n                return;\n            }\n            const waiting = params.remove ? false : true;\n            this.props.dispatch(updateSaleContext({ waiting }));\n        });\n    };\n\n    checkApplePay = () => {\n        if (window.FancyApplePay) {\n            const { dispatch, thing, thing: { sales } } = this.props;\n            const os = sales.options.filter((o) => !o.soldout);\n            const data = {\n                total: { label: thing.name, amount: (sales.price * 100) | 0 },\n            };\n\n            if (os.length > 0) {\n                data.displayItems = os.map((o) => ({\n                    label: o.name,\n                    amount: (Number(o.price) * 100) | 0,\n                }));\n            }\n\n            window.FancyApplePay.checkAvailability((available, testmode) => {\n                if (available) {\n                    dispatch(\n                        updateAppContext({\n                            applePayDisplay: true,\n                            applePayTest: testmode,\n                        })\n                    );\n                }\n            }, data);\n        }\n    };\n\n    componentDidMount() {\n        if (!currencyIsUSD(this.props)) {\n            const { saleContext } = this.props;\n            convertCurrency(saleContext.currencyCode, saleContext.price);\n        }\n        this.initializeMultiOption();\n        this.checkApplePay();\n    }\n\n    componentDidUpdate(prevProps: OverlayProps) {\n        if (prevProps.thing.id !== this.props.thing.id) {\n            this.initializeMultiOption();\n            this.checkApplePay();\n            return;\n        }\n\n        const {\n            saleContext,\n            thing: { sales },\n        } = prevProps;\n\n        const nsc = this.props.saleContext;\n        const nextSaleOptionID = nsc.saleOptionID;\n        if (saleContext.saleOptionID !== nextSaleOptionID) {\n            const o = _.find(sales.options, (_o) => _o.id === nextSaleOptionID);\n            // option sync\n            if (o) {\n                const mos = $(\".sale-item-input .multi-option\");\n                o.values.forEach((v, i) => {\n                    const $so = mos\n                        .eq(i)\n                        .find(`[data-value=\"${escapeSelector(v)}\"]:not(.selected)`)\n                        .eq(0);\n                    if ($so.length) {\n                        if ($so.is(\"option\")) \n                            $so.prop(\"selected\", true);\n                        else\n                            $so.get(0).click();\n                    }\n                });\n                if (window.FancyApplePay && window.FancyApplePay.paymentRequest) {\n                    window.FancyApplePay.paymentRequest.update({\n                        total: {\n                            label: o.name,\n                            amount: (Number(o.price) * 100) | 0,\n                        },\n                    });\n                }\n            }\n        }\n    }\n\n    initializeMultiOption = () => {\n        const {\n            thing: {\n                sales: { options, option_meta },\n            },\n            saleContext,\n            dispatch,\n        } = this.props;\n\n        this.setState(this.getInitialMultiOptionState(options, option_meta), () => {\n            // don't block selecting cheapest item\n            if (!(options && options.length > 1)) {\n                this.updateSaleOptionIDFromMultiOptionState();\n            }\n            // ?option={number} support\n            const presetOptionId = getLocationArgPairs(\"option\");\n            if (presetOptionId && presetOptionId[1] && String(saleContext.saleOptionID) !== presetOptionId[1]) {\n                dispatch(updateSaleContext({ saleOptionID: parseInt(presetOptionId[1], 10) }));\n            }\n        });\n    };\n\n    getInitialMultiOptionState(options: SaleOption[], option_meta: SaleOptionMeta[]) {\n        const selected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        if (option_meta.length > 0) {\n            const nonSoldout = options.filter((o) => o.quantity !== 0);\n            if (nonSoldout.length !== 0) {\n                const selectedNonSoldoutOption = nonSoldout[0]; // temporary - FIXME\n                option_meta.forEach(function (opt, i) {\n                    const { type } = opt;\n                    const nextValue = selectedNonSoldoutOption.values[i];\n                    selected[type].push(nextValue);\n                });\n            } else {\n                // set first available multi option\n                option_meta.forEach(function (opt) {\n                    const { type } = opt;\n                    const nextValue = opt.values[0];\n                    selected[type].push(nextValue);\n                });\n            }\n        }\n        const multiOptionState = new MultiOptionState(options, option_meta);\n        return { selected, multiOptionState };\n    }\n\n    extractSaleOptionIDFromMultiOptionState = (selected?: SelectedMetaOption) => {\n        const {\n            thing: { sales },\n        } = this.props;\n        if (selected == null) {\n            selected = this.state.selected;\n        }\n        const { multiOptionState } = this.state;\n\n        const selectedOptionArray = multiOptionState.option_meta\n            .map((m) => {\n                const order = multiOptionState.orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            });\n        const selectedOption = _.find(sales.options, (opt) => selectedOptionArray.every((e, i) => e === opt.values[i]));\n        if (selectedOption) {\n            return selectedOption.id;\n        } else {\n            window.DEBUG &&\n                console.warn(\"no option found for \", selectedOptionArray, \"meta:\", sales.options, this.state.selected);\n        }\n    };\n\n    updateSaleOptionIDFromMultiOptionState = () => {\n        const { dispatch } = this.props;\n        let saleOptionID = this.extractSaleOptionIDFromMultiOptionState();\n        if (saleOptionID === undefined) {\n            const amendedID = this.amendSaleOptionFromMultiOptionState();\n            if (amendedID) {\n                saleOptionID = amendedID;\n            } else {\n                window.DEBUG && console.warn(\"Couldn't recover option\");\n            }\n        }\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    amendSaleOptionFromMultiOptionState = () => {\n        const { selected, multiOptionState } = this.state;\n        const nextSelected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        multiOptionState.option_meta.forEach(({ type, name }, index) => {\n            const order = multiOptionState.orderMap[type][name];\n            const selectedValue = selected[type][order];\n            if (index === 0) {\n                nextSelected[type][order] = selectedValue;\n                return;\n            }\n            const values = multiOptionState.getPossibleValuesForIndex(selected, index);\n            let value;\n            if (values.some((v) => v === selectedValue)) {\n                value = selectedValue;\n            } else {\n                value = values[0];\n            }\n            selected[type][order] = value; // even though it will be flushed out, it will affect next options so fix it as well\n            nextSelected[type][order] = value;\n        });\n        this.setState({ selected: nextSelected });\n        return this.extractSaleOptionIDFromMultiOptionState(nextSelected);\n    };\n\n    onClickMultiOptionGen = (type) => {\n        return (e) => {\n            const el = e.currentTarget;\n            let value;\n            let indexOfType;\n            if (el.tagName === \"SELECT\") {\n                value = el.value;\n                indexOfType = Number($(el).find(\":selected\").attr(\"data-index-typeof\"));\n            } else {\n                value = $(el).attr(\"data-value\");\n                indexOfType = Number($(el).attr(\"data-index-typeof\"));\n            }\n            if (e.currentTarget.className === \"disabled\") {\n                return;\n            }\n\n            this.state.selected[type][indexOfType] = value;\n            // forceful trigger even though no differences in value.\n            this.setState({ selected: _.extend({}, this.state.selected) }, this.updateSaleOptionIDFromMultiOptionState);\n        };\n    };\n\n    UNSAFE_componentWillReceiveProps(nextProps) {\n        const { saleContext } = this.props;\n        const nsc = nextProps.saleContext;\n        const priceChanges = saleContext.price !== nsc.price;\n        const currencyChanges = saleContext.currencyCode !== nsc.currencyCode;\n        if (priceChanges || currencyChanges) {\n            if (!currencyIsUSD(nextProps)) {\n                const { saleContext } = nextProps;\n                convertCurrency(saleContext.currencyCode, saleContext.price, true); // FIXME: unable to comparison since price update comes first (SaleItemSidebarHead.componentWillReceiveProps())\n            }\n        }\n    }\n\n    isOptionMulti(): boolean {\n        const {\n            thing: { sales },\n        } = this.props;\n        // sales.\n        if (sales.option_meta.length > 1) {\n            return true;\n        } else if (sales.option_meta.length === 1) {\n            return sales.option_meta[0].type !== \"dropdown\";\n        } else {\n            return false;\n        }\n    }\n\n    render() {\n        const {\n            thing,\n            thing: { sales },\n            appContext: { applePayDisplay },\n            saleContext,\n            saleContext: { currencyCode, currencySymbol, currencyMoney, selectedQuantity, price },\n        } = this.props;\n\n        var opt = getCurrentSaleOption(sales, saleContext) as SaleOption;\n        var discountPercentage = parseFloat(opt.discount_percentage); // TODO: use decimal?\n        var retailPrice = opt.retail_price;\n        const { soldout, quantity } = opt;\n        const { option_meta, available } = sales;\n        const optionIsMulti = this.isOptionMulti();\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n        const discounting = discountPercentage > 0;\n        const converted = currencySymbol != null && currencyMoney != null;\n        const currencyCodeStyle = { display: converted && !currencyIsUSD(this.props) ? \"block\" : \"none\" };\n        const quantitySelectRange = soldout\n            ? [\"1\"]\n            : _.range(1, Math.min(10, (quantity || 0) + 1));\n        const showSelectbox = sales.options.length !== 0;\n\n        var cartButtonStyle;\n        if (!soldout) {\n            cartButtonStyle = { display: \"none\" };\n        }\n        const waiting = getWaiting(sales, saleContext);\n\n        var applePayButton;\n        if (applePayDisplay && !soldout) {\n            applePayButton = <ApplePayButton {...this.props} />;\n        }\n\n        return (\n            <>\n                <h1 key={Keys.Sidebar.Title} className=\"title\" {...getSafeNameProp(thing)} />\n                <div className=\"price\" key={Keys.Sidebar.Price}>\n                    <big className={classnames({ sale: discounting })}>\n                        ${floatFormatMinusTwo(price)}\n                        {/* <small className=\"usd\">\n                            <a\n                                className={classnames(\"code\", { \"currently-usd\": currencyIsUSD(this.props) })}\n                                onClick={this.handleCurrencyPopupUSD}>\n                                USD\n                            </a>\n                        </small> */}\n                    </big>\n                    {discounting && (\n                        <span className=\"sales\">\n                            <em>${floatFormatMinusTwo(retailPrice)}</em> (Save {numberFormat(discountPercentage, 0)}\n                            %)\n                        </span>\n                    )}\n                    <span className=\"currency_price\" style={currencyCodeStyle}>\n                        {this.getApproxText()}\n                        <a className=\"code\" onClick={this.handleCurrencyPopup}>\n                            {currencyCode}\n                        </a>\n                    </span>\n                </div>\n                <div className=\"frm\" key={Keys.Sidebar.Form}>\n                    <fieldset className=\"sale-item-input\">\n                        {showSelectbox && !optionIsMulti && (\n                            <SelectBox\n                                className=\"multi-option\"\n                                id=\"option\"\n                                label={gettext(\"Option\")}\n                                currentValue={opt}\n                                value={optionValueFunction}\n                                printer={saleNamePrinter}\n                                options={sales.options}\n                                expander={SaleItemOptionsExpander}\n                                disabled={!salesOptionsAvailable}\n                                onChange={this.handleOptionChange}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                            />\n                        )}\n                        {optionIsMulti && (\n                            <MultiOption\n                                sid={sales.id}\n                                onClickThumbnail={this.onClickThumbnail}\n                                onClickSwatch={this.onClickSwatch}\n                                onMultiSelectBoxChange={this.onMultiSelectBoxChange}\n                                onClickMutliButton={this.onClickMutliButton}\n                                selected={this.state.selected}\n                                disabled={this.state.disabled}\n                                soldout={!!soldout}\n                                option_meta={option_meta}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                                multiOptionState={this.state.multiOptionState}\n                            />\n                        )}\n                        {sales.personalizable && (\n                            <div className=\"personalization\">\n                                <label>This item can be personalized:</label>\n                                <input\n                                    type=\"text\"\n                                    className=\"text\"\n                                    name=\"personalization\"\n                                    placeholder=\"Personalization details\"\n                                    onChange={this.handlePersonalizationChange}\n                                />\n                            </div>\n                        )}\n                        {\n                            <SelectBox\n                                id=\"quantity\"\n                                className=\"multi-option\"\n                                label={gettext(\"Quantity\")}\n                                defaultValue=\"1\"\n                                currentValue={selectedQuantity}\n                                options={quantitySelectRange}\n                                disabled={!!soldout}\n                                onChange={this.handleQuantityChange}\n                            />\n                        }\n                        {applePayButton}\n                        {available ? (\n                            <>\n                                <CartButton\n                                    onClick={this.handlePurchase}\n                                    className={classnames(\"add_to_cart btn-cart\", {\n                                        \"btn-create\": soldout,\n                                        \"btns-blue-embo\": !soldout,\n                                    })}\n                                    disabled={!!soldout}\n                                    label={soldout ? gettext(\"Sold out\") : gettext(\"Add to cart\")}\n                                />\n                                <CartButton\n                                    className={classnames(\"btn-create notify-available\", { subscribed: waiting })}\n                                    label={waiting ? gettext(\"Subscribed\") : gettext(\"Notify me when available\")}\n                                    style={cartButtonStyle}\n                                    onClick={this.handleNotifyLater}\n                                />\n                            </>\n                        ) : (\n                            <CartButton\n                                className={classnames(\"btn-create not-available\")}\n                                label={gettext(\"Not Available\")}\n                                disabled={true}\n                            />\n                        )}\n                    </fieldset>\n                </div>\n            </>\n        );\n    }\n}\n\nfunction SaleItemOptionsExpander(sio, idx) {\n    return (\n        <option value={sio.id} key={`sale_options-${idx}`}>\n            {sio.soldout === true || !(sio.quantity > 0) ? `${sio.name} - ${gettext(\"Sold out\")}` : sio.name}\n        </option>\n    );\n}\n\nclass ApplePayButton extends Component<OverlayProps> {\n    handleApplePayCheckout = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (window.FancyApplePay.clicked) {\n            return;\n        }\n        window.FancyApplePay.clicked = true;\n        const {\n            appContext: { /*applePayDisplay, */ applePayTest },\n        } = this.props;\n        const {\n            thing,\n            thing: { sales },\n            saleContext: { saleOptionID, selectedQuantity, price },\n        } = this.props;\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n\n        var title = thing.name;\n        var country = sales.seller.country;\n        var sale_item_id = sales.id;\n        var seller_id = sales.seller.id;\n        var quantity = selectedQuantity;\n\n        var option_id = null;\n        var option = null;\n        if (salesOptionsAvailable) {\n            option_id = parseInt(saleOptionID, 10) || null; // ? should be same value with option except get casted\n            option = saleOptionID;\n        }\n\n        try {\n            window.FancyApplePay.requestPurchase(\"Dynamic\", {\n                sale_item_id,\n                seller_id,\n                option_id,\n                quantity,\n                price,\n                title,\n                option,\n                country,\n                testmode: applePayTest,\n            });\n        } catch (err) {\n            window.DEBUG && console.trace(err);\n            alert(err);\n            window.FancyApplePay.clicked = false;\n        }\n    };\n\n    render() {\n        return (\n            <div\n                className=\"applePayButton\"\n                style={{\n                    WebkitAppearance: \"-apple-pay-button\",\n                    ApplePayButtonType: \"plain\",\n                    ApplePayButtonStyle: \"black\",\n                }}\n                onClick={this.handleApplePayCheckout}></div>\n        );\n    }\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { getCurrentSaleOption, getThingName } from \"../../map\";\nimport { addItemToCart, logAddCartMixpanel } from \"../../map.cart\";\n\n// Generic purchase handler, needs to be bound to insatnce on initialization.\n/*\n    data-sii={sales.id}\n    data-sisi={sales.seller_id}\n    data-tid={thing.id}\n*/\nexport function handlePurchase(event) {\n    event.preventDefault();\n    const {\n        thing,\n        thing: { sales },\n        saleContext,\n    } = this.props;\n    const saleOption = getCurrentSaleOption(sales, saleContext, true);\n    const soldout = saleOption == null ? sales.soldout : saleOption.soldout;\n    if (soldout || this.state.loading) {\n        return;\n    }\n    const saleOptionID = saleOption != null ? saleOption.id : null;\n\n    this.setState({ loading: true }, () => {\n        const payload = { \n            sale_id: sales.id,\n            quantity: saleContext.selectedQuantity,\n            personalization: saleContext.personalization,\n        }\n        if (saleOptionID != null) {\n            payload.option_id = saleOptionID;\n        }\n        Fancy.CartAPI.addItem(payload, (success, json) => {\n            if (success) {\n                Fancy.Cart.openPopup();\n            } else {\n                alertify.alert((json && json.error) || \"Failed to add the item to cart. Please contact us at cs@fancy.com if the problem persists.\");\n            }\n            this.setState({ loading: false });\n        })\n    });\n}\n\nconst SaleOptions = ({\n    options = [\"1\"],\n    currentValue = \"1\",\n    id = \"\",\n    value = (v) => v,\n    expander,\n    defaultValue,\n    printer,\n    disabled,\n    onChange,\n    onClick,\n    onFocus,\n    unselectedLabel,\n}) => {\n    expander =\n        expander ||\n        ((option, idx) => (\n            <option key={`sale_options-${idx}`} value={value(option)}>\n                {printer(option)}\n            </option>\n        ));\n\n    return (\n        <select\n            id={id}\n            className={classnames(\"select-boxes2\", { \"one-option\": options.length <= 1 })}\n            value={value(currentValue) || defaultValue}\n            disabled={disabled}\n            onChange={onChange}\n            onClick={onClick}\n            onFocus={onFocus}>\n            {unselectedLabel && <option value=\"\">{unselectedLabel}</option>}\n            {options.map(expander)}\n        </select>\n    );\n};\n\nexport const CartButton = (props) => (\n    <button {...props} label={null}>\n        {props.label}\n    </button>\n);\n\nexport const SelectBox = (props) => {\n    let {\n        className,\n        disabled,\n        label,\n        currentValue,\n        defaultValue,\n        id,\n        printer,\n        tabIndex,\n        unselectedLabel,\n        options = [\"1\"],\n        SizeGuide,\n    } = props;\n\n    printer = printer != null ? printer : (s) => s;\n    defaultValue = defaultValue != null ? defaultValue : \"1\";\n    className = className != null ? className : null;\n\n    var labelValue;\n    if (unselectedLabel != null && currentValue === \"\") {\n        labelValue = unselectedLabel;\n    } else {\n        labelValue = printer(currentValue != null ? currentValue : defaultValue);\n    }\n\n    return (\n        <div className={className}>\n            <label>{label}</label>\n            <span className={`trick-select ${id}`}>\n                <a\n                    className={classnames(\"selectBox\", { disabled, \"one-option\": options.length <= 1 })}\n                    tabIndex={tabIndex || \"1\"}>\n                    <span className=\"selectBox-label\">{labelValue}</span>\n                    <span className=\"selectBox-arrow\" />\n                </a>\n                <SaleOptions {...props} printer={printer} defaultValue={defaultValue} />\n            </span>\n            { SizeGuide && <SizeGuide key=\"size-guide\" /> }\n        </div>\n    );\n};\n\nexport class MultiOptionState {\n    constructor(options, option_meta) {\n        this.options = options;\n        this.option_meta = option_meta;\n        const orderMap = {};\n        option_meta.forEach((m) => {\n            if (orderMap[m.type] == null) {\n                orderMap[m.type] = { length: 1 };\n                orderMap[m.type][m.name] = 0;\n            } else {\n                orderMap[m.type][m.name] = orderMap[m.type].length;\n                orderMap[m.type].length += 1;\n            }\n        });\n        this.orderMap = orderMap;\n    }\n    // i.e.) getPossibleValues(['a', '1', ''], 1) => ['1', '3', '6']\n    // output: get possible options for 2nd option dependent on ('a' / 1st option)\n    getPossibleValuesForIndex(selected, targetIndex) {\n        const { options, option_meta, orderMap } = this;\n        if (targetIndex === 0) {\n            return option_meta[0].values;\n        }\n        let filteredOptions = options;\n        option_meta\n            .map((m) => {\n                const order = orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            })\n            .forEach((sel, idx) => {\n                if (idx < targetIndex) {\n                    filteredOptions = filteredOptions.filter((option) => option.values[idx] === sel);\n                }\n            });\n        return _.uniq(filteredOptions.map((o) => o.values[targetIndex])); // FIXME\n    }\n\n    getMultiOptions(selected) {\n        return this.option_meta.map((meta, idx) => {\n            return [meta, this.getPossibleValuesForIndex(selected, idx)];\n        });\n        /*\n        returns [\n            [type, ['a', 'b', 'c']],\n            [type, ['1', '2']],\n            [tyep, ['red', 'white', 'black']]\n        ]\n        */\n    }\n}\n\nexport const MultiOption = (props) => {\n    const { selected, multiOptionState, sid, SizeGuide } = props;\n    if (multiOptionState == null) {\n        return null;\n    }\n    const multiOptions = multiOptionState.getMultiOptions(selected);\n    var sizeGuidePos = -1;\n    if (SizeGuide) {\n        multiOptions.map(([meta, values], idx) => {\n            if (meta.name && meta.name.trim().toLowerCase() === \"size\") sizeGuidePos = idx;\n        });\n        if (sizeGuidePos < 0) sizeGuidePos = multiOptions.length - 1;\n    }\n    return multiOptions.map(([meta, values], idx) => {\n        const { type, name } = meta;\n\n        const indexTypeOf = multiOptionState.orderMap[type] && multiOptionState.orderMap[type][name];\n        const additional = {\n            name,\n            values,\n            indexTypeOf,\n            selectedArray: selected && selected[type],\n            selectedValue: selected && selected[type] && selected[type][indexTypeOf],\n            key: `${sid}-${idx}`,\n            showSizeGuide: idx == sizeGuidePos,\n        };\n        if (type === \"dropdown\") {\n            return <MultiSelectBox {...props} {...additional} />;\n        } else if (type === \"swatch\") {\n            additional.swatch = meta.swatch;\n            return <MultiSwatch {...props} {...additional} />;\n        } else if (type === \"thumbnail\") {\n            additional.thumbnail = meta.thumbnail;\n            return <MultiThumbnail {...props} {...additional} />;\n        } else if (type === \"button\") {\n            return <MultiButton {...props} {...additional} />;\n        }\n    });\n};\n\nexport const MultiSelectBox = (props) => {\n    const { values, name, onMultiSelectBoxChange, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option\">\n            <label>{name}</label>\n            <select\n                onChange={onMultiSelectBoxChange}\n                selected={selectedValue}\n                className={values.length <= 1 ? \"one-option\" : undefined}>\n                {values.map((value, i) => {\n                    return <MultiSelectBoxOption key={i} value={value} indexTypeOf={indexTypeOf} />;\n                })}\n            </select>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSelectBoxOption = (props) => {\n    const { value, indexTypeOf } = props;\n    return (\n        <option data-value={value} data-index-typeof={indexTypeOf} value={value}>\n            {value}\n        </option>\n    );\n};\n\nexport const MultiSwatch = (props) => {\n    const { name, values, swatch, indexTypeOf, selectedValue, onClickSwatch, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option swatch\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiSwatchOption\n                            key={i}\n                            value={value}\n                            swatch={swatch}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            onClick={onClickSwatch}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSwatchOption = (props) => {\n    const { value, swatch, indexTypeOf, selectedValue, onClick } = props;\n    return (\n        <a\n            href=\"#\"\n            style={{ backgroundColor: swatch[value] }}\n            onClick={onClick}\n            data-value={value}\n            data-label={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}\n        />\n    );\n};\n\nexport const MultiThumbnail = (props) => {\n    const { values, name, thumbnail, onClickThumbnail, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n\n    return (\n        <div className=\"multi-option thumbnail\">\n            <label>{name}</label>\n            <span className=\"value\">{selectedValue}</span>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiThumbnailOption\n                            key={i}\n                            onClick={onClickThumbnail}\n                            value={value}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            thumbnail={thumbnail}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiThumbnailOption = ({ onClick, value, indexTypeOf, selectedValue, thumbnail }) => {\n    return (\n        <a\n            href=\"#\"\n            onClick={onClick}\n            data-value={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}>\n            <img\n                src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage: `url(\"${thumbnail[value]}\")`, backgroundSize: \"cover\" }}\n                alt={value}\n            />\n        </a>\n    );\n};\n\nexport const MultiButton = (props) => {\n    const { values, name, onClickMutliButton, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option button\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiButtonOption key={i}\n                            onClick={onClickMutliButton}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            value={value}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiButtonOption = (props) => {\n    const { value, onClick, indexTypeOf, selectedValue } = props;\n    return (\n        <button\n            onClick={onClick}\n            className={selectedValue === value ? \"selected\" : \"\"}\n            data-value={value}\n            data-index-typeof={indexTypeOf}>\n            {value}\n        </button>\n    );\n};\n","import React from \"react\";\n\nimport Image from \"./Image\";\nimport Info from \"./Info\";\nimport Detail from \"./Detail\";\n\nconst Thing = () => {\n    return (\n        <div className=\"wrapper-content\">\n            <Image />\n            <Info />\n            <Detail />\n        </div>\n    );\n};\n\nexport default Thing;\n","import React from \"react\";\nimport { numberFormat } from \"fancyutils\";\n\nexport interface ThingCardProps {\n    brand_name: string;\n    title: string;\n    html_url: string;\n    image_url: string;\n    max_price: number;\n    min_price: number;\n}\n\nexport default function ThingCard({ brand_name, title, html_url, image_url, max_price, min_price }: ThingCardProps) {\n    let p = <>${numberFormat(min_price, 0)}</>;\n    if (max_price !== min_price) {\n        p = (\n            <>\n                <em className=\"from\">from </em> ${numberFormat(min_price, 0)}\n            </>\n        );\n    }\n\n    return (\n        <div className=\"figure-item new\">\n            <figure>\n                <a href={html_url}>\n                    <span className=\"figure\" style={{ backgroundImage: `url(${image_url})` }}>\n                        <img\n                            src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n                            style={{ backgroundImage: `url(${image_url})` }}\n                        />\n                    </span>\n                </a>\n            </figure>\n            <figcaption>\n                <a href={html_url}>\n                    <span className=\"category\">{brand_name}</span>\n                    <b className=\"title\">{title}</b>\n                    <span className=\"price\">{p}</span>\n                </a>\n            </figcaption>\n        </div>\n    );\n}\n","import React, { Component, Suspense } from \"react\";\nimport { connect } from \"react-redux\";\nimport { isStaticPage } from \"fancyutils\";\n\nimport Thing from \"./Thing\";\nimport MerchantInfo from \"./MerchantInfo\";\nimport Recommendation from \"./Recommendation\";\nimport Reviews from \"./Reviews\";\n\nimport { historyData } from \"../../container/history\";\nimport { updateSaleContext } from \"../../action/action-helpers\";\nimport store from \"../../store/store\";\nimport FancyContext, { getFancyContextDefaultValue, useFancy } from \"./FancyContext\";\n\nimport { OverlayPropsV1 } from \"ftypes\";\nimport { mapStateToThingProps } from \"../map\";\n\nfunction AdminMessages() {\n    const {\n        thing,\n    } = useFancy();\n\n    if (!thing.messages) {\n        return null;\n    }\n\n    return (\n        <div className=\"warning\">\n            <span>This item is not visible to customers because:</span>\n            <ul>\n                {thing.messages.map((m, i) => (\n                    <li key={i}>{m}</li>\n                ))}\n            </ul>\n        </div>\n    );\n}\n\nfunction BreadCrumb() {\n    const { thing } = useFancy();\n\n    return (\n        <div className=\"breadcrumb\">\n            {thing.breadcrumbs.map(({ label, href }, i) => (\n                <React.Fragment key={i}>\n                    <a href={href}>{label}</a>{\" \"}\n                    {i !== thing.breadcrumbs.length - 1 ? (\n                        <>\n                            <span className=\"arrow\">&gt;</span>{\" \"}\n                        </>\n                    ) : null}\n                </React.Fragment>\n            ))}\n        </div>\n    );\n}\n\nfunction AdminSidebar(props: OverlayPropsV1) {\n    const {\n        appContext: { viewer },\n        thing,\n    } = props;\n\n    let admin = null;\n\n    let AdminComponent = null;\n    //if (viewer.is_admin_any) {\n    //    AdminComponent = lazy(() => import(/* webpackChunkName: \"OverlayThing.admin\" */ \"../Admin\"));\n    //}\n\n    if (AdminComponent) {\n        admin = (\n            <Suspense fallback={<div />}>\n                <AdminComponent {...props} fallback={<div />} />\n            </Suspense>\n        );\n    }\n\n    return admin;\n}\n\nclass AppV2 extends Component<OverlayPropsV1> {\n    componentDidUpdate(prevProps: OverlayPropsV1) {\n        const pt = prevProps.thing;\n        const ct = this.props.thing;\n\n        if (ct != null) {\n            if (!pt || pt.id !== ct.id) {\n                if (isStaticPage()) {\n                    $(window).scrollTop(0);\n                } else {\n                    $(\"#overlay-thing > .popup\").attr(\"tabindex\", -1).focus();\n                }\n\n                if (ct.sales && ct.sales.options && ct.sales.options.length > 1) {\n                    const nonSoldoutOptions = ct.sales.options.filter((o) => !o.soldout);\n                    let minimumOption;\n                    if (nonSoldoutOptions.length > 0) {\n                        minimumOption = _.min(nonSoldoutOptions, (o) => Number(o.price));\n                    } else {\n                        minimumOption = _.min(ct.sales.options, (o) => Number(o.price));\n                    }\n                    if (ct.sales.options[0].id !== minimumOption.id) {\n                        store.dispatch(updateSaleContext({ saleOptionID: minimumOption.id }));\n                    }\n                }\n            }\n        }\n    }\n\n    getFancyContext() {\n        return this.props.thing ? this.props : getFancyContextDefaultValue();\n    }\n\n    render() {\n        const { thing } = this.props;\n\n        if (historyData.locationIsThingPage && thing != null) {\n            return (\n                <FancyContext.Provider value={this.getFancyContext()}>\n                    <AdminMessages />\n                    <BreadCrumb />\n                    <Thing />\n                    <Reviews />\n                    <MerchantInfo />\n                    <Recommendation />\n                    <AdminSidebar {...this.props} />\n                </FancyContext.Provider>\n            );\n        } else {\n            return <div />;\n        }\n    }\n}\n\nconst ReduxComponentEnhancer = connect<OverlayPropsV1>(mapStateToThingProps);\nconst Overlay = ReduxComponentEnhancer(AppV2);\n\nexport default Overlay;\n","// SaleItem#get_status\nexport const salesStatus = {\n    EXPIRED: 'Expired',\n    REMOVED: 'Deleted',\n    PENDING: 'Pending',\n    COMING_SOON: 'Coming soon',\n    ACTIVE: 'Active',\n    SOLD_OUT: 'Sold out'\n};\n\nexport const FancyStatus = {\n    Addition: 'Addition',\n    Removal: 'Removal',\n    AfterAddition: 'AfterAddition',\n    AfterRemoval: 'AfterRemoval',\n    Idle: 'Idle',\n};\n\nexport const textareaHeight = {\n    collapsed: 20,\n    expanded: 40\n};\n\nconst commonWrapperSelector = '#container-wrapper .wrapper-content #content';\nexport const Selectors = {\n    HomepageWrapper: commonWrapperSelector,\n};\n\nconst zoomMargin = 125;\nexport const ThingViewConfig = {\n    boundarySize: 640,\n    zoomMargin,                  // zoom box size 250 (246 + 2 + 2) / 2\n    zoomBoxSize: zoomMargin * 2, // zoom box size 250 (246 + 2 + 2) / 2\n    zoomScale: 1.5,\n};\n\nexport const StaticThingViewConfig = {\n    ThumbnailsLimit: {\n        Basic: 18,\n        More: 200,\n    },\n}\n","import { KEYS, didClickOn, eitherFancy, getObjectTypeFromUrl, getPathname, isPlainLeftClick, isStream } from 'fancyutils';\n\nimport store from '../store/store';\nimport { Selectors } from '../config';\nimport { LinkTypes, transition, pagingContext } from './routeutils';\nimport { closeOverlay } from '../action/action-helpers';\n\n\nfunction handleOverlayThingKeyEvents(event) {\n    if (event.target.tagName === 'TEXTAREA' ||\n        event.target.tagName === 'INPUT') {\n        return;\n    }\n\n    switch (event.which) {\n    case KEYS.LEFT:\n        pagingContext.movePrev();\n        break;\n    case KEYS.RIGHT:\n        pagingContext.moveNext();\n        break;\n    case KEYS.ESC:\n        // If popup is not on\n        if ($('#popup_container:visible').length === 0) {\n            store.dispatch(closeOverlay());\n        }\n        break;\n    }\n}\n\nfunction conditionalTransition(aElement) {\n    // Turn off video\n    $('#container-wrapper .btn-pause').attr('scroll',true).click();\n    // Ensure anchor is static (sticked to homepage timeline) or not.\n    if (isStream() && $(Selectors.HomepageWrapper).has(aElement)) {\n        transition(aElement.getAttribute('href'), LinkTypes.Static);\n    } else {\n        transition(aElement.getAttribute('href'));\n    }\n}\n\nvar oneshotEventAttached = false;\nexport function attachEntryEvents() {\n    if (oneshotEventAttached) {\n        return;\n    }\n    oneshotEventAttached = true;\n    // Remove pre-existing url event and start transition first\n    $(document.body).off('click.overlayThingInit');\n    if (window.__INIT_THING_ANCHOR != null) {\n        conditionalTransition(window.__INIT_THING_ANCHOR);\n        delete window.__INIT_THING_ANCHOR;\n    }\n    // TODO: replace to class-based event binding\n    $(document.body)\n        .on('click', 'a', function(event) {\n            if (isPlainLeftClick(event) &&\n                this.getAttribute('data-prevent-overlay') == null &&\n                getObjectTypeFromUrl(getPathname(this)) === 'Thing'\n            ) {\n                event.preventDefault();\n                // note: key event will be detached inside `closeOverlay()` call\n                $(document).on('keydown.overlayThing', handleOverlayThingKeyEvents);\n                conditionalTransition(this);\n            }\n        });\n\n    $('#overlay-thing').on('click', '.popup.overlay-thing', function(event) {\n        const $targ = $(event.target);\n        // Center container\n        if (didClickOn($targ, '.sidebar') ||\n            didClickOn($targ, '.thing-detail-container .content') ||\n            didClickOn($targ, '.thing-detail-container .timeline') ||\n            eitherFancy('Admin', ({ sharedState }) => sharedState.draggingAdmin)) {\n            // pass\n        // prev button\n        } else if (didClickOn($targ, '.popup_prev')) {\n            pagingContext.movePrev();\n            return false;\n        // next button\n        } else if (didClickOn($targ, '.popup_next')) {\n            pagingContext.moveNext();\n            return false;\n        } else {\n            store.dispatch(closeOverlay());\n        }\n    });\n}\n\nexport const OtContainer = {\n    isStaticCache: undefined,\n    isStatic() {\n        if (this.isStaticCache === undefined) {\n            this.isStaticCache = $(document.body).is('.static-ot');\n        }\n        return this.isStaticCache;\n    },\n    getDynamic() {\n        return $('#overlay-thing .thing-detail');\n    },\n    getStatic() {\n        return $(document);\n    },\n    get() {\n        return this.isStatic() ? this.getStatic() : this.getDynamic();\n    },\n    scrollToTop() {\n        if (this.isStatic()) {\n            $(document.body.parentElement).scrollTop(0);\n        } else {\n            $('#overlay-thing').scrollTop(0);\n        }\n    },\n}\nwindow.OtContainer = OtContainer;\n\n// Only one event is allowed\nexport const scrollEvent = {\n    handleScroll: null,\n    attach(func, prepare) {\n        if (scrollEvent.handleScroll != null) {\n            scrollEvent.detach();\n        }\n        const _prepare = prepare != null ? prepare : 10;\n        \n        const handleScroll = _.throttle(function() {\n            if (OtContainer.isStatic()) {\n                const viewportHeight = document.documentElement.clientHeight;\n                if (scrollEvent.visible === true) {\n                    // console.debug('$(window).height() - $(window).scrollTop() - _prepare <= viewportHeight', $(window).height(), $(window).scrollTop(), _prepare, viewportHeight, $(window).height() - $(window).scrollTop() - _prepare <= viewportHeight)\n                    if (document.documentElement.scrollHeight - $(window).scrollTop() - _prepare <= viewportHeight) {\n                        func(true);\n                    }\n                }\n            } else {\n                const el = this;\n                const viewportHeight = el.clientHeight;\n                if (scrollEvent.visible === true) {\n                    if (el.scrollHeight - el.scrollTop - _prepare <= viewportHeight) {\n                        func(true);\n                    }\n                }\n            }\n        }, 50);\n        this.handleScroll = handleScroll;\n\n        const containerEl = OtContainer.isStatic() ? OtContainer.get().get(0) : $('#overlay-thing').get(0);\n        containerEl.addEventListener('scroll', handleScroll, { passive: true });\n        handleScroll();\n    },\n\n    detach() {\n        const containerEl = OtContainer.get().get(0);\n        containerEl.removeEventListener('scroll', this.handleScroll);\n    },\n    visible: false // copied variable on `state.appContext.visible` change\n};\n","import { extractMetaFromURL } from 'fancyutils';\nimport { history } from 'common-components';\n\nimport store from '../store/store';\nimport { closeOverlay, fetchThing } from '../action/action-helpers';\n\n\nconst initialThingPageID = extractMetaFromURL(location.pathname).id;\nconst initialPageIsThingPage = initialThingPageID != null;\n\n// This stores initial static page history info that needs to be restored when modal get closed.\nexport const historyData = {\n    initialPath: location.pathname,\n    /* mut */preservedHref: location.href, // Preserved Href just before open, and to be returned when closed.\n    initialThingPageID,\n    initialPageIsThingPage,\n    initialTitle: document.title,\n    // This prop indicates current location is (static) thing page. Mutable.\n    locationIsThingPage: initialPageIsThingPage,\n    overlayIsOn: false,\n};\n\n/*\nfunction isInitialPath() {\n    return historyData.initialPath === location.pathname;\n}\n*/\nfunction runOverlay(thingID, thingURLType, killCache = false, queryString) {\n    // Context needs to be isolated from hook: https://github.com/rackt/redux-router/issues/157\n    if (!$(document.body).hasClass('error-page')) {\n        requestIdleCallback(() => {\n            $(document.body).addClass('thing-overlay-on');\n            store.dispatch(fetchThing(thingID, thingURLType, killCache, false, queryString));\n            historyData.overlayIsOn = true;\n            //EE.emit('overlay-on');\n        });\n    }\n}\n\nfunction stopOverlay() {\n    historyData.overlayIsOn = false;\n    store.dispatch(closeOverlay());\n}\n\nexport function reloadCurrentThing() {\n    const meta = extractMetaFromURL(location.href);\n    const thingID = meta && meta.id;\n    if (thingID != null && historyData.overlayIsOn) {\n        runOverlay(thingID, meta.type, true);\n    }\n}\n\nexport function historyHook({ pathname, search /*, action*/ }) {\n    const meta = extractMetaFromURL(pathname);\n    const thingID = meta && meta.id;\n    // When initially (statically) renderred page is thing page\n    // Moving to new thing page\n    historyData.locationIsThingPage = thingID != null;\n    if (historyData.locationIsThingPage) {\n        runOverlay(thingID, meta.type, false, search);\n    } else if (historyData.overlayIsOn) {\n        stopOverlay();\n    }\n}\n\nhistory.listen(historyHook)\n","import { extractMetaFromURL, getObjectTypeFromUrl, isStaticPage, stripPathname } from \"fancyutils\";\n\nimport { historyData } from \"./history\";\nimport { history } from 'common-components';\nexport const LinkTypes = {\n    Dynamic: 0,\n    Static: 1,\n    Timeline: 2,\n    Internal: 3 // no update needed\n};\n\n// `staticLink`: transition from statically attached links\nexport function transition(href, linkType = LinkTypes.Dynamic) {\n    // ID-only\n    if (!_.isNaN(Number(href))) {\n        href = `/things/${href}`;\n    }\n\n    if (getObjectTypeFromUrl(href) === \"Thing\") {\n        const meta = extractMetaFromURL(href);\n        // Update URL to go back when overlay is closed\n        if (!historyData.overlayIsOn) {\n            historyData.preservedHref = location.href;\n        }\n        history.push(stripPathname(meta.href), null);\n    } else {\n        redirect(href);\n    }\n}\n\nexport function closeModal() {\n    if (isStaticPage()) {\n        return;\n    }\n    $(document.body).removeClass(\"thing-overlay-on\"); // FIXME: isolate modal logic\n}\n\n// NOOP\nexport const pagingContext = {\n    init() {},\n    movePrev() {},\n    moveNext() {}\n}\n\nexport function redirect(destination) {\n    if (destination == null) {\n        return false;\n    } else {\n        location.href = destination;\n        return true;\n    }\n}\n\nfunction getUtm() {\n    const $nav = $('.navigation')\n    if ($nav.length > 0) {\n        if ($nav.find('a.current[data-feed=\"featured\"]').length > 0) {\n            return \"timeline_featured\";\n        } else if ($nav.find('a.current[data-feed=\"recommended\"]').length > 0) {\n            return \"timeline_recommended\";\n        } else {\n            const $shopLink = $nav.find('.shop li a');\n            if ($shopLink.eq(0).is('.current')) {\n                return \"shop\";\n            } else if ($shopLink.eq(1).is('.current')) {\n                return \"\";\n            } else if ($shopLink.eq(2).is('.current')) {\n                return \"popular\";\n            } else if ($shopLink.eq(3).is('.current')) {\n                return \"newest\";\n            } else if ($shopLink.eq(4).is('.current')) {\n                return \"editors_picks\";\n            } else if ($shopLink.eq(5).is('.current')) {\n                return \"sales\";\n            }\n        }\n    } else {\n        if ($('.wrapper-content.profile-section').length > 0) {\n            return \"userprofile\";\n        } else if ($('.wrapper-content.merchant').length > 0) {\n            return \"seller_shop\";\n        }\n    }\n}\n\nexport function getUtmString() {\n    const utm = getUtm()\n    if (utm) {\n        return `?utm=${utm}`\n    } else {\n        return ''\n    }\n}\n","// This is entrypoint, which `React.render` takes place after DOM is ready.\nimport React, { Suspense, lazy } from \"react\";\nimport classnames from \"classnames\";\nimport { Route, Router, Switch } from \"react-router-dom\";\nimport { render } from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { selectOrCreate } from \"fancyutils\";\nimport { history } from \"common-components\";\nimport Bugsnag from \"@bugsnag/js\";\nimport BugsnagPluginReact from \"@bugsnag/plugin-react\";\n\nif (__Config.bugsnag) {\n    Bugsnag.start({\n        apiKey: \"a54d48e98cb0410b7bdf0e60a905b00e\",\n        plugins: [new BugsnagPluginReact()],\n        user: {\n            id: window.__FancyUser?.id || null\n        },\n    });\n}\n\nimport { attachEntryEvents } from \"./container/entry-events\";\nimport { pagingContext } from \"./container/routeutils\";\nimport store from \"./store/store\";\nimport { historyHook } from \"./container/history\";\nimport { closeOverlay } from \"./action/action-helpers\";\n\nconst App: React.FC = ({ children }) => {\n    if (__Config.design_v4) {\n        return <>{children}</>;\n    }\n\n    return (\n        <div className={classnames(\"popup overlay-thing thing-detail\", { new: !!window.__Config.heart_icon })}>\n            {children}\n            <a\n                className=\"ly-close\"\n                onClick={(event) => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    store.dispatch(closeOverlay());\n                }}>\n                Close\n            </a>\n        </div>\n    );\n};\n\n$(document).ready(() => {\n    require(\"./Shared\");\n\n    const overlayContainer = __Config.design_v4\n        ? document.querySelector(\"#container-wrapper .container\")\n        : selectOrCreate(\"#overlay-thing\");\n\n    const Overlay = __Config.design_v4\n        ? lazy(() => import(/* webpackChunkName: \"OverlayThing.main\" */ \"./components/v2\"))\n        : lazy(() => import(/* webpackChunkName: \"OverlayThing.main.old\" */ \"./components/Overlay\"));\n\n    const ErrorBoundary = __Config.bugsnag ? Bugsnag.getPlugin(\"react\")!.createErrorBoundary(React) : React.Fragment;\n\n    const tree = (\n        <ErrorBoundary>\n            <Provider store={store}>\n                <Router history={history}>\n                    <App>\n                        <Switch>\n                            <Route path=\"/things/*\">\n                                <Suspense fallback={<div />}>\n                                    <Overlay />\n                                </Suspense>\n                            </Route>\n                            <Route path=\"/sales/*\">\n                                <Suspense fallback={<div />}>\n                                    <Overlay />\n                                </Suspense>\n                            </Route>\n                            <Route path=\"*\" component={() => null} />\n                        </Switch>\n                    </App>\n                </Router>\n            </Provider>\n        </ErrorBoundary>\n    );\n    render(tree, overlayContainer, () => {\n        history.listen(historyHook);\n        historyHook({ pathname: location.pathname, search: location.search }); // should init once\n        attachEntryEvents();\n        pagingContext.init();\n    });\n});\n","import { combineReducers } from \"@reduxjs/toolkit\";\nimport { extractMetaFromURL, /*getConciseNumberString,*/ update, updateShallow } from \"fancyutils\";\n\nimport C from \"./action/action-constants\";\nimport { getInitialStoreState } from \"./store/initial-store\";\nimport { getFirstSaleOption, setWaiting } from \"./components/map\";\nimport { updateState } from \"./appstate\";\nimport { scrollEvent } from \"./container/entry-events\";\nimport { getThingType } from \"./ThingTypes\";\nimport { cache } from \"./cache\";\n\nvar loaded = false;\nvar lastFullyRenderedThingID = 0;\nfunction appContext(state = getInitialStoreState(\"appContext\"), action) {\n    switch (action.type) {\n        case C.OPEN_THING:\n            scrollEvent.visible = true;\n            return updateShallow(state, {\n                visible: true,\n            });\n        case C.CLOSE_THING:\n            scrollEvent.visible = false;\n            lastFullyRenderedThingID = 0;\n            loaded = false;\n            return updateShallow(state, {\n                visible: false,\n                lastFullyRenderedThingID,\n            });\n        case C.UPDATE_APP_CONTEXT:\n            return updateShallow(state, action.context);\n        case C.LOAD_THING: {\n            // Due to multi-stage rendering (cache -> from-server-data -> ...)\n            // it is unable to check state change correctly just by comparing ID;\n            // Therefore, we set internal state per every update cycle and check\n            // if state is fully updated.\n\n            // FIXME: when cached response exist, it marks as rendered before\n            if (loaded === true && lastFullyRenderedThingID !== action.data.id && action.data.fromServer) {\n                lastFullyRenderedThingID = action.data.id;\n            }\n\n            const loggedIn = window.__FancyUser.loggedIn;\n            const viewer = action.data.viewer || {};\n            const userCountry =\n                $.cookie.get(\"shipping_country_code\") || action.data.current_country_code || state.userCountry;\n\n            updateState(\"loggedIn\", loggedIn);\n            updateState(\"viewer\", viewer);\n            loaded = true;\n\n            return update(state, { lastFullyRenderedThingID, loggedIn, viewer, userCountry });\n        }\n        default:\n            return state;\n    }\n}\n\nfunction populateThingContext(thingData) {\n    thingData.loading = thingData.fromServer !== true;\n    thingData.META = getThingType(thingData);\n    thingData.URLMeta = extractMetaFromURL(location.href); // FIXME: provide current pathname\n    thingData.owner = thingData.user;\n}\n\n// Thing context\nfunction thing(state = getInitialStoreState(\"thing\"), action) {\n    switch (action.type) {\n        case C.LOAD_THING:\n            populateThingContext(action.data);\n            return updateShallow(state, {\n                data: action.data,\n                status: action.status,\n                ID: action.ID,\n                pendingID: null,\n                isFetching: false,\n            });\n        case C.REQUEST_THING:\n            return update(state, {\n                pendingID: action.pendingID,\n                status: action.status,\n                isFetching: true,\n            });\n        case C.REQUEST_THING_FAILURE:\n            return update(state, {\n                status: action.status,\n                isFetching: false,\n            });\n\n        // Reset state\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"thing\"));\n        default:\n            return state;\n    }\n}\n\n// Follow contexts\nfunction followContext(state = getInitialStoreState(\"followContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"), {\n                id: action.data.id,\n                followStore: {\n                    following: action.data.sales\n                        ? Boolean(action.data.sales.seller && action.data.sales.seller.seller_follow)\n                        : false,\n                    loading: false,\n                },\n                followUser: {\n                    following: action.data ? Boolean(action.data.following) : false,\n                    loading: false,\n                },\n            });\n\n        // Sidebar\n        // Follow seller/user\n        case C.TOGGLE_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: true,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.CANCEL_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.COMPLETE_FOLLOW:\n            if (action.followType === \"followStore\") {\n                cache.update(state.id, undefined, \"sales.seller.seller_follow\", state[action.followType].following);\n            }\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: state[action.followType].following,\n                },\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"));\n        default:\n            return state;\n    }\n}\n\n/*\nfunction getFancyStatus(nextFancydState) {\n    return nextFancydState ? FancyStatus.Addition : FancyStatus.Removal;\n}\nfunction getCompletionIdleStatus(currentFancyState) {\n    const prevFancyState = !currentFancyState;\n    return prevFancyState ? FancyStatus.AfterRemoval : FancyStatus.AfterAddition;\n}*/\n\nfunction fancyContext(state = getInitialStoreState(\"fancyContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            // Extract thing data for initial thing context data reset.\n            // onFancyButtonUpdate(action.data.id, action.data.fancyd, getConciseNumberString(action.data.fancyd_count));\n            return updateShallow(getInitialStoreState(\"fancyContext\"), {\n                id: action.data.id,\n                fancyd: action.data.fancyd,\n                fancyd_count: action.data.fancyd_count,\n                loading: false,\n                //status: FancyStatus.Idle,\n            });\n        case C.TOGGLE_FANCY:\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: true,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: true,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        case C.CANCEL_FANCY: {\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: false,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: false,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        }\n        // Update data\n        case C.COMPLETE_FANCY:\n            // cache.update(state.id, undefined, \"fancyd\", state.fancyd);\n            // cache.update(state.id, undefined, \"fancyd_count\", action.fancyd_count);\n            // onFancyButtonUpdate(state.id, state.fancyd, getConciseNumberString(action.fancyd_count));\n            // return update(state, {\n            //     loading: false,\n            //     fancyd_count: action.fancyd_count,\n            //     //status: getCompletionIdleStatus(state.fancyd)\n            // });\n            return {\n                ...state,\n                ...{\n                    loading: false,\n                    fancyd_count: action.fancyd_count,\n                    //status: getCompletionIdleStatus(state.fancyd)\n                },\n            };\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"fancyContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction slideContext(state = getInitialStoreState(\"slideContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"), {\n                id: action.data.id,\n            });\n        case C.SET_THUMBNAIL_INDEX:\n            return update(state, {\n                thumbnailIndex: action.thumbnailIndex,\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction saleContext(state = getInitialStoreState(\"saleContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING: {\n            // Extract thing data for initial thing context data reset.\n            const thing = action.data;\n            const sales = thing && thing.sales;\n            const saleOptionInclSales = getFirstSaleOption(sales);\n            const nextContext = {\n                selectedQuantity: 1,\n                saleOptionID: (saleOptionInclSales && saleOptionInclSales.id) || null,\n                currencyCode: action.data.currency_code,\n                price: (saleOptionInclSales && saleOptionInclSales.price) || null,\n                waiting: null,\n            };\n            return updateShallow(getInitialStoreState(\"saleContext\"), nextContext);\n        }\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"saleContext\"));\n        case C.UPDATE_SALE_CONTEXT: {\n            // Setting waiting\n            if (action.waiting != null) {\n                setWaiting(state.saleOptionID, action.waiting);\n            }\n\n            let waiting = action.waiting;\n            // Reset quantity / Change waiting if option is changed.\n            if (action.saleOptionID != null && action.saleOptionID !== state.saleOptionID) {\n                action.selectedQuantity = 1;\n                waiting = null;\n            }\n\n            const nextContext = {\n                selectedQuantity: action.selectedQuantity,\n                saleOptionID: action.saleOptionID, // `thing.id`? | `sio.id`?\n                price: action.price, // (props.thing.sales_available && props.thing.sales.price) || null,\n                // UI\n                currencyCode: action.currencyCode, // props.thing.currency_code\n                currencyMoney: action.currencyMoney, //\n                currencySymbol: action.currencySymbol, //\n                personalization: action.personalization,\n                waiting,\n            };\n            return update(state, nextContext);\n        }\n        default:\n            return state;\n    }\n}\n\n/*\nfunction checkNotImplementedWithURLExceptionRule(META) {\n    if (['Fancybox', 'Hermes'].some(type => META[type])) {\n        window.location.reload()\n    }\n}*/\n\nconst rootReducer = combineReducers({\n    appContext,\n    // Thing contexts\n    followContext,\n    fancyContext,\n    slideContext,\n    saleContext,\n    // etc.\n    thing,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","// Warning: objects has to be flat in each context\nexport function getInitialStoreState(contextName: 'appContext' | 'thing' | 'followContext' | 'fancyContext' | 'saleContext' | 'slideContext') {\n    switch(contextName) {\n    case 'appContext':\n        return {\n            visible: false,\n            viewer: {},\n            loggedIn: null,\n            userCountry: 'US',\n            applePayDisplay: false,\n            applePayTest: false,\n        };\n    case 'thing':\n        return {\n            data: null,\n            ID: null,\n            pendingID: null,\n            isFetching: null,\n            status: 'idle' // { idle | request | failed }\n        };\n    case 'followContext':\n        return {\n            id: null,\n            followStore: {\n                following: undefined,\n                loading: false,\n            },\n            followUser: {\n                following: undefined,\n                loading: false,\n            },\n        };\n    case 'fancyContext':\n        return {\n            id: null,\n            fancyd_count: 0,\n            fancyd: false,\n            loading: false,\n            status: 'Idle', // { Idle | Addition | Removal | After- } - Fancy'd status for animation control \n        };\n    case 'saleContext':\n        return {\n            selectedQuantity: 1,\n            saleOptionID: null, // `thing.id`? | `sio.id`?\n            currencyCode: null, // props.thing.currency_code\n            currencyMoney: null, //\n            currencySymbol: null, //\n            price: null, // (props.thing.sales_available && props.thing.sales.price) || null,\n            personalization: null,\n        };\n    case 'slideContext':\n        return {\n            id: null,\n            thumbnailIndex: 0,\n        };\n    default:\n        console.warn('`getInitialStoreState()`: Unknown context name ', contextName);\n    }\n};\n\nvar contexts = [\n    'slideContext',\n    'saleContext',\n    'fancyContext',\n    'followContext',\n    'thing',\n    'appContext'\n];\n\nexport function getAllInitialStoreState() {\n    return contexts.reduce((state, contextKey) => {\n        state[contextKey] = getInitialStoreState(contextKey);\n        return state;\n    } , {});\n}\n","import { configureStore } from \"@reduxjs/toolkit\";\nimport thunk from \"redux-thunk\";\nimport logger from 'redux-logger'\n\nimport { getAllInitialStoreState } from \"./initial-store\";\nimport rootReducer from \"../reducers\";\n// import type { RootState } from '../reducers';\n\nconst middlewares = [thunk];\nif (process.env.NODE_ENV !== 'production') {\n    middlewares.push(logger);\n}\n\nconst store = configureStore({\n    reducer: rootReducer,\n    preloadedState: getAllInitialStoreState(),\n    middleware: (getDefaultMiddleware) =>\n        getDefaultMiddleware({\n            serializableCheck: false,\n        }).prepend(middlewares),\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport default store;\n"],"sourceRoot":""}
{"version":3,"sources":["webpack://fancy/./_static/modules/libf/CDNUtils.js","webpack://fancy/./_static/modules/libf/CopyToClipboard.js","webpack://fancy/./_static/modules/libf/DOMHelper.ts","webpack://fancy/./_static/modules/libf/FancyMixin.js","webpack://fancy/./_static/modules/libf/FancyUtils.ts","webpack://fancy/./_static/modules/libf/PopupHelper.js","webpack://fancy/./_static/modules/libf/common-components/AddlistAction.js","webpack://fancy/./_static/modules/libf/common-components/AddlistPopover.js","webpack://fancy/./_static/modules/libf/common-components/History.ts","webpack://fancy/./_static/modules/libf/common-components/MoreShare.js","webpack://fancy/./_static/modules/libf/common-components/MoreShareFacade.js","webpack://fancy/./_static/modules/libf/common-components/MoreShareUtils.js","webpack://fancy/./_static/modules/libf/common-components/Popup.js","webpack://fancy/./_static/modules/libf/common-components/ProductSlide.js","webpack://fancy/./_static/modules/libf/common-components/SharePopover.js","webpack://fancy/./_static/modules/libf/common-components/Video.js","webpack://fancy/./_static/modules/libf/common-components/index.js"],"names":["CDNUtils","makeServer","type","template","HOSTS","push","url","size","method","isSchemeless","cdn","parts","window","parseURL","fixedName","test","pathname","path","resizeUrl","getCDNURL","protocol","hostname","schemeless","candidates","replace","THEFANCY_MEDIA","THINGD_MEDIA","FANCY_WEB","RESIZE_IMAGE","STATICFILES","sumChars","length","match","getResizeURL","str","sum","i","c","charCodeAt","cdnUtils","copyToClipboard","text","options","cb","reselectPrevious","range","selection","mark","Function","prototype","deselectCurrent","document","createRange","getSelection","createElement","textContent","style","whiteSpace","body","appendChild","selectNode","addRange","successful","execCommand","console","warn","clipboardData","setData","err","removeRange","removeAllRanges","removeChild","jsRender","Component","data","targetElement","callback","rEl","React","ReactDOM","Prepend","rctElDomRef","$","prependTo","Append","appendTo","After","insertAfter","Before","insertBefore","Replace","replaceWith","RenderModes","FACTORY_DIV_ID","externalRender","mode","FACTORY_DIV_REF","id","rctElRef","cs","children","Element","remove","mountToDisposable","unmountedDOM","$disposable","find","eq","empty","append","initialDisplayNone","display","Display","None","Block","Inline","InlineBlock","NoneIf","cond","undefined","BlockIf","InlineIf","InlineBlockIf","BGImage","alt","className","backgroundImage","getSchemelessURL","getElementGapFromHeader","measurePointElement","$headerFeatured","$header","destHeight","height","attr","scrollTop","offset","top","__KEY__","_","requestIdleCallback","args","setTimeout","Number","isNaN","value","isInteger","isFinite","Math","floor","padStart","max","mask","cur","masked","filler","String","fillerSlice","slice","zfill","selectOrCreate","selector","container","element","attrValue","classNames","split","filter","e","join","substr","Error","target","get","thingRegex","extractMetaFromURL","stripDomain","ret","href","stripURL","articleRegex","extractMetaFromArticleURL","createElementParser","a","setAttribute","parser","result","search","hash","indexOf","getObjectTypeFromUrl","getPathname","aElement","location","stripped","floatFormatMinusTwo","number","num","numberFormat","splitted","isEmpty","obj","Array","Object","getOwnPropertyNames","setCaretPos","position","focus","setSelectionRange","createTextRange","moveEnd","collapse","select","getCaretPos","selectionStart","moveStart","KEYS","TAB","ENTER","SPACE","ESC","UP","DOWN","LEFT","RIGHT","SEMICOLON","COMMA","triggerEvent","DOMRef","eventName","event","CustomEvent","Event","dispatchEvent","update","state","next","extend","apply","updateShallow","getDisplay","stripTags","html","div","innerHTML","innerText","isPlainLeftClick","button","altKey","metaKey","ctrlKey","shiftKey","testLegacyContextLocation","_isHomepage","isHomepage","_isStream","isStream","promisifiedFetchImage","src","resolveCallback","timeout","deferred","Deferred","then","resolve","img","Image","onload","onerror","debounceUntilTimeout","fun","delay","context","timer","delayedFunctionWrapper","clearTimeout","unshift","bind","debounceEventUntilTimeout","eventHandler","persist","numberUnitPostfixes","getConciseNumberString","_num","isNumber","pos","toFixed","decimals","decPoint","thousandsSep","abs","sign","intPartNum","parseInt","intPart","j","proportionFormat","isFixed","isStaticPage","isStaticArticlePage","index","is","log","process","debug","isVisible","elm","vpH","st","$elm","elementHeight","y","dedupeArray","vals","sort","reduce","b","getFancyDepsRoot","eitherFancy","namespace","doWith","Deps","didClickOn","$targ","parents","xmlUtil","isSuccess","xml","sc","isFail","MP","getLocationArgPairs","key","originalArgStr","argStr","map","some","argPair","formatDuration","val","remainder","minutes","seconds","minmax","lb","ub","min","mergeObjectArgs","p","n","closestUntil","startingElement","start","documentElement","parentElement","ClickOutside","component","popupElementRefKey","closePopupFunction","attached","eventKey","handleDetach","on","isTrigger","contains","off","random","toString","isClipboardSupported","queryCommandSupported","isSaleResponse","sales","convertThingsV1ToRest","things","thing","converted","assign","sales_available","id_str","name","fancyd","thumb_image_url_310","thumb_image_url_558","fancyd_count","fancys","image","image_url","width","image_url_width","image_url_height","owner","user","html_url","fancyd_users","sale_id","quantity","remaining_quantity","price","fancy_price","available_for_sale","isCrawled","isElementOutsideViewport","excludingElement","elementRect","getBoundingClientRect","upperBound","leftBound","exclusionRect","bottom","right","lowerBound","innerHeight","clientHeight","rightBound","innerWidth","clientWidth","left","_FancyUser","loggedIn","merchant","__FancyUser","FancyUser","locationHostname","stripPathname","sp","cartesianProductOf","flatten","x","concat","jQueryPromiseAll","arrayOfPromises","jQuery","when","call","arguments","_loaded","loadCss","AppName","B","Bundle","cssToLoad","nextUrl","pop","head","_alertify","alertify","alert","prompt","message","fn","placeholder","cssClass","msg","confirm","set","labels","ok","cancel","escapeSelector","sel","rcssescape","fcssescape","ch","asCodePoint","isSafari_cac","isSafari","navigator","userAgent","selectPopup","popupName","dialog","openPopup","bindOverlayData","popup","$obj","one","open","closePopup","close","popupContainer","getElementById","renderPopup","PopupComponent","attrs","openOnMount","AddlistAction","lists","wanted","listSearchQuery","listCreationQuery","createListFocused","showList","setStateSafe","preventDefault","which","trim","props","objectId","objectType","merchantId","createList","drawUserList","quickCreateList","via","stopPropagation","targ","currentTarget","handleHide","params","owned","checked","dataLayer","product_id","products_info","products","revenue","option_id","ajax","done","error","isChecked","selectedListId","getAttribute","collectionAction","theList","list","updateList","unchecked","each","listId","mounted","setState","getListCheckbox","res","toLowerCase","listDrawn","pp","ps","listSearchInput","gettext","handleListSearch","isWishlistQuery","handleWishlistCheckboxChange","idx","term","isString","selected","ident","handleListCheckboxChange","handleCreateListLabelClick","handleCreateListBlur","handleListCreation","handleCreateListQueryChange","selected_object_id","collections","aText","bText","tid","$html","$items","end","item","$item","prop","post","list_name","reaction","collectionId","add","object_id","action","checked_list_ids","unchecked_list_ids","AddlistPopover","headerGap","classnames","bot","history","createHistory","makeToggle","keys","toggle","forEach","toggleKeys","toggleShow","MoreShare","showShare","showMenu","referrerURL","linkCopied","moreMenuButton","handleHook","ShareObjectTypes","require_login","showSellerList","removeViewportCheck","viewPortChecking","evtName","$root","MoreShareEl","headerEl","el","outsideViewport","handleShareDisplay","onShowSomething","linkCopiedRemovalTimer","viewerUsername","FancydByPopup","viewerId","clickOutside","facadeShowShare","facadeShowList","handleMoreShareToggle","destroy","ns","handleAttach","checkViewport","getShareURL","title","componentClass","btnClass","objectMeta","showShortcuts","fromThingSidebar","isThing","isArticle","showMerchantList","shouldShowMerchantCollection","newLayout","SharePopover","opened","handleFancydByDisplay","handleListDisplay","handleMerchantListDisplay","opacity","handleCopyLink","handleHideList","handleHideShare","MoreShareFacade","share","handleClickShare","handleClickList","FakeMoreShare","onClickShare","onClickAddlist","store","article","createReferredUrl","slug","connector","loading","originalUrl","short_url","fail","FancydPerson","following","user_id","dataType","nextFollowing","$status","always","isAddedUser","username","handleTransition","user_square_image_small","fullname","full_name","handleFollow","getFollowList","_getInitialState","nextPage","ended","added_user","users","nextProps","reset","immediateNextStateUpdate","thing_id","page","has_next","nextState","max_page","current_page","saved_users","__last_tid","handleMore","FancydByPopupV4","scrollHeight","next_cursor","cursor","handleScroll","applyProductSlide","mWidth","initSlide","$el","option","$slide","$list","$li","itemWidth","$prev","$next","slideWidth","itemPerSlide","resetRecommend","css","center","scrollLeft","removeClass","addClass","getPrevLeft","preparePrev","nextLeft","getNextLeft","prepareNext","prepareCount","ceil","last","clone","first","listWidth","spare","clearOld","prevCnt","hide","$this","hasClass","animate","productSlide","self","$slides","SNSDict","followingUsers","followingUsersRequested","ViewClasses","Success","Default","Searching","NoResult","friendSearchQuery","searchedFriends","selectedUserID","sentUser","sendNote","sendSuccess","searching","isContact","profile_image_url","clearFriendList","prevQuery","searchFriends","sending","isMailuser","mailUser","handleSendMail","json","status_code","sentUserID","xhr","object_type","email_address","object_meta","responseObject","JSON","parse","responseText","status","statusText","additionals","excludes","excludeKey","nextID","getSearchedFriends","loadingDisplayUsers","forceUpdate","isInputEmail","getSharedMailUser","isEmailOnlyMode","filter_messages_permission","prevProps","getDisplayUsers","selectedUser","getSelectedUser","getSentUser","emptyDisplay","emptyClassName","searchedFriendsDisplay","inputIsEmail","emailOnlyMode","noteSendable","isSNS","sentMessage","getShareMessage","handleFriendSearch","prefix","getPrefix","imgClass","handleUserSelect","handleClickContactImport","handleContinue","handleSendNoteInput","handleSend","handleClickBackFromContact","defaultMessage","shareMessage","SNSShareBox","copied","textboxDisplay","updateEmbedOption","$ep","detail","faintClick","snsShareWindow","getRefURL","directClick","$thumb","$options","types","snippet","showShareBox","handleShare","encodeURI","handleEmbed","getVideo","object","h264_1000k_url","saleVideo","video","thingOrArticleVideo","video_cover","cover_video","outputs","h264_1000k","metadata","video_url","thumbnail_url","original_url","Video","Date","original","loop","lastFullyRenderedObjectID","playing","domCls","getSrc","getLoop","currentTime","getThumbnail","videoEl","np","pause","play","prepare","thingHasVideo"],"mappings":"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","file":"libfancy.ee46e3149e12625fd24b.js","sourcesContent":["class CDNUtils {\n    HOSTS = {};\n\n    constructor() {\n        // init hosts\n        this.makeServer('THINGD_MEDIA', 'thingd-media-ec.thefancy.com');\n        this.makeServer('THEFANCY_MEDIA', 'thefancy-media-ec.thefancy.com');\n        this.makeServer('RESIZE_IMAGE', 'resize-ec.thefancy.com');\n        this.makeServer('STATICFILES', 'static-ec.thefancy.com');\n        this.makeServer('FANCY_WEB', 'site-ec.thefancy.com');\n    }\n\n    makeServer(type, template) {\n        const { HOSTS } = this;\n        if (!HOSTS[type]) {\n            HOSTS[type] = [];\n        }\n        HOSTS[type].push(template);\n    }\n\n    getResizeURL(url, size, method, isSchemeless, cdn) {\n        var parts = window.parseURL(url);\n        var fixedName = (/test_default/.test(parts.pathname)) ? 'thingd' : 'thefancy';\n        var path = `/resize/${method ? method + '/' : ''}${size}/${fixedName}${parts.pathname}`;\n\n        var resizeUrl;\n        if (cdn) {\n            resizeUrl = this.getCDNURL(path);\n        } else {\n            resizeUrl = `${parts.protocol}//${parts.hostname}${path}`;\n        }\n\n        if (isSchemeless) {\n            resizeUrl = schemeless(resizeUrl);\n        }\n        return resizeUrl;\n    }\n\n    getCDNURL(url) {\n        const { HOSTS } = this;\n        let candidates;\n        const parts = window.parseURL ? window.parseURL(url) : {};\n        let path = parts.pathname;\n\n        if (parts.hostname == 's3.amazonaws.com') {\n            if (/\\/media\\.thefancy\\.com/.test(parts.pathname)) {\n                path = parts.pathname.replace(/^\\/media\\.thefancy\\.com/, '');\n                candidates = HOSTS.THEFANCY_MEDIA;\n            } else if (/\\/media\\.thingd\\.com/.test(parts.pathname)) {\n                path = parts.pathname.replace(/^\\/media\\.thingd\\.com/, '');\n                candidates = HOSTS.THINGD_MEDIA;\n            }\n        } else if (/^\\/(test_)?default/.test(path)) {\n            candidates = HOSTS.THINGD_MEDIA;\n        } else if (/^\\/_ui/.test(path)) {\n            candidates = HOSTS.FANCY_WEB;\n        } else if (/^\\/(resize|mark)/.test(path)) {\n            candidates = HOSTS.RESIZE_IMAGE;\n        } else if (/^\\/_static_gen/.test(path)) {\n            candidates = HOSTS.STATICFILES;\n        } else {\n            candidates = HOSTS.THEFANCY_MEDIA;\n        }\n\n        const hostname = candidates[sumChars(path.replace(/[^a-zA-Z0-9_]+/g,'')) % candidates.length];\n\n        return '//'+ hostname + path;\n    }\n\n    // Get REST URI for given resized_schemeless_image arguments\n    // See `fancy.templatetags.resized_images`\n    resizedSchemelessImage(url, size, method) {\n        // FIXME: some url (like cover image, user image, etc) gives weird url\n        //        and `window.parseURL()` attaches it to location.pathname.\n        //        This is temporary fix for it\n        if (url.match(/^(CoverImages\\/|UserImages\\/)/)) {\n            url = `/${url}`\n        }\n        return this.getResizeURL(url, size, method, true, true);\n    }\n}\n\nfunction sumChars(str) {\n    var sum = 0, i, c;\n    for (i=0,c=str.length; i < c; i++) {\n        sum += str.charCodeAt(i);\n    }\n    return sum;\n}\n\nexport function schemeless(url) {\n    var match = (typeof url === 'string') && url.match(/[http|https]\\:(\\/\\/.*)/);\n    return (match == null) ? url : match[1];\n}\n\nexport const cdnUtils = new CDNUtils();\n","// Removed prompt from 'copy-to-clipboard'\n// https://github.com/sudodoki/copy-to-clipboard/blob/04386fe925e10fec353e35e81684c5c96920102e/index.js\nimport deselectCurrent from 'toggle-selection';\n\n\nexport function copyToClipboard (text, options) {\n  var cb, reselectPrevious, range, selection, mark;\n  if (!options) { options = {}; }\n  cb = options.cb || Function.prototype;\n  try {\n    reselectPrevious = deselectCurrent();\n\n    range = document.createRange();\n    selection = document.getSelection();\n\n    mark = document.createElement('mark');\n    mark.textContent = text;\n    // used to conserve newline, etc\n    mark.style.whiteSpace = 'pre';\n    document.body.appendChild(mark);\n\n    range.selectNode(mark);\n    selection.addRange(range);\n\n    var successful = document.execCommand('copy');\n    if (!successful) {\n      console.warn('unable to copy via execCommand')\n      window.clipboardData.setData('text', text)\n    }\n  } catch (err) {\n    console.warn(err)\n  } finally {\n    cb(null);\n    if (selection) {\n      if (typeof selection.removeRange == 'function') {\n        selection.removeRange(range);\n      } else {\n        selection.removeAllRanges();\n      }\n    }\n    if (mark) {\n      document.body.removeChild(mark);\n    }\n    reselectPrevious();\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\n// render without using JSX\nexport function jsRender(Component: React.ComponentClass<{}, any>, data = {}, targetElement: Element, callback = () => {}) {\n    const rEl = React.createElement(Component, data);\n    return ReactDOM.render(rEl, targetElement, callback);\n}\n\n// Render to specific element position with a wrap.\n// function wrappedRenderCreator(\n//     $WrapperMethodKey/* appendTo, prependTo, insertAfter, insertBefore, ... */,\n//     Component,\n//     data,\n//     targetElement,\n//     wrapElementTag='div',\n//     callback\n// ) {\n//     let wrapper = $(`<${wrapElementTag} />`)[$WrapperMethodKey](targetElement).get(0);\n//     return function renderAfter() {\n//         return jsRender(Component, data, wrapper, callback);\n//     };\n// }\n\nfunction Prepend(rctElDomRef: Element, targetElement: Element) {\n    $(rctElDomRef).prependTo(targetElement);\n}\nfunction Append(rctElDomRef: Element, targetElement: Element) {\n    $(rctElDomRef).appendTo(targetElement);\n}\nfunction After(rctElDomRef: Element, targetElement: Element) {\n    $(rctElDomRef).insertAfter(targetElement);\n}\nfunction Before(rctElDomRef: Element, targetElement: Element) {\n    $(rctElDomRef).insertBefore(targetElement);\n}\nfunction Replace(rctElDomRef: Element, targetElement: Element) {\n    $(targetElement).replaceWith(rctElDomRef);\n}\n\nexport const RenderModes = {\n    Prepend,\n    Append,\n    After,\n    Before,\n    Replace\n};\n\ntype RenderModeMethods = typeof Prepend | typeof Append | typeof After | typeof Before | typeof Replace;\n\nconst FACTORY_DIV_ID = \"__external_render_factory__\";\n// Warning: this works until React 16, and it could get broken at some point.\nexport function externalRender(\n    mode: RenderModeMethods,\n    Component: React.ComponentClass,\n    data: Object,\n    targetElement: Element,\n    callback?: Function\n) {\n    const FACTORY_DIV_REF = document.createElement(\"div\");\n    FACTORY_DIV_REF.id = FACTORY_DIV_ID;\n    document.body.appendChild(FACTORY_DIV_REF);\n    const rctElRef = jsRender(Component, data, FACTORY_DIV_REF);\n    let rctElDomRef;\n    if (rctElRef) {\n        // non-stateless component\n        rctElDomRef = ReactDOM.findDOMNode(rctElRef);\n    } else {\n        // Stateless component\n        const cs = FACTORY_DIV_REF.children;\n        if (cs.length === 0) {\n            console.warn(\"externalRender: There might be a chance element is not rendered.\");\n        }\n        rctElDomRef = cs[0];\n    }\n\n    if (rctElDomRef && rctElDomRef instanceof Element) {\n        mode(rctElDomRef, targetElement);\n        if (callback) {\n            callback([rctElRef, rctElDomRef]);\n        }\n\n        FACTORY_DIV_REF.remove(); // Due to restriction, need to remove\n        return [rctElRef, rctElDomRef];\n    }\n}\n\n/*\n// TEST\nconst ASDF = ({foo}) => <div className=\"asdfasdfasdfasdfasadsfdasfasdfdasf\">{foo}</div>\nclass ASDF2 extends React.Component {\n    render() {\n        return <div className=\"213480123794578902349870239804129830\">{this.props.foo}</div>\n    }\n}\nexternalRender(RenderModes.Prepend, ASDF, {foo: 1}, document.body);\nexternalRender(RenderModes.Prepend, ASDF2, {foo: 'heydsaasdfasdfldasflasdflfdaslkfsdakmdsaf'}, document.body);\n*/\n\nexport function mountToDisposable(unmountedDOM: Element) {\n    // Create/Select disposable mounting DIV to correctly modify a element.\n    let $disposable = $(document.body).find(\".disposable\");\n    if ($disposable.length > 0) {\n        $disposable = $disposable.eq(0).empty();\n    } else {\n        $disposable = $(\"<div />\", { id: \"disposable\", style: \"display:none;\" }).appendTo(document.body);\n    }\n\n    if (unmountedDOM) {\n        // Append unmounted DOM if exists\n        $disposable.append(unmountedDOM);\n    }\n    // return disposable DOM\n    return $disposable;\n}\n","// built from 'webpack.FancyUtils.config.js'\n// loaded from 'FancyUtils.js' and exported as global module 'fancymixin'\nimport React from 'react';\nimport { schemeless as getSchemelessURL } from './FancyUtils';\n\n\nexport const initialDisplayNone = { display: 'none' }; // DEPRECATED\nexport const Display = {\n    None: { display: 'none' },\n    Block: { display: 'block' },\n    Inline: { display: 'inline' },\n    InlineBlock: { display: 'inline-block' },\n    NoneIf(cond) {\n        return cond ? Display.None : undefined;\n    },\n    BlockIf(cond) {\n        return cond ? Display.Block : undefined;\n    },\n    InlineIf(cond) {\n        return cond ? Display.Inline : undefined;\n    },\n    InlineBlockIf(cond) {\n        return cond ? Display.InlineBlock : undefined;\n    }\n};\n\n// Image using background-image\nexport const BGImage = ({ alt, className, schemeless, url }) => {\n    var backgroundImage = '';\n    if (url) {\n        backgroundImage = `url(${schemeless ? getSchemelessURL(url) : url})`;\n    }\n\n    return <img src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage }}\n                className={className}\n                alt={alt} />\n}\n\n// measurePointElement = .figure-item.btn-more\n// https://app.asana.com/0/260912680807/218844368911219\nexport function getElementGapFromHeader(measurePointElement/*:Element*/) /*:number*/{\n    const $headerFeatured = $('#header .header-featured');\n    const $header = $('#header')\n    let destHeight = $header.height()\n    if ($headerFeatured.attr('data-expanded') === 'true') {\n        destHeight += $headerFeatured.height()\n    }\n    return ~(document.body.scrollTop - $(measurePointElement).offset().top + destHeight) + 1 // convert - => + / + => -, integer\n}\n","import {\n    ThingV1Response,\n    ThingObject,\n    FancyUserConfig,\n    SalesResponse,\n} from \"ftypes\";\nimport { BaseSyntheticEvent } from \"react\";\n\nconst __KEY__ = '__F';\n\nconst { _ } = window;\n\nwindow.requestIdleCallback = window.requestIdleCallback || function(cb: Function, ...args: any[]) {\n    window.setTimeout(cb, 0, ...args);\n};\n\n// Polyfills\nNumber.isNaN = Number.isNaN || function isNaN(value) {\n    return value !== value;\n};\n\nNumber.isInteger = Number.isInteger || function(value) {\n    return typeof value === \"number\" &&\n           isFinite(value) &&\n           Math.floor(value) === value;\n};\n\n// https://ponyfoo.com/articles/ecmascript-string-padding\nexport function padStart(text: string, max: number, mask: string) {\n  const cur = text.length;\n  if (max <= cur) {\n    return text;\n  }\n  const masked = max - cur;\n  let filler = String(mask) || ' ';\n  while (filler.length < masked) {\n    filler += filler;\n  }\n  const fillerSlice = filler.slice(0, masked);\n  return fillerSlice + text;\n}\n\nexport function zfill(text: string, max: number) {\n    return padStart(text, max, '0');\n}\n\n// Select element or create element via selector\nexport function selectOrCreate(selector:string, container: Element = document.body, element: string = 'div'): Element {\n    var attr;\n    var attrValue;\n    if (selector[0] === '.') {\n        attr = 'class';\n        var classNames = selector.split('.').filter(e=>e);\n        if (classNames.length > 1) { // .abc.def\n            attrValue = classNames.join(' ');\n        } else { // .abc\n            attrValue = selector.substr(1);\n        }\n    } else if (selector[0] === '#') {\n        attr = 'id';\n        attrValue = selector.substr(1);\n    } else {\n        // TODO: error handling - redirect to the page\n        throw new Error('non-recognized selector:' + selector);\n    }\n\n    var target = $(container).find(selector).get(0);\n    if (target == null) {\n        target = $(`<${element} ${attr}=\"${attrValue}\" />`).appendTo(container).get(0);\n    }\n    return target;\n}\n\ninterface URLMeta {\n    href?: string | null;\n    type?: string;\n    id?: string;\n}\nconst thingRegex = /^\\/(sales|things)\\/(\\d+)/;\nexport function extractMetaFromURL(url: string) {\n    url = stripDomain(url);\n    const match = url.match(thingRegex); // [\"/(sales|things)/1234\", \"sales\", \"1234\"] | null\n    const ret: URLMeta = {};\n    if (match != null) {\n        ret.href = stripURL(url); // Stripped relative URL\n        ret.type = match[1];      // either { 'sales' | 'things' }\n        ret.id = match[2];        // Integer\n    }\n    return ret;\n}\n\nconst articleRegex = /^\\/(articles)\\/([^\\?]+)/;\nexport function extractMetaFromArticleURL(url: string) {\n    url = stripDomain(url);\n    const match = url.match(articleRegex); // [\"/articles/test\", \"articles\", \"test\"] | null\n    const ret: URLMeta = {};\n    if (match != null) {\n        ret.href = stripURL(url); // Stripped relative URL\n        ret.type = match[1];      // always { 'article' }\n        ret.id = match[2];        // String\n    }\n    return ret;\n}\n\nfunction createElementParser(url: string) {\n    const a = document.createElement('a');\n    a.setAttribute('href', url);\n    return a;\n}\n\nfunction stripDomain(url: string) {\n    if (url) {\n        const parser = createElementParser(url);\n        let result = parser.pathname + parser.search + parser.hash;\n        // IE FIX\n        if (result.indexOf('/') !== 0) {\n            result = '/' + result\n        }\n        return result\n    } else {\n        return '/';\n    }\n}\n\nexport function getObjectTypeFromUrl(url: string) {\n    const path = stripDomain(url);\n    if (thingRegex.test(path)) {\n        return 'Thing';\n    } else if (articleRegex.test(path)) {\n        return 'Article';\n    } else {\n        return null;\n    }\n}\n\n// Due to <a href=# /> -> a.pathname = location.pathname, we need cleaner\nexport function getPathname(aElement: HTMLAnchorElement) {\n    if (aElement.pathname === location.pathname) {\n        return '';\n    } else {\n        return aElement.pathname;\n    }\n}\n\n// http://domain/things/1234 => /things/1234\n// deprecated, use stripDomain()\nfunction stripURL(url: string) {\n    const stripped = stripDomain(url);\n    if (stripped) {\n        return stripped;\n    } else {\n        return null;\n    }\n}\n\nexport function floatFormatMinusTwo(number: number) {\n    // simulates effect of floatformat:-2|intcomma\n    var num = numberFormat(number, 2);\n    var splitted = numberFormat(number, 2).split('.');\n    if (splitted[1] === '00') {\n        return splitted[0];\n    } else return num;\n}\n\n// Either empty or null/undefined; Python-side falsy values like {}, []\nexport function isEmpty(obj: any) : boolean {\n    return obj == null ||\n           obj === ''  ||\n           (obj instanceof Array && obj.length === 0) ||\n           (typeof obj === 'object' && Object.getOwnPropertyNames(obj).length === 0);\n}\n\nexport function setCaretPos(element: HTMLInputElement, position: number) {\n    element.focus();\n    if (element.setSelectionRange){\n        element.setSelectionRange(position, position);\n    } else if (element.createTextRange) {\n        var range = element.createTextRange();\n        range.moveEnd('character', position);\n        range.collapse(false);\n        range.select();\n    }\n};\n\nexport function getCaretPos(element: HTMLInputElement) {\n    if (element.selectionStart) {\n        return element.selectionStart;\n    } else if (document.selection) {\n        var range = document.selection.createRange();\n        range.moveStart('character', -element.value.length);\n        return range.text.length;\n    } else {\n        return -1;\n    }\n}\n\nexport var KEYS = {\n    TAB: 9,\n    ENTER: 13,\n    SPACE: 32,\n    ESC: 27,\n    UP: 38,\n    DOWN: 40,\n    LEFT: 37,\n    RIGHT: 39,\n    SEMICOLON: 186,\n    COMMA: 188 // ,\n};\n\n// Using DOM high-level event triggering system for React to recognize event\nexport function triggerEvent(DOMRef: Element, eventName: string, data: Object) {\n    var event;\n    if (data) {\n        event = new CustomEvent(eventName, {\n            'bubbles'    : true, // Whether the event will bubble up through the DOM or not\n            'cancelable' : true, // Whether the event may be canceled or not\n            'detail': data\n        });\n    } else {\n        event = new Event(eventName, {\n            'bubbles'    : true, // Whether the event will bubble up through the DOM or not\n            'cancelable' : true  // Whether the event may be canceled or not\n        });\n    }\n    return DOMRef.dispatchEvent(event);\n}\n\n// Deep merge for reducers\nexport function update(state: unknown, next: unknown) {\n    var args = [true, {}, state];\n    if (next) {\n        args.push(next)\n    }\n    return $.extend.apply(null, args);\n}\n\n// 'Shallow merge'\nexport function updateShallow(state: unknown, next: unknown) {\n    var args = [{}, state];\n    if (next) {\n        args.push(next)\n    }\n    return _.extend.apply(null, args);\n}\n\nexport function getDisplay(display: unknown) {\n    return {\n        display: display ? 'block' : 'none'\n    };\n}\n\n// '<a>b</a>' => 'b'\nexport function stripTags(html: string) {\n    var div = document.createElement(\"div\");\n    div.innerHTML = html;\n    return div.textContent || div.innerText || null;\n}\n\nexport function isPlainLeftClick(event: JQueryEventObject) : boolean {\n    return !(event.button !== 0 || event.altKey || event.metaKey || event.ctrlKey || event.shiftKey);\n}\n\nfunction testLegacyContextLocation() {\n    try {\n        // Root - /\n        if (location.pathname === '/' && $('#container-wrapper .timeline').length > 0) {\n            return true;\n        // Search page - /search?q=foo\n        } else if (/\\/search\\?q\\=/.test(location.href)) {\n            return true;\n        // User page - /foo\n        } else if (\n            $('#container-wrapper .wrapper-content.profile-section').length > 0 &&\n            /^\\/((?!\\/).)*$/.test(location.pathname)\n        ) {\n            return true;\n        } else if ('/shop' === location.pathname || /^\\/shop\\/.*/.test(location.pathname)) {\n            return true;\n        // <username | shopname>/lists/<id>\n        // <shopname>/collection/<id>\n        } else if (\n            /.*\\/list\\/\\d+/.test(location.pathname) ||\n            /.*\\/collection\\/\\d+/.test(location.pathname)\n        ) {\n            return true;\n        }\n    } catch(e) {}\n\n    return false;\n}\n\nlet _isHomepage: boolean;\nexport function isHomepage() {\n    if (_isHomepage == null) {\n        _isHomepage = location.pathname === '/'\n    }\n    return _isHomepage;\n}\n\nlet _isStream: boolean;\nexport function isStream() {\n    if (_isStream == null) {\n        return _isStream = testLegacyContextLocation();\n    } else {\n        return _isStream;\n    }\n}\n\nexport function promisifiedFetchImage(src: string, resolveCallback: any, timeout: number) {\n    const deferred = $.Deferred();\n    deferred.then(resolveCallback);\n\n    if (timeout) {\n        setTimeout(function () { deferred.resolve() }, timeout);\n    }\n\n    const img = new Image();\n    img.onload = () => { deferred.resolve(); };\n    img.onerror = () => { deferred.resolve(); };\n    img.src = src;\n}\n\nexport function debounceUntilTimeout(fun: Function, delay: number, context = null) {\n    let timer: any;\n    return function delayedFunctionWrapper(...args: unknown[]) {\n        clearTimeout(timer);\n        args.unshift(context);\n        timer = setTimeout(fun.bind.apply(fun, args), delay);\n    };\n}\n\nexport function debounceEventUntilTimeout(eventHandler: Function, delay: number) {\n    let timer: any;\n    return (e: BaseSyntheticEvent) => {\n        e.persist();\n        clearTimeout(timer);\n        timer = setTimeout(() => eventHandler(e), delay);\n    }\n}\n\nconst numberUnitPostfixes = ['', 'K', 'M', 'B', 'T'];\nexport function getConciseNumberString(_num: string | number) {\n    let num = Number(_num);\n    if (_.isNaN(num) || !_.isNumber(num)) {\n        return ''\n    }\n    let pos = 0\n    while (num > 1000) {\n        num = num / 1000\n        pos += 1\n    }\n    if (num % 1 !== 0) { // has some number after decimal point, i.e.) 10.5\n        return num.toFixed(1) + numberUnitPostfixes[pos]\n    } else { // integer i.e.) 10\n        return String(num) + numberUnitPostfixes[pos]\n    }\n}\n\n// humanize.js\nexport function numberFormat(number: number, decimals: number, decPoint?: string, thousandsSep?: string) : string {\n    decimals = isNaN(decimals) ? 2 : Math.abs(decimals);\n    decPoint = (decPoint === undefined) ? '.' : decPoint;\n    thousandsSep = (thousandsSep === undefined) ? ',' : thousandsSep;\n\n    var sign = number < 0 ? '-' : '';\n    number = Math.abs(+number || 0);\n\n    var intPartNum = parseInt(number.toFixed(decimals), 10);\n    var intPart = intPartNum + '';\n    var j = intPart.length > 3 ? intPart.length % 3 : 0;\n\n    return sign + (j ? intPart.substr(0, j) + thousandsSep : '') + intPart.substr(j).replace(/(\\d{3})(?=\\d)/g, '$1' + thousandsSep) + (decimals ? decPoint + Math.abs(number - intPartNum).toFixed(decimals).slice(2) : '');\n}\n\n// Number formatting utility i.e) 0.1 => 10%\nexport function proportionFormat(number: string | number, isFixed: boolean) : string {\n    const num = Number(number);\n    if (_.isNumber(num) && !_.isNaN(num)) {\n        if (isFixed) {\n            return (num * 100).toFixed(0) + '%';\n        } else {\n            return (num * 100) + '%';\n        }\n    } else {\n        return '';\n    }\n}\n\nexport function isStaticPage() : boolean {\n    return document.body.className.indexOf('static-ot') !== -1;\n}\n\nexport function isStaticArticlePage() : boolean {\n    return document.body.className.indexOf('static-article') !== -1;\n}\n\n// http://stackoverflow.com/questions/6393943/convert-javascript-string-in-dot-notation-into-an-object-reference\nexport function index(obj: Object, is: string, value : any): any {\n    if (typeof is == 'string') {\n        return index(obj, is.split('.'), value);\n    } else if (is.length === 1 && value !== undefined) {\n        obj[is[0]] = value;\n        return value;\n    } else if (is.length === 0) {\n        return obj;\n    } else if (obj[is[0]] !== undefined) {\n        return index(obj[is[0]], is.slice(1), value);\n    } else {\n        // was unable to reach via selector\n    }\n}\n\n// export function dateFormat(format, datetime) {\n//     return $.datepicker ? $.datepicker.formatDate(format, datetime) : datetime;\n// }\n\nexport function log(...args: unknown[]) {\n    if (process.env.NODE_ENV !== 'production') {\n        console.debug.apply(console, args);\n    }\n}\n\nexport function isVisible(elm: Element) {\n    const vpH = $(window).height(); // Viewport Height\n    const st = $(window).scrollTop(); // Scroll Top\n    const $elm = $(elm);\n    const offset= $elm.offset();\n    const elementHeight = $elm.height();\n\n    if (offset !== undefined && vpH !== undefined && st !== undefined && elementHeight !== undefined) {\n        const y = offset.top;\n        return ((y < (vpH + st)) && (y > (st - elementHeight)));\n    }\n}\n\n// http://stackoverflow.com/a/32533637/1189421\n// Object deduping / boxed value is not supported.\nexport function dedupeArray(vals: any[]): unknown[] | null {\n    if (vals) {\n        return vals.sort().reduce((a, b) => {\n            if (b !== a[0]) {\n                a.unshift(b);\n            }\n            return a;\n        }, []);\n    } else {\n        return null;\n    }\n}\n\n// Access global state\nexport function getFancyDepsRoot() {\n    window[__KEY__] = window[__KEY__] || {};\n    return window[__KEY__];\n}\n\n// eitherFancy('jQuery', $ => $(...)); -> $(...)\nexport function eitherFancy(namespace: string, doWith = (Deps: any) => Deps) /*:object? */{\n    if (window[__KEY__]) {\n        if (window[__KEY__][namespace]) {\n            return doWith(window[__KEY__][namespace]);\n        }\n    } else {\n        getFancyDepsRoot();\n    }\n    return null;\n}\n\nexport function didClickOn($targ: JQuery, selector: string) {\n    return $targ.parents(selector).length > 0 ||\n           $targ.is(selector);\n}\n\nexport const xmlUtil = {\n    isSuccess(xml: string) {\n        const sc = $(xml).find(\"status_code\");\n        return sc.length > 0 && sc.text() === '1';\n    },\n    isFail(xml: string) {\n        const sc = $(xml).find(\"status_code\");\n        return sc.length > 0 && sc.text() === '0';\n    }\n};\n\nexport function MP(...args: unknown[]) {\n    if (process.env.NODE_ENV === 'production') {\n        window.track_event && window.track_event(...args)\n    }\n}\n\n// ?a=1 -> ['a', '1']\nexport function getLocationArgPairs(key: string, originalArgStr:string=location.search) {\n    const argStr = originalArgStr.substr(1, originalArgStr.length);\n    if (argStr) {\n        const args = argStr.split('&').map(e => e.split('='));\n        if (key) {\n            let ret;\n            args.some(argPair => {\n                if (argPair[0] === key) {\n                    ret = argPair;\n                }\n            });\n            if (ret) {\n                return ret;\n            }\n        } else {\n            return args;\n        }\n    }\n}\n\nexport function formatDuration(value: string | number) {\n    if (value == null) {\n        // console.warn('formatDuration: undefined value', value)\n        return '00:00';\n    }\n    const val = Number(value);\n    if (_.isNaN(val)) {\n        // console.warn('formatDuration: value causing NaN', value)\n        return '00:00';\n    }\n    const remainder = (val % 3600) | 0;\n    const minutes = (remainder / 60) | 0;\n    const seconds = (remainder % 60) | 0;\n    return `${zfill(String(minutes), 2)}:${zfill(String(seconds), 2)}`;\n}\n\nexport function minmax(value: number, lb: number, ub: number) {\n    return Math.max(Math.min(value, ub), lb);\n}\n\nexport { openPopup, closePopup, renderPopup } from './PopupHelper';\nexport { cdnUtils, schemeless } from './CDNUtils';\n\nexport function mergeObjectArgs(args: unknown[]) {\n    return args.reduce((p, n)=> $.extend(true, p, n), null);\n}\n\n\nfunction closestUntil(startingElement: Element | null, targetElement : Element | null): Element | null {\n    let start = startingElement;\n    while (start != null) {\n        if (start === targetElement) return targetElement;\n        if (start === document.body || start === document.documentElement) {\n            return null;\n        }\n        start = start.parentElement;\n    }\n    return null;\n}\n\nexport class ClickOutside {\n    eventKey: string = '';\n    component?: import('react').Component = undefined;\n    popupElementRefKey: string = '';\n\n    constructor({ component, popupElementRefKey = 'popupElement' } : { component: import('react').Component, popupElementRefKey: string }) {\n        const key = Math.random().toString().substr(2, 8);\n        this.eventKey = \"click.attachClickOutside\" + key;\n        this.component = component;\n        this.popupElementRefKey = popupElementRefKey;\n    }\n\n    attached = false;\n    handleAttach = (closePopupFunction: Function) => {\n        if (this.attached || closePopupFunction == null) {\n            return;\n        }\n        const { component, eventKey, handleDetach, popupElementRefKey } = this;\n        $(document.body).on(eventKey, function(event: JQueryOldTriggeredEvent) {\n            if (!event.isTrigger &&\n                $.contains(document.body, event.target) && // check if element exists on DOM\n                closestUntil(event.target, component[popupElementRefKey]) === null // is target element exist below popup element?\n            ) {\n                closePopupFunction(component);\n                handleDetach();\n            }\n        });\n        this.attached = true;\n    }\n\n    handleDetach = () => {\n        $(document.body).off(this.eventKey);\n        this.attached = false;\n    }\n\n    destroy() {\n        delete this.component;\n        this.handleDetach();\n    }\n}\n\nexport { copyToClipboard } from './CopyToClipboard'\n\nexport function isClipboardSupported() : boolean {\n    return document.queryCommandSupported != null && document.queryCommandSupported('copy');\n}\n\nfunction isSaleResponse(sales: SalesResponse[]) : sales is SalesResponse[] {\n    return sales != null && sales[0] != null;\n}\n\n// Adapt server response (thing.to_v1 -> rest API)\nexport function convertThingsV1ToRest(things: ThingV1Response[]): ThingObject[] {\n    return things.map((thing: ThingV1Response) => {\n        const converted: ThingObject = Object.assign({\n            sales_available: false,\n            id: thing.id_str,\n            name: thing.name,\n            fancyd: thing[\"fancy'd\"],\n            thumb_image_url_310: thing.thumb_image_url_310,\n            thumb_image_url_558: thing.thumb_image_url_558,\n            fancyd_count: thing.fancys,\n            image: {\n                src: thing.image_url,\n                width: thing.image_url_width,\n                height: thing.image_url_height\n            },\n            owner: thing.user,\n            html_url: window.parseURL(thing.url).pathname,\n            fancyd_users: thing.fancyd_users,\n            sales: thing.sales,\n        }, thing);\n\n        const { sales } = thing;\n        if (isSaleResponse(sales)) {\n            const sales: SalesResponse = thing.sales[0];\n            if (sales.id == null && sales.sale_id != null) {\n                sales.id = sales.sale_id\n            }\n            // converted.sales.waiting = sales.waiting;\n            converted.sales = sales;\n            converted.sales.quantity = sales.remaining_quantity;\n            converted.sales.price = sales.fancy_price;\n            converted.sales_available = sales.available_for_sale;\n        } else {\n            converted.sales = null;\n        }\n\n        // Flag for cache\n        converted.isCrawled = true;\n        return converted;\n    });\n}\nexport function isElementOutsideViewport(element: Element, excludingElement: { element: Element, type: string }) {\n    let elementRect = element.getBoundingClientRect();\n    let upperBound = 0;\n    let leftBound = 0;\n    if (excludingElement) {\n        const { element, type } = excludingElement;\n        if(element){\n            const exclusionRect = element.getBoundingClientRect();\n            if (type === 'top') {\n                upperBound = exclusionRect.bottom; // exclusion on top of el (header, etc)\n            } else if (type === 'left') {\n                leftBound = exclusionRect.right; // exclusion on left of el (sidebar, etc)\n            } // right, bottom is TODO\n        }\n    }\n    const html = document.documentElement\n    const lowerBound = window.innerHeight || html.clientHeight\n    const rightBound = window.innerWidth || html.clientWidth\n    const { bottom, top, left, right } = elementRect\n\n    return (\n        (top <= upperBound && bottom <= upperBound) ||\n        (top >= lowerBound && bottom >= upperBound) ||\n        (left <= leftBound && right <= leftBound) ||\n        (left >= rightBound && right >= rightBound)\n    );\n}\n\nlet _FancyUser : FancyUserConfig = {\n    loggedIn: false,\n    merchant: false,\n    id: null,\n};\n\nif (window.__FancyUser) {\n    Object.assign(_FancyUser, window.__FancyUser);\n}\nexport const FancyUser = _FancyUser;\n\nconst locationHostname = `${location.protocol}//${location.hostname}`\nexport function stripPathname(href: string) {\n    const sp = href.split(locationHostname)\n    return sp.length > 1 ? sp[1] : sp[0]\n}\n\n// https://gist.github.com/ijy/6094414\nexport function cartesianProductOf(...args) {\n    return _.reduce(args, (a, b) => {\n        return _.flatten(_.map(a, (x) => {\n            return _.map(b, (y) => {\n                return x.concat([y]);\n            });\n        }), true);\n    }, [ [] ]);\n}\n\nexport function jQueryPromiseAll(arrayOfPromises: Array<Promise<unknown>>) {\n    return jQuery.when.apply(jQuery, arrayOfPromises).then(function() {\n        return Array.prototype.slice.call(arguments, 0);\n    });\n}\n\nconst _loaded = {};\nexport function loadCss(AppName: string) {\n    const B = window.Bundle;\n    if (_loaded[AppName]) {\n        return;\n    }\n    if (B && B.cssToLoad && B.cssToLoad[AppName] && B.cssToLoad[AppName].length > 0) {\n        while (B.cssToLoad[AppName].length > 0) {\n            const nextUrl = B.cssToLoad[AppName].pop();\n            $(document.head).append(`<link href=\"${nextUrl}\" rel=\"stylesheet\">`);\n            _loaded[AppName] = true;\n        }\n    }\n}\n\nconst _alertify = window.alertify || {\n    alert(...args: unknown[]) { window.alert(...args); },\n    prompt(message: string, fn?: Function | undefined, placeholder?: string | undefined, cssClass?: string | undefined) {\n        if (fn) {\n            let msg : string | undefined | null;\n            if (placeholder) {\n                msg = window.prompt(message, placeholder)\n            } else {\n                msg = window.prompt(message)\n            }\n            if (msg === null) {\n                fn(false);\n            } else {\n                fn(true, msg);\n            }\n        } \n    },\n    confirm(message: string, fn?: Function | undefined, cssClass?: string | undefined) {\n        if (fn) {\n            fn(window.confirm(message));\n        }\n    },\n    set: function() {},\n    labels: { ok: 'OK', cancel: 'Cancel' },\n};\nexport const alertify = _alertify;\n\n// https://code.jquery.com/jquery-3.3.1.js\nexport function escapeSelector(sel: string) { // $.escapeSelector()\n    var rcssescape = /([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\0-\\x1f\\x7f-\\uFFFF\\w-]/g;\n    var fcssescape = function(ch: string, asCodePoint: boolean) {\n        if (asCodePoint) {\n            // U+0000 NULL becomes U+FFFD REPLACEMENT CHARACTER\n            if (ch === \"\\0\") {\n                return \"\\uFFFD\";\n            }\n            // Control characters and (dependent upon position) numbers get escaped as code points\n            return ch.slice(0, -1) + \"\\\\\" + ch.charCodeAt(ch.length - 1).toString(16) + \" \";\n        }\n        // Other potentially-special ASCII characters get backslash-escaped\n        return \"\\\\\" + ch;\n    };\n\n    return (sel + '').replace(rcssescape, fcssescape);\n};\n\nlet isSafari_cac : undefined | boolean;\nexport const isSafari = () => {\n    if (isSafari_cac === undefined) {\n        isSafari_cac = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n    }\n    return isSafari_cac;\n};\n","import ReactDOM from 'react-dom';\nimport React from 'react';\nimport { selectOrCreate } from './FancyUtils';\n\n\nfunction selectPopup(popupName) {\n    if ($(`#popup_container .${popupName}`).length > 0) {\n        if (popupName) {\n            return $.dialog(popupName);\n        }\n    }\n    return null;\n}\n\nexport function openPopup(popupName, bindOverlayData = true) {\n    const popup = selectPopup(popupName);\n    if (popup) {\n        if (bindOverlayData) {\n            popup.$obj.data('via-overlay', true);\n            popup.$obj.one('close', function() {\n                $(this).data('via-overlay', false);\n            });\n        }\n        popup.open();\n    }\n}\n\nexport function closePopup(popupName) {\n    const popup = selectPopup(popupName);\n    if (popup) {\n        popup.$obj.data('via-overlay', false);\n        popup.close();\n    }\n}\n\nconst popupContainer = document.getElementById('popup_container');\nexport function renderPopup(PopupComponent, attrs, callback) {\n    // unless `attrs.openOnMount` is explicitly set as `false` and callback is set, it will open right after mount.\n    attrs = attrs || {};\n    if (attrs.openOnMount !== false && callback == null) {\n        callback = function () {\n            openPopup(PopupComponent.popupName);\n        };\n    }\n\n    if (!PopupComponent.popupName) {\n        console.warn(`renderPopup: Please set \\`popupName\\` property of ${PopupComponent.name}`);\n    }\n    return ReactDOM.render(\n        <PopupComponent {...attrs} />,\n        selectOrCreate(`.popup.${PopupComponent.popupName || ''}`, popupContainer),\n        callback\n    );\n}\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\n\nimport { KEYS, MP, getDisplay, isEmpty, alertify } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\n\nexport class AddlistAction extends Component {\n    state = {\n        lists: [],\n        wanted: false,\n        listSearchQuery: \"\",\n        listCreationQuery: \"\",\n        createListFocused: false,\n        showList: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    drawUserList(objectId) {\n        objectId = objectId || this.props.objectId;\n        getListCheckbox({\n            merchantId: this.props.merchantId,\n            objectId,\n            callback: (res) => {\n                this.setStateSafe(res);\n            },\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setStateSafe({ listSearchQuery });\n    };\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (event.type === \"keyup\" && event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId, objectType, merchantId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        // save new list\n        createList({\n            merchantId,\n            listCreationQuery,\n            callback: () => {\n                this.setStateSafe({ listCreationQuery: \"\" }, () => {\n                    this.drawUserList(objectId);\n                    this.quickCreateList.focus();\n                    if (objectType === \"thing\") {\n                        MP(\"Create New List\", {\n                            \"thing id\": objectId,\n                            \"list name\": listCreationQuery,\n                            via: \"thing detail\",\n                        });\n                    }\n                });\n            },\n        });\n    };\n\n    handleWishlistCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectType, objectId, handleHide } = this.props;\n        const name = \"wanted\";\n        const params = { owned: false, wanted: targ.checked };\n        const eventName = targ.checked ? \"Add to List\" : \"Remove from List\";\n\n        if (objectType === \"thing\") {\n            if (params.wanted && window.dataLayer) {\n                window.dataLayer.push({\n                    event: \"Add_to_Wishlist_Check\",\n                    product_id: undefined,\n                    products_info: undefined,\n                    products: undefined,\n                    revenue: undefined,\n                    option_id: undefined,\n                });\n            }\n\n            $.ajax(`/rest-api/v1/things/${objectId}`, { type: \"PUT\", data: params })\n                .done(() => {\n                    this.drawUserList(objectId);\n                    this.setStateSafe({ wanted: params.wanted });\n                    if (params.wanted) {\n                        handleHide && handleHide();\n                    }\n                })\n                .error((err) => {\n                    console.warn(err);\n                });\n\n            MP(eventName, { \"thing id\": objectId, \"list name\": name, \"list id\": -1, via: \"thing detail\" });\n        } else {\n            console.warn(\"Add to list does not work with non-thing type\");\n            return;\n        }\n    };\n\n    handleListCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const isChecked = targ.checked;\n        const { objectId, objectType, handleHide, merchantId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = targ.getAttribute(\"data-listid\");\n        const collectionAction = [Number(selectedListId), targ.checked];\n\n        if (objectType === \"thing\") {\n            const eventName = isChecked ? \"Add to List\" : \"Remove from List\";\n            const theList = lists.filter((list) => list.id === selectedListId)[0];\n            const callback = () => {\n                this.drawUserList(objectId);\n                if (isChecked) {\n                    handleHide && handleHide();\n                }\n                MP(eventName, {\n                    \"thing id\": objectId,\n                    \"list name\": theList.name,\n                    \"list id\": theList.id,\n                    via: \"thing detail\",\n                });\n            };\n\n            if (merchantId) {\n                updateList({ merchantId, objectId, collectionAction, callback });\n            } else {\n                const checked = [];\n                const unchecked = [];\n                $(this.lists)\n                    .find('input[type=\"checkbox\"]:not(.tag)')\n                    .each(function () {\n                        const listId = this.getAttribute(\"data-listid\");\n                        if (this.checked) {\n                            checked.push(listId);\n                        } else {\n                            unchecked.push(listId);\n                        }\n                    });\n                updateList({ checked, unchecked, objectId, callback });\n            }\n        } else {\n            console.warn(\"Add to list does not work with non-thing type\");\n            return;\n        }\n    };\n\n    isWishlistQuery(listSearchQuery) {\n        return \"wishlist\".indexOf($.trim(listSearchQuery).toLowerCase()) !== -1;\n    }\n\n    handleCreateListLabelClick = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setStateSafe({ createListFocused: true }, () => {\n            this.quickCreateList.focus();\n        });\n    };\n\n    handleCreateListBlur = () => {\n        this.setStateSafe({ createListFocused: false });\n    };\n\n    handleCreateListQueryChange = (event) => {\n        this.setStateSafe({ listCreationQuery: event.target.value });\n    };\n\n    componentDidMount() {\n        this.mounted = true;\n        this.listDrawn = false;\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n    }\n\n    componentDidUpdate(pp, ps) {\n        if ((ps.showList !== this.state.showList || this.listDrawn === false) && this.state.showList === true) {\n            if (this.listDrawn === false) {\n                this.listDrawn = true;\n            }\n            this.drawUserList(this.props.objectId);\n            setTimeout(() => {\n                this.listSearchInput.focus();\n            }, 0);\n        }\n    }\n\n    show() {\n        this.setStateSafe({ showList: true });\n    }\n\n    hide() {\n        this.setStateSafe({ showList: false });\n    }\n\n    render() {\n        var { objectId, merchantId } = this.props;\n        var { lists, wanted, listSearchQuery, listCreationQuery, createListFocused, showList } = this.state;\n\n        return (\n            <div id=\"show-addlist\" className=\"has-arrow more-share-popup addlist-action\" style={getDisplay(showList)}>\n                <span className=\"tit\">{merchantId ? gettext(\"Add to Collection\") : gettext(\"Add to List\")}</span>\n                <span className=\"search before-bg-share2\">\n                    <input\n                        ref={(element) => {\n                            this.listSearchInput = element;\n                        }}\n                        type=\"text\"\n                        className=\"text\"\n                        placeholder={merchantId ? gettext(\"Search your collections\") : gettext(\"Search your lists\")}\n                        value={listSearchQuery}\n                        onChange={this.handleListSearch}\n                    />\n                </span>\n                <ul\n                    className=\"lists\"\n                    ref={(element) => {\n                        this.lists = element;\n                    }}>\n                    {!merchantId && (\n                        <li>\n                            <label htmlFor={`wanted-${objectId}`}>\n                                <input\n                                    type=\"checkbox\"\n                                    name=\"wanted\"\n                                    checked={wanted}\n                                    id={`wanted-${objectId}`}\n                                    className={`tag ${wanted ? \"checked\" : \"\"}`}\n                                    style={{ display: this.isWishlistQuery(listSearchQuery) ? null : \"none\" }}\n                                    onChange={this.handleWishlistCheckboxChange}\n                                />{\" \"}\n                                {gettext(\"Wish List\")}\n                            </label>\n                        </li>\n                    )}\n                    {lists &&\n                        lists.map((list, idx) => {\n                            const term = $.trim(listSearchQuery).toLowerCase();\n                            var style;\n                            if (_.isString(term) && term.length > 0) {\n                                style = Display.NoneIf(list.name.toLowerCase().indexOf(term.toLowerCase()) === -1);\n                            }\n                            const className = list.selected ? \"selected\" : null;\n                            const ident = `${objectId}-${list.id}`;\n                            return (\n                                <li key={idx} style={style}>\n                                    <label htmlFor={ident}>\n                                        <input\n                                            className={className}\n                                            type=\"checkbox\"\n                                            name={ident}\n                                            id={ident}\n                                            checked={list.selected}\n                                            data-listid={list.id}\n                                            onChange={this.handleListCheckboxChange}\n                                        />{\" \"}\n                                        {list.name}\n                                    </label>\n                                </li>\n                            );\n                        })}\n                </ul>\n                <div className=\"new-list\">\n                    <label\n                        htmlFor=\"quick-create-list\"\n                        style={{ display: createListFocused ? \"none\" : \"block\" }}\n                        onClick={this.handleCreateListLabelClick}>\n                        <i className=\"icon\" />\n                        {merchantId ? gettext(\"Create New Collection\") : gettext(\"Create New List\")}\n                    </label>\n                    <input\n                        type=\"text\"\n                        id=\"quick-create-list\"\n                        ref={(element) => {\n                            this.quickCreateList = element;\n                        }}\n                        onBlur={this.handleCreateListBlur}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}\n                        placeholder={merchantId ? gettext(\"Create New Collection\") : gettext(\"Create New List\")}\n                    />\n                    <button className=\"btn-create\" onClick={this.handleListCreation}>\n                        {gettext(\"Create\")}\n                    </button>\n                </div>\n            </div>\n        );\n    }\n}\n\nfunction getListCheckbox({ merchantId, objectId, callback }) {\n    if (merchantId) {\n        $.get(`/rest-api/v1/seller/${merchantId}/collections`, { selected_object_id: objectId })\n            .done(({ collections } = {}) => {\n                let lists;\n                if (collections.length > 0) {\n                    lists = collections\n                        .sort((a, b) => {\n                            var aText = $.trim(a).toLowerCase();\n                            var bText = $.trim(b).toLowerCase();\n                            return aText < bText ? -1 : 1;\n                        })\n                        .map(({ id, name, selected }) => {\n                            return {\n                                id,\n                                name,\n                                selected,\n                            };\n                        });\n                } else {\n                    lists = [];\n                }\n                callback && callback({ lists, wanted: null });\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    } else {\n        $.get(\"/_get_list_checkbox.html\", { tid: objectId })\n            .done((html) => {\n                const $html = $(html);\n                const $items = $html.filter(\"li\").find(\"img\").remove().end();\n                var lists;\n                if ($items.length > 0) {\n                    lists = $items\n                        .sort((a, b) => {\n                            var aText = $.trim($(a).text()).toLowerCase();\n                            var bText = $.trim($(b).text()).toLowerCase();\n                            return aText < bText ? -1 : 1;\n                        })\n                        .map((_, item) => {\n                            var $item = $(item);\n                            return {\n                                id: $item.find(\"label\").attr(\"for\"),\n                                name: $.trim($item.find(\"label\").text()),\n                                selected: $item.find(\"input\").prop(\"checked\"),\n                            };\n                        })\n                        .get();\n                } else {\n                    lists = [];\n                }\n                const wanted = $html.filter('input[name=\"wanted\"]').val() === \"true\";\n                callback && callback({ lists, wanted });\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    }\n}\n\nfunction createList({ merchantId, listCreationQuery, callback }) {\n    if (merchantId) {\n        $.post(`/rest-api/v1/seller/${merchantId}/collections`, { list_name: listCreationQuery })\n            .done((res) => {\n                // if ($(res).find(\"created\").text() == 'False') {\n                // if (false){\n                //     alertify.alert(`List Title Not Available`, `There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                // } else {\n                callback && callback();\n                // }\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    } else {\n        $.post(\"/create_list.xml\", { list_name: listCreationQuery, reaction: 0 })\n            .done((res) => {\n                if ($(res).find(\"created\").text() == \"False\") {\n                    alertify.alert(\n                        `<b>List Title Not Available</b><br><br>There is already a list named ${listCreationQuery}. Try again with a different name.`\n                    );\n                } else {\n                    callback && callback();\n                }\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    }\n}\n\nfunction updateList({ merchantId, collectionAction, objectId, checked, unchecked, callback }) {\n    if (merchantId) {\n        const [collectionId, add] = collectionAction;\n        $.ajax({\n            url: `/rest-api/v1/seller/${merchantId}/collections/${collectionId}`,\n            type: \"POST\",\n            data: {\n                object_id: objectId,\n                action: add ? \"add\" : \"remove\",\n            },\n        })\n            .done(callback)\n            .error((err) => {\n                console.warn(err);\n            });\n    } else {\n        $.post(\"/save_list_items\", {\n            tid: objectId,\n            checked_list_ids: checked.join(\",\"),\n            unchecked_list_ids: unchecked.join(\",\"),\n        })\n            .done(callback)\n            .error((err) => {\n                console.warn(err);\n            });\n    }\n}\n","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { KEYS, MP, getDisplay, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\n\nexport class AddlistPopover extends Component {\n    state = {\n        lists: [],\n        wanted: false,\n        listSearchQuery: '',\n        listCreationQuery: '',\n        createListFocused: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    drawUserList(objectId) {\n        objectId = objectId || this.props.objectId;\n        getListCheckbox({\n            merchantId: this.props.merchantId,\n            objectId,\n            callback: res => { this.setStateSafe(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setStateSafe({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId, objectType, merchantId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        // save new list\n        createList({\n            merchantId,\n            listCreationQuery,\n            callback: () => {\n                this.setStateSafe({ listCreationQuery: '' }, () => {\n                    this.drawUserList(objectId);\n                    this.quickCreateList.focus();\n                    if (objectType === 'thing') {\n                        MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    }\n                })\n            }\n        })\n    }\n\n    handleWishlistCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectType, objectId, handleHide } = this.props;\n        const name = 'wanted';\n        const params = { owned: false, wanted: targ.checked };\n        const eventName = targ.checked ? \"Add to List\" : \"Remove from List\";\n\n        if (objectType === 'thing') {\n            if (params.wanted && window.dataLayer) {\n                window.dataLayer.push({'event': 'Add_to_Wishlist_Check', 'product_id': undefined, 'products_info': undefined, 'products': undefined, 'revenue': undefined, 'option_id': undefined });\n            }\n\n            $.ajax(`/rest-api/v1/things/${objectId}`, { type:'PUT', data: params })\n                .done(() => {\n                    this.drawUserList(objectId);\n                    this.setStateSafe({ wanted: params.wanted });\n                    if (params.wanted) {\n                        handleHide && handleHide();\n                    }\n                })\n                .error(err => { console.warn(err); });\n\n            MP(eventName, { 'thing id': objectId, 'list name': name, 'list id': -1, 'via': 'thing detail' });\n        } else {\n            console.warn('Add to list does not work with non-thing type')\n            return;\n        }\n    }\n\n    handleListCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const isChecked = targ.checked;\n        const { objectId, objectType, handleHide, merchantId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = targ.getAttribute('data-listid')\n        const collectionAction = [Number(selectedListId), targ.checked]\n\n        if (objectType === 'thing') {\n            const eventName = isChecked ? \"Add to List\" : \"Remove from List\";\n            const theList = lists.filter(list => list.id === selectedListId)[0];\n            const callback = () => {\n                this.drawUserList(objectId);\n                if (isChecked) {\n                    handleHide && handleHide();\n                }\n                MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n            };\n\n            if (merchantId) {\n                updateList({ merchantId, objectId, collectionAction, callback })\n            } else {\n                const checked = [];\n                const unchecked = [];\n                $(this.lists).find('input[type=\"checkbox\"]:not(.tag)').each(function() {\n                    const listId = this.getAttribute('data-listid');\n                    if (this.checked) {\n                        checked.push(listId);\n                    } else {\n                        unchecked.push(listId)\n                    }\n                });\n                updateList({ checked, unchecked, objectId, callback })\n            }\n\n        } else {\n            console.warn('Add to list does not work with non-thing type')\n            return;\n        }\n    }\n\n    isWishlistQuery(listSearchQuery) {\n        return 'wishlist'.indexOf($.trim(listSearchQuery).toLowerCase()) !== -1\n    }\n\n    handleCreateListLabelClick = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setStateSafe({ createListFocused: true }, () => {\n            this.quickCreateList.focus();\n        });\n    }\n\n    handleCreateListBlur = () => {\n        this.setStateSafe({ createListFocused: false });\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setStateSafe({ listCreationQuery: event.target.value });\n    }\n\n    componentDidMount() {\n        this.mounted = true;\n        this.listDrawn = false;\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n    }\n\n    componentDidUpdate(pp) {\n        if (\n            (pp.showList !== this.props.showList || this.listDrawn === false) &&\n            this.props.showList === true\n        ) {\n            if (this.listDrawn === false) {\n                this.listDrawn = true\n            }\n            this.drawUserList(this.props.objectId);\n            setTimeout(() => {\n                this.listSearchInput.focus();\n            }, 0);\n        }\n    }\n\n    render() {\n        var { objectId, showList, headerGap, merchantId } = this.props;\n        var {\n            lists,\n            wanted,\n            listSearchQuery,\n            listCreationQuery,\n            createListFocused\n        } = this.state;\n\n        return (\n            <div id=\"show-addlist\" className={classnames(\"has-arrow more-share-popup\", { bot: headerGap && (headerGap < 16 + 269) /*= tip + bubble*/ })}\n                 style={getDisplay(showList)}>\n                <span className=\"tit\">{merchantId ? gettext(\"Add to Collection\") : gettext(\"Add to List\")}</span>\n                <span className=\"search before-bg-share2\">\n                    <input ref={(element) => {this.listSearchInput = element;}}\n                            type=\"text\"\n                            className=\"text\"\n                            placeholder={merchantId ? gettext('Search your collections') : gettext('Search your lists')}\n                            value={listSearchQuery}\n                            onChange={this.handleListSearch} />\n                </span>\n                <ul className=\"lists\" ref={(element) => {this.lists = element;}}>\n                    {!merchantId && <li>\n                        <label htmlFor={`wanted-${objectId}`}>\n                            <input type=\"checkbox\" name=\"wanted\"\n                                   checked={wanted}\n                                   id={`wanted-${objectId}`}\n                                   className={`tag ${wanted ? 'checked' : ''}`}\n                                   style={{ display: this.isWishlistQuery(listSearchQuery) ? null : 'none' }}\n                                   onChange={this.handleWishlistCheckboxChange} /> {gettext('Wish List')}</label>\n                    </li>}\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const className = list.selected ? \"selected\" : null;\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style}>\n                                <label htmlFor={ident}>\n                                    <input className={className}\n                                           type=\"checkbox\" name={ident} id={ident}\n                                           checked={list.selected}\n                                           data-listid={list.id}\n                                           onChange={this.handleListCheckboxChange} /> {list.name}</label>\n                            </li>\n                        )\n                    })}\n                </ul>\n                <div className=\"new-list\">\n                    <label htmlFor=\"quick-create-list\"\n                            style={{ display: createListFocused ? 'none' : 'block' }}\n                            onClick={this.handleCreateListLabelClick}>\n                        <i className=\"icon\" />{merchantId ? gettext('Create New Collection') : gettext(\"Create New List\")}</label>\n                    <input type=\"text\"\n                            id=\"quick-create-list\"\n                            ref={(element) => {this.quickCreateList = element;}}\n                            onBlur={this.handleCreateListBlur}\n                            onKeyUp={this.handleListCreation}\n                            onChange={this.handleCreateListQueryChange}\n                            value={listCreationQuery}\n                            placeholder={merchantId ? gettext('Create New Collection') : gettext(\"Create New List\")} />\n                    <button className=\"btn-create\"\n                            onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </div>\n            </div>\n        );\n    }\n}\n\nfunction getListCheckbox({ merchantId, objectId, callback }) {\n    if (merchantId) {\n        $.get(`/rest-api/v1/seller/${merchantId}/collections`, { selected_object_id: objectId }).done(({ collections } = {}) => {\n            let lists;\n            if (collections.length > 0) {\n                lists = collections.sort((a, b) => {\n                    var aText = $.trim(a).toLowerCase();\n                    var bText = $.trim(b).toLowerCase();\n                    return aText < bText ? -1 : 1;\n                }).map(({ id, name, selected }) => {\n                    return {\n                        id,\n                        name,\n                        selected\n                    };\n                })\n            } else {\n                lists = [];\n            }\n            callback && callback({ lists, wanted: null });\n        })\n        .error(err => { console.warn(err); });\n    } else {\n        $.get('/_get_list_checkbox.html', { tid: objectId }).done(html => {\n            const $html = $(html);\n            const $items = $html.filter('li').find('img').remove().end();\n            var lists;\n            if ($items.length > 0) {\n                lists = $items.sort((a, b) => {\n                    var aText = $.trim($(a).text()).toLowerCase();\n                    var bText = $.trim($(b).text()).toLowerCase();\n                    return aText < bText ? -1 : 1;\n                }).map((_, item) => {\n                    var $item = $(item);\n                    return {\n                        id: $item.find('label').attr('for'),\n                        name: $.trim($item.find('label').text()),\n                        selected: $item.find('input').prop('checked'),\n                    };\n                }).get();\n            } else {\n                lists = [];\n            }\n            const wanted = $html.filter('input[name=\"wanted\"]').val() === 'true';\n            callback && callback({ lists, wanted });\n        })\n        .error(err => { console.warn(err); });\n    }\n}\n\n\nfunction createList({ merchantId, listCreationQuery, callback }) {\n    if (merchantId) {\n        $.post(`/rest-api/v1/seller/${merchantId}/collections`, { list_name: listCreationQuery })\n            .done(res => {\n                // if ($(res).find(\"created\").text() == 'False') {\n                // if (false){\n                //     alertify.alert(`List Title Not Available`, `There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                // } else {\n                    callback && callback();\n                // }\n            })\n            .error(err => { console.warn(err); });\n    } else {\n        $.post('/create_list.xml', { list_name: listCreationQuery, reaction: 0 })\n            .done(res => {\n                if ($(res).find(\"created\").text() == 'False') {\n                    alertify.alert(`<b>List Title Not Available</b><br><br>There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                } else {\n                    callback && callback();\n                }\n            })\n            .error(err => { console.warn(err); });\n    }\n}\n\nfunction updateList({ merchantId, collectionAction, objectId, checked, unchecked, callback }) {\n    if (merchantId) {\n        const [collectionId, add] = collectionAction\n        $.ajax({\n            url: `/rest-api/v1/seller/${merchantId}/collections/${collectionId}`,\n            type: 'POST',\n            data: {\n                object_id: objectId,\n                action: add ? 'add': 'remove',\n            },\n        })\n        .done(callback)\n        .error(err => { console.warn(err); })\n    } else {\n        $.post('/save_list_items', {\n            tid: objectId,\n            checked_list_ids: checked.join(','),\n            unchecked_list_ids: unchecked.join(',')\n        })\n        .done(callback)\n        .error(err => { console.warn(err); })\n    }\n}\n","import createHistory from \"history/createBrowserHistory\";\n\nexport const history = createHistory()\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { renderPopup, copyToClipboard, isElementOutsideViewport, MP, ClickOutside, FancyUser } from \"fancyutils\";\nimport { getElementGapFromHeader } from \"fancymixin\";\n\nimport { SharePopover } from \"./SharePopover\";\nimport { AddlistPopover } from \"./AddlistPopover\";\nimport { ShareObjectTypes, getShareURL } from \"./MoreShareUtils\";\nimport { FancydByPopup } from \"./Popup\";\n\n// returns dictionary with only one value true and else is false\nfunction makeToggle(keys) {\n    const obj = {};\n    return function toggle(...toggleKeys) {\n        keys.forEach(key => {\n            obj[key] = false;\n        });\n        if (toggleKeys) {\n            toggleKeys.forEach(key => {\n                obj[key] = true;\n            });\n        }\n        return obj;\n    };\n}\nconst toggleShow = makeToggle([\"showShare\", \"showList\", \"showSellerList\", \"showMenu\"]);\n\n\n\nexport class MoreShare extends Component {\n    state = {\n        showShare: false,\n        showList: false,\n        showMenu: false,\n        headerGap: null,\n\n        referrerURL: null,\n        linkCopied: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    componentDidMount() {\n        this.mounted = true;\n        this.clickOutside = new ClickOutside({ component: this, popupElementRefKey: \"MoreShareEl\" });\n        \n        if (this.props.facadeShowShare) {\n            this.handleShareDisplay();\n        }\n        if (this.props.facadeShowList) {\n            this.handleMoreShareToggle();\n        }\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n        this.clickOutside.destroy();\n    }\n\n    componentDidUpdate(pp, ps) {\n        const ns = this.state;\n        const { showList, showShare, showMenu } = ns;\n        if (showList || showShare || showMenu) {\n            this.clickOutside.handleAttach(this.closePopup);\n            this.checkViewport();\n\n            if (showShare || showMenu) {\n                getShareURL(this);\n            }\n        }\n\n        if (ns.showMenu !== ps.showMenu && ns.showMenu === false) {\n            this.setState({ linkCopied: false });\n            clearTimeout(this.linkCopiedRemovalTimer);\n            this.linkCopiedRemovalTimer = null;\n        }\n    }\n\n    handleShareDisplay = () => {\n        this.setStateSafe(\n            {\n                showShare: !this.state.showShare,\n                showList: false,\n                showMenu: false,\n                headerGap: getElementGapFromHeader(this.moreMenuButton)\n            },\n            this.handleHook\n        );\n        if (this.props.objectType === ShareObjectTypes.thing) {\n            MP(\"Share\", { \"thing id\": this.props.objectId });\n        }\n    };\n\n    handleListDisplay = () => {\n        if (!FancyUser.loggedIn) {\n            this.closePopup();\n            window.require_login();\n            return;\n        }\n        const showList = !this.state.showList;\n        this.setStateSafe(toggleShow(showList ? \"showList\" : null), this.handleHook);\n    };\n\n    handleMerchantListDisplay = () => {\n        if (!FancyUser.loggedIn) {\n            this.closePopup();\n            window.require_login();\n            return;\n        }\n        const showSellerList = !this.state.showSellerList;\n        this.setStateSafe(toggleShow(showSellerList ? \"showSellerList\" : null), this.handleHook);\n    };\n\n    closePopup = () => {\n        this.removeViewportCheck();\n        this.setStateSafe(toggleShow(), this.handleHook);\n    };\n\n    viewPortChecking = false;\n    evtName = \"scrollstop.MoreShare\";\n    checkViewport = () => {\n        if (this.viewPortChecking) {\n            return;\n        }\n        this.viewPortChecking = true;\n        $(window).on(this.evtName, () => {\n            const $root = $(this.MoreShareEl);\n            const headerEl = $(\"#header .header-featured\").get(0);\n\n            const { showMenu, showShare, showList, showSellerList } = this.state;\n            let sel;\n            if (showMenu) {\n                sel = \"#more-menu\";\n            } else if (showShare) {\n                sel = \"#show-share\";\n            } else if (showList || showSellerList) {\n                sel = \"#show-addlist\";\n            }\n            const el = $root.find(sel).get(0);\n            if (el) {\n                const outsideViewport = isElementOutsideViewport(el, { element: headerEl, type: \"top\" });\n\n                if (outsideViewport) {\n                    this.closePopup();\n                }\n            }\n        });\n    };\n\n    removeViewportCheck = () => {\n        this.viewPortChecking = false;\n        $(window).off(this.evtName);\n    };\n\n    handleMoreShareToggle = () => {\n        const { objectType } = this.props;\n        const { showMenu, showShare, showList, showSellerList } = this.state;\n        // thing types will show menu\n        if (objectType === ShareObjectTypes.thing || objectType === ShareObjectTypes.article) {\n            if (showMenu || showShare || showList || showSellerList) {\n                this.closePopup();\n            } else {\n                this.setStateSafe(\n                    {\n                        showMenu: true,\n                        headerGap: getElementGapFromHeader(this.moreMenuButton)\n                    },\n                    this.handleHook\n                );\n            }\n            // non-thing types will show share popover directly, because add-to-list is not available\n        } else {\n            this.handleShareDisplay();\n        }\n        return false;\n    };\n\n    handleHook = () => {\n        if (this.props.onShowSomething) {\n            const { showList, showShare, showMenu, showSellerList } = this.state;\n            this.props.onShowSomething(showList || showShare || showMenu || showSellerList, this);\n        }\n    };\n\n    handleHideList = () => {\n        this.setStateSafe({ showList: false });\n    };\n\n    handleHideShare = () => {\n        this.setStateSafe({ showShare: false });\n    };\n\n    linkCopiedRemovalTimer = null;\n    handleCopyLink = () => {\n        if (this.linkCopiedRemovalTimer != null) {\n            return;\n        }\n        copyToClipboard(this.state.referrerURL, {\n            cb: () => {\n                this.setState({ linkCopied: true });\n                this.linkCopiedRemovalTimer = setTimeout(() => {\n                    this.setState({ linkCopied: false });\n                }, 5000);\n            }\n        });\n    };\n\n    handleFancydByDisplay = () => {\n        event.preventDefault();\n        event.stopPropagation();\n        const { viewerUsername, objectId, objectType } = this.props;\n\n        renderPopup(FancydByPopup, { objectId, objectType, loggedIn: FancyUser.loggedIn, viewerId: viewerUsername });\n    };\n\n    shouldShowMerchantCollection() {\n        return FancyUser.merchant && FancyUser.active_merchant;\n    }\n\n    render() {\n        const {\n            title,\n            viewerUsername,\n            componentClass = \"menu-container\",\n            btnClass = \"btn-more\",\n            objectType,\n            objectMeta,\n            objectId,\n            showShortcuts = true,\n            fromThingSidebar = false\n        } = this.props;\n\n        if (objectType == null) {\n            console.warn(\"objectType is not defined\");\n        }\n\n        const {\n            showShare,\n            showList,\n            showMenu,\n            headerGap,\n            referrerURL,\n            linkCopied,\n            showSellerList\n        } = this.state;\n        const isThing = objectType === ShareObjectTypes.thing;\n        const isArticle = objectType === ShareObjectTypes.article;\n\n        let showMerchantList = this.shouldShowMerchantCollection();\n        let merchantId = showMerchantList && showSellerList ? FancyUser.id : null;\n        const newLayout = fromThingSidebar;\n\n        return (\n            <em\n                className={classnames(componentClass, \"on-home ignore-ext\", {\n                    open: showShare || showList || showMenu\n                })}\n                ref={el => {\n                    this.MoreShareEl = el;\n                }}\n                data-rendered=\"true\">\n                {newLayout && <button className=\"btn-share\" onClick={this.handleShareDisplay} />}\n                <small\n                    className={btnClass}\n                    onClick={this.handleMoreShareToggle}\n                    ref={element => {\n                        this.moreMenuButton = element;\n                    }}>\n                    {<em>{SharePopover.getShareMessage(objectType, \"Share & Lists\")}</em>}\n                </small>\n                {(isThing || isArticle) && (\n                    <small\n                        id=\"more-menu\"\n                        className={classnames(\"has-arrow menu-content react new\", {\n                            opened: showMenu,\n                            bot: headerGap && headerGap < 16 + 109 /*= tip + bubble*/\n                        })}>\n                        {!newLayout && (\n                            <button className=\"share before-bg-share2\" onClick={this.handleShareDisplay}>\n                                <b>{gettext(\"Share item\")}</b>\n                                <small>{gettext(\"Share this with friends\")}</small>\n                            </button>\n                        )}\n                        {newLayout && (\n                            <button className=\"fancyd-by before-bg-share2\" onClick={this.handleFancydByDisplay}>\n                                <b>{gettext(\"Fancy'd By\")}</b>\n                                <small>{gettext(\"People who fancy'd this\")}</small>\n                            </button>\n                        )}\n                        {isThing && (\n                            <button className=\"add-list before-bg-share2\" onClick={this.handleListDisplay}>\n                                <b>{gettext(\"Lists\")}</b>\n                                <small>{gettext(\"Add this to your saved lists\")}</small>\n                            </button>\n                        )}\n                        {showMerchantList && (\n                            <button className=\"add-list before-bg-share2\" onClick={this.handleMerchantListDisplay}>\n                                <b>{gettext(\"Add to Collection\")}</b>\n                                <small>{gettext(\"Save this to your collections\")}</small>\n                            </button>\n                        )}\n                        {showShortcuts && (\n                            <span>\n                                <button\n                                    style={referrerURL ? null : { opacity: 0.7 }}\n                                    className={classnames(\"copy-link\")}\n                                    onClick={this.handleCopyLink}>\n                                    <b>{linkCopied ? \"Copied to clipboard\" : \"Item link\"}</b>\n                                    <small>Copy link to clipboard</small>\n                                </button>\n                            </span>\n                        )}\n                    </small>\n                )}\n                {isThing && (\n                    <AddlistPopover\n                        key={`${objectId}-${merchantId}` || `${objectId}-addlist`}\n                        objectType={objectType}\n                        objectId={objectId}\n                        showList={showList || showSellerList}\n                        merchantId={merchantId}\n                        viewerUsername={viewerUsername}\n                        handleHide={this.handleHideList}\n                        headerGap={headerGap}\n                    />\n                )}\n                <SharePopover\n                    objectType={objectType}\n                    objectId={objectId}\n                    objectMeta={objectMeta}\n                    showShare={showShare}\n                    title={title}\n                    referrerURL={this.state.referrerURL}\n                    viewerUsername={viewerUsername}\n                    headerGap={headerGap}\n                    handleHide={this.handleHideShare}\n                />\n            </em>\n        );\n    }\n}\n","import React, { Component } from \"react\";\nimport { MoreShare } from \"common-components\";\n\n\nexport class MoreShareFacade extends Component {\n    state = {\n        share: false,\n        list: false\n    };\n\n    handleClickShare = () => {\n        this.setState({ share: true });\n    };\n\n    handleClickList = () => {\n        this.setState({ list: true });\n    };\n\n    render() {\n        const { share, list } = this.state;\n        return (\n            <React.Fragment>\n                {!(share || list) && (\n                    <FakeMoreShare onClickShare={this.handleClickShare} onClickAddlist={this.handleClickList} />\n                )}\n                {(share || list) && <MoreShare {...this.props} facadeShowShare={share} facadeShowList={list} />}\n            </React.Fragment>\n        );\n    }\n}\n\nclass FakeMoreShare extends Component {\n    render() {\n        return (\n            <em className=\"menu-container on-home ignore-ext\" data-rendered=\"true\">\n                <button className=\"btn-share\" onClick={this.props.onClickShare}></button>\n                <small className=\"btn-more\" onClick={this.props.onClickAddlist}>\n                    <em>Share &amp; Lists</em>\n                </small>\n            </em>\n        );\n    }\n}","export const ShareObjectTypes = {\n    thing: 'thing',\n    list: 'list',\n    store: 'store',\n    user: 'user',\n    article: 'article',\n}\n\nfunction createReferredUrl(viewerUsername, objectId, objectType, objectMeta) {\n    let url;\n    if (objectType === ShareObjectTypes.thing) {\n        url = `https://${location.hostname}/things/${objectId}`;\n    } else if (objectType === ShareObjectTypes.article && objectMeta) {\n        url = `https://${location.hostname}/articles/${objectMeta.slug}`;\n    } else {\n        url = location.href.replace(/(#.*)/, ''); // Remove hash\n    }\n\n    if (viewerUsername) {\n        let connector = ~url.indexOf('?') ? '&' : '?';\n        url = `${url}${connector}ref=${viewerUsername}`\n    }\n\n    return url;\n}\n\nexport function getShareURL(component, callback) {\n    if (component.loading || component.state.referrerURL || component.props.referrerURL) {\n        callback && callback(true);\n        return;\n    }\n    component.loading = true;\n\n    // If async loading is needed, assign setState callback.\n    let cb = null;\n    if (callback) {\n        cb = () => {\n            callback(false);\n            component.loading = false;\n        };\n    }\n    const { viewerUsername, objectId, objectType, objectMeta } = component.props;\n    const originalUrl = createReferredUrl(viewerUsername, objectId, objectType, objectMeta);\n    $.post('/get_short_url.json', { url: originalUrl })\n        .done(res => {\n            component.setState({ referrerURL: res.short_url }, cb);\n        })\n        .fail(() => {\n            component.setState({ referrerURL: originalUrl }, cb);\n            console.warn('/get_short_url failed');\n        });\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\n\nimport { isPlainLeftClick } from \"fancyutils\";\nimport { ShareObjectTypes } from './MoreShareUtils';\n\n\nexport class FancydPerson extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            loading: false,\n            following: false\n        };\n    }\n\n    componentDidMount() {\n        const following = this.props.following || this.props.user.following;\n        if (following) {\n            this.setState({ following });\n        }\n    }\n\n    handleFollow = event => {\n        event.preventDefault();\n        event.stopPropagation();\n\n        const { user } = this.props;\n        const { following, loading } = this.state;\n\n        if (this.props.loggedIn !== true) {\n            window.require_login();\n            return;\n        }\n\n        if (loading) {\n            return;\n        }\n\n        const url = following ? \"/delete_follow.xml\" : \"/add_follow.xml\";\n\n        this.setState({ loading: true }, () => {\n            $.ajax({\n                type: \"post\",\n                url,\n                data: { user_id: user.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    const nextFollowing = !following;\n                    const $status = $(xml).find(\"status_code\");\n                    if ($status.length && $status.text() !== 0) {\n                        this.setState({ following: nextFollowing });\n                    }\n                })\n                .always(() => {\n                    this.setState({ loading: false });\n                });\n        });\n    };\n\n    handleTransition = event => {\n        if (isPlainLeftClick(event)) {\n            const href = event.currentTarget.getAttribute(\"href\");\n            if (href) {\n                location.href = href;\n            }\n        }\n    };\n\n    render() {\n        const { user, isAddedUser, viewerId } = this.props;\n        const { following } = this.state;\n\n        return (\n            <li>\n                <a href={`/${user.username}`} className=\"username\" onClick={this.handleTransition}>\n                    <img\n                        src=\"/_ui/images/common/blank.gif\"\n                        style={{ backgroundImage: `url(${user.image_url || user.user_square_image_small})` }}\n                    />\n                    {isAddedUser ? \"Added by \" : \"\"}\n                    <b>{user.fullname || user.full_name}</b>\n                    {isAddedUser ? \"\" : `@${user.username}`}\n                </a>\n                {viewerId !== user.id && (\n                    <button\n                        className={classnames(\"btns-gray-embo\", following ? \"following\" : \"follow\")}\n                        onClick={this.handleFollow}\n                    />\n                )}\n            </li>\n        );\n    }\n}\n\nexport class FancydByPopup extends React.Component {\n    static popupName = \"fancyd_list\";\n\n    constructor(props) {\n        super(props);\n        this.state = this._getInitialState();\n    }\n\n    _getInitialState() {\n        return {\n            loading: false,\n            nextPage: 1,\n            ended: null,\n            added_user: null,\n            users: [],\n            owner: null\n        };\n    }\n\n    getFollowList(nextProps, reset) {\n        const { objectId, objectType } = nextProps || this.props;\n        const { nextPage } = this.state;\n\n        var immediateNextStateUpdate;\n        if (reset) {\n            immediateNextStateUpdate = this._getInitialState();\n            immediateNextStateUpdate.loading = true;\n        } else {\n            immediateNextStateUpdate = { loading: true };\n        }\n\n        if (reset || (this.state.loading !== true && this.state.ended !== true)) {\n            this.setState(immediateNextStateUpdate, () => {\n                if (objectType === ShareObjectTypes.thing) {\n                    $.get(\"/thing_follower_list.json\", { thing_id: objectId, page: nextPage }, ({ has_next, users, owner }) => {\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                } else if (objectType === ShareObjectTypes.article) {\n                    $.get(`/rest-api/v1/articles/${objectId}/saved_users`, { page: nextPage }, ({ max_page, current_page, saved_users }) => {\n                        const users = saved_users;\n                        const has_next = max_page > current_page;\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner: null };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                }\n                \n            });\n        }\n    }\n\n    componentDidMount() {\n        this.getFollowList();\n        this.__last_tid = this.props.objectId;\n    }\n\n    componentDidUpdate(nextProps) {\n        if (this.__last_tid !== nextProps.objectId) {\n            this.__last_tid = nextProps.objectId;\n            this.getFollowList(nextProps, true);\n        }\n    }\n\n    handleMore = event => {\n        event.preventDefault();\n        this.getFollowList();\n    };\n\n    render() {\n        const { ended, users, owner } = this.state;\n        const { loggedIn, viewerId } = this.props;\n        return (\n            <div>\n                {/* TODO: via-overlay is needed to distinguish jQuery-attached Events and React Events -\n                    need to deliver better alternative \n                    rel task: https://app.asana.com/0/86925821949642/152825012917493 */}\n                <p className=\"ltit\">{gettext(\"Fancy'd by\")}</p>\n                <ul>\n                    {owner ? (\n                        <FancydPerson user={owner} isAddedUser={true} viewerId={viewerId} loggedIn={loggedIn} />\n                    ) : null}\n                    {users.map((user, idx) => (\n                        <FancydPerson key={`FancydBy-${idx}`} user={user} viewerId={viewerId} loggedIn={loggedIn} />\n                    ))}\n                    {ended === false && (\n                        <li className=\"more\">\n                            <a onClick={this.handleMore}>{gettext(\"View More\")}</a>\n                        </li>\n                    )}\n                </ul>\n                <button className=\"ly-close\" title=\"Close\">\n                    <i className=\"ic-del-black\" />\n                </button>\n            </div>\n        );\n    }\n}\n\nexport class FancydByPopupV4 extends React.Component {\n    static popupName = \"fancyd_list\";\n\n    constructor(props) {\n        super(props);\n        this.state = this._getInitialState();\n    }\n\n    _getInitialState() {\n        return {\n            loading: false,\n            nextPage: 1,\n            next_cursor: null,\n            ended: null,\n            added_user: null,\n            users: [],\n            owner: null\n        };\n    }\n\n    getFollowList(nextProps, reset) {\n        const { objectId, objectType, next_cursor } = nextProps || this.props;\n        const { nextPage } = this.state;\n\n        var immediateNextStateUpdate;\n        if (reset) {\n            immediateNextStateUpdate = this._getInitialState();\n            immediateNextStateUpdate.loading = true;\n        } else {\n            immediateNextStateUpdate = { loading: true };\n        }\n\n        if (reset || (this.state.loading !== true && this.state.ended !== true)) {\n            this.setState(immediateNextStateUpdate, () => {\n                if (objectType === ShareObjectTypes.thing) {\n                    const args = {};\n                    if (!!next_cursor) {\n                        args.cursor = next_cursor;\n                    }\n\n                    $.get(`/rest-api/v1/things/${objectId}/fancyd-users`, args, ({ next_cursor, fancyd_users }) => {\n                        const nextState = { loading: false, users: this.state.users.concat(fancyd_users), owner: null };\n                        if (!!next_cursor) {\n                            nextState.next_cursor = this.state.next_cursor;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                } else if (objectType === ShareObjectTypes.article) {\n                    $.get(`/rest-api/v1/articles/${objectId}/saved_users`, { page: nextPage }, ({ max_page, current_page, saved_users }) => {\n                        const users = saved_users;\n                        const has_next = max_page > current_page;\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner: null };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                }\n                \n            });\n        }\n    }\n\n    componentDidMount() {\n        this.getFollowList();\n        this.__last_tid = this.props.objectId;\n    }\n\n    componentDidUpdate(nextProps) {\n        if (this.__last_tid !== nextProps.objectId) {\n            this.__last_tid = nextProps.objectId;\n            this.getFollowList(nextProps, true);\n        }\n    }\n\n    handleMore = event => {\n        event.preventDefault();\n        this.getFollowList();\n    };\n\n    handleScroll = (e) => {\n        const el = e.target;\n        if (this.state.ended) {\n            return;\n        }\n\n        if ((el.scrollHeight - 50) <= (el.clientHeight + el.scrollTop)) {\n            this.getFollowList();\n        }\n    }\n\n    render() {\n        const { users, owner } = this.state;\n        const { loggedIn, loading, viewerId } = this.props;\n        return (\n            <div>\n                {/* TODO: via-overlay is needed to distinguish jQuery-attached Events and React Events -\n                    need to deliver better alternative \n                    rel task: https://app.asana.com/0/86925821949642/152825012917493 */}\n                <p className=\"ltit\">{gettext(\"Liked by\")}</p>\n                <ul onScroll={this.handleScroll}>\n                    {owner ? (\n                        <FancydPerson user={owner} isAddedUser={true} viewerId={viewerId} loggedIn={loggedIn} />\n                    ) : null}\n                    {users.map((user, idx) => (\n                        <FancydPerson key={`FancydBy-${idx}`} user={user} viewerId={viewerId} loggedIn={loggedIn} />\n                    ))}\n                    {loading && (\n                        <div id=\"infscr-loading\">\n                            <img alt=\"Loading...\" src=\"/_ui/images/common/loading.gif\" />\n                        <div />\n                    </div>\n                    )}\n                </ul>\n                <button className=\"ly-close\" title=\"Close\">\n                    <i className=\"ic-del-black\" />\n                </button>\n            </div>\n        );\n    }\n}\n\n// const onLoad = () => { \n//     $(document.body).on(\"click\", \".buttons .fancyd_user\", function() {\n//         if ($(this).closest('#overlay-thing').length > 0) {\n//             return true;\n//         }\n//         const $container = $(this).closest(\".buttons\");\n//         const objectId = $container.find(\".fancy, .fancyd\").attr(\"tid\");\n//         const objectType = 'thing';\n//         if (objectId) {\n//             renderPopup(FancydByPopup, { objectId, objectType, loggedIn: FancyUser.loggedIn, viewerId: FancyUser.id });\n//             return false;\n//         }\n//     });\n// }\n\n// if (document.readyState !== 'loading') {\n//     onLoad()\n// } else {\n//     document.addEventListener(\"DOMContentLoaded\", onLoad)\n// }\n","// fork of recommend-slide (accacb79d2af557369e02132ef5f486d226aa5d3)\nexport default function applyProductSlide() {\n    $(function() {\n        var mWidth = 920;\n\n        function initSlide($el, option) {\n            var $slide;\n            if ($el.is('.itemSlide, .slideshow')) {\n                $slide = $el;\n            } else {\n                $slide = $el.find(\".itemSlide, .slideshow\");\n            }\n            $slide.data('slideInit', true);\n            var $list = $el.find(\"ul\"),\n                $li = $list.find(\"li\"),\n                itemWidth = $li.width() + 20,\n                $prev = $el.find(\"a.prev\"),\n                $next = $el.find(\"a.next\");\n            var slideWidth = null;\n\n            if (option.itemPerSlide) slideWidth = itemWidth * option.itemPerSlide;\n\n            function resetRecommend() {\n                if (!$slide || !$li) {\n                    $el.css(\"visibility\", \"visible\");\n                    return;\n                }\n\n                if (slideWidth && slideWidth > itemWidth * $li.length) {\n                    $el.css(\"visibility\", \"visible\");\n                    return;\n                }\n\n                if ($(window).width() < mWidth) {\n                    if (option.center) {\n                        $slide.find(\".itemList\").scrollLeft(($li.length * 147 - $(window).width() + 20) / 2);\n                    }\n                    $prev.removeClass(\"disabled\");\n                    $next.removeClass(\"disabled\");\n                } else {\n                    if ($slide.width() > itemWidth * $li.length) {\n                        $prev.addClass(\"disabled\");\n                        $next.addClass(\"disabled\");\n                        if (option.center) {\n                            $slide.find(\".itemList\").css(\"left\", \"0px\");\n                        }\n                    } else {\n                        if (option.center) {\n                            $slide\n                                .find(\".itemList\")\n                                .css(\"left\", -parseInt(($li.length * 285 - $(window).width() + 20) / 2) + \"px\");\n                        }\n                        $prev.removeClass(\"disabled\");\n                        $next.removeClass(\"disabled\");\n                    }\n                }\n                $el.css(\"visibility\", \"visible\");\n            }\n\n            function getPrevLeft($el) {\n                preparePrev();\n                var left = Math.abs(parseInt($list.css(\"left\"))),\n                    nextLeft,\n                    width = $slide.width();\n                if (slideWidth) width = slideWidth;\n                nextLeft = left - width;\n                return nextLeft;\n            }\n\n            function getNextLeft($el) {\n                prepareNext();\n                var left = Math.abs(parseInt($list.css(\"left\"))),\n                    nextLeft,\n                    width = $slide.width();\n                if (slideWidth) width = slideWidth;\n                nextLeft = left + width;\n                return nextLeft;\n            }\n\n            function preparePrev() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    width = $slide.width(),\n                    itemWidth = $li.width() + 20;\n                if (slideWidth) width = slideWidth;\n\n                if (left < width) {\n                    var prepareCount = Math.ceil(Math.abs(width - left) / itemWidth);\n                    for (var i = 0; i < prepareCount; i++) {\n                        var $el = $list.find(\"li:not([_prev])\").last();\n                        $el.clone().insertBefore($list.find(\"li\").first());\n                        $el.attr(\"_prev\", true);\n                    }\n                    $list.css(\"left\", 0 - left - prepareCount * itemWidth + \"px\");\n                }\n            }\n\n            function prepareNext() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    width = $slide.width(),\n                    listWidth = $li.length * ($li.width() + 20),\n                    itemWidth = $li.width() + 20,\n                    spare = listWidth - (left + width);\n                if (slideWidth) width = slideWidth;\n                if (spare - width < width) {\n                    var prepareCount = Math.ceil(Math.abs(width - (listWidth - (left + width))) / itemWidth);\n                    for (var i = 0; i < prepareCount; i++) {\n                        var $el = $list.find(\"li:not([_next])\").first();\n                        $el.clone().insertAfter($list.find(\"li\").last());\n                        $el.attr(\"_next\", true);\n                    }\n                }\n            }\n\n            function clearOld() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    itemWidth = $li.width() + 20,\n                    $prev = $list.find(\"li[_next]:not(:in-viewport)\"),\n                    prevCnt = $prev.length;\n                $list.find(\"li[_prev]:not(:in-viewport)\").remove();\n                $prev.remove();\n                $list.css(\"left\", 0 - left + prevCnt * itemWidth + \"px\");\n            }\n\n            resetRecommend();\n\n            if (slideWidth && slideWidth > itemWidth * $li.length) {\n                $prev.hide();\n                $next.hide();\n            }\n\n            $el.on(\"click\", \"a.prev\", function(e) {\n                e.preventDefault();\n                var $this = $(this);\n                if ($this.hasClass(\"_disabled\")) return;\n                var left = getPrevLeft($el);\n                $this.addClass(\"_disabled\");\n                $list.animate({ left: 0 - left + \"px\" }, 300, \"easeInOutExpo\", function() {\n                    clearOld();\n                    $this.removeClass(\"_disabled\");\n                });\n            }).on(\"click\", \"a.next\", function(e) {\n                e.preventDefault();\n                var $this = $(this);\n                if ($this.hasClass(\"_disabled\")) return;\n                var left = getNextLeft($el);\n                $this.addClass(\"_disabled\");\n                $list.animate({ left: 0 - left + \"px\" }, 300, \"easeInOutExpo\", function() {\n                    clearOld();\n                    $this.removeClass(\"_disabled\");\n                });\n            });\n        }\n\n        $.fn.productSlide = function(option) {\n            var option = option || { center: true };\n            var self = this;\n            var $slides = this.each(function() {\n                var $el = $(this);\n                initSlide($el, option);\n            });\n\n            return $slides;\n        };\n    });\n}\n","import React from 'react';\nimport classnames from 'classnames';\nimport { FancyUser, debounceUntilTimeout, MP, getDisplay, triggerEvent, alertify } from 'fancyutils';\nimport { ShareObjectTypes, getShareURL } from './MoreShareUtils';\n\nimport { Display } from 'fancymixin';\n\n\nconst SNSDict = { \"fb\": \"Facebook\", \"tw\": \"Twitter\", \"tb\": \"Tumblr\" };\n\nconst followingUsers = [];\nlet followingUsersRequested = false;\n\nconst ViewClasses = {\n    Success: 'empty success',\n    Default: 'empty default',\n    Searching: 'empty searching',\n    NoResult: 'empty no-result',\n};\n\n\nexport class SharePopover extends React.Component {\n    state = {\n        friendSearchQuery: '',\n        searchedFriends: [],\n        selectedUserID: null,\n        sentUser: null,\n        sendNote: '',\n        sendSuccess: false,\n        searching: false,\n        isContact: false,\n    };\n\n    mailUser = {\n        id: 'EMAIL',\n        type: 'email',\n        profile_image_url: '/_ui/images/common/blank.gif',\n        fullname: 'Email',\n        /* mut */ username: null,\n    };\n\n    constructor(props) {\n        super(props);\n        this.searchFriends = debounceUntilTimeout(function searchFriends(prevQuery, friendSearchQuery) {\n            if (this.isEmailOnlyMode()) {\n                this.setState({ searching: false });\n                return;\n            }\n\n            const term = $.trim(friendSearchQuery);\n            if ($.trim(prevQuery) === term) {\n                return;\n            }\n            if (term === '') {\n                this.setState({\n                    searchedFriends: [],\n                    selectedUserID: null,\n                });\n                return;\n            }\n            this.setState({ searching: true }, () => {\n                $.get('/search-users.json', {\n                    term, \n                    filter_messages_permission: true\n                })\n                .done(searchedFriends => {\n                    const nextState = { searching: false };\n                    if (this.state.friendSearchQuery === friendSearchQuery) {\n                        nextState.searchedFriends = searchedFriends;\n                        nextState.selectedUserID = null;\n                    }\n                    this.setState(nextState);\n                });\n            })\n        }, 200, this);\n    }\n\n    handleContinue = (event) => {\n        event.preventDefault();\n        this.clearFriendList();\n        if (this.props.handleHide) {\n            this.props.handleHide()\n        }\n    }\n\n    handleFriendSearch = (event) => {\n        const friendSearchQuery = event.target.value;\n        const prevQuery = this.state.friendSearchQuery;\n        this.setState({ friendSearchQuery, sendSuccess: false, searching: true }, () => {\n            this.searchFriends(prevQuery, friendSearchQuery);\n        });\n    }\n\n    handleSend = () => {\n        const { sendNote, selectedUserID, searchedFriends } = this.state;\n        const { title, referrerURL } = this.props;\n        if (this.sending) {\n            return;\n        }\n\n        const isMailuser = selectedUserID === this.mailUser.id;\n        if (isMailuser) {\n            this.handleSendMail();\n            return;\n        } else if (searchedFriends.length === 0 || selectedUserID == null) {\n            return;\n        }\n\n\n        const { objectType } = this.props;\n        let params;\n        if (objectType === ShareObjectTypes.thing) {\n            params = {\n                things: this.props.objectId,\n                user_id: selectedUserID\n            };\n        } else {\n            params = {\n                user_id: selectedUserID,\n                message: `${title} ${referrerURL}`,\n            };\n        }\n        \n        this.sending = true;\n        if ($.trim(sendNote)) {\n            params.message += (' ' + $.trim(sendNote));\n        }\n\n        $.post('/messages/send-message.json', params)\n            .done(json => {\n                if (json.status_code !== 1) {\n                    if (json.message) {\n                        alertify.alert(json.message);\n                    } else {\n                        alertify.alert(\"There was an error while sending message. Please try again.\");\n                    }\n                    return;\n                }\n                this.clearFriendList({\n                    sendSuccess: true,\n                    sentUserID: selectedUserID,\n                    selectedUserID: null,\n                }, ['searchedFriends']);\n                MP('Complete Share', { \"thing id\": params.things, \"type\": \"FancyMessage\" });\n            })\n            .fail(xhr => {\n                console.warn(xhr);\n            })\n            .always(() => {\n                this.sending = false;\n            });\n    }\n\n    handleSendMail = () => {\n        if (this.sending) {\n            return;\n        }\n        if (this.props.objectType == null) {\n            console.warn('objectType should be provided.');\n        }\n        const object_type = this.props.objectType || 'thing';\n        const email_address = this.mailUser.username.trim();\n\n        const object_id = this.props.objectId;\n        this.sending = true;\n        const params = { email_address, object_type, object_id };\n        const message = $.trim(this.state.sendNote);\n        if (message) {\n            params.message = message;\n        }\n        if (this.props.objectMeta && this.props.objectMeta.type === 'shoplist') {\n            params.object_meta = this.props.objectMeta.type;\n        }\n\n        $.post('/messages/send-email.json', params)\n            .done(json => {\n                if (json.status_code !== 1) {\n                    if (json.message) {\n                        alertify.alert(json.message);\n                    } else {\n                        alertify.alert(\"There was an error while sending message. Please try again.\");\n                    }\n                    return;\n                }\n                this.clearFriendList({\n                    sendSuccess: true,\n                    sentUserID: params.email_address,\n                    selectedUserID: null,\n                });\n                MP('Complete Share', { \"object id\": params.object_id, \"object type\": params.object_type, \"type\": \"Email\" });\n            })\n            .fail(xhr => {\n                var responseObject = null\n                try { responseObject = JSON.parse(xhr.responseText) } catch(e) { }\n                if(responseObject && responseObject.message) {\n                    alertify.alert(responseObject.message)\n                } else {\n                    alertify.alert(\"Error occured. please try again.\\n\"+xhr.status + ' ' + xhr.statusText);\n                }\n                console.warn(xhr);\n            })\n            .always(() => {\n                this.sending = false;\n            });\n    }\n\n    clearFriendList = (additionals, excludes) => {\n        // remove search history for users\n        const nextState = _.extend({\n            friendSearchQuery: '',\n            searchedFriends: [],\n            sendNote: '',\n            sendSuccess: false,\n            sentUserID: null,\n        }, additionals);\n        if (excludes) {\n            excludes.forEach(excludeKey => {\n                delete nextState[excludeKey];\n                nextState[excludeKey] = this.state[excludeKey];\n            });\n        }\n        this.setState(nextState);\n    }\n\n    handleSendNoteInput = (event) => {\n        const sendNote = event.target.value;\n        this.setState({ sendNote });\n    }\n\n    handleUserSelect = (event) => {\n        event.preventDefault();\n        const { selectedUserID } = this.state;\n        const nextID = $(event.currentTarget).attr('data-userid');\n        // Canceling\n        if (String(selectedUserID) === $(event.currentTarget).attr('data-userid')) {\n            this.setState({ selectedUserID: null });\n        // Selecting\n        } else {\n            this.setState({ selectedUserID: nextID });\n        }\n    }\n\n    getSelectedUser = () => {\n        const { selectedUserID } = this.state;\n        return _.find(this.getSearchedFriends(), e => String(e.id) === selectedUserID);\n    }\n\n    getSentUser = () => {\n        const { sentUserID } = this.state;\n        return _.find(this.getSearchedFriends(), e => String(e.id) === sentUserID);\n    }\n\n    getDisplayUsers = () => {\n        if (followingUsersRequested) {\n            return;\n        }\n        this.loadingDisplayUsers = true;\n        followingUsersRequested = true;\n        $.get('/get-share-display-users.json').done(res => {\n            if (res.status_code === 1 && res.users.length > 0) {\n                followingUsers.push.apply(followingUsers, res.users);\n            }\n        }).fail(() => {\n            console.warn('failed to fetch display users')\n        })\n        .always(() => {\n            this.loadingDisplayUsers = false;\n            this.forceUpdate();\n        });\n    }\n\n    handleClickBackFromContact = () => {\n        this.setState({ isContact: false });\n    }\n\n    handleClickContactImport = (event) => {\n        event.preventDefault();\n        this.setState({ isContact: true });\n    }\n\n    getSharedMailUser = () => {\n        const {\n            friendSearchQuery,\n        } = this.state;\n        this.mailUser.username = friendSearchQuery;\n        return [this.mailUser];\n    }\n\n    getSearchedFriends = () => {\n        if (\n            this.state.friendSearchQuery.length !== 0 || \n            this.state.sendSuccess\n        ) {\n            if (this.isInputEmail()) {\n                return this.getSharedMailUser();\n            } else {\n                return this.state.searchedFriends;\n            }\n        } else {\n            return followingUsers;\n        }\n    }\n\n    isInputEmail = () => {\n        const { friendSearchQuery } = this.state;\n        return friendSearchQuery.length > 1 && \n               friendSearchQuery.indexOf('@') > 0;\n    }\n\n    getPrefix(user) {\n        return user.type === 'email' ? '' : '@';\n    }\n\n    static getShareMessage(objectType, defaultMessage = '') {\n        let shareMessage = defaultMessage;\n        if (objectType === ShareObjectTypes.list) {\n            shareMessage = 'Share collection';\n        } else if (objectType === ShareObjectTypes.store) {\n            shareMessage = 'Share store';\n        } else if (objectType === ShareObjectTypes.user) {\n            shareMessage = 'Share profile';\n        } else if (objectType === ShareObjectTypes.article) {\n            shareMessage = 'Share article';\n        }\n        return shareMessage;\n    }\n\n    isEmailOnlyMode = () => {\n        return !(this.props.objectType === ShareObjectTypes.thing || this.props.objectType === ShareObjectTypes.article) || !FancyUser.loggedIn;\n    }\n\n    componentDidUpdate(prevProps) {\n        const { showShare } = this.props;\n        const { isContact } = this.state;\n        // share is closed, if contact mode close it.\n        if (isContact && !showShare && prevProps.showShare !== showShare) {\n            this.setState({ isContact: false });\n        }\n    }\n\n    componentDidMount() {\n        // Do loading friends stuff.\n        if (!this.isEmailOnlyMode()) {\n            this.getDisplayUsers();\n        }\n    }\n\n    render() {\n        const {\n            showShare,\n            title,\n            headerGap,\n            objectType,\n            objectId,\n            objectMeta,\n            viewerUsername,\n            referrerURL,\n        } = this.props;\n\n        if (process.env.NODE_ENV !== 'production') {\n            viewerUsername == null &&\n            console.warn('SharePopover: viewerUsername missing');\n        }\n\n        const {\n            friendSearchQuery,\n            sendNote,\n            sendSuccess,\n            sentUserID,\n            searching,\n            isContact\n        } = this.state;\n        const searchedFriends = this.getSearchedFriends();\n\n        const selectedUser = this.getSelectedUser();\n        const sentUser = this.getSentUser();\n\n        var emptyDisplay = Display.Block;\n        var emptyClassName;\n        var searchedFriendsDisplay;\n        const inputIsEmail = this.isInputEmail();\n        const emailOnlyMode = this.isEmailOnlyMode(); \n        // Search returns nothing\n        \n        if (sendSuccess) {\n            emptyClassName = ViewClasses.Success;\n        } else {\n            if (emailOnlyMode && !inputIsEmail) {\n                emptyClassName = ViewClasses.Default;\n            } else if (searchedFriends.length > 0) {\n                if (!inputIsEmail && searching) {\n                    emptyClassName = ViewClasses.Searching;\n                }\n            } else if (searchedFriends.length === 0) {\n                if (friendSearchQuery.length === 0) {\n                    if (this.loadingDisplayUsers) {\n                        emptyClassName = ViewClasses.Searching;\n                    } else {\n                        emptyClassName = ViewClasses.Default;\n                    }\n                } else {\n                    if (searching) {\n                        emptyClassName = ViewClasses.Searching;\n                    } else {\n                        emptyClassName = ViewClasses.NoResult;\n                    }\n                }\n            }\n        }\n\n        if (emptyClassName) {\n            searchedFriendsDisplay = Display.None;\n        } else {\n            emptyDisplay = Display.None;\n        }\n\n        if (selectedUser) {\n            searchedFriendsDisplay = Display.None;\n        }\n\n        const noteSendable = (\n            !this.sending &&\n            searchedFriends.length > 0 &&\n            !!selectedUser\n        );\n\n        // Sliding indicator style\n        const isSNS = !(selectedUser || sendSuccess);\n\n        let sentMessage = '';\n        if (sendSuccess) {\n            sentMessage += gettext(\"Sent to \");\n            sentMessage += sentUser ? (sentUser.fullname || sentUser.username) : sentUserID\n        }\n\n        let bottom = false;\n        if (headerGap < 290) {\n            bottom = true;\n        }\n\n        return (\n            <div id=\"show-share\" className={classnames(\"more-share-popup more-share-popup-2 has-arrow\", { bot: bottom })} style={getDisplay(showShare)}>\n                <h3 className=\"tit\" style={Display.NoneIf(isContact || selectedUser)}>{SharePopover.getShareMessage(objectType, 'Share')}</h3>\n                <a className=\"btn-back\" style={Display.NoneIf(!selectedUser || sentUser)}\n                   onClick={() => {this.setState({ selectedUserID: null });return false;}}>Back</a>\n                <div className=\"frm\" style={Display.NoneIf(isContact)}>\n                    {FancyUser.loggedIn &&\n                    <div id=\"more-share-send\">\n                        <span className=\"textbox before-bg-share2\" style={Display.NoneIf(selectedUser || sendSuccess)}>\n                            <input id=\"more-share-email\"\n                                   className=\"text\" type=\"text\"\n                                   placeholder={emailOnlyMode ? gettext(\"Enter email address\") : gettext(\"Username or email address\")}\n                                   autoComplete=\"off\"\n                                   onChange={this.handleFriendSearch}\n                                   value={friendSearchQuery} />\n                        </span>\n                        <ul className=\"lists\" style={searchedFriendsDisplay}>\n                            {searchedFriends\n                                .map((user, idx) => {\n                                    const term = $.trim(friendSearchQuery).toLowerCase();\n                                    const prefix = this.getPrefix(user);\n                                    let style;\n                                    if (term) {\n                                        if (\n                                            `${user.fullname} ${prefix}${user.username}`.toLowerCase().indexOf(term) === -1\n                                        ) {\n                                            style = Display.None;\n                                        }\n                                    }\n                                    let username;\n                                    let imgClass;\n                                    if (user.type === 'email') {\n                                        username = user.username;\n                                        imgClass = 'email';\n                                    } else {\n                                        username = `${prefix}${user.username}`;\n                                    }\n\n                                    return (\n                                        <li key={idx} style={style}>\n                                            <a className=\"before-bg-share2\"\n                                                onClick={this.handleUserSelect}\n                                                data-userid={user.id}>\n                                                <img alt=\"\" className={imgClass} src={user.profile_image_url} />\n                                                <b>{user.fullname}</b>\n                                                <small>{username}</small>\n                                            </a>\n                                        </li>\n                                    )\n                            })}\n                        </ul>\n                        <div className={emptyClassName} style={emptyDisplay}>\n                            <i className=\"circle bg-share2\" />\n                            {emailOnlyMode ?\n                                <span className=\"default\">\n                                    {gettext(\"Share this via Email\")}\n                                </span>\n                                :\n                                <span className=\"default\">\n                                    <b>{gettext(\"Find people to share with\")}</b>\n                                    <a onClick={this.handleClickContactImport}>{gettext(\"Import from contacts\")}</a>\n                                </span>\n                            }\n                            <span className=\"searching\">\n                                {gettext(\"Searching...\")}\n                            </span>\n                            <span className=\"no-result\">\n                                {gettext(\"No users found\")}\n                            </span>\n                            <span className=\"success\">\n                                <b>{gettext(\"Success!\")}</b>\n                                {sentMessage}\n                                <a className=\"close\" onClick={this.handleContinue}>{gettext(\"Continue\")}</a>\n                            </span>\n                        </div>\n                        <div className=\"send\" style={Display.NoneIf(selectedUser == null)}>\n                            {selectedUser && \n                                <span className=\"recipient\">\n                                    <img alt=\"user image\" className={selectedUser.type === 'email' && 'email'} src={selectedUser.profile_image_url} />\n                                    <b>{selectedUser.fullname}</b>\n                                    <small>{this.getPrefix(selectedUser)}{selectedUser.username}</small>\n                                </span>\n                            }\n                            <fieldset>\n                                <textarea placeholder=\"Add a message\" value={sendNote} onChange={this.handleSendNoteInput} />\n                                <button className=\"btn-send\" disabled={!noteSendable} onClick={this.handleSend}>Send</button>\n                            </fieldset>\n                        </div>\n                    </div>\n                    }\n                    <SNSShareBox showShareBox={isSNS} title={title} referrerURL={referrerURL}\n                                 objectId={objectId} objectType={objectType} objectMeta={objectMeta}\n                                 viewerUsername={viewerUsername} />\n                </div>\n                <div className=\"contact-sns\" style={Display.NoneIf(!isContact)}>\n                    <a onClick={this.handleClickBackFromContact} className=\"back\">Back</a>\n                    <a href=\"/find-friends\" className=\"fb\" target=\"_blank\"><em> Facebook</em></a>\n                    <a href=\"/find-friends?type=twitter\" className=\"tw\" target=\"_blank\"><em> Twitter</em></a>\n                    <a href=\"/find-friends?type=gmail\" className=\"gm\" target=\"_blank\"><em> Gmail</em></a>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport class SNSShareBox extends React.Component {\n    state = {\n        copied: false,\n        referrerURL: '',\n        textboxDisplay: false\n    };\n    loading = false;\n    snsShareWindow = null;\n\n    getRefURL() {\n        return this.state.referrerURL || this.props.referrerURL\n    }\n\n    updateEmbedOption($li, viewerUsername) {\n        const $thumb = $li.find('.embed-thum');\n        const $options = $li.find('input[name=\"embed-info\"]');\n        const types = [];\n\n        $options.each(function() {\n            const { value, checked } = this;\n            if (checked) {\n                $thumb.addClass(value);\n                types.push(value);\n            } else {\n                $thumb.removeClass(value);\n            }\n        });\n        const width = parseInt($li.find('input[name=\"embed-width\"]').val(), 10) || undefined;\n\n        const snippet = $('<script />', {\n            'src': `//${location.hostname}/embed.js?v=150608`,\n            'async': true,\n            'class': 'fancy-embed',\n            'data-id': $li.attr('tid') || $li.attr('objectId') || '',\n            'data-ref': viewerUsername,\n            'data-type': types.length > 0 ? types.join(',') : '',\n            'data-width': width\n        }).prop('outerHTML');\n        $li.find('textarea[name=\"embed-code\"]').val(snippet);\n    }\n\n    handleEmbed = () => {\n        const { updateEmbedOption, props: { objectType, objectId, viewerUsername } } = this;\n\n        if (objectType === ShareObjectTypes.thing) {\n            const $ep = $(\"#embed_popup\");\n            $ep\n                .off('click.fancyembed')\n                .off('keyup.fancyembed')\n                .on('click.fancyembed', 'input[name=\"embed-info\"]', function() {\n                    updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n                })\n                .on('keyup.fancyembed', 'input[name=\"embed-width\"]', function() {\n                    updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n                });\n\n            $ep.find('.customize').removeClass('opened');\n            $ep.find('input[name=\"embed-info\"]').prop('checked', true);\n            $ep.find('input[name=\"embed-width\"]').val(450);\n            $ep.attr('tid', objectId);\n            updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n\n            $.dialog(\"embed_item\").open(true);\n        }\n\n        return false;\n    }\n\n    handleShare = (event) => {\n        const { props: { objectId, objectType } } = this;\n        const element = event.currentTarget;\n\n        // redirect to acquired URL using blank window, which does not blocked by blocker usually.\n        // Low possiblity, but if assign fails with DOMException, silently pass so\n        // user can retry without confusion.\n        if (event.detail && event.detail.faintClick) {\n            try {\n                this.snsShareWindow.location.assign(element.getAttribute('href'));\n            } catch (e) {}\n            // Remove disposable window \n            this.snsShareWindow = null;\n            return;\n        } else {\n            if (!this.getRefURL()) {\n                this.snsShareWindow = window.open('about:blank', '_fancy_sns_share');\n            }\n            event.preventDefault();\n        }\n\n        getShareURL(this, (directClick) => {\n            if (directClick) {\n                window.open(element.getAttribute('href'), '_fancy_sns_share');\n            } else {\n                triggerEvent(element, 'click', { faintClick: true });\n            }\n        });\n\n        if (objectType === ShareObjectTypes.thing) {\n            const type = SNSDict[element.className];\n            MP('Complete Share', { \"thing id\": objectId, type });\n        }\n    }\n\n    render() {\n        const { title, showShareBox, objectType } = this.props;\n        const { textboxDisplay } = this.state;\n        const referrerURL = this.getRefURL()\n\n        return (\n            <div id=\"more-share-sns\" className=\"more-share-sns\" style={showShareBox ? Display.Block : Display.None}>\n                <span className=\"via after\" style={Display.NoneIf(textboxDisplay)}>\n                    <a href={`https://www.facebook.com/sharer.php?u=${referrerURL}`}\n                        onClick={this.handleShare} className=\"fb\" target=\"_blank\">\n                        <span className=\"ic-fb\" /> <em>{gettext(\"Share with Facebook\")}</em>\n                    </a>\n                    <a href={`https://twitter.com/share?text=${encodeURI(title)}&url=${referrerURL}&via=fancy`}\n                        onClick={this.handleShare} className=\"tw\" target=\"_blank\">\n                        <span className=\"ic-tw\" /> <em>{gettext(\"Share with Twitter\")}</em>\n                    </a>\n                    <a href={`https://www.tumblr.com/share/link?url=${referrerURL}&name=${encodeURI(title)}&description=${encodeURI(title)}`}\n                        onClick={this.handleShare} className=\"tb\" target=\"_blank\">\n                        <span className=\"ic-tb\" /> <em>{gettext(\"Share with Tumblr\")}</em>\n                    </a>\n                    {objectType === ShareObjectTypes.thing &&\n                        <a onClick={this.handleEmbed} className=\"embed\">\n                            <span className=\"ic-em\" /> <em>{gettext(\"Embed this item\")}</em>\n                        </a>\n                    }\n                </span>\n            </div>\n        );\n    }\n}\n","import React from \"react\";\n// import classnames from \"classnames\";\n// import { proportionFormat, isSafari as isSafariUtil } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\n\nexport function getVideo(object) {\n    if (object.h264_1000k_url) return object;\n    const saleVideo = object && object.sales && object.sales.video;\n    const thingOrArticleVideo = (object && object.video_cover) || (object && object.cover_video);\n    if (saleVideo) {\n        return saleVideo;\n    } else if (thingOrArticleVideo) {\n        try {\n            if (!thingOrArticleVideo.h264_1000k_url && object.cover_video.outputs.h264_1000k) {\n                thingOrArticleVideo.h264_1000k_url = object.cover_video.outputs.h264_1000k.url;\n            }\n        } catch (e) {}\n        return thingOrArticleVideo;\n    } else if (object.metadata && object.metadata.video_url) {\n        return {\n            thumbnail_url: object.image.src,\n            original_url: object.metadata.video_url\n        };\n    } else {\n        console.warn(\"<Video /> component is mounted but with unknown type\");\n        return {};\n    }\n}\n\nexport class Video extends React.Component {\n    constructor(props) {\n        super(props);\n        this.id = +new Date();\n    }\n    el = null;\n    videoEl = null;\n    static isVideoAvailableForThing(thing) {\n        let thingHasVideo = false;\n        if (thing) {\n            if (thing.video_cover) {\n                thingHasVideo = true;\n            } else if (thing.metadata) {\n                if (thing.metadata.video_url) {\n                    thingHasVideo = true;\n                }\n            } else if (thing.sales) {\n                if (thing.sales.video) {\n                    thingHasVideo = true;\n                }\n            }\n        }\n        return thingHasVideo;\n    }\n    static isVideoAvailableForArticle(article) {\n        if (article && article.cover_video && article.cover_video.status == \"ready\") {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    getSrc() {\n        const { object } = this.props;\n        const video = getVideo(object);\n        return video.h264_1000k_url || video.original_url || video.original;\n    }\n\n    getThumbnail() {\n        const { object } = this.props;\n        const video = getVideo(object);\n        return video.thumbnail_url;\n    }\n\n    getLoop() {\n        const { object } = this.props;\n        return getVideo(object).loop;\n    }\n\n    shouldComponentUpdate(nextProps) {\n        return (\n            nextProps.lastFullyRenderedObjectID !== this.props.lastFullyRenderedObjectID ||\n            nextProps.display !== this.props.display ||\n            nextProps.playing !== this.props.playing ||\n            nextProps.object !== this.props.object);\n    }\n\n    prepare() {\n        const domCls = `video-${this.id}`;\n        let $el = $(`.${domCls}`);\n        if ($el.length) {\n            if ($el[0].src !== this.getSrc()) {\n                $el[0].src = this.getSrc();\n                $el[0].loop = !!this.getLoop();\n                $el[0].currentTime = 0;\n            }\n        } else {\n            $el = $(\n                `<video id=\"myVideo\" class=\"${domCls}\" preload=\"auto\" playsInline disablePictureInPicture autoplay muted controls controlslist=\"nodownload nofullscreen noremoteplayback\" src=\"${this.getSrc()}\" loop=\"${!!this.getLoop()}\" poster=\"${this.getThumbnail()}\"/>`\n            )\n                .on(\"ended\", function() {\n                    this.currentTime = 0;\n                })\n            this.videoEl = $el.get(0);\n            $(this.el).empty().append(this.videoEl);\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n        const np = this.props;\n        if (np.display !== prevProps.display) {\n            if (np.display === false) {\n                this.videoEl && this.videoEl.pause();\n            } else {\n                this.videoEl && this.videoEl.play();\n            }\n        }\n        if (np.display && np.playing != prevProps.playing) {\n            if (np.playing === false) {\n                this.videoEl && this.videoEl.pause();\n            } else {\n                this.videoEl && this.videoEl.play();\n            }\n        }\n        this.prepare();\n    }\n\n    render() {\n        const { display, style = {}, playing } = this.props;\n        \n        return (\n            <div\n                style={_.extend(style, Display.NoneIf(!display))}\n                className=\"video_player nozoom\"\n                ref={el => {\n                    this.el = el;\n                    if (!this.videoEl) {\n                        this.prepare();\n                    }\n                }}\n            />\n        );\n    }\n}\n","export { Video } from './Video';\nexport * from './MoreShare';\nexport * from './MoreShareFacade';\nexport * from './MoreShareUtils';\nexport { SharePopover } from './SharePopover';\nexport { AddlistPopover } from './AddlistPopover';\nexport { AddlistAction } from './AddlistAction';\nexport * from './Popup';\nexport { history } from './History'\nexport { default as applyProductSlide } from './ProductSlide';\n"],"sourceRoot":""}
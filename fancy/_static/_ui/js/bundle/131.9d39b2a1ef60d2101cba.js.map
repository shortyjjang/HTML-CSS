{"version":3,"sources":["webpack://fancy/./_static/modules/ui/overlay-thing/action/action-constants.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/actions.js","webpack://fancy/./_static/modules/ui/overlay-thing/appstate.ts","webpack://fancy/./_static/modules/ui/overlay-thing/cache.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/map.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/FancyContext.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AdminPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/SimpleSharePopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AddlistPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/ActionButtons.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/zoom.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/Perf.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItemForm.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/CartButton.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/multiOption.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/ApplePayButton.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/store/initial-store.ts","webpack://fancy/./_static/modules/ui/overlay-thing/ThingTypes.js","webpack://fancy/./_static/modules/ui/overlay-thing/reducers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/store/store.ts"],"names":["keys","slice","call","arguments","reduce","prev","next","constantGen","requestThing","pendingID","type","C","status","requestThingFail","loadThing","ID","data","openThing","closeThing","thing","setThumbnailIndex","thumbnailIndex","toggleFancy","thingID","cancelFancy","completeFancy","fancyd_count","updateAppContext","contextObject","context","state","viewer","loggedIn","updateState","k","v","ThingCache","id","ignoreCralwed","cac","get","existence","isCrawled","THINGS","SALES","getCrawled","count","console","warn","selector","value","t","index","cache","window","__THING_CACHE","_","gettext","mapStateToThingProps","appContext","isFetching","followContext","fancyContext","slideContext","saleContext","isSalesOptionsAvailable","sales","isEmpty","options","getFirstSaleOption","ignoreEmptySaleOption","getCurrentSaleOption","saleOptionID","opts","filter","prop","discount_percentage","quantity","soldout","retail_price","name","formatPrice","amount","currency","newPrice","toFixed","regex","test","replace","numberType","currencyIsUSD","currencyCode","tid","hotelImages","salesImages","thingImages","saleOptionWaitingRegistry","setWaiting","chosenSaleOptionID","setResult","getWaiting","waiting","chosenSaleOption","fillArray","original","filler","ol","length","fl","sparseIdxs","j","push","i","getSaleImages","option","thumbnailsLimit","hotel_search","fromServer","images","map","img","src","url","thumbnail_src","thumbnailUrl","width","height","unshift","image_resized_max","video","image","isVanityQueriable","props","suppress","AC","minPrice","maxPrice","keyword","$","trim","original_labels","alertify","isNaN","parseInt","labels","ok","getSafeNameProp","emojified_name","dangerouslySetInnerHTML","__html","children","isVideoUploadable","metadata","getFancyContextDefaultValue","dispatch","FancyContext","React","useFancy","className","title","AdminPopup","show_on_homepage","date_published","exclude_from_popular","show_in_search","optionSaving","ownerSaving","mergeSaving","payload","thing_id","inputDate","Date","alert","toISOString","split","setState","post","then","json","status_code","Object","assign","message","fail","changeOwnerEl","new_owner","toLowerCase","thing_owner","username","confirm","ajax","new_owner_name","new_thing_id","ntid","old_user_id","dataType","done","xml","xmlUtil","location","reload","find","text","always","that","this","dialog","popupName","$obj","on","prevProps","prevState","center","href","target","checked","onChange","event","placeholder","style","Display","classnames","onClick","handleSaveOptions","ref","el","handleChangeOwner","SimpleSharePopup","preventDefault","closePopup","log","shareUrl","copyToClipboard","urlCopied","setTimeout","connector","indexOf","handleCopyLink","encodeURIComponent","image_url","AddlistPopup","lists","listSearchQuery","listCreationQuery","listCreating","drawUserList","listSearchInput","focus","which","KEYS","objectId","updateList","createList","callback","success","updated","MP","stopPropagation","targ","currentTarget","selectedListId","Number","getAttribute","theList","list","prevAdded","added","eventName","update","handleDialogOpen","getListCheckbox","res","element","handleListSearch","idx","term","isString","key","data-listid","handleListItemToggle","quickCreateList","onKeyUp","handleListCreation","handleCreateListQueryChange","Component","resp","error","err","unchecked","join","Favorite","useDispatch","fancyd","loading","crdl","getCordialProperties","e","require_login","ActionButtons","msg","fancyd_friends","cnt","full_name","tagName","renderPopup","FancydByPopupV4","objectType","FancyUser","viewerId","is_admin_any","zoomScale","getBoundarySize","$el","eq","DEBUG","getZoomBoxSize","bs","Math","min","getZoomMargin","zidCac","getZoomImageDimension","zoomMargin","ret","getNextZoomImageStyle","pageX","pageY","$wrapper","boundaryWidth","boundaryHeight","meta","marginHoriz","marginVert","$fig","getImageMeta","offset","left","top","topPosition","showZoomImage","zoomBoxSize","zd","zoomImageContainerX","minmax","zoomImageContainerY","backgroundLeft","backgroundTop","bgPosX","bgPosY","transform","backgroundPosition","display","getZoomImageStyle","isZoomActive","currentZoomImageStyle","backgroundSize","isTouchDevice","navigator","maxTouchPoints","msMaxTouchPoints","SwiperAddons","Thumbs","Zoom","SwiperCore","ImageSlide","memo","setSlideLocked","isActive","useState","setZoomActive","zoomImageStyle","setZoomImageStyle","zoomImageCacheKey","setZoomImageCacheKey","zoomImageLoaded","setZoomImageLoaded","isVideo","h264_1000k_url","isMagnifyingGlassZoomable","useEffect","large_image_url","Promise","r","Image","onload","onerror","zoom","startZoom","zoomShow","nextZoomImageStyle","onMouseMove","object","playing","lastFullyRenderedObjectID","allow","fullScreen","data-src","undefined","alt","cursor","backgroundColor","backgroundImage","nextProps","displayName","imageOnly","galleryThumbsDirection","thumbsPerView","fancyProps","swiperRef","useRef","swipeThumbsRef","thumbIndex","setThumbIndex","slideLocked","swiper","setSwiper","lastThumbIndex","activeIndex","slideTo","current","thumbSwiper","slides","classList","contains","prevEl","opacity","max","nextEl","onSlideChange","preloadImages","lazy","loadPrevNext","loadPrevNextAmount","maxRatio","allowSlidePrev","allowSlideNext","onZoomChange","scale","onSwiper","clickedIndex","direction","spaceBetween","slidesPerView","watchSlidesVisibility","selected","thumbnail_url","Keys","Wrap","Body","Title","Price","Form","Desc","Owner","SaleOptions","currentValue","expander","defaultValue","printer","disabled","onFocus","unselectedLabel","SelectBox","labelValue","label","tabIndex","SizeGuide","showSelectWarning","s","MultiOptionState","option_meta","orderMap","forEach","m","targetIndex","values","filteredOptions","order","sel","uniq","o","getPossibleValuesForIndex","MultiOption","multiOptionState","sid","multiOptions","getMultiOptions","sizeGuidePos","indexTypeOf","additional","selectedArray","selectedValue","showSizeGuide","MultiSelectBox","swatch","MultiSwatch","thumbnail","MultiThumbnail","MultiButton","onMultiSelectBoxChange","MultiSelectBoxOption","data-value","data-index-typeof","onClickSwatch","MultiSwatchOption","data-label","onClickThumbnail","MultiThumbnailOption","onClickMutliButton","MultiButtonOption","Button","onPurchase","available","onNotifyLater","useCallback","appState","opt","params","sale_item_id","option_id","remove","updateSaleContext","subscribed","isOptionMulti","applePayTest","selectedQuantity","price","WebkitAppearance","ApplePayButtonType","ApplePayButtonStyle","FancyApplePay","clicked","salesOptionsAvailable","country","seller","seller_id","requestPurchase","testmode","trace","optionValueFunction","saleNamePrinter","Fancy","discounting","retailPrice","discountPercentage","sale","floatFormatMinusTwo","numberFormat","SaleItemSidebarHead","CurrencyPopup","currentCurrency","renderCurrencyPopup","saleOption","optionIsMulti","sale_id","personalization","CartAPI","addItem","close","Cart","openPopup","os","total","displayItems","checkAvailability","applePayDisplay","getInitialMultiOptionState","updateSaleOptionIDFromMultiOptionState","presetOptionId","getLocationArgPairs","String","selectedOptionArray","selectedOption","every","extractSaleOptionIDFromMultiOptionState","amendedID","amendSaleOptionFromMultiOptionState","nextSelected","button","dropdown","some","indexOfType","attr","extend","onClickMultiOptionGen","convertCurrency","initializeMultiOption","checkApplePay","nextSaleOptionID","_o","mos","$so","escapeSelector","is","click","paymentRequest","nonSoldout","selectedNonSoldoutOption","nextValue","nsc","priceChanges","currencyChanges","applePayButton","showInfo","parseFloat","quantitySelectRange","range","showSelectbox","SaleItemOptionsExpander","handleOptionChange","size_guide_id","SizeGuidePopup","personalizable","handlePersonalizationChange","handleQuantityChange","handlePurchase","sio","getInitialStoreState","contextName","visible","userCountry","followStore","following","followUser","currencyMoney","currencySymbol","contexts","ThingTypeMeta","thingContext","PlainThingType","args","objectArgs","mergeObjectArgs","owner","user","META","getThingType","SaleItemType","createEmptyObject","sales_available","review_rating","review_count","size_chart_ids","GiftcardType","HotelType","hotel","VanityType","LaunchAppType","has_launch_app","ThingTypes","AttachingType","ComparingType","loaded","lastFullyRenderedThingID","populateThingContext","thingData","URLMeta","extractMetaFromURL","combineReducers","action","scrollEvent","updateShallow","__FancyUser","cookie","current_country_code","Boolean","seller_follow","followType","nextFancydState","saleOptionInclSales","nextContext","currency_code","middlewares","thunk","configureStore","reducer","rootReducer","preloadedState","contextKey","middleware","getDefaultMiddleware","serializableCheck","prepend"],"mappings":"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","file":"131.9d39b2a1ef60d2101cba.js","sourcesContent":["// Generate `key: String(key)` structure by given string key arguments\nfunction constantGen() {\n    var keys = [].slice.call(arguments);\n    return keys.reduce((prev, next) => {\n        prev[next] = next;\n        return prev;\n    }, {});\n}\n\nvar C = constantGen(\n  'UPDATE_APP_CONTEXT',\n  // Loading\n  'REQUEST_THING',\n  'REQUEST_THING_FAILURE',\n  'LOAD_THING',\n\n  // UI Actions\n  'OPEN_THING',\n  'CLOSE_THING',\n\n  // Comment form suggestion\n  'SET_USERNAME_KEYWORD',\n  'LOAD_SUGGESTION',\n\n  // Thumbnail\n  'SET_THUMBNAIL_INDEX',\n\n  // Follow\n  'TOGGLE_FOLLOW',\n  'CANCEL_FOLLOW',\n  'COMPLETE_FOLLOW',\n\n  // Fancy\n  'TOGGLE_FANCY',\n  'CANCEL_FANCY',\n  'COMPLETE_FANCY',\n\n  // Saleitem\n  'UPDATE_SALE_CONTEXT'\n);\n\nexport default C;\n","import C from './action-constants';\n\n\n// Action on requesting thing starts\nexport function requestThing(pendingID) {\n    return {\n        type: C.REQUEST_THING,\n        status: 'request',\n        pendingID\n    };\n}\n\n// Action on requesting thing fails\nexport function requestThingFail() {\n    return {\n        type: C.REQUEST_THING_FAILURE,\n        status: 'failed'\n    };\n}\n\n// action on loading request result\nexport function loadThing(ID, data) {\n    return {\n        type: C.LOAD_THING,\n        status: 'idle',\n        ID,\n        data\n    };\n}\n\n// Action on close overlay\nexport function openThing() {\n    return {\n        type: C.OPEN_THING\n    };\n}\n\n// Action on close overlay\nexport function closeThing() {\n    return {\n        type: C.CLOSE_THING,\n        ID: null,\n        pendingID: null,\n        thing: null\n    };\n}\n\n\nexport function setThumbnailIndex(thumbnailIndex) {\n    return {\n        type: C.SET_THUMBNAIL_INDEX,\n        thumbnailIndex,\n    };\n}\n\nexport function toggleFollow(followType) {\n    return {\n        type: C.TOGGLE_FOLLOW,\n        followType\n    };\n}\n\nexport function cancelFollow(followType) {\n    return {\n        type: C.CANCEL_FOLLOW,\n        followType\n    };\n}\n\nexport function completeFollow(followType) {\n    return {\n        type: C.COMPLETE_FOLLOW,\n        followType\n    };\n}\n\nexport function toggleFancy(thingID) {\n    return {\n        type: C.TOGGLE_FANCY,\n        thingID,\n    };\n}\n\nexport function cancelFancy(thingID) {\n    return {\n        type: C.CANCEL_FANCY,\n        thingID,\n    };\n}\n\nexport function completeFancy(thingID, fancyd_count) {\n    return {\n        type: C.COMPLETE_FANCY,\n        thingID,\n        fancyd_count\n    };\n}\n\nexport function updateAppContext(contextObject) {\n    return {\n        type: C.UPDATE_APP_CONTEXT,\n        context: contextObject\n    };\n}\n","// App state that does not usually change during app lifecycle. (i.e. Login state)\n\n// module-level login state object and setter\nconst state : { viewer: {}; loggedIn: Boolean; } = { viewer: {}, loggedIn: false };\nexport default state;\n\nexport function updateState(k, v) {\n    state[k] = v;\n}\n","import { index } from 'fancyutils';\n\n// Cache bucket\nexport class ThingCache {\n    things = {};\n    sales = {};\n    count = 0;\n    static SALES = 'sales';\n    static THINGS = 'things';\n\n    exists = (id, type, ignoreCralwed) => {\n        const cac = this.get(id, type);\n        var existence = cac != null && typeof cac === 'object';\n        if (ignoreCralwed) {\n            existence = existence && cac.isCrawled !== true;\n        }\n        return existence;\n    }\n\n    // resolver function\n    _get = (id) => {\n        return this[ThingCache.THINGS][id] || this[ThingCache.SALES][id] || null;\n    }\n\n    get = (id, type = ThingCache.THINGS) => {\n        const cac = this[type][id] || this.getCrawled(id, type);\n        return cac;\n    }\n\n    getCrawled = (id, type) => {\n        const cac = this[type][id];\n        if (cac && cac.isCrawled) {\n            return cac;\n        } else {\n            return null;\n        }\n    }\n\n    add = (id, data, type) => {\n        // to add, cache should not be exist or crawled one\n        const cac = this[type][id];\n        if (\n            cac == null || \n            cac.isCrawled === true\n        ) {\n            this[type][id] = data;\n            // Store thing information as well\n            if (type === ThingCache.SALES && data.id) {\n                this[ThingCache.THINGS][data.id] = data;\n            }\n            this.count += 1;\n        } else {\n            console.warn('cache.add(): Cache overwrite');\n        }\n    }\n\n    remove = (id, type) => {\n        if (this[type][id]) {\n            delete this[type][id];\n            this.count -= 1;\n        } else {\n            console.warn('cache.remove(): Non-existing cache removal');\n        }\n    }\n\n    // selector = 'a.b.c'\n    update = (id, type = ThingCache.THINGS, selector, value) => {\n        if (selector == null) {\n            console.warn('ThingCache#update(): selector is empty');\n            return;\n        }\n        const t = this.get(id, type);\n        if (t) {\n            index(t, selector, value);\n        }\n    }\n\n    // sweep() {\n    //     // TODO: should sweep cache if too many cache added by looking `cache.count`\n    // }\n}\n\nexport const cache = new ThingCache();\nwindow.__THING_CACHE = cache;\n","import { alertify, isEmpty } from \"fancyutils\";\nimport {\n    SaleObject,\n    SaleContext,\n    ThingObject,\n    FancyReduxState,\n    User,\n    ThingImage,\n    OverlayPropsV1,\n} from \"ftypes\";\nimport { SaleItem } from \"_static/modules/ThingDetail\";\n\nconst { gettext, _ } = window;\n\nexport function mapStateToThingProps(state: FancyReduxState): OverlayPropsV1 {\n    const {\n        appContext,\n        thing: { data, isFetching, status },\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    } = state;\n\n    return {\n        appContext,\n        status,\n        thing: data,\n        isFetching,\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    };\n}\n\nexport function getSales(type: string, thing: ThingObject) {\n    return thing.sales;\n}\n\nexport function getDescription(type: string, thing: ThingObject) {\n    if (type === \"sales\") {\n        return thing.sales.description;\n    } else if (type === \"hotel\") {\n        return thing.hotel_search.details.propertyDescription;\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSaleItemId(thing: ThingObject, viewer: User) {\n    if (viewer && viewer.is_admin_any) {\n        if (thing.sales) {\n            return thing.sales.id;\n        } else if (thing.inactive_sales) {\n            return thing.inactive_sales.id;\n        }\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSeller(thing: ThingObject) {\n    if (thing.sales) {\n        return thing.sales.seller;\n    } else if (thing.inactive_sales) {\n        return thing.inactive_sales.seller;\n    }\n}\n\nexport function getDetailType(thing: ThingObject) {\n    if (thing.hotel_search) {\n        return \"hotel\";\n    } else if (thing.sales_available && thing.type !== \"vanity_number\") {\n        return \"sales\";\n    } else if (!thing.sales_available && !thing.has_launch_app && thing.type !== \"giftcard\") {\n        return \"urlOnly\";\n    }\n}\n\nexport function isSalesOptionsAvailable<T extends SaleItem>(sales: T | null) {\n    return sales != null && !isEmpty(sales.options);\n}\n\nexport function getFirstSaleOption(sales: SaleItem, ignoreEmptySaleOption = false) {\n    if (isSalesOptionsAvailable(sales)) {\n        return sales.options[0];\n    } else if (ignoreEmptySaleOption === false) {\n        return sales || null;\n    }\n}\n\nexport function getCurrentSaleOption<T extends SaleItem>(sales: T, saleContext: SaleContext = {}, ignoreEmptySaleOption = false) {\n    const { saleOptionID } = saleContext;\n\n    if (isSalesOptionsAvailable<T>(sales)) {\n        if (saleOptionID) {\n            const opts = _(sales.options).filter((prop) => prop.id === saleOptionID);\n            if (opts[0] == null) {\n                console.warn(\"saleOption should not be null!\");\n            }\n\n            return opts[0] == null\n                ? {\n                      id: 0,\n                      discount_percentage: \"0.0\",\n                      quantity: 0,\n                      soldout: true,\n                      retail_price: 0,\n                      name: '',\n                  }\n                : opts[0];\n        } else {\n            return sales.options[0];\n        }\n    } else if (ignoreEmptySaleOption === false) {\n        return sales;\n    }\n}\n\nexport function formatPrice(amount: number, currency: string) {\n    if (currency == \"BTC\") return amount + \"\";\n    var newPrice = amount.toFixed(2) + \"\";\n    var regex = /(\\d)(\\d{3})([,\\.]|$)/;\n    while (regex.test(newPrice)) {\n        newPrice = newPrice.replace(regex, \"$1,$2$3\");\n    }\n    if (window.numberType === 2) {\n        newPrice = newPrice.replace(/,/g, \" \").replace(/\\./g, \",\");\n    }\n    return newPrice;\n}\n\n// sales: thing.sales\nexport function getDomesticDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    if (sales.expected_delivery_day_1) {\n        date += sales.expected_delivery_day_1;\n    }\n    if (sales.expected_delivery_day_2) {\n        date += \" - \" + sales.expected_delivery_day_2;\n    }\n    return date;\n}\n\n// sales: thing.sales\nexport function getIntlDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    // TODO: use moment for locale string\n    if (sales.expected_delivery_day_intl_1) {\n        date += sales.expected_delivery_day_intl_1;\n    }\n    if (sales.expected_delivery_day_intl_2) {\n        date += \" - \" + sales.expected_delivery_day_intl_2;\n    }\n    return date;\n}\n\nexport function currencyIsUSD({ saleContext }: { saleContext: SaleContext }) {\n    return saleContext.currencyCode === \"USD\";\n}\n\n// [sale option id]: { true | false }\nconst saleOptionWaitingRegistry = {};\nwindow.saleOptionWaitingRegistry = saleOptionWaitingRegistry;\nexport function setWaiting(chosenSaleOptionID, setResult) {\n    saleOptionWaitingRegistry[chosenSaleOptionID] = setResult;\n}\nexport function getWaiting<T extends SaleItem>(sales: T, saleContext) {\n    if (sales == null) {\n        return null;\n    }\n    if (saleContext.waiting != null) {\n        return saleContext.waiting;\n    }\n\n    // https://app.asana.com/0/86925821949642/160205241997173\n    // It could be a bit weird for future, but design-side decision\n    if (sales.waiting) {\n        return sales.waiting;\n    }\n\n    const chosenSaleOption = getCurrentSaleOption(sales, saleContext);\n    // options is SaleItem\n    if (sales.id === chosenSaleOption.id) {\n        return sales.waiting;\n        // option is SaleOption\n    } else {\n        if (saleOptionWaitingRegistry[chosenSaleOption.id] != null) {\n            return saleOptionWaitingRegistry[chosenSaleOption.id];\n        } else if (chosenSaleOption.waiting != null) {\n            return chosenSaleOption.waiting;\n        }\n    }\n}\n\nfunction fillArray(original: Array<unknown> /*sparse?ArrayToFill*/, filler: Array<unknown>) {\n    const ol = original.length;\n    const fl = filler.length;\n    const sparseIdxs = [];\n    // Find sparse indexes first.\n    for (let j = 0; j < ol; j++) {\n        if (!(j in original)) {\n            sparseIdxs.push(j);\n        }\n    }\n    for (let i = 0; i < fl; i++) {\n        // if sparse indexes are all in (or nonexist), push leftovers to tail\n        if (i > sparseIdxs.length - 1) {\n            original.push(filler[i]);\n        } else {\n            original[sparseIdxs[i]] = filler[i];\n        }\n    }\n    return original;\n}\n\nlet tid;\nlet optionId: undefined;\nlet hotelImages: ThingImage[] | undefined | [];\nlet salesImages;\nlet thingImages;\nexport function getSaleImages(thing: ThingObject, option, thumbnailsLimit?: number) {\n    if (thing.hotel_search != null) {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n\n            hotelImages = <ThingImage[]>thing.hotel_search.images.map((img) => ({\n                src: img.url,\n                thumbnail_src: img.thumbnailUrl,\n                width: img.width,\n                height: img.height,\n            }));\n            hotelImages.unshift(thing.image_resized_max);\n        }\n        return hotelImages;\n    } else if (thing.sales != null) {\n        const images = [];\n        fillArray(images, thing.images);\n        if (option && option.images && option.images.length > 0) {\n            fillArray(images, option.images);\n        }\n        salesImages = images;\n        if (option) {\n            optionId = option.id;\n        }\n        if (thing && thing.sales && thing.sales.video) {\n            images.unshift(thing.sales.video);\n        }\n        return salesImages;\n\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            // optionId = option ? option.id : null;\n            // FIXME: do this somewhere else\n            if (thing.image_resized_max == null) {\n                if (thing.image.src) {\n                    thing.image_resized_max = {\n                        src: thing.image.src,\n                        width: thing.image.width,\n                        height: thing.image.height,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                } else {\n                    thing.image_resized_max = {\n                        src: \"/_ui/images/common/blank.gif\",\n                        width: 1,\n                        height: 1,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                }\n            }\n\n            let images = [];\n\n            if (thing.image_resized_max) {\n                images.push(thing.image_resized_max);\n            }\n\n            if (thing.images && thing.images[0]) {\n                images.push(thing.images[0]);\n            }\n\n            // set sale images\n            if (thing && thing.sales && thing.sales.video) {\n                let video = { src: thing.sales.video.thumbnail_url, thumbType: \"video\" };\n                if (thing.sales.video.position > 0) {\n                    images[thing.sales.video.position] = video;\n                } else {\n                    // set video to first unless the position is set\n                    images.unshift(video);\n                }\n            }\n            if (thing.sales.images) {\n                fillArray(images, thing.sales.images);\n            }\n            salesImages = images;\n        }\n        if (option && optionId !== option.id) {\n            optionId = option.id;\n            if (salesImages == null) {\n                salesImages = [];\n            }\n            if (option.images && option.images.length > 0) {\n                const images = salesImages.filter((img) => img.option_id == null);\n                fillArray(images, option.images);\n                salesImages = images;\n            }\n        }\n\n        return _.isNumber(thumbnailsLimit) && thumbnailsLimit > 0\n            ? salesImages.filter((image, idx) => idx < thumbnailsLimit && image.src)\n            : salesImages;\n    } else {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            if (thing.image_resized_max) {\n                thingImages = [thing.image_resized_max];\n            } else if (thing.image) {\n                thingImages = [thing.image];\n            } else {\n                thingImages = [];\n                // || (option && optionId !== option.id)\n            }\n        }\n        return thingImages;\n    }\n}\n\nexport function isVanityQueriable(props: any, suppress: boolean) {\n    var { AC, minPrice, maxPrice, keyword } = props;\n\n    keyword = $.trim(keyword);\n    AC = $.trim(AC);\n    minPrice = minPrice != null ? minPrice : \"0\";\n    minPrice = $.trim(minPrice).replace(\",\", \"\").replace(\"$\", \"\");\n    maxPrice = $.trim(maxPrice).replace(\",\", \"\").replace(\"$\", \"\");\n\n    const original_labels = alertify.labels;\n    if (AC !== \"\") {\n        if (_.isNaN(parseInt(AC, 10)) || AC.length !== 3) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Invalid area code. Area code should be 3 digits.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (minPrice !== \"\") {\n        if (_.isNaN(parseInt(minPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check min price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n\n        if (parseInt(minPrice, 10) >= parseInt(maxPrice, 10)) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"The max price number should be bigger than min price number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (maxPrice !== \"\") {\n        if (_.isNaN(parseInt(maxPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check max price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (keyword !== \"\") {\n        if (keyword.length < 4) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please enter 4 or more characters.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    return true;\n}\n\nexport function getSafeNameProp({ emojified_name, name }: ThingObject) {\n    if (emojified_name) {\n        return { dangerouslySetInnerHTML: { __html: emojified_name } };\n    } else {\n        return { children: name };\n    }\n}\n\nexport function isVideoUploadable(thing: ThingObject): boolean {\n    if ((thing && thing.hotel_search) || thing.metadata) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction salesAvailable(thing: ThingObject): boolean {\n    if (!isEmpty(thing.sales)) {\n        return thing.sales_available;\n    }\n    return false;\n}\n\nexport function getThingName(thing: ThingObject) {\n    if (thing.type === \"giftcard\") {\n        return gettext(\"Fancy Gift Card\");\n    } else if (salesAvailable(thing)) {\n        return thing.sales.name;\n    } else {\n        return thing.name;\n    }\n}\n","import { OverlayProps, ReduxProps } from 'ftypes';\nimport React from 'react';\n\nexport function getFancyContextDefaultValue() {\n  return {\n      appContext: {},\n      thing: {},\n      followContext: {},\n      fancyContext: {},\n      slideContext: {},\n      saleContext: {},\n      dispatch: () => {},\n  }\n}\n\n// @ts-ignore\nconst FancyContext = React.createContext<OverlayProps & ReduxProps>(getFancyContextDefaultValue());\n\nexport const useFancy = () : OverlayProps & ReduxProps => {\n  return React.useContext(FancyContext);\n}\n\nexport default FancyContext;\n","import React from 'react';\nimport { Display } from \"fancymixin\";\nimport classnames from 'classnames';\nimport { xmlUtil } from \"fancyutils\";\n\nexport default class AdminPopup extends React.Component {\n    static popupName = 'thing-admin';\n    state = {\n        show_on_homepage: null,\n        date_published: null, \n        exclude_from_popular: false,\n        show_in_search: true,\n        optionSaving: false,\n        ownerSaving: false,\n        mergeSaving: false,\n    };\n    \n    \n    componentDidMount() {\n        const that = this;\n        $.dialog(AdminPopup.popupName).$obj.on('open', () => {\n            const { thing: { show_on_homepage, date_published, exclude_from_popular, show_in_search }  } = that.props;\n            that.setState( { show_on_homepage, date_published, exclude_from_popular, show_in_search } );\n        });\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AdminPopup.popupName).center();\n    }\n    \n    handleSaveOptions = () => {\n        const { thing } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving } = this.state;\n        if (optionSaving) return false;\n        const payload = { thing_id: thing.id, show_on_homepage, exclude_from_popular, show_in_search }\n        if (show_on_homepage) {\n            let inputDate = new Date(date_published);\n            if (isNaN(inputDate)) {\n                alert(\"invalid date - must be in format of 2020-01-01 10:10:10\");\n                return false;\n            }            \n            payload['date_published'] = inputDate.toISOString().replace(/T/, \" \").split(\".\")[0];\n        }\n        this.setState({optionSaving:true});\n        $.post('/manage-newthing.json', payload).then((json) => {\n            if (json.status_code == 1) {\n                Object.assign(thing, payload);\n                alert(\"Updated!\");\n            } else {\n                alert(json.message || \"Failed to save the changes\");\n            }\n            this.setState({optionSaving:false})\n        }).fail(() => {\n            alert(\"Something went wrong!\");\n            this.setState({optionSaving:false})\n        });\n    }\n\n    handleChangeOwner = () => {\n        const { thing } = this.props;\n        if (this.state.ownerSaving) return false;\n        if (this.changeOwnerEl == null) return false;\n        const new_owner = this.changeOwnerEl.value.trim();\n        if (new_owner.length == 0) {\n            alert(\"Please enter a username.\");\n            return false;\n        }\n        if (new_owner.toLowerCase() == thing.thing_owner.username.toLowerCase()) {\n            alert(\"The thing is already owned by the user.\");\n            return false;\n        }\n\n        if (window.confirm(`Do you want to change the current thing's owner to ${new_owner}?`)) {\n            this.setState({ownerSaving: true})\n            $.ajax({\n                type: \"post\",\n                url: \"/change_new_thing_owner.xml\",\n                data: { new_owner_name: new_owner, thing_id: thing.id, new_thing_id: thing.ntid, old_user_id: thing.thing_owner.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    if (xmlUtil.isSuccess(xml)) {\n                        alert(\"Done!\");\n                        location.reload();                        \n                    } else if (xmlUtil.isFail(xml)) {\n                        alert(\n                            $(xml)\n                                .find(\"message\")\n                                .text()\n                        );\n                    }\n                })\n                .fail(() => {\n                    alert(\"There was an error.\");\n                })\n                .always(() => {\n                    this.setState({ownerSaving: false})\n                });\n        }\n        return false;\n    }\n\n    handleMergeThings = () => {\n\n    }\n\n    render() {\n        const { \n            thing, \n            thing: { sales },\n        } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving, ownerSaving, mergeSaving } = this.state;\n        return (\n          <>\n          \t<p className=\"ltit\">{thing.name}</p>\n            <div className=\"thing-admin-body\">\n                <ul className=\"thing-info\">\n                <li><em>Sale ID</em> {sales.id}</li>\n                    <li><em>Thing ID</em> {thing.id}</li>\n                    <li><em>Thing Owner</em> {thing.thing_owner.username}</li>\n                    <li className=\"buttons\">\n                        <a className=\"btns-blue-embo\" href={`/merchant/products/${sales.id}`} target=\"_blank\">Edit Sale</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-sale-orders-by-thing-id?thing_id=${thing.id}`} target=\"_blank\">View Orders</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-users-by-cart-item?sale_id=${sales.id}`} target=\"_blank\">View Carts</a>\n                    </li>\n                </ul>\n                <div className=\"thing-options\">\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-on-homepage\" checked={!!show_on_homepage}\n                        onChange={(event) => this.setState({ show_on_homepage: event.target.checked })}\n                        /> Show on Homepage</label>\n                        <input className=\"text\" type=\"text\" name=\"date-published\" placeholder=\"2020-01-02 10:20:30\"\n                            style={Display.NoneIf(!show_on_homepage)} value={date_published || ''}\n                            onChange={(event) => {this.setState({ date_published: event.target.value })}}\n                            />\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"exclude-from-popular\" checked={!!exclude_from_popular}\n                            onChange={(event) => this.setState({ exclude_from_popular: event.target.checked })}\n                        /> Exclude from Popular</label>\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-in-search\" checked={!!show_in_search}\n                            onChange={(event) => this.setState({ show_in_search: event.target.checked })}\n                        /> Show in Search</label>\n                    </p>\n                    <p>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": optionSaving })} onClick={this.handleSaveOptions}>Save Changes</button>\n                    </p>                    \n                </div>\n                <div className=\"thing-actions\">\n                    <p>\n                        <label>Change Owner</label>\n                        <input type=\"text\" name=\"change_owner\" placeholder=\"Enter new username\" ref={(el) => {this.changeOwnerEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": ownerSaving })} onClick={this.handleChangeOwner}>Change</button>\n                    </p>\n                    {/*\n                    <p>\n                        <label>Merge Things</label>\n                        <input type=\"text\" name=\"merge_thing_id\" placeholder=\"Enter Thing ID\" ref={(el) => {this.mergeThingEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": mergeSaving })} onClick={this.handleMergeThings}>Merge</button>\n                    </p>*/}\n                </div>\n\n            </div>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React from 'react';\nimport classnames from 'classnames';\nimport { closePopup, copyToClipboard } from 'fancyutils';\n\nexport default class SimpleSharePopup extends React.Component {\n    static popupName = 'minimum-share';\n\n    constructor(props) {\n        super(props);\n        const { thing, viewer } = props;\n        let url = `https://fancy.com${thing.url}`;\n        if (viewer && viewer.username) {\n            let connector = ~url.indexOf('?') ? '&' : '?';\n            url = `${url}${connector}ref=${viewer.username}`\n        }\n        console.log(url)\n        this.state = {\n            shareUrl: url,\n            urlCopied: false,\n        }\n    }\n\n    handleCancelClick = (event) => {\n        event.preventDefault();\n        closePopup(SimpleSharePopup.popupName);\n    }\n\n    componentDidUpdate(){\n        $.dialog(SimpleSharePopup.popupName).center();\n    }\n\n    handleCopyLink = (event) => {\n        console.log('handleCopyLink');\n        const { shareUrl } = this.state;\n        console.log('handleCopyLink ' + shareUrl );\n        copyToClipboard(shareUrl);\n        this.setState({ urlCopied: true });\n        setTimeout(() => {\n            this.setState({ urlCopied: false });\n        }, 2000);\n    }\n\n\n    render() {\n        const { thing, viewer } = this.props;\n        const { shareUrl, urlCopied } = this.state;\n\n        return (\n          <>\n          \t<p className=\"ltit\">Share</p>\n            <ul>\n                <li><a href=\"#\" className=\"btn-copy-link link\" onClick={this.handleCopyLink}>{urlCopied ? \"Copied to clipboard\" : \"Copy link\"}</a></li>\n                <li><a \n                    href={`http://pinterest.com/pin/create/link/?url=${encodeURIComponent(shareUrl)}&media=${thing.images ? encodeURIComponent(thing.images[0].image_url) : \"\"}&description=${encodeURIComponent(thing.name)}`}\n                    target=\"_blank\" className=\"pin\">Share to Pinterest</a></li>\n                <li><a \n                    href={`mailto:?body=Check%20out%20${encodeURIComponent(thing.name)}%20on%20Fancy!%0A%0A${encodeURIComponent(shareUrl)}&subject=${encodeURIComponent(thing.name)}%20on%20Fancy`}\n                    target=\"_blank\" className=\"email\">Share via email</a></li>\n            </ul>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { closePopup, KEYS, MP, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nexport default class AddlistPopup extends Component {\n    static popupName = 'add-list';\n    state = {\n        lists: [],\n        listSearchQuery: '',\n        listCreationQuery: '',\n        listCreating: false,\n    };\n\n    handleDialogOpen = () => {\n        this.setState({ lists: [], listSearchQuery: '', listCreationQuery: '' });\n        this.drawUserList()\n        setTimeout(() => {\n            this.listSearchInput.focus();\n        }, 0);\n\n    }\n    componentDidMount() {\n        $.dialog(AddlistPopup.popupName).$obj.on('open', this.handleDialogOpen);\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AddlistPopup.popupName).center();\n    }\n\n    drawUserList() {\n        const objectId = this.props.objectId;\n        getListCheckbox({\n            objectId,\n            callback: res => { this.setState(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setState({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (this.state.listCreating) return;\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        this.setState({ listCreating: true })\n        // save new list\n        updateList({\n            objectId,\n            createList: listCreationQuery,\n            callback: (success, updated) => {\n                if (success) {\n                    const { lists } = this.state;\n                    MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    this.setState( {\n                        listCreationQuery: '', listCreating: false,\n                        lists: [ ...updated, ...lists ],\n                    });\n                }\n            }\n        })\n    }\n\n    handleListItemToggle = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = Number(targ.getAttribute('data-listid'));\n        const theList = lists.filter(list => list.id === selectedListId)[0];\n        const prevAdded = theList.added;\n        theList.added = !theList.added;\n        const eventName = theList.added ? \"Add to List\" : \"Remove from List\";\n        this.setState({ lists })\n\n        const callback = (success, updated) => {\n            const { lists } = this.state;\n            if (success) {\n            } else {\n                const theList = lists.filter(list => list.id === selectedListId)[0];\n                theList.added = prevAdded;\n            }\n            this.setState({ lists })\n            MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n        };\n\n        const update = { objectId, callback };\n\n        if (theList.added) update['checked'] = [theList.id];\n        else update['unchecked'] = [theList.id];\n        updateList(update)\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setState({ listCreationQuery: event.target.value });\n    }\n\n    render() {\n        var { objectId } = this.props;\n        var {\n            lists,\n            listSearchQuery,\n            listCreationQuery,\n            listCreating,\n        } = this.state;\n\n        return (\n            <>\n                <p className=\"ltit\">Add to collections</p>\n                <fieldset className=\"search\">\n                    <input type=\"text\" placeholder=\"Search\" className=\"text\" \n                        value={listSearchQuery} ref={(element) => {this.listSearchInput = element;}}\n                        onChange={this.handleListSearch} />\n                </fieldset>\n                <div className=\"list\">\n                    <ul ref={(el) => {this.lists = el;}}>\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style} className={classnames({ \"added\": list.added })}>\n                                <label>{list.name}</label>\n                                <button\n                                    data-listid={list.id} \n                                    onClick={this.handleListItemToggle}\n                                    className=\"btns-blue-embo\">{list.added ? \"Remove\" : \"Add\"}</button>\n                            </li>\n                        )\n                    })}\n                    </ul>\n                </div>\n                <fieldset className=\"create\">\n                    <input \n                        type=\"text\" placeholder=\"Create new collection\" \n                        ref={(element) => {this.quickCreateList = element;}}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}/>\n                    <button className={classnames(\"btn-create\", { \"loading\": listCreating })} style={Display.NoneIf($.trim(listCreationQuery).length == 0)}\n                        onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </fieldset>\n                <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n            </>\n        );\n    }\n}\n\nfunction getListCheckbox({ objectId, callback }) {\n    $.get('/get_list_checkbox.json', { tid: objectId }).done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            closePopup(AddlistPopup.popupName);\n        }\n        callback && callback({ lists: resp.lists })\n    },)\n    .error(err => { \n        alertify.alert(\"Please try again later.\");\n        console.warn(err); \n        closePopup(AddlistPopup.popupName);\n    });\n}\n\nfunction updateList({ objectId, checked, unchecked, createList, callback }) {\n    const payload = { tid: objectId };\n    if (checked) payload['add_list_ids'] = checked.join(',');\n    if (unchecked) payload['remove_list_ids'] = unchecked.join(',');\n    if (createList) payload['new_list'] = createList;\n\n    $.post('/update_list_checkbox.json', payload)\n    .done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            callback(false, null);\n        } else {\n            callback(true, resp.lists);\n        }\n    })\n    .error(err => { \n        console.warn(err); \n        alertify.alert(\"Please try again later.\");\n        callback(false, []);\n    })\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { FancyUser, MP, renderPopup } from \"fancyutils\";\nimport { useDispatch } from 'react-redux'\nimport { FancydByPopupV4 } from 'common-components';\n\nimport { useFancy } from \"../FancyContext\";\nimport AdminPopup from \"../../popup/AdminPopup\"\nimport SimpleSharePopup from \"../../popup/SimpleSharePopup\"\nimport AddlistPopup from \"../../popup/AddlistPopup\"\nimport { toggleFancy, getCordialProperties } from \"../../../action/action-helpers\";\n\nfunction Favorite() {\n    const { appContext, thing, fancyContext } = useFancy();\n    const dispatch = useDispatch();\n\n    const handleClick = (event: React.MouseEvent) => {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log('favortie');\n        if (!appContext.loggedIn) {\n            window.require_login(null, \"fancy_thing\", thing.id);\n            return;\n        }\n\n        if (fancyContext.loading) {\n            return;\n        }\n\n        dispatch(toggleFancy(thing.id));\n\n        if (!fancyContext.fancyd) {\n            MP(\"Fancy\", { thing_id: thing.id });\n            try {\n                window.crdl('event', 'favorite_item', getCordialProperties(thing));\n            } catch (e) {\n            }\n        } else {\n            MP(\"Unfancy\", { thing_id: thing.id });\n        }\n    };\n\n    return (\n        <a className={classnames(\"button button-static fancy _count\", { fancyd: fancyContext.fancyd })} onClick={handleClick}>\n            Favorite\n        </a>\n    );\n}\n\nexport default function ActionButtons() {\n    const {\n        appContext: { viewer, loggedIn },\n        thing,\n        thing: { id: objectId },\n        fancyContext,\n    } = useFancy();\n\n    let msg;\n    if (thing.fancyd_friends) {\n        const cnt = fancyContext.fancyd_count - 1;\n        if (cnt > 0) {\n            msg = <>\n                Favorited by <a href={thing.fancyd_friends[0].url}>{thing.fancyd_friends[0].full_name}</a> and <b>{cnt} other{(cnt > 1) ? `s` : ``}</b>\n            </>\n        } else {\n            msg = <>Favorited by <a href={thing.fancyd_friends[0].url}>{thing.fancyd_friends[0].full_name}</a></>\n        }\n    } else {\n        msg = <>{fancyContext.fancyd_count} people favorited</>\n    }\n\n    return (\n        <>\n            <span className=\"_fancyd fancyd_user\" onClick={(e : React.MouseEvent<HTMLSpanElement>) => {\n                if (e.target.tagName === 'A') {\n                    return;\n                }\n                renderPopup(FancydByPopupV4, { objectId, objectType: 'thing', loggedIn: FancyUser.loggedIn, viewerId: FancyUser.id });\n            }}>{msg}</span>\n            <a onClick={(event) => {\n                event.preventDefault();\n                if (!loggedIn) {\n                    window.require_login();\n                    return;\n                }\n                renderPopup(AddlistPopup, { objectId });\n            }} className=\"add-list\">Add to List</a>\n            <div className=\"figure-button action-button-v2\">\n                {viewer.is_admin_any && (\n                    <a className=\"edit\"\n                        onClick={(event) => {\n                            event.preventDefault();\n                            renderPopup(AdminPopup, { viewer, thing });\n                        }}>Edit</a>\n                )}\n                <Favorite />\n                <a\n                    className=\"btn-share\"\n                    onClick={(event) => {\n                        event.preventDefault();\n                        renderPopup(SimpleSharePopup, { viewer, thing });\n                    }}>\n                    Share\n                </a>\n            </div>\n        </>\n    );\n}\n","import { minmax } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\nimport { ThingImageOrVideo } from \"ftypes\";\n\n// TODO: cache per (thing id + image index)\nconst zoomBoxMaximumSize = 240;\nconst zoomScale = 1.5;\n\nconst getBoundarySize = () => {\n    const $el = $(\n        \".thing-detail-container .figure-section .swiper-container.gallery-top .active-slide\"\n    ).eq(0);\n\n    if ($el.length !== 1) {\n        window.DEBUG && console.warn('getBoundarySize(): warning: $el.length is ', $el.length);\n    }\n\n    return {\n        $el,\n        width: $el.width()!,\n        height: $el.height()!,\n    };\n};\ntype BS = ReturnType<typeof getBoundarySize>;\n\nconst getZoomBoxSize = (bs: BS) => Math.min(bs.width / 3, zoomBoxMaximumSize);\nconst getZoomMargin = (bs: BS) => (getZoomBoxSize(bs) - 4) / 2;\n\nconst zidCac: { [o: string]: any } = {};\nconst getZoomImageDimension = (img: ThingImageOrVideo, bs = getBoundarySize()) => {\n    if (zidCac[img.image_url]) {\n        return zidCac[img.image_url];\n    }\n    const zoomMargin = getZoomMargin(bs);\n    // const imageSize = calculateImageSize(img);\n\n    const ret = {\n        width: bs.width * zoomScale /* * (imageSize.larger === \"height\" ? imageSize.proportion : 1) */ + zoomMargin,\n        height: bs.height * zoomScale + zoomMargin,\n        /* ((b.height * imageSize.height) / imageSize.width) *\n                (imageSize.larger === \"width\" ? imageSize.proportion : 1) *\n                zoomScale +\n            zoomMargin ,*/\n    };\n    zidCac[img.image_url] = ret;\n    return ret;\n};\n\nconst getImageMeta = (bs: BS) => {\n    let width, height, marginHoriz, marginVert;\n\n    const $fig = $(\".thing-detail-container .figure-section .swiper-container.gallery-top img:eq(0)\");\n    width = $fig.width()!;\n    height = $fig.height()!;\n    marginHoriz = 0;\n    if (width > height) {\n        marginHoriz = 0;\n        marginVert = (bs.height - height) / 2;\n    } else {\n        marginHoriz = (bs.width - width) / 2;\n        marginVert = 0;\n    }\n    return { width, height, marginHoriz, marginVert };\n};\n\nexport const getNextZoomImageStyle = (img: ThingImageOrVideo, pageX: number, pageY: number) => {\n    const bs = getBoundarySize();\n    const $wrapper = bs.$el;\n\n    if (!$wrapper.length) {\n        return Display.None;\n    }\n\n    const boundaryWidth = bs.width;\n    const boundaryHeight = bs.height;\n    const meta = getImageMeta(bs);\n\n    const offset = $wrapper.offset()!;\n    const left = pageX - offset.left;\n    const top = pageY - offset.top;\n\n    const topPosition = top - (boundaryHeight - meta.height) / 2;\n\n    const showZoomImage = left > 0 && topPosition > 0 && topPosition < meta.height;\n\n    const zoomBoxSize = getZoomBoxSize(bs);\n    const zoomMargin = getZoomMargin(bs);\n\n    if (showZoomImage) {\n        const zd = getZoomImageDimension(img, bs);\n        const zoomImageContainerX = minmax(\n            left - zoomMargin,\n            meta.marginHoriz,\n            meta.marginHoriz + meta.width - zoomBoxSize\n        );\n        const zoomImageContainerY = minmax(\n            top - zoomMargin,\n            meta.marginVert,\n            meta.marginVert + meta.height - zoomBoxSize\n        );\n\n        const backgroundLeft = (zd.width * left) / boundaryWidth - zoomMargin;\n        const backgroundTop = (zd.height * top) / boundaryHeight - zoomMargin;\n\n        const bgPosX = -minmax(backgroundLeft, 0, zd.width - zoomBoxSize);\n        const bgPosY = -minmax(backgroundTop, 0, zd.height - zoomBoxSize);\n\n        return {\n            left: 0,\n            top: 0,\n            width: `${zoomBoxSize}px`,\n            height: `${zoomBoxSize}px`,\n            transform: `translate(${zoomImageContainerX}px, ${zoomImageContainerY}px)`,\n            backgroundPosition: `${bgPosX}px ${bgPosY}px`,\n            display: \"inline\",\n        };\n    } else {\n        return Display.None;\n    }\n};\n\nconst RESIZED_SIZE = 1280;\nconst calculateImageSize = (img: ThingImageOrVideo) => {\n    const size = Math.max(img.width, img.height);\n    if (size < RESIZED_SIZE) {\n        const smallerSize = Math.min(img.width, img.height);\n        return {\n            width: img.width,\n            height: img.height,\n            proportion: size / smallerSize,\n            larger: img.width > img.height ? \"width\" : \"height\",\n        };\n    } else {\n        if (img.width > img.height) {\n            const proportion = RESIZED_SIZE / img.width;\n            return {\n                width: RESIZED_SIZE,\n                height: img.height / proportion,\n                proportion,\n                larger: \"width\",\n            };\n        } else {\n            const proportion = RESIZED_SIZE / img.height;\n            return {\n                width: img.width / proportion,\n                height: RESIZED_SIZE,\n                proportion,\n                larger: \"height\",\n            };\n        }\n    }\n};\n\nexport const isZoomable = (img: ThingImageOrVideo) => {\n    const imageSize = calculateImageSize(img);\n    const boundarySize = getBoundarySize();\n\n    return imageSize.width > boundarySize.width * zoomScale || imageSize.height > boundarySize.height * zoomScale;\n};\n\nexport const getZoomImageStyle = (img: ThingImageOrVideo, isZoomActive: boolean, currentZoomImageStyle: any) => {\n    if (isZoomActive) {\n        const zd = getZoomImageDimension(img);\n        const ret = {\n            ...currentZoomImageStyle,\n            backgroundSize: `${zd.width}px ${zd.height}px`,\n        };\n        return ret;\n    } else {\n        return Display.None;\n    }\n};\n","import React, { memo, useEffect, useState, useRef } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\nimport SwiperCore, { Thumbs, Zoom } from \"swiper\";\nimport { Video } from \"common-components\";\nimport { Display } from \"fancymixin\";\n\nimport { useFancy } from \"../../FancyContext\";\nimport ActionButtons from \"../ActionButtons\";\nimport { getCurrentSaleOption, getSaleImages } from \"../../../map\";\nimport { setThumbnailIndex } from \"../../../../action/actions\";\nimport { getZoomImageStyle, getNextZoomImageStyle } from \"./zoom\";\n\nimport type { ThingImageOrVideo } from \"ftypes\";\nimport type { Swiper as SwiperClass } from \"swiper\";\n\nconst isTouchDevice = \"ontouchstart\" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;\nconst SwiperAddons = [Thumbs];\nif (isTouchDevice) {\n    SwiperAddons.push(Zoom);\n}\nSwiperCore.use(SwiperAddons);\n\nconst placeholderImage = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\nconst PER_PAGE = 5;\n\nconst preloadImage = (src: string) =>\n    new Promise((r) => {\n        const image = new window.Image();\n        image.onload = r;\n        image.onerror = r;\n        image.src = src;\n    });\n\ninterface ImageSlideProps {\n    image: ThingImageOrVideo;\n    i: number;\n    isActive: boolean;\n    setSlideLocked: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nconst ImageSlide = memo<ImageSlideProps>(\n    ({ image, i, setSlideLocked, isActive }) => {\n        const {\n            thing,\n            slideContext: { thumbnailIndex },\n        } = useFancy();\n        const [isZoomActive, setZoomActive] = useState(false);\n        const [zoomImageStyle, setZoomImageStyle] = useState(Display.None);\n        const [zoomImageCacheKey, setZoomImageCacheKey] = useState(\"\");\n        const [zoomImageLoaded, setZoomImageLoaded] = useState(false);\n\n        const isVideo = !!image.h264_1000k_url;\n        const isMagnifyingGlassZoomable = !isVideo && !isTouchDevice;\n\n        useEffect(() => {\n            if (!zoomImageCacheKey && isZoomActive) {\n                preloadImage(image.large_image_url).then(() => {\n                    setZoomImageCacheKey(image.large_image_url);\n                    setZoomImageLoaded(true);\n                });\n            }\n            if (zoomImageCacheKey !== \"\" && image.large_image_url !== zoomImageCacheKey) {\n                setZoomImageCacheKey(\"\");\n                setZoomImageLoaded(false);\n            }\n        }, [image.large_image_url, isZoomActive, zoomImageCacheKey]);\n\n        const handleMouseEvent = ({ pageX, pageY }) => {\n            if (!isMagnifyingGlassZoomable) {\n                return;\n            }\n            if (isZoomActive) {\n                const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                setZoomImageStyle(nextZoomImageStyle);\n            }\n        };\n\n        return (\n            <SwiperSlide\n                zoom={isMagnifyingGlassZoomable}\n                key={i}\n                className={classnames({\n                    \"video-slide\": isVideo,\n                    startZoom: isZoomActive,\n                    zoomShow: true,\n                    \"active-slide\": isActive,\n                    loading: thing.loading,\n                })}\n                onClick={({ pageX, pageY }) => {\n                    if (!isMagnifyingGlassZoomable) {\n                        return;\n                    }\n                    const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                    setZoomImageStyle(nextZoomImageStyle);\n\n                    setZoomActive(!isZoomActive);\n                    setSlideLocked(!isZoomActive);\n                }}\n                onMouseMove={handleMouseEvent}>\n                {isVideo ? (\n                    <Video\n                        object={image}\n                        display={true}\n                        playing={thumbnailIndex == i}\n                        lastFullyRenderedObjectID={thing.id}\n                        allow={{ fullScreen: true }}\n                    />\n                ) : (\n                    <>\n                        <img\n                            className=\"swiper-lazy\"\n                            src={image.image_url}\n                            data-src={image.image_url}\n                            title={!isTouchDevice ? \"Double click to zoom-in\" : undefined}\n                            alt={thing.name}\n                            style={{ cursor: \"zoom-in\" }}\n                        />\n                        <em\n                            className=\"zoomImage\"\n                            onClick={() => {\n                                setZoomActive(false);\n                                setSlideLocked(false);\n                            }}\n                            style={{\n                                ...getZoomImageStyle(image, isZoomActive, zoomImageStyle),\n                                backgroundColor: \"white\",\n                                backgroundImage: `url(${zoomImageLoaded ? image.large_image_url : image.image_url})`,\n                            }}\n                        />\n                        {isTouchDevice && <div className=\"swiper-lazy-preloader\" />}\n                    </>\n                )}\n            </SwiperSlide>\n        );\n    },\n    (prevProps: ImageSlideProps, nextProps: ImageSlideProps) => {\n        return prevProps.image.image_url === nextProps.image.image_url && prevProps.isActive === nextProps.isActive;\n    }\n);\nImageSlide.displayName = \"SwiperSlide\"; // This is important to make swiper to acknowledge it's actually slide, not some random components\n\nconst Image = ({ imageOnly = false, galleryThumbsDirection = \"vertical\", thumbsPerView = PER_PAGE }) => {\n    const fancyProps = useFancy();\n    const {\n        thing,\n        saleContext,\n        slideContext: { thumbnailIndex },\n    } = fancyProps;\n    const swiperRef = useRef(null);\n    const swipeThumbsRef = useRef(null);\n    const [thumbIndex, setThumbIndex] = useState(0);\n    const [slideLocked, setSlideLocked] = useState(false);\n    const [swiper, setSwiper] = useState<null | SwiperClass>(null);\n    const option = getCurrentSaleOption(thing.sales, saleContext, true);\n    const images = getSaleImages(thing, option) as ThingImageOrVideo[];\n    const lastThumbIndex = images.length - thumbsPerView;\n\n    useEffect(() => {\n        if (!swiper) {\n            return;\n        }\n        if (thumbnailIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbnailIndex);\n        }\n        if (!imageOnly && swipeThumbsRef.current) {\n            const thumbSwiper = swipeThumbsRef.current.swiper;\n            if (!thumbSwiper.slides[thumbnailIndex].classList.contains(\"swiper-slide-visible\"))\n                thumbSwiper.slideTo(Math.min(thumbnailIndex, lastThumbIndex));\n        }\n    }, [thumbnailIndex, swiper, imageOnly]);\n\n    useEffect(() => {\n        if (!swipeThumbsRef.current) {\n            return;\n        }\n        const swiper = swipeThumbsRef.current.swiper;\n        if (thumbIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbIndex);\n        }\n    }, [thumbIndex, imageOnly]);\n\n    const prevEl = (\n        <div\n            className={`prev ${thumbIndex > 0 ? \"disabled\" : \"\"}`}\n            style={{ opacity: thumbIndex > 0 ? undefined : 0.3 }}\n            onClick={() => setThumbIndex(Math.max(0, thumbIndex - thumbsPerView))}\n        />\n    );\n\n    const nextEl = (\n        <div\n            className={`next ${thumbIndex < lastThumbIndex ? \"disabled\" : \"\"}`}\n            style={{\n                opacity: thumbIndex < lastThumbIndex ? undefined : 0.3,\n            }}\n            onClick={() => {\n                setThumbIndex(Math.min(thumbIndex + thumbsPerView, lastThumbIndex));\n            }}\n        />\n    );\n\n    return (\n        <div className=\"figure-section\">\n            <Swiper\n                ref={swiperRef}\n                onSlideChange={() => {\n                    const swiper = swiperRef.current?.swiper;\n                    if (swiper) {\n                        fancyProps.dispatch(setThumbnailIndex(swiper.activeIndex));\n                        setThumbIndex(swiper.activeIndex);\n                    }\n                }}\n                preloadImages={false}\n                lazy={{\n                    loadPrevNext: true,\n                    loadPrevNextAmount: 0,\n                }}\n                zoom={\n                    isTouchDevice\n                        ? {\n                              maxRatio: 2,\n                          }\n                        : undefined\n                }\n                allowSlidePrev={!slideLocked}\n                allowSlideNext={!slideLocked}\n                onZoomChange={(_, scale) => {\n                    if (scale > 1) {\n                        setSlideLocked(true);\n                    } else {\n                        setSlideLocked(false);\n                    }\n                }}\n                onSwiper={(swiper) => {\n                    setSwiper(swiper);\n                }}\n                className=\"gallery-top\">\n                {images.map((image, i) => {\n                    return (\n                        <ImageSlide\n                            key={i}\n                            image={image}\n                            i={i}\n                            setSlideLocked={setSlideLocked}\n                            isActive={swiper?.activeIndex === i}\n                        />\n                    );\n                })}\n                {!imageOnly && <ActionButtons />}\n            </Swiper>\n            {!imageOnly && prevEl}\n            <Swiper\n                className=\"gallery-thumbs\"\n                ref={swipeThumbsRef}\n                onClick={() => {\n                    if (!swipeThumbsRef.current) {\n                        return;\n                    }\n                    fancyProps.dispatch(setThumbnailIndex(swipeThumbsRef.current.swiper.clickedIndex));\n                }}\n                direction={galleryThumbsDirection}\n                spaceBetween={16}\n                slidesPerView={thumbsPerView}\n                watchSlidesVisibility={true}\n                height={80}>\n                {images.map((image, i) => {\n                    return (\n                        <SwiperSlide\n                            key={i}\n                            className={classnames({\n                                \"video-thumbnail\": image.h264_1000k_url,\n                                selected: i == thumbnailIndex,\n                            })}>\n                            <img\n                                height=\"80\"\n                                src={placeholderImage}\n                                style={{ backgroundImage: `url(${image.thumbnail_url})` }}\n                            />\n                        </SwiperSlide>\n                    );\n                })}\n                {imageOnly && (\n                    <>\n                        {prevEl}\n                        {nextEl}\n                    </>\n                )}\n            </Swiper>\n            {!imageOnly && nextEl}\n        </div>\n    );\n};\n\nexport default Image;\n","export const Keys = {\n    Sidebar: {\n        Wrap: 'SIDEBAR_WRAP',\n        Body: 'SIDEBAR_BODY',\n        Title: 'SIDEBAR_TITLE',\n        Price: 'SIDEBAR_PRICE',\n        Form: 'SIDEBAR_FORM',\n        Desc: 'SIDEBAR_DESCRIPTION',\n        Owner: 'SIDEBAR_OWNER',\n    },\n};\n","import React from \"react\";\nimport classnames from \"classnames\";\n\n// Generic purchase handler, needs to be bound to insatnce on initialization.\n/*\n    data-sii={sales.id}\n    data-sisi={sales.seller_id}\n    data-tid={thing.id}\n*/\nconst SaleOptions = ({\n    options = [\"1\"],\n    currentValue = \"1\",\n    id = \"\",\n    value = (v) => v,\n    expander,\n    defaultValue,\n    printer,\n    disabled,\n    onChange,\n    onClick,\n    onFocus,\n    unselectedLabel,\n}) => {\n    expander =\n        expander ||\n        ((option, idx) => (\n            <option key={`sale_options-${idx}`} value={value(option)}>\n                {printer(option)}\n            </option>\n        ));\n\n    return (\n        <select\n            id={id}\n            className={classnames(\"select-boxes2\", { \"one-option\": options.length <= 1 })}\n            value={value(currentValue) || defaultValue}\n            disabled={disabled}\n            onChange={onChange}\n            onClick={onClick}\n            onFocus={onFocus}>\n            {unselectedLabel && <option value=\"\">{unselectedLabel}</option>}\n            {options.map(expander)}\n        </select>\n    );\n};\n\nexport const SelectBox = (props) => {\n    let {\n        className,\n        disabled,\n        label,\n        currentValue,\n        defaultValue,\n        id,\n        printer,\n        tabIndex,\n        unselectedLabel,\n        options = [\"1\"],\n        SizeGuide,\n        showSelectWarning,\n    } = props;\n\n    printer = printer != null ? printer : (s) => s;\n    defaultValue = defaultValue != null ? defaultValue : \"1\";\n    className = className != null ? className : null;\n\n    var labelValue;\n    if (unselectedLabel != null && currentValue === \"\") {\n        labelValue = unselectedLabel;\n    } else {\n        labelValue = printer(currentValue != null ? currentValue : defaultValue);\n    }\n\n    return (\n        <div className={className}>\n            <label>{label}</label>\n            <span className={`trick-select ${id} ${showSelectWarning ? 'soldout' : ''}`}>\n                <a\n                    className={classnames(\"selectBox\", { disabled, \"one-option\": options.length <= 1 })}\n                    tabIndex={tabIndex || \"1\"}>\n                    <span className=\"selectBox-label\">{labelValue}</span>\n                    <span className=\"selectBox-arrow\" />\n                </a>\n                <SaleOptions {...props} printer={printer} defaultValue={defaultValue} />\n            </span>\n            {SizeGuide && <SizeGuide key=\"size-guide\" />}\n        </div>\n    );\n};\n\nexport class MultiOptionState {\n    constructor(options, option_meta) {\n        this.options = options;\n        this.option_meta = option_meta;\n        const orderMap = {};\n        option_meta.forEach((m) => {\n            if (orderMap[m.type] == null) {\n                orderMap[m.type] = { length: 1 };\n                orderMap[m.type][m.name] = 0;\n            } else {\n                orderMap[m.type][m.name] = orderMap[m.type].length;\n                orderMap[m.type].length += 1;\n            }\n        });\n        this.orderMap = orderMap;\n    }\n    // i.e.) getPossibleValues(['a', '1', ''], 1) => ['1', '3', '6']\n    // output: get possible options for 2nd option dependent on ('a' / 1st option)\n    getPossibleValuesForIndex(selected, targetIndex) {\n        const { options, option_meta, orderMap } = this;\n        if (targetIndex === 0) {\n            return option_meta[0].values;\n        }\n        let filteredOptions = options;\n        option_meta\n            .map((m) => {\n                const order = orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            })\n            .forEach((sel, idx) => {\n                if (idx < targetIndex) {\n                    filteredOptions = filteredOptions.filter((option) => option.values[idx] === sel);\n                }\n            });\n        return _.uniq(filteredOptions.map((o) => o.values[targetIndex])); // FIXME\n    }\n\n    getMultiOptions(selected) {\n        return this.option_meta.map((meta, idx) => {\n            return [meta, this.getPossibleValuesForIndex(selected, idx)];\n        });\n        /*\n        returns [\n            [type, ['a', 'b', 'c']],\n            [type, ['1', '2']],\n            [tyep, ['red', 'white', 'black']]\n        ]\n        */\n    }\n}\n\nexport const MultiOption = (props) => {\n    const { selected, multiOptionState, sid, SizeGuide } = props;\n    if (multiOptionState == null) {\n        return null;\n    }\n    const multiOptions = multiOptionState.getMultiOptions(selected);\n    var sizeGuidePos = -1;\n    if (SizeGuide) {\n        multiOptions.map(([meta, values], idx) => {\n            if (meta.name && meta.name.trim().toLowerCase() === \"size\") sizeGuidePos = idx;\n        });\n        if (sizeGuidePos < 0) sizeGuidePos = multiOptions.length - 1;\n    }\n    return multiOptions.map(([meta, values], idx) => {\n        const { type, name } = meta;\n\n        const indexTypeOf = multiOptionState.orderMap[type] && multiOptionState.orderMap[type][name];\n        const additional = {\n            name,\n            values,\n            indexTypeOf,\n            selectedArray: selected && selected[type],\n            selectedValue: selected && selected[type] && selected[type][indexTypeOf],\n            key: `${sid}-${idx}`,\n            showSizeGuide: idx == sizeGuidePos,\n        };\n        if (type === \"dropdown\") {\n            return <MultiSelectBox {...props} {...additional} />;\n        } else if (type === \"swatch\") {\n            additional.swatch = meta.swatch;\n            return <MultiSwatch {...props} {...additional} />;\n        } else if (type === \"thumbnail\") {\n            additional.thumbnail = meta.thumbnail;\n            return <MultiThumbnail {...props} {...additional} />;\n        } else if (type === \"button\") {\n            return <MultiButton {...props} {...additional} />;\n        }\n    });\n};\n\nexport const MultiSelectBox = (props) => {\n    const { values, name, onMultiSelectBoxChange, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option\">\n            <label>{name}</label>\n            <select\n                onChange={onMultiSelectBoxChange}\n                value={selectedValue}\n                className={values.length <= 1 ? \"one-option\" : undefined}>\n                <MultiSelectBoxOption key={-1} value=\"Please select\" indexTypeOf={indexTypeOf} />\n                {values.map((value, i) => {\n                    return <MultiSelectBoxOption key={i} value={value} indexTypeOf={indexTypeOf} />;\n                })}\n            </select>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSelectBoxOption = (props) => {\n    const { value, indexTypeOf } = props;\n    return (\n        <option data-value={value} data-index-typeof={indexTypeOf} value={value}>\n            {value}\n        </option>\n    );\n};\n\nexport const MultiSwatch = (props) => {\n    const { name, values, swatch, indexTypeOf, selectedValue, onClickSwatch, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option swatch\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiSwatchOption\n                            key={i}\n                            value={value}\n                            swatch={swatch}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            onClick={onClickSwatch}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSwatchOption = (props) => {\n    const { value, swatch, indexTypeOf, selectedValue, onClick } = props;\n    return (\n        <a\n            href=\"#\"\n            style={{ backgroundColor: swatch[value] }}\n            onClick={onClick}\n            data-value={value}\n            data-label={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}\n        />\n    );\n};\n\nexport const MultiThumbnail = (props) => {\n    const { values, name, thumbnail, onClickThumbnail, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n\n    return (\n        <div className=\"multi-option thumbnail\">\n            <label>{name}</label>\n            <span className=\"value\">{selectedValue}</span>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiThumbnailOption\n                            key={i}\n                            onClick={onClickThumbnail}\n                            value={value}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            thumbnail={thumbnail}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiThumbnailOption = ({ onClick, value, indexTypeOf, selectedValue, thumbnail }) => {\n    return (\n        <a\n            href=\"#\"\n            onClick={onClick}\n            data-value={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}>\n            <img\n                src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage: `url(\"${thumbnail[value]}\")`, backgroundSize: \"cover\" }}\n                alt={value}\n            />\n        </a>\n    );\n};\n\nexport const MultiButton = (props) => {\n    const { values, name, onClickMutliButton, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option button\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiButtonOption key={i}\n                            onClick={onClickMutliButton}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            value={value}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiButtonOption = (props) => {\n    const { value, onClick, indexTypeOf, selectedValue } = props;\n    return (\n        <button\n            onClick={onClick}\n            className={selectedValue === value ? \"selected\" : \"\"}\n            data-value={value}\n            data-index-typeof={indexTypeOf}>\n            {value}\n        </button>\n    );\n};\n","import React, { useCallback } from \"react\";\nimport classnames from \"classnames\";\nimport { useDispatch } from \"react-redux\";\nimport { updateSaleContext } from \"../../../../action/action-helpers\";\nimport { getCurrentSaleOption, getWaiting } from \"../../../map\";\nimport { useFancy } from \"../../FancyContext\";\nimport appState from \"../../../../appstate\";\nimport type { SaleOption } from \"ftypes\";\n\ninterface ICartButtonProps {\n  available: boolean;\n  waiting: boolean;\n  soldout: boolean;\n  loading: boolean;\n  onPurchase(): React.MouseEventHandler;\n}\n\nconst CartButton: React.FC<ICartButtonProps> = ({ onPurchase, loading }) => {\n  const dispatch = useDispatch();\n  const { thing: { sales }, saleContext } = useFancy();\n\n  const waiting = getWaiting(sales, saleContext);\n  const available = sales.available;\n  const { soldout } = getCurrentSaleOption(sales, saleContext) as SaleOption;\n\n  if (!available) {\n    return <Button\n      className=\"btn-create not-available\"\n      label={gettext(\"Not Available\")}\n      disabled={true}\n    />\n  }\n\n  const onNotifyLater = useCallback(\n    (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n      if (!appState.loggedIn) {\n        return window.require_login();\n      }\n      const opt = getCurrentSaleOption(sales, saleContext, true);\n      const params: any = { sale_item_id: sales.id };\n\n      if (opt != null) {\n        params.option_id = opt.id;\n      }\n\n      const waiting = getWaiting(sales, saleContext);\n      if (waiting) {\n        params.remove = 1;\n      }\n\n      $.ajax({\n        type: \"post\",\n        url: \"/wait_for_product.json\",\n        data: params,\n        dataType: \"json\",\n      }).done((json) => {\n        if (!json || json.status_code == null) {\n          return;\n        }\n        if (json.status_code == 0 && json.message) {\n          window.alertify.alert(json.message);\n          return;\n        }\n        const waiting = params.remove ? false : true;\n        dispatch(updateSaleContext({ waiting }));\n      });\n    }\n    , [dispatch, sales, saleContext])\n\n  return <>\n    <Button\n      onClick={onPurchase}\n      className={classnames(\"add_to_cart btn-cart\", {\n        \"btn-create\": soldout,\n        \"btns-blue-embo\": !soldout,\n        loading\n      })}\n      disabled={!!soldout}\n      label={soldout ? gettext(\"Sold out\") : gettext(\"Add to cart\")}\n    />\n    <Button\n      className={classnames(\"btn-create notify-available\", { subscribed: waiting })}\n      label={waiting ? gettext(\"Subscribed\") : gettext(\"Notify me when available\")}\n      style={!soldout ? { display: \"none\" } : undefined}\n      onClick={onNotifyLater}\n    />\n  </>\n}\n\nconst Button: React.FC<React.ButtonHTMLAttributes<null> & { label: string; }> = ({ ...props }: any) => (\n  <button {...props} label={null}>\n    {props.label}\n  </button>\n);\n\nexport default CartButton;\n","import type { SaleItem } from \"ftypes\";\n\nexport function isOptionMulti(sales: SaleItem): boolean {\n  if (sales.option_meta.length > 1) {\n      return true;\n  } else if (sales.option_meta.length === 1) {\n      return sales.option_meta[0].type !== \"dropdown\";\n  } else {\n      return false;\n  }\n}\n","import React from \"react\";\nimport type { OverlayProps } from \"ftypes\";\nimport { isSalesOptionsAvailable } from \"../../../map\";\nimport { useFancy } from \"../../FancyContext\";\n\nconst ApplePayButton: React.FC<OverlayProps> = () => {\n    const {\n        appContext: { /*applePayDisplay, */ applePayTest },\n        thing,\n        thing: { sales },\n        saleContext: { saleOptionID, selectedQuantity, price },\n    } = useFancy();\n\n    const handleApplePayCheckout : React.MouseEventHandler = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!saleOptionID || window.FancyApplePay.clicked) {\n            return;\n        }\n        window.FancyApplePay.clicked = true;\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n\n        var title = thing.name;\n        var country = sales.seller.country;\n        var sale_item_id = sales.id;\n        var seller_id = sales.seller.id;\n        var quantity = selectedQuantity;\n\n        var option_id = null;\n        var option = null;\n        if (salesOptionsAvailable) {\n            option_id = parseInt(saleOptionID, 10) || null; // ? should be same value with option except get casted\n            option = saleOptionID;\n        }\n\n        try {\n            window.FancyApplePay.requestPurchase(\"Dynamic\", {\n                sale_item_id,\n                seller_id,\n                option_id,\n                quantity,\n                price,\n                title,\n                option,\n                country,\n                testmode: applePayTest,\n            });\n        } catch (err) {\n            window.DEBUG && console.trace(err);\n            alert(err);\n            window.FancyApplePay.clicked = false;\n        }\n    };\n    return (\n        <div\n            className=\"applePayButton\"\n            style={{\n                WebkitAppearance: \"-apple-pay-button\",\n                ApplePayButtonType: \"plain\",\n                ApplePayButtonStyle: \"black\",\n            }}\n            onClick={handleApplePayCheckout}></div>\n    );\n}\n\nexport default ApplePayButton;","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { floatFormatMinusTwo, numberFormat, renderPopup, escapeSelector, getLocationArgPairs } from \"fancyutils\";\n\nimport { convertCurrency, updateSaleContext } from \"../../../../action/action-helpers\";\nimport { updateAppContext } from \"../../../../action/actions\";\nimport { currencyIsUSD, getCurrentSaleOption, getSafeNameProp, isSalesOptionsAvailable } from \"../../../map\";\nimport { Keys } from \"../../../Perf\";\nimport { SelectBox, MultiOption, MultiOptionState } from \"../SaleItemForm\";\nimport type { OverlayProps, ReduxProps, SaleOption, SelectedMetaOption, SaleOptionMeta } from \"ftypes\";\nimport type { ISaleItemSidebarHeadProps, ISaleItemSidebarHeadState } from './type';\nimport CartButton from './CartButton';\nimport { isOptionMulti } from './multiOption';\nimport ApplePayButton from './ApplePayButton';\n\nfunction optionValueFunction(opt) {\n    return opt?.id;\n}\nconst saleNamePrinter = (opt) => `${opt.name} - $${opt.price}`;\n\nconst { Fancy, alertify } = window;\n\nconst Price = ({ discounting, price, retailPrice, discountPercentage }) => {\n    return <div className=\"price\" key={Keys.Sidebar.Price}>\n        <big className={classnames({ sale: discounting })}>\n            ${floatFormatMinusTwo(price)}\n        </big>\n        {discounting && (\n            <span className=\"sales\">\n                <em>${floatFormatMinusTwo(retailPrice)}</em> (Save {numberFormat(discountPercentage, 0)}\n                            %)\n            </span>\n        )}\n    </div>\n}\n\nexport default class SaleItemSidebarHead extends Component<\n    ISaleItemSidebarHeadProps, ISaleItemSidebarHeadState\n> {\n    state = {\n        loading: false,\n        showSelectWarning: false,\n        selected: {},\n        disabled: [],\n        multiOptionState: null,\n    };\n\n    static defaultProps = {\n        showInfo: true,\n    };\n\n    constructor(props: OverlayProps & ReduxProps) {\n        super(props);\n        // for multi options\n        this.onClickThumbnail = this.onClickMultiOptionGen(\"thumbnail\");\n        this.onClickSwatch = this.onClickMultiOptionGen(\"swatch\");\n        this.onMultiSelectBoxChange = this.onClickMultiOptionGen(\"dropdown\");\n        this.onClickMutliButton = this.onClickMultiOptionGen(\"button\");\n    }\n\n    renderCurrencyPopup = () => {\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\").then(({ CurrencyPopup }) => {\n            renderPopup(CurrencyPopup, { currentCurrency: this.props.saleContext.currencyCode });\n        });\n    };\n\n    handleCurrencyPopup = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        this.renderCurrencyPopup();\n    };\n\n    handleCurrencyPopupUSD = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        if (!currencyIsUSD(this.props)) {\n            return false;\n        }\n        this.renderCurrencyPopup();\n    };\n\n    handlePurchase = (event) => {\n        event.preventDefault();\n        const {\n            thing: { sales },\n            saleContext,\n        } = this.props;\n        const saleOption = getCurrentSaleOption(sales, saleContext, true);\n        const soldout = saleOption == null ? sales.soldout : saleOption.soldout;\n        if (soldout || this.state.loading) {\n            return;\n        }\n        const optionIsMulti = isOptionMulti(sales);\n        const saleOptionID = saleOption != null ? saleOption.id : null;\n        if (!optionIsMulti && sales.options.length > 0 && saleContext.saleOptionID === null) {\n            this.setState({ showSelectWarning: true });\n            return;\n        }\n\n        this.setState({ showSelectWarning: false, loading: true }, () => {\n            const payload = {\n                sale_id: sales.id,\n                quantity: saleContext.selectedQuantity,\n                personalization: saleContext.personalization,\n            };\n            if (saleOptionID != null) {\n                payload.option_id = saleOptionID;\n            }\n            Fancy.CartAPI.addItem(payload, (success, json) => {\n                if (success) {\n                    $.dialog('thing-quickview').close();\n                    Fancy.Cart.openPopup();\n                } else {\n                    alertify.alert((json && json.error) || \"Failed to add the item to cart. Please contact us at cs@fancy.com if the problem persists.\");\n                }\n                this.setState({ loading: false });\n            })\n        });\n    }\n\n    handleOptionChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        if (!event.currentTarget.value) {\n            dispatch(updateSaleContext({ saleOptionID: null }));\n        } else {\n            const saleOptionID = parseInt(event.currentTarget.value, 10);\n            dispatch(updateSaleContext({ saleOptionID }));\n        }\n    };\n\n    handleQuantityChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const selectedQuantity = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ selectedQuantity }));\n    };\n\n    handlePersonalizationChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const personalization = event.currentTarget.value;\n        dispatch(updateSaleContext({ personalization }));\n    };\n\n    checkApplePay = () => {\n        if (window.FancyApplePay) {\n            const { dispatch, thing, thing: { sales } } = this.props;\n            const os = sales.options.filter((o) => !o.soldout);\n            const data = {\n                total: { label: thing.name, amount: (sales.price * 100) | 0 },\n            };\n\n            if (os.length > 0) {\n                data.displayItems = os.map((o) => ({\n                    label: o.name,\n                    amount: (Number(o.price) * 100) | 0,\n                }));\n            }\n\n            window.FancyApplePay.checkAvailability((available, testmode) => {\n                if (available) {\n                    dispatch(\n                        updateAppContext({\n                            applePayDisplay: true,\n                            applePayTest: testmode,\n                        })\n                    );\n                }\n            }, data);\n        }\n    };\n\n    componentDidMount() {\n        if (!currencyIsUSD(this.props)) {\n            const { saleContext } = this.props;\n            convertCurrency(saleContext.currencyCode, saleContext.price);\n        }\n        this.initializeMultiOption();\n        this.checkApplePay();\n    }\n\n    componentDidUpdate(prevProps: OverlayProps) {\n        if (prevProps.thing.id !== this.props.thing.id) {\n            this.initializeMultiOption();\n            this.checkApplePay();\n            if (this.state.showSelectWarning) {\n                this.setState({\n                    showSelectWarning: false,\n                });\n            }\n            return;\n        }\n\n        const {\n            saleContext,\n            thing: { sales },\n        } = prevProps;\n\n        const nsc = this.props.saleContext;\n        const nextSaleOptionID = nsc.saleOptionID;\n        if (saleContext.saleOptionID !== nextSaleOptionID) {\n            if (this.state.showSelectWarning) {\n                this.setState({ showSelectWarning: false });\n            }\n            const o = _.find(sales.options, (_o) => _o.id === nextSaleOptionID);\n            // option sync\n            if (o) {\n                const mos = $(\".sale-item-input .multi-option\");\n                o.values.forEach((v, i) => {\n                    const $so = mos\n                        .eq(i)\n                        .find(`[data-value=\"${escapeSelector(v)}\"]:not(.selected)`)\n                        .eq(0);\n                    if ($so.length) {\n                        if ($so.is(\"option\"))\n                            $so.prop(\"selected\", true);\n                        else\n                            $so.get(0).click();\n                    }\n                });\n                if (window.FancyApplePay && window.FancyApplePay.paymentRequest) {\n                    window.FancyApplePay.paymentRequest.update({\n                        total: {\n                            label: o.name,\n                            amount: (Number(o.price) * 100) | 0,\n                        },\n                    });\n                }\n            }\n        }\n    }\n\n    initializeMultiOption = () => {\n        const {\n            thing: {\n                sales: { options, option_meta },\n            },\n            saleContext,\n            dispatch,\n        } = this.props;\n\n        this.setState(this.getInitialMultiOptionState(options, option_meta), () => {\n            // don't block selecting cheapest item\n            if (!(options && options.length > 1)) {\n                this.updateSaleOptionIDFromMultiOptionState();\n            }\n            // ?option={number} support\n            const presetOptionId = getLocationArgPairs(\"option\");\n            if (presetOptionId && presetOptionId[1] && String(saleContext.saleOptionID) !== presetOptionId[1]) {\n                dispatch(updateSaleContext({ saleOptionID: parseInt(presetOptionId[1], 10) }));\n            }\n        });\n    };\n\n    getInitialMultiOptionState(options: SaleOption[], option_meta: SaleOptionMeta[]) {\n        const selected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        if (option_meta.length > 0) {\n            const nonSoldout = options.filter((o) => o.quantity !== 0);\n            if (nonSoldout.length !== 0) {\n                const selectedNonSoldoutOption = nonSoldout[0]; // temporary - FIXME\n                option_meta.forEach(function (opt, i) {\n                    const { type } = opt;\n                    const nextValue = selectedNonSoldoutOption.values[i];\n                    selected[type].push(nextValue);\n                });\n            } else {\n                // set first available multi option\n                option_meta.forEach(function (opt) {\n                    const { type } = opt;\n                    const nextValue = opt.values[0];\n                    selected[type].push(nextValue);\n                });\n            }\n        }\n        const multiOptionState = new MultiOptionState(options, option_meta);\n        return { selected, multiOptionState };\n    }\n\n    extractSaleOptionIDFromMultiOptionState = (selected?: SelectedMetaOption) => {\n        const {\n            thing: { sales },\n        } = this.props;\n        if (selected == null) {\n            selected = this.state.selected;\n        }\n        const { multiOptionState } = this.state;\n\n        const selectedOptionArray = multiOptionState.option_meta\n            .map((m) => {\n                const order = multiOptionState.orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            });\n        const selectedOption = _.find(sales.options, (opt) => selectedOptionArray.every((e, i) => e === opt.values[i]));\n        if (selectedOption) {\n            return selectedOption.id;\n        } else {\n            window.DEBUG &&\n                console.warn(\"no option found for \", selectedOptionArray, \"meta:\", sales.options, this.state.selected);\n        }\n    };\n\n    updateSaleOptionIDFromMultiOptionState = () => {\n        const { dispatch } = this.props;\n        let saleOptionID = this.extractSaleOptionIDFromMultiOptionState();\n        if (saleOptionID === undefined) {\n            const amendedID = this.amendSaleOptionFromMultiOptionState();\n            if (amendedID) {\n                saleOptionID = amendedID;\n            } else {\n                window.DEBUG && console.warn(\"Couldn't recover option\");\n            }\n        }\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    amendSaleOptionFromMultiOptionState = () => {\n        const { selected, multiOptionState } = this.state;\n        const nextSelected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        multiOptionState.option_meta.forEach(({ type, name }, index) => {\n            const order = multiOptionState.orderMap[type][name];\n            const selectedValue = selected[type][order];\n            if (index === 0) {\n                nextSelected[type][order] = selectedValue;\n                return;\n            }\n            const values = multiOptionState.getPossibleValuesForIndex(selected, index);\n            let value;\n            if (values.some((v) => v === selectedValue)) {\n                value = selectedValue;\n            } else {\n                value = values[0];\n            }\n            selected[type][order] = value; // even though it will be flushed out, it will affect next options so fix it as well\n            nextSelected[type][order] = value;\n        });\n        this.setState({ selected: nextSelected });\n        return this.extractSaleOptionIDFromMultiOptionState(nextSelected);\n    };\n\n    onClickMultiOptionGen = (type) => {\n        return (e) => {\n            const el = e.currentTarget;\n            let value;\n            let indexOfType;\n            if (el.tagName === \"SELECT\") {\n                value = el.value;\n                indexOfType = Number($(el).find(\":selected\").attr(\"data-index-typeof\"));\n            } else {\n                value = $(el).attr(\"data-value\");\n                indexOfType = Number($(el).attr(\"data-index-typeof\"));\n            }\n            if (e.currentTarget.className === \"disabled\") {\n                return;\n            }\n\n            this.state.selected[type][indexOfType] = value;\n            // forceful trigger even though no differences in value.\n            this.setState({ selected: _.extend({}, this.state.selected) }, this.updateSaleOptionIDFromMultiOptionState);\n        };\n    };\n\n    UNSAFE_componentWillReceiveProps(nextProps) {\n        const { saleContext } = this.props;\n        const nsc = nextProps.saleContext;\n        const priceChanges = saleContext.price !== nsc.price;\n        const currencyChanges = saleContext.currencyCode !== nsc.currencyCode;\n        if (priceChanges || currencyChanges) {\n            if (!currencyIsUSD(nextProps)) {\n                const { saleContext } = nextProps;\n                convertCurrency(saleContext.currencyCode, saleContext.price, true); // FIXME: unable to comparison since price update comes first (SaleItemSidebarHead.componentWillReceiveProps())\n            }\n        }\n    }\n\n    render() {\n        const {\n            thing,\n            thing: { sales },\n            appContext: { applePayDisplay },\n            saleContext,\n            saleContext: { selectedQuantity, price },\n            showInfo,\n        } = this.props;\n        const { showSelectWarning } = this.state;\n\n        const opt = getCurrentSaleOption(sales, saleContext) as SaleOption;\n        const discountPercentage = parseFloat(opt.discount_percentage); // TODO: use decimal?\n        const retailPrice = opt.retail_price;\n        const { soldout, quantity } = opt;\n        const { option_meta } = sales;\n        const optionIsMulti = isOptionMulti(sales);\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n        const discounting = discountPercentage > 0;\n        const quantitySelectRange = soldout\n            ? [\"1\"]\n            : _.range(1, Math.min(10, (quantity || 0) + 1));\n        const showSelectbox = sales.options.length !== 0;\n\n        var applePayButton;\n        if (applePayDisplay && !soldout) {\n            applePayButton = <ApplePayButton {...this.props} />;\n        }\n\n        return (\n            <>\n                {showInfo ? <>\n                    <h1 key={Keys.Sidebar.Title} className=\"title\" {...getSafeNameProp(thing)} />\n                    <Price {...{ discounting, price, retailPrice, discountPercentage }} />\n                </> : null}\n                <div className=\"frm\" key={Keys.Sidebar.Form}>\n                    <fieldset className=\"sale-item-input\">\n                        {showSelectbox && !optionIsMulti && (\n                            <SelectBox\n                                className=\"multi-option\"\n                                id=\"option\"\n                                label={gettext(\"Option\")}\n                                currentValue={(opt.soldout || saleContext.saleOptionID !== null) ? opt : \"\"}\n                                value={optionValueFunction}\n                                printer={saleNamePrinter}\n                                options={sales.options}\n                                unselectedLabel=\"Please select\"\n                                expander={SaleItemOptionsExpander}\n                                disabled={!salesOptionsAvailable}\n                                onChange={this.handleOptionChange}\n                                showSelectWarning={showSelectWarning}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                            />\n                        )}\n                        {optionIsMulti && (\n                            <MultiOption\n                                sid={sales.id}\n                                onClickThumbnail={this.onClickThumbnail}\n                                onClickSwatch={this.onClickSwatch}\n                                onMultiSelectBoxChange={this.onMultiSelectBoxChange}\n                                onClickMutliButton={this.onClickMutliButton}\n                                selected={this.state.selected}\n                                disabled={this.state.disabled}\n                                soldout={!!soldout}\n                                option_meta={option_meta}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                                multiOptionState={this.state.multiOptionState}\n                            />\n                        )}\n                        {sales.personalizable && (\n                            <div className=\"personalization\">\n                                <label>This item can be personalized:</label>\n                                <input\n                                    type=\"text\"\n                                    className=\"text\"\n                                    name=\"personalization\"\n                                    placeholder=\"Personalization details\"\n                                    onChange={this.handlePersonalizationChange}\n                                />\n                            </div>\n                        )}\n                        <SelectBox\n                            id=\"quantity\"\n                            className=\"multi-option\"\n                            label={gettext(\"Quantity\")}\n                            defaultValue=\"1\"\n                            currentValue={selectedQuantity}\n                            options={quantitySelectRange}\n                            disabled={!!soldout}\n                            onChange={this.handleQuantityChange}\n                        />\n                        {applePayButton}\n                        {showSelectWarning && <div className=\"error\">Please select from the available option</div>}\n                        <CartButton onPurchase={this.handlePurchase} loading={this.state.loading} />\n                    </fieldset>\n                </div>\n            </>\n        );\n    }\n}\n\n\nfunction SaleItemOptionsExpander(sio, idx) {\n    return (\n        <option value={sio.id} key={`sale_options-${idx}`}>\n            {sio.soldout === true || !(sio.quantity > 0) ? `${sio.name} - ${gettext(\"Sold out\")}` : sio.name}\n        </option>\n    );\n}\n","// Warning: objects has to be flat in each context\nexport function getInitialStoreState(contextName: 'appContext' | 'thing' | 'followContext' | 'fancyContext' | 'saleContext' | 'slideContext') {\n    switch(contextName) {\n    case 'appContext':\n        return {\n            visible: false,\n            viewer: {},\n            loggedIn: null,\n            userCountry: 'US',\n            applePayDisplay: false,\n            applePayTest: false,\n        };\n    case 'thing':\n        return {\n            data: null,\n            ID: null,\n            pendingID: null,\n            isFetching: null,\n            status: 'idle' // { idle | request | failed }\n        };\n    case 'followContext':\n        return {\n            id: null,\n            followStore: {\n                following: undefined,\n                loading: false,\n            },\n            followUser: {\n                following: undefined,\n                loading: false,\n            },\n        };\n    case 'fancyContext':\n        return {\n            id: null,\n            fancyd_count: 0,\n            fancyd: false,\n            loading: false,\n            status: 'Idle', // { Idle | Addition | Removal | After- } - Fancy'd status for animation control \n        };\n    case 'saleContext':\n        return {\n            selectedQuantity: 1,\n            saleOptionID: null, // `thing.id`? | `sio.id`?\n            currencyCode: null, // props.thing.currency_code\n            currencyMoney: null, //\n            currencySymbol: null, //\n            price: null, // (props.thing.sales_available && props.thing.sales.price) || null,\n            personalization: null,\n        };\n    case 'slideContext':\n        return {\n            id: null,\n            thumbnailIndex: 0,\n        };\n    default:\n        console.warn('`getInitialStoreState()`: Unknown context name ', contextName);\n    }\n};\n\nvar contexts = [\n    'slideContext',\n    'saleContext',\n    'fancyContext',\n    'followContext',\n    'thing',\n    'appContext'\n];\n\nexport function getAllInitialStoreState() {\n    return contexts.reduce((state, contextKey) => {\n        state[contextKey] = getInitialStoreState(contextKey);\n        return state;\n    } , {});\n}\n","// -- Members --\n// className: string\n// - class name that used from sidebar head 'wrapper figure-info {className}'.\n// type: string\n// - meta string that indicates type name\nimport { mergeObjectArgs } from 'fancyutils';\n\nexport class ThingTypeMeta {\n    static isSale = false;\n    static type = 'ThingTypeMeta';\n\n    getName(thingContext) {\n        return thingContext.name;\n    }\n}\n\nexport class PlainThingType extends ThingTypeMeta {\n    static className = '';\n    static type = 'PlainThing';\n    static createEmptyObject(...args) {\n        const objectArgs = mergeObjectArgs(args);\n        const thing = $.extend(true, {\n            id: '1',\n            url: '/',\n            isCrawled: false,\n            owner: {},\n            image: { src: '', width: 1, height: 1 },\n            user: {},\n            type: 'thing',\n            fancyd_friends: [],\n        }, objectArgs);\n        thing.META = getThingType(thing);\n        return thing;\n    }\n}\n\nexport class SaleItemType extends ThingTypeMeta {\n    static className = '';\n    static type = 'SaleItem';\n    static getName(thingContext) {\n        return thingContext.sales.name;\n    }\n    static createEmptyObject(objectArgs) {\n        return PlainThingType.createEmptyObject({\n            sales_available: true,\n            sales: {\n                id: '1',\n                review_rating: 1,\n                review_count: 1,\n                size_chart_ids: ['1'],\n                images: [{ src: '', width: 1, height: 1 }],\n                seller: { id: '1' }\n            },\n            type: 'sales'\n        }, objectArgs);\n    }\n}\n\nexport class GiftcardType extends SaleItemType {\n    static className = 'giftcard';\n    static type = 'Giftcard';\n\n    static getName() {\n        return window.gettext(\"Fancy Gift Card\");\n    }\n}\n\nexport class HotelType extends SaleItemType {\n    static className = 'hotel';\n    static type = 'Hotel';\n\n    static getName(thingContext) {\n        return thingContext.hotel_search.hotel.name;\n    }\n}\n\nexport class VanityType extends SaleItemType {\n    static className = 'vanity';\n    static type = 'Vanity';\n}\n\nexport class LaunchAppType extends ThingTypeMeta {\n    static className = '';\n    static type = 'LaunchApp';\n}\n\n// Retrieve meta by looking up thing object.\nexport function getThingType(thingContext) {\n    var ThingType;\n    if (thingContext.hotel_search) {\n        ThingType = HotelType;\n    } else if (thingContext.has_launch_app && thingContext.metadata) {\n        ThingType = LaunchAppType;\n    } else if (thingContext.type === 'giftcard') {\n        ThingType = GiftcardType;\n    } else if (thingContext.sales_available) {\n        if (thingContext.type === 'vanity_number') {\n            ThingType = VanityType;\n        } else {\n            ThingType = SaleItemType;\n        }\n    } else {\n        ThingType = PlainThingType;\n    }\n    return ThingType;\n}\n\nconst ThingTypes = [PlainThingType, SaleItemType, GiftcardType, HotelType, VanityType, LaunchAppType];\n\n// TODO: immutable\nThingTypes.forEach(AttachingType => {\n    ThingTypes.forEach(ComparingType => { \n        AttachingType[ComparingType.type] = AttachingType === ComparingType;\n    });\n});\n","import { combineReducers } from \"@reduxjs/toolkit\";\nimport { extractMetaFromURL, /*getConciseNumberString,*/ update, updateShallow } from \"fancyutils\";\n\nimport C from \"./action/action-constants\";\nimport { getInitialStoreState } from \"./store/initial-store\";\nimport { getFirstSaleOption, setWaiting } from \"./components/map\";\nimport { updateState } from \"./appstate\";\nimport { scrollEvent } from \"./container/entry-events\";\nimport { getThingType } from \"./ThingTypes\";\nimport { cache } from \"./cache\";\n\nvar loaded = false;\nvar lastFullyRenderedThingID = 0;\nfunction appContext(state = getInitialStoreState(\"appContext\"), action) {\n    switch (action.type) {\n        case C.OPEN_THING:\n            scrollEvent.visible = true;\n            return updateShallow(state, {\n                visible: true,\n            });\n        case C.CLOSE_THING:\n            scrollEvent.visible = false;\n            lastFullyRenderedThingID = 0;\n            loaded = false;\n            return updateShallow(state, {\n                visible: false,\n                lastFullyRenderedThingID,\n            });\n        case C.UPDATE_APP_CONTEXT:\n            return updateShallow(state, action.context);\n        case C.LOAD_THING: {\n            // Due to multi-stage rendering (cache -> from-server-data -> ...)\n            // it is unable to check state change correctly just by comparing ID;\n            // Therefore, we set internal state per every update cycle and check\n            // if state is fully updated.\n\n            // FIXME: when cached response exist, it marks as rendered before\n            if (loaded === true && lastFullyRenderedThingID !== action.data.id && action.data.fromServer) {\n                lastFullyRenderedThingID = action.data.id;\n            }\n\n            const loggedIn = window.__FancyUser.loggedIn;\n            const viewer = action.data.viewer || {};\n            const userCountry =\n                $.cookie.get(\"shipping_country_code\") || action.data.current_country_code || state.userCountry;\n\n            updateState(\"loggedIn\", loggedIn);\n            updateState(\"viewer\", viewer);\n            loaded = true;\n\n            return update(state, { lastFullyRenderedThingID, loggedIn, viewer, userCountry });\n        }\n        default:\n            return state;\n    }\n}\n\nfunction populateThingContext(thingData) {\n    thingData.loading = thingData.fromServer !== true;\n    thingData.META = getThingType(thingData);\n    thingData.URLMeta = extractMetaFromURL(location.href); // FIXME: provide current pathname\n    thingData.owner = thingData.user;\n}\n\n// Thing context\nfunction thing(state = getInitialStoreState(\"thing\"), action) {\n    switch (action.type) {\n        case C.LOAD_THING:\n            populateThingContext(action.data);\n            return updateShallow(state, {\n                data: action.data,\n                status: action.status,\n                ID: action.ID,\n                pendingID: null,\n                isFetching: false,\n            });\n        case C.REQUEST_THING:\n            return update(state, {\n                pendingID: action.pendingID,\n                status: action.status,\n                isFetching: true,\n            });\n        case C.REQUEST_THING_FAILURE:\n            return update(state, {\n                status: action.status,\n                isFetching: false,\n            });\n\n        // Reset state\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"thing\"));\n        default:\n            return state;\n    }\n}\n\n// Follow contexts\nfunction followContext(state = getInitialStoreState(\"followContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"), {\n                id: action.data.id,\n                followStore: {\n                    following: action.data.sales\n                        ? Boolean(action.data.sales.seller && action.data.sales.seller.seller_follow)\n                        : false,\n                    loading: false,\n                },\n                followUser: {\n                    following: action.data ? Boolean(action.data.following) : false,\n                    loading: false,\n                },\n            });\n\n        // Sidebar\n        // Follow seller/user\n        case C.TOGGLE_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: true,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.CANCEL_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.COMPLETE_FOLLOW:\n            if (action.followType === \"followStore\") {\n                cache.update(state.id, undefined, \"sales.seller.seller_follow\", state[action.followType].following);\n            }\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: state[action.followType].following,\n                },\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"));\n        default:\n            return state;\n    }\n}\n\n/*\nfunction getFancyStatus(nextFancydState) {\n    return nextFancydState ? FancyStatus.Addition : FancyStatus.Removal;\n}\nfunction getCompletionIdleStatus(currentFancyState) {\n    const prevFancyState = !currentFancyState;\n    return prevFancyState ? FancyStatus.AfterRemoval : FancyStatus.AfterAddition;\n}*/\n\nfunction fancyContext(state = getInitialStoreState(\"fancyContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            // Extract thing data for initial thing context data reset.\n            // onFancyButtonUpdate(action.data.id, action.data.fancyd, getConciseNumberString(action.data.fancyd_count));\n            return updateShallow(getInitialStoreState(\"fancyContext\"), {\n                id: action.data.id,\n                fancyd: action.data.fancyd,\n                fancyd_count: action.data.fancyd_count,\n                loading: false,\n                //status: FancyStatus.Idle,\n            });\n        case C.TOGGLE_FANCY:\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: true,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: true,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        case C.CANCEL_FANCY: {\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: false,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: false,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        }\n        // Update data\n        case C.COMPLETE_FANCY:\n            // cache.update(state.id, undefined, \"fancyd\", state.fancyd);\n            // cache.update(state.id, undefined, \"fancyd_count\", action.fancyd_count);\n            // onFancyButtonUpdate(state.id, state.fancyd, getConciseNumberString(action.fancyd_count));\n            // return update(state, {\n            //     loading: false,\n            //     fancyd_count: action.fancyd_count,\n            //     //status: getCompletionIdleStatus(state.fancyd)\n            // });\n            return {\n                ...state,\n                ...{\n                    loading: false,\n                    fancyd_count: action.fancyd_count,\n                    //status: getCompletionIdleStatus(state.fancyd)\n                },\n            };\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"fancyContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction slideContext(state = getInitialStoreState(\"slideContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"), {\n                id: action.data.id,\n            });\n        case C.SET_THUMBNAIL_INDEX:\n            return update(state, {\n                thumbnailIndex: action.thumbnailIndex,\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction saleContext(state = getInitialStoreState(\"saleContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING: {\n            // Extract thing data for initial thing context data reset.\n            const thing = action.data;\n            const sales = thing && thing.sales;\n            const saleOptionInclSales = getFirstSaleOption(sales);\n            const nextContext = {\n                selectedQuantity: 1,\n                // saleOptionID: (saleOptionInclSales && saleOptionInclSales.id) || null,\n                saleOptionID: null,\n                currencyCode: action.data.currency_code,\n                price: (saleOptionInclSales && saleOptionInclSales.price) || null,\n                waiting: null,\n            };\n            return updateShallow(getInitialStoreState(\"saleContext\"), nextContext);\n        }\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"saleContext\"));\n        case C.UPDATE_SALE_CONTEXT: {\n            // Setting waiting\n            if (action.waiting != null) {\n                setWaiting(state.saleOptionID, action.waiting);\n            }\n\n            let waiting = action.waiting;\n            // Reset quantity / Change waiting if option is changed.\n            if (action.saleOptionID != null && action.saleOptionID !== state.saleOptionID) {\n                action.selectedQuantity = 1;\n                waiting = null;\n            }\n\n            const nextContext = {\n                selectedQuantity: action.selectedQuantity,\n                saleOptionID: action.saleOptionID, // `thing.id`? | `sio.id`?\n                price: action.price, // (props.thing.sales_available && props.thing.sales.price) || null,\n                // UI\n                currencyCode: action.currencyCode, // props.thing.currency_code\n                currencyMoney: action.currencyMoney, //\n                currencySymbol: action.currencySymbol, //\n                personalization: action.personalization,\n                waiting,\n            };\n            return update(state, nextContext);\n        }\n        default:\n            return state;\n    }\n}\n\n/*\nfunction checkNotImplementedWithURLExceptionRule(META) {\n    if (['Fancybox', 'Hermes'].some(type => META[type])) {\n        window.location.reload()\n    }\n}*/\n\nconst rootReducer = combineReducers({\n    appContext,\n    // Thing contexts\n    followContext,\n    fancyContext,\n    slideContext,\n    saleContext,\n    // etc.\n    thing,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import { configureStore } from \"@reduxjs/toolkit\";\nimport thunk from \"redux-thunk\";\nimport logger from 'redux-logger'\n\nimport { getAllInitialStoreState } from \"./initial-store\";\nimport rootReducer from \"../reducers\";\n// import type { RootState } from '../reducers';\n\nconst middlewares = [thunk];\nif (process.env.NODE_ENV !== 'production') {\n    middlewares.push(logger);\n}\n\nconst store = configureStore({\n    reducer: rootReducer,\n    preloadedState: getAllInitialStoreState(),\n    middleware: (getDefaultMiddleware) =>\n        getDefaultMiddleware({\n            serializableCheck: false,\n        }).prepend(middlewares),\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport default store;\n"],"sourceRoot":""}
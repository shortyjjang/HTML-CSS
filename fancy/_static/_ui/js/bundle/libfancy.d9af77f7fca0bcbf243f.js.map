{"version":3,"sources":["webpack://fancy/./_static/modules/libf/CDNUtils.js","webpack://fancy/./_static/modules/libf/CopyToClipboard.js","webpack://fancy/./_static/modules/libf/FancyMixin.js","webpack://fancy/./_static/modules/libf/FancyUtils.ts","webpack://fancy/./_static/modules/libf/PopupHelper.js","webpack://fancy/./_static/modules/libf/common-components/AddlistAction.js","webpack://fancy/./_static/modules/libf/common-components/AddlistPopover.js","webpack://fancy/./_static/modules/libf/common-components/History.ts","webpack://fancy/./_static/modules/libf/common-components/MoreShare.js","webpack://fancy/./_static/modules/libf/common-components/MoreShareFacade.js","webpack://fancy/./_static/modules/libf/common-components/MoreShareUtils.js","webpack://fancy/./_static/modules/libf/common-components/Popup.js","webpack://fancy/./_static/modules/libf/common-components/ProductSlide.js","webpack://fancy/./_static/modules/libf/common-components/SharePopover.js","webpack://fancy/./_static/modules/libf/common-components/Video.js","webpack://fancy/./_static/modules/libf/common-components/index.js"],"names":["CDNUtils","makeServer","type","template","HOSTS","push","url","size","method","isSchemeless","cdn","parts","window","parseURL","fixedName","test","pathname","path","resizeUrl","getCDNURL","protocol","hostname","schemeless","candidates","replace","THEFANCY_MEDIA","THINGD_MEDIA","FANCY_WEB","RESIZE_IMAGE","STATICFILES","sumChars","length","match","getResizeURL","str","sum","i","c","charCodeAt","cdnUtils","copyToClipboard","text","options","cb","reselectPrevious","range","selection","mark","Function","prototype","deselectCurrent","document","createRange","getSelection","createElement","textContent","style","whiteSpace","body","appendChild","selectNode","addRange","successful","execCommand","console","warn","clipboardData","setData","err","removeRange","removeAllRanges","removeChild","initialDisplayNone","display","Display","None","Block","Inline","InlineBlock","NoneIf","cond","undefined","BlockIf","InlineIf","InlineBlockIf","BGImage","alt","className","backgroundImage","getSchemelessURL","getElementGapFromHeader","measurePointElement","$headerFeatured","$","$header","destHeight","height","attr","scrollTop","offset","top","__KEY__","_","requestIdleCallback","args","setTimeout","Number","isNaN","value","isInteger","isFinite","Math","floor","padStart","max","mask","cur","masked","filler","String","fillerSlice","slice","zfill","selectOrCreate","selector","container","element","attrValue","classNames","split","filter","e","join","substr","Error","target","find","get","appendTo","thingRegex","extractMetaFromURL","stripDomain","ret","href","stripURL","id","articleRegex","extractMetaFromArticleURL","createElementParser","a","setAttribute","parser","result","search","hash","indexOf","getObjectTypeFromUrl","getPathname","aElement","location","stripped","floatFormatMinusTwo","number","num","numberFormat","splitted","isEmpty","obj","Array","Object","getOwnPropertyNames","setCaretPos","position","focus","setSelectionRange","createTextRange","moveEnd","collapse","select","getCaretPos","selectionStart","moveStart","KEYS","TAB","ENTER","SPACE","ESC","UP","DOWN","LEFT","RIGHT","SEMICOLON","COMMA","triggerEvent","DOMRef","eventName","data","event","CustomEvent","Event","dispatchEvent","update","state","next","extend","apply","updateShallow","getDisplay","stripTags","html","div","innerHTML","innerText","isPlainLeftClick","button","altKey","metaKey","ctrlKey","shiftKey","testLegacyContextLocation","_isHomepage","isHomepage","_isStream","isStream","promisifiedFetchImage","src","resolveCallback","timeout","deferred","Deferred","then","resolve","img","Image","onload","onerror","debounceUntilTimeout","fun","delay","context","timer","delayedFunctionWrapper","clearTimeout","unshift","bind","debounceEventUntilTimeout","eventHandler","persist","numberUnitPostfixes","getConciseNumberString","_num","isNumber","pos","toFixed","decimals","decPoint","thousandsSep","abs","sign","intPartNum","parseInt","intPart","j","proportionFormat","isFixed","isStaticPage","isStaticArticlePage","index","is","log","process","debug","isVisible","elm","vpH","st","$elm","elementHeight","y","dedupeArray","vals","sort","reduce","b","getFancyDepsRoot","eitherFancy","namespace","doWith","Deps","didClickOn","$targ","parents","xmlUtil","isSuccess","xml","sc","isFail","MP","getLocationArgPairs","key","originalArgStr","argStr","map","some","argPair","formatDuration","val","remainder","minutes","seconds","minmax","lb","ub","min","mergeObjectArgs","p","n","closestUntil","startingElement","targetElement","start","documentElement","parentElement","ClickOutside","component","popupElementRefKey","closePopupFunction","attached","eventKey","handleDetach","on","isTrigger","contains","off","random","toString","isClipboardSupported","queryCommandSupported","isSaleResponse","sales","convertThingsV1ToRest","things","thing","converted","assign","sales_available","id_str","name","fancyd","thumb_image_url_310","thumb_image_url_558","fancyd_count","fancys","image","image_url","width","image_url_width","image_url_height","owner","user","html_url","fancyd_users","sale_id","quantity","remaining_quantity","price","fancy_price","available_for_sale","isCrawled","isElementOutsideViewport","excludingElement","elementRect","getBoundingClientRect","upperBound","leftBound","exclusionRect","bottom","right","lowerBound","innerHeight","clientHeight","rightBound","innerWidth","clientWidth","left","_FancyUser","loggedIn","merchant","__FancyUser","FancyUser","locationHostname","stripPathname","sp","cartesianProductOf","flatten","x","concat","jQueryPromiseAll","arrayOfPromises","jQuery","when","call","arguments","_loaded","loadCss","AppName","B","Bundle","cssToLoad","nextUrl","pop","head","append","_alertify","alertify","alert","prompt","message","fn","placeholder","cssClass","msg","confirm","set","labels","ok","cancel","escapeSelector","sel","rcssescape","fcssescape","ch","asCodePoint","isSafari_cac","isSafari","navigator","userAgent","selectPopup","popupName","dialog","openPopup","bindOverlayData","popup","$obj","one","open","closePopup","close","popupContainer","getElementById","renderPopup","PopupComponent","attrs","callback","openOnMount","ReactDOM","AddlistAction","lists","wanted","listSearchQuery","listCreationQuery","createListFocused","showList","setStateSafe","preventDefault","which","trim","props","objectId","objectType","merchantId","createList","drawUserList","quickCreateList","via","stopPropagation","targ","currentTarget","handleHide","params","owned","checked","dataLayer","product_id","products_info","products","revenue","option_id","ajax","done","error","isChecked","selectedListId","getAttribute","collectionAction","theList","list","updateList","unchecked","each","listId","mounted","setState","getListCheckbox","res","toLowerCase","listDrawn","pp","ps","listSearchInput","gettext","handleListSearch","isWishlistQuery","handleWishlistCheckboxChange","idx","term","isString","selected","ident","handleListCheckboxChange","handleCreateListLabelClick","handleCreateListBlur","handleListCreation","handleCreateListQueryChange","Component","selected_object_id","collections","aText","bText","tid","$html","$items","remove","end","item","$item","prop","post","list_name","reaction","collectionId","add","object_id","action","checked_list_ids","unchecked_list_ids","AddlistPopover","headerGap","classnames","bot","history","createHistory","makeToggle","keys","toggle","forEach","toggleKeys","toggleShow","MoreShare","showShare","showMenu","referrerURL","linkCopied","moreMenuButton","handleHook","ShareObjectTypes","require_login","showSellerList","removeViewportCheck","viewPortChecking","evtName","$root","MoreShareEl","headerEl","el","outsideViewport","handleShareDisplay","onShowSomething","linkCopiedRemovalTimer","viewerUsername","FancydByPopup","viewerId","clickOutside","facadeShowShare","facadeShowList","handleMoreShareToggle","destroy","ns","handleAttach","checkViewport","getShareURL","title","componentClass","btnClass","objectMeta","showShortcuts","fromThingSidebar","isThing","isArticle","showMerchantList","shouldShowMerchantCollection","newLayout","SharePopover","opened","handleFancydByDisplay","handleListDisplay","handleMerchantListDisplay","opacity","handleCopyLink","handleHideList","handleHideShare","MoreShareFacade","share","handleClickShare","handleClickList","FakeMoreShare","onClickShare","onClickAddlist","store","article","createReferredUrl","slug","connector","loading","originalUrl","short_url","fail","FancydPerson","following","user_id","dataType","nextFollowing","$status","always","isAddedUser","username","handleTransition","user_square_image_small","fullname","full_name","handleFollow","React","getFollowList","_getInitialState","nextPage","ended","added_user","users","nextProps","reset","immediateNextStateUpdate","thing_id","page","has_next","nextState","max_page","current_page","saved_users","__last_tid","handleMore","FancydByPopupV4","scrollHeight","next_cursor","cursor","handleScroll","applyProductSlide","mWidth","initSlide","$el","option","$slide","$list","$li","itemWidth","$prev","$next","slideWidth","itemPerSlide","resetRecommend","css","center","scrollLeft","removeClass","addClass","getPrevLeft","preparePrev","nextLeft","getNextLeft","prepareNext","prepareCount","ceil","last","clone","insertBefore","first","listWidth","spare","insertAfter","clearOld","prevCnt","hide","$this","hasClass","animate","productSlide","self","$slides","SNSDict","followingUsers","followingUsersRequested","ViewClasses","Success","Default","Searching","NoResult","friendSearchQuery","searchedFriends","selectedUserID","sentUser","sendNote","sendSuccess","searching","isContact","profile_image_url","clearFriendList","prevQuery","searchFriends","sending","isMailuser","mailUser","handleSendMail","json","status_code","sentUserID","xhr","object_type","email_address","object_meta","responseObject","JSON","parse","responseText","status","statusText","additionals","excludes","excludeKey","nextID","getSearchedFriends","loadingDisplayUsers","forceUpdate","isInputEmail","getSharedMailUser","isEmailOnlyMode","filter_messages_permission","prevProps","getDisplayUsers","selectedUser","getSelectedUser","getSentUser","emptyDisplay","emptyClassName","searchedFriendsDisplay","inputIsEmail","emailOnlyMode","noteSendable","isSNS","sentMessage","getShareMessage","handleFriendSearch","prefix","getPrefix","imgClass","handleUserSelect","handleClickContactImport","handleContinue","handleSendNoteInput","handleSend","handleClickBackFromContact","defaultMessage","shareMessage","SNSShareBox","copied","textboxDisplay","updateEmbedOption","$ep","detail","faintClick","snsShareWindow","getRefURL","directClick","$thumb","$options","types","snippet","showShareBox","handleShare","encodeURI","handleEmbed","getVideo","object","h264_1000k_url","saleVideo","video","thingOrArticleVideo","video_cover","cover_video","outputs","h264_1000k","metadata","video_url","thumbnail_url","original_url","Video","Date","original","loop","lastFullyRenderedObjectID","playing","domCls","getSrc","getLoop","currentTime","getThumbnail","videoEl","empty","np","pause","play","prepare","thingHasVideo"],"mappings":"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","file":"libfancy.d9af77f7fca0bcbf243f.js","sourcesContent":["class CDNUtils {\n    HOSTS = {};\n\n    constructor() {\n        // init hosts\n        this.makeServer('THINGD_MEDIA', 'thingd-media-ec.thefancy.com');\n        this.makeServer('THEFANCY_MEDIA', 'thefancy-media-ec.thefancy.com');\n        this.makeServer('RESIZE_IMAGE', 'resize-ec.thefancy.com');\n        this.makeServer('STATICFILES', 'static-ec.thefancy.com');\n        this.makeServer('FANCY_WEB', 'site-ec.thefancy.com');\n    }\n\n    makeServer(type, template) {\n        const { HOSTS } = this;\n        if (!HOSTS[type]) {\n            HOSTS[type] = [];\n        }\n        HOSTS[type].push(template);\n    }\n\n    getResizeURL(url, size, method, isSchemeless, cdn) {\n        var parts = window.parseURL(url);\n        var fixedName = (/test_default/.test(parts.pathname)) ? 'thingd' : 'thefancy';\n        var path = `/resize/${method ? method + '/' : ''}${size}/${fixedName}${parts.pathname}`;\n\n        var resizeUrl;\n        if (cdn) {\n            resizeUrl = this.getCDNURL(path);\n        } else {\n            resizeUrl = `${parts.protocol}//${parts.hostname}${path}`;\n        }\n\n        if (isSchemeless) {\n            resizeUrl = schemeless(resizeUrl);\n        }\n        return resizeUrl;\n    }\n\n    getCDNURL(url) {\n        const { HOSTS } = this;\n        let candidates;\n        const parts = window.parseURL ? window.parseURL(url) : {};\n        let path = parts.pathname;\n\n        if (parts.hostname == 's3.amazonaws.com') {\n            if (/\\/media\\.thefancy\\.com/.test(parts.pathname)) {\n                path = parts.pathname.replace(/^\\/media\\.thefancy\\.com/, '');\n                candidates = HOSTS.THEFANCY_MEDIA;\n            } else if (/\\/media\\.thingd\\.com/.test(parts.pathname)) {\n                path = parts.pathname.replace(/^\\/media\\.thingd\\.com/, '');\n                candidates = HOSTS.THINGD_MEDIA;\n            }\n        } else if (/^\\/(test_)?default/.test(path)) {\n            candidates = HOSTS.THINGD_MEDIA;\n        } else if (/^\\/_ui/.test(path)) {\n            candidates = HOSTS.FANCY_WEB;\n        } else if (/^\\/(resize|mark)/.test(path)) {\n            candidates = HOSTS.RESIZE_IMAGE;\n        } else if (/^\\/_static_gen/.test(path)) {\n            candidates = HOSTS.STATICFILES;\n        } else {\n            candidates = HOSTS.THEFANCY_MEDIA;\n        }\n\n        const hostname = candidates[sumChars(path.replace(/[^a-zA-Z0-9_]+/g,'')) % candidates.length];\n\n        return '//'+ hostname + path;\n    }\n\n    // Get REST URI for given resized_schemeless_image arguments\n    // See `fancy.templatetags.resized_images`\n    resizedSchemelessImage(url, size, method) {\n        // FIXME: some url (like cover image, user image, etc) gives weird url\n        //        and `window.parseURL()` attaches it to location.pathname.\n        //        This is temporary fix for it\n        if (url.match(/^(CoverImages\\/|UserImages\\/)/)) {\n            url = `/${url}`\n        }\n        return this.getResizeURL(url, size, method, true, true);\n    }\n}\n\nfunction sumChars(str) {\n    var sum = 0, i, c;\n    for (i=0,c=str.length; i < c; i++) {\n        sum += str.charCodeAt(i);\n    }\n    return sum;\n}\n\nexport function schemeless(url) {\n    var match = (typeof url === 'string') && url.match(/[http|https]\\:(\\/\\/.*)/);\n    return (match == null) ? url : match[1];\n}\n\nexport const cdnUtils = new CDNUtils();\n","// Removed prompt from 'copy-to-clipboard'\n// https://github.com/sudodoki/copy-to-clipboard/blob/04386fe925e10fec353e35e81684c5c96920102e/index.js\nimport deselectCurrent from 'toggle-selection';\n\n\nexport function copyToClipboard (text, options) {\n  var cb, reselectPrevious, range, selection, mark;\n  if (!options) { options = {}; }\n  cb = options.cb || Function.prototype;\n  try {\n    reselectPrevious = deselectCurrent();\n\n    range = document.createRange();\n    selection = document.getSelection();\n\n    mark = document.createElement('mark');\n    mark.textContent = text;\n    // used to conserve newline, etc\n    mark.style.whiteSpace = 'pre';\n    document.body.appendChild(mark);\n\n    range.selectNode(mark);\n    selection.addRange(range);\n\n    var successful = document.execCommand('copy');\n    if (!successful) {\n      console.warn('unable to copy via execCommand')\n      window.clipboardData.setData('text', text)\n    }\n  } catch (err) {\n    console.warn(err)\n  } finally {\n    cb(null);\n    if (selection) {\n      if (typeof selection.removeRange == 'function') {\n        selection.removeRange(range);\n      } else {\n        selection.removeAllRanges();\n      }\n    }\n    if (mark) {\n      document.body.removeChild(mark);\n    }\n    reselectPrevious();\n  }\n}\n","// built from 'webpack.FancyUtils.config.js'\n// loaded from 'FancyUtils.js' and exported as global module 'fancymixin'\nimport React from 'react';\nimport { schemeless as getSchemelessURL } from './FancyUtils';\n\n\nexport const initialDisplayNone = { display: 'none' }; // DEPRECATED\nexport const Display = {\n    None: { display: 'none' },\n    Block: { display: 'block' },\n    Inline: { display: 'inline' },\n    InlineBlock: { display: 'inline-block' },\n    NoneIf(cond) {\n        return cond ? Display.None : undefined;\n    },\n    BlockIf(cond) {\n        return cond ? Display.Block : undefined;\n    },\n    InlineIf(cond) {\n        return cond ? Display.Inline : undefined;\n    },\n    InlineBlockIf(cond) {\n        return cond ? Display.InlineBlock : undefined;\n    }\n};\n\n// Image using background-image\nexport const BGImage = ({ alt, className, schemeless, url }) => {\n    var backgroundImage = '';\n    if (url) {\n        backgroundImage = `url(${schemeless ? getSchemelessURL(url) : url})`;\n    }\n\n    return <img src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage }}\n                className={className}\n                alt={alt} />\n}\n\n// measurePointElement = .figure-item.btn-more\n// https://app.asana.com/0/260912680807/218844368911219\nexport function getElementGapFromHeader(measurePointElement/*:Element*/) /*:number*/{\n    const $headerFeatured = $('#header .header-featured');\n    const $header = $('#header')\n    let destHeight = $header.height()\n    if ($headerFeatured.attr('data-expanded') === 'true') {\n        destHeight += $headerFeatured.height()\n    }\n    return ~(document.body.scrollTop - $(measurePointElement).offset().top + destHeight) + 1 // convert - => + / + => -, integer\n}\n","import {\n    ThingV1Response,\n    ThingObject,\n    FancyUserConfig,\n    SalesResponse,\n} from \"ftypes\";\nimport { BaseSyntheticEvent } from \"react\";\n\nconst __KEY__ = '__F';\n\nconst { _ } = window;\n\nwindow.requestIdleCallback = window.requestIdleCallback || function(cb: Function, ...args: any[]) {\n    window.setTimeout(cb, 0, ...args);\n};\n\n// Polyfills\nNumber.isNaN = Number.isNaN || function isNaN(value) {\n    return value !== value;\n};\n\nNumber.isInteger = Number.isInteger || function(value) {\n    return typeof value === \"number\" &&\n           isFinite(value) &&\n           Math.floor(value) === value;\n};\n\n// https://ponyfoo.com/articles/ecmascript-string-padding\nexport function padStart(text: string, max: number, mask: string) {\n  const cur = text.length;\n  if (max <= cur) {\n    return text;\n  }\n  const masked = max - cur;\n  let filler = String(mask) || ' ';\n  while (filler.length < masked) {\n    filler += filler;\n  }\n  const fillerSlice = filler.slice(0, masked);\n  return fillerSlice + text;\n}\n\nexport function zfill(text: string, max: number) {\n    return padStart(text, max, '0');\n}\n\n// Select element or create element via selector\nexport function selectOrCreate(selector:string, container: Element = document.body, element: string = 'div'): Element {\n    var attr;\n    var attrValue;\n    if (selector[0] === '.') {\n        attr = 'class';\n        var classNames = selector.split('.').filter(e=>e);\n        if (classNames.length > 1) { // .abc.def\n            attrValue = classNames.join(' ');\n        } else { // .abc\n            attrValue = selector.substr(1);\n        }\n    } else if (selector[0] === '#') {\n        attr = 'id';\n        attrValue = selector.substr(1);\n    } else {\n        // TODO: error handling - redirect to the page\n        throw new Error('non-recognized selector:' + selector);\n    }\n\n    var target = $(container).find(selector).get(0);\n    if (target == null) {\n        target = $(`<${element} ${attr}=\"${attrValue}\" />`).appendTo(container).get(0);\n    }\n    return target;\n}\n\ninterface URLMeta {\n    href?: string | null;\n    type?: string;\n    id?: string;\n}\nconst thingRegex = /^\\/(sales|things)\\/(\\d+)/;\nexport function extractMetaFromURL(url: string) {\n    url = stripDomain(url);\n    const match = url.match(thingRegex); // [\"/(sales|things)/1234\", \"sales\", \"1234\"] | null\n    const ret: URLMeta = {};\n    if (match != null) {\n        ret.href = stripURL(url); // Stripped relative URL\n        ret.type = match[1];      // either { 'sales' | 'things' }\n        ret.id = match[2];        // Integer\n    }\n    return ret;\n}\n\nconst articleRegex = /^\\/(articles)\\/([^\\?]+)/;\nexport function extractMetaFromArticleURL(url: string) {\n    url = stripDomain(url);\n    const match = url.match(articleRegex); // [\"/articles/test\", \"articles\", \"test\"] | null\n    const ret: URLMeta = {};\n    if (match != null) {\n        ret.href = stripURL(url); // Stripped relative URL\n        ret.type = match[1];      // always { 'article' }\n        ret.id = match[2];        // String\n    }\n    return ret;\n}\n\nfunction createElementParser(url: string) {\n    const a = document.createElement('a');\n    a.setAttribute('href', url);\n    return a;\n}\n\nfunction stripDomain(url: string) {\n    if (url) {\n        const parser = createElementParser(url);\n        let result = parser.pathname + parser.search + parser.hash;\n        // IE FIX\n        if (result.indexOf('/') !== 0) {\n            result = '/' + result\n        }\n        return result\n    } else {\n        return '/';\n    }\n}\n\nexport function getObjectTypeFromUrl(url: string) {\n    const path = stripDomain(url);\n    if (thingRegex.test(path)) {\n        return 'Thing';\n    } else if (articleRegex.test(path)) {\n        return 'Article';\n    } else {\n        return null;\n    }\n}\n\n// Due to <a href=# /> -> a.pathname = location.pathname, we need cleaner\nexport function getPathname(aElement: HTMLAnchorElement) {\n    if (aElement.pathname === location.pathname) {\n        return '';\n    } else {\n        return aElement.pathname;\n    }\n}\n\n// http://domain/things/1234 => /things/1234\n// deprecated, use stripDomain()\nfunction stripURL(url: string) {\n    const stripped = stripDomain(url);\n    if (stripped) {\n        return stripped;\n    } else {\n        return null;\n    }\n}\n\nexport function floatFormatMinusTwo(number: number) {\n    // simulates effect of floatformat:-2|intcomma\n    var num = numberFormat(number, 2);\n    var splitted = numberFormat(number, 2).split('.');\n    if (splitted[1] === '00') {\n        return splitted[0];\n    } else return num;\n}\n\n// Either empty or null/undefined; Python-side falsy values like {}, []\nexport function isEmpty(obj: any) : boolean {\n    return obj == null ||\n           obj === ''  ||\n           (obj instanceof Array && obj.length === 0) ||\n           (typeof obj === 'object' && Object.getOwnPropertyNames(obj).length === 0);\n}\n\nexport function setCaretPos(element: HTMLInputElement, position: number) {\n    element.focus();\n    if (element.setSelectionRange){\n        element.setSelectionRange(position, position);\n    } else if (element.createTextRange) {\n        var range = element.createTextRange();\n        range.moveEnd('character', position);\n        range.collapse(false);\n        range.select();\n    }\n};\n\nexport function getCaretPos(element: HTMLInputElement) {\n    if (element.selectionStart) {\n        return element.selectionStart;\n    } else if (document.selection) {\n        var range = document.selection.createRange();\n        range.moveStart('character', -element.value.length);\n        return range.text.length;\n    } else {\n        return -1;\n    }\n}\n\nexport var KEYS = {\n    TAB: 9,\n    ENTER: 13,\n    SPACE: 32,\n    ESC: 27,\n    UP: 38,\n    DOWN: 40,\n    LEFT: 37,\n    RIGHT: 39,\n    SEMICOLON: 186,\n    COMMA: 188 // ,\n};\n\n// Using DOM high-level event triggering system for React to recognize event\nexport function triggerEvent(DOMRef: Element, eventName: string, data: Object) {\n    var event;\n    if (data) {\n        event = new CustomEvent(eventName, {\n            'bubbles'    : true, // Whether the event will bubble up through the DOM or not\n            'cancelable' : true, // Whether the event may be canceled or not\n            'detail': data\n        });\n    } else {\n        event = new Event(eventName, {\n            'bubbles'    : true, // Whether the event will bubble up through the DOM or not\n            'cancelable' : true  // Whether the event may be canceled or not\n        });\n    }\n    return DOMRef.dispatchEvent(event);\n}\n\n// Deep merge for reducers\nexport function update(state: unknown, next: unknown) {\n    var args = [true, {}, state];\n    if (next) {\n        args.push(next)\n    }\n    return $.extend.apply(null, args);\n}\n\n// 'Shallow merge'\nexport function updateShallow(state: unknown, next: unknown) {\n    var args = [{}, state];\n    if (next) {\n        args.push(next)\n    }\n    return _.extend.apply(null, args);\n}\n\nexport function getDisplay(display: unknown) {\n    return {\n        display: display ? 'block' : 'none'\n    };\n}\n\n// '<a>b</a>' => 'b'\nexport function stripTags(html: string) {\n    var div = document.createElement(\"div\");\n    div.innerHTML = html;\n    return div.textContent || div.innerText || null;\n}\n\nexport function isPlainLeftClick(event: JQueryEventObject) : boolean {\n    return !(event.button !== 0 || event.altKey || event.metaKey || event.ctrlKey || event.shiftKey);\n}\n\nfunction testLegacyContextLocation() {\n    try {\n        // Root - /\n        if (location.pathname === '/' && $('#container-wrapper .timeline').length > 0) {\n            return true;\n        // Search page - /search?q=foo\n        } else if (/\\/search\\?q\\=/.test(location.href)) {\n            return true;\n        // User page - /foo\n        } else if (\n            $('#container-wrapper .wrapper-content.profile-section').length > 0 &&\n            /^\\/((?!\\/).)*$/.test(location.pathname)\n        ) {\n            return true;\n        } else if ('/shop' === location.pathname || /^\\/shop\\/.*/.test(location.pathname)) {\n            return true;\n        // <username | shopname>/lists/<id>\n        // <shopname>/collection/<id>\n        } else if (\n            /.*\\/list\\/\\d+/.test(location.pathname) ||\n            /.*\\/collection\\/\\d+/.test(location.pathname)\n        ) {\n            return true;\n        }\n    } catch(e) {}\n\n    return false;\n}\n\nlet _isHomepage: boolean;\nexport function isHomepage() {\n    if (_isHomepage == null) {\n        _isHomepage = location.pathname === '/'\n    }\n    return _isHomepage;\n}\n\nlet _isStream: boolean;\nexport function isStream() {\n    if (_isStream == null) {\n        return _isStream = testLegacyContextLocation();\n    } else {\n        return _isStream;\n    }\n}\n\nexport function promisifiedFetchImage(src: string, resolveCallback: any, timeout: number) {\n    const deferred = $.Deferred();\n    deferred.then(resolveCallback);\n\n    if (timeout) {\n        setTimeout(function () { deferred.resolve() }, timeout);\n    }\n\n    const img = new Image();\n    img.onload = () => { deferred.resolve(); };\n    img.onerror = () => { deferred.resolve(); };\n    img.src = src;\n}\n\nexport function debounceUntilTimeout(fun: Function, delay: number, context = null) {\n    let timer: any;\n    return function delayedFunctionWrapper(...args: unknown[]) {\n        clearTimeout(timer);\n        args.unshift(context);\n        timer = setTimeout(fun.bind.apply(fun, args), delay);\n    };\n}\n\nexport function debounceEventUntilTimeout(eventHandler: Function, delay: number) {\n    let timer: any;\n    return (e: BaseSyntheticEvent) => {\n        e.persist();\n        clearTimeout(timer);\n        timer = setTimeout(() => eventHandler(e), delay);\n    }\n}\n\nconst numberUnitPostfixes = ['', 'K', 'M', 'B', 'T'];\nexport function getConciseNumberString(_num: string | number) {\n    let num = Number(_num);\n    if (_.isNaN(num) || !_.isNumber(num)) {\n        return ''\n    }\n    let pos = 0\n    while (num > 1000) {\n        num = num / 1000\n        pos += 1\n    }\n    if (num % 1 !== 0) { // has some number after decimal point, i.e.) 10.5\n        return num.toFixed(1) + numberUnitPostfixes[pos]\n    } else { // integer i.e.) 10\n        return String(num) + numberUnitPostfixes[pos]\n    }\n}\n\n// humanize.js\nexport function numberFormat(number: number, decimals: number, decPoint?: string, thousandsSep?: string) : string {\n    decimals = isNaN(decimals) ? 2 : Math.abs(decimals);\n    decPoint = (decPoint === undefined) ? '.' : decPoint;\n    thousandsSep = (thousandsSep === undefined) ? ',' : thousandsSep;\n\n    var sign = number < 0 ? '-' : '';\n    number = Math.abs(+number || 0);\n\n    var intPartNum = parseInt(number.toFixed(decimals), 10);\n    var intPart = intPartNum + '';\n    var j = intPart.length > 3 ? intPart.length % 3 : 0;\n\n    return sign + (j ? intPart.substr(0, j) + thousandsSep : '') + intPart.substr(j).replace(/(\\d{3})(?=\\d)/g, '$1' + thousandsSep) + (decimals ? decPoint + Math.abs(number - intPartNum).toFixed(decimals).slice(2) : '');\n}\n\n// Number formatting utility i.e) 0.1 => 10%\nexport function proportionFormat(number: string | number, isFixed: boolean) : string {\n    const num = Number(number);\n    if (_.isNumber(num) && !_.isNaN(num)) {\n        if (isFixed) {\n            return (num * 100).toFixed(0) + '%';\n        } else {\n            return (num * 100) + '%';\n        }\n    } else {\n        return '';\n    }\n}\n\nexport function isStaticPage() : boolean {\n    return document.body.className.indexOf('static-ot') !== -1;\n}\n\nexport function isStaticArticlePage() : boolean {\n    return document.body.className.indexOf('static-article') !== -1;\n}\n\n// http://stackoverflow.com/questions/6393943/convert-javascript-string-in-dot-notation-into-an-object-reference\nexport function index(obj: Object, is: string, value : any): any {\n    if (typeof is == 'string') {\n        return index(obj, is.split('.'), value);\n    } else if (is.length === 1 && value !== undefined) {\n        obj[is[0]] = value;\n        return value;\n    } else if (is.length === 0) {\n        return obj;\n    } else if (obj[is[0]] !== undefined) {\n        return index(obj[is[0]], is.slice(1), value);\n    } else {\n        // was unable to reach via selector\n    }\n}\n\n// export function dateFormat(format, datetime) {\n//     return $.datepicker ? $.datepicker.formatDate(format, datetime) : datetime;\n// }\n\nexport function log(...args: unknown[]) {\n    if (process.env.NODE_ENV !== 'production') {\n        console.debug.apply(console, args);\n    }\n}\n\nexport function isVisible(elm: Element) {\n    const vpH = $(window).height(); // Viewport Height\n    const st = $(window).scrollTop(); // Scroll Top\n    const $elm = $(elm);\n    const offset= $elm.offset();\n    const elementHeight = $elm.height();\n\n    if (offset !== undefined && vpH !== undefined && st !== undefined && elementHeight !== undefined) {\n        const y = offset.top;\n        return ((y < (vpH + st)) && (y > (st - elementHeight)));\n    }\n}\n\n// http://stackoverflow.com/a/32533637/1189421\n// Object deduping / boxed value is not supported.\nexport function dedupeArray(vals: any[]): unknown[] | null {\n    if (vals) {\n        return vals.sort().reduce((a, b) => {\n            if (b !== a[0]) {\n                a.unshift(b);\n            }\n            return a;\n        }, []);\n    } else {\n        return null;\n    }\n}\n\n// Access global state\nexport function getFancyDepsRoot() {\n    window[__KEY__] = window[__KEY__] || {};\n    return window[__KEY__];\n}\n\n// eitherFancy('jQuery', $ => $(...)); -> $(...)\nexport function eitherFancy(namespace: string, doWith = (Deps: any) => Deps) /*:object? */{\n    if (window[__KEY__]) {\n        if (window[__KEY__][namespace]) {\n            return doWith(window[__KEY__][namespace]);\n        }\n    } else {\n        getFancyDepsRoot();\n    }\n    return null;\n}\n\nexport function didClickOn($targ: JQuery, selector: string) {\n    return $targ.parents(selector).length > 0 ||\n           $targ.is(selector);\n}\n\nexport const xmlUtil = {\n    isSuccess(xml: string) {\n        const sc = $(xml).find(\"status_code\");\n        return sc.length > 0 && sc.text() === '1';\n    },\n    isFail(xml: string) {\n        const sc = $(xml).find(\"status_code\");\n        return sc.length > 0 && sc.text() === '0';\n    }\n};\n\nexport function MP(...args: unknown[]) {\n    if (process.env.NODE_ENV === 'production') {\n        window.track_event && window.track_event(...args)\n    }\n}\n\n// ?a=1 -> ['a', '1']\nexport function getLocationArgPairs(key: string, originalArgStr:string=location.search) {\n    const argStr = originalArgStr.substr(1, originalArgStr.length);\n    if (argStr) {\n        const args = argStr.split('&').map(e => e.split('='));\n        if (key) {\n            let ret;\n            args.some(argPair => {\n                if (argPair[0] === key) {\n                    ret = argPair;\n                }\n            });\n            if (ret) {\n                return ret;\n            }\n        } else {\n            return args;\n        }\n    }\n}\n\nexport function formatDuration(value: string | number) {\n    if (value == null) {\n        // console.warn('formatDuration: undefined value', value)\n        return '00:00';\n    }\n    const val = Number(value);\n    if (_.isNaN(val)) {\n        // console.warn('formatDuration: value causing NaN', value)\n        return '00:00';\n    }\n    const remainder = (val % 3600) | 0;\n    const minutes = (remainder / 60) | 0;\n    const seconds = (remainder % 60) | 0;\n    return `${zfill(String(minutes), 2)}:${zfill(String(seconds), 2)}`;\n}\n\nexport function minmax(value: number, lb: number, ub: number) {\n    return Math.max(Math.min(value, ub), lb);\n}\n\nexport { openPopup, closePopup, renderPopup } from './PopupHelper';\nexport { cdnUtils, schemeless } from './CDNUtils';\n\nexport function mergeObjectArgs(args: unknown[]) {\n    return args.reduce((p, n)=> $.extend(true, p, n), null);\n}\n\n\nfunction closestUntil(startingElement: Element | null, targetElement : Element | null): Element | null {\n    let start = startingElement;\n    while (start != null) {\n        if (start === targetElement) return targetElement;\n        if (start === document.body || start === document.documentElement) {\n            return null;\n        }\n        start = start.parentElement;\n    }\n    return null;\n}\n\nexport class ClickOutside {\n    eventKey: string = '';\n    component?: import('react').Component = undefined;\n    popupElementRefKey: string = '';\n\n    constructor({ component, popupElementRefKey = 'popupElement' } : { component: import('react').Component, popupElementRefKey: string }) {\n        const key = Math.random().toString().substr(2, 8);\n        this.eventKey = \"click.attachClickOutside\" + key;\n        this.component = component;\n        this.popupElementRefKey = popupElementRefKey;\n    }\n\n    attached = false;\n    handleAttach = (closePopupFunction: Function) => {\n        if (this.attached || closePopupFunction == null) {\n            return;\n        }\n        const { component, eventKey, handleDetach, popupElementRefKey } = this;\n        $(document.body).on(eventKey, function(event: JQueryOldTriggeredEvent) {\n            if (!event.isTrigger &&\n                $.contains(document.body, event.target) && // check if element exists on DOM\n                closestUntil(event.target, component[popupElementRefKey]) === null // is target element exist below popup element?\n            ) {\n                closePopupFunction(component);\n                handleDetach();\n            }\n        });\n        this.attached = true;\n    }\n\n    handleDetach = () => {\n        $(document.body).off(this.eventKey);\n        this.attached = false;\n    }\n\n    destroy() {\n        delete this.component;\n        this.handleDetach();\n    }\n}\n\nexport { copyToClipboard } from './CopyToClipboard'\n\nexport function isClipboardSupported() : boolean {\n    return document.queryCommandSupported != null && document.queryCommandSupported('copy');\n}\n\nfunction isSaleResponse(sales: SalesResponse[]) : sales is SalesResponse[] {\n    return sales != null && sales[0] != null;\n}\n\n// Adapt server response (thing.to_v1 -> rest API)\nexport function convertThingsV1ToRest(things: ThingV1Response[]): ThingObject[] {\n    return things.map((thing: ThingV1Response) => {\n        const converted: ThingObject = Object.assign({\n            sales_available: false,\n            id: thing.id_str,\n            name: thing.name,\n            fancyd: thing[\"fancy'd\"],\n            thumb_image_url_310: thing.thumb_image_url_310,\n            thumb_image_url_558: thing.thumb_image_url_558,\n            fancyd_count: thing.fancys,\n            image: {\n                src: thing.image_url,\n                width: thing.image_url_width,\n                height: thing.image_url_height\n            },\n            owner: thing.user,\n            html_url: window.parseURL(thing.url).pathname,\n            fancyd_users: thing.fancyd_users,\n            sales: thing.sales,\n        }, thing);\n\n        const { sales } = thing;\n        if (isSaleResponse(sales)) {\n            const sales: SalesResponse = thing.sales[0];\n            if (sales.id == null && sales.sale_id != null) {\n                sales.id = sales.sale_id\n            }\n            // converted.sales.waiting = sales.waiting;\n            converted.sales = sales;\n            converted.sales.quantity = sales.remaining_quantity;\n            converted.sales.price = sales.fancy_price;\n            converted.sales_available = sales.available_for_sale;\n        } else {\n            converted.sales = null;\n        }\n\n        // Flag for cache\n        converted.isCrawled = true;\n        return converted;\n    });\n}\nexport function isElementOutsideViewport(element: Element, excludingElement: { element: Element, type: string }) {\n    let elementRect = element.getBoundingClientRect();\n    let upperBound = 0;\n    let leftBound = 0;\n    if (excludingElement) {\n        const { element, type } = excludingElement;\n        if(element){\n            const exclusionRect = element.getBoundingClientRect();\n            if (type === 'top') {\n                upperBound = exclusionRect.bottom; // exclusion on top of el (header, etc)\n            } else if (type === 'left') {\n                leftBound = exclusionRect.right; // exclusion on left of el (sidebar, etc)\n            } // right, bottom is TODO\n        }\n    }\n    const html = document.documentElement\n    const lowerBound = window.innerHeight || html.clientHeight\n    const rightBound = window.innerWidth || html.clientWidth\n    const { bottom, top, left, right } = elementRect\n\n    return (\n        (top <= upperBound && bottom <= upperBound) ||\n        (top >= lowerBound && bottom >= upperBound) ||\n        (left <= leftBound && right <= leftBound) ||\n        (left >= rightBound && right >= rightBound)\n    );\n}\n\nlet _FancyUser : FancyUserConfig = {\n    loggedIn: false,\n    merchant: false,\n    id: null,\n};\n\nif (window.__FancyUser) {\n    Object.assign(_FancyUser, window.__FancyUser);\n}\nexport const FancyUser = _FancyUser;\n\nconst locationHostname = `${location.protocol}//${location.hostname}`\nexport function stripPathname(href: string) {\n    const sp = href.split(locationHostname)\n    return sp.length > 1 ? sp[1] : sp[0]\n}\n\n// https://gist.github.com/ijy/6094414\nexport function cartesianProductOf(...args) {\n    return _.reduce(args, (a, b) => {\n        return _.flatten(_.map(a, (x) => {\n            return _.map(b, (y) => {\n                return x.concat([y]);\n            });\n        }), true);\n    }, [ [] ]);\n}\n\nexport function jQueryPromiseAll(arrayOfPromises: Array<Promise<unknown>>) {\n    return jQuery.when.apply(jQuery, arrayOfPromises).then(function() {\n        return Array.prototype.slice.call(arguments, 0);\n    });\n}\n\nconst _loaded = {};\nexport function loadCss(AppName: string) {\n    const B = window.Bundle;\n    if (_loaded[AppName]) {\n        return;\n    }\n    if (B && B.cssToLoad && B.cssToLoad[AppName] && B.cssToLoad[AppName].length > 0) {\n        while (B.cssToLoad[AppName].length > 0) {\n            const nextUrl = B.cssToLoad[AppName].pop();\n            $(document.head).append(`<link href=\"${nextUrl}\" rel=\"stylesheet\">`);\n            _loaded[AppName] = true;\n        }\n    }\n}\n\nconst _alertify = window.alertify || {\n    alert(...args: unknown[]) { window.alert(...args); },\n    prompt(message: string, fn?: Function | undefined, placeholder?: string | undefined, cssClass?: string | undefined) {\n        if (fn) {\n            let msg : string | undefined | null;\n            if (placeholder) {\n                msg = window.prompt(message, placeholder)\n            } else {\n                msg = window.prompt(message)\n            }\n            if (msg === null) {\n                fn(false);\n            } else {\n                fn(true, msg);\n            }\n        } \n    },\n    confirm(message: string, fn?: Function | undefined, cssClass?: string | undefined) {\n        if (fn) {\n            fn(window.confirm(message));\n        }\n    },\n    set: function() {},\n    labels: { ok: 'OK', cancel: 'Cancel' },\n};\nexport const alertify = _alertify;\n\n// https://code.jquery.com/jquery-3.3.1.js\nexport function escapeSelector(sel: string) { // $.escapeSelector()\n    var rcssescape = /([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\0-\\x1f\\x7f-\\uFFFF\\w-]/g;\n    var fcssescape = function(ch: string, asCodePoint: boolean) {\n        if (asCodePoint) {\n            // U+0000 NULL becomes U+FFFD REPLACEMENT CHARACTER\n            if (ch === \"\\0\") {\n                return \"\\uFFFD\";\n            }\n            // Control characters and (dependent upon position) numbers get escaped as code points\n            return ch.slice(0, -1) + \"\\\\\" + ch.charCodeAt(ch.length - 1).toString(16) + \" \";\n        }\n        // Other potentially-special ASCII characters get backslash-escaped\n        return \"\\\\\" + ch;\n    };\n\n    return (sel + '').replace(rcssescape, fcssescape);\n};\n\nlet isSafari_cac : undefined | boolean;\nexport const isSafari = () => {\n    if (isSafari_cac === undefined) {\n        isSafari_cac = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n    }\n    return isSafari_cac;\n};\n","import ReactDOM from 'react-dom';\nimport React from 'react';\nimport { selectOrCreate } from './FancyUtils';\n\n\nfunction selectPopup(popupName) {\n    if ($(`#popup_container .${popupName}`).length > 0) {\n        if (popupName) {\n            return $.dialog(popupName);\n        }\n    }\n    return null;\n}\n\nexport function openPopup(popupName, bindOverlayData = true) {\n    const popup = selectPopup(popupName);\n    if (popup) {\n        if (bindOverlayData) {\n            popup.$obj.data('via-overlay', true);\n            popup.$obj.one('close', function() {\n                $(this).data('via-overlay', false);\n            });\n        }\n        popup.open();\n    }\n}\n\nexport function closePopup(popupName) {\n    const popup = selectPopup(popupName);\n    if (popup) {\n        popup.$obj.data('via-overlay', false);\n        popup.close();\n    }\n}\n\nconst popupContainer = document.getElementById('popup_container');\nexport function renderPopup(PopupComponent, attrs, callback) {\n    // unless `attrs.openOnMount` is explicitly set as `false` and callback is set, it will open right after mount.\n    attrs = attrs || {};\n    if (attrs.openOnMount !== false && callback == null) {\n        callback = function () {\n            openPopup(PopupComponent.popupName);\n        };\n    }\n\n    if (!PopupComponent.popupName) {\n        console.warn(`renderPopup: Please set \\`popupName\\` property of ${PopupComponent.name}`);\n    }\n    return ReactDOM.render(\n        <PopupComponent {...attrs} />,\n        selectOrCreate(`.popup.${PopupComponent.popupName || ''}`, popupContainer),\n        callback\n    );\n}\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\n\nimport { KEYS, MP, getDisplay, isEmpty, alertify } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\n\nexport class AddlistAction extends Component {\n    state = {\n        lists: [],\n        wanted: false,\n        listSearchQuery: \"\",\n        listCreationQuery: \"\",\n        createListFocused: false,\n        showList: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    drawUserList(objectId) {\n        objectId = objectId || this.props.objectId;\n        getListCheckbox({\n            merchantId: this.props.merchantId,\n            objectId,\n            callback: (res) => {\n                this.setStateSafe(res);\n            },\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setStateSafe({ listSearchQuery });\n    };\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (event.type === \"keyup\" && event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId, objectType, merchantId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        // save new list\n        createList({\n            merchantId,\n            listCreationQuery,\n            callback: () => {\n                this.setStateSafe({ listCreationQuery: \"\" }, () => {\n                    this.drawUserList(objectId);\n                    this.quickCreateList.focus();\n                    if (objectType === \"thing\") {\n                        MP(\"Create New List\", {\n                            \"thing id\": objectId,\n                            \"list name\": listCreationQuery,\n                            via: \"thing detail\",\n                        });\n                    }\n                });\n            },\n        });\n    };\n\n    handleWishlistCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectType, objectId, handleHide } = this.props;\n        const name = \"wanted\";\n        const params = { owned: false, wanted: targ.checked };\n        const eventName = targ.checked ? \"Add to List\" : \"Remove from List\";\n\n        if (objectType === \"thing\") {\n            if (params.wanted && window.dataLayer) {\n                window.dataLayer.push({\n                    event: \"Add_to_Wishlist_Check\",\n                    product_id: undefined,\n                    products_info: undefined,\n                    products: undefined,\n                    revenue: undefined,\n                    option_id: undefined,\n                });\n            }\n\n            $.ajax(`/rest-api/v1/things/${objectId}`, { type: \"PUT\", data: params })\n                .done(() => {\n                    this.drawUserList(objectId);\n                    this.setStateSafe({ wanted: params.wanted });\n                    if (params.wanted) {\n                        handleHide && handleHide();\n                    }\n                })\n                .error((err) => {\n                    console.warn(err);\n                });\n\n            MP(eventName, { \"thing id\": objectId, \"list name\": name, \"list id\": -1, via: \"thing detail\" });\n        } else {\n            console.warn(\"Add to list does not work with non-thing type\");\n            return;\n        }\n    };\n\n    handleListCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const isChecked = targ.checked;\n        const { objectId, objectType, handleHide, merchantId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = targ.getAttribute(\"data-listid\");\n        const collectionAction = [Number(selectedListId), targ.checked];\n\n        if (objectType === \"thing\") {\n            const eventName = isChecked ? \"Add to List\" : \"Remove from List\";\n            const theList = lists.filter((list) => list.id === selectedListId)[0];\n            const callback = () => {\n                this.drawUserList(objectId);\n                if (isChecked) {\n                    handleHide && handleHide();\n                }\n                MP(eventName, {\n                    \"thing id\": objectId,\n                    \"list name\": theList.name,\n                    \"list id\": theList.id,\n                    via: \"thing detail\",\n                });\n            };\n\n            if (merchantId) {\n                updateList({ merchantId, objectId, collectionAction, callback });\n            } else {\n                const checked = [];\n                const unchecked = [];\n                $(this.lists)\n                    .find('input[type=\"checkbox\"]:not(.tag)')\n                    .each(function () {\n                        const listId = this.getAttribute(\"data-listid\");\n                        if (this.checked) {\n                            checked.push(listId);\n                        } else {\n                            unchecked.push(listId);\n                        }\n                    });\n                updateList({ checked, unchecked, objectId, callback });\n            }\n        } else {\n            console.warn(\"Add to list does not work with non-thing type\");\n            return;\n        }\n    };\n\n    isWishlistQuery(listSearchQuery) {\n        return \"wishlist\".indexOf($.trim(listSearchQuery).toLowerCase()) !== -1;\n    }\n\n    handleCreateListLabelClick = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setStateSafe({ createListFocused: true }, () => {\n            this.quickCreateList.focus();\n        });\n    };\n\n    handleCreateListBlur = () => {\n        this.setStateSafe({ createListFocused: false });\n    };\n\n    handleCreateListQueryChange = (event) => {\n        this.setStateSafe({ listCreationQuery: event.target.value });\n    };\n\n    componentDidMount() {\n        this.mounted = true;\n        this.listDrawn = false;\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n    }\n\n    componentDidUpdate(pp, ps) {\n        if ((ps.showList !== this.state.showList || this.listDrawn === false) && this.state.showList === true) {\n            if (this.listDrawn === false) {\n                this.listDrawn = true;\n            }\n            this.drawUserList(this.props.objectId);\n            setTimeout(() => {\n                this.listSearchInput.focus();\n            }, 0);\n        }\n    }\n\n    show() {\n        this.setStateSafe({ showList: true });\n    }\n\n    hide() {\n        this.setStateSafe({ showList: false });\n    }\n\n    render() {\n        var { objectId, merchantId } = this.props;\n        var { lists, wanted, listSearchQuery, listCreationQuery, createListFocused, showList } = this.state;\n\n        return (\n            <div id=\"show-addlist\" className=\"has-arrow more-share-popup addlist-action\" style={getDisplay(showList)}>\n                <span className=\"tit\">{merchantId ? gettext(\"Add to Collection\") : gettext(\"Add to List\")}</span>\n                <span className=\"search before-bg-share2\">\n                    <input\n                        ref={(element) => {\n                            this.listSearchInput = element;\n                        }}\n                        type=\"text\"\n                        className=\"text\"\n                        placeholder={merchantId ? gettext(\"Search your collections\") : gettext(\"Search your lists\")}\n                        value={listSearchQuery}\n                        onChange={this.handleListSearch}\n                    />\n                </span>\n                <ul\n                    className=\"lists\"\n                    ref={(element) => {\n                        this.lists = element;\n                    }}>\n                    {!merchantId && (\n                        <li>\n                            <label htmlFor={`wanted-${objectId}`}>\n                                <input\n                                    type=\"checkbox\"\n                                    name=\"wanted\"\n                                    checked={wanted}\n                                    id={`wanted-${objectId}`}\n                                    className={`tag ${wanted ? \"checked\" : \"\"}`}\n                                    style={{ display: this.isWishlistQuery(listSearchQuery) ? null : \"none\" }}\n                                    onChange={this.handleWishlistCheckboxChange}\n                                />{\" \"}\n                                {gettext(\"Wish List\")}\n                            </label>\n                        </li>\n                    )}\n                    {lists &&\n                        lists.map((list, idx) => {\n                            const term = $.trim(listSearchQuery).toLowerCase();\n                            var style;\n                            if (_.isString(term) && term.length > 0) {\n                                style = Display.NoneIf(list.name.toLowerCase().indexOf(term.toLowerCase()) === -1);\n                            }\n                            const className = list.selected ? \"selected\" : null;\n                            const ident = `${objectId}-${list.id}`;\n                            return (\n                                <li key={idx} style={style}>\n                                    <label htmlFor={ident}>\n                                        <input\n                                            className={className}\n                                            type=\"checkbox\"\n                                            name={ident}\n                                            id={ident}\n                                            checked={list.selected}\n                                            data-listid={list.id}\n                                            onChange={this.handleListCheckboxChange}\n                                        />{\" \"}\n                                        {list.name}\n                                    </label>\n                                </li>\n                            );\n                        })}\n                </ul>\n                <div className=\"new-list\">\n                    <label\n                        htmlFor=\"quick-create-list\"\n                        style={{ display: createListFocused ? \"none\" : \"block\" }}\n                        onClick={this.handleCreateListLabelClick}>\n                        <i className=\"icon\" />\n                        {merchantId ? gettext(\"Create New Collection\") : gettext(\"Create New List\")}\n                    </label>\n                    <input\n                        type=\"text\"\n                        id=\"quick-create-list\"\n                        ref={(element) => {\n                            this.quickCreateList = element;\n                        }}\n                        onBlur={this.handleCreateListBlur}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}\n                        placeholder={merchantId ? gettext(\"Create New Collection\") : gettext(\"Create New List\")}\n                    />\n                    <button className=\"btn-create\" onClick={this.handleListCreation}>\n                        {gettext(\"Create\")}\n                    </button>\n                </div>\n            </div>\n        );\n    }\n}\n\nfunction getListCheckbox({ merchantId, objectId, callback }) {\n    if (merchantId) {\n        $.get(`/rest-api/v1/seller/${merchantId}/collections`, { selected_object_id: objectId })\n            .done(({ collections } = {}) => {\n                let lists;\n                if (collections.length > 0) {\n                    lists = collections\n                        .sort((a, b) => {\n                            var aText = $.trim(a).toLowerCase();\n                            var bText = $.trim(b).toLowerCase();\n                            return aText < bText ? -1 : 1;\n                        })\n                        .map(({ id, name, selected }) => {\n                            return {\n                                id,\n                                name,\n                                selected,\n                            };\n                        });\n                } else {\n                    lists = [];\n                }\n                callback && callback({ lists, wanted: null });\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    } else {\n        $.get(\"/_get_list_checkbox.html\", { tid: objectId })\n            .done((html) => {\n                const $html = $(html);\n                const $items = $html.filter(\"li\").find(\"img\").remove().end();\n                var lists;\n                if ($items.length > 0) {\n                    lists = $items\n                        .sort((a, b) => {\n                            var aText = $.trim($(a).text()).toLowerCase();\n                            var bText = $.trim($(b).text()).toLowerCase();\n                            return aText < bText ? -1 : 1;\n                        })\n                        .map((_, item) => {\n                            var $item = $(item);\n                            return {\n                                id: $item.find(\"label\").attr(\"for\"),\n                                name: $.trim($item.find(\"label\").text()),\n                                selected: $item.find(\"input\").prop(\"checked\"),\n                            };\n                        })\n                        .get();\n                } else {\n                    lists = [];\n                }\n                const wanted = $html.filter('input[name=\"wanted\"]').val() === \"true\";\n                callback && callback({ lists, wanted });\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    }\n}\n\nfunction createList({ merchantId, listCreationQuery, callback }) {\n    if (merchantId) {\n        $.post(`/rest-api/v1/seller/${merchantId}/collections`, { list_name: listCreationQuery })\n            .done((res) => {\n                // if ($(res).find(\"created\").text() == 'False') {\n                // if (false){\n                //     alertify.alert(`List Title Not Available`, `There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                // } else {\n                callback && callback();\n                // }\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    } else {\n        $.post(\"/create_list.xml\", { list_name: listCreationQuery, reaction: 0 })\n            .done((res) => {\n                if ($(res).find(\"created\").text() == \"False\") {\n                    alertify.alert(\n                        `<b>List Title Not Available</b><br><br>There is already a list named ${listCreationQuery}. Try again with a different name.`\n                    );\n                } else {\n                    callback && callback();\n                }\n            })\n            .error((err) => {\n                console.warn(err);\n            });\n    }\n}\n\nfunction updateList({ merchantId, collectionAction, objectId, checked, unchecked, callback }) {\n    if (merchantId) {\n        const [collectionId, add] = collectionAction;\n        $.ajax({\n            url: `/rest-api/v1/seller/${merchantId}/collections/${collectionId}`,\n            type: \"POST\",\n            data: {\n                object_id: objectId,\n                action: add ? \"add\" : \"remove\",\n            },\n        })\n            .done(callback)\n            .error((err) => {\n                console.warn(err);\n            });\n    } else {\n        $.post(\"/save_list_items\", {\n            tid: objectId,\n            checked_list_ids: checked.join(\",\"),\n            unchecked_list_ids: unchecked.join(\",\"),\n        })\n            .done(callback)\n            .error((err) => {\n                console.warn(err);\n            });\n    }\n}\n","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { KEYS, MP, getDisplay, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\n\nexport class AddlistPopover extends Component {\n    state = {\n        lists: [],\n        wanted: false,\n        listSearchQuery: '',\n        listCreationQuery: '',\n        createListFocused: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    drawUserList(objectId) {\n        objectId = objectId || this.props.objectId;\n        getListCheckbox({\n            merchantId: this.props.merchantId,\n            objectId,\n            callback: res => { this.setStateSafe(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setStateSafe({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId, objectType, merchantId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        // save new list\n        createList({\n            merchantId,\n            listCreationQuery,\n            callback: () => {\n                this.setStateSafe({ listCreationQuery: '' }, () => {\n                    this.drawUserList(objectId);\n                    this.quickCreateList.focus();\n                    if (objectType === 'thing') {\n                        MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    }\n                })\n            }\n        })\n    }\n\n    handleWishlistCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectType, objectId, handleHide } = this.props;\n        const name = 'wanted';\n        const params = { owned: false, wanted: targ.checked };\n        const eventName = targ.checked ? \"Add to List\" : \"Remove from List\";\n\n        if (objectType === 'thing') {\n            if (params.wanted && window.dataLayer) {\n                window.dataLayer.push({'event': 'Add_to_Wishlist_Check', 'product_id': undefined, 'products_info': undefined, 'products': undefined, 'revenue': undefined, 'option_id': undefined });\n            }\n\n            $.ajax(`/rest-api/v1/things/${objectId}`, { type:'PUT', data: params })\n                .done(() => {\n                    this.drawUserList(objectId);\n                    this.setStateSafe({ wanted: params.wanted });\n                    if (params.wanted) {\n                        handleHide && handleHide();\n                    }\n                })\n                .error(err => { console.warn(err); });\n\n            MP(eventName, { 'thing id': objectId, 'list name': name, 'list id': -1, 'via': 'thing detail' });\n        } else {\n            console.warn('Add to list does not work with non-thing type')\n            return;\n        }\n    }\n\n    handleListCheckboxChange = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const isChecked = targ.checked;\n        const { objectId, objectType, handleHide, merchantId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = targ.getAttribute('data-listid')\n        const collectionAction = [Number(selectedListId), targ.checked]\n\n        if (objectType === 'thing') {\n            const eventName = isChecked ? \"Add to List\" : \"Remove from List\";\n            const theList = lists.filter(list => list.id === selectedListId)[0];\n            const callback = () => {\n                this.drawUserList(objectId);\n                if (isChecked) {\n                    handleHide && handleHide();\n                }\n                MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n            };\n\n            if (merchantId) {\n                updateList({ merchantId, objectId, collectionAction, callback })\n            } else {\n                const checked = [];\n                const unchecked = [];\n                $(this.lists).find('input[type=\"checkbox\"]:not(.tag)').each(function() {\n                    const listId = this.getAttribute('data-listid');\n                    if (this.checked) {\n                        checked.push(listId);\n                    } else {\n                        unchecked.push(listId)\n                    }\n                });\n                updateList({ checked, unchecked, objectId, callback })\n            }\n\n        } else {\n            console.warn('Add to list does not work with non-thing type')\n            return;\n        }\n    }\n\n    isWishlistQuery(listSearchQuery) {\n        return 'wishlist'.indexOf($.trim(listSearchQuery).toLowerCase()) !== -1\n    }\n\n    handleCreateListLabelClick = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setStateSafe({ createListFocused: true }, () => {\n            this.quickCreateList.focus();\n        });\n    }\n\n    handleCreateListBlur = () => {\n        this.setStateSafe({ createListFocused: false });\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setStateSafe({ listCreationQuery: event.target.value });\n    }\n\n    componentDidMount() {\n        this.mounted = true;\n        this.listDrawn = false;\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n    }\n\n    componentDidUpdate(pp) {\n        if (\n            (pp.showList !== this.props.showList || this.listDrawn === false) &&\n            this.props.showList === true\n        ) {\n            if (this.listDrawn === false) {\n                this.listDrawn = true\n            }\n            this.drawUserList(this.props.objectId);\n            setTimeout(() => {\n                this.listSearchInput.focus();\n            }, 0);\n        }\n    }\n\n    render() {\n        var { objectId, showList, headerGap, merchantId } = this.props;\n        var {\n            lists,\n            wanted,\n            listSearchQuery,\n            listCreationQuery,\n            createListFocused\n        } = this.state;\n\n        return (\n            <div id=\"show-addlist\" className={classnames(\"has-arrow more-share-popup\", { bot: headerGap && (headerGap < 16 + 269) /*= tip + bubble*/ })}\n                 style={getDisplay(showList)}>\n                <span className=\"tit\">{merchantId ? gettext(\"Add to Collection\") : gettext(\"Add to List\")}</span>\n                <span className=\"search before-bg-share2\">\n                    <input ref={(element) => {this.listSearchInput = element;}}\n                            type=\"text\"\n                            className=\"text\"\n                            placeholder={merchantId ? gettext('Search your collections') : gettext('Search your lists')}\n                            value={listSearchQuery}\n                            onChange={this.handleListSearch} />\n                </span>\n                <ul className=\"lists\" ref={(element) => {this.lists = element;}}>\n                    {!merchantId && <li>\n                        <label htmlFor={`wanted-${objectId}`}>\n                            <input type=\"checkbox\" name=\"wanted\"\n                                   checked={wanted}\n                                   id={`wanted-${objectId}`}\n                                   className={`tag ${wanted ? 'checked' : ''}`}\n                                   style={{ display: this.isWishlistQuery(listSearchQuery) ? null : 'none' }}\n                                   onChange={this.handleWishlistCheckboxChange} /> {gettext('Wish List')}</label>\n                    </li>}\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const className = list.selected ? \"selected\" : null;\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style}>\n                                <label htmlFor={ident}>\n                                    <input className={className}\n                                           type=\"checkbox\" name={ident} id={ident}\n                                           checked={list.selected}\n                                           data-listid={list.id}\n                                           onChange={this.handleListCheckboxChange} /> {list.name}</label>\n                            </li>\n                        )\n                    })}\n                </ul>\n                <div className=\"new-list\">\n                    <label htmlFor=\"quick-create-list\"\n                            style={{ display: createListFocused ? 'none' : 'block' }}\n                            onClick={this.handleCreateListLabelClick}>\n                        <i className=\"icon\" />{merchantId ? gettext('Create New Collection') : gettext(\"Create New List\")}</label>\n                    <input type=\"text\"\n                            id=\"quick-create-list\"\n                            ref={(element) => {this.quickCreateList = element;}}\n                            onBlur={this.handleCreateListBlur}\n                            onKeyUp={this.handleListCreation}\n                            onChange={this.handleCreateListQueryChange}\n                            value={listCreationQuery}\n                            placeholder={merchantId ? gettext('Create New Collection') : gettext(\"Create New List\")} />\n                    <button className=\"btn-create\"\n                            onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </div>\n            </div>\n        );\n    }\n}\n\nfunction getListCheckbox({ merchantId, objectId, callback }) {\n    if (merchantId) {\n        $.get(`/rest-api/v1/seller/${merchantId}/collections`, { selected_object_id: objectId }).done(({ collections } = {}) => {\n            let lists;\n            if (collections.length > 0) {\n                lists = collections.sort((a, b) => {\n                    var aText = $.trim(a).toLowerCase();\n                    var bText = $.trim(b).toLowerCase();\n                    return aText < bText ? -1 : 1;\n                }).map(({ id, name, selected }) => {\n                    return {\n                        id,\n                        name,\n                        selected\n                    };\n                })\n            } else {\n                lists = [];\n            }\n            callback && callback({ lists, wanted: null });\n        })\n        .error(err => { console.warn(err); });\n    } else {\n        $.get('/_get_list_checkbox.html', { tid: objectId }).done(html => {\n            const $html = $(html);\n            const $items = $html.filter('li').find('img').remove().end();\n            var lists;\n            if ($items.length > 0) {\n                lists = $items.sort((a, b) => {\n                    var aText = $.trim($(a).text()).toLowerCase();\n                    var bText = $.trim($(b).text()).toLowerCase();\n                    return aText < bText ? -1 : 1;\n                }).map((_, item) => {\n                    var $item = $(item);\n                    return {\n                        id: $item.find('label').attr('for'),\n                        name: $.trim($item.find('label').text()),\n                        selected: $item.find('input').prop('checked'),\n                    };\n                }).get();\n            } else {\n                lists = [];\n            }\n            const wanted = $html.filter('input[name=\"wanted\"]').val() === 'true';\n            callback && callback({ lists, wanted });\n        })\n        .error(err => { console.warn(err); });\n    }\n}\n\n\nfunction createList({ merchantId, listCreationQuery, callback }) {\n    if (merchantId) {\n        $.post(`/rest-api/v1/seller/${merchantId}/collections`, { list_name: listCreationQuery })\n            .done(res => {\n                // if ($(res).find(\"created\").text() == 'False') {\n                // if (false){\n                //     alertify.alert(`List Title Not Available`, `There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                // } else {\n                    callback && callback();\n                // }\n            })\n            .error(err => { console.warn(err); });\n    } else {\n        $.post('/create_list.xml', { list_name: listCreationQuery, reaction: 0 })\n            .done(res => {\n                if ($(res).find(\"created\").text() == 'False') {\n                    alertify.alert(`<b>List Title Not Available</b><br><br>There is already a list named ${listCreationQuery}. Try again with a different name.`);\n                } else {\n                    callback && callback();\n                }\n            })\n            .error(err => { console.warn(err); });\n    }\n}\n\nfunction updateList({ merchantId, collectionAction, objectId, checked, unchecked, callback }) {\n    if (merchantId) {\n        const [collectionId, add] = collectionAction\n        $.ajax({\n            url: `/rest-api/v1/seller/${merchantId}/collections/${collectionId}`,\n            type: 'POST',\n            data: {\n                object_id: objectId,\n                action: add ? 'add': 'remove',\n            },\n        })\n        .done(callback)\n        .error(err => { console.warn(err); })\n    } else {\n        $.post('/save_list_items', {\n            tid: objectId,\n            checked_list_ids: checked.join(','),\n            unchecked_list_ids: unchecked.join(',')\n        })\n        .done(callback)\n        .error(err => { console.warn(err); })\n    }\n}\n","import createHistory from \"history/createBrowserHistory\";\n\nexport const history = createHistory()\n","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { renderPopup, copyToClipboard, isElementOutsideViewport, MP, ClickOutside, FancyUser } from \"fancyutils\";\nimport { getElementGapFromHeader } from \"fancymixin\";\n\nimport { SharePopover } from \"./SharePopover\";\nimport { AddlistPopover } from \"./AddlistPopover\";\nimport { ShareObjectTypes, getShareURL } from \"./MoreShareUtils\";\nimport { FancydByPopup } from \"./Popup\";\n\n// returns dictionary with only one value true and else is false\nfunction makeToggle(keys) {\n    const obj = {};\n    return function toggle(...toggleKeys) {\n        keys.forEach(key => {\n            obj[key] = false;\n        });\n        if (toggleKeys) {\n            toggleKeys.forEach(key => {\n                obj[key] = true;\n            });\n        }\n        return obj;\n    };\n}\nconst toggleShow = makeToggle([\"showShare\", \"showList\", \"showSellerList\", \"showMenu\"]);\n\n\n\nexport class MoreShare extends Component {\n    state = {\n        showShare: false,\n        showList: false,\n        showMenu: false,\n        headerGap: null,\n\n        referrerURL: null,\n        linkCopied: false,\n    };\n\n    setStateSafe(...args) {\n        if (this.mounted) {\n            this.setState(...args);\n        }\n    }\n\n    componentDidMount() {\n        this.mounted = true;\n        this.clickOutside = new ClickOutside({ component: this, popupElementRefKey: \"MoreShareEl\" });\n        \n        if (this.props.facadeShowShare) {\n            this.handleShareDisplay();\n        }\n        if (this.props.facadeShowList) {\n            this.handleMoreShareToggle();\n        }\n    }\n\n    componentWillUnmount() {\n        this.mounted = false;\n        this.clickOutside.destroy();\n    }\n\n    componentDidUpdate(pp, ps) {\n        const ns = this.state;\n        const { showList, showShare, showMenu } = ns;\n        if (showList || showShare || showMenu) {\n            this.clickOutside.handleAttach(this.closePopup);\n            this.checkViewport();\n\n            if (showShare || showMenu) {\n                getShareURL(this);\n            }\n        }\n\n        if (ns.showMenu !== ps.showMenu && ns.showMenu === false) {\n            this.setState({ linkCopied: false });\n            clearTimeout(this.linkCopiedRemovalTimer);\n            this.linkCopiedRemovalTimer = null;\n        }\n    }\n\n    handleShareDisplay = () => {\n        this.setStateSafe(\n            {\n                showShare: !this.state.showShare,\n                showList: false,\n                showMenu: false,\n                headerGap: getElementGapFromHeader(this.moreMenuButton)\n            },\n            this.handleHook\n        );\n        if (this.props.objectType === ShareObjectTypes.thing) {\n            MP(\"Share\", { \"thing id\": this.props.objectId });\n        }\n    };\n\n    handleListDisplay = () => {\n        if (!FancyUser.loggedIn) {\n            this.closePopup();\n            window.require_login();\n            return;\n        }\n        const showList = !this.state.showList;\n        this.setStateSafe(toggleShow(showList ? \"showList\" : null), this.handleHook);\n    };\n\n    handleMerchantListDisplay = () => {\n        if (!FancyUser.loggedIn) {\n            this.closePopup();\n            window.require_login();\n            return;\n        }\n        const showSellerList = !this.state.showSellerList;\n        this.setStateSafe(toggleShow(showSellerList ? \"showSellerList\" : null), this.handleHook);\n    };\n\n    closePopup = () => {\n        this.removeViewportCheck();\n        this.setStateSafe(toggleShow(), this.handleHook);\n    };\n\n    viewPortChecking = false;\n    evtName = \"scrollstop.MoreShare\";\n    checkViewport = () => {\n        if (this.viewPortChecking) {\n            return;\n        }\n        this.viewPortChecking = true;\n        $(window).on(this.evtName, () => {\n            const $root = $(this.MoreShareEl);\n            const headerEl = $(\"#header .header-featured\").get(0);\n\n            const { showMenu, showShare, showList, showSellerList } = this.state;\n            let sel;\n            if (showMenu) {\n                sel = \"#more-menu\";\n            } else if (showShare) {\n                sel = \"#show-share\";\n            } else if (showList || showSellerList) {\n                sel = \"#show-addlist\";\n            }\n            const el = $root.find(sel).get(0);\n            if (el) {\n                const outsideViewport = isElementOutsideViewport(el, { element: headerEl, type: \"top\" });\n\n                if (outsideViewport) {\n                    this.closePopup();\n                }\n            }\n        });\n    };\n\n    removeViewportCheck = () => {\n        this.viewPortChecking = false;\n        $(window).off(this.evtName);\n    };\n\n    handleMoreShareToggle = () => {\n        const { objectType } = this.props;\n        const { showMenu, showShare, showList, showSellerList } = this.state;\n        // thing types will show menu\n        if (objectType === ShareObjectTypes.thing || objectType === ShareObjectTypes.article) {\n            if (showMenu || showShare || showList || showSellerList) {\n                this.closePopup();\n            } else {\n                this.setStateSafe(\n                    {\n                        showMenu: true,\n                        headerGap: getElementGapFromHeader(this.moreMenuButton)\n                    },\n                    this.handleHook\n                );\n            }\n            // non-thing types will show share popover directly, because add-to-list is not available\n        } else {\n            this.handleShareDisplay();\n        }\n        return false;\n    };\n\n    handleHook = () => {\n        if (this.props.onShowSomething) {\n            const { showList, showShare, showMenu, showSellerList } = this.state;\n            this.props.onShowSomething(showList || showShare || showMenu || showSellerList, this);\n        }\n    };\n\n    handleHideList = () => {\n        this.setStateSafe({ showList: false });\n    };\n\n    handleHideShare = () => {\n        this.setStateSafe({ showShare: false });\n    };\n\n    linkCopiedRemovalTimer = null;\n    handleCopyLink = () => {\n        if (this.linkCopiedRemovalTimer != null) {\n            return;\n        }\n        copyToClipboard(this.state.referrerURL, {\n            cb: () => {\n                this.setState({ linkCopied: true });\n                this.linkCopiedRemovalTimer = setTimeout(() => {\n                    this.setState({ linkCopied: false });\n                }, 5000);\n            }\n        });\n    };\n\n    handleFancydByDisplay = () => {\n        event.preventDefault();\n        event.stopPropagation();\n        const { viewerUsername, objectId, objectType } = this.props;\n\n        renderPopup(FancydByPopup, { objectId, objectType, loggedIn: FancyUser.loggedIn, viewerId: viewerUsername });\n    };\n\n    shouldShowMerchantCollection() {\n        return FancyUser.merchant && FancyUser.active_merchant;\n    }\n\n    render() {\n        const {\n            title,\n            viewerUsername,\n            componentClass = \"menu-container\",\n            btnClass = \"btn-more\",\n            objectType,\n            objectMeta,\n            objectId,\n            showShortcuts = true,\n            fromThingSidebar = false\n        } = this.props;\n\n        if (objectType == null) {\n            console.warn(\"objectType is not defined\");\n        }\n\n        const {\n            showShare,\n            showList,\n            showMenu,\n            headerGap,\n            referrerURL,\n            linkCopied,\n            showSellerList\n        } = this.state;\n        const isThing = objectType === ShareObjectTypes.thing;\n        const isArticle = objectType === ShareObjectTypes.article;\n\n        let showMerchantList = this.shouldShowMerchantCollection();\n        let merchantId = showMerchantList && showSellerList ? FancyUser.id : null;\n        const newLayout = fromThingSidebar;\n\n        return (\n            <em\n                className={classnames(componentClass, \"on-home ignore-ext\", {\n                    open: showShare || showList || showMenu\n                })}\n                ref={el => {\n                    this.MoreShareEl = el;\n                }}\n                data-rendered=\"true\">\n                {newLayout && <button className=\"btn-share\" onClick={this.handleShareDisplay} />}\n                <small\n                    className={btnClass}\n                    onClick={this.handleMoreShareToggle}\n                    ref={element => {\n                        this.moreMenuButton = element;\n                    }}>\n                    {<em>{SharePopover.getShareMessage(objectType, \"Share & Lists\")}</em>}\n                </small>\n                {(isThing || isArticle) && (\n                    <small\n                        id=\"more-menu\"\n                        className={classnames(\"has-arrow menu-content react new\", {\n                            opened: showMenu,\n                            bot: headerGap && headerGap < 16 + 109 /*= tip + bubble*/\n                        })}>\n                        {!newLayout && (\n                            <button className=\"share before-bg-share2\" onClick={this.handleShareDisplay}>\n                                <b>{gettext(\"Share item\")}</b>\n                                <small>{gettext(\"Share this with friends\")}</small>\n                            </button>\n                        )}\n                        {newLayout && (\n                            <button className=\"fancyd-by before-bg-share2\" onClick={this.handleFancydByDisplay}>\n                                <b>{gettext(\"Fancy'd By\")}</b>\n                                <small>{gettext(\"People who fancy'd this\")}</small>\n                            </button>\n                        )}\n                        {isThing && (\n                            <button className=\"add-list before-bg-share2\" onClick={this.handleListDisplay}>\n                                <b>{gettext(\"Lists\")}</b>\n                                <small>{gettext(\"Add this to your saved lists\")}</small>\n                            </button>\n                        )}\n                        {showMerchantList && (\n                            <button className=\"add-list before-bg-share2\" onClick={this.handleMerchantListDisplay}>\n                                <b>{gettext(\"Add to Collection\")}</b>\n                                <small>{gettext(\"Save this to your collections\")}</small>\n                            </button>\n                        )}\n                        {showShortcuts && (\n                            <span>\n                                <button\n                                    style={referrerURL ? null : { opacity: 0.7 }}\n                                    className={classnames(\"copy-link\")}\n                                    onClick={this.handleCopyLink}>\n                                    <b>{linkCopied ? \"Copied to clipboard\" : \"Item link\"}</b>\n                                    <small>Copy link to clipboard</small>\n                                </button>\n                            </span>\n                        )}\n                    </small>\n                )}\n                {isThing && (\n                    <AddlistPopover\n                        key={`${objectId}-${merchantId}` || `${objectId}-addlist`}\n                        objectType={objectType}\n                        objectId={objectId}\n                        showList={showList || showSellerList}\n                        merchantId={merchantId}\n                        viewerUsername={viewerUsername}\n                        handleHide={this.handleHideList}\n                        headerGap={headerGap}\n                    />\n                )}\n                <SharePopover\n                    objectType={objectType}\n                    objectId={objectId}\n                    objectMeta={objectMeta}\n                    showShare={showShare}\n                    title={title}\n                    referrerURL={this.state.referrerURL}\n                    viewerUsername={viewerUsername}\n                    headerGap={headerGap}\n                    handleHide={this.handleHideShare}\n                />\n            </em>\n        );\n    }\n}\n","import React, { Component } from \"react\";\nimport { MoreShare } from \"common-components\";\n\n\nexport class MoreShareFacade extends Component {\n    state = {\n        share: false,\n        list: false\n    };\n\n    handleClickShare = () => {\n        this.setState({ share: true });\n    };\n\n    handleClickList = () => {\n        this.setState({ list: true });\n    };\n\n    render() {\n        const { share, list } = this.state;\n        return (\n            <React.Fragment>\n                {!(share || list) && (\n                    <FakeMoreShare onClickShare={this.handleClickShare} onClickAddlist={this.handleClickList} />\n                )}\n                {(share || list) && <MoreShare {...this.props} facadeShowShare={share} facadeShowList={list} />}\n            </React.Fragment>\n        );\n    }\n}\n\nclass FakeMoreShare extends Component {\n    render() {\n        return (\n            <em className=\"menu-container on-home ignore-ext\" data-rendered=\"true\">\n                <button className=\"btn-share\" onClick={this.props.onClickShare}></button>\n                <small className=\"btn-more\" onClick={this.props.onClickAddlist}>\n                    <em>Share &amp; Lists</em>\n                </small>\n            </em>\n        );\n    }\n}","export const ShareObjectTypes = {\n    thing: 'thing',\n    list: 'list',\n    store: 'store',\n    user: 'user',\n    article: 'article',\n}\n\nfunction createReferredUrl(viewerUsername, objectId, objectType, objectMeta) {\n    let url;\n    if (objectType === ShareObjectTypes.thing) {\n        url = `https://${location.hostname}/things/${objectId}`;\n    } else if (objectType === ShareObjectTypes.article && objectMeta) {\n        url = `https://${location.hostname}/articles/${objectMeta.slug}`;\n    } else {\n        url = location.href.replace(/(#.*)/, ''); // Remove hash\n    }\n\n    if (viewerUsername) {\n        let connector = ~url.indexOf('?') ? '&' : '?';\n        url = `${url}${connector}ref=${viewerUsername}`\n    }\n\n    return url;\n}\n\nexport function getShareURL(component, callback) {\n    if (component.loading || component.state.referrerURL || component.props.referrerURL) {\n        callback && callback(true);\n        return;\n    }\n    component.loading = true;\n\n    // If async loading is needed, assign setState callback.\n    let cb = null;\n    if (callback) {\n        cb = () => {\n            callback(false);\n            component.loading = false;\n        };\n    }\n    const { viewerUsername, objectId, objectType, objectMeta } = component.props;\n    const originalUrl = createReferredUrl(viewerUsername, objectId, objectType, objectMeta);\n    $.post('/get_short_url.json', { url: originalUrl })\n        .done(res => {\n            component.setState({ referrerURL: res.short_url }, cb);\n        })\n        .fail(() => {\n            component.setState({ referrerURL: originalUrl }, cb);\n            console.warn('/get_short_url failed');\n        });\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\n\nimport { isPlainLeftClick } from \"fancyutils\";\nimport { ShareObjectTypes } from './MoreShareUtils';\n\n\nexport class FancydPerson extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            loading: false,\n            following: false\n        };\n    }\n\n    componentDidMount() {\n        const following = this.props.following || this.props.user.following;\n        if (following) {\n            this.setState({ following });\n        }\n    }\n\n    handleFollow = event => {\n        event.preventDefault();\n        event.stopPropagation();\n\n        const { user } = this.props;\n        const { following, loading } = this.state;\n\n        if (this.props.loggedIn !== true) {\n            window.require_login();\n            return;\n        }\n\n        if (loading) {\n            return;\n        }\n\n        const url = following ? \"/delete_follow.xml\" : \"/add_follow.xml\";\n\n        this.setState({ loading: true }, () => {\n            $.ajax({\n                type: \"post\",\n                url,\n                data: { user_id: user.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    const nextFollowing = !following;\n                    const $status = $(xml).find(\"status_code\");\n                    if ($status.length && $status.text() !== 0) {\n                        this.setState({ following: nextFollowing });\n                    }\n                })\n                .always(() => {\n                    this.setState({ loading: false });\n                });\n        });\n    };\n\n    handleTransition = event => {\n        if (isPlainLeftClick(event)) {\n            const href = event.currentTarget.getAttribute(\"href\");\n            if (href) {\n                location.href = href;\n            }\n        }\n    };\n\n    render() {\n        const { user, isAddedUser, viewerId } = this.props;\n        const { following } = this.state;\n\n        return (\n            <li>\n                <a href={`/${user.username}`} className=\"username\" onClick={this.handleTransition}>\n                    <img\n                        src=\"/_ui/images/common/blank.gif\"\n                        style={{ backgroundImage: `url(${user.image_url || user.user_square_image_small})` }}\n                    />\n                    {isAddedUser ? \"Added by \" : \"\"}\n                    <b>{user.fullname || user.full_name}</b>\n                    {isAddedUser ? \"\" : `@${user.username}`}\n                </a>\n                {viewerId !== user.id && (\n                    <button\n                        className={classnames(\"btns-gray-embo\", following ? \"following\" : \"follow\")}\n                        onClick={this.handleFollow}\n                    />\n                )}\n            </li>\n        );\n    }\n}\n\nexport class FancydByPopup extends React.Component {\n    static popupName = \"fancyd_list\";\n\n    constructor(props) {\n        super(props);\n        this.state = this._getInitialState();\n    }\n\n    _getInitialState() {\n        return {\n            loading: false,\n            nextPage: 1,\n            ended: null,\n            added_user: null,\n            users: [],\n            owner: null\n        };\n    }\n\n    getFollowList(nextProps, reset) {\n        const { objectId, objectType } = nextProps || this.props;\n        const { nextPage } = this.state;\n\n        var immediateNextStateUpdate;\n        if (reset) {\n            immediateNextStateUpdate = this._getInitialState();\n            immediateNextStateUpdate.loading = true;\n        } else {\n            immediateNextStateUpdate = { loading: true };\n        }\n\n        if (reset || (this.state.loading !== true && this.state.ended !== true)) {\n            this.setState(immediateNextStateUpdate, () => {\n                if (objectType === ShareObjectTypes.thing) {\n                    $.get(\"/thing_follower_list.json\", { thing_id: objectId, page: nextPage }, ({ has_next, users, owner }) => {\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                } else if (objectType === ShareObjectTypes.article) {\n                    $.get(`/rest-api/v1/articles/${objectId}/saved_users`, { page: nextPage }, ({ max_page, current_page, saved_users }) => {\n                        const users = saved_users;\n                        const has_next = max_page > current_page;\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner: null };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                }\n                \n            });\n        }\n    }\n\n    componentDidMount() {\n        this.getFollowList();\n        this.__last_tid = this.props.objectId;\n    }\n\n    componentDidUpdate(nextProps) {\n        if (this.__last_tid !== nextProps.objectId) {\n            this.__last_tid = nextProps.objectId;\n            this.getFollowList(nextProps, true);\n        }\n    }\n\n    handleMore = event => {\n        event.preventDefault();\n        this.getFollowList();\n    };\n\n    render() {\n        const { ended, users, owner } = this.state;\n        const { loggedIn, viewerId } = this.props;\n        return (\n            <div>\n                {/* TODO: via-overlay is needed to distinguish jQuery-attached Events and React Events -\n                    need to deliver better alternative \n                    rel task: https://app.asana.com/0/86925821949642/152825012917493 */}\n                <p className=\"ltit\">{gettext(\"Fancy'd by\")}</p>\n                <ul>\n                    {owner ? (\n                        <FancydPerson user={owner} isAddedUser={true} viewerId={viewerId} loggedIn={loggedIn} />\n                    ) : null}\n                    {users.map((user, idx) => (\n                        <FancydPerson key={`FancydBy-${idx}`} user={user} viewerId={viewerId} loggedIn={loggedIn} />\n                    ))}\n                    {ended === false && (\n                        <li className=\"more\">\n                            <a onClick={this.handleMore}>{gettext(\"View More\")}</a>\n                        </li>\n                    )}\n                </ul>\n                <button className=\"ly-close\" title=\"Close\">\n                    <i className=\"ic-del-black\" />\n                </button>\n            </div>\n        );\n    }\n}\n\nexport class FancydByPopupV4 extends React.Component {\n    static popupName = \"fancyd_list\";\n\n    constructor(props) {\n        super(props);\n        this.state = this._getInitialState();\n    }\n\n    _getInitialState() {\n        return {\n            loading: false,\n            nextPage: 1,\n            next_cursor: null,\n            ended: null,\n            added_user: null,\n            users: [],\n            owner: null\n        };\n    }\n\n    getFollowList(nextProps, reset) {\n        const { objectId, objectType, next_cursor } = nextProps || this.props;\n        const { nextPage } = this.state;\n\n        var immediateNextStateUpdate;\n        if (reset) {\n            immediateNextStateUpdate = this._getInitialState();\n            immediateNextStateUpdate.loading = true;\n        } else {\n            immediateNextStateUpdate = { loading: true };\n        }\n\n        if (reset || (this.state.loading !== true && this.state.ended !== true)) {\n            this.setState(immediateNextStateUpdate, () => {\n                if (objectType === ShareObjectTypes.thing) {\n                    const args = {};\n                    if (!!next_cursor) {\n                        args.cursor = next_cursor;\n                    }\n\n                    $.get(`/rest-api/v1/things/${objectId}/fancyd-users`, args, ({ next_cursor, fancyd_users }) => {\n                        const nextState = { loading: false, users: this.state.users.concat(fancyd_users), owner: null };\n                        if (!!next_cursor) {\n                            nextState.next_cursor = next_cursor;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                } else if (objectType === ShareObjectTypes.article) {\n                    $.get(`/rest-api/v1/articles/${objectId}/saved_users`, { page: nextPage }, ({ max_page, current_page, saved_users }) => {\n                        const users = saved_users;\n                        const has_next = max_page > current_page;\n                        const nextState = { loading: false, users: this.state.users.concat(users), owner: null };\n                        if (has_next) {\n                            nextState.nextPage = this.state.nextPage + 1;\n                            nextState.ended = false;\n                        } else {\n                            nextState.ended = true;\n                        }\n                        this.setState(nextState);\n                    }).fail(() => {\n                        this.setState({ loading: false });\n                    });\n                }\n                \n            });\n        }\n    }\n\n    componentDidMount() {\n        this.getFollowList();\n        this.__last_tid = this.props.objectId;\n    }\n\n    componentDidUpdate(nextProps) {\n        if (this.__last_tid !== nextProps.objectId) {\n            this.__last_tid = nextProps.objectId;\n            this.getFollowList(nextProps, true);\n        }\n    }\n\n    handleMore = event => {\n        event.preventDefault();\n        this.getFollowList();\n    };\n\n    handleScroll = (e) => {\n        const el = e.target;\n        if (this.state.ended) {\n            return;\n        }\n\n        if ((el.scrollHeight - 50) <= (el.clientHeight + el.scrollTop)) {\n            this.getFollowList();\n        }\n    }\n\n    render() {\n        const { users, owner } = this.state;\n        const { loggedIn, loading, viewerId } = this.props;\n        return (\n            <div>\n                {/* TODO: via-overlay is needed to distinguish jQuery-attached Events and React Events -\n                    need to deliver better alternative \n                    rel task: https://app.asana.com/0/86925821949642/152825012917493 */}\n                <p className=\"ltit\">{gettext(\"Liked by\")}</p>\n                <ul onScroll={this.handleScroll}>\n                    {owner ? (\n                        <FancydPerson user={owner} isAddedUser={true} viewerId={viewerId} loggedIn={loggedIn} />\n                    ) : null}\n                    {users.map((user, idx) => (\n                        <FancydPerson key={`FancydBy-${idx}`} user={user} viewerId={viewerId} loggedIn={loggedIn} />\n                    ))}\n                    {loading && (\n                        <div id=\"infscr-loading\">\n                            <img alt=\"Loading...\" src=\"/_ui/images/common/loading.gif\" />\n                        <div />\n                    </div>\n                    )}\n                </ul>\n                <button className=\"ly-close\" title=\"Close\">\n                    <i className=\"ic-del-black\" />\n                </button>\n            </div>\n        );\n    }\n}\n\n// const onLoad = () => { \n//     $(document.body).on(\"click\", \".buttons .fancyd_user\", function() {\n//         if ($(this).closest('#overlay-thing').length > 0) {\n//             return true;\n//         }\n//         const $container = $(this).closest(\".buttons\");\n//         const objectId = $container.find(\".fancy, .fancyd\").attr(\"tid\");\n//         const objectType = 'thing';\n//         if (objectId) {\n//             renderPopup(FancydByPopup, { objectId, objectType, loggedIn: FancyUser.loggedIn, viewerId: FancyUser.id });\n//             return false;\n//         }\n//     });\n// }\n\n// if (document.readyState !== 'loading') {\n//     onLoad()\n// } else {\n//     document.addEventListener(\"DOMContentLoaded\", onLoad)\n// }\n","// fork of recommend-slide (accacb79d2af557369e02132ef5f486d226aa5d3)\nexport default function applyProductSlide() {\n    $(function() {\n        var mWidth = 920;\n\n        function initSlide($el, option) {\n            var $slide;\n            if ($el.is('.itemSlide, .slideshow')) {\n                $slide = $el;\n            } else {\n                $slide = $el.find(\".itemSlide, .slideshow\");\n            }\n            $slide.data('slideInit', true);\n            var $list = $el.find(\"ul\"),\n                $li = $list.find(\"li\"),\n                itemWidth = $li.width() + 20,\n                $prev = $el.find(\"a.prev\"),\n                $next = $el.find(\"a.next\");\n            var slideWidth = null;\n\n            if (option.itemPerSlide) slideWidth = itemWidth * option.itemPerSlide;\n\n            function resetRecommend() {\n                if (!$slide || !$li) {\n                    $el.css(\"visibility\", \"visible\");\n                    return;\n                }\n\n                if (slideWidth && slideWidth > itemWidth * $li.length) {\n                    $el.css(\"visibility\", \"visible\");\n                    return;\n                }\n\n                if ($(window).width() < mWidth) {\n                    if (option.center) {\n                        $slide.find(\".itemList\").scrollLeft(($li.length * 147 - $(window).width() + 20) / 2);\n                    }\n                    $prev.removeClass(\"disabled\");\n                    $next.removeClass(\"disabled\");\n                } else {\n                    if ($slide.width() > itemWidth * $li.length) {\n                        $prev.addClass(\"disabled\");\n                        $next.addClass(\"disabled\");\n                        if (option.center) {\n                            $slide.find(\".itemList\").css(\"left\", \"0px\");\n                        }\n                    } else {\n                        if (option.center) {\n                            $slide\n                                .find(\".itemList\")\n                                .css(\"left\", -parseInt(($li.length * 285 - $(window).width() + 20) / 2) + \"px\");\n                        }\n                        $prev.removeClass(\"disabled\");\n                        $next.removeClass(\"disabled\");\n                    }\n                }\n                $el.css(\"visibility\", \"visible\");\n            }\n\n            function getPrevLeft($el) {\n                preparePrev();\n                var left = Math.abs(parseInt($list.css(\"left\"))),\n                    nextLeft,\n                    width = $slide.width();\n                if (slideWidth) width = slideWidth;\n                nextLeft = left - width;\n                return nextLeft;\n            }\n\n            function getNextLeft($el) {\n                prepareNext();\n                var left = Math.abs(parseInt($list.css(\"left\"))),\n                    nextLeft,\n                    width = $slide.width();\n                if (slideWidth) width = slideWidth;\n                nextLeft = left + width;\n                return nextLeft;\n            }\n\n            function preparePrev() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    width = $slide.width(),\n                    itemWidth = $li.width() + 20;\n                if (slideWidth) width = slideWidth;\n\n                if (left < width) {\n                    var prepareCount = Math.ceil(Math.abs(width - left) / itemWidth);\n                    for (var i = 0; i < prepareCount; i++) {\n                        var $el = $list.find(\"li:not([_prev])\").last();\n                        $el.clone().insertBefore($list.find(\"li\").first());\n                        $el.attr(\"_prev\", true);\n                    }\n                    $list.css(\"left\", 0 - left - prepareCount * itemWidth + \"px\");\n                }\n            }\n\n            function prepareNext() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    width = $slide.width(),\n                    listWidth = $li.length * ($li.width() + 20),\n                    itemWidth = $li.width() + 20,\n                    spare = listWidth - (left + width);\n                if (slideWidth) width = slideWidth;\n                if (spare - width < width) {\n                    var prepareCount = Math.ceil(Math.abs(width - (listWidth - (left + width))) / itemWidth);\n                    for (var i = 0; i < prepareCount; i++) {\n                        var $el = $list.find(\"li:not([_next])\").first();\n                        $el.clone().insertAfter($list.find(\"li\").last());\n                        $el.attr(\"_next\", true);\n                    }\n                }\n            }\n\n            function clearOld() {\n                var $li = $list.find(\"li\"),\n                    left = Math.abs(parseInt($list.css(\"left\"))),\n                    itemWidth = $li.width() + 20,\n                    $prev = $list.find(\"li[_next]:not(:in-viewport)\"),\n                    prevCnt = $prev.length;\n                $list.find(\"li[_prev]:not(:in-viewport)\").remove();\n                $prev.remove();\n                $list.css(\"left\", 0 - left + prevCnt * itemWidth + \"px\");\n            }\n\n            resetRecommend();\n\n            if (slideWidth && slideWidth > itemWidth * $li.length) {\n                $prev.hide();\n                $next.hide();\n            }\n\n            $el.on(\"click\", \"a.prev\", function(e) {\n                e.preventDefault();\n                var $this = $(this);\n                if ($this.hasClass(\"_disabled\")) return;\n                var left = getPrevLeft($el);\n                $this.addClass(\"_disabled\");\n                $list.animate({ left: 0 - left + \"px\" }, 300, \"easeInOutExpo\", function() {\n                    clearOld();\n                    $this.removeClass(\"_disabled\");\n                });\n            }).on(\"click\", \"a.next\", function(e) {\n                e.preventDefault();\n                var $this = $(this);\n                if ($this.hasClass(\"_disabled\")) return;\n                var left = getNextLeft($el);\n                $this.addClass(\"_disabled\");\n                $list.animate({ left: 0 - left + \"px\" }, 300, \"easeInOutExpo\", function() {\n                    clearOld();\n                    $this.removeClass(\"_disabled\");\n                });\n            });\n        }\n\n        $.fn.productSlide = function(option) {\n            var option = option || { center: true };\n            var self = this;\n            var $slides = this.each(function() {\n                var $el = $(this);\n                initSlide($el, option);\n            });\n\n            return $slides;\n        };\n    });\n}\n","import React from 'react';\nimport classnames from 'classnames';\nimport { FancyUser, debounceUntilTimeout, MP, getDisplay, triggerEvent, alertify } from 'fancyutils';\nimport { ShareObjectTypes, getShareURL } from './MoreShareUtils';\n\nimport { Display } from 'fancymixin';\n\n\nconst SNSDict = { \"fb\": \"Facebook\", \"tw\": \"Twitter\", \"tb\": \"Tumblr\" };\n\nconst followingUsers = [];\nlet followingUsersRequested = false;\n\nconst ViewClasses = {\n    Success: 'empty success',\n    Default: 'empty default',\n    Searching: 'empty searching',\n    NoResult: 'empty no-result',\n};\n\n\nexport class SharePopover extends React.Component {\n    state = {\n        friendSearchQuery: '',\n        searchedFriends: [],\n        selectedUserID: null,\n        sentUser: null,\n        sendNote: '',\n        sendSuccess: false,\n        searching: false,\n        isContact: false,\n    };\n\n    mailUser = {\n        id: 'EMAIL',\n        type: 'email',\n        profile_image_url: '/_ui/images/common/blank.gif',\n        fullname: 'Email',\n        /* mut */ username: null,\n    };\n\n    constructor(props) {\n        super(props);\n        this.searchFriends = debounceUntilTimeout(function searchFriends(prevQuery, friendSearchQuery) {\n            if (this.isEmailOnlyMode()) {\n                this.setState({ searching: false });\n                return;\n            }\n\n            const term = $.trim(friendSearchQuery);\n            if ($.trim(prevQuery) === term) {\n                return;\n            }\n            if (term === '') {\n                this.setState({\n                    searchedFriends: [],\n                    selectedUserID: null,\n                });\n                return;\n            }\n            this.setState({ searching: true }, () => {\n                $.get('/search-users.json', {\n                    term, \n                    filter_messages_permission: true\n                })\n                .done(searchedFriends => {\n                    const nextState = { searching: false };\n                    if (this.state.friendSearchQuery === friendSearchQuery) {\n                        nextState.searchedFriends = searchedFriends;\n                        nextState.selectedUserID = null;\n                    }\n                    this.setState(nextState);\n                });\n            })\n        }, 200, this);\n    }\n\n    handleContinue = (event) => {\n        event.preventDefault();\n        this.clearFriendList();\n        if (this.props.handleHide) {\n            this.props.handleHide()\n        }\n    }\n\n    handleFriendSearch = (event) => {\n        const friendSearchQuery = event.target.value;\n        const prevQuery = this.state.friendSearchQuery;\n        this.setState({ friendSearchQuery, sendSuccess: false, searching: true }, () => {\n            this.searchFriends(prevQuery, friendSearchQuery);\n        });\n    }\n\n    handleSend = () => {\n        const { sendNote, selectedUserID, searchedFriends } = this.state;\n        const { title, referrerURL } = this.props;\n        if (this.sending) {\n            return;\n        }\n\n        const isMailuser = selectedUserID === this.mailUser.id;\n        if (isMailuser) {\n            this.handleSendMail();\n            return;\n        } else if (searchedFriends.length === 0 || selectedUserID == null) {\n            return;\n        }\n\n\n        const { objectType } = this.props;\n        let params;\n        if (objectType === ShareObjectTypes.thing) {\n            params = {\n                things: this.props.objectId,\n                user_id: selectedUserID\n            };\n        } else {\n            params = {\n                user_id: selectedUserID,\n                message: `${title} ${referrerURL}`,\n            };\n        }\n        \n        this.sending = true;\n        if ($.trim(sendNote)) {\n            params.message += (' ' + $.trim(sendNote));\n        }\n\n        $.post('/messages/send-message.json', params)\n            .done(json => {\n                if (json.status_code !== 1) {\n                    if (json.message) {\n                        alertify.alert(json.message);\n                    } else {\n                        alertify.alert(\"There was an error while sending message. Please try again.\");\n                    }\n                    return;\n                }\n                this.clearFriendList({\n                    sendSuccess: true,\n                    sentUserID: selectedUserID,\n                    selectedUserID: null,\n                }, ['searchedFriends']);\n                MP('Complete Share', { \"thing id\": params.things, \"type\": \"FancyMessage\" });\n            })\n            .fail(xhr => {\n                console.warn(xhr);\n            })\n            .always(() => {\n                this.sending = false;\n            });\n    }\n\n    handleSendMail = () => {\n        if (this.sending) {\n            return;\n        }\n        if (this.props.objectType == null) {\n            console.warn('objectType should be provided.');\n        }\n        const object_type = this.props.objectType || 'thing';\n        const email_address = this.mailUser.username.trim();\n\n        const object_id = this.props.objectId;\n        this.sending = true;\n        const params = { email_address, object_type, object_id };\n        const message = $.trim(this.state.sendNote);\n        if (message) {\n            params.message = message;\n        }\n        if (this.props.objectMeta && this.props.objectMeta.type === 'shoplist') {\n            params.object_meta = this.props.objectMeta.type;\n        }\n\n        $.post('/messages/send-email.json', params)\n            .done(json => {\n                if (json.status_code !== 1) {\n                    if (json.message) {\n                        alertify.alert(json.message);\n                    } else {\n                        alertify.alert(\"There was an error while sending message. Please try again.\");\n                    }\n                    return;\n                }\n                this.clearFriendList({\n                    sendSuccess: true,\n                    sentUserID: params.email_address,\n                    selectedUserID: null,\n                });\n                MP('Complete Share', { \"object id\": params.object_id, \"object type\": params.object_type, \"type\": \"Email\" });\n            })\n            .fail(xhr => {\n                var responseObject = null\n                try { responseObject = JSON.parse(xhr.responseText) } catch(e) { }\n                if(responseObject && responseObject.message) {\n                    alertify.alert(responseObject.message)\n                } else {\n                    alertify.alert(\"Error occured. please try again.\\n\"+xhr.status + ' ' + xhr.statusText);\n                }\n                console.warn(xhr);\n            })\n            .always(() => {\n                this.sending = false;\n            });\n    }\n\n    clearFriendList = (additionals, excludes) => {\n        // remove search history for users\n        const nextState = _.extend({\n            friendSearchQuery: '',\n            searchedFriends: [],\n            sendNote: '',\n            sendSuccess: false,\n            sentUserID: null,\n        }, additionals);\n        if (excludes) {\n            excludes.forEach(excludeKey => {\n                delete nextState[excludeKey];\n                nextState[excludeKey] = this.state[excludeKey];\n            });\n        }\n        this.setState(nextState);\n    }\n\n    handleSendNoteInput = (event) => {\n        const sendNote = event.target.value;\n        this.setState({ sendNote });\n    }\n\n    handleUserSelect = (event) => {\n        event.preventDefault();\n        const { selectedUserID } = this.state;\n        const nextID = $(event.currentTarget).attr('data-userid');\n        // Canceling\n        if (String(selectedUserID) === $(event.currentTarget).attr('data-userid')) {\n            this.setState({ selectedUserID: null });\n        // Selecting\n        } else {\n            this.setState({ selectedUserID: nextID });\n        }\n    }\n\n    getSelectedUser = () => {\n        const { selectedUserID } = this.state;\n        return _.find(this.getSearchedFriends(), e => String(e.id) === selectedUserID);\n    }\n\n    getSentUser = () => {\n        const { sentUserID } = this.state;\n        return _.find(this.getSearchedFriends(), e => String(e.id) === sentUserID);\n    }\n\n    getDisplayUsers = () => {\n        if (followingUsersRequested) {\n            return;\n        }\n        this.loadingDisplayUsers = true;\n        followingUsersRequested = true;\n        $.get('/get-share-display-users.json').done(res => {\n            if (res.status_code === 1 && res.users.length > 0) {\n                followingUsers.push.apply(followingUsers, res.users);\n            }\n        }).fail(() => {\n            console.warn('failed to fetch display users')\n        })\n        .always(() => {\n            this.loadingDisplayUsers = false;\n            this.forceUpdate();\n        });\n    }\n\n    handleClickBackFromContact = () => {\n        this.setState({ isContact: false });\n    }\n\n    handleClickContactImport = (event) => {\n        event.preventDefault();\n        this.setState({ isContact: true });\n    }\n\n    getSharedMailUser = () => {\n        const {\n            friendSearchQuery,\n        } = this.state;\n        this.mailUser.username = friendSearchQuery;\n        return [this.mailUser];\n    }\n\n    getSearchedFriends = () => {\n        if (\n            this.state.friendSearchQuery.length !== 0 || \n            this.state.sendSuccess\n        ) {\n            if (this.isInputEmail()) {\n                return this.getSharedMailUser();\n            } else {\n                return this.state.searchedFriends;\n            }\n        } else {\n            return followingUsers;\n        }\n    }\n\n    isInputEmail = () => {\n        const { friendSearchQuery } = this.state;\n        return friendSearchQuery.length > 1 && \n               friendSearchQuery.indexOf('@') > 0;\n    }\n\n    getPrefix(user) {\n        return user.type === 'email' ? '' : '@';\n    }\n\n    static getShareMessage(objectType, defaultMessage = '') {\n        let shareMessage = defaultMessage;\n        if (objectType === ShareObjectTypes.list) {\n            shareMessage = 'Share collection';\n        } else if (objectType === ShareObjectTypes.store) {\n            shareMessage = 'Share store';\n        } else if (objectType === ShareObjectTypes.user) {\n            shareMessage = 'Share profile';\n        } else if (objectType === ShareObjectTypes.article) {\n            shareMessage = 'Share article';\n        }\n        return shareMessage;\n    }\n\n    isEmailOnlyMode = () => {\n        return !(this.props.objectType === ShareObjectTypes.thing || this.props.objectType === ShareObjectTypes.article) || !FancyUser.loggedIn;\n    }\n\n    componentDidUpdate(prevProps) {\n        const { showShare } = this.props;\n        const { isContact } = this.state;\n        // share is closed, if contact mode close it.\n        if (isContact && !showShare && prevProps.showShare !== showShare) {\n            this.setState({ isContact: false });\n        }\n    }\n\n    componentDidMount() {\n        // Do loading friends stuff.\n        if (!this.isEmailOnlyMode()) {\n            this.getDisplayUsers();\n        }\n    }\n\n    render() {\n        const {\n            showShare,\n            title,\n            headerGap,\n            objectType,\n            objectId,\n            objectMeta,\n            viewerUsername,\n            referrerURL,\n        } = this.props;\n\n        if (process.env.NODE_ENV !== 'production') {\n            viewerUsername == null &&\n            console.warn('SharePopover: viewerUsername missing');\n        }\n\n        const {\n            friendSearchQuery,\n            sendNote,\n            sendSuccess,\n            sentUserID,\n            searching,\n            isContact\n        } = this.state;\n        const searchedFriends = this.getSearchedFriends();\n\n        const selectedUser = this.getSelectedUser();\n        const sentUser = this.getSentUser();\n\n        var emptyDisplay = Display.Block;\n        var emptyClassName;\n        var searchedFriendsDisplay;\n        const inputIsEmail = this.isInputEmail();\n        const emailOnlyMode = this.isEmailOnlyMode(); \n        // Search returns nothing\n        \n        if (sendSuccess) {\n            emptyClassName = ViewClasses.Success;\n        } else {\n            if (emailOnlyMode && !inputIsEmail) {\n                emptyClassName = ViewClasses.Default;\n            } else if (searchedFriends.length > 0) {\n                if (!inputIsEmail && searching) {\n                    emptyClassName = ViewClasses.Searching;\n                }\n            } else if (searchedFriends.length === 0) {\n                if (friendSearchQuery.length === 0) {\n                    if (this.loadingDisplayUsers) {\n                        emptyClassName = ViewClasses.Searching;\n                    } else {\n                        emptyClassName = ViewClasses.Default;\n                    }\n                } else {\n                    if (searching) {\n                        emptyClassName = ViewClasses.Searching;\n                    } else {\n                        emptyClassName = ViewClasses.NoResult;\n                    }\n                }\n            }\n        }\n\n        if (emptyClassName) {\n            searchedFriendsDisplay = Display.None;\n        } else {\n            emptyDisplay = Display.None;\n        }\n\n        if (selectedUser) {\n            searchedFriendsDisplay = Display.None;\n        }\n\n        const noteSendable = (\n            !this.sending &&\n            searchedFriends.length > 0 &&\n            !!selectedUser\n        );\n\n        // Sliding indicator style\n        const isSNS = !(selectedUser || sendSuccess);\n\n        let sentMessage = '';\n        if (sendSuccess) {\n            sentMessage += gettext(\"Sent to \");\n            sentMessage += sentUser ? (sentUser.fullname || sentUser.username) : sentUserID\n        }\n\n        let bottom = false;\n        if (headerGap < 290) {\n            bottom = true;\n        }\n\n        return (\n            <div id=\"show-share\" className={classnames(\"more-share-popup more-share-popup-2 has-arrow\", { bot: bottom })} style={getDisplay(showShare)}>\n                <h3 className=\"tit\" style={Display.NoneIf(isContact || selectedUser)}>{SharePopover.getShareMessage(objectType, 'Share')}</h3>\n                <a className=\"btn-back\" style={Display.NoneIf(!selectedUser || sentUser)}\n                   onClick={() => {this.setState({ selectedUserID: null });return false;}}>Back</a>\n                <div className=\"frm\" style={Display.NoneIf(isContact)}>\n                    {FancyUser.loggedIn &&\n                    <div id=\"more-share-send\">\n                        <span className=\"textbox before-bg-share2\" style={Display.NoneIf(selectedUser || sendSuccess)}>\n                            <input id=\"more-share-email\"\n                                   className=\"text\" type=\"text\"\n                                   placeholder={emailOnlyMode ? gettext(\"Enter email address\") : gettext(\"Username or email address\")}\n                                   autoComplete=\"off\"\n                                   onChange={this.handleFriendSearch}\n                                   value={friendSearchQuery} />\n                        </span>\n                        <ul className=\"lists\" style={searchedFriendsDisplay}>\n                            {searchedFriends\n                                .map((user, idx) => {\n                                    const term = $.trim(friendSearchQuery).toLowerCase();\n                                    const prefix = this.getPrefix(user);\n                                    let style;\n                                    if (term) {\n                                        if (\n                                            `${user.fullname} ${prefix}${user.username}`.toLowerCase().indexOf(term) === -1\n                                        ) {\n                                            style = Display.None;\n                                        }\n                                    }\n                                    let username;\n                                    let imgClass;\n                                    if (user.type === 'email') {\n                                        username = user.username;\n                                        imgClass = 'email';\n                                    } else {\n                                        username = `${prefix}${user.username}`;\n                                    }\n\n                                    return (\n                                        <li key={idx} style={style}>\n                                            <a className=\"before-bg-share2\"\n                                                onClick={this.handleUserSelect}\n                                                data-userid={user.id}>\n                                                <img alt=\"\" className={imgClass} src={user.profile_image_url} />\n                                                <b>{user.fullname}</b>\n                                                <small>{username}</small>\n                                            </a>\n                                        </li>\n                                    )\n                            })}\n                        </ul>\n                        <div className={emptyClassName} style={emptyDisplay}>\n                            <i className=\"circle bg-share2\" />\n                            {emailOnlyMode ?\n                                <span className=\"default\">\n                                    {gettext(\"Share this via Email\")}\n                                </span>\n                                :\n                                <span className=\"default\">\n                                    <b>{gettext(\"Find people to share with\")}</b>\n                                    <a onClick={this.handleClickContactImport}>{gettext(\"Import from contacts\")}</a>\n                                </span>\n                            }\n                            <span className=\"searching\">\n                                {gettext(\"Searching...\")}\n                            </span>\n                            <span className=\"no-result\">\n                                {gettext(\"No users found\")}\n                            </span>\n                            <span className=\"success\">\n                                <b>{gettext(\"Success!\")}</b>\n                                {sentMessage}\n                                <a className=\"close\" onClick={this.handleContinue}>{gettext(\"Continue\")}</a>\n                            </span>\n                        </div>\n                        <div className=\"send\" style={Display.NoneIf(selectedUser == null)}>\n                            {selectedUser && \n                                <span className=\"recipient\">\n                                    <img alt=\"user image\" className={selectedUser.type === 'email' && 'email'} src={selectedUser.profile_image_url} />\n                                    <b>{selectedUser.fullname}</b>\n                                    <small>{this.getPrefix(selectedUser)}{selectedUser.username}</small>\n                                </span>\n                            }\n                            <fieldset>\n                                <textarea placeholder=\"Add a message\" value={sendNote} onChange={this.handleSendNoteInput} />\n                                <button className=\"btn-send\" disabled={!noteSendable} onClick={this.handleSend}>Send</button>\n                            </fieldset>\n                        </div>\n                    </div>\n                    }\n                    <SNSShareBox showShareBox={isSNS} title={title} referrerURL={referrerURL}\n                                 objectId={objectId} objectType={objectType} objectMeta={objectMeta}\n                                 viewerUsername={viewerUsername} />\n                </div>\n                <div className=\"contact-sns\" style={Display.NoneIf(!isContact)}>\n                    <a onClick={this.handleClickBackFromContact} className=\"back\">Back</a>\n                    <a href=\"/find-friends\" className=\"fb\" target=\"_blank\"><em> Facebook</em></a>\n                    <a href=\"/find-friends?type=twitter\" className=\"tw\" target=\"_blank\"><em> Twitter</em></a>\n                    <a href=\"/find-friends?type=gmail\" className=\"gm\" target=\"_blank\"><em> Gmail</em></a>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport class SNSShareBox extends React.Component {\n    state = {\n        copied: false,\n        referrerURL: '',\n        textboxDisplay: false\n    };\n    loading = false;\n    snsShareWindow = null;\n\n    getRefURL() {\n        return this.state.referrerURL || this.props.referrerURL\n    }\n\n    updateEmbedOption($li, viewerUsername) {\n        const $thumb = $li.find('.embed-thum');\n        const $options = $li.find('input[name=\"embed-info\"]');\n        const types = [];\n\n        $options.each(function() {\n            const { value, checked } = this;\n            if (checked) {\n                $thumb.addClass(value);\n                types.push(value);\n            } else {\n                $thumb.removeClass(value);\n            }\n        });\n        const width = parseInt($li.find('input[name=\"embed-width\"]').val(), 10) || undefined;\n\n        const snippet = $('<script />', {\n            'src': `//${location.hostname}/embed.js?v=150608`,\n            'async': true,\n            'class': 'fancy-embed',\n            'data-id': $li.attr('tid') || $li.attr('objectId') || '',\n            'data-ref': viewerUsername,\n            'data-type': types.length > 0 ? types.join(',') : '',\n            'data-width': width\n        }).prop('outerHTML');\n        $li.find('textarea[name=\"embed-code\"]').val(snippet);\n    }\n\n    handleEmbed = () => {\n        const { updateEmbedOption, props: { objectType, objectId, viewerUsername } } = this;\n\n        if (objectType === ShareObjectTypes.thing) {\n            const $ep = $(\"#embed_popup\");\n            $ep\n                .off('click.fancyembed')\n                .off('keyup.fancyembed')\n                .on('click.fancyembed', 'input[name=\"embed-info\"]', function() {\n                    updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n                })\n                .on('keyup.fancyembed', 'input[name=\"embed-width\"]', function() {\n                    updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n                });\n\n            $ep.find('.customize').removeClass('opened');\n            $ep.find('input[name=\"embed-info\"]').prop('checked', true);\n            $ep.find('input[name=\"embed-width\"]').val(450);\n            $ep.attr('tid', objectId);\n            updateEmbedOption($(\"#embed_popup\"), viewerUsername);\n\n            $.dialog(\"embed_item\").open(true);\n        }\n\n        return false;\n    }\n\n    handleShare = (event) => {\n        const { props: { objectId, objectType } } = this;\n        const element = event.currentTarget;\n\n        // redirect to acquired URL using blank window, which does not blocked by blocker usually.\n        // Low possiblity, but if assign fails with DOMException, silently pass so\n        // user can retry without confusion.\n        if (event.detail && event.detail.faintClick) {\n            try {\n                this.snsShareWindow.location.assign(element.getAttribute('href'));\n            } catch (e) {}\n            // Remove disposable window \n            this.snsShareWindow = null;\n            return;\n        } else {\n            if (!this.getRefURL()) {\n                this.snsShareWindow = window.open('about:blank', '_fancy_sns_share');\n            }\n            event.preventDefault();\n        }\n\n        getShareURL(this, (directClick) => {\n            if (directClick) {\n                window.open(element.getAttribute('href'), '_fancy_sns_share');\n            } else {\n                triggerEvent(element, 'click', { faintClick: true });\n            }\n        });\n\n        if (objectType === ShareObjectTypes.thing) {\n            const type = SNSDict[element.className];\n            MP('Complete Share', { \"thing id\": objectId, type });\n        }\n    }\n\n    render() {\n        const { title, showShareBox, objectType } = this.props;\n        const { textboxDisplay } = this.state;\n        const referrerURL = this.getRefURL()\n\n        return (\n            <div id=\"more-share-sns\" className=\"more-share-sns\" style={showShareBox ? Display.Block : Display.None}>\n                <span className=\"via after\" style={Display.NoneIf(textboxDisplay)}>\n                    <a href={`https://www.facebook.com/sharer.php?u=${referrerURL}`}\n                        onClick={this.handleShare} className=\"fb\" target=\"_blank\">\n                        <span className=\"ic-fb\" /> <em>{gettext(\"Share with Facebook\")}</em>\n                    </a>\n                    <a href={`https://twitter.com/share?text=${encodeURI(title)}&url=${referrerURL}&via=fancy`}\n                        onClick={this.handleShare} className=\"tw\" target=\"_blank\">\n                        <span className=\"ic-tw\" /> <em>{gettext(\"Share with Twitter\")}</em>\n                    </a>\n                    <a href={`https://www.tumblr.com/share/link?url=${referrerURL}&name=${encodeURI(title)}&description=${encodeURI(title)}`}\n                        onClick={this.handleShare} className=\"tb\" target=\"_blank\">\n                        <span className=\"ic-tb\" /> <em>{gettext(\"Share with Tumblr\")}</em>\n                    </a>\n                    {objectType === ShareObjectTypes.thing &&\n                        <a onClick={this.handleEmbed} className=\"embed\">\n                            <span className=\"ic-em\" /> <em>{gettext(\"Embed this item\")}</em>\n                        </a>\n                    }\n                </span>\n            </div>\n        );\n    }\n}\n","import React from \"react\";\n// import classnames from \"classnames\";\n// import { proportionFormat, isSafari as isSafariUtil } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\n\nexport function getVideo(object) {\n    if (object.h264_1000k_url) return object;\n    const saleVideo = object && object.sales && object.sales.video;\n    const thingOrArticleVideo = (object && object.video_cover) || (object && object.cover_video);\n    if (saleVideo) {\n        return saleVideo;\n    } else if (thingOrArticleVideo) {\n        try {\n            if (!thingOrArticleVideo.h264_1000k_url && object.cover_video.outputs.h264_1000k) {\n                thingOrArticleVideo.h264_1000k_url = object.cover_video.outputs.h264_1000k.url;\n            }\n        } catch (e) {}\n        return thingOrArticleVideo;\n    } else if (object.metadata && object.metadata.video_url) {\n        return {\n            thumbnail_url: object.image.src,\n            original_url: object.metadata.video_url\n        };\n    } else {\n        console.warn(\"<Video /> component is mounted but with unknown type\");\n        return {};\n    }\n}\n\nexport class Video extends React.Component {\n    constructor(props) {\n        super(props);\n        this.id = +new Date();\n    }\n    el = null;\n    videoEl = null;\n    static isVideoAvailableForThing(thing) {\n        let thingHasVideo = false;\n        if (thing) {\n            if (thing.video_cover) {\n                thingHasVideo = true;\n            } else if (thing.metadata) {\n                if (thing.metadata.video_url) {\n                    thingHasVideo = true;\n                }\n            } else if (thing.sales) {\n                if (thing.sales.video) {\n                    thingHasVideo = true;\n                }\n            }\n        }\n        return thingHasVideo;\n    }\n    static isVideoAvailableForArticle(article) {\n        if (article && article.cover_video && article.cover_video.status == \"ready\") {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    getSrc() {\n        const { object } = this.props;\n        const video = getVideo(object);\n        return video.h264_1000k_url || video.original_url || video.original;\n    }\n\n    getThumbnail() {\n        const { object } = this.props;\n        const video = getVideo(object);\n        return video.thumbnail_url;\n    }\n\n    getLoop() {\n        const { object } = this.props;\n        return getVideo(object).loop;\n    }\n\n    shouldComponentUpdate(nextProps) {\n        return (\n            nextProps.lastFullyRenderedObjectID !== this.props.lastFullyRenderedObjectID ||\n            nextProps.display !== this.props.display ||\n            nextProps.playing !== this.props.playing ||\n            nextProps.object !== this.props.object);\n    }\n\n    prepare() {\n        const domCls = `video-${this.id}`;\n        let $el = $(`.${domCls}`);\n        if ($el.length) {\n            if ($el[0].src !== this.getSrc()) {\n                $el[0].src = this.getSrc();\n                $el[0].loop = !!this.getLoop();\n                $el[0].currentTime = 0;\n            }\n        } else {\n            $el = $(\n                `<video id=\"myVideo\" class=\"${domCls}\" preload=\"auto\" playsInline disablePictureInPicture autoplay muted controls controlslist=\"nodownload nofullscreen noremoteplayback\" src=\"${this.getSrc()}\" loop=\"${!!this.getLoop()}\" poster=\"${this.getThumbnail()}\"/>`\n            )\n                .on(\"ended\", function() {\n                    this.currentTime = 0;\n                })\n            this.videoEl = $el.get(0);\n            $(this.el).empty().append(this.videoEl);\n        }\n    }\n\n    componentDidUpdate(prevProps) {\n        const np = this.props;\n        if (np.display !== prevProps.display) {\n            if (np.display === false) {\n                this.videoEl && this.videoEl.pause();\n            } else {\n                this.videoEl && this.videoEl.play();\n            }\n        }\n        if (np.display && np.playing != prevProps.playing) {\n            if (np.playing === false) {\n                this.videoEl && this.videoEl.pause();\n            } else {\n                this.videoEl && this.videoEl.play();\n            }\n        }\n        this.prepare();\n    }\n\n    render() {\n        const { display, style = {}, playing } = this.props;\n        \n        return (\n            <div\n                style={_.extend(style, Display.NoneIf(!display))}\n                className=\"video_player nozoom\"\n                ref={el => {\n                    this.el = el;\n                    if (!this.videoEl) {\n                        this.prepare();\n                    }\n                }}\n            />\n        );\n    }\n}\n","export { Video } from './Video';\nexport * from './MoreShare';\nexport * from './MoreShareFacade';\nexport * from './MoreShareUtils';\nexport { SharePopover } from './SharePopover';\nexport { AddlistPopover } from './AddlistPopover';\nexport { AddlistAction } from './AddlistAction';\nexport * from './Popup';\nexport { history } from './History'\nexport { default as applyProductSlide } from './ProductSlide';\n"],"sourceRoot":""}
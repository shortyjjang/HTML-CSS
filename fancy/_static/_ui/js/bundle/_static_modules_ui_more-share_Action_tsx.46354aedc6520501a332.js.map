{"version":3,"sources":["webpack://fancy/./_static/modules/ui/more-share/Action.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AddlistPopup.js"],"names":["getUrl","thingUrl","viewerUsername","url","connector","indexOf","copyAction","$messageEl","copyToClipboard","text","setTimeout","setup","$","document","on","$el","$container","closest","hasClass","removeClass","body","addClass","data","ts","Math","random","evt","e2","target","is","length","preventDefault","stopPropagation","off","window","__FancyUser","loggedIn","require_login","$this","objectId","attr","renderPopup","AddlistPopup","lists","listSearchQuery","listCreationQuery","listCreating","setState","drawUserList","listSearchInput","focus","event","value","state","type","which","KEYS","trim","props","isEmpty","updateList","createList","callback","success","updated","MP","targ","currentTarget","selectedListId","Number","getAttribute","theList","filter","list","id","prevAdded","added","eventName","name","update","dialog","popupName","$obj","handleDialogOpen","prevProps","prevState","center","getListCheckbox","res","element","handleListSearch","el","map","idx","term","toLowerCase","style","_","isString","Display","ident","classnames","handleListItemToggle","quickCreateList","handleListCreation","handleCreateListQueryChange","gettext","Component","get","tid","done","resp","status_code","alertify","message","closePopup","error","err","console","warn","checked","unchecked","payload","join","post"],"mappings":"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","file":"_static_modules_ui_more-share_Action_tsx.46354aedc6520501a332.js","sourcesContent":["import { copyToClipboard, renderPopup } from \"fancyutils\";\n\nimport AddlistPopup from \"../overlay-thing/components/popup/AddlistPopup\";\n\nconst getUrl = (thingUrl: string, viewerUsername: string) => {\n    let url = `https://fancy.com${thingUrl}`;\n    if (viewerUsername) {\n        const connector = ~url.indexOf(\"?\") ? \"&\" : \"?\";\n        url = `${url}${connector}ref=${viewerUsername}`;\n    }\n    return url;\n};\n\nconst copyAction = (thingUrl: string, viewerUsername: string, $messageEl: JQuery<HTMLElement>) => {\n    copyToClipboard(getUrl(thingUrl, viewerUsername));\n    $messageEl.text(\"Link copied!\");\n    setTimeout(() => {\n        $messageEl.text(\"Copy link\");\n    }, 2000);\n};\n\nexport function setup() {\n    $(() => {\n        // click outside to close\n        $(document)\n            .on(\"click\", \".figure-item .menu-container .btn-more\", function () {\n                const $el = $(this);\n\n                const $container = $el.closest(\".menu-container\");\n                if ($container.hasClass(\"show-list\")) {\n                    $container.removeClass(\"show-list\");\n                } else if ($container.hasClass(\"show-share\")) {\n                    $container.removeClass(\"show-share\");\n                } else if ($container.hasClass(\"opened\")) {\n                    $container.removeClass(\"opened\").closest(\"li\").removeClass(\"active\");\n                    $(document.body).removeClass(\"show-more-share\");\n                } else {\n                    $container.addClass(\"opened\").closest(\"li\").addClass(\"active\");\n                    $(document.body).addClass(\"show-more-share\");\n                }\n                if (!$el.data(\"clickoutside\")) {\n                    const ts = Math.random();\n                    const evt = `click.action-clickoutside-${ts}`;\n                    $el.data(\"clickoutside\", evt);\n                    $(document).on(evt, function (e2) {\n                        if ($(e2.target).is($el) || $(e2.target).closest($container).length) {\n                            return true;\n                        }\n                        e2.preventDefault();\n                        e2.stopPropagation();\n                        $el.closest(\".menu-container.opened\").removeClass(\"opened\").closest(\"li\").removeClass(\"active\");\n                        $(document.body).removeClass(\"show-more-share\");\n                        // close addlist popover\n                        $el.closest(\".menu-container\").removeClass(\"show-list\");\n                        $(document).off(evt);\n                        $el.data(\"clickoutside\", null);\n                    });\n                }\n            })\n            .on(\"click\", \".figure-item .menu-container .add-list\", function () {\n                if (!window.__FancyUser.loggedIn) {\n                    window.require_login();\n                    return false;\n                }\n                const $this = $(this);\n                const objectId = $this.closest(\"li\").attr(\"tid\")!;\n                renderPopup(AddlistPopup, { objectId });\n                return false;\n            })\n            .on(\"click\", \".figure-item .menu-container .copy-link\", function () {\n                const $el = $(this);\n                const url = $el.closest(\".figure-item\").data(\"url\");\n                copyAction(url, window.__FancyUser.viewerUsername, $el);\n                return false;\n            })\n            .on(\"click\", \".figure-item .menu-container .share\", function () {\n                $(this).closest(\".menu-container\").addClass(\"show-share\");\n                return false;\n            })\n            .on(\"click\", \".figure-item .menu-container .ly-close\", function () {\n                $(this).closest(\".menu-container\").removeClass(\"opened\");\n                return false;\n            });\n    });\n}\n\n// $(function () {\n//     $(\".figure-item #show-share .close, .figure-item #show-addlist .close\").click(function (e) {\n//         e.preventDefault();\n//         $(this).closest(\".menu-container\").removeClass(\"show-share\").removeClass(\"show-list\");\n//         return false;\n//     });\n// });\n","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { closePopup, KEYS, MP, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nexport default class AddlistPopup extends Component {\n    static popupName = 'add-list';\n    state = {\n        lists: [],\n        listSearchQuery: '',\n        listCreationQuery: '',\n        listCreating: false,\n    };\n\n    handleDialogOpen = () => {\n        this.setState({ lists: [], listSearchQuery: '', listCreationQuery: '' });\n        this.drawUserList()\n        setTimeout(() => {\n            this.listSearchInput.focus();\n        }, 0);\n\n    }\n    componentDidMount() {\n        $.dialog(AddlistPopup.popupName).$obj.on('open', this.handleDialogOpen);\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AddlistPopup.popupName).center();\n    }\n\n    drawUserList() {\n        const objectId = this.props.objectId;\n        getListCheckbox({\n            objectId,\n            callback: res => { this.setState(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setState({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (this.state.listCreating) return;\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        this.setState({ listCreating: true })\n        // save new list\n        updateList({\n            objectId,\n            createList: listCreationQuery,\n            callback: (success, updated) => {\n                if (success) {\n                    const { lists } = this.state;\n                    MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    this.setState( {\n                        listCreationQuery: '', listCreating: false,\n                        lists: [ ...updated, ...lists ],\n                    });\n                }\n            }\n        })\n    }\n\n    handleListItemToggle = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = Number(targ.getAttribute('data-listid'));\n        const theList = lists.filter(list => list.id === selectedListId)[0];\n        const prevAdded = theList.added;\n        theList.added = !theList.added;\n        const eventName = theList.added ? \"Add to List\" : \"Remove from List\";\n        this.setState({ lists })\n\n        const callback = (success, updated) => {\n            const { lists } = this.state;\n            if (success) {\n            } else {\n                const theList = lists.filter(list => list.id === selectedListId)[0];\n                theList.added = prevAdded;\n            }\n            this.setState({ lists })\n            MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n        };\n\n        const update = { objectId, callback };\n\n        if (theList.added) update['checked'] = [theList.id];\n        else update['unchecked'] = [theList.id];\n        updateList(update)\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setState({ listCreationQuery: event.target.value });\n    }\n\n    render() {\n        var { objectId } = this.props;\n        var {\n            lists,\n            listSearchQuery,\n            listCreationQuery,\n            listCreating,\n        } = this.state;\n\n        return (\n            <>\n                <p className=\"ltit\">Add to collections</p>\n                <fieldset className=\"search\">\n                    <input type=\"text\" placeholder=\"Search\" className=\"text\" \n                        value={listSearchQuery} ref={(element) => {this.listSearchInput = element;}}\n                        onChange={this.handleListSearch} />\n                </fieldset>\n                <div className=\"list\">\n                    <ul ref={(el) => {this.lists = el;}}>\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style} className={classnames({ \"added\": list.added })}>\n                                <label>{list.name}</label>\n                                <button\n                                    data-listid={list.id} \n                                    onClick={this.handleListItemToggle}\n                                    className=\"btns-blue-embo\">{list.added ? \"Remove\" : \"Add\"}</button>\n                            </li>\n                        )\n                    })}\n                    </ul>\n                </div>\n                <fieldset className=\"create\">\n                    <input \n                        type=\"text\" placeholder=\"Create new collection\" \n                        ref={(element) => {this.quickCreateList = element;}}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}/>\n                    <button className={classnames(\"btn-create\", { \"loading\": listCreating })} style={Display.NoneIf($.trim(listCreationQuery).length == 0)}\n                        onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </fieldset>\n                <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n            </>\n        );\n    }\n}\n\nfunction getListCheckbox({ objectId, callback }) {\n    $.get('/get_list_checkbox.json', { tid: objectId }).done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            closePopup(AddlistPopup.popupName);\n        }\n        callback && callback({ lists: resp.lists })\n    },)\n    .error(err => { \n        alertify.alert(\"Please try again later.\");\n        console.warn(err); \n        closePopup(AddlistPopup.popupName);\n    });\n}\n\nfunction updateList({ objectId, checked, unchecked, createList, callback }) {\n    const payload = { tid: objectId };\n    if (checked) payload['add_list_ids'] = checked.join(',');\n    if (unchecked) payload['remove_list_ids'] = unchecked.join(',');\n    if (createList) payload['new_list'] = createList;\n\n    $.post('/update_list_checkbox.json', payload)\n    .done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            callback(false, null);\n        } else {\n            callback(true, resp.lists);\n        }\n    })\n    .error(err => { \n        console.warn(err); \n        alertify.alert(\"Please try again later.\");\n        callback(false, []);\n    })\n}\n"],"sourceRoot":""}
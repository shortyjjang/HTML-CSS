{"version":3,"sources":["webpack://fancy/webpack/runtime/load script","webpack://fancy/./_static/modules/ui/overlay-thing/Shared.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/action-constants.js","webpack://fancy/./_static/modules/ui/overlay-thing/action/action-helpers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/action/actions.js","webpack://fancy/./_static/modules/ui/overlay-thing/appstate.ts","webpack://fancy/./_static/modules/ui/overlay-thing/cache.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/map.ts","webpack://fancy/./_static/modules/ui/overlay-thing/config.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/entry-events.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/history.js","webpack://fancy/./_static/modules/ui/overlay-thing/container/routeutils.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/FancyContext.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AdminPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/SimpleSharePopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/popup/AddlistPopup.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/ActionButtons.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/zoom.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Image/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/Perf.js","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItemForm.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/CartButton.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/ApplePayButton.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/SaleItem/multiOption.ts","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Info.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/Detail.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Thing/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/ThingCard.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/MerchantInfo.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Recommendation.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/Reviews.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/components/v2/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/index.tsx","webpack://fancy/./_static/modules/ui/overlay-thing/store/initial-store.ts","webpack://fancy/./_static/modules/ui/overlay-thing/ThingTypes.js","webpack://fancy/./_static/modules/ui/overlay-thing/reducers.ts","webpack://fancy/./_static/modules/ui/overlay-thing/store/store.ts","webpack://fancy/webpack/bootstrap","webpack://fancy/webpack/runtime/compat get default export","webpack://fancy/webpack/runtime/create fake namespace object","webpack://fancy/webpack/runtime/define property getters","webpack://fancy/webpack/runtime/ensure chunk","webpack://fancy/webpack/runtime/get javascript chunk filename","webpack://fancy/webpack/runtime/global","webpack://fancy/webpack/runtime/harmony module decorator","webpack://fancy/webpack/runtime/hasOwnProperty shorthand","webpack://fancy/webpack/runtime/make namespace object","webpack://fancy/webpack/runtime/publicPath","webpack://fancy/webpack/runtime/jsonp chunk loading","webpack://fancy/webpack/startup"],"names":["inProgress","dataWebpackPrefix","getFancyDepsRoot","Shared","getStore","store","cache","pagingContext","transition","reloadCurrentThing","keys","slice","call","arguments","reduce","prev","next","constantGen","shouldOpenThing","state","appContext","visible","shouldFetchThing","thingID","thing","ID","isFetching","closeOverlay","dispatch","isStaticPage","closeModal","historyData","history","stripPathname","document","title","closeThing","$","off","window","trigger","onDataFetched","type","thingData","fromServer","sales_available","isEmpty","sales","show_anywhere_only","status","salesStatus","loadThing","onLoadThing","fetchedThingsIds","fetchThing","ThingCache","killCache","override","queryString","getState","openThing","shouldFetch","cac","isCrawled","thingPageData","options","requestThing","owner","external_apps","viewer","getLocationArgPairs","admin","successFn","need_more_fetch","image_resized_max","src","Image","image","failFn","failureXHR","requestThingFail","alertify","alert","requestPromise","then","get","fail","console","warn","getCordialProperties","prop","id","productID","seller","username","url","name","emojified_name","category","cordial_category","instock","available","soldout","images","image_url","price","parseFloat","min_price","recommended","length","map","item","i","MPArgs","currentLocationArgPair","utm","MP","LogExposed","addLog","crdl","e","trackingItem","brand","brand_name","dataLayer","push","product_id","event","products","undefined","products_info","revenue","option_id","TrackingEvents","viewItem","ga","hitType","page","location","href","toggleFancy","fancyContext","fancyd","fancyd_count","loading","toggleFancyAction","ajax","data","done","json","fc","completeFancy","cancelFancy","updateSaleContext","newContext","saleContext","slideContext","saleOptionID","isSalesOptionsAvailable","basis","_","find","option","calculatePrice","C","firstOptionImageIdx","getCurrentSaleOption","saleImages","getSaleImages","some","img","idx","thumbnailIndex","setThumbnailIndex","_convertCurrency","nextCode","nextPrice","force","currencyCode","currencyMoney","currencySymbol","callback","numberType","replace","isString","dataType","amount","currency_code","success","currency","code","formatPrice","symbol","requestCurrencyConversion","toFixed","convertCurrency","pendingID","updateAppContext","contextObject","context","loggedIn","updateState","k","v","ignoreCralwed","existence","THINGS","SALES","getCrawled","count","selector","value","t","index","__THING_CACHE","gettext","mapStateToThingProps","followContext","getFirstSaleOption","ignoreEmptySaleOption","opts","filter","discount_percentage","quantity","retail_price","newPrice","regex","test","currencyIsUSD","tid","hotelImages","salesImages","thingImages","saleOptionWaitingRegistry","setWaiting","chosenSaleOptionID","setResult","getWaiting","waiting","chosenSaleOption","fillArray","original","filler","ol","fl","sparseIdxs","j","thumbnailsLimit","hotel_search","thumbnail_src","thumbnailUrl","width","height","unshift","video","isVanityQueriable","props","suppress","AC","minPrice","maxPrice","keyword","trim","original_labels","isNaN","parseInt","labels","ok","getSafeNameProp","dangerouslySetInnerHTML","__html","children","isVideoUploadable","metadata","EXPIRED","REMOVED","PENDING","COMING_SOON","ACTIVE","SOLD_OUT","Selectors","HomepageWrapper","handleOverlayThingKeyEvents","target","tagName","which","KEYS","conditionalTransition","aElement","attr","click","isStream","has","getAttribute","LinkTypes","oneshotEventAttached","attachEntryEvents","body","__INIT_THING_ANCHOR","on","isPlainLeftClick","this","getObjectTypeFromUrl","getPathname","preventDefault","$targ","didClickOn","eitherFancy","sharedState","draggingAdmin","OtContainer","isStaticCache","isStatic","is","getDynamic","getStatic","scrollToTop","parentElement","scrollTop","scrollEvent","handleScroll","attach","func","prepare","detach","_prepare","throttle","viewportHeight","documentElement","clientHeight","scrollHeight","el","addEventListener","passive","removeEventListener","initialThingPageID","extractMetaFromURL","pathname","initialPageIsThingPage","initialPath","preservedHref","initialTitle","locationIsThingPage","overlayIsOn","runOverlay","thingURLType","hasClass","requestIdleCallback","addClass","meta","historyHook","search","Dynamic","Static","Timeline","Internal","Number","redirect","removeClass","init","movePrev","moveNext","destination","FancyContext","React","useFancy","className","AdminPopup","show_on_homepage","date_published","exclude_from_popular","show_in_search","optionSaving","ownerSaving","mergeSaving","payload","thing_id","inputDate","Date","toISOString","split","setState","post","status_code","Object","assign","message","changeOwnerEl","new_owner","toLowerCase","thing_owner","confirm","new_owner_name","new_thing_id","ntid","old_user_id","xml","xmlUtil","reload","text","always","that","dialog","popupName","$obj","prevProps","prevState","center","checked","onChange","placeholder","style","Display","classnames","onClick","handleSaveOptions","ref","handleChangeOwner","SimpleSharePopup","closePopup","log","shareUrl","copyToClipboard","urlCopied","setTimeout","connector","indexOf","handleCopyLink","encodeURIComponent","AddlistPopup","lists","listSearchQuery","listCreationQuery","listCreating","drawUserList","listSearchInput","focus","objectId","updateList","createList","updated","stopPropagation","targ","currentTarget","selectedListId","theList","list","prevAdded","added","eventName","update","handleDialogOpen","getListCheckbox","res","element","handleListSearch","term","key","data-listid","handleListItemToggle","quickCreateList","onKeyUp","handleListCreation","handleCreateListQueryChange","Component","resp","error","err","unchecked","join","Favorite","useDispatch","require_login","ActionButtons","msg","fancyd_friends","cnt","full_name","renderPopup","FancydByPopupV4","objectType","FancyUser","viewerId","is_admin_any","zoomScale","getBoundarySize","$el","eq","DEBUG","getZoomBoxSize","bs","Math","min","getZoomMargin","zidCac","getZoomImageDimension","zoomMargin","ret","getNextZoomImageStyle","pageX","pageY","$wrapper","boundaryWidth","boundaryHeight","marginHoriz","marginVert","$fig","getImageMeta","offset","left","top","topPosition","showZoomImage","zoomBoxSize","zd","zoomImageContainerX","minmax","zoomImageContainerY","backgroundLeft","backgroundTop","bgPosX","bgPosY","transform","backgroundPosition","display","getZoomImageStyle","isZoomActive","currentZoomImageStyle","backgroundSize","isTouchDevice","navigator","maxTouchPoints","msMaxTouchPoints","SwiperAddons","Thumbs","Zoom","SwiperCore","ImageSlide","memo","setSlideLocked","isActive","useState","setZoomActive","zoomImageStyle","setZoomImageStyle","zoomImageCacheKey","setZoomImageCacheKey","zoomImageLoaded","setZoomImageLoaded","isVideo","h264_1000k_url","isMagnifyingGlassZoomable","useEffect","large_image_url","Promise","r","onload","onerror","zoom","startZoom","zoomShow","nextZoomImageStyle","onMouseMove","object","playing","lastFullyRenderedObjectID","allow","fullScreen","data-src","alt","cursor","backgroundColor","backgroundImage","nextProps","displayName","fancyProps","swiperRef","useRef","swipeThumbsRef","thumbIndex","setThumbIndex","slideLocked","swiper","setSwiper","lastThumbIndex","activeIndex","slideTo","current","thumbSwiper","slides","classList","contains","onSlideChange","preloadImages","lazy","loadPrevNext","loadPrevNextAmount","maxRatio","allowSlidePrev","allowSlideNext","onZoomChange","scale","onSwiper","opacity","max","clickedIndex","direction","spaceBetween","slidesPerView","watchSlidesVisibility","selected","thumbnail_url","Keys","Wrap","Body","Title","Price","Form","Desc","Owner","SaleOptions","currentValue","expander","defaultValue","printer","disabled","onFocus","unselectedLabel","SelectBox","labelValue","label","tabIndex","SizeGuide","showSelectWarning","s","MultiOptionState","option_meta","orderMap","forEach","m","targetIndex","values","filteredOptions","order","sel","uniq","o","getPossibleValuesForIndex","MultiOption","multiOptionState","sid","multiOptions","getMultiOptions","sizeGuidePos","indexTypeOf","additional","selectedArray","selectedValue","showSizeGuide","MultiSelectBox","swatch","MultiSwatch","thumbnail","MultiThumbnail","MultiButton","onMultiSelectBoxChange","MultiSelectBoxOption","data-value","data-index-typeof","onClickSwatch","MultiSwatchOption","data-label","onClickThumbnail","MultiThumbnailOption","onClickMutliButton","MultiButtonOption","Button","onPurchase","onNotifyLater","useCallback","appState","opt","params","sale_item_id","remove","subscribed","applePayTest","selectedQuantity","WebkitAppearance","ApplePayButtonType","ApplePayButtonStyle","FancyApplePay","clicked","salesOptionsAvailable","country","seller_id","requestPurchase","testmode","trace","optionValueFunction","saleNamePrinter","Fancy","discounting","retailPrice","discountPercentage","sale","floatFormatMinusTwo","numberFormat","SaleItemSidebarHead","CurrencyPopup","currentCurrency","renderCurrencyPopup","saleOption","sale_id","personalization","CartAPI","addItem","Cart","openPopup","os","total","displayItems","checkAvailability","applePayDisplay","getInitialMultiOptionState","updateSaleOptionIDFromMultiOptionState","presetOptionId","String","selectedOptionArray","selectedOption","every","extractSaleOptionIDFromMultiOptionState","amendedID","amendSaleOptionFromMultiOptionState","nextSelected","button","dropdown","indexOfType","extend","onClickMultiOptionGen","initializeMultiOption","checkApplePay","nextSaleOptionID","_o","mos","$so","escapeSelector","paymentRequest","nonSoldout","selectedNonSoldoutOption","nextValue","nsc","priceChanges","currencyChanges","applePayButton","optionIsMulti","isOptionMulti","quantitySelectRange","range","showSelectbox","SaleItemOptionsExpander","handleOptionChange","size_guide_id","SizeGuidePopup","personalizable","handlePersonalizationChange","handleQuantityChange","handlePurchase","sio","reviews","summary","shop_url","total_ratings","total_reviews","headerSize","css","offsetTop","rating_avg","Overview","bv","brand_values","shippingInfo","shipping_info","origin","cost","Description","menu","setMenu","showMore","setShowMore","descEl","showFeatures","features","showSpecs","specifications","showReturns","return_exchange_policy_title","shipping_policy","cx","collapsed","description","show","data-featuretype","ThingCard","html_url","max_price","p","sale_items","tag","Likeable","slidesPerColumn","RecentlyViewed","things","setThings","response","recently","thumb_image_url_558","convertThingsV1","useDefaultReviews","per_page","q","sort","setLoading","skip","setReviews","param","useReviews","ReviewHead","attributes","a","rating","ReviewEntry","review","photoIndex","setPhotoIndex","date","mainSrc","nextSrc","prevSrc","onCloseRequest","onMovePrevRequest","onMoveNextRequest","ReviewList","reviewOption","setReviewOption","currentPage","debounceEventUntilTimeout","total_pages","pageNum","review_count","applying","AdminMessages","messages","BreadCrumb","breadcrumbs","AdminSidebar","AppV2","pt","ct","minimumOption","nonSoldoutOptions","getFancyContext","connect","ReduxComponentEnhancer","__Config","bugsnag","Bugsnag","apiKey","plugins","BugsnagPluginReact","user","__FancyUser","Route","path","onLoad","require","overlayContainer","querySelector","thingRegex","articleRegex","initialHref","match","ErrorBoundary","createErrorBoundary","tree","Router","Switch","component","render","readyState","getInitialStoreState","contextName","userCountry","followStore","following","followUser","contexts","ThingTypeMeta","thingContext","PlainThingType","args","objectArgs","mergeObjectArgs","META","getThingType","SaleItemType","createEmptyObject","review_rating","size_chart_ids","GiftcardType","HotelType","hotel","VanityType","LaunchAppType","has_launch_app","ThingTypes","AttachingType","ComparingType","loaded","lastFullyRenderedThingID","populateThingContext","URLMeta","combineReducers","action","updateShallow","cookie","current_country_code","Boolean","seller_follow","followType","nextFancydState","saleOptionInclSales","nextContext","middlewares","thunk","configureStore","reducer","rootReducer","preloadedState","contextKey","middleware","getDefaultMiddleware","serializableCheck","prepend","__webpack_module_cache__","__webpack_require__","moduleId","exports","module","__webpack_modules__","n","getter","__esModule","d","mode","ns","create","def","definition","defineProperty","enumerable","f","chunkId","all","promises","u","g","globalThis","Function","hmd","set","Error","obj","prototype","hasOwnProperty","l","script","needAttach","scripts","getElementsByTagName","createElement","charset","timeout","nc","setAttribute","onScriptComplete","clearTimeout","doneFns","parentNode","removeChild","fn","bind","head","appendChild","Symbol","toStringTag","installedChunks","765","deferredModules","installedChunkData","promise","resolve","reject","errorType","realSrc","request","checkDeferredModules","checkDeferredModulesImpl","result","deferredModule","fulfilled","depId","splice","x","chunkLoadingGlobal","webpackJsonpCallback","chunkIds","moreModules","runtime","executeModules","resolves","parentChunkLoadingFunction","shift","apply","self"],"mappings":"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","file":"OverlayThing.main.d2f9c585d8f11c5fae76.js","sourcesContent":["var inProgress = {};\nvar dataWebpackPrefix = \"fancy:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => fn(event));\n\t\tif(prev) return prev(event);\n\t}\n\t;\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","import { getFancyDepsRoot } from 'fancyutils';\n\nimport store from './store/store';\nimport { cache } from './cache';\nimport { pagingContext, transition } from './container/routeutils';\nimport { reloadCurrentThing } from './container/history';\n\n\ngetFancyDepsRoot().Shared = {\n    getStore: () => store.getState(),\n    cache,\n    pagingContext,\n    transition,\n    reloadCurrentThing,\n};\n","// Generate `key: String(key)` structure by given string key arguments\nfunction constantGen() {\n    var keys = [].slice.call(arguments);\n    return keys.reduce((prev, next) => {\n        prev[next] = next;\n        return prev;\n    }, {});\n}\n\nvar C = constantGen(\n  'UPDATE_APP_CONTEXT',\n  // Loading\n  'REQUEST_THING',\n  'REQUEST_THING_FAILURE',\n  'LOAD_THING',\n\n  // UI Actions\n  'OPEN_THING',\n  'CLOSE_THING',\n\n  // Comment form suggestion\n  'SET_USERNAME_KEYWORD',\n  'LOAD_SUGGESTION',\n\n  // Thumbnail\n  'SET_THUMBNAIL_INDEX',\n\n  // Follow\n  'TOGGLE_FOLLOW',\n  'CANCEL_FOLLOW',\n  'COMPLETE_FOLLOW',\n\n  // Fancy\n  'TOGGLE_FANCY',\n  'CANCEL_FANCY',\n  'COMPLETE_FANCY',\n\n  // Saleitem\n  'UPDATE_SALE_CONTEXT'\n);\n\nexport default C;\n","import { MP, getLocationArgPairs, isEmpty, isStaticPage, stripPathname } from \"fancyutils\";\nimport { Dispatch, State } from \"redux\";\nimport { ThunkAction } from \"redux-thunk\";\n\nimport { history } from \"common-components\";\nimport { historyData } from \"../container/history\";\nimport store from \"../store/store\";\nimport { closeModal } from \"../container/routeutils\";\nimport {\n    closeThing,\n    openThing,\n    loadThing,\n    requestThing,\n    requestThingFail,\n    toggleFollow as toggleFollowAction,\n    cancelFollow,\n    completeFollow,\n    toggleFancy as toggleFancyAction,\n    cancelFancy,\n    completeFancy,\n    setThumbnailIndex,\n} from \"./actions\";\nimport C from \"./action-constants\";\nimport { formatPrice, isSalesOptionsAvailable, getCurrentSaleOption, getSaleImages } from \"../components/map\";\nimport { ThingCache, cache } from \"../cache\";\nimport { salesStatus } from \"../config\";\nimport { ThingObject, SaleContext } from \"ftypes\";\n\nfunction shouldOpenThing(state) {\n    return state.appContext.visible !== true;\n}\n\n// Blocks illegal requests\nfunction shouldFetchThing(state, thingID) {\n    if (state.thing.ID === thingID || state.thing.isFetching) {\n        return false;\n    } else {\n        return true;\n    }\n}\n\nexport function closeOverlay() {\n    return (dispatch: Dispatch) => {\n        if (isStaticPage()) {\n            return;\n        }\n        closeModal();\n        historyData.overlayIsOn = false;\n        history.push(stripPathname(historyData.preservedHref), null);\n        document.title = historyData.initialTitle;\n\n        dispatch(closeThing());\n        $(document).off(\"keydown.overlayThing\");\n        $(window).trigger(\"scroll\");\n    };\n}\n\nfunction onDataFetched(dispatch: Dispatch, thingID, thing, type) {\n    addAdditionalThingContext(thing);\n    cache.add(thingID, thing, type);\n    dispatch(loadThing(thingID, thing));\n    onLoadThing(thing);\n}\n\nconst fetchedThingsIds = {};\n\nexport function fetchThing(\n    thingID: string,\n    type = ThingCache.THINGS,\n    killCache = false,\n    override = false,\n    queryString = \"\"\n) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        if (thingID == null) {\n            console.warn(\"fetchThing(): thingID was null.\");\n            return;\n        }\n        var state = getState();\n        if (shouldOpenThing(state)) {\n            dispatch(openThing());\n        }\n        if (killCache) {\n            cache.remove(thingID, type);\n            delete state.thing;\n        }\n\n        const shouldFetch = override || shouldFetchThing(state, thingID);\n        if (killCache || shouldFetch) {\n            if (cache.exists(thingID, type)) {\n                const cac = cache.get(thingID, type);\n                dispatch(loadThing(thingID, cac));\n                onLoadThing(cac);\n                // if cache is crawled one, request should continue\n                if (!cac.isCrawled) {\n                    return;\n                }\n            }\n\n            // static ot page prefetch\n            if (window.thingPageData) {\n                const thingPageData = window.thingPageData;\n                onDataFetched(dispatch, thingID, thingPageData, type);\n                delete window.thingPageData;\n                return;\n            }\n\n            dispatch(requestThing(thingID));\n            let options;\n\n            options = { owner: true, external_apps: true, viewer: true };\n            if (getLocationArgPairs(\"admin\")) {\n                options.admin = true;\n            }\n            if (type === ThingCache.SALES) {\n                options.sales = true; // /sales/(+d) URL\n            }\n            const successFn = (thing) => {\n                if (thing.need_more_fetch) {\n                    // Load main image as fast as possible.\n                    if (thing.image_resized_max && thing.image_resized_max.src) {\n                        let img = new Image();\n                        img.src = thing.image.src;\n                    }\n                    fetchedThingsIds[thingID] = 1;\n                    dispatch(loadThing(thingID, thing));\n                    onLoadThing(thing);\n                } else {\n                    fetchedThingsIds[thingID] = 2;\n                    onDataFetched(dispatch, thingID, thing, type);\n                }\n            };\n            const failFn = (failureXHR) => {\n                // FIXME: This error handling only happens when there's server-side error -\n                //        can't handle client-side ones\n                dispatch(requestThingFail(/*thingID*/));\n                if (failureXHR && failureXHR.status === 404) {\n                    alertify.alert(\"This page is not available. Please try again later.\");\n                } else {\n                    alertify.alert(\n                        'There was an error while opening the page.<br> Please try again or contact <a mailto=\"cs@fancy.com\">cs@fancy.com</a>.'\n                    );\n                }\n            };\n            if (window.requestPromise) {\n                const requestPromise = window.requestPromise;\n                delete window.requestPromise;\n                requestPromise.then(successFn).catch(failFn);\n            } else {\n                $.get(`/rest-api/v1/things/${thingID}/details${queryString}`, options).then(successFn).fail(failFn);\n            }\n        }\n    };\n}\n\nexport function getCordialProperties(thing) {\n    const prop = {\n        thingID: thing.id,\n        productID: thing.sales.id,\n        seller: thing.sales.seller.username,\n        url: \"https://fancy.com\" + thing.url,\n        name: thing.emojified_name,\n        category: thing.sales.cordial_category,\n        instock: thing.sales.available && !thing.sales.soldout,\n        image: thing.images[0].image_url,\n        price: parseFloat(thing.sales.min_price),\n    };\n    if (thing.recommended && thing.recommended.length) {\n        prop[\"recommended\"] = thing.recommended.map((item, i) => item.id);\n    }\n    return prop;\n}\n\nfunction onLoadThing(thing) {\n    const MPArgs = { \"thing id\": thing.id };\n    const currentLocationArgPair = getLocationArgPairs(\"utm\");\n    if (currentLocationArgPair) {\n        MPArgs.utm = currentLocationArgPair[1];\n    }\n    MP(\"View Thing Detail\", MPArgs);\n    if (typeof LogExposed != \"undefined\") window.LogExposed.addLog(thing.id + \"\", \"thing\");\n    try {\n        window.crdl(\"event\", \"browse\", getCordialProperties(thing));\n    } catch (e) {}\n    try {\n        let trackingItem;\n        if (thing.sales) {\n            trackingItem = {\n                id: thing.sales.id,\n                brand: thing.sales.seller.brand_name,\n                name: thing.sales.emojified_name || thing.emojified_name,\n                price: thing.sales.price,\n            };\n            window.dataLayer.push({\n                product_id: thing.sales.id,\n                event: \"ProductPage\",\n                products: undefined,\n                products_info: undefined,\n                revenue: undefined,\n                option_id: thing.sales.options && thing.sales.options.length ? thing.sales.options[0].id : undefined,\n            });\n        } else {\n            trackingItem = {\n                id: thing.id,\n                name: thing.emojified_name,\n            };\n        }\n        window.TrackingEvents.viewItem(trackingItem);\n        ga(\"send\", { hitType: \"pageview\", page: location.href, title: document.title });\n    } catch (e) {}\n}\n\nfunction addAdditionalThingContext(thingData: ThingObject) {\n    thingData.fromServer = true;\n    thingData.sales_available =\n        !isEmpty(thingData.sales) &&\n        !thingData.sales.show_anywhere_only &&\n        thingData.sales.status !== salesStatus.EXPIRED; // TODO: need to check exact condition.\n}\n\nexport function toggleFollow({ seller_id, user_id }) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var state = getState();\n        var followType;\n        var data;\n        if (seller_id) {\n            followType = \"followStore\";\n            data = { seller_id };\n        } else if (user_id) {\n            followType = \"followUser\";\n            data = { user_id };\n        } else {\n            return;\n        }\n\n        if (state.followContext[followType].loading === false) {\n            var url = state.followContext[followType].following === true ? \"/delete_follow.xml\" : \"/add_follow.xml\";\n            dispatch(toggleFollowAction(followType));\n            $.ajax({\n                url,\n                data,\n                type: \"post\",\n                dataType: \"xml\",\n            })\n                .done(function (xml) {\n                    var $status = $(xml).find(\"status_code\");\n                    if ($status.length && $status.text() !== 0) {\n                        dispatch(completeFollow(followType));\n                    } else {\n                        dispatch(cancelFollow(followType));\n                    }\n                })\n                .fail(function () {\n                    dispatch(cancelFollow(followType));\n                });\n        }\n    };\n}\n\nexport function toggleFancy(thingID: string) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var state = getState();\n        var { fancyd, fancyd_count, loading } = state.fancyContext;\n        if (!loading) {\n            dispatch(toggleFancyAction(thingID));\n            $.ajax({\n                type: \"PUT\",\n                url: `/rest-api/v1/things/${thingID}`,\n                data: {\n                    fancyd: !fancyd,\n                },\n            })\n                .done(function (json) {\n                    var fc = 0;\n                    if (json.id && json.fancyd === !fancyd) {\n                        if (json.fancyd === true) {\n                            fc = fancyd_count + 1;\n                        } else if (json.fancyd === false) {\n                            fc = fancyd_count - 1;\n                        }\n                        // cache.update(thingID, undefined, \"fancyd\", json.fancyd);\n                        // cache.update(thingID, undefined, \"fancyd_count\", fc);\n\n                        dispatch(completeFancy(thingID, fc));\n                    } else {\n                        dispatch(cancelFancy(thingID));\n                    }\n                })\n                .fail(function () {\n                    dispatch(cancelFancy(thingID));\n                });\n        }\n    };\n}\n\nfunction calculatePrice(thing: ThingObject, saleContext: SaleContext, newContext: SaleContext) {\n    const saleOptionID = newContext.saleOptionID || saleContext.saleOptionID;\n    const sales = thing && thing.sales;\n    // Get object basis for retrieving price.\n    if (isSalesOptionsAvailable(sales)) {\n        const basis = _.find(sales.options, (option) => option.id === saleOptionID);\n        if (basis != null) {\n            return basis.price;\n        } else {\n            console.warn(\n                \"calculatePrice():\",\n                \"Wrong saleOptionID supplied, please investigate. saleOptionID: \",\n                saleOptionID\n            );\n            return 0;\n        }\n    } else if (sales != null) {\n        return sales.price;\n    } else {\n        return 0;\n    }\n}\n\nexport function updateSaleContext(newContext: SaleContext) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        var { thing, saleContext, slideContext } = getState();\n        newContext.price = calculatePrice(thing.data, saleContext, newContext);\n        dispatch({ ...newContext, type: C.UPDATE_SALE_CONTEXT });\n        if (saleContext.saleOptionID !== newContext.saleOptionID) {\n            const option = getCurrentSaleOption(thing.data.sales, newContext, true);\n            const saleImages = getSaleImages(thing.data, option);\n            let firstOptionImageIdx;\n            if (\n                option &&\n                saleImages.some((img, idx) => {\n                    if (img.option_id === option.id) {\n                        firstOptionImageIdx = idx;\n                        return true;\n                    }\n                })\n            ) {\n                // blank\n            } else {\n                if (slideContext.thumbnailIndex > saleImages.length - 1) {\n                    firstOptionImageIdx = 0;\n                }\n            }\n            if (firstOptionImageIdx) {\n                dispatch(setThumbnailIndex(firstOptionImageIdx));\n            }\n        }\n    };\n}\n\nfunction requestCurrencyConversion(nextCode: string, nextPrice: string, callback) {\n    const shouldConvert = !(nextCode == null || callback == null);\n    if (shouldConvert) {\n        if (window.numberType === 2) {\n            nextPrice = nextPrice.replace(/,/g, \".\").replace(/ /g, \"\");\n        }\n        if (_.isString(nextPrice)) {\n            nextPrice = nextPrice.replace(/,/g, \"\");\n        }\n        $.ajax({\n            url: \"/convert_currency.json\",\n            type: \"GET\",\n            dataType: \"json\",\n            data: {\n                amount: nextPrice,\n                currency_code: nextCode,\n            },\n        }).success(({ amount, currency } = {}) => {\n            if (amount == null) {\n                return;\n            }\n            callback(currency.code, formatPrice(amount, currency.code), currency.symbol);\n        });\n    }\n}\n\nfunction _convertCurrency(nextCode: string, nextPrice: string, force: boolean) {\n    return (dispatch: Dispatch, getState: () => State) => {\n        const { saleContext } = getState();\n        if (nextCode !== \"USD\") {\n            if (\n                force || // FIXME: unable to comparison since price update comes first (SaleitemSidebarHead.componentWillReceiveProps())\n                saleContext.price !== nextPrice || // currency price changed\n                saleContext.currencyCode !== nextCode || // currency code changed\n                saleContext.currencyMoney == null || // currency symbol/money is not set (changed from usd)\n                saleContext.currencySymbol == null\n            ) {\n                nextPrice = nextPrice || saleContext.price || \"0.00\";\n                requestCurrencyConversion(nextCode, nextPrice, (currencyCode, currencyMoney, currencySymbol) => {\n                    if (typeof currencyMoney === \"number\") {\n                        currencyMoney = currencyMoney.toFixed(2);\n                    }\n                    currencyMoney = currencyMoney.replace(/[ \\.]00$/, \"\");\n                    dispatch(\n                        updateSaleContext({\n                            currencyCode,\n                            currencyMoney,\n                            currencySymbol,\n                        })\n                    );\n                });\n            } else {\n                // NOOP\n            }\n        } else {\n            dispatch(\n                updateSaleContext({\n                    currencyCode: \"USD\",\n                    currencyMoney: null,\n                    currencySymbol: null,\n                })\n            );\n        }\n    };\n}\n\nexport function convertCurrency(nextCode, nextPrice, force = false) {\n    store.dispatch(_convertCurrency(nextCode, nextPrice, force));\n}\n","import C from './action-constants';\n\n\n// Action on requesting thing starts\nexport function requestThing(pendingID) {\n    return {\n        type: C.REQUEST_THING,\n        status: 'request',\n        pendingID\n    };\n}\n\n// Action on requesting thing fails\nexport function requestThingFail() {\n    return {\n        type: C.REQUEST_THING_FAILURE,\n        status: 'failed'\n    };\n}\n\n// action on loading request result\nexport function loadThing(ID, data) {\n    return {\n        type: C.LOAD_THING,\n        status: 'idle',\n        ID,\n        data\n    };\n}\n\n// Action on close overlay\nexport function openThing() {\n    return {\n        type: C.OPEN_THING\n    };\n}\n\n// Action on close overlay\nexport function closeThing() {\n    return {\n        type: C.CLOSE_THING,\n        ID: null,\n        pendingID: null,\n        thing: null\n    };\n}\n\n\nexport function setThumbnailIndex(thumbnailIndex) {\n    return {\n        type: C.SET_THUMBNAIL_INDEX,\n        thumbnailIndex,\n    };\n}\n\nexport function toggleFollow(followType) {\n    return {\n        type: C.TOGGLE_FOLLOW,\n        followType\n    };\n}\n\nexport function cancelFollow(followType) {\n    return {\n        type: C.CANCEL_FOLLOW,\n        followType\n    };\n}\n\nexport function completeFollow(followType) {\n    return {\n        type: C.COMPLETE_FOLLOW,\n        followType\n    };\n}\n\nexport function toggleFancy(thingID) {\n    return {\n        type: C.TOGGLE_FANCY,\n        thingID,\n    };\n}\n\nexport function cancelFancy(thingID) {\n    return {\n        type: C.CANCEL_FANCY,\n        thingID,\n    };\n}\n\nexport function completeFancy(thingID, fancyd_count) {\n    return {\n        type: C.COMPLETE_FANCY,\n        thingID,\n        fancyd_count\n    };\n}\n\nexport function updateAppContext(contextObject) {\n    return {\n        type: C.UPDATE_APP_CONTEXT,\n        context: contextObject\n    };\n}\n","// App state that does not usually change during app lifecycle. (i.e. Login state)\n\n// module-level login state object and setter\nconst state : { viewer: {}; loggedIn: Boolean; } = { viewer: {}, loggedIn: false };\nexport default state;\n\nexport function updateState(k, v) {\n    state[k] = v;\n}\n","import { index } from 'fancyutils';\n\n// Cache bucket\nexport class ThingCache {\n    things = {};\n    sales = {};\n    count = 0;\n    static SALES = 'sales';\n    static THINGS = 'things';\n\n    exists = (id, type, ignoreCralwed) => {\n        const cac = this.get(id, type);\n        var existence = cac != null && typeof cac === 'object';\n        if (ignoreCralwed) {\n            existence = existence && cac.isCrawled !== true;\n        }\n        return existence;\n    }\n\n    // resolver function\n    _get = (id) => {\n        return this[ThingCache.THINGS][id] || this[ThingCache.SALES][id] || null;\n    }\n\n    get = (id, type = ThingCache.THINGS) => {\n        const cac = this[type][id] || this.getCrawled(id, type);\n        return cac;\n    }\n\n    getCrawled = (id, type) => {\n        const cac = this[type][id];\n        if (cac && cac.isCrawled) {\n            return cac;\n        } else {\n            return null;\n        }\n    }\n\n    add = (id, data, type) => {\n        // to add, cache should not be exist or crawled one\n        const cac = this[type][id];\n        if (\n            cac == null || \n            cac.isCrawled === true\n        ) {\n            this[type][id] = data;\n            // Store thing information as well\n            if (type === ThingCache.SALES && data.id) {\n                this[ThingCache.THINGS][data.id] = data;\n            }\n            this.count += 1;\n        } else {\n            console.warn('cache.add(): Cache overwrite');\n        }\n    }\n\n    remove = (id, type) => {\n        if (this[type][id]) {\n            delete this[type][id];\n            this.count -= 1;\n        } else {\n            console.warn('cache.remove(): Non-existing cache removal');\n        }\n    }\n\n    // selector = 'a.b.c'\n    update = (id, type = ThingCache.THINGS, selector, value) => {\n        if (selector == null) {\n            console.warn('ThingCache#update(): selector is empty');\n            return;\n        }\n        const t = this.get(id, type);\n        if (t) {\n            index(t, selector, value);\n        }\n    }\n\n    // sweep() {\n    //     // TODO: should sweep cache if too many cache added by looking `cache.count`\n    // }\n}\n\nexport const cache = new ThingCache();\nwindow.__THING_CACHE = cache;\n","import { alertify, isEmpty } from \"fancyutils\";\nimport {\n    SaleObject,\n    SaleContext,\n    ThingObject,\n    FancyReduxState,\n    User,\n    ThingImage,\n    OverlayPropsV1,\n} from \"ftypes\";\nimport { SaleItem } from \"_static/modules/ThingDetail\";\n\nconst { gettext, _ } = window;\n\nexport function mapStateToThingProps(state: FancyReduxState): OverlayPropsV1 {\n    const {\n        appContext,\n        thing: { data, isFetching, status },\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    } = state;\n\n    return {\n        appContext,\n        status,\n        thing: data,\n        isFetching,\n        followContext,\n        fancyContext,\n        slideContext,\n        saleContext,\n    };\n}\n\nexport function getSales(type: string, thing: ThingObject) {\n    return thing.sales;\n}\n\nexport function getDescription(type: string, thing: ThingObject) {\n    if (type === \"sales\") {\n        return thing.sales.description;\n    } else if (type === \"hotel\") {\n        return thing.hotel_search.details.propertyDescription;\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSaleItemId(thing: ThingObject, viewer: User) {\n    if (viewer && viewer.is_admin_any) {\n        if (thing.sales) {\n            return thing.sales.id;\n        } else if (thing.inactive_sales) {\n            return thing.inactive_sales.id;\n        }\n    }\n}\n\n// Get sale item id via permission / sales availability\nexport function getSeller(thing: ThingObject) {\n    if (thing.sales) {\n        return thing.sales.seller;\n    } else if (thing.inactive_sales) {\n        return thing.inactive_sales.seller;\n    }\n}\n\nexport function getDetailType(thing: ThingObject) {\n    if (thing.hotel_search) {\n        return \"hotel\";\n    } else if (thing.sales_available && thing.type !== \"vanity_number\") {\n        return \"sales\";\n    } else if (!thing.sales_available && !thing.has_launch_app && thing.type !== \"giftcard\") {\n        return \"urlOnly\";\n    }\n}\n\nexport function isSalesOptionsAvailable<T extends SaleItem>(sales: T | null) {\n    return sales != null && !isEmpty(sales.options);\n}\n\nexport function getFirstSaleOption(sales: SaleItem, ignoreEmptySaleOption = false) {\n    if (isSalesOptionsAvailable(sales)) {\n        return sales.options[0];\n    } else if (ignoreEmptySaleOption === false) {\n        return sales || null;\n    }\n}\n\nexport function getCurrentSaleOption<T extends SaleItem>(sales: T, saleContext: SaleContext = {}, ignoreEmptySaleOption = false) {\n    const { saleOptionID } = saleContext;\n\n    if (isSalesOptionsAvailable<T>(sales)) {\n        if (saleOptionID) {\n            const opts = _(sales.options).filter((prop) => prop.id === saleOptionID);\n            if (opts[0] == null) {\n                console.warn(\"saleOption should not be null!\");\n            }\n\n            return opts[0] == null\n                ? {\n                      id: 0,\n                      discount_percentage: \"0.0\",\n                      quantity: 0,\n                      soldout: true,\n                      retail_price: 0,\n                      name: '',\n                  }\n                : opts[0];\n        } else {\n            return sales.options[0];\n        }\n    } else if (ignoreEmptySaleOption === false) {\n        return sales;\n    }\n}\n\nexport function formatPrice(amount: number, currency: string) {\n    if (currency == \"BTC\") return amount + \"\";\n    var newPrice = amount.toFixed(2) + \"\";\n    var regex = /(\\d)(\\d{3})([,\\.]|$)/;\n    while (regex.test(newPrice)) {\n        newPrice = newPrice.replace(regex, \"$1,$2$3\");\n    }\n    if (window.numberType === 2) {\n        newPrice = newPrice.replace(/,/g, \" \").replace(/\\./g, \",\");\n    }\n    return newPrice;\n}\n\n// sales: thing.sales\nexport function getDomesticDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    if (sales.expected_delivery_day_1) {\n        date += sales.expected_delivery_day_1;\n    }\n    if (sales.expected_delivery_day_2) {\n        date += \" - \" + sales.expected_delivery_day_2;\n    }\n    return date;\n}\n\n// sales: thing.sales\nexport function getIntlDeliveryDate(sales: SaleObject) {\n    var date = \"\";\n    // TODO: use moment for locale string\n    if (sales.expected_delivery_day_intl_1) {\n        date += sales.expected_delivery_day_intl_1;\n    }\n    if (sales.expected_delivery_day_intl_2) {\n        date += \" - \" + sales.expected_delivery_day_intl_2;\n    }\n    return date;\n}\n\nexport function currencyIsUSD({ saleContext }: { saleContext: SaleContext }) {\n    return saleContext.currencyCode === \"USD\";\n}\n\n// [sale option id]: { true | false }\nconst saleOptionWaitingRegistry = {};\nwindow.saleOptionWaitingRegistry = saleOptionWaitingRegistry;\nexport function setWaiting(chosenSaleOptionID, setResult) {\n    saleOptionWaitingRegistry[chosenSaleOptionID] = setResult;\n}\nexport function getWaiting<T extends SaleItem>(sales: T, saleContext) {\n    if (sales == null) {\n        return null;\n    }\n    if (saleContext.waiting != null) {\n        return saleContext.waiting;\n    }\n\n    // https://app.asana.com/0/86925821949642/160205241997173\n    // It could be a bit weird for future, but design-side decision\n    if (sales.waiting) {\n        return sales.waiting;\n    }\n\n    const chosenSaleOption = getCurrentSaleOption(sales, saleContext);\n    // options is SaleItem\n    if (sales.id === chosenSaleOption.id) {\n        return sales.waiting;\n        // option is SaleOption\n    } else {\n        if (saleOptionWaitingRegistry[chosenSaleOption.id] != null) {\n            return saleOptionWaitingRegistry[chosenSaleOption.id];\n        } else if (chosenSaleOption.waiting != null) {\n            return chosenSaleOption.waiting;\n        }\n    }\n}\n\nfunction fillArray(original: Array<unknown> /*sparse?ArrayToFill*/, filler: Array<unknown>) {\n    const ol = original.length;\n    const fl = filler.length;\n    const sparseIdxs = [];\n    // Find sparse indexes first.\n    for (let j = 0; j < ol; j++) {\n        if (!(j in original)) {\n            sparseIdxs.push(j);\n        }\n    }\n    for (let i = 0; i < fl; i++) {\n        // if sparse indexes are all in (or nonexist), push leftovers to tail\n        if (i > sparseIdxs.length - 1) {\n            original.push(filler[i]);\n        } else {\n            original[sparseIdxs[i]] = filler[i];\n        }\n    }\n    return original;\n}\n\nlet tid;\nlet optionId: undefined;\nlet hotelImages: ThingImage[] | undefined | [];\nlet salesImages;\nlet thingImages;\nexport function getSaleImages(thing: ThingObject, option, thumbnailsLimit?: number) {\n    if (thing.hotel_search != null) {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n\n            hotelImages = <ThingImage[]>thing.hotel_search.images.map((img) => ({\n                src: img.url,\n                thumbnail_src: img.thumbnailUrl,\n                width: img.width,\n                height: img.height,\n            }));\n            hotelImages.unshift(thing.image_resized_max);\n        }\n        return hotelImages;\n    } else if (thing.sales != null) {\n        const images = [];\n        fillArray(images, thing.images);\n        if (option && option.images && option.images.length > 0) {\n            fillArray(images, option.images);\n        }\n        salesImages = images;\n        if (option) {\n            optionId = option.id;\n        }\n        if (thing && thing.sales && thing.sales.video) {\n            images.unshift(thing.sales.video);\n        }\n        return salesImages;\n\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            // optionId = option ? option.id : null;\n            // FIXME: do this somewhere else\n            if (thing.image_resized_max == null) {\n                if (thing.image.src) {\n                    thing.image_resized_max = {\n                        src: thing.image.src,\n                        width: thing.image.width,\n                        height: thing.image.height,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                } else {\n                    thing.image_resized_max = {\n                        src: \"/_ui/images/common/blank.gif\",\n                        width: 1,\n                        height: 1,\n                        thumbType: \"thing\",\n                    }; // FIXME: to prevent null referencing\n                }\n            }\n\n            let images = [];\n\n            if (thing.image_resized_max) {\n                images.push(thing.image_resized_max);\n            }\n\n            if (thing.images && thing.images[0]) {\n                images.push(thing.images[0]);\n            }\n\n            // set sale images\n            if (thing && thing.sales && thing.sales.video) {\n                let video = { src: thing.sales.video.thumbnail_url, thumbType: \"video\" };\n                if (thing.sales.video.position > 0) {\n                    images[thing.sales.video.position] = video;\n                } else {\n                    // set video to first unless the position is set\n                    images.unshift(video);\n                }\n            }\n            if (thing.sales.images) {\n                fillArray(images, thing.sales.images);\n            }\n            salesImages = images;\n        }\n        if (option && optionId !== option.id) {\n            optionId = option.id;\n            if (salesImages == null) {\n                salesImages = [];\n            }\n            if (option.images && option.images.length > 0) {\n                const images = salesImages.filter((img) => img.option_id == null);\n                fillArray(images, option.images);\n                salesImages = images;\n            }\n        }\n\n        return _.isNumber(thumbnailsLimit) && thumbnailsLimit > 0\n            ? salesImages.filter((image, idx) => idx < thumbnailsLimit && image.src)\n            : salesImages;\n    } else {\n        if (tid !== thing.id) {\n            // Caching structure\n            if (thing.fromServer) {\n                tid = thing.id;\n            }\n            if (thing.image_resized_max) {\n                thingImages = [thing.image_resized_max];\n            } else if (thing.image) {\n                thingImages = [thing.image];\n            } else {\n                thingImages = [];\n                // || (option && optionId !== option.id)\n            }\n        }\n        return thingImages;\n    }\n}\n\nexport function isVanityQueriable(props: any, suppress: boolean) {\n    var { AC, minPrice, maxPrice, keyword } = props;\n\n    keyword = $.trim(keyword);\n    AC = $.trim(AC);\n    minPrice = minPrice != null ? minPrice : \"0\";\n    minPrice = $.trim(minPrice).replace(\",\", \"\").replace(\"$\", \"\");\n    maxPrice = $.trim(maxPrice).replace(\",\", \"\").replace(\"$\", \"\");\n\n    const original_labels = alertify.labels;\n    if (AC !== \"\") {\n        if (_.isNaN(parseInt(AC, 10)) || AC.length !== 3) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Invalid area code. Area code should be 3 digits.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (minPrice !== \"\") {\n        if (_.isNaN(parseInt(minPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check min price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n\n        if (parseInt(minPrice, 10) >= parseInt(maxPrice, 10)) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"The max price number should be bigger than min price number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (maxPrice !== \"\") {\n        if (_.isNaN(parseInt(maxPrice, 10))) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please check max price. It should be number.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    if (keyword !== \"\") {\n        if (keyword.length < 4) {\n            alertify.set({ labels: { ok: \"Close\" } });\n            !suppress && alertify.alert(\"Please enter 4 or more characters.\");\n            alertify.set({ labels: original_labels });\n            return false;\n        }\n    }\n\n    return true;\n}\n\nexport function getSafeNameProp({ emojified_name, name }: ThingObject) {\n    if (emojified_name) {\n        return { dangerouslySetInnerHTML: { __html: emojified_name } };\n    } else {\n        return { children: name };\n    }\n}\n\nexport function isVideoUploadable(thing: ThingObject): boolean {\n    if ((thing && thing.hotel_search) || thing.metadata) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nfunction salesAvailable(thing: ThingObject): boolean {\n    if (!isEmpty(thing.sales)) {\n        return thing.sales_available;\n    }\n    return false;\n}\n\nexport function getThingName(thing: ThingObject) {\n    if (thing.type === \"giftcard\") {\n        return gettext(\"Fancy Gift Card\");\n    } else if (salesAvailable(thing)) {\n        return thing.sales.name;\n    } else {\n        return thing.name;\n    }\n}\n","// SaleItem#get_status\nexport const salesStatus = {\n    EXPIRED: 'Expired',\n    REMOVED: 'Deleted',\n    PENDING: 'Pending',\n    COMING_SOON: 'Coming soon',\n    ACTIVE: 'Active',\n    SOLD_OUT: 'Sold out'\n};\n\nexport const FancyStatus = {\n    Addition: 'Addition',\n    Removal: 'Removal',\n    AfterAddition: 'AfterAddition',\n    AfterRemoval: 'AfterRemoval',\n    Idle: 'Idle',\n};\n\nexport const textareaHeight = {\n    collapsed: 20,\n    expanded: 40\n};\n\nconst commonWrapperSelector = '#container-wrapper .wrapper-content #content';\nexport const Selectors = {\n    HomepageWrapper: commonWrapperSelector,\n};\n\nconst zoomMargin = 125;\nexport const ThingViewConfig = {\n    boundarySize: 640,\n    zoomMargin,                  // zoom box size 250 (246 + 2 + 2) / 2\n    zoomBoxSize: zoomMargin * 2, // zoom box size 250 (246 + 2 + 2) / 2\n    zoomScale: 1.5,\n};\n\nexport const StaticThingViewConfig = {\n    ThumbnailsLimit: {\n        Basic: 18,\n        More: 200,\n    },\n}\n","import { KEYS, didClickOn, eitherFancy, getObjectTypeFromUrl, getPathname, isPlainLeftClick, isStream } from 'fancyutils';\n\nimport store from '../store/store';\nimport { Selectors } from '../config';\nimport { LinkTypes, transition, pagingContext } from './routeutils';\nimport { closeOverlay } from '../action/action-helpers';\n\n\nfunction handleOverlayThingKeyEvents(event) {\n    if (event.target.tagName === 'TEXTAREA' ||\n        event.target.tagName === 'INPUT') {\n        return;\n    }\n\n    switch (event.which) {\n    case KEYS.LEFT:\n        pagingContext.movePrev();\n        break;\n    case KEYS.RIGHT:\n        pagingContext.moveNext();\n        break;\n    case KEYS.ESC:\n        // If popup is not on\n        if ($('#popup_container:visible').length === 0) {\n            store.dispatch(closeOverlay());\n        }\n        break;\n    }\n}\n\nfunction conditionalTransition(aElement) {\n    // Turn off video\n    $('#container-wrapper .btn-pause').attr('scroll',true).click();\n    // Ensure anchor is static (sticked to homepage timeline) or not.\n    if (isStream() && $(Selectors.HomepageWrapper).has(aElement)) {\n        transition(aElement.getAttribute('href'), LinkTypes.Static);\n    } else {\n        transition(aElement.getAttribute('href'));\n    }\n}\n\nvar oneshotEventAttached = false;\nexport function attachEntryEvents() {\n    if (oneshotEventAttached) {\n        return;\n    }\n    oneshotEventAttached = true;\n    // Remove pre-existing url event and start transition first\n    $(document.body).off('click.overlayThingInit');\n    if (window.__INIT_THING_ANCHOR != null) {\n        conditionalTransition(window.__INIT_THING_ANCHOR);\n        delete window.__INIT_THING_ANCHOR;\n    }\n    // TODO: replace to class-based event binding\n    $(document.body)\n        .on('click', 'a', function(event) {\n            if (isPlainLeftClick(event) &&\n                this.getAttribute('data-prevent-overlay') == null &&\n                getObjectTypeFromUrl(getPathname(this)) === 'Thing'\n            ) {\n                event.preventDefault();\n                // note: key event will be detached inside `closeOverlay()` call\n                $(document).on('keydown.overlayThing', handleOverlayThingKeyEvents);\n                conditionalTransition(this);\n            }\n        });\n\n    $('#overlay-thing').on('click', '.popup.overlay-thing', function(event) {\n        const $targ = $(event.target);\n        // Center container\n        if (didClickOn($targ, '.sidebar') ||\n            didClickOn($targ, '.thing-detail-container .content') ||\n            didClickOn($targ, '.thing-detail-container .timeline') ||\n            eitherFancy('Admin', ({ sharedState }) => sharedState.draggingAdmin)) {\n            // pass\n        // prev button\n        } else if (didClickOn($targ, '.popup_prev')) {\n            pagingContext.movePrev();\n            return false;\n        // next button\n        } else if (didClickOn($targ, '.popup_next')) {\n            pagingContext.moveNext();\n            return false;\n        } else {\n            store.dispatch(closeOverlay());\n        }\n    });\n}\n\nexport const OtContainer = {\n    isStaticCache: undefined,\n    isStatic() {\n        if (this.isStaticCache === undefined) {\n            this.isStaticCache = $(document.body).is('.static-ot');\n        }\n        return this.isStaticCache;\n    },\n    getDynamic() {\n        return $('#overlay-thing .thing-detail');\n    },\n    getStatic() {\n        return $(document);\n    },\n    get() {\n        return this.isStatic() ? this.getStatic() : this.getDynamic();\n    },\n    scrollToTop() {\n        if (this.isStatic()) {\n            $(document.body.parentElement).scrollTop(0);\n        } else {\n            $('#overlay-thing').scrollTop(0);\n        }\n    },\n}\nwindow.OtContainer = OtContainer;\n\n// Only one event is allowed\nexport const scrollEvent = {\n    handleScroll: null,\n    attach(func, prepare) {\n        if (scrollEvent.handleScroll != null) {\n            scrollEvent.detach();\n        }\n        const _prepare = prepare != null ? prepare : 10;\n        \n        const handleScroll = _.throttle(function() {\n            if (OtContainer.isStatic()) {\n                const viewportHeight = document.documentElement.clientHeight;\n                if (scrollEvent.visible === true) {\n                    // console.debug('$(window).height() - $(window).scrollTop() - _prepare <= viewportHeight', $(window).height(), $(window).scrollTop(), _prepare, viewportHeight, $(window).height() - $(window).scrollTop() - _prepare <= viewportHeight)\n                    if (document.documentElement.scrollHeight - $(window).scrollTop() - _prepare <= viewportHeight) {\n                        func(true);\n                    }\n                }\n            } else {\n                const el = this;\n                const viewportHeight = el.clientHeight;\n                if (scrollEvent.visible === true) {\n                    if (el.scrollHeight - el.scrollTop - _prepare <= viewportHeight) {\n                        func(true);\n                    }\n                }\n            }\n        }, 50);\n        this.handleScroll = handleScroll;\n\n        const containerEl = OtContainer.isStatic() ? OtContainer.get().get(0) : $('#overlay-thing').get(0);\n        containerEl.addEventListener('scroll', handleScroll, { passive: true });\n        handleScroll();\n    },\n\n    detach() {\n        const containerEl = OtContainer.get().get(0);\n        containerEl.removeEventListener('scroll', this.handleScroll);\n    },\n    visible: false // copied variable on `state.appContext.visible` change\n};\n","import { extractMetaFromURL } from 'fancyutils';\nimport { history } from 'common-components';\n\nimport store from '../store/store';\nimport { closeOverlay, fetchThing } from '../action/action-helpers';\n\n\nconst initialThingPageID = extractMetaFromURL(location.pathname).id;\nconst initialPageIsThingPage = initialThingPageID != null;\n\n// This stores initial static page history info that needs to be restored when modal get closed.\nexport const historyData = {\n    initialPath: location.pathname,\n    /* mut */preservedHref: location.href, // Preserved Href just before open, and to be returned when closed.\n    initialThingPageID,\n    initialPageIsThingPage,\n    initialTitle: document.title,\n    // This prop indicates current location is (static) thing page. Mutable.\n    locationIsThingPage: initialPageIsThingPage,\n    overlayIsOn: false,\n};\n\n/*\nfunction isInitialPath() {\n    return historyData.initialPath === location.pathname;\n}\n*/\nfunction runOverlay(thingID, thingURLType, killCache = false, queryString) {\n    // Context needs to be isolated from hook: https://github.com/rackt/redux-router/issues/157\n    if (!$(document.body).hasClass('error-page')) {\n        requestIdleCallback(() => {\n            $(document.body).addClass('thing-overlay-on');\n            store.dispatch(fetchThing(thingID, thingURLType, killCache, false, queryString));\n            historyData.overlayIsOn = true;\n            //EE.emit('overlay-on');\n        });\n    }\n}\n\nfunction stopOverlay() {\n    historyData.overlayIsOn = false;\n    store.dispatch(closeOverlay());\n}\n\nexport function reloadCurrentThing() {\n    const meta = extractMetaFromURL(location.href);\n    const thingID = meta && meta.id;\n    if (thingID != null && historyData.overlayIsOn) {\n        runOverlay(thingID, meta.type, true);\n    }\n}\n\nexport function historyHook({ pathname, search /*, action*/ }) {\n    const meta = extractMetaFromURL(pathname);\n    const thingID = meta && meta.id;\n    // When initially (statically) renderred page is thing page\n    // Moving to new thing page\n    historyData.locationIsThingPage = thingID != null;\n    if (historyData.locationIsThingPage) {\n        runOverlay(thingID, meta.type, false, search);\n    } else if (historyData.overlayIsOn) {\n        stopOverlay();\n    }\n}\n\nhistory.listen(historyHook)\n","import { extractMetaFromURL, getObjectTypeFromUrl, isStaticPage, stripPathname } from \"fancyutils\";\n\nimport { historyData } from \"./history\";\nimport { history } from 'common-components';\nexport const LinkTypes = {\n    Dynamic: 0,\n    Static: 1,\n    Timeline: 2,\n    Internal: 3 // no update needed\n};\n\n// `staticLink`: transition from statically attached links\nexport function transition(href, linkType = LinkTypes.Dynamic) {\n    // ID-only\n    if (!_.isNaN(Number(href))) {\n        href = `/things/${href}`;\n    }\n\n    if (getObjectTypeFromUrl(href) === \"Thing\") {\n        const meta = extractMetaFromURL(href);\n        // Update URL to go back when overlay is closed\n        if (!historyData.overlayIsOn) {\n            historyData.preservedHref = location.href;\n        }\n        history.push(stripPathname(meta.href), null);\n    } else {\n        redirect(href);\n    }\n}\n\nexport function closeModal() {\n    if (isStaticPage()) {\n        return;\n    }\n    $(document.body).removeClass(\"thing-overlay-on\"); // FIXME: isolate modal logic\n}\n\n// NOOP\nexport const pagingContext = {\n    init() {},\n    movePrev() {},\n    moveNext() {}\n}\n\nexport function redirect(destination) {\n    if (destination == null) {\n        return false;\n    } else {\n        location.href = destination;\n        return true;\n    }\n}\n\nfunction getUtm() {\n    const $nav = $('.navigation')\n    if ($nav.length > 0) {\n        if ($nav.find('a.current[data-feed=\"featured\"]').length > 0) {\n            return \"timeline_featured\";\n        } else if ($nav.find('a.current[data-feed=\"recommended\"]').length > 0) {\n            return \"timeline_recommended\";\n        } else {\n            const $shopLink = $nav.find('.shop li a');\n            if ($shopLink.eq(0).is('.current')) {\n                return \"shop\";\n            } else if ($shopLink.eq(1).is('.current')) {\n                return \"\";\n            } else if ($shopLink.eq(2).is('.current')) {\n                return \"popular\";\n            } else if ($shopLink.eq(3).is('.current')) {\n                return \"newest\";\n            } else if ($shopLink.eq(4).is('.current')) {\n                return \"editors_picks\";\n            } else if ($shopLink.eq(5).is('.current')) {\n                return \"sales\";\n            }\n        }\n    } else {\n        if ($('.wrapper-content.profile-section').length > 0) {\n            return \"userprofile\";\n        } else if ($('.wrapper-content.merchant').length > 0) {\n            return \"seller_shop\";\n        }\n    }\n}\n\nexport function getUtmString() {\n    const utm = getUtm()\n    if (utm) {\n        return `?utm=${utm}`\n    } else {\n        return ''\n    }\n}\n","import { OverlayProps, ReduxProps } from 'ftypes';\nimport React from 'react';\n\nexport function getFancyContextDefaultValue() {\n  return {\n      appContext: {},\n      thing: {},\n      followContext: {},\n      fancyContext: {},\n      slideContext: {},\n      saleContext: {},\n      dispatch: () => {},\n  }\n}\n\n// @ts-ignore\nconst FancyContext = React.createContext<OverlayProps & ReduxProps>(getFancyContextDefaultValue());\n\nexport const useFancy = () : OverlayProps & ReduxProps => {\n  return React.useContext(FancyContext);\n}\n\nexport default FancyContext;\n","import React from 'react';\nimport { Display } from \"fancymixin\";\nimport classnames from 'classnames';\nimport { xmlUtil } from \"fancyutils\";\n\nexport default class AdminPopup extends React.Component {\n    static popupName = 'thing-admin';\n    state = {\n        show_on_homepage: null,\n        date_published: null, \n        exclude_from_popular: false,\n        show_in_search: true,\n        optionSaving: false,\n        ownerSaving: false,\n        mergeSaving: false,\n    };\n    \n    \n    componentDidMount() {\n        const that = this;\n        $.dialog(AdminPopup.popupName).$obj.on('open', () => {\n            const { thing: { show_on_homepage, date_published, exclude_from_popular, show_in_search }  } = that.props;\n            that.setState( { show_on_homepage, date_published, exclude_from_popular, show_in_search } );\n        });\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AdminPopup.popupName).center();\n    }\n    \n    handleSaveOptions = () => {\n        const { thing } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving } = this.state;\n        if (optionSaving) return false;\n        const payload = { thing_id: thing.id, show_on_homepage, exclude_from_popular, show_in_search }\n        if (show_on_homepage) {\n            let inputDate = new Date(date_published);\n            if (isNaN(inputDate)) {\n                alert(\"invalid date - must be in format of 2020-01-01 10:10:10\");\n                return false;\n            }            \n            payload['date_published'] = inputDate.toISOString().replace(/T/, \" \").split(\".\")[0];\n        }\n        this.setState({optionSaving:true});\n        $.post('/manage-newthing.json', payload).then((json) => {\n            if (json.status_code == 1) {\n                Object.assign(thing, payload);\n                alert(\"Updated!\");\n            } else {\n                alert(json.message || \"Failed to save the changes\");\n            }\n            this.setState({optionSaving:false})\n        }).fail(() => {\n            alert(\"Something went wrong!\");\n            this.setState({optionSaving:false})\n        });\n    }\n\n    handleChangeOwner = () => {\n        const { thing } = this.props;\n        if (this.state.ownerSaving) return false;\n        if (this.changeOwnerEl == null) return false;\n        const new_owner = this.changeOwnerEl.value.trim();\n        if (new_owner.length == 0) {\n            alert(\"Please enter a username.\");\n            return false;\n        }\n        if (new_owner.toLowerCase() == thing.thing_owner.username.toLowerCase()) {\n            alert(\"The thing is already owned by the user.\");\n            return false;\n        }\n\n        if (window.confirm(`Do you want to change the current thing's owner to ${new_owner}?`)) {\n            this.setState({ownerSaving: true})\n            $.ajax({\n                type: \"post\",\n                url: \"/change_new_thing_owner.xml\",\n                data: { new_owner_name: new_owner, thing_id: thing.id, new_thing_id: thing.ntid, old_user_id: thing.thing_owner.id },\n                dataType: \"xml\"\n            })\n                .done(xml => {\n                    if (xmlUtil.isSuccess(xml)) {\n                        alert(\"Done!\");\n                        location.reload();                        \n                    } else if (xmlUtil.isFail(xml)) {\n                        alert(\n                            $(xml)\n                                .find(\"message\")\n                                .text()\n                        );\n                    }\n                })\n                .fail(() => {\n                    alert(\"There was an error.\");\n                })\n                .always(() => {\n                    this.setState({ownerSaving: false})\n                });\n        }\n        return false;\n    }\n\n    handleMergeThings = () => {\n\n    }\n\n    render() {\n        const { \n            thing, \n            thing: { sales },\n        } = this.props;\n        const { show_on_homepage, date_published, exclude_from_popular, show_in_search, optionSaving, ownerSaving, mergeSaving } = this.state;\n        return (\n          <>\n          \t<p className=\"ltit\">{thing.name}</p>\n            <div className=\"thing-admin-body\">\n                <ul className=\"thing-info\">\n                <li><em>Sale ID</em> {sales.id}</li>\n                    <li><em>Thing ID</em> {thing.id}</li>\n                    <li><em>Thing Owner</em> {thing.thing_owner.username}</li>\n                    <li className=\"buttons\">\n                        <a className=\"btns-blue-embo\" href={`/merchant/products/${sales.id}`} target=\"_blank\">Edit Sale</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-sale-orders-by-thing-id?thing_id=${thing.id}`} target=\"_blank\">View Orders</a>\n                        <a className=\"btns-gray-embo\" href={`/admin/view-users-by-cart-item?sale_id=${sales.id}`} target=\"_blank\">View Carts</a>\n                    </li>\n                </ul>\n                <div className=\"thing-options\">\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-on-homepage\" checked={!!show_on_homepage}\n                        onChange={(event) => this.setState({ show_on_homepage: event.target.checked })}\n                        /> Show on Homepage</label>\n                        <input className=\"text\" type=\"text\" name=\"date-published\" placeholder=\"2020-01-02 10:20:30\"\n                            style={Display.NoneIf(!show_on_homepage)} value={date_published || ''}\n                            onChange={(event) => {this.setState({ date_published: event.target.value })}}\n                            />\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"exclude-from-popular\" checked={!!exclude_from_popular}\n                            onChange={(event) => this.setState({ exclude_from_popular: event.target.checked })}\n                        /> Exclude from Popular</label>\n                    </p>\n                    <p>\n                        <label><input type=\"checkbox\" name=\"show-in-search\" checked={!!show_in_search}\n                            onChange={(event) => this.setState({ show_in_search: event.target.checked })}\n                        /> Show in Search</label>\n                    </p>\n                    <p>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": optionSaving })} onClick={this.handleSaveOptions}>Save Changes</button>\n                    </p>                    \n                </div>\n                <div className=\"thing-actions\">\n                    <p>\n                        <label>Change Owner</label>\n                        <input type=\"text\" name=\"change_owner\" placeholder=\"Enter new username\" ref={(el) => {this.changeOwnerEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": ownerSaving })} onClick={this.handleChangeOwner}>Change</button>\n                    </p>\n                    {/*\n                    <p>\n                        <label>Merge Things</label>\n                        <input type=\"text\" name=\"merge_thing_id\" placeholder=\"Enter Thing ID\" ref={(el) => {this.mergeThingEl = el; }}/>\n                        <button className={classnames(\"btns-blue-embo\", { \"loading\": mergeSaving })} onClick={this.handleMergeThings}>Merge</button>\n                    </p>*/}\n                </div>\n\n            </div>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React from 'react';\nimport classnames from 'classnames';\nimport { closePopup, copyToClipboard } from 'fancyutils';\n\nexport default class SimpleSharePopup extends React.Component {\n    static popupName = 'minimum-share';\n\n    constructor(props) {\n        super(props);\n        const { thing, viewer } = props;\n        let url = `https://fancy.com${thing.url}`;\n        if (viewer && viewer.username) {\n            let connector = ~url.indexOf('?') ? '&' : '?';\n            url = `${url}${connector}ref=${viewer.username}`\n        }\n        console.log(url)\n        this.state = {\n            shareUrl: url,\n            urlCopied: false,\n        }\n    }\n\n    handleCancelClick = (event) => {\n        event.preventDefault();\n        closePopup(SimpleSharePopup.popupName);\n    }\n\n    componentDidUpdate(){\n        $.dialog(SimpleSharePopup.popupName).center();\n    }\n\n    handleCopyLink = (event) => {\n        console.log('handleCopyLink');\n        const { shareUrl } = this.state;\n        console.log('handleCopyLink ' + shareUrl );\n        copyToClipboard(shareUrl);\n        this.setState({ urlCopied: true });\n        setTimeout(() => {\n            this.setState({ urlCopied: false });\n        }, 2000);\n    }\n\n\n    render() {\n        const { thing, viewer } = this.props;\n        const { shareUrl, urlCopied } = this.state;\n\n        return (\n          <>\n          \t<p className=\"ltit\">Share</p>\n            <ul>\n                <li><a href=\"#\" className=\"btn-copy-link link\" onClick={this.handleCopyLink}>{urlCopied ? \"Copied to clipboard\" : \"Copy link\"}</a></li>\n                <li><a \n                    href={`http://pinterest.com/pin/create/link/?url=${encodeURIComponent(shareUrl)}&media=${thing.images ? encodeURIComponent(thing.images[0].image_url) : \"\"}&description=${encodeURIComponent(thing.name)}`}\n                    target=\"_blank\" className=\"pin\">Share to Pinterest</a></li>\n                <li><a \n                    href={`mailto:?body=Check%20out%20${encodeURIComponent(thing.name)}%20on%20Fancy!%0A%0A${encodeURIComponent(shareUrl)}&subject=${encodeURIComponent(thing.name)}%20on%20Fancy`}\n                    target=\"_blank\" className=\"email\">Share via email</a></li>\n            </ul>\n            <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n          </>\n        );\n    }\n}","import React, { Component } from 'react';\nimport classnames from 'classnames';\n\nimport { closePopup, KEYS, MP, isEmpty, alertify } from 'fancyutils';\nimport { Display } from 'fancymixin';\n\nexport default class AddlistPopup extends Component {\n    static popupName = 'add-list';\n    state = {\n        lists: [],\n        listSearchQuery: '',\n        listCreationQuery: '',\n        listCreating: false,\n    };\n\n    handleDialogOpen = () => {\n        this.setState({ lists: [], listSearchQuery: '', listCreationQuery: '' });\n        this.drawUserList()\n        setTimeout(() => {\n            this.listSearchInput.focus();\n        }, 0);\n\n    }\n    componentDidMount() {\n        $.dialog(AddlistPopup.popupName).$obj.on('open', this.handleDialogOpen);\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        $.dialog(AddlistPopup.popupName).center();\n    }\n\n    drawUserList() {\n        const objectId = this.props.objectId;\n        getListCheckbox({\n            objectId,\n            callback: res => { this.setState(res) }\n        });\n    }\n\n    handleListSearch = (event) => {\n        const listSearchQuery = event.target.value;\n        this.setState({ listSearchQuery });\n    }\n\n    handleListCreation = (event) => {\n        event.preventDefault();\n        if (this.state.listCreating) return;\n        if (event.type === 'keyup' &&\n            event.which !== KEYS.ENTER) {\n            return;\n        }\n        const listCreationQuery = $.trim(this.state.listCreationQuery);\n        const { objectId } = this.props;\n        if (isEmpty(listCreationQuery)) {\n            return;\n        }\n        this.setState({ listCreating: true })\n        // save new list\n        updateList({\n            objectId,\n            createList: listCreationQuery,\n            callback: (success, updated) => {\n                if (success) {\n                    const { lists } = this.state;\n                    MP('Create New List', { 'thing id': objectId, 'list name': listCreationQuery, 'via': 'thing detail' });\n                    this.setState( {\n                        listCreationQuery: '', listCreating: false,\n                        lists: [ ...updated, ...lists ],\n                    });\n                }\n            }\n        })\n    }\n\n    handleListItemToggle = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const targ = event.currentTarget;\n        const { objectId } = this.props;\n        const { lists } = this.state;\n        const selectedListId = Number(targ.getAttribute('data-listid'));\n        const theList = lists.filter(list => list.id === selectedListId)[0];\n        const prevAdded = theList.added;\n        theList.added = !theList.added;\n        const eventName = theList.added ? \"Add to List\" : \"Remove from List\";\n        this.setState({ lists })\n\n        const callback = (success, updated) => {\n            const { lists } = this.state;\n            if (success) {\n            } else {\n                const theList = lists.filter(list => list.id === selectedListId)[0];\n                theList.added = prevAdded;\n            }\n            this.setState({ lists })\n            MP(eventName, { 'thing id': objectId, 'list name': theList.name, 'list id': theList.id, 'via': 'thing detail' });\n        };\n\n        const update = { objectId, callback };\n\n        if (theList.added) update['checked'] = [theList.id];\n        else update['unchecked'] = [theList.id];\n        updateList(update)\n    }\n\n    handleCreateListQueryChange = (event) => {\n        this.setState({ listCreationQuery: event.target.value });\n    }\n\n    render() {\n        var { objectId } = this.props;\n        var {\n            lists,\n            listSearchQuery,\n            listCreationQuery,\n            listCreating,\n        } = this.state;\n\n        return (\n            <>\n                <p className=\"ltit\">Add to collections</p>\n                <fieldset className=\"search\">\n                    <input type=\"text\" placeholder=\"Search\" className=\"text\" \n                        value={listSearchQuery} ref={(element) => {this.listSearchInput = element;}}\n                        onChange={this.handleListSearch} />\n                </fieldset>\n                <div className=\"list\">\n                    <ul ref={(el) => {this.lists = el;}}>\n                    {lists && lists.map((list, idx) => {\n                        const term = $.trim(listSearchQuery).toLowerCase();\n                        var style;\n                        if (_.isString(term) && term.length > 0) {\n                            style = Display.NoneIf(\n                                list.name.toLowerCase().indexOf(term.toLowerCase()) === -1\n                            );\n                        }\n                        const ident = `${objectId}-${list.id}`;\n                        return (\n                            <li key={idx} style={style} className={classnames({ \"added\": list.added })}>\n                                <label>{list.name}</label>\n                                <button\n                                    data-listid={list.id} \n                                    onClick={this.handleListItemToggle}\n                                    className=\"btns-blue-embo\">{list.added ? \"Remove\" : \"Add\"}</button>\n                            </li>\n                        )\n                    })}\n                    </ul>\n                </div>\n                <fieldset className=\"create\">\n                    <input \n                        type=\"text\" placeholder=\"Create new collection\" \n                        ref={(element) => {this.quickCreateList = element;}}\n                        onKeyUp={this.handleListCreation}\n                        onChange={this.handleCreateListQueryChange}\n                        value={listCreationQuery}/>\n                    <button className={classnames(\"btn-create\", { \"loading\": listCreating })} style={Display.NoneIf($.trim(listCreationQuery).length == 0)}\n                        onClick={this.handleListCreation}>{gettext(\"Create\")}</button>\n                </fieldset>\n                <button className=\"ly-close\" title=\"Close\"><i className=\"ic-del-black\"></i></button>\n            </>\n        );\n    }\n}\n\nfunction getListCheckbox({ objectId, callback }) {\n    $.get('/get_list_checkbox.json', { tid: objectId }).done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            closePopup(AddlistPopup.popupName);\n        }\n        callback && callback({ lists: resp.lists })\n    },)\n    .error(err => { \n        alertify.alert(\"Please try again later.\");\n        console.warn(err); \n        closePopup(AddlistPopup.popupName);\n    });\n}\n\nfunction updateList({ objectId, checked, unchecked, createList, callback }) {\n    const payload = { tid: objectId };\n    if (checked) payload['add_list_ids'] = checked.join(',');\n    if (unchecked) payload['remove_list_ids'] = unchecked.join(',');\n    if (createList) payload['new_list'] = createList;\n\n    $.post('/update_list_checkbox.json', payload)\n    .done(resp => {\n        if (resp.status_code == 0) {\n            alertify.alert(resp.message || \"Please try again later.\");\n            callback(false, null);\n        } else {\n            callback(true, resp.lists);\n        }\n    })\n    .error(err => { \n        console.warn(err); \n        alertify.alert(\"Please try again later.\");\n        callback(false, []);\n    })\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { FancyUser, MP, renderPopup } from \"fancyutils\";\nimport { useDispatch } from 'react-redux'\nimport { FancydByPopupV4 } from 'common-components';\n\nimport { useFancy } from \"../FancyContext\";\nimport AdminPopup from \"../../popup/AdminPopup\"\nimport SimpleSharePopup from \"../../popup/SimpleSharePopup\"\nimport AddlistPopup from \"../../popup/AddlistPopup\"\nimport { toggleFancy, getCordialProperties } from \"../../../action/action-helpers\";\n\nfunction Favorite() {\n    const { appContext, thing, fancyContext } = useFancy();\n    const dispatch = useDispatch();\n\n    const handleClick = (event: React.MouseEvent) => {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log('favortie');\n        if (!appContext.loggedIn) {\n            window.require_login(null, \"fancy_thing\", thing.id);\n            return;\n        }\n\n        if (fancyContext.loading) {\n            return;\n        }\n\n        dispatch(toggleFancy(thing.id));\n\n        if (!fancyContext.fancyd) {\n            MP(\"Fancy\", { thing_id: thing.id });\n            try {\n                window.crdl('event', 'favorite_item', getCordialProperties(thing));\n            } catch (e) {\n            }\n        } else {\n            MP(\"Unfancy\", { thing_id: thing.id });\n        }\n    };\n\n    return (\n        <a className={classnames(\"button button-static fancy _count\", { fancyd: fancyContext.fancyd })} onClick={handleClick}>\n            Favorite\n        </a>\n    );\n}\n\nexport default function ActionButtons() {\n    const {\n        appContext: { viewer, loggedIn },\n        thing,\n        thing: { id: objectId },\n        fancyContext,\n    } = useFancy();\n\n    let msg;\n    if (thing.fancyd_friends) {\n        const cnt = fancyContext.fancyd_count - 1;\n        if (cnt > 0) {\n            msg = <>\n                Favorited by <a href={thing.fancyd_friends[0].url}>{thing.fancyd_friends[0].full_name}</a> and <b>{cnt} other{(cnt > 1) ? `s` : ``}</b>\n            </>\n        } else {\n            msg = <>Favorited by <a href={thing.fancyd_friends[0].url}>{thing.fancyd_friends[0].full_name}</a></>\n        }\n    } else {\n        msg = <>{fancyContext.fancyd_count} people favorited</>\n    }\n\n    return (\n        <>\n            <span className=\"_fancyd fancyd_user\" onClick={(e : React.MouseEvent<HTMLSpanElement>) => {\n                if (e.target.tagName === 'A') {\n                    return;\n                }\n                renderPopup(FancydByPopupV4, { objectId, objectType: 'thing', loggedIn: FancyUser.loggedIn, viewerId: FancyUser.id });\n            }}>{msg}</span>\n            <a onClick={(event) => {\n                event.preventDefault();\n                if (!loggedIn) {\n                    window.require_login();\n                    return;\n                }\n                renderPopup(AddlistPopup, { objectId });\n            }} className=\"add-list\">Add to List</a>\n            <div className=\"figure-button action-button-v2\">\n                {viewer.is_admin_any && (\n                    <a className=\"edit\"\n                        onClick={(event) => {\n                            event.preventDefault();\n                            renderPopup(AdminPopup, { viewer, thing });\n                        }}>Edit</a>\n                )}\n                <Favorite />\n                <a\n                    className=\"btn-share\"\n                    onClick={(event) => {\n                        event.preventDefault();\n                        renderPopup(SimpleSharePopup, { viewer, thing });\n                    }}>\n                    Share\n                </a>\n            </div>\n        </>\n    );\n}\n","import { minmax } from \"fancyutils\";\nimport { Display } from \"fancymixin\";\nimport { ThingImageOrVideo } from \"ftypes\";\n\n// TODO: cache per (thing id + image index)\nconst zoomBoxMaximumSize = 240;\nconst zoomScale = 1.5;\n\nconst getBoundarySize = () => {\n    const $el = $(\n        \".thing-detail-container .figure-section .swiper-container.gallery-top .active-slide\"\n    ).eq(0);\n\n    if ($el.length !== 1) {\n        window.DEBUG && console.warn('getBoundarySize(): warning: $el.length is ', $el.length);\n    }\n\n    return {\n        $el,\n        width: $el.width()!,\n        height: $el.height()!,\n    };\n};\ntype BS = ReturnType<typeof getBoundarySize>;\n\nconst getZoomBoxSize = (bs: BS) => Math.min(bs.width / 3, zoomBoxMaximumSize);\nconst getZoomMargin = (bs: BS) => (getZoomBoxSize(bs) - 4) / 2;\n\nconst zidCac: { [o: string]: any } = {};\nconst getZoomImageDimension = (img: ThingImageOrVideo, bs = getBoundarySize()) => {\n    if (zidCac[img.image_url]) {\n        return zidCac[img.image_url];\n    }\n    const zoomMargin = getZoomMargin(bs);\n    // const imageSize = calculateImageSize(img);\n\n    const ret = {\n        width: bs.width * zoomScale /* * (imageSize.larger === \"height\" ? imageSize.proportion : 1) */ + zoomMargin,\n        height: bs.height * zoomScale + zoomMargin,\n        /* ((b.height * imageSize.height) / imageSize.width) *\n                (imageSize.larger === \"width\" ? imageSize.proportion : 1) *\n                zoomScale +\n            zoomMargin ,*/\n    };\n    zidCac[img.image_url] = ret;\n    return ret;\n};\n\nconst getImageMeta = (bs: BS) => {\n    let width, height, marginHoriz, marginVert;\n\n    const $fig = $(\".thing-detail-container .figure-section .swiper-container.gallery-top img:eq(0)\");\n    width = $fig.width()!;\n    height = $fig.height()!;\n    marginHoriz = 0;\n    if (width > height) {\n        marginHoriz = 0;\n        marginVert = (bs.height - height) / 2;\n    } else {\n        marginHoriz = (bs.width - width) / 2;\n        marginVert = 0;\n    }\n    return { width, height, marginHoriz, marginVert };\n};\n\nexport const getNextZoomImageStyle = (img: ThingImageOrVideo, pageX: number, pageY: number) => {\n    const bs = getBoundarySize();\n    const $wrapper = bs.$el;\n\n    if (!$wrapper.length) {\n        return Display.None;\n    }\n\n    const boundaryWidth = bs.width;\n    const boundaryHeight = bs.height;\n    const meta = getImageMeta(bs);\n\n    const offset = $wrapper.offset()!;\n    const left = pageX - offset.left;\n    const top = pageY - offset.top;\n\n    const topPosition = top - (boundaryHeight - meta.height) / 2;\n\n    const showZoomImage = left > 0 && topPosition > 0 && topPosition < meta.height;\n\n    const zoomBoxSize = getZoomBoxSize(bs);\n    const zoomMargin = getZoomMargin(bs);\n\n    if (showZoomImage) {\n        const zd = getZoomImageDimension(img, bs);\n        const zoomImageContainerX = minmax(\n            left - zoomMargin,\n            meta.marginHoriz,\n            meta.marginHoriz + meta.width - zoomBoxSize\n        );\n        const zoomImageContainerY = minmax(\n            top - zoomMargin,\n            meta.marginVert,\n            meta.marginVert + meta.height - zoomBoxSize\n        );\n\n        const backgroundLeft = (zd.width * left) / boundaryWidth - zoomMargin;\n        const backgroundTop = (zd.height * top) / boundaryHeight - zoomMargin;\n\n        const bgPosX = -minmax(backgroundLeft, 0, zd.width - zoomBoxSize);\n        const bgPosY = -minmax(backgroundTop, 0, zd.height - zoomBoxSize);\n\n        return {\n            left: 0,\n            top: 0,\n            width: `${zoomBoxSize}px`,\n            height: `${zoomBoxSize}px`,\n            transform: `translate(${zoomImageContainerX}px, ${zoomImageContainerY}px)`,\n            backgroundPosition: `${bgPosX}px ${bgPosY}px`,\n            display: \"inline\",\n        };\n    } else {\n        return Display.None;\n    }\n};\n\nconst RESIZED_SIZE = 1280;\nconst calculateImageSize = (img: ThingImageOrVideo) => {\n    const size = Math.max(img.width, img.height);\n    if (size < RESIZED_SIZE) {\n        const smallerSize = Math.min(img.width, img.height);\n        return {\n            width: img.width,\n            height: img.height,\n            proportion: size / smallerSize,\n            larger: img.width > img.height ? \"width\" : \"height\",\n        };\n    } else {\n        if (img.width > img.height) {\n            const proportion = RESIZED_SIZE / img.width;\n            return {\n                width: RESIZED_SIZE,\n                height: img.height / proportion,\n                proportion,\n                larger: \"width\",\n            };\n        } else {\n            const proportion = RESIZED_SIZE / img.height;\n            return {\n                width: img.width / proportion,\n                height: RESIZED_SIZE,\n                proportion,\n                larger: \"height\",\n            };\n        }\n    }\n};\n\nexport const isZoomable = (img: ThingImageOrVideo) => {\n    const imageSize = calculateImageSize(img);\n    const boundarySize = getBoundarySize();\n\n    return imageSize.width > boundarySize.width * zoomScale || imageSize.height > boundarySize.height * zoomScale;\n};\n\nexport const getZoomImageStyle = (img: ThingImageOrVideo, isZoomActive: boolean, currentZoomImageStyle: any) => {\n    if (isZoomActive) {\n        const zd = getZoomImageDimension(img);\n        const ret = {\n            ...currentZoomImageStyle,\n            backgroundSize: `${zd.width}px ${zd.height}px`,\n        };\n        return ret;\n    } else {\n        return Display.None;\n    }\n};\n","import React, { memo, useEffect, useState, useRef } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\nimport SwiperCore, { Thumbs, Zoom } from \"swiper\";\nimport { Video } from \"common-components\";\nimport { Display } from \"fancymixin\";\n\nimport { useFancy } from \"../../FancyContext\";\nimport ActionButtons from \"../ActionButtons\";\nimport { getCurrentSaleOption, getSaleImages } from \"../../../map\";\nimport { setThumbnailIndex } from \"../../../../action/actions\";\nimport { getZoomImageStyle, getNextZoomImageStyle } from \"./zoom\";\n\nimport type { ThingImageOrVideo } from \"ftypes\";\nimport type { Swiper as SwiperClass } from \"swiper\";\n\nconst isTouchDevice = \"ontouchstart\" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;\nconst SwiperAddons = [Thumbs];\nif (isTouchDevice) {\n    SwiperAddons.push(Zoom);\n}\nSwiperCore.use(SwiperAddons);\n\nconst placeholderImage = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\nconst HEIGHT = 480;\nconst PER_PAGE = 5;\n\nconst preloadImage = (src: string) =>\n    new Promise((r) => {\n        const image = new window.Image();\n        image.onload = r;\n        image.onerror = r;\n        image.src = src;\n    });\n\ninterface ImageSlideProps {\n    image: ThingImageOrVideo;\n    i: number;\n    isActive: boolean;\n    setSlideLocked: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nconst ImageSlide = memo<ImageSlideProps>(\n    ({ image, i, setSlideLocked, isActive }) => {\n        const {\n            thing,\n            slideContext: { thumbnailIndex },\n        } = useFancy();\n        const [isZoomActive, setZoomActive] = useState(false);\n        const [zoomImageStyle, setZoomImageStyle] = useState(Display.None);\n        const [zoomImageCacheKey, setZoomImageCacheKey] = useState(\"\");\n        const [zoomImageLoaded, setZoomImageLoaded] = useState(false);\n\n        const isVideo = !!image.h264_1000k_url;\n        const isMagnifyingGlassZoomable = !isVideo && !isTouchDevice;\n\n        useEffect(() => {\n            if (!zoomImageCacheKey && isZoomActive) {\n                preloadImage(image.large_image_url).then(() => {\n                    setZoomImageCacheKey(image.large_image_url);\n                    setZoomImageLoaded(true);\n                });\n            }\n            if (zoomImageCacheKey !== \"\" && image.large_image_url !== zoomImageCacheKey) {\n                setZoomImageCacheKey(\"\");\n                setZoomImageLoaded(false);\n            }\n        }, [image.large_image_url, isZoomActive, zoomImageCacheKey]);\n\n        const handleMouseEvent = ({ pageX, pageY }) => {\n            if (!isMagnifyingGlassZoomable) {\n                return;\n            }\n            if (isZoomActive) {\n                const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                setZoomImageStyle(nextZoomImageStyle);\n            }\n        };\n\n        return (\n            <SwiperSlide\n                zoom={isMagnifyingGlassZoomable}\n                key={i}\n                className={classnames({\n                    \"video-slide\": isVideo,\n                    startZoom: isZoomActive,\n                    zoomShow: true,\n                    \"active-slide\": isActive,\n                    loading: thing.loading,\n                })}\n                onClick={({ pageX, pageY }) => {\n                    if (!isMagnifyingGlassZoomable) {\n                        return;\n                    }\n                    const nextZoomImageStyle = getNextZoomImageStyle(image, pageX, pageY);\n                    setZoomImageStyle(nextZoomImageStyle);\n\n                    setZoomActive(!isZoomActive);\n                    setSlideLocked(!isZoomActive);\n                }}\n                onMouseMove={handleMouseEvent}>\n                {isVideo ? (\n                    <Video\n                        object={image}\n                        display={true}\n                        playing={thumbnailIndex == i}\n                        lastFullyRenderedObjectID={thing.id}\n                        allow={{ fullScreen: true }}\n                    />\n                ) : (\n                    <>\n                        <img\n                            className=\"swiper-lazy\"\n                            src={image.image_url}\n                            data-src={image.image_url}\n                            title={!isTouchDevice ? \"Double click to zoom-in\" : undefined}\n                            alt={thing.name}\n                            style={{ cursor: \"zoom-in\" }}\n                        />\n                        <em\n                            className=\"zoomImage\"\n                            onClick={() => {\n                                setZoomActive(false);\n                                setSlideLocked(false);\n                            }}\n                            style={{\n                                ...getZoomImageStyle(image, isZoomActive, zoomImageStyle),\n                                backgroundColor: \"white\",\n                                backgroundImage: `url(${zoomImageLoaded ? image.large_image_url : image.image_url})`,\n                            }}\n                        />\n                        {isTouchDevice && <div className=\"swiper-lazy-preloader\" />}\n                    </>\n                )}\n            </SwiperSlide>\n        );\n    },\n    (prevProps: ImageSlideProps, nextProps: ImageSlideProps) => {\n        return prevProps.image.image_url === nextProps.image.image_url && prevProps.isActive === nextProps.isActive;\n    }\n);\nImageSlide.displayName = \"SwiperSlide\"; // This is important to make swiper to acknowledge it's actually slide, not some random components\n\nconst Image = () => {\n    const fancyProps = useFancy();\n    const {\n        thing,\n        saleContext,\n        slideContext: { thumbnailIndex },\n    } = fancyProps;\n    const swiperRef = useRef(null);\n    const swipeThumbsRef = useRef(null);\n    const [thumbIndex, setThumbIndex] = useState(0);\n    const [slideLocked, setSlideLocked] = useState(false);\n    const [swiper, setSwiper] = useState<null | SwiperClass>(null);\n    const option = getCurrentSaleOption(thing.sales, saleContext, true);\n    const images = getSaleImages(thing, option) as ThingImageOrVideo[];\n    const lastThumbIndex = images.length - PER_PAGE;\n\n    useEffect(() => {\n        if (!swiper) {\n            return;\n        }\n        if (thumbnailIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbnailIndex);\n        }\n        if (swipeThumbsRef.current) {\n            const thumbSwiper = swipeThumbsRef.current.swiper;\n            if (!thumbSwiper.slides[thumbnailIndex].classList.contains(\"swiper-slide-visible\"))\n                thumbSwiper.slideTo(Math.min(thumbnailIndex, lastThumbIndex));\n        }\n    }, [thumbnailIndex, swiper]);\n\n    useEffect(() => {\n        if (!swipeThumbsRef.current) {\n            return;\n        }\n        const swiper = swipeThumbsRef.current.swiper;\n        if (thumbIndex != swiper.activeIndex) {\n            swiper.slideTo(thumbIndex);\n        }\n    }, [thumbIndex]);\n\n    return (\n        <div className=\"figure-section\">\n            <Swiper\n                ref={swiperRef}\n                onSlideChange={() => {\n                    const swiper = swiperRef.current?.swiper;\n                    if (swiper) {\n                        fancyProps.dispatch(setThumbnailIndex(swiper.activeIndex));\n                        setThumbIndex(swiper.activeIndex);\n                    }\n                }}\n                preloadImages={false}\n                lazy={{\n                    loadPrevNext: true,\n                    loadPrevNextAmount: 0,\n                }}\n                zoom={\n                    isTouchDevice\n                        ? {\n                              maxRatio: 2,\n                          }\n                        : undefined\n                }\n                allowSlidePrev={!slideLocked}\n                allowSlideNext={!slideLocked}\n                onZoomChange={(_, scale) => {\n                    if (scale > 1) {\n                        setSlideLocked(true);\n                    } else {\n                        setSlideLocked(false);\n                    }\n                }}\n                onSwiper={(swiper) => {\n                    setSwiper(swiper);\n                }}\n                className=\"gallery-top\">\n                {images.map((image, i) => {\n                    return (\n                        <ImageSlide\n                            key={i}\n                            image={image}\n                            i={i}\n                            setSlideLocked={setSlideLocked}\n                            isActive={swiper?.activeIndex === i}\n                        />\n                    );\n                })}\n                <ActionButtons />\n            </Swiper>\n            <div\n                className=\"prev\"\n                style={{ opacity: thumbIndex > 0 ? undefined : 0.3, display: lastThumbIndex <= 0 ? \"none\" : undefined }}\n                onClick={() => setThumbIndex(Math.max(0, thumbIndex - 5))}\n            />\n            <Swiper\n                className=\"gallery-thumbs\"\n                ref={swipeThumbsRef}\n                onClick={() => {\n                    if (!swipeThumbsRef.current) {\n                        return;\n                    }\n                    fancyProps.dispatch(setThumbnailIndex(swipeThumbsRef.current.swiper.clickedIndex));\n                }}\n                direction=\"vertical\"\n                spaceBetween={16}\n                slidesPerView={PER_PAGE}\n                watchSlidesVisibility={true}\n                height={HEIGHT}>\n                {images.map((image, i) => {\n                    return (\n                        <SwiperSlide\n                            key={i}\n                            className={classnames({\n                                \"video-thumbnail\": image.h264_1000k_url,\n                                selected: i == thumbnailIndex,\n                            })}>\n                            <img\n                                height=\"80\"\n                                src={placeholderImage}\n                                style={{ backgroundImage: `url(${image.thumbnail_url})` }}\n                            />\n                        </SwiperSlide>\n                    );\n                })}\n            </Swiper>\n            <div\n                className=\"next\"\n                style={{\n                    opacity: thumbIndex < lastThumbIndex ? undefined : 0.3,\n                    display: lastThumbIndex <= 0 ? \"none\" : undefined,\n                }}\n                onClick={() => {\n                    setThumbIndex(Math.min(thumbIndex + 5, lastThumbIndex));\n                }}\n            />\n        </div>\n    );\n};\n\nexport default Image;\n","export const Keys = {\n    Sidebar: {\n        Wrap: 'SIDEBAR_WRAP',\n        Body: 'SIDEBAR_BODY',\n        Title: 'SIDEBAR_TITLE',\n        Price: 'SIDEBAR_PRICE',\n        Form: 'SIDEBAR_FORM',\n        Desc: 'SIDEBAR_DESCRIPTION',\n        Owner: 'SIDEBAR_OWNER',\n    },\n};\n","import React from \"react\";\nimport classnames from \"classnames\";\n\n// Generic purchase handler, needs to be bound to insatnce on initialization.\n/*\n    data-sii={sales.id}\n    data-sisi={sales.seller_id}\n    data-tid={thing.id}\n*/\nconst SaleOptions = ({\n    options = [\"1\"],\n    currentValue = \"1\",\n    id = \"\",\n    value = (v) => v,\n    expander,\n    defaultValue,\n    printer,\n    disabled,\n    onChange,\n    onClick,\n    onFocus,\n    unselectedLabel,\n}) => {\n    expander =\n        expander ||\n        ((option, idx) => (\n            <option key={`sale_options-${idx}`} value={value(option)}>\n                {printer(option)}\n            </option>\n        ));\n\n    return (\n        <select\n            id={id}\n            className={classnames(\"select-boxes2\", { \"one-option\": options.length <= 1 })}\n            value={value(currentValue) || defaultValue}\n            disabled={disabled}\n            onChange={onChange}\n            onClick={onClick}\n            onFocus={onFocus}>\n            {unselectedLabel && <option value=\"\">{unselectedLabel}</option>}\n            {options.map(expander)}\n        </select>\n    );\n};\n\nexport const SelectBox = (props) => {\n    let {\n        className,\n        disabled,\n        label,\n        currentValue,\n        defaultValue,\n        id,\n        printer,\n        tabIndex,\n        unselectedLabel,\n        options = [\"1\"],\n        SizeGuide,\n        showSelectWarning,\n    } = props;\n\n    printer = printer != null ? printer : (s) => s;\n    defaultValue = defaultValue != null ? defaultValue : \"1\";\n    className = className != null ? className : null;\n\n    var labelValue;\n    if (unselectedLabel != null && currentValue === \"\") {\n        labelValue = unselectedLabel;\n    } else {\n        labelValue = printer(currentValue != null ? currentValue : defaultValue);\n    }\n\n    return (\n        <div className={className}>\n            <label>{label}</label>\n            <span className={`trick-select ${id} ${showSelectWarning ? 'soldout' : ''}`}>\n                <a\n                    className={classnames(\"selectBox\", { disabled, \"one-option\": options.length <= 1 })}\n                    tabIndex={tabIndex || \"1\"}>\n                    <span className=\"selectBox-label\">{labelValue}</span>\n                    <span className=\"selectBox-arrow\" />\n                </a>\n                <SaleOptions {...props} printer={printer} defaultValue={defaultValue} />\n            </span>\n            {SizeGuide && <SizeGuide key=\"size-guide\" />}\n        </div>\n    );\n};\n\nexport class MultiOptionState {\n    constructor(options, option_meta) {\n        this.options = options;\n        this.option_meta = option_meta;\n        const orderMap = {};\n        option_meta.forEach((m) => {\n            if (orderMap[m.type] == null) {\n                orderMap[m.type] = { length: 1 };\n                orderMap[m.type][m.name] = 0;\n            } else {\n                orderMap[m.type][m.name] = orderMap[m.type].length;\n                orderMap[m.type].length += 1;\n            }\n        });\n        this.orderMap = orderMap;\n    }\n    // i.e.) getPossibleValues(['a', '1', ''], 1) => ['1', '3', '6']\n    // output: get possible options for 2nd option dependent on ('a' / 1st option)\n    getPossibleValuesForIndex(selected, targetIndex) {\n        const { options, option_meta, orderMap } = this;\n        if (targetIndex === 0) {\n            return option_meta[0].values;\n        }\n        let filteredOptions = options;\n        option_meta\n            .map((m) => {\n                const order = orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            })\n            .forEach((sel, idx) => {\n                if (idx < targetIndex) {\n                    filteredOptions = filteredOptions.filter((option) => option.values[idx] === sel);\n                }\n            });\n        return _.uniq(filteredOptions.map((o) => o.values[targetIndex])); // FIXME\n    }\n\n    getMultiOptions(selected) {\n        return this.option_meta.map((meta, idx) => {\n            return [meta, this.getPossibleValuesForIndex(selected, idx)];\n        });\n        /*\n        returns [\n            [type, ['a', 'b', 'c']],\n            [type, ['1', '2']],\n            [tyep, ['red', 'white', 'black']]\n        ]\n        */\n    }\n}\n\nexport const MultiOption = (props) => {\n    const { selected, multiOptionState, sid, SizeGuide } = props;\n    if (multiOptionState == null) {\n        return null;\n    }\n    const multiOptions = multiOptionState.getMultiOptions(selected);\n    var sizeGuidePos = -1;\n    if (SizeGuide) {\n        multiOptions.map(([meta, values], idx) => {\n            if (meta.name && meta.name.trim().toLowerCase() === \"size\") sizeGuidePos = idx;\n        });\n        if (sizeGuidePos < 0) sizeGuidePos = multiOptions.length - 1;\n    }\n    return multiOptions.map(([meta, values], idx) => {\n        const { type, name } = meta;\n\n        const indexTypeOf = multiOptionState.orderMap[type] && multiOptionState.orderMap[type][name];\n        const additional = {\n            name,\n            values,\n            indexTypeOf,\n            selectedArray: selected && selected[type],\n            selectedValue: selected && selected[type] && selected[type][indexTypeOf],\n            key: `${sid}-${idx}`,\n            showSizeGuide: idx == sizeGuidePos,\n        };\n        if (type === \"dropdown\") {\n            return <MultiSelectBox {...props} {...additional} />;\n        } else if (type === \"swatch\") {\n            additional.swatch = meta.swatch;\n            return <MultiSwatch {...props} {...additional} />;\n        } else if (type === \"thumbnail\") {\n            additional.thumbnail = meta.thumbnail;\n            return <MultiThumbnail {...props} {...additional} />;\n        } else if (type === \"button\") {\n            return <MultiButton {...props} {...additional} />;\n        }\n    });\n};\n\nexport const MultiSelectBox = (props) => {\n    const { values, name, onMultiSelectBoxChange, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option\">\n            <label>{name}</label>\n            <select\n                onChange={onMultiSelectBoxChange}\n                selected={selectedValue}\n                className={values.length <= 1 ? \"one-option\" : undefined}>\n                {values.map((value, i) => {\n                    return <MultiSelectBoxOption key={i} value={value} indexTypeOf={indexTypeOf} />;\n                })}\n            </select>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSelectBoxOption = (props) => {\n    const { value, indexTypeOf } = props;\n    return (\n        <option data-value={value} data-index-typeof={indexTypeOf} value={value}>\n            {value}\n        </option>\n    );\n};\n\nexport const MultiSwatch = (props) => {\n    const { name, values, swatch, indexTypeOf, selectedValue, onClickSwatch, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option swatch\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiSwatchOption\n                            key={i}\n                            value={value}\n                            swatch={swatch}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            onClick={onClickSwatch}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiSwatchOption = (props) => {\n    const { value, swatch, indexTypeOf, selectedValue, onClick } = props;\n    return (\n        <a\n            href=\"#\"\n            style={{ backgroundColor: swatch[value] }}\n            onClick={onClick}\n            data-value={value}\n            data-label={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}\n        />\n    );\n};\n\nexport const MultiThumbnail = (props) => {\n    const { values, name, thumbnail, onClickThumbnail, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n\n    return (\n        <div className=\"multi-option thumbnail\">\n            <label>{name}</label>\n            <span className=\"value\">{selectedValue}</span>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiThumbnailOption\n                            key={i}\n                            onClick={onClickThumbnail}\n                            value={value}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            thumbnail={thumbnail}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiThumbnailOption = ({ onClick, value, indexTypeOf, selectedValue, thumbnail }) => {\n    return (\n        <a\n            href=\"#\"\n            onClick={onClick}\n            data-value={value}\n            data-index-typeof={indexTypeOf}\n            className={selectedValue === value ? \"selected\" : \"\"}>\n            <img\n                src=\"/_ui/images/common/blank.gif\"\n                style={{ backgroundImage: `url(\"${thumbnail[value]}\")`, backgroundSize: \"cover\" }}\n                alt={value}\n            />\n        </a>\n    );\n};\n\nexport const MultiButton = (props) => {\n    const { values, name, onClickMutliButton, indexTypeOf, selectedValue, showSizeGuide, SizeGuide } = props;\n    return (\n        <div className=\"multi-option button\">\n            <label>{name}</label>\n            <div className=\"select-option\">\n                {values.map((value, i) => {\n                    return (\n                        <MultiButtonOption key={i}\n                            onClick={onClickMutliButton}\n                            indexTypeOf={indexTypeOf}\n                            selectedValue={selectedValue}\n                            value={value}\n                        />\n                    );\n                })}\n            </div>\n            {showSizeGuide ? <SizeGuide key=\"size-guide\" /> : null}\n        </div>\n    );\n};\n\nconst MultiButtonOption = (props) => {\n    const { value, onClick, indexTypeOf, selectedValue } = props;\n    return (\n        <button\n            onClick={onClick}\n            className={selectedValue === value ? \"selected\" : \"\"}\n            data-value={value}\n            data-index-typeof={indexTypeOf}>\n            {value}\n        </button>\n    );\n};\n","import React, { useCallback } from \"react\";\nimport classnames from \"classnames\";\nimport { useDispatch } from \"react-redux\";\nimport { updateSaleContext } from \"../../../../action/action-helpers\";\nimport { getCurrentSaleOption, getWaiting } from \"../../../map\";\nimport { useFancy } from \"../../FancyContext\";\nimport appState from \"../../../../appstate\";\nimport type { SaleOption } from \"ftypes\";\n\ninterface ICartButtonProps {\n  available: boolean;\n  waiting: boolean;\n  soldout: boolean;\n  onPurchase(): React.MouseEventHandler;\n}\n\nconst CartButton: React.FC<ICartButtonProps> = ({ onPurchase }) => {\n  const dispatch = useDispatch();\n  const { thing: { sales }, saleContext } = useFancy();\n\n  const waiting = getWaiting(sales, saleContext);\n  const available = sales.available;\n  const { soldout } = getCurrentSaleOption(sales, saleContext) as SaleOption;\n\n  if (!available) {\n    return <Button\n      className={classnames(\"btn-create not-available\")}\n      label={gettext(\"Not Available\")}\n      disabled={true}\n    />\n  }\n\n  const onNotifyLater = useCallback(\n    (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n      if (!appState.loggedIn) {\n        return window.require_login();\n      }\n      const opt = getCurrentSaleOption(sales, saleContext, true);\n      const params: any = { sale_item_id: sales.id };\n\n      if (opt != null) {\n        params.option_id = opt.id;\n      }\n\n      const waiting = getWaiting(sales, saleContext);\n      if (waiting) {\n        params.remove = 1;\n      }\n\n      $.ajax({\n        type: \"post\",\n        url: \"/wait_for_product.json\",\n        data: params,\n        dataType: \"json\",\n      }).done((json) => {\n        if (!json || json.status_code == null) {\n          return;\n        }\n        if (json.status_code == 0 && json.message) {\n          window.alertify.alert(json.message);\n          return;\n        }\n        const waiting = params.remove ? false : true;\n        dispatch(updateSaleContext({ waiting }));\n      });\n    }\n    , [dispatch, sales, saleContext])\n\n  return <>\n    <Button\n      onClick={onPurchase}\n      className={classnames(\"add_to_cart btn-cart\", {\n        \"btn-create\": soldout,\n        \"btns-blue-embo\": !soldout,\n      })}\n      disabled={!!soldout}\n      label={soldout ? gettext(\"Sold out\") : gettext(\"Add to cart\")}\n    />\n    <Button\n      className={classnames(\"btn-create notify-available\", { subscribed: waiting })}\n      label={waiting ? gettext(\"Subscribed\") : gettext(\"Notify me when available\")}\n      style={!soldout ? { display: \"none\" } : undefined}\n      onClick={onNotifyLater}\n    />\n  </>\n}\n\nconst Button: React.FC<React.ButtonHTMLAttributes<null> & { label: string; }> = ({ ...props }: any) => (\n  <button {...props} label={null}>\n    {props.label}\n  </button>\n);\n\nexport default CartButton;\n","import React from \"react\";\nimport type { OverlayProps } from \"ftypes\";\nimport { isSalesOptionsAvailable } from \"../../../map\";\nimport { useFancy } from \"../../FancyContext\";\n\nconst ApplePayButton: React.FC<OverlayProps> = () => {\n    const {\n        appContext: { /*applePayDisplay, */ applePayTest },\n        thing,\n        thing: { sales },\n        saleContext: { saleOptionID, selectedQuantity, price },\n    } = useFancy();\n\n    const handleApplePayCheckout : React.MouseEventHandler = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!saleOptionID || window.FancyApplePay.clicked) {\n            return;\n        }\n        window.FancyApplePay.clicked = true;\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n\n        var title = thing.name;\n        var country = sales.seller.country;\n        var sale_item_id = sales.id;\n        var seller_id = sales.seller.id;\n        var quantity = selectedQuantity;\n\n        var option_id = null;\n        var option = null;\n        if (salesOptionsAvailable) {\n            option_id = parseInt(saleOptionID, 10) || null; // ? should be same value with option except get casted\n            option = saleOptionID;\n        }\n\n        try {\n            window.FancyApplePay.requestPurchase(\"Dynamic\", {\n                sale_item_id,\n                seller_id,\n                option_id,\n                quantity,\n                price,\n                title,\n                option,\n                country,\n                testmode: applePayTest,\n            });\n        } catch (err) {\n            window.DEBUG && console.trace(err);\n            alert(err);\n            window.FancyApplePay.clicked = false;\n        }\n    };\n    return (\n        <div\n            className=\"applePayButton\"\n            style={{\n                WebkitAppearance: \"-apple-pay-button\",\n                ApplePayButtonType: \"plain\",\n                ApplePayButtonStyle: \"black\",\n            }}\n            onClick={handleApplePayCheckout}></div>\n    );\n}\n\nexport default ApplePayButton;","import React, { Component } from \"react\";\nimport classnames from \"classnames\";\nimport { floatFormatMinusTwo, numberFormat, renderPopup, escapeSelector, getLocationArgPairs } from \"fancyutils\";\n\nimport { convertCurrency, updateSaleContext } from \"../../../../action/action-helpers\";\nimport { updateAppContext } from \"../../../../action/actions\";\nimport { currencyIsUSD, getCurrentSaleOption, getSafeNameProp, isSalesOptionsAvailable } from \"../../../map\";\nimport { Keys } from \"../../../Perf\";\nimport { SelectBox, MultiOption, MultiOptionState } from \"../SaleItemForm\";\nimport type { OverlayProps, ReduxProps, SaleOption, SelectedMetaOption, SaleOptionMeta } from \"ftypes\";\nimport type { ISaleItemSidebarHeadProps, ISaleItemSidebarHeadState } from './type';\nimport CartButton from './CartButton';\nimport { isOptionMulti } from './multiOption';\nimport ApplePayButton from './ApplePayButton';\n\nfunction optionValueFunction(opt) {\n    return opt?.id;\n}\nconst saleNamePrinter = (opt) => `${opt.name} - $${opt.price}`;\n\nconst { Fancy, alertify } = window;\n\nconst Price = ({ discounting, price, retailPrice, discountPercentage }) => {\n    return <div className=\"price\" key={Keys.Sidebar.Price}>\n        <big className={classnames({ sale: discounting })}>\n            ${floatFormatMinusTwo(price)}\n        </big>\n        {discounting && (\n            <span className=\"sales\">\n                <em>${floatFormatMinusTwo(retailPrice)}</em> (Save {numberFormat(discountPercentage, 0)}\n                            %)\n            </span>\n        )}\n    </div>\n}\n\nexport default class SaleItemSidebarHead extends Component<\n    ISaleItemSidebarHeadProps, ISaleItemSidebarHeadState\n> {\n    state = {\n        loading: false,\n        showSelectWarning: false,\n        selected: {},\n        disabled: [],\n        multiOptionState: null,\n    };\n\n    constructor(props: OverlayProps & ReduxProps) {\n        super(props);\n        // for multi options\n        this.onClickThumbnail = this.onClickMultiOptionGen(\"thumbnail\");\n        this.onClickSwatch = this.onClickMultiOptionGen(\"swatch\");\n        this.onMultiSelectBoxChange = this.onClickMultiOptionGen(\"dropdown\");\n        this.onClickMutliButton = this.onClickMultiOptionGen(\"button\");\n    }\n\n    renderCurrencyPopup = () => {\n        import(/* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\").then(({ CurrencyPopup }) => {\n            renderPopup(CurrencyPopup, { currentCurrency: this.props.saleContext.currencyCode });\n        });\n    };\n\n    handleCurrencyPopup = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        this.renderCurrencyPopup();\n    };\n\n    handleCurrencyPopupUSD = (event: React.SyntheticEvent<EventTarget>) => {\n        event.preventDefault();\n        if (!currencyIsUSD(this.props)) {\n            return false;\n        }\n        this.renderCurrencyPopup();\n    };\n\n    handlePurchase = (event) => {\n        event.preventDefault();\n        const {\n            thing: { sales },\n            saleContext,\n        } = this.props;\n        const saleOption = getCurrentSaleOption(sales, saleContext, true);\n        const soldout = saleOption == null ? sales.soldout : saleOption.soldout;\n        if (soldout || this.state.loading) {\n            return;\n        }\n        const saleOptionID = saleOption != null ? saleOption.id : null;\n        if (sales.options.length > 0 && saleContext.saleOptionID === null) {\n            this.setState({ showSelectWarning: true });\n            return;\n        }\n\n        this.setState({ showSelectWarning: false, loading: true }, () => {\n            const payload = {\n                sale_id: sales.id,\n                quantity: saleContext.selectedQuantity,\n                personalization: saleContext.personalization,\n            };\n            if (saleOptionID != null) {\n                payload.option_id = saleOptionID;\n            }\n            Fancy.CartAPI.addItem(payload, (success, json) => {\n                if (success) {\n                    Fancy.Cart.openPopup();\n                } else {\n                    alertify.alert((json && json.error) || \"Failed to add the item to cart. Please contact us at cs@fancy.com if the problem persists.\");\n                }\n                this.setState({ loading: false });\n            })\n        });\n    }\n\n    handleOptionChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        if (!event.currentTarget.value) {\n            dispatch(updateSaleContext({ saleOptionID: null }));\n        } else {\n            const saleOptionID = parseInt(event.currentTarget.value, 10);\n            dispatch(updateSaleContext({ saleOptionID }));\n        }\n    };\n\n    handleQuantityChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const selectedQuantity = parseInt(event.currentTarget.value, 10);\n        dispatch(updateSaleContext({ selectedQuantity }));\n    };\n\n    handlePersonalizationChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\n        const { dispatch } = this.props;\n        const personalization = event.currentTarget.value;\n        dispatch(updateSaleContext({ personalization }));\n    };\n\n    checkApplePay = () => {\n        if (window.FancyApplePay) {\n            const { dispatch, thing, thing: { sales } } = this.props;\n            const os = sales.options.filter((o) => !o.soldout);\n            const data = {\n                total: { label: thing.name, amount: (sales.price * 100) | 0 },\n            };\n\n            if (os.length > 0) {\n                data.displayItems = os.map((o) => ({\n                    label: o.name,\n                    amount: (Number(o.price) * 100) | 0,\n                }));\n            }\n\n            window.FancyApplePay.checkAvailability((available, testmode) => {\n                if (available) {\n                    dispatch(\n                        updateAppContext({\n                            applePayDisplay: true,\n                            applePayTest: testmode,\n                        })\n                    );\n                }\n            }, data);\n        }\n    };\n\n    componentDidMount() {\n        if (!currencyIsUSD(this.props)) {\n            const { saleContext } = this.props;\n            convertCurrency(saleContext.currencyCode, saleContext.price);\n        }\n        this.initializeMultiOption();\n        this.checkApplePay();\n    }\n\n    componentDidUpdate(prevProps: OverlayProps) {\n        if (prevProps.thing.id !== this.props.thing.id) {\n            this.initializeMultiOption();\n            this.checkApplePay();\n            if (this.state.showSelectWarning) {\n                this.setState({\n                    showSelectWarning: false,\n                });\n            }\n            return;\n        }\n\n        const {\n            saleContext,\n            thing: { sales },\n        } = prevProps;\n\n        const nsc = this.props.saleContext;\n        const nextSaleOptionID = nsc.saleOptionID;\n        if (saleContext.saleOptionID !== nextSaleOptionID) {\n            if (this.state.showSelectWarning) {\n                this.setState({ showSelectWarning: false });\n            }\n            const o = _.find(sales.options, (_o) => _o.id === nextSaleOptionID);\n            // option sync\n            if (o) {\n                const mos = $(\".sale-item-input .multi-option\");\n                o.values.forEach((v, i) => {\n                    const $so = mos\n                        .eq(i)\n                        .find(`[data-value=\"${escapeSelector(v)}\"]:not(.selected)`)\n                        .eq(0);\n                    if ($so.length) {\n                        if ($so.is(\"option\"))\n                            $so.prop(\"selected\", true);\n                        else\n                            $so.get(0).click();\n                    }\n                });\n                if (window.FancyApplePay && window.FancyApplePay.paymentRequest) {\n                    window.FancyApplePay.paymentRequest.update({\n                        total: {\n                            label: o.name,\n                            amount: (Number(o.price) * 100) | 0,\n                        },\n                    });\n                }\n            }\n        }\n    }\n\n    initializeMultiOption = () => {\n        const {\n            thing: {\n                sales: { options, option_meta },\n            },\n            saleContext,\n            dispatch,\n        } = this.props;\n\n        this.setState(this.getInitialMultiOptionState(options, option_meta), () => {\n            // don't block selecting cheapest item\n            if (!(options && options.length > 1)) {\n                this.updateSaleOptionIDFromMultiOptionState();\n            }\n            // ?option={number} support\n            const presetOptionId = getLocationArgPairs(\"option\");\n            if (presetOptionId && presetOptionId[1] && String(saleContext.saleOptionID) !== presetOptionId[1]) {\n                dispatch(updateSaleContext({ saleOptionID: parseInt(presetOptionId[1], 10) }));\n            }\n        });\n    };\n\n    getInitialMultiOptionState(options: SaleOption[], option_meta: SaleOptionMeta[]) {\n        const selected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        if (option_meta.length > 0) {\n            const nonSoldout = options.filter((o) => o.quantity !== 0);\n            if (nonSoldout.length !== 0) {\n                const selectedNonSoldoutOption = nonSoldout[0]; // temporary - FIXME\n                option_meta.forEach(function (opt, i) {\n                    const { type } = opt;\n                    const nextValue = selectedNonSoldoutOption.values[i];\n                    selected[type].push(nextValue);\n                });\n            } else {\n                // set first available multi option\n                option_meta.forEach(function (opt) {\n                    const { type } = opt;\n                    const nextValue = opt.values[0];\n                    selected[type].push(nextValue);\n                });\n            }\n        }\n        const multiOptionState = new MultiOptionState(options, option_meta);\n        return { selected, multiOptionState };\n    }\n\n    extractSaleOptionIDFromMultiOptionState = (selected?: SelectedMetaOption) => {\n        const {\n            thing: { sales },\n        } = this.props;\n        if (selected == null) {\n            selected = this.state.selected;\n        }\n        const { multiOptionState } = this.state;\n\n        const selectedOptionArray = multiOptionState.option_meta\n            .map((m) => {\n                const order = multiOptionState.orderMap[m.type][m.name];\n                if (selected[m.type][order]) {\n                    return selected[m.type][order];\n                } else {\n                    return selected[m.type][0];\n                }\n            });\n        const selectedOption = _.find(sales.options, (opt) => selectedOptionArray.every((e, i) => e === opt.values[i]));\n        if (selectedOption) {\n            return selectedOption.id;\n        } else {\n            window.DEBUG &&\n                console.warn(\"no option found for \", selectedOptionArray, \"meta:\", sales.options, this.state.selected);\n        }\n    };\n\n    updateSaleOptionIDFromMultiOptionState = () => {\n        const { dispatch } = this.props;\n        let saleOptionID = this.extractSaleOptionIDFromMultiOptionState();\n        if (saleOptionID === undefined) {\n            const amendedID = this.amendSaleOptionFromMultiOptionState();\n            if (amendedID) {\n                saleOptionID = amendedID;\n            } else {\n                window.DEBUG && console.warn(\"Couldn't recover option\");\n            }\n        }\n        dispatch(updateSaleContext({ saleOptionID }));\n    };\n\n    amendSaleOptionFromMultiOptionState = () => {\n        const { selected, multiOptionState } = this.state;\n        const nextSelected = { swatch: [], button: [], thumbnail: [], dropdown: [] };\n        multiOptionState.option_meta.forEach(({ type, name }, index) => {\n            const order = multiOptionState.orderMap[type][name];\n            const selectedValue = selected[type][order];\n            if (index === 0) {\n                nextSelected[type][order] = selectedValue;\n                return;\n            }\n            const values = multiOptionState.getPossibleValuesForIndex(selected, index);\n            let value;\n            if (values.some((v) => v === selectedValue)) {\n                value = selectedValue;\n            } else {\n                value = values[0];\n            }\n            selected[type][order] = value; // even though it will be flushed out, it will affect next options so fix it as well\n            nextSelected[type][order] = value;\n        });\n        this.setState({ selected: nextSelected });\n        return this.extractSaleOptionIDFromMultiOptionState(nextSelected);\n    };\n\n    onClickMultiOptionGen = (type) => {\n        return (e) => {\n            const el = e.currentTarget;\n            let value;\n            let indexOfType;\n            if (el.tagName === \"SELECT\") {\n                value = el.value;\n                indexOfType = Number($(el).find(\":selected\").attr(\"data-index-typeof\"));\n            } else {\n                value = $(el).attr(\"data-value\");\n                indexOfType = Number($(el).attr(\"data-index-typeof\"));\n            }\n            if (e.currentTarget.className === \"disabled\") {\n                return;\n            }\n\n            this.state.selected[type][indexOfType] = value;\n            // forceful trigger even though no differences in value.\n            this.setState({ selected: _.extend({}, this.state.selected) }, this.updateSaleOptionIDFromMultiOptionState);\n        };\n    };\n\n    UNSAFE_componentWillReceiveProps(nextProps) {\n        const { saleContext } = this.props;\n        const nsc = nextProps.saleContext;\n        const priceChanges = saleContext.price !== nsc.price;\n        const currencyChanges = saleContext.currencyCode !== nsc.currencyCode;\n        if (priceChanges || currencyChanges) {\n            if (!currencyIsUSD(nextProps)) {\n                const { saleContext } = nextProps;\n                convertCurrency(saleContext.currencyCode, saleContext.price, true); // FIXME: unable to comparison since price update comes first (SaleItemSidebarHead.componentWillReceiveProps())\n            }\n        }\n    }\n\n    render() {\n        const {\n            thing,\n            thing: { sales },\n            appContext: { applePayDisplay },\n            saleContext,\n            saleContext: { selectedQuantity, price },\n        } = this.props;\n        const { showSelectWarning } = this.state;\n\n        var opt = getCurrentSaleOption(sales, saleContext) as SaleOption;\n        var discountPercentage = parseFloat(opt.discount_percentage); // TODO: use decimal?\n        var retailPrice = opt.retail_price;\n        const { soldout, quantity } = opt;\n        const { option_meta } = sales;\n        const optionIsMulti = isOptionMulti(sales);\n\n        const salesOptionsAvailable = isSalesOptionsAvailable(sales);\n        const discounting = discountPercentage > 0;\n        const quantitySelectRange = soldout\n            ? [\"1\"]\n            : _.range(1, Math.min(10, (quantity || 0) + 1));\n        const showSelectbox = sales.options.length !== 0;\n\n        var applePayButton;\n        if (applePayDisplay && !soldout) {\n            applePayButton = <ApplePayButton {...this.props} />;\n        }\n\n        return (\n            <>\n                <h1 key={Keys.Sidebar.Title} className=\"title\" {...getSafeNameProp(thing)} />\n                <Price {...{ discounting, price, retailPrice, discountPercentage }} />\n                <div className=\"frm\" key={Keys.Sidebar.Form}>\n                    <fieldset className=\"sale-item-input\">\n                        {showSelectbox && !optionIsMulti && (\n                            <SelectBox\n                                className=\"multi-option\"\n                                id=\"option\"\n                                label={gettext(\"Option\")}\n                                currentValue={(opt.soldout || saleContext.saleOptionID !== null) ? opt : \"\"}\n                                value={optionValueFunction}\n                                printer={saleNamePrinter}\n                                options={sales.options}\n                                unselectedLabel=\"Please select\"\n                                expander={SaleItemOptionsExpander}\n                                disabled={!salesOptionsAvailable}\n                                onChange={this.handleOptionChange}\n                                showSelectWarning={showSelectWarning}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                            />\n                        )}\n                        {optionIsMulti && (\n                            <MultiOption\n                                sid={sales.id}\n                                onClickThumbnail={this.onClickThumbnail}\n                                onClickSwatch={this.onClickSwatch}\n                                onMultiSelectBoxChange={this.onMultiSelectBoxChange}\n                                onClickMutliButton={this.onClickMutliButton}\n                                selected={this.state.selected}\n                                disabled={this.state.disabled}\n                                soldout={!!soldout}\n                                option_meta={option_meta}\n                                SizeGuide={() => {\n                                    const hasSizeGuide = sales.size_guide_id != null;\n                                    return hasSizeGuide ? (\n                                        <a\n                                            className=\"size-guide\"\n                                            onClick={(e) => {\n                                                e.preventDefault();\n                                                import(\n                                                    /* webpackChunkName: \"OverlayThing.popup\" */ \"../../../popup/index\"\n                                                ).then(({ SizeGuidePopup }) => {\n                                                    renderPopup(SizeGuidePopup, this.props);\n                                                });\n                                            }}>\n                                            Size guide\n                                        </a>\n                                    ) : null;\n                                }}\n                                multiOptionState={this.state.multiOptionState}\n                            />\n                        )}\n                        {sales.personalizable && (\n                            <div className=\"personalization\">\n                                <label>This item can be personalized:</label>\n                                <input\n                                    type=\"text\"\n                                    className=\"text\"\n                                    name=\"personalization\"\n                                    placeholder=\"Personalization details\"\n                                    onChange={this.handlePersonalizationChange}\n                                />\n                            </div>\n                        )}\n                        <SelectBox\n                            id=\"quantity\"\n                            className=\"multi-option\"\n                            label={gettext(\"Quantity\")}\n                            defaultValue=\"1\"\n                            currentValue={selectedQuantity}\n                            options={quantitySelectRange}\n                            disabled={!!soldout}\n                            onChange={this.handleQuantityChange}\n                        />\n                        {applePayButton}\n                        {showSelectWarning && <div className=\"error\">Please select from the available option</div>}\n                        <CartButton onPurchase={this.handlePurchase} />\n                    </fieldset>\n                </div>\n            </>\n        );\n    }\n}\n\nfunction SaleItemOptionsExpander(sio, idx) {\n    return (\n        <option value={sio.id} key={`sale_options-${idx}`}>\n            {sio.soldout === true || !(sio.quantity > 0) ? `${sio.name} - ${gettext(\"Sold out\")}` : sio.name}\n        </option>\n    );\n}\n","import type { SaleItem } from \"ftypes\";\n\nexport function isOptionMulti(sales: SaleItem): boolean {\n  if (sales.option_meta.length > 1) {\n      return true;\n  } else if (sales.option_meta.length === 1) {\n      return sales.option_meta[0].type !== \"dropdown\";\n  } else {\n      return false;\n  }\n}\n","import React from \"react\";\nimport SaleItem from \"./SaleItem\";\n\nimport { useFancy } from \"../FancyContext\";\n\nconst Info = () => {\n    const fancyProps = useFancy();\n    const { thing: { reviews, sales }, fancyContext } = fancyProps;\n    const r = reviews.summary;\n\n    return (\n        <div className=\"figure-info\">\n            <div className=\"vendor\"><a href={sales.seller.shop_url}>{sales.seller.brand_name}</a></div>\n            {r.total_ratings > 0 && (\n                <div className=\"review-points\">\n                    <span style={{ cursor: r.total_reviews > 0 ? \"pointer\" : undefined }} onClick={() => {\n                        if (r.total_reviews > 0) {\n                            const $el = $(\".review-section\");\n                            const headerSize = parseInt($(\".container\").css(\"padding-top\")) || 0;\n                            if ($el.length) {\n                                $(window).scrollTop($el[0].offsetTop - headerSize);\n                            }\n                        }\n                    }}>\n                        {r.rating_avg} <small className=\"count\">({r.total_ratings} rating{r.total_ratings != 1 ? 's' : ''})</small>{\" \"}\n                    </span>\n                </div>\n            )}\n            <SaleItem {...fancyProps} />\n        </div>\n    );\n};\n\nexport default Info;\n","import React, { useEffect, useState, useRef } from \"react\";\nimport cx from \"classnames\";\n\nimport { useFancy } from \"../FancyContext\";\n\nconst Overview = () => {\n    const { thing } = useFancy();\n    const sales = thing.sales;\n    const bv = sales.seller.brand_values;\n    const shippingInfo: { [k: string]: any } = sales.shipping_info || {};\n\n    return (\n        <div className=\"overview\">\n            <dl className=\"shipping optional\">\n                <dt>Shipping Information</dt>\n                <dd>\n                    <ul>\n                        <li className=\"from\">\n                            <span>{shippingInfo.origin}</span>\n                        </li>\n                        {shippingInfo.cost && (\n                            <li className=\"cost\">\n                                <span>{shippingInfo.cost}</span>\n                            </li>\n                        )}\n                        {shippingInfo.window && (\n                            <li className=\"days\">\n                                <span>{shippingInfo.window}</span>\n                            </li>\n                        )}\n                    </ul>\n                </dd>\n            </dl>\n            {bv.length > 0 ? (\n                <dl className=\"brand-value optional\">\n                    <dt>Buy with Confidence</dt>\n                    <dd>\n                        {bv.slice(0,3).map(([className, text]) => (\n                            <span key={className} className={`badge ${className}`}>{text}</span>\n                        ))}\n                    </dd>\n                </dl>\n            ) : null}\n        </div>\n    );\n};\n\nconst Description = () => {\n    const [menu, setMenu] = useState<\"features\" | \"specification\" | \"returns\">(\"features\");\n    const [showMore, setShowMore] = useState(false);\n    const descEl = useRef<HTMLDivElement>(null);\n    const props = useFancy();\n    const { thing, thing: { sales } } = props;\n    const showFeatures = !!(sales.features && sales.features.trim());\n    const showSpecs = !!(sales.specifications && sales.specifications.trim());\n    const showReturns =\n        !!(sales.return_exchange_policy_title && sales.return_exchange_policy_title.trim()) ||\n        !!(sales.shipping_policy && sales.shipping_policy.trim());\n    \n    useEffect(() => {\n        if (showFeatures) {\n            setMenu('features');\n        } else if (showSpecs) {\n            setMenu('specification');\n        } else if (showReturns) {\n            setMenu('returns');\n        }\n        setShowMore(descEl.current ? descEl.current.clientHeight <= 76 : false);\n    }, [thing.id]);\n\n    return (\n        <div className=\"detail\">\n            <dl className={cx(\"description optional\")}>\n                <dt>Description</dt>                \n                <dd className={cx({ collapsed: !showMore })}>\n                    <div dangerouslySetInnerHTML={{ __html: sales.description }} ref={descEl}/>\n                </dd> \n                <a className=\"more\" onClick={() => setShowMore(true)} style={{display: showMore ? 'none' : undefined }}>Read more</a>\n            </dl>\n            <div className=\"features-menu\">\n                {showFeatures && (\n                    <a\n                        className={cx({ current: menu === \"features\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"features\");\n                        }}>\n                        Features\n                    </a>\n                )}\n                {showSpecs && (\n                    <a\n                        className={cx({ current: menu === \"specification\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"specification\");\n                        }}>\n                        Specifications\n                    </a>\n                )}\n                {showReturns && (\n                    <a\n                        className={cx({ current: menu === \"returns\" })}\n                        onClick={(e) => {\n                            e.preventDefault();\n                            setMenu(\"returns\");\n                        }}>\n                        Returns\n                    </a>\n                )}\n            </div>\n            {showFeatures && (\n                <dl className={cx(\"features optional\", { show: menu === \"features\" })} data-featuretype=\"features\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"features\");\n                            }}>\n                            Features\n                        </a>\n                    </dt>\n                    <dd dangerouslySetInnerHTML={{ __html: sales.features }} />\n                </dl>\n            )}\n            {showSpecs && (\n                <dl\n                    className={cx(\"features optional\", { show: menu === \"specification\" })}\n                    data-featuretype=\"specifications\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"specification\");\n                            }}>\n                            Specifications\n                        </a>\n                    </dt>\n                    <dt></dt>\n                    <dd dangerouslySetInnerHTML={{ __html: sales.specifications }} />\n                </dl>\n            )}\n            {showReturns && (\n                <dl className={cx(\"features optional\", { show: menu === \"returns\" })} data-featuretype=\"returns\">\n                    <dt>\n                        <a\n                            onClick={(e) => {\n                                e.preventDefault();\n                                setMenu(\"returns\");\n                            }}>\n                            Returns\n                        </a>\n                    </dt>\n                    <dd><p>{sales.return_exchange_policy_title}</p><p>{sales.shipping_policy}</p></dd>\n                </dl>\n            )}\n        </div>\n    );\n};\n\nconst Detail = () => {\n    return (\n        <div className=\"figure-detail\">\n            <Overview />\n            <Description />\n        </div>\n    );\n};\n\nexport default Detail;\n","import React from \"react\";\n\nimport Image from \"./Image\";\nimport Info from \"./Info\";\nimport Detail from \"./Detail\";\n\nconst Thing = () => {\n    return (\n        <div className=\"wrapper-content\">\n            <Image />\n            <Info />\n            <Detail />\n        </div>\n    );\n};\n\nexport default Thing;\n","import React from \"react\";\nimport { numberFormat } from \"fancyutils\";\n\nexport interface ThingCardProps {\n    brand_name: string;\n    title: string;\n    html_url: string;\n    image_url: string;\n    max_price: number;\n    min_price: number;\n}\n\nexport default function ThingCard({ brand_name, title, html_url, image_url, max_price, min_price }: ThingCardProps) {\n    let p = <>${numberFormat(min_price, 0)}</>;\n    if (max_price !== min_price) {\n        p = (\n            <>\n                <em className=\"from\">from </em> ${numberFormat(min_price, 0)}\n            </>\n        );\n    }\n\n    return (\n        <div className=\"figure-item new\">\n            <figure>\n                <a href={html_url}>\n                    <span className=\"figure\" style={{ backgroundImage: `url(${image_url})` }}>\n                        <img\n                            src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n                            style={{ backgroundImage: `url(${image_url})` }}\n                        />\n                    </span>\n                </a>\n            </figure>\n            <figcaption>\n                <a href={html_url}>\n                    <span className=\"category\">{brand_name}</span>\n                    <b className=\"title\">{title}</b>\n                    <span className=\"price\">{p}</span>\n                </a>\n            </figcaption>\n        </div>\n    );\n}\n","import React, { useState, useRef, useEffect } from \"react\";\nimport classnames from \"classnames\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\n\nimport ThingCard from \"./ThingCard\";\nimport { useFancy } from \"./FancyContext\";\n\nconst MerchantInfo = () => {\n    const {\n        thing,\n        thing: {\n            sales: { seller },\n        },\n    } = useFancy();\n    const [showMore, setShowMore] = useState(false);\n    const descEl = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        setShowMore(descEl.current ? descEl.current.clientHeight <= 80 : false);\n    }, [thing.id]);\n\n    return (\n        <div className=\"merchant-info\">\n            <h2 className=\"stit\">More about {seller.brand_name}</h2>\n            <div className={classnames(\"description\", { collapsed: !showMore })}>\n                <div dangerouslySetInnerHTML={{ __html: seller.description }} ref={descEl} />\n            </div>\n            <a className=\"more\" style={{ display: showMore ? \"none\" : undefined }} onClick={() => setShowMore(true)}>\n                Read more\n            </a>\n            <a className=\"btns-blue-embo\" href={seller.shop_url}>\n                Explore more\n            </a>\n            <Swiper className=\"swiper-no-swiping\">\n                {seller.sale_items.map((item, i) => {\n                    return (\n                        <SwiperSlide key={i} tag=\"li\">\n                            <ThingCard {...item} brand_name={seller.brand_name} />\n                        </SwiperSlide>\n                    );\n                })}\n            </Swiper>\n        </div>\n    );\n};\n\nexport default MerchantInfo;\n","import React, { useEffect, useState } from \"react\";\nimport { Swiper, SwiperSlide } from \"swiper/react\";\n\nimport ThingCard, { ThingCardProps } from \"./ThingCard\";\nimport { useFancy } from \"./FancyContext\";\n\nconst Recommendation = () => {\n    return (\n        <>\n            <Likeable />\n            <RecentlyViewed />\n        </>\n    );\n};\n\nconst convertThingsV1 = (things: {\n    url: string;\n    thumb_image_url_558: string;\n    sales: {\n        max_price: number;\n        min_price: number;\n        seller: {\n            brand_name: string;\n        };\n        title: string;\n    }[];\n    name: string;\n}[]) => {\n    return things.map(({ url: html_url, thumb_image_url_558: image_url, sales, name }) => {\n        return {\n            html_url,\n            image_url,\n            max_price: sales ? sales[0].max_price : 0,\n            min_price: sales ? sales[0].min_price : 0,\n            brand_name: sales ? sales[0].seller.brand_name : '',\n            title: sales ? sales[0].title : name,\n        };\n    });\n};\n\nconst Likeable = () => {\n    const { thing: { recommended } } = useFancy();\n\n    return (recommended?.length > 0) ? (\n        <>\n            <div className=\"recommend similar\">\n                <h2 className=\"stit\">You May Also Like</h2>\n                {/*<div className=\"control\">\n                    <div\n                        onClick={() => {\n                            setOffset(Math.max(5, offset - 5));\n                        }}>\n                        {\"<\"}\n                    </div>\n                    <div\n                        onClick={() => {\n                            setOffset(Math.min(offset + 5, ((things.length / 5) | 0) * 5));\n                        }}>\n                        {\">\"}\n                    </div>\n                </div>*/}\n            </div>\n            <Swiper className=\"recommend similar swiper-no-swiping\" slidesPerColumn={5}>\n                {recommended?.map((thing, i) => {\n                              return (\n                                  <SwiperSlide key={i}>\n                                      <ThingCard {...thing} />\n                                  </SwiperSlide>\n                              );\n                          })}\n            </Swiper>\n        </>\n    ) : null;\n};\n\nconst RecentlyViewed = () => {\n    const { thing } = useFancy();\n    const [things, setThings] = useState<ThingCardProps[] | null>(null);\n    // const [offset, setOffset] = useState(4);\n    const offset = 4;\n\n    useEffect(() => {\n        $.ajax({\n            type: \"get\",\n            url: `/recently_viewed_things_json?include_sale_item_option=True&rapi_compl=True&count=4&thing_id=${thing.id}`,\n        }).then((response) => {\n            const recently = convertThingsV1(response);\n            setThings(recently);\n        });\n    }, []);\n\n    return (\n        <>\n            <div className=\"recommend recently\">\n                <h2 className=\"stit\">Recently Viewed</h2>\n                {/*<div className=\"control\" style=\"display:none;\">\n                    <div\n                        onClick={() => {\n                            setOffset(Math.max(4, offset - 4));\n                        }}>\n                        {\"<\"}\n                    </div>\n                    <div\n                        onClick={() => {\n                            setOffset(Math.min(offset + 4, ((things.length / 4) | 0) * 4));\n                        }}>\n                        {\">\"}\n                    </div>\n                </div>*/}\n            </div>\n            <Swiper className=\"recommend recently swiper-no-swiping\" slidesPerColumn={4}>\n                {things\n                    ? things\n                          .filter((_, i) => {\n                              if (offset > 4) {\n                                  return i >= offset - 4 && i < offset;\n                              }\n                              return i < offset;\n                          })\n                          .map((thing, i) => {\n                              return (\n                                  <SwiperSlide key={i}>\n                                      <ThingCard {...thing} />\n                                  </SwiperSlide>\n                              );\n                          })\n                    : null}\n            </Swiper>\n        </>\n    );\n};\n\nexport default Recommendation;\n","import cx from \"classnames\";\nimport React, { Dispatch, SetStateAction, useEffect, useState } from \"react\";\nimport SwiperCore, { Thumbs } from \"swiper\";\nimport Lightbox from \"react-image-lightbox\";\nimport { debounceEventUntilTimeout } from \"fancyutils\";\n\nimport { useFancy } from \"./FancyContext\";\nimport type { ReviewEntry as ReviewEntryType, Reviews as ReviewsType } from \"ftypes\";\n\nSwiperCore.use([Thumbs]);\n\ninterface ReviewParams {\n    page?: number;\n    per_page?: number;\n    q?: string;\n    sort?: \"newest\" | \"rating_desc\" | \"rating_asc\";\n    setLoading?: Dispatch<SetStateAction<boolean>>;\n}\n\nfunction useDefaultReviews({ page, per_page, q, sort, setLoading }: ReviewParams) {\n    const { thing } = useFancy();\n    const {\n        sales: { id: sid },\n    } = thing;\n\n    const skip = !sort && !per_page && (!page || page === 1) && !q;\n    const reviews = useReviews({ skip, sid, page, per_page, q, sort, setLoading });\n    if (skip) {\n        return thing.reviews;\n    } else {\n        return reviews;\n    }\n}\n\nfunction useReviews({\n    skip = false,\n    sid,\n    page,\n    per_page,\n    q,\n    sort,\n    setLoading,\n}: ReviewParams & { skip: boolean; sid: number }) {\n    const [reviews, setReviews] = useState(null);\n    const param = $.extend({}, { q, page, per_page, sort });\n\n    useEffect(() => {\n        if (skip) {\n            return;\n        }\n        setLoading?.(true);\n        $.get(`/rest-api/v2/reviews/saleitem/${sid}`, param)\n            .then((res) => {\n                setReviews(res);\n            })\n            .always(() => {\n                setLoading?.(false);\n            });\n    }, [skip, sid, q, page, per_page, sort]);\n\n    return reviews;\n}\n\nconst Reviews = () => {\n    const [loading, setLoading] = useState(false);\n    const [reviewOption, setReviewOption] = useState({\n        page: undefined,\n        per_page: undefined,\n        q: undefined,\n        sort: undefined,\n    });\n\n    const reviews = useDefaultReviews({ ...reviewOption, setLoading });\n\n    if (reviewOption.q === undefined && (!reviews || reviews.review_count === 0)) {\n        return null;\n    }\n\n    return (\n        <div className={cx(\"review-points review-section\", { loading })}>\n            <ReviewHead reviews={reviews} />\n            <ReviewList\n                reviews={reviews}\n                reviewOption={reviewOption}\n                setReviewOption={(applying) => {\n                    setReviewOption({ ...reviewOption, ...applying });\n                }}\n            />\n        </div>\n    );\n};\n\nconst ReviewHead = ({ reviews } : { reviews: ReviewsType }) => {\n    return (\n        <>\n            <h3 className=\"stit\">\n                {reviews.summary.rating_avg}{\" \"}\n                <small className=\"count\">\n                    ({reviews.summary.total_ratings} rating{reviews.summary.total_ratings != 1 ? \"s\" : \"\"})\n                </small>\n            </h3>\n            <ul className=\"optional\">\n                {reviews.summary.attributes.map((a, i) => {\n                    return (\n                        <li key={i}>\n                            <label>{a.label}</label>\n                            <span className=\"review-range\">\n                                <i className=\"review-range-value\" style={{ width: `${Number(a.rating) * 20}%` }}></i>\n                            </span>\n                            <b>{a.rating}</b>\n                        </li>\n                    );\n                })}\n            </ul>\n            {/* <div className=\"btn-area\">\n                <button className=\"btns-blue-embo btn-review\">Write a Review</button>\n            </div> */}\n        </>\n    );\n};\n\nconst ReviewEntry = ({ review } : { review: ReviewEntryType }) => {\n    const [photoIndex, setPhotoIndex] = useState<number | null>(null);\n\n    return (\n        <li>\n            <small className=\"date\">{review.date}</small>\n            <span className={\"review-range \" + \"point\" + (review.rating | 0)}>\n                <span className=\"bg\"></span>\n                <i className=\"review-range-value\">\n                    <span></span>\n                </i>\n            </span>\n            <span className=\"username\">{review.name}</span>{\" \"}\n            <span className=\"verified\">\n                <em>Verified User</em>\n            </span>\n            <b className=\"title\">{review.title}</b>\n            <span className=\"description\">{review.review}</span>\n            <div>\n                {review.images.map((image, i) => {\n                    return (\n                        <div className=\"photo\" key={i}>\n                            <img\n                                onClick={() => {\n                                    setPhotoIndex(i);\n                                }}\n                                alt=\"review image\"\n                                src=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\"\n                                style={{\n                                    backgroundImage: `url('${image.thumbnail_url}')`,\n                                }}\n                            />\n                        </div>\n                    );\n                })}\n                {photoIndex !== null && (\n                    <Lightbox\n                        mainSrc={review.images[photoIndex].image_url}\n                        nextSrc={review.images[(photoIndex + 1) % review.images.length].image_url}\n                        prevSrc={\n                            review.images[(photoIndex + review.images.length - 1) % review.images.length].image_url\n                        }\n                        onCloseRequest={() => setPhotoIndex(null)}\n                        onMovePrevRequest={() =>\n                            setPhotoIndex((photoIndex + review.images.length - 1) % review.images.length)\n                        }\n                        onMoveNextRequest={() => setPhotoIndex((photoIndex + 1) % review.images.length)}\n                    />\n                )}\n            </div>\n        </li>\n    );\n};\n\nconst ReviewList = ({ reviews, reviewOption, setReviewOption } : { reviews: ReviewsType }) => {\n    const currentPage = reviewOption.page || 1;\n    return (\n        <>\n            <fieldset className=\"search\">\n                <label>Filter reviews</label>\n                <input\n                    type=\"text\"\n                    placeholder=\"Search topics and reviews\"\n                    className=\"text\"\n                    onChange={debounceEventUntilTimeout((e) => {\n                        setReviewOption({ q: e.target.value });\n                    }, 500)}\n                />\n                <span className=\"sort\">\n                    <label>Sort By:</label>\n                    <select\n                        onChange={({ target }) => {\n                            setReviewOption({ sort: target.value });\n                        }}>\n                        <option value=\"newest\">Most Recent</option>\n                        <option value=\"rating_desc\">Highest Rated</option>\n                        <option value=\"rating_asc\">Lowest Rated</option>\n                    </select>\n                </span>\n            </fieldset>\n            <ul className=\"review-list\">\n                {reviews.reviews.length > 0 ? (\n                    reviews.reviews.map((review, i) => <ReviewEntry key={i} review={review} />)\n                ) : (\n                    <li className=\"no-review\">There is no review matching your request. Please try another option.</li>\n                )}\n            </ul>\n            <div className=\"review-pagination\">\n                {currentPage > 1 && (\n                    <>\n                        <a href=\"#\" className=\"more\">\n                            See more reviews\n                        </a>\n                        <a\n                            className=\"prev\"\n                            onClick={() => {\n                                setReviewOption({ page: Math.max(1, currentPage - 1) });\n                            }}>\n                            Prev\n                        </a>\n                    </>\n                )}\n                {currentPage < reviews.total_pages && (\n                    <a\n                        className=\"next\"\n                        onClick={() => {\n                            setReviewOption({ page: Math.min(currentPage + 1, reviews.total_pages) });\n                        }}>\n                        Next\n                    </a>\n                )}\n                {_.range(1, reviews.total_pages + 1).map((pageNum, i) => (\n                    <a\n                        key={i}\n                        onClick={() => {\n                            setReviewOption({ page: pageNum });\n                        }}\n                        className={currentPage === pageNum ? \"current\" : undefined}>\n                        {pageNum}\n                    </a>\n                ))}\n            </div>\n        </>\n    );\n};\n\nexport default Reviews;\n","import React, { Component, Suspense } from \"react\";\nimport { connect } from \"react-redux\";\nimport { isStaticPage } from \"fancyutils\";\n\nimport Thing from \"./Thing\";\nimport MerchantInfo from \"./MerchantInfo\";\nimport Recommendation from \"./Recommendation\";\nimport Reviews from \"./Reviews\";\n\nimport { historyData } from \"../../container/history\";\nimport { updateSaleContext } from \"../../action/action-helpers\";\nimport store from \"../../store/store\";\nimport FancyContext, { getFancyContextDefaultValue, useFancy } from \"./FancyContext\";\n\nimport { OverlayPropsV1 } from \"ftypes\";\nimport { mapStateToThingProps } from \"../map\";\n\nfunction AdminMessages() {\n    const {\n        thing,\n    } = useFancy();\n\n    if (!thing.messages) {\n        return null;\n    }\n\n    return (\n        <div className=\"warning\">\n            <span>This item is not visible to customers because:</span>\n            <ul>\n                {thing.messages.map((m, i) => (\n                    <li key={i}>{m}</li>\n                ))}\n            </ul>\n        </div>\n    );\n}\n\nfunction BreadCrumb() {\n    const { thing } = useFancy();\n\n    return (\n        <div className=\"breadcrumb\">\n            {thing.breadcrumbs.map(({ label, href }, i) => (\n                <React.Fragment key={i}>\n                    <a href={href}>{label}</a>{\" \"}\n                    {i !== thing.breadcrumbs.length - 1 ? (\n                        <>\n                            <span className=\"arrow\">&gt;</span>{\" \"}\n                        </>\n                    ) : null}\n                </React.Fragment>\n            ))}\n        </div>\n    );\n}\n\nfunction AdminSidebar(props: OverlayPropsV1) {\n    const {\n        appContext: { viewer },\n        thing,\n    } = props;\n\n    let admin = null;\n\n    let AdminComponent = null;\n    //if (viewer.is_admin_any) {\n    //    AdminComponent = lazy(() => import(/* webpackChunkName: \"OverlayThing.admin\" */ \"../Admin\"));\n    //}\n\n    if (AdminComponent) {\n        admin = (\n            <Suspense fallback={<div />}>\n                <AdminComponent {...props} fallback={<div />} />\n            </Suspense>\n        );\n    }\n\n    return admin;\n}\n\nclass AppV2 extends Component<OverlayPropsV1> {\n    componentDidUpdate(prevProps: OverlayPropsV1) {\n        const pt = prevProps.thing;\n        const ct = this.props.thing;\n\n        if (ct != null) {\n            if (!pt || pt.id !== ct.id) {\n                if (isStaticPage()) {\n                    $(window).scrollTop(0);\n                } else {\n                    $(\"#overlay-thing > .popup\").attr(\"tabindex\", -1).focus();\n                }\n\n                if (ct.sales && ct.sales.options && ct.sales.options.length > 1) {\n                    const nonSoldoutOptions = ct.sales.options.filter((o) => !o.soldout);\n                    let minimumOption;\n                    if (nonSoldoutOptions.length > 0) {\n                        minimumOption = _.min(nonSoldoutOptions, (o) => Number(o.price));\n                    } else {\n                        minimumOption = _.min(ct.sales.options, (o) => Number(o.price));\n                    }\n                    if (ct.sales.options[0].id !== minimumOption.id) {\n                        store.dispatch(updateSaleContext({ saleOptionID: minimumOption.id }));\n                    }\n                }\n            }\n        }\n    }\n\n    getFancyContext() {\n        return this.props.thing ? this.props : getFancyContextDefaultValue();\n    }\n\n    render() {\n        const { thing } = this.props;\n\n        if (historyData.locationIsThingPage && thing != null) {\n            return (\n                <FancyContext.Provider value={this.getFancyContext()}>\n                    <AdminMessages />\n                    <BreadCrumb />\n                    <Thing />\n                    <Reviews />\n                    <MerchantInfo />\n                    <Recommendation />\n                    <AdminSidebar {...this.props} />\n                </FancyContext.Provider>\n            );\n        } else {\n            return <div />;\n        }\n    }\n}\n\nconst ReduxComponentEnhancer = connect<OverlayPropsV1>(mapStateToThingProps);\nconst Overlay = ReduxComponentEnhancer(AppV2);\n\nexport default Overlay;\n","// This is entrypoint, which `React.render` takes place after DOM is ready.\nimport React from \"react\";\nimport { Route, Router, Switch } from \"react-router-dom\";\nimport { render } from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport Bugsnag from \"@bugsnag/js\";\nimport BugsnagPluginReact from \"@bugsnag/plugin-react\";\n\nimport { history } from \"common-components\";\n\nimport OverlayThing from \"./components/v2\"\n\nif (__Config.bugsnag) {\n    Bugsnag.start({\n        apiKey: \"a54d48e98cb0410b7bdf0e60a905b00e\",\n        plugins: [new BugsnagPluginReact()],\n        user: {\n            id: window.__FancyUser?.id || null\n        },\n    });\n}\n\nimport { attachEntryEvents } from \"./container/entry-events\";\nimport { pagingContext } from \"./container/routeutils\";\nimport store from \"./store/store\";\nimport { historyHook } from \"./container/history\";\n\nconst onLoad = () => {\n    require(\"./Shared\");\n\n    const overlayContainer = document.querySelector(\"#container-wrapper .container\")\n    const thingRegex = /\\/(sales|things)\\/(\\d+)/;\n    const articleRegex = /\\/articles\\/(.+)/;\n    const initialHref = location.href;\n\n    $(window).on(\"popstate.overlay\", function(event) {\n        if (\n            location.href !== initialHref &&\n            !(location.pathname.match(thingRegex) || location.pathname.match(articleRegex))\n        ) {\n            event.preventDefault();\n            location.reload();\n        }\n    });\n\n    const ErrorBoundary = __Config.bugsnag ? Bugsnag.getPlugin(\"react\")!.createErrorBoundary(React) : React.Fragment;\n\n    const tree = (\n        <ErrorBoundary>\n            <Provider store={store}>\n                <Router history={history}>\n                    <Switch>\n                        <Route path=\"/things/*\">\n                            <OverlayThing />\n                        </Route>\n                        <Route path=\"*\" component={() => null} />\n                    </Switch>\n                </Router>\n            </Provider>\n        </ErrorBoundary>\n    );\n\n    render(tree, overlayContainer, () => {\n        history.listen(historyHook);\n        historyHook({ pathname: location.pathname, search: location.search }); // should init once\n        attachEntryEvents();\n        pagingContext.init();\n    });\n};\n\nif (document.readyState !== \"loading\") {\n    onLoad();\n} else {\n    document.addEventListener(\"DOMContentLoaded\", onLoad);\n}\n","// Warning: objects has to be flat in each context\nexport function getInitialStoreState(contextName: 'appContext' | 'thing' | 'followContext' | 'fancyContext' | 'saleContext' | 'slideContext') {\n    switch(contextName) {\n    case 'appContext':\n        return {\n            visible: false,\n            viewer: {},\n            loggedIn: null,\n            userCountry: 'US',\n            applePayDisplay: false,\n            applePayTest: false,\n        };\n    case 'thing':\n        return {\n            data: null,\n            ID: null,\n            pendingID: null,\n            isFetching: null,\n            status: 'idle' // { idle | request | failed }\n        };\n    case 'followContext':\n        return {\n            id: null,\n            followStore: {\n                following: undefined,\n                loading: false,\n            },\n            followUser: {\n                following: undefined,\n                loading: false,\n            },\n        };\n    case 'fancyContext':\n        return {\n            id: null,\n            fancyd_count: 0,\n            fancyd: false,\n            loading: false,\n            status: 'Idle', // { Idle | Addition | Removal | After- } - Fancy'd status for animation control \n        };\n    case 'saleContext':\n        return {\n            selectedQuantity: 1,\n            saleOptionID: null, // `thing.id`? | `sio.id`?\n            currencyCode: null, // props.thing.currency_code\n            currencyMoney: null, //\n            currencySymbol: null, //\n            price: null, // (props.thing.sales_available && props.thing.sales.price) || null,\n            personalization: null,\n        };\n    case 'slideContext':\n        return {\n            id: null,\n            thumbnailIndex: 0,\n        };\n    default:\n        console.warn('`getInitialStoreState()`: Unknown context name ', contextName);\n    }\n};\n\nvar contexts = [\n    'slideContext',\n    'saleContext',\n    'fancyContext',\n    'followContext',\n    'thing',\n    'appContext'\n];\n\nexport function getAllInitialStoreState() {\n    return contexts.reduce((state, contextKey) => {\n        state[contextKey] = getInitialStoreState(contextKey);\n        return state;\n    } , {});\n}\n","// -- Members --\n// className: string\n// - class name that used from sidebar head 'wrapper figure-info {className}'.\n// type: string\n// - meta string that indicates type name\nimport { mergeObjectArgs } from 'fancyutils';\n\nexport class ThingTypeMeta {\n    static isSale = false;\n    static type = 'ThingTypeMeta';\n\n    getName(thingContext) {\n        return thingContext.name;\n    }\n}\n\nexport class PlainThingType extends ThingTypeMeta {\n    static className = '';\n    static type = 'PlainThing';\n    static createEmptyObject(...args) {\n        const objectArgs = mergeObjectArgs(args);\n        const thing = $.extend(true, {\n            id: '1',\n            url: '/',\n            isCrawled: false,\n            owner: {},\n            image: { src: '', width: 1, height: 1 },\n            user: {},\n            type: 'thing',\n            fancyd_friends: [],\n        }, objectArgs);\n        thing.META = getThingType(thing);\n        return thing;\n    }\n}\n\nexport class SaleItemType extends ThingTypeMeta {\n    static className = '';\n    static type = 'SaleItem';\n    static getName(thingContext) {\n        return thingContext.sales.name;\n    }\n    static createEmptyObject(objectArgs) {\n        return PlainThingType.createEmptyObject({\n            sales_available: true,\n            sales: {\n                id: '1',\n                review_rating: 1,\n                review_count: 1,\n                size_chart_ids: ['1'],\n                images: [{ src: '', width: 1, height: 1 }],\n                seller: { id: '1' }\n            },\n            type: 'sales'\n        }, objectArgs);\n    }\n}\n\nexport class GiftcardType extends SaleItemType {\n    static className = 'giftcard';\n    static type = 'Giftcard';\n\n    static getName() {\n        return window.gettext(\"Fancy Gift Card\");\n    }\n}\n\nexport class HotelType extends SaleItemType {\n    static className = 'hotel';\n    static type = 'Hotel';\n\n    static getName(thingContext) {\n        return thingContext.hotel_search.hotel.name;\n    }\n}\n\nexport class VanityType extends SaleItemType {\n    static className = 'vanity';\n    static type = 'Vanity';\n}\n\nexport class LaunchAppType extends ThingTypeMeta {\n    static className = '';\n    static type = 'LaunchApp';\n}\n\n// Retrieve meta by looking up thing object.\nexport function getThingType(thingContext) {\n    var ThingType;\n    if (thingContext.hotel_search) {\n        ThingType = HotelType;\n    } else if (thingContext.has_launch_app && thingContext.metadata) {\n        ThingType = LaunchAppType;\n    } else if (thingContext.type === 'giftcard') {\n        ThingType = GiftcardType;\n    } else if (thingContext.sales_available) {\n        if (thingContext.type === 'vanity_number') {\n            ThingType = VanityType;\n        } else {\n            ThingType = SaleItemType;\n        }\n    } else {\n        ThingType = PlainThingType;\n    }\n    return ThingType;\n}\n\nconst ThingTypes = [PlainThingType, SaleItemType, GiftcardType, HotelType, VanityType, LaunchAppType];\n\n// TODO: immutable\nThingTypes.forEach(AttachingType => {\n    ThingTypes.forEach(ComparingType => { \n        AttachingType[ComparingType.type] = AttachingType === ComparingType;\n    });\n});\n","import { combineReducers } from \"@reduxjs/toolkit\";\nimport { extractMetaFromURL, /*getConciseNumberString,*/ update, updateShallow } from \"fancyutils\";\n\nimport C from \"./action/action-constants\";\nimport { getInitialStoreState } from \"./store/initial-store\";\nimport { getFirstSaleOption, setWaiting } from \"./components/map\";\nimport { updateState } from \"./appstate\";\nimport { scrollEvent } from \"./container/entry-events\";\nimport { getThingType } from \"./ThingTypes\";\nimport { cache } from \"./cache\";\n\nvar loaded = false;\nvar lastFullyRenderedThingID = 0;\nfunction appContext(state = getInitialStoreState(\"appContext\"), action) {\n    switch (action.type) {\n        case C.OPEN_THING:\n            scrollEvent.visible = true;\n            return updateShallow(state, {\n                visible: true,\n            });\n        case C.CLOSE_THING:\n            scrollEvent.visible = false;\n            lastFullyRenderedThingID = 0;\n            loaded = false;\n            return updateShallow(state, {\n                visible: false,\n                lastFullyRenderedThingID,\n            });\n        case C.UPDATE_APP_CONTEXT:\n            return updateShallow(state, action.context);\n        case C.LOAD_THING: {\n            // Due to multi-stage rendering (cache -> from-server-data -> ...)\n            // it is unable to check state change correctly just by comparing ID;\n            // Therefore, we set internal state per every update cycle and check\n            // if state is fully updated.\n\n            // FIXME: when cached response exist, it marks as rendered before\n            if (loaded === true && lastFullyRenderedThingID !== action.data.id && action.data.fromServer) {\n                lastFullyRenderedThingID = action.data.id;\n            }\n\n            const loggedIn = window.__FancyUser.loggedIn;\n            const viewer = action.data.viewer || {};\n            const userCountry =\n                $.cookie.get(\"shipping_country_code\") || action.data.current_country_code || state.userCountry;\n\n            updateState(\"loggedIn\", loggedIn);\n            updateState(\"viewer\", viewer);\n            loaded = true;\n\n            return update(state, { lastFullyRenderedThingID, loggedIn, viewer, userCountry });\n        }\n        default:\n            return state;\n    }\n}\n\nfunction populateThingContext(thingData) {\n    thingData.loading = thingData.fromServer !== true;\n    thingData.META = getThingType(thingData);\n    thingData.URLMeta = extractMetaFromURL(location.href); // FIXME: provide current pathname\n    thingData.owner = thingData.user;\n}\n\n// Thing context\nfunction thing(state = getInitialStoreState(\"thing\"), action) {\n    switch (action.type) {\n        case C.LOAD_THING:\n            populateThingContext(action.data);\n            return updateShallow(state, {\n                data: action.data,\n                status: action.status,\n                ID: action.ID,\n                pendingID: null,\n                isFetching: false,\n            });\n        case C.REQUEST_THING:\n            return update(state, {\n                pendingID: action.pendingID,\n                status: action.status,\n                isFetching: true,\n            });\n        case C.REQUEST_THING_FAILURE:\n            return update(state, {\n                status: action.status,\n                isFetching: false,\n            });\n\n        // Reset state\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"thing\"));\n        default:\n            return state;\n    }\n}\n\n// Follow contexts\nfunction followContext(state = getInitialStoreState(\"followContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"), {\n                id: action.data.id,\n                followStore: {\n                    following: action.data.sales\n                        ? Boolean(action.data.sales.seller && action.data.sales.seller.seller_follow)\n                        : false,\n                    loading: false,\n                },\n                followUser: {\n                    following: action.data ? Boolean(action.data.following) : false,\n                    loading: false,\n                },\n            });\n\n        // Sidebar\n        // Follow seller/user\n        case C.TOGGLE_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: true,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.CANCEL_FOLLOW:\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: !state[action.followType].following,\n                },\n            });\n        case C.COMPLETE_FOLLOW:\n            if (action.followType === \"followStore\") {\n                cache.update(state.id, undefined, \"sales.seller.seller_follow\", state[action.followType].following);\n            }\n            return update(state, {\n                [action.followType]: {\n                    loading: false,\n                    following: state[action.followType].following,\n                },\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"followContext\"));\n        default:\n            return state;\n    }\n}\n\n/*\nfunction getFancyStatus(nextFancydState) {\n    return nextFancydState ? FancyStatus.Addition : FancyStatus.Removal;\n}\nfunction getCompletionIdleStatus(currentFancyState) {\n    const prevFancyState = !currentFancyState;\n    return prevFancyState ? FancyStatus.AfterRemoval : FancyStatus.AfterAddition;\n}*/\n\nfunction fancyContext(state = getInitialStoreState(\"fancyContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            // Extract thing data for initial thing context data reset.\n            // onFancyButtonUpdate(action.data.id, action.data.fancyd, getConciseNumberString(action.data.fancyd_count));\n            return updateShallow(getInitialStoreState(\"fancyContext\"), {\n                id: action.data.id,\n                fancyd: action.data.fancyd,\n                fancyd_count: action.data.fancyd_count,\n                loading: false,\n                //status: FancyStatus.Idle,\n            });\n        case C.TOGGLE_FANCY:\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: true,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: true,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        case C.CANCEL_FANCY: {\n            const nextFancydState = !state.fancyd;\n            // return update(state, {\n            //     fancyd: nextFancydState,\n            //     loading: false,\n            //     //status: getFancyStatus(nextFancydState)\n            // });\n            return {\n                ...state,\n                ...{\n                    fancyd: nextFancydState,\n                    loading: false,\n                    //status: getFancyStatus(nextFancydState)\n                },\n            };\n        }\n        // Update data\n        case C.COMPLETE_FANCY:\n            // cache.update(state.id, undefined, \"fancyd\", state.fancyd);\n            // cache.update(state.id, undefined, \"fancyd_count\", action.fancyd_count);\n            // onFancyButtonUpdate(state.id, state.fancyd, getConciseNumberString(action.fancyd_count));\n            // return update(state, {\n            //     loading: false,\n            //     fancyd_count: action.fancyd_count,\n            //     //status: getCompletionIdleStatus(state.fancyd)\n            // });\n            return {\n                ...state,\n                ...{\n                    loading: false,\n                    fancyd_count: action.fancyd_count,\n                    //status: getCompletionIdleStatus(state.fancyd)\n                },\n            };\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"fancyContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction slideContext(state = getInitialStoreState(\"slideContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"), {\n                id: action.data.id,\n            });\n        case C.SET_THUMBNAIL_INDEX:\n            return update(state, {\n                thumbnailIndex: action.thumbnailIndex,\n            });\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"slideContext\"));\n        default:\n            return state;\n    }\n}\n\nfunction saleContext(state = getInitialStoreState(\"saleContext\"), action) {\n    switch (action.type) {\n        // reset thing context on new thing loading / closing.\n        case C.LOAD_THING: {\n            // Extract thing data for initial thing context data reset.\n            const thing = action.data;\n            const sales = thing && thing.sales;\n            const saleOptionInclSales = getFirstSaleOption(sales);\n            const nextContext = {\n                selectedQuantity: 1,\n                // saleOptionID: (saleOptionInclSales && saleOptionInclSales.id) || null,\n                saleOptionID: null,\n                currencyCode: action.data.currency_code,\n                price: (saleOptionInclSales && saleOptionInclSales.price) || null,\n                waiting: null,\n            };\n            return updateShallow(getInitialStoreState(\"saleContext\"), nextContext);\n        }\n        case C.CLOSE_THING:\n            return updateShallow(getInitialStoreState(\"saleContext\"));\n        case C.UPDATE_SALE_CONTEXT: {\n            // Setting waiting\n            if (action.waiting != null) {\n                setWaiting(state.saleOptionID, action.waiting);\n            }\n\n            let waiting = action.waiting;\n            // Reset quantity / Change waiting if option is changed.\n            if (action.saleOptionID != null && action.saleOptionID !== state.saleOptionID) {\n                action.selectedQuantity = 1;\n                waiting = null;\n            }\n\n            const nextContext = {\n                selectedQuantity: action.selectedQuantity,\n                saleOptionID: action.saleOptionID, // `thing.id`? | `sio.id`?\n                price: action.price, // (props.thing.sales_available && props.thing.sales.price) || null,\n                // UI\n                currencyCode: action.currencyCode, // props.thing.currency_code\n                currencyMoney: action.currencyMoney, //\n                currencySymbol: action.currencySymbol, //\n                personalization: action.personalization,\n                waiting,\n            };\n            return update(state, nextContext);\n        }\n        default:\n            return state;\n    }\n}\n\n/*\nfunction checkNotImplementedWithURLExceptionRule(META) {\n    if (['Fancybox', 'Hermes'].some(type => META[type])) {\n        window.location.reload()\n    }\n}*/\n\nconst rootReducer = combineReducers({\n    appContext,\n    // Thing contexts\n    followContext,\n    fancyContext,\n    slideContext,\n    saleContext,\n    // etc.\n    thing,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import { configureStore } from \"@reduxjs/toolkit\";\nimport thunk from \"redux-thunk\";\nimport logger from 'redux-logger'\n\nimport { getAllInitialStoreState } from \"./initial-store\";\nimport rootReducer from \"../reducers\";\n// import type { RootState } from '../reducers';\n\nconst middlewares = [thunk];\nif (process.env.NODE_ENV !== 'production') {\n    middlewares.push(logger);\n}\n\nconst store = configureStore({\n    reducer: rootReducer,\n    preloadedState: getAllInitialStoreState(),\n    middleware: (getDefaultMiddleware) =>\n        getDefaultMiddleware({\n            serializableCheck: false,\n        }).prepend(middlewares),\n});\n\nexport type AppDispatch = typeof store.dispatch;\nexport default store;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tif(mode & 2 && typeof value == 'object' && value) {\n\t\tfor(const key in value) def[key] = () => value[key];\n\t}\n\tdef['default'] = () => value;\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + {\"114\":\"OverlayThing.popup\",\"555\":\"OverlayThing.admin\"}[chunkId] + \".\" + {\"114\":\"306a708359787a3c0512\",\"555\":\"b03b17dc17efe4aa8666\"}[chunkId] + \".js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.hmd = (module) => {\n\tmodule = Object.create(module);\n\tif (!module.children) module.children = [];\n\tObject.defineProperty(module, 'exports', {\n\t\tenumerable: true,\n\t\tset: () => {\n\t\t\tthrow new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\n\t\t}\n\t});\n\treturn module;\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"https://static-ec1.thefancy.com/_static_gen/_ui/js/bundle/\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// Promise = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t765: 0\n};\n\nvar deferredModules = [\n\t[8700,216,130]\n];\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => {\n\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n\t\t\t\t\t});\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId);\n\t\t\t\t} else installedChunks[chunkId] = 0;\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\nvar checkDeferredModules = () => {\n\n};\nfunction checkDeferredModulesImpl() {\n\tvar result;\n\tfor(var i = 0; i < deferredModules.length; i++) {\n\t\tvar deferredModule = deferredModules[i];\n\t\tvar fulfilled = true;\n\t\tfor(var j = 1; j < deferredModule.length; j++) {\n\t\t\tvar depId = deferredModule[j];\n\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferredModules.splice(i--, 1);\n\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n\t\t}\n\t}\n\tif(deferredModules.length === 0) {\n\t\t__webpack_require__.x();\n\t\t__webpack_require__.x = () => {\n\n\t\t}\n\t}\n\treturn result;\n}\n__webpack_require__.x = () => {\n\t// reset startup function so it can be called again when more startup code is added\n\t__webpack_require__.x = () => {\n\n\t}\n\tchunkLoadingGlobal = chunkLoadingGlobal.slice();\n\tfor(var i = 0; i < chunkLoadingGlobal.length; i++) webpackJsonpCallback(chunkLoadingGlobal[i]);\n\treturn (checkDeferredModules = checkDeferredModulesImpl)();\n};\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (data) => {\n\tvar [chunkIds, moreModules, runtime, executeModules] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0, resolves = [];\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tresolves.push(installedChunks[chunkId][0]);\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tparentChunkLoadingFunction(data);\n\twhile(resolves.length) {\n\t\tresolves.shift()();\n\t}\n\n\t// add entry modules from loaded chunk to deferred list\n\tif(executeModules) deferredModules.push.apply(deferredModules, executeModules);\n\n\t// run deferred modules when all chunks ready\n\treturn checkDeferredModules();\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkfancy\"] = self[\"webpackChunkfancy\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = webpackJsonpCallback;","// run startup\nreturn __webpack_require__.x();\n"],"sourceRoot":""}